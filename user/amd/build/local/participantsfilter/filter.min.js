define ("core_user/local/participantsfilter/filter",["exports","core/form-autocomplete","./selectors","core/str"],function(_exports,_formAutocomplete,_selectors,_str){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.default=void 0;_formAutocomplete=_interopRequireDefault(_formAutocomplete);_selectors=_interopRequireDefault(_selectors);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0,descriptor;i<props.length;i++){descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value"in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:!1});return Constructor}var getOptionsForSelect=function(select){return select.querySelectorAll(":checked")},_default=function(){function _default(filterType,rootNode,initialValues){_classCallCheck(this,_default);this.filterType=filterType;this.rootNode=rootNode;this.addValueSelector(initialValues)}_createClass(_default,[{key:"tearDown",value:function tearDown(){}},{key:"placeholder",get:function get(){return(0,_str.get_string)("placeholdertypeorselect","core_user")}},{key:"showSuggestions",get:function get(){return!0}},{key:"addValueSelector",value:function(){var _addValueSelector=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var _this=this,initialValues,filterValueNode,sourceDataNode,dataSource,filterValueLabel,_args=arguments;return regeneratorRuntime.wrap(function(_context){while(1){switch(_context.prev=_context.next){case 0:initialValues=0<_args.length&&_args[0]!==void 0?_args[0]:[];filterValueNode=this.getFilterValueNode();sourceDataNode=this.getSourceDataForFilter();if(sourceDataNode){_context.next=5;break}return _context.abrupt("return");case 5:filterValueNode.innerHTML=sourceDataNode.outerHTML;dataSource=filterValueNode.querySelector("select");dataSource.id="filter-value-"+dataSource.getAttribute("data-field-name");filterValueLabel=document.createElement("label");filterValueLabel.setAttribute("for",dataSource.id);filterValueLabel.classList.add("sr-only");filterValueLabel.innerText=dataSource.getAttribute("data-field-title");filterValueNode.appendChild(filterValueLabel);initialValues.forEach(function(filterValue){var selectedOption=dataSource.querySelector("option[value=\"".concat(filterValue,"\"]"));if(selectedOption){selectedOption.selected=!0}else if(!_this.showSuggestions){selectedOption=document.createElement("option");selectedOption.value=filterValue;selectedOption.innerHTML=filterValue;selectedOption.selected=!0;dataSource.append(selectedOption)}});_context.t0=_formAutocomplete.default;_context.t1=dataSource;_context.t2="1"==dataSource.dataset.allowCustom;_context.next=19;return this.placeholder;case 19:_context.t3=_context.sent;_context.t4=this.showSuggestions;_context.t5=!dataSource.multiple;_context.t6={items:"core_user/local/participantsfilter/autocomplete_selection_items",layout:"core_user/local/participantsfilter/autocomplete_layout",selection:"core_user/local/participantsfilter/autocomplete_selection"};_context.t0.enhance.call(_context.t0,_context.t1,_context.t2,null,_context.t3,!1,_context.t4,null,_context.t5,_context.t6);case 24:case"end":return _context.stop();}}},_callee,this)}));return function addValueSelector(){return _addValueSelector.apply(this,arguments)}}()},{key:"filterRoot",get:function get(){return this.rootNode.querySelector(_selectors.default.filter.byName(this.filterType))}},{key:"getSourceDataForFilter",value:function getSourceDataForFilter(){var filterDataNode=this.rootNode.querySelector(_selectors.default.filterset.regions.datasource);return filterDataNode.querySelector(_selectors.default.data.fields.byName(this.filterType))}},{key:"getFilterValueNode",value:function getFilterValueNode(){return this.filterRoot.querySelector(_selectors.default.filter.regions.values)}},{key:"name",get:function get(){return this.filterType}},{key:"jointype",get:function get(){return parseInt(this.filterRoot.querySelector(_selectors.default.filter.fields.join).value,10)}},{key:"rawValues",get:function get(){var filterValueNode=this.getFilterValueNode(),filterValueSelect=filterValueNode.querySelector("select");return Object.values(getOptionsForSelect(filterValueSelect)).map(function(option){return option.value})}},{key:"values",get:function get(){return this.rawValues.map(function(option){return parseInt(option,10)})}},{key:"filterValue",get:function get(){return{name:this.name,jointype:this.jointype,values:this.values}}}]);return _default}();_exports.default=_default;return _exports.default});
//# sourceMappingURL=filter.min.js.map
