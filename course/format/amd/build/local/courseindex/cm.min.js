function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define ("core_courseformat/local/courseindex/cm",["exports","core_courseformat/local/courseeditor/dndcmitem","core/templates","core/prefetch","core/config"],function(_exports,_dndcmitem,_templates,_prefetch,_config){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.default=void 0;_dndcmitem=_interopRequireDefault(_dndcmitem);_templates=_interopRequireDefault(_templates);_prefetch=_interopRequireDefault(_prefetch);_config=_interopRequireDefault(_config);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0,descriptor;i<props.length;i++){descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value"in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:!1});return Constructor}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}});Object.defineProperty(subClass,"prototype",{writable:!1});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call)){return call}else if(void 0!==call){throw new TypeError("Derived constructors may only return object or undefined")}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(void 0===self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return!0}catch(e){return!1}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}_prefetch.default.prefetchTemplate("core_courseformat/local/courseindex/cmcompletion");var Component=function(_DndCmItem){_inherits(Component,_DndCmItem);var _super=_createSuper(Component);function Component(){_classCallCheck(this,Component);return _super.apply(this,arguments)}_createClass(Component,[{key:"create",value:function create(){this.name="courseindex_cm";this.selectors={CM_NAME:"[data-for='cm_name']",CM_COMPLETION:"[data-for='cm_completion']"};this.classes={CMHIDDEN:"dimmed",LOCKED:"editinprogress",RESTRICTIONS:"rectrictions",PAGEITEM:"pageitem"};this.id=this.element.dataset.id}},{key:"stateReady",value:function stateReady(state){this.configDragDrop(this.id);var cm=state.cm.get(this.id),course=state.course;this._refreshCompletion({state:state,element:cm});if(window.location.href==cm.url||window.location.href=="".concat(course.baseurl,"#").concat(cm.anchor)){this.reactive.dispatch("setPageItem","cm",this.id);this.element.scrollIntoView({block:"center"})}if(_config.default.contextid!=_config.default.courseContextId&&_config.default.contextInstanceId==this.id){this.reactive.dispatch("setPageItem","cm",this.id,!0);this.element.scrollIntoView({block:"center"})}if(!cm.uservisible){this.addEventListener(this.getElement(this.selectors.CM_NAME),"click",this._activityAnchor)}}},{key:"getWatchers",value:function getWatchers(){return[{watch:"cm[".concat(this.id,"]:deleted"),handler:this.remove},{watch:"cm[".concat(this.id,"]:updated"),handler:this._refreshCm},{watch:"cm[".concat(this.id,"].completionstate:updated"),handler:this._refreshCompletion},{watch:"course.pageItem:updated",handler:this._refreshPageItem}]}},{key:"_refreshCm",value:function _refreshCm(_ref){var _element$dragging,_element$locked,_element$hascmrectric,element=_ref.element;this.element.classList.toggle(this.classes.CMHIDDEN,!element.visible);this.getElement(this.selectors.CM_NAME).innerHTML=element.name;this.element.classList.toggle(this.classes.DRAGGING,null!==(_element$dragging=element.dragging)&&void 0!==_element$dragging?_element$dragging:!1);this.element.classList.toggle(this.classes.LOCKED,null!==(_element$locked=element.locked)&&void 0!==_element$locked?_element$locked:!1);this.element.classList.toggle(this.classes.RESTRICTIONS,null!==(_element$hascmrectric=element.hascmrectrictions)&&void 0!==_element$hascmrectric?_element$hascmrectric:!1);this.locked=element.locked}},{key:"_refreshPageItem",value:function _refreshPageItem(_ref2){var element=_ref2.element;if(!element.pageItem){return}var isPageId="cm"==element.pageItem.type&&element.pageItem.id==this.id;this.element.classList.toggle(this.classes.PAGEITEM,isPageId);if(isPageId&&!this.reactive.isEditing){this.element.scrollIntoView({block:"nearest"})}}},{key:"_refreshCompletion",value:function(){var _refreshCompletion2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(_ref3){var state,element,completionElement,exporter,data,_yield$Templates$rend,html,js;return regeneratorRuntime.wrap(function(_context){while(1){switch(_context.prev=_context.next){case 0:state=_ref3.state,element=_ref3.element;if(!(this.reactive.isEditing||!element.istrackeduser)){_context.next=3;break}return _context.abrupt("return");case 3:completionElement=this.getElement(this.selectors.CM_COMPLETION);if(!(completionElement.dataset.value==element.completionstate)){_context.next=6;break}return _context.abrupt("return");case 6:exporter=this.reactive.getExporter();data=exporter.cmCompletion(state,element);_context.prev=8;_context.next=11;return _templates.default.renderForPromise("core_courseformat/local/courseindex/cmcompletion",data);case 11:_yield$Templates$rend=_context.sent;html=_yield$Templates$rend.html;js=_yield$Templates$rend.js;_templates.default.replaceNode(completionElement,html,js);_context.next=20;break;case 17:_context.prev=17;_context.t0=_context["catch"](8);throw _context.t0;case 20:case"end":return _context.stop();}}},_callee,this,[[8,17]])}));return function _refreshCompletion(){return _refreshCompletion2.apply(this,arguments)}}()},{key:"_activityAnchor",value:function _activityAnchor(event){var _this=this,cm=this.reactive.get("cm",this.id),element=document.getElementById(cm.anchor);if(element){setTimeout(function(){_this.reactive.dispatch("setPageItem","cm",cm.id)},50);return}var course=this.reactive.get("course"),section=this.reactive.get("section",cm.sectionid);if(!section){return}var url="".concat(course.baseurl,"&section=").concat(section.number,"#").concat(cm.anchor);event.preventDefault();window.location=url}}],[{key:"init",value:function init(target,selectors){return new Component({element:document.getElementById(target),selectors:selectors})}}]);return Component}(_dndcmitem.default);_exports.default=Component;return _exports.default});
//# sourceMappingURL=cm.min.js.map
