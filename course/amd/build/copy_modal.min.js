define ("core_course/copy_modal",["jquery","core/str","core/modal_factory","core/modal_events","core/ajax","core/fragment","core/notification","core/config"],function($,Str,ModalFactory,ModalEvents,ajax,Fragment,Notification,Config){var CopyModal={},contextid,course,modalObj,spinner="<p class=\"text-center\"><i class=\"fa fa-spinner fa-pulse fa-2x fa-fw\"></i></p>";function createModal(){Str.get_string("loading").then(function(title){ModalFactory.create({type:ModalFactory.types.DEFAULT,title:title,body:spinner,large:!0}).done(function(modal){modalObj=modal;modalObj.getRoot().on("click","#id_submitreturn",processModalForm);modalObj.getRoot().on("click","#id_submitdisplay",function(e){e.formredirect=!0;processModalForm(e)});modalObj.getRoot().on("click","#id_cancel",function(e){e.preventDefault();modalObj.setBody(spinner);modalObj.hide()})})}).catch(function(){Notification.exception(new Error("Failed to load string: loading"))})}function updateModalBody(formdata){if("undefined"==typeof formdata){formdata={}}var params={jsonformdata:JSON.stringify(formdata),courseid:course.id};modalObj.setBody(spinner);Str.get_string("copycoursetitle","backup",course.shortname).then(function(title){modalObj.setTitle(title);modalObj.setBody(Fragment.loadFragment("course","new_base_form",contextid,params))}).catch(function(){Notification.exception(new Error("Failed to load string: copycoursetitle"))})}function processModalForm(e){e.preventDefault();var copyform=modalObj.getRoot().find("form").serialize(),formjson=JSON.stringify(copyform),invalid=$.merge(modalObj.getRoot().find("[aria-invalid=\"true\"]"),modalObj.getRoot().find(".error"));if(invalid.length){invalid.first().focus();return}ajax.call([{methodname:"core_backup_submit_copy_form",args:{jsonformdata:formjson}}])[0].done(function(){modalObj.setBody(spinner);modalObj.hide();if(!0==e.formredirect){var redirect=Config.wwwroot+"/backup/copyprogress.php?id="+course.id;window.location.assign(redirect)}}).fail(function(){updateModalBody(copyform)})}CopyModal.init=function(context){contextid=context;createModal();$(".action-copy").on("click",function(e){e.preventDefault();var url=new URL(this.getAttribute("href")),params=new URLSearchParams(url.search),courseid=params.get("id");ajax.call([{methodname:"core_course_get_courses",args:{options:{ids:[courseid]}}}])[0].done(function(response){course=response[0];updateModalBody()}).fail(function(){Notification.exception(new Error("Failed to load course"))});modalObj.show()})};return CopyModal});
//# sourceMappingURL=copy_modal.min.js.map
