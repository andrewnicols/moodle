define ("core_contentbank/actions",["jquery","core/ajax","core/notification","core/str","core/templates","core/url","core/modal_factory","core/modal_events"],function($,Ajax,Notification,Str,Templates,Url,ModalFactory,ModalEvents){var ACTIONS={DELETE_CONTENT:"[data-action=\"deletecontent\"]",RENAME_CONTENT:"[data-action=\"renamecontent\"]",SET_CONTENT_VISIBILITY:"[data-action=\"setcontentvisibility\"]"},Actions=function(){this.registerEvents()};Actions.prototype.registerEvents=function(){$(ACTIONS.DELETE_CONTENT).click(function(e){e.preventDefault();var contentname=$(this).data("contentname"),contentuses=$(this).data("uses"),contentid=$(this).data("contentid"),contextid=$(this).data("contextid"),deleteButtonText="";Str.get_strings([{key:"deletecontent",component:"core_contentbank"},{key:"deletecontentconfirm",component:"core_contentbank",param:{name:contentname}},{key:"deletecontentconfirmlinked",component:"core_contentbank"},{key:"delete",component:"core"}]).then(function(langStrings){var modalTitle=langStrings[0],modalContent=langStrings[1];if(0<contentuses){modalContent+=" "+langStrings[2]}deleteButtonText=langStrings[3];return ModalFactory.create({title:modalTitle,body:modalContent,type:ModalFactory.types.SAVE_CANCEL,large:!0})}).done(function(modal){modal.setSaveButtonText(deleteButtonText);modal.getRoot().on(ModalEvents.save,function(){return deleteContent(contentid,contextid)});modal.getRoot().on(ModalEvents.hidden,function(){modal.destroy()});modal.show()}).catch(Notification.exception)});$(ACTIONS.RENAME_CONTENT).click(function(e){e.preventDefault();var contentname=$(this).data("contentname"),contentid=$(this).data("contentid"),saveButtonText="";Str.get_strings([{key:"renamecontent",component:"core_contentbank"},{key:"rename",component:"core_contentbank"}]).then(function(langStrings){var modalTitle=langStrings[0];saveButtonText=langStrings[1];return ModalFactory.create({title:modalTitle,body:Templates.render("core_contentbank/renamecontent",{contentid:contentid,name:contentname}),type:ModalFactory.types.SAVE_CANCEL})}).then(function(modal){modal.setSaveButtonText(saveButtonText);modal.getRoot().on(ModalEvents.save,function(e){var newname=$("#newname").val().trim();if(newname){renameContent(contentid,newname)}else{Str.get_strings([{key:"error"},{key:"emptynamenotallowed",component:"core_contentbank"}]).then(function(langStrings){Notification.alert(langStrings[0],langStrings[1])}).catch(Notification.exception);e.preventDefault()}});modal.getRoot().on(ModalEvents.hidden,function(){modal.destroy()});modal.show()}).catch(Notification.exception)});$(ACTIONS.SET_CONTENT_VISIBILITY).click(function(e){e.preventDefault();var contentid=$(this).data("contentid"),visibility=$(this).data("visibility");setContentVisibility(contentid,visibility)})};function deleteContent(contentid,contextid){var requestType="success";Ajax.call([{methodname:"core_contentbank_delete_content",args:{contentids:{contentid:contentid}}}])[0].then(function(data){if(data.result){return"contentdeleted"}requestType="error";return"contentnotdeleted"}).done(function(message){var params={contextid:contextid};if("success"==requestType){params.statusmsg=message}else{params.errormsg=message}window.location.href=Url.relativeUrl("contentbank/index.php",params,!1)}).fail(Notification.exception)}function renameContent(contentid,name){var requestType="success";Ajax.call([{methodname:"core_contentbank_rename_content",args:{contentid:contentid,name:name}}])[0].then(function(data){if(data.result){return"contentrenamed"}requestType="error";return data.warnings[0].message}).then(function(message){var params=null;if("success"==requestType){params={id:contentid,statusmsg:message};window.location.href=Url.relativeUrl("contentbank/view.php",params,!1)}else{Notification.addNotification({message:message,type:"error"});Notification.fetchNotifications()}}).catch(Notification.exception)}function setContentVisibility(contentid,visibility){var requestType="success";Ajax.call([{methodname:"core_contentbank_set_content_visibility",args:{contentid:contentid,visibility:visibility}}])[0].then(function(data){if(data.result){return"contentvisibilitychanged"}requestType="error";return data.warnings[0].message}).then(function(message){var params=null;if("success"==requestType){params={id:contentid,statusmsg:message};window.location.href=Url.relativeUrl("contentbank/view.php",params,!1)}else{Notification.addNotification({message:message,type:"error"});Notification.fetchNotifications()}}).catch(Notification.exception)}return{init:function init(){return new Actions}}});
//# sourceMappingURL=actions.min.js.map
