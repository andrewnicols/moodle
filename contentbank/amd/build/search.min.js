define ("core_contentbank/search",["exports","jquery","core_contentbank/selectors","core/str","core/pending","core/utils"],function(_exports,_jquery,_selectors,_str,_pending,_utils){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.init=void 0;_jquery=_interopRequireDefault(_jquery);_selectors=_interopRequireDefault(_selectors);_pending=_interopRequireDefault(_pending);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const init=()=>{const pendingPromise=new _pending.default,root=(0,_jquery.default)(_selectors.default.regions.contentbank);registerListenerEvents(root);pendingPromise.resolve()};_exports.init=init;const registerListenerEvents=root=>{const searchInput=root.find(_selectors.default.elements.searchinput)[0];root.on("click",_selectors.default.actions.search,function(e){e.preventDefault();toggleSearchResultsView(root,searchInput.value)});root.on("click",_selectors.default.actions.clearSearch,function(e){e.preventDefault();searchInput.value="";searchInput.focus();toggleSearchResultsView(root,searchInput.value)});searchInput.addEventListener("input",(0,_utils.debounce)(()=>{toggleSearchResultsView(root,searchInput.value)},300))},toggleSearchResultsView=async(body,searchQuery)=>{const clearSearchButton=body.find(_selectors.default.actions.clearSearch)[0],navbarBreadcrumb=body.find(_selectors.default.elements.cbnavbarbreadcrumb)[0],navbarTotal=body.find(_selectors.default.elements.cbnavbartotalsearch)[0],filteredContents=filterContents(body,searchQuery);if(0<searchQuery.length){clearSearchButton.classList.remove("d-none");navbarBreadcrumb.classList.add("d-none");navbarTotal.innerHTML=await(0,_str.get_string)("itemsfound","core_contentbank",filteredContents.length);navbarTotal.classList.remove("d-none")}else{clearSearchButton.classList.add("d-none");navbarBreadcrumb.classList.remove("d-none");navbarTotal.classList.add("d-none")}},filterContents=(body,searchTerm)=>{const contents=Array.from(body.find(_selectors.default.elements.listitem)),searchResults=[];contents.forEach(content=>{const contentName=content.getAttribute("data-name");if(""===searchTerm||contentName.toLowerCase().includes(searchTerm.toLowerCase())){searchResults.push(content);const contentNameElement=content.querySelector(_selectors.default.regions.cbcontentname);contentNameElement.innerHTML=highlight(contentName,searchTerm);content.classList.remove("d-none")}else{content.classList.add("d-none")}});return searchResults},highlight=(text,highlightText)=>{let result=text;if(""!==highlightText){const pos=text.toLowerCase().indexOf(highlightText.toLowerCase());if(-1<pos){result=text.substr(0,pos)+"<span class=\"matchtext\">"+text.substr(pos,highlightText.length)+"</span>"+text.substr(pos+highlightText.length)}}return result}});
//# sourceMappingURL=search.min.js.map
