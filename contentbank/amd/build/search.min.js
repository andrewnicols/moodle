define ("core_contentbank/search",["exports","jquery","core_contentbank/selectors","core/str","core/pending","core/utils"],function(_exports,_jquery,_selectors,_str,_pending,_utils){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.init=void 0;_jquery=_interopRequireDefault(_jquery);_selectors=_interopRequireDefault(_selectors);_pending=_interopRequireDefault(_pending);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}var init=function(){var pendingPromise=new _pending.default,root=(0,_jquery.default)(_selectors.default.regions.contentbank);registerListenerEvents(root);pendingPromise.resolve()};_exports.init=init;var registerListenerEvents=function(root){var searchInput=root.find(_selectors.default.elements.searchinput)[0];root.on("click",_selectors.default.actions.search,function(e){e.preventDefault();toggleSearchResultsView(root,searchInput.value)});root.on("click",_selectors.default.actions.clearSearch,function(e){e.preventDefault();searchInput.value="";searchInput.focus();toggleSearchResultsView(root,searchInput.value)});searchInput.addEventListener("input",(0,_utils.debounce)(function(){toggleSearchResultsView(root,searchInput.value)},300))},toggleSearchResultsView=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(body,searchQuery){var clearSearchButton,navbarBreadcrumb,navbarTotal,filteredContents;return regeneratorRuntime.wrap(function(_context){while(1){switch(_context.prev=_context.next){case 0:clearSearchButton=body.find(_selectors.default.actions.clearSearch)[0];navbarBreadcrumb=body.find(_selectors.default.elements.cbnavbarbreadcrumb)[0];navbarTotal=body.find(_selectors.default.elements.cbnavbartotalsearch)[0];filteredContents=filterContents(body,searchQuery);if(!(0<searchQuery.length)){_context.next=13;break}clearSearchButton.classList.remove("d-none");navbarBreadcrumb.classList.add("d-none");_context.next=9;return(0,_str.get_string)("itemsfound","core_contentbank",filteredContents.length);case 9:navbarTotal.innerHTML=_context.sent;navbarTotal.classList.remove("d-none");_context.next=16;break;case 13:clearSearchButton.classList.add("d-none");navbarBreadcrumb.classList.remove("d-none");navbarTotal.classList.add("d-none");case 16:case"end":return _context.stop();}}},_callee)}));return function(){return _ref.apply(this,arguments)}}(),filterContents=function(body,searchTerm){var contents=Array.from(body.find(_selectors.default.elements.listitem)),searchResults=[];contents.forEach(function(content){var contentName=content.getAttribute("data-name");if(""===searchTerm||contentName.toLowerCase().includes(searchTerm.toLowerCase())){searchResults.push(content);var contentNameElement=content.querySelector(_selectors.default.regions.cbcontentname);contentNameElement.innerHTML=highlight(contentName,searchTerm);content.classList.remove("d-none")}else{content.classList.add("d-none")}});return searchResults},highlight=function(text,highlightText){var result=text;if(""!==highlightText){var pos=text.toLowerCase().indexOf(highlightText.toLowerCase());if(-1<pos){result=text.substr(0,pos)+"<span class=\"matchtext\">"+text.substr(pos,highlightText.length)+"</span>"+text.substr(pos+highlightText.length)}}return result}});
//# sourceMappingURL=search.min.js.map
