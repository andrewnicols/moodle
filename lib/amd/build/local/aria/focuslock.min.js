define ("core/local/aria/focuslock",["exports"],function(_exports){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.untrapFocus=_exports.trapFocus=void 0;var selectors={focusable:"input:not([type=\"hidden\"]), a[href], button, textarea, select, [tabindex]"},lockRegionStack=[],initialFocusElementStack=[],finalFocusElementStack=[],lastFocus=null,ignoreFocusChanges=!1,isLocked=!1,lockHandler=function(event){if(ignoreFocusChanges){return}var lockRegion=getCurrentLockRegion();if(!lockRegion.parentNode){untrapFocus()}if(lockRegion.contains(event.target)){lastFocus=event.target}else{focusFirstDescendant();if(lastFocus==document.activeElement){focusLastDescendant()}lastFocus=document.activeElement}},focusFirstDescendant=function(){var lockRegion=getCurrentLockRegion(),focusableElements=Array.from(lockRegion.querySelectorAll(selectors.focusable));focusableElements.unshift(lockRegion);return focusableElements.some(function(focusableElement){return attemptFocus(focusableElement)})},focusLastDescendant=function(){var lockRegion=getCurrentLockRegion(),focusableElements=Array.from(lockRegion.querySelectorAll(selectors.focusable)).reverse();focusableElements.push(lockRegion);return focusableElements.some(function(focusableElement){return attemptFocus(focusableElement)})},isFocusable=function(focusTarget){if(0<focusTarget.tabIndex||0===focusTarget.tabIndex&&null!==focusTarget.getAttribute("tabIndex")){return!0}if(focusTarget.disabled){return!1}switch(focusTarget.nodeName){case"A":return!!focusTarget.href&&"ignore"!=focusTarget.rel;case"INPUT":return"hidden"!=focusTarget.type&&"file"!=focusTarget.type;case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1;}},attemptFocus=function(focusTarget){if(!isFocusable(focusTarget)){return!1}ignoreFocusChanges=!0;try{focusTarget.focus()}catch(e){}ignoreFocusChanges=!1;return document.activeElement===focusTarget},getCurrentLockRegion=function(){return lockRegionStack[lockRegionStack.length-1]},addLockRegionToStack=function(newLockRegion){if(newLockRegion===getCurrentLockRegion()){return}lockRegionStack.push(newLockRegion);var currentLockRegion=getCurrentLockRegion(),element=document.createElement("div");element.tabIndex=0;element.style.position="fixed";element.style.top=0;element.style.left=0;var initialNode=element.cloneNode();currentLockRegion.parentNode.insertBefore(initialNode,currentLockRegion);initialFocusElementStack.push(initialNode);var finalNode=element.cloneNode();currentLockRegion.parentNode.insertBefore(finalNode,currentLockRegion.nextSibling);finalFocusElementStack.push(finalNode)},removeLastLockRegionFromStack=function(){lockRegionStack.pop();var finalNode=finalFocusElementStack.pop();if(finalNode){finalNode.remove()}var initialNode=initialFocusElementStack.pop();if(initialNode){initialNode.remove()}},hasTrappedRegionsInStack=function(){return!!lockRegionStack.length},trapFocus=function(newLockRegion){addLockRegionToStack(newLockRegion);if(!isLocked){document.addEventListener("focus",lockHandler,!0)}if(!focusFirstDescendant()){var currentLockRegion=getCurrentLockRegion(),originalRegionTabIndex=currentLockRegion.tabIndex;currentLockRegion.tabIndex=0;attemptFocus(currentLockRegion);currentLockRegion.tabIndex=originalRegionTabIndex}lastFocus=document.activeElement;isLocked=!0};_exports.trapFocus=trapFocus;var untrapFocus=function(){removeLastLockRegionFromStack();if(hasTrappedRegionsInStack()){return}document.removeEventListener("focus",lockHandler,!0);lastFocus=null;ignoreFocusChanges=!1;isLocked=!1};_exports.untrapFocus=untrapFocus});
//# sourceMappingURL=focuslock.min.js.map
