define ("core/local/aria/focuslock",["exports","./selectors"],function(_exports,_selectors){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.untrapFocus=_exports.trapFocus=void 0;_selectors=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_selectors);const lockRegionStack=[],initialFocusElementStack=[],finalFocusElementStack=[];let lastFocus=null,ignoreFocusChanges=!1,isLocked=!1;const lockHandler=event=>{if(ignoreFocusChanges){return}const lockRegion=getCurrentLockRegion();if(!lockRegion.parentNode){untrapFocus()}if(lockRegion.contains(event.target)){lastFocus=event.target}else{focusFirstDescendant();if(lastFocus==document.activeElement){focusLastDescendant()}lastFocus=document.activeElement}},focusFirstDescendant=()=>{const lockRegion=getCurrentLockRegion(),focusableElements=Array.from(lockRegion.querySelectorAll(_selectors.default.elements.focusable));focusableElements.unshift(lockRegion);return focusableElements.some(focusableElement=>attemptFocus(focusableElement))},focusLastDescendant=()=>{const lockRegion=getCurrentLockRegion(),focusableElements=Array.from(lockRegion.querySelectorAll(_selectors.default.elements.focusable)).reverse();focusableElements.push(lockRegion);return focusableElements.some(focusableElement=>attemptFocus(focusableElement))},isFocusable=focusTarget=>{if(0<focusTarget.tabIndex||0===focusTarget.tabIndex&&null!==focusTarget.getAttribute("tabIndex")){return!0}if(focusTarget.disabled){return!1}switch(focusTarget.nodeName){case"A":return!!focusTarget.href&&"ignore"!=focusTarget.rel;case"INPUT":return"hidden"!=focusTarget.type&&"file"!=focusTarget.type;case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1;}},attemptFocus=focusTarget=>{if(!isFocusable(focusTarget)){return!1}ignoreFocusChanges=!0;try{focusTarget.focus()}catch(e){}ignoreFocusChanges=!1;return document.activeElement===focusTarget},getCurrentLockRegion=()=>{return lockRegionStack[lockRegionStack.length-1]},addLockRegionToStack=newLockRegion=>{if(newLockRegion===getCurrentLockRegion()){return}lockRegionStack.push(newLockRegion);const currentLockRegion=getCurrentLockRegion(),element=document.createElement("div");element.tabIndex=0;element.style.position="fixed";element.style.top=0;element.style.left=0;const initialNode=element.cloneNode();currentLockRegion.parentNode.insertBefore(initialNode,currentLockRegion);initialFocusElementStack.push(initialNode);const finalNode=element.cloneNode();currentLockRegion.parentNode.insertBefore(finalNode,currentLockRegion.nextSibling);finalFocusElementStack.push(finalNode)},removeLastLockRegionFromStack=()=>{lockRegionStack.pop();const finalNode=finalFocusElementStack.pop();if(finalNode){finalNode.remove()}const initialNode=initialFocusElementStack.pop();if(initialNode){initialNode.remove()}},hasTrappedRegionsInStack=()=>{return!!lockRegionStack.length},trapFocus=newLockRegion=>{addLockRegionToStack(newLockRegion);if(!isLocked){document.addEventListener("focus",lockHandler,!0)}if(!focusFirstDescendant()){const currentLockRegion=getCurrentLockRegion(),originalRegionTabIndex=currentLockRegion.tabIndex;currentLockRegion.tabIndex=0;attemptFocus(currentLockRegion);currentLockRegion.tabIndex=originalRegionTabIndex}lastFocus=document.activeElement;isLocked=!0};_exports.trapFocus=trapFocus;const untrapFocus=()=>{removeLastLockRegionFromStack();if(hasTrappedRegionsInStack()){return}document.removeEventListener("focus",lockHandler,!0);lastFocus=null;ignoreFocusChanges=!1;isLocked=!1};_exports.untrapFocus=untrapFocus});
//# sourceMappingURL=focuslock.min.js.map
