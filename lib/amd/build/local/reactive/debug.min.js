function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define ("core/local/reactive/debug",["exports","core/local/reactive/reactive","core/log"],function(_exports,_reactive,_log){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.initDebug=void 0;_reactive=_interopRequireDefault(_reactive);_log=_interopRequireDefault(_log);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor)n=o.constructor.name;if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){if(null==len||len>arr.length)len=arr.length;for(var i=0,arr2=Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0,descriptor;i<props.length;i++){descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value"in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:!1});return Constructor}function _get(){if("undefined"!=typeof Reflect&&Reflect.get){_get=Reflect.get}else{_get=function(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(3>arguments.length?target:receiver)}return desc.value}}return _get.apply(this,arguments)}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(null===object)break}return object}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}});Object.defineProperty(subClass,"prototype",{writable:!1});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call)){return call}else if(void 0!==call){throw new TypeError("Derived constructors may only return object or undefined")}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(void 0===self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return!0}catch(e){return!1}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var reactiveInstances={},reactiveDebuggers={},Debug=function(_Reactive){_inherits(Debug,_Reactive);var _super=_createSuper(Debug);function Debug(){_classCallCheck(this,Debug);return _super.apply(this,arguments)}_createClass(Debug,[{key:"setInitialState",value:function setInitialState(stateData){_get(_getPrototypeOf(Debug.prototype),"setInitialState",this).call(this,stateData);_log.default.debug("Debug module \"M.reactive\" loaded.")}},{key:"list",get:function get(){return JSON.parse(JSON.stringify(this.state.reactives))}},{key:"registerNewInstance",value:function registerNewInstance(instance){var _instance$name,_this=this,name=null!==(_instance$name=instance.name)&&void 0!==_instance$name?_instance$name:"instance".concat(this.state.reactives.length);name=name.replace(/\W/g,"");_log.default.debug("Registering new reactive instance \"M.reactive.".concat(name,"\""));reactiveInstances[name]=instance;reactiveDebuggers[name]=new DebugInstance(reactiveInstances[name]);this.dispatch("putInstance",name,instance);var refreshMethod=function(){_this.dispatch("putInstance",name,instance)};instance.target.addEventListener("readmode:on",refreshMethod);instance.target.addEventListener("readmode:off",refreshMethod);instance.target.addEventListener("registerComponent:success",refreshMethod);instance.target.addEventListener("transaction:end",refreshMethod);var storeTransaction=function(_ref){var detail=_ref.detail,changes=null===detail||void 0===detail?void 0:detail.changes;_this.dispatch("lastTransaction",name,changes)};instance.target.addEventListener("transaction:start",storeTransaction)}},{key:"debug",value:function debug(name){return reactiveDebuggers[name]}}]);return Debug}(_reactive.default),Mutations=function(){function Mutations(){_classCallCheck(this,Mutations)}_createClass(Mutations,[{key:"putInstance",value:function putInstance(stateManager,name,instance){var state=stateManager.state;stateManager.setReadOnly(!1);if(state.reactives.has(name)){state.reactives.get(name).countcomponents=instance.components.length;state.reactives.get(name).readOnly=instance.stateManager.readonly;state.reactives.get(name).modified=new Date().getTime()}else{state.reactives.add({id:name,countcomponents:instance.components.length,readOnly:instance.stateManager.readonly,lastChanges:[],modified:new Date().getTime()})}stateManager.setReadOnly(!0)}},{key:"lastTransaction",value:function lastTransaction(stateManager,name,changes){if(!changes||0===changes.length){return}var state=stateManager.state,lastChanges=["transaction:start"];changes.forEach(function(change){lastChanges.push(change.eventName)});lastChanges.push("transaction:end");stateManager.setReadOnly(!1);state.reactives.get(name).lastChanges=lastChanges;stateManager.setReadOnly(!0)}}]);return Mutations}(),DebugInstance=function(){function DebugInstance(instance){_classCallCheck(this,DebugInstance);this.instance=instance;if(instance._reactiveDebugData===void 0){instance._reactiveDebugData={highlighted:!1}}}_createClass(DebugInstance,[{key:"readOnly",get:function get(){return this.instance.stateManager.readonly},set:function set(value){this.instance.stateManager.setReadOnly(value)}},{key:"state",get:function get(){return this.instance.state}},{key:"highlight",get:function get(){return this.instance._reactiveDebugData.highlighted},set:function set(value){this.instance._reactiveDebugData.highlighted=value;this.instance.components.forEach(function(_ref2){var element=_ref2.element,border=value?"thick solid #0000FF":"";element.style.border=border})}},{key:"components",get:function get(){return _toConsumableArray(this.instance.components)}},{key:"changes",get:function get(){var result=[];this.instance.stateManager.eventsToPublish.forEach(function(element){result.push(element.eventName)});return result}},{key:"dispatch",value:function(){var _dispatch=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var _this$instance,_args=arguments;return regeneratorRuntime.wrap(function(_context){while(1){switch(_context.prev=_context.next){case 0:(_this$instance=this.instance).dispatch.apply(_this$instance,_args);case 1:case"end":return _context.stop();}}},_callee,this)}));return function dispatch(){return _dispatch.apply(this,arguments)}}()},{key:"elements",get:function get(){var result=[];this.instance.components.forEach(function(_ref3){var element=_ref3.element;result.push(element)});return result}},{key:"stateData",get:function get(){return JSON.parse(JSON.stringify(this.state))}},{key:"processUpdates",value:function processUpdates(updates){this.instance.stateManager.processUpdates(updates)}}]);return DebugInstance}(),stateChangedEventName="core_reactive_debug:stateChanged";function dispatchStateChangedEvent(detail,target){if(target===void 0){target=document}target.dispatchEvent(new CustomEvent(stateChangedEventName,{bubbles:!0,detail:detail}))}_exports.initDebug=function initDebug(){var debug=new Debug({name:"CoreReactiveDebug",eventName:stateChangedEventName,eventDispatch:dispatchStateChangedEvent,mutations:new Mutations,state:{reactives:[]}});reactiveDebuggers.registerNewInstance=debug.registerNewInstance.bind(debug);return{debug:debug,debuggers:reactiveDebuggers}}});
//# sourceMappingURL=debug.min.js.map
