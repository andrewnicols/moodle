{"version":3,"sources":["../../../src/local/itemchooser/mutations.js"],"names":["Mutations","state","name","items","item","stateManager","itemName","wasFavourite","setReadOnly","get","favourite","reactive","results","Array","from","tabData","map","tabConfig","visibilityFunction","getTabVisibilityFunction","visible","filterFunction","getTabFilterFunction","tabItems","values","filter","action","fields","value","length","processUpdates","forEach","tabName","isActive","newTabData","push","setItemVisibilities"],"mappings":"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","sourcesContent":["export default class Mutations {\n    getItemByName(state, name) {\n        for (const item of state.items) {\n            if (item.name === name) {\n                return item;\n            }\n        }\n        return null;\n    }\n\n    /**\n     * The favourite mutation.\n     *\n     * @param {StateManager} stateManager\n     * @param {string} itemName\n     * @param {boolean} wasFavourite\n     */\n    toggleFavourite(stateManager, itemName, wasFavourite) {\n        // TODO Use WS.\n        stateManager.setReadOnly(false);\n        stateManager.state.items.get(itemName).favourite = !wasFavourite;\n        stateManager.setReadOnly(true);\n    }\n\n    setTabVisibilities(stateManager, reactive) {\n        const results = Array.from(stateManager.state.tabData).map(([, tabConfig]) => {\n            const visibilityFunction = reactive.getTabVisibilityFunction(tabConfig.name);\n            if (!visibilityFunction && tabConfig.visible) {\n                return false;\n            }\n\n            const filterFunction = reactive.getTabFilterFunction(tabConfig.name);\n            let tabItems = Array.from(stateManager.state.items.values());\n            if (filterFunction) {\n                tabItems = tabItems.filter(filterFunction);\n            }\n\n            const visible = visibilityFunction({items: tabItems});\n            if (visible === tabConfig.visible) {\n                return false;\n            }\n\n            return {\n                name: 'tabData',\n                action: 'update',\n                fields: {\n                    ...tabConfig,\n                    visible,\n                },\n            };\n        }).filter(value => value);\n\n        if (results.length) {\n            stateManager.processUpdates(results);\n        }\n    }\n\n    selectTab(stateManager, reactive, itemName) {\n        const results = [];\n\n        Array.from(stateManager.state.tabData).forEach(([tabName, tabData]) => {\n            if (tabName === itemName && !tabData.isActive) {\n                const newTabData = {\n                    ...tabData,\n                    isActive: true,\n                };\n                results.push({\n                    name: 'tabData',\n                    action: 'update',\n                    fields: newTabData,\n                });\n\n                results.push(...this.setItemVisibilities(stateManager, reactive, newTabData));\n            } else if (tabData.isActive) {\n                results.push({\n                    name: 'tabData',\n                    action: 'update',\n                    fields: {\n                        ...tabData,\n                        isActive: false,\n                    },\n                });\n            }\n        });\n\n        if (results.length) {\n            stateManager.processUpdates(results);\n        }\n    }\n\n    setItemVisibilities(stateManager, reactive, tabConfig) {\n        const results = Array.from(stateManager.state.items).map(([, item]) => {\n            let visible = true;\n            const filterFunction = reactive.getTabFilterFunction(tabConfig.name);\n            if (filterFunction) {\n                visible = filterFunction(item);\n            }\n\n            if (visible === item.visible) {\n                return false;\n            }\n\n            return {\n                name: 'items',\n                action: 'update',\n                fields: {\n                    ...item,\n                    visible,\n                },\n            };\n        }).filter(value => value);\n\n        return results;\n    }\n}\n"],"file":"mutations.min.js"}