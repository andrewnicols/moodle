{"version":3,"sources":["../../../src/local/itemchooser/mutations.js"],"names":["Mutations","state","name","items","item","stateManager","itemName","wasFavourite","setReadOnly","get","favourite","results","Array","from","tabData","map","tabConfig","visibleFunction","visible","tabItems","values","filterFunction","filter","action","fields","value","length","processUpdates","forEach","tabName","isActive","newTabData","push","setItemVisibilities"],"mappings":"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","sourcesContent":["export default class Mutations {\n    getItemByName(state, name) {\n        for (const item of state.items) {\n            if (item.name === name) {\n                return item;\n            }\n        }\n        return null;\n    }\n\n    /**\n     * The favourite mutation.\n     *\n     * @param {StateManager} stateManager\n     * @param {string} itemName\n     * @param {boolean} wasFavourite\n     */\n    toggleFavourite(stateManager, itemName, wasFavourite) {\n        // TODO Use WS.\n        stateManager.setReadOnly(false);\n        stateManager.state.items.get(itemName).favourite = !wasFavourite;\n        stateManager.setReadOnly(true);\n    }\n\n    setTabVisibilities(stateManager) {\n        const results = Array.from(stateManager.state.tabData).map(([, tabConfig]) => {\n            if (!tabConfig.visibleFunction && tabConfig.visible) {\n                return false;\n            }\n\n            let tabItems = Array.from(stateManager.state.items.values());\n            if (tabConfig.filterFunction) {\n                tabItems = tabItems.filter(tabConfig.filterFunction);\n            }\n\n            const visible = tabConfig.visibleFunction({items: tabItems});\n\n            if (visible === tabConfig.visible) {\n                return false;\n            }\n\n            return {\n                name: 'tabData',\n                action: 'update',\n                fields: {\n                    ...tabConfig,\n                    visible,\n                },\n            };\n        }).filter(value => value);\n\n        if (results.length) {\n            stateManager.processUpdates(results);\n        }\n    }\n\n    selectTab(stateManager, itemName) {\n        const results = [];\n\n        Array.from(stateManager.state.tabData).forEach(([tabName, tabData]) => {\n            if (tabName === itemName && !tabData.isActive) {\n                const newTabData = {\n                    ...tabData,\n                    isActive: true,\n                };\n                results.push({\n                    name: 'tabData',\n                    action: 'update',\n                    fields: newTabData,\n                });\n\n                results.push(...this.setItemVisibilities(stateManager, newTabData));\n            } else if (tabData.isActive) {\n                results.push({\n                    name: 'tabData',\n                    action: 'update',\n                    fields: {\n                        ...tabData,\n                        isActive: false,\n                    },\n                });\n            }\n        });\n\n        if (results.length) {\n            stateManager.processUpdates(results);\n        }\n    }\n\n    setItemVisibilities(stateManager, tabConfig) {\n        const results = Array.from(stateManager.state.items).map(([, item]) => {\n            let visible = true;\n            if (tabConfig.filterFunction) {\n                visible = tabConfig.filterFunction(item);\n            }\n\n            if (visible === item.visible) {\n                return false;\n            }\n\n            return {\n                name: 'items',\n                action: 'update',\n                fields: {\n                    ...item,\n                    visible,\n                },\n            };\n        }).filter(value => value);\n\n        return results;\n    }\n}\n"],"file":"mutations.min.js"}