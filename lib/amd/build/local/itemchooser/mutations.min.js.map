{"version":3,"sources":["../../../src/local/itemchooser/mutations.js"],"names":["Mutations","state","name","items","item","stateManager","itemName","wasFavourite","setReadOnly","get","favourite","reactive","results","Array","from","tabData","map","tabConfig","visibilityFunction","getTabVisibilityFunction","visible","tabItems","values","filterFunction","filter","action","fields","value","length","processUpdates","forEach","tabName","isActive","newTabData","push","setItemVisibilities"],"mappings":"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","sourcesContent":["export default class Mutations {\n    getItemByName(state, name) {\n        for (const item of state.items) {\n            if (item.name === name) {\n                return item;\n            }\n        }\n        return null;\n    }\n\n    /**\n     * The favourite mutation.\n     *\n     * @param {StateManager} stateManager\n     * @param {string} itemName\n     * @param {boolean} wasFavourite\n     */\n    toggleFavourite(stateManager, itemName, wasFavourite) {\n        // TODO Use WS.\n        stateManager.setReadOnly(false);\n        stateManager.state.items.get(itemName).favourite = !wasFavourite;\n        stateManager.setReadOnly(true);\n    }\n\n    setTabVisibilities(stateManager, reactive) {\n        const results = Array.from(stateManager.state.tabData).map(([, tabConfig]) => {\n            const visibilityFunction = reactive.getTabVisibilityFunction(tabConfig.name);\n            if (!visibilityFunction && tabConfig.visible) {\n                return false;\n            }\n\n            let tabItems = Array.from(stateManager.state.items.values());\n            if (tabConfig.filterFunction) {\n                tabItems = tabItems.filter(tabConfig.filterFunction);\n            }\n\n            const visible = visibilityFunction({items: tabItems});\n            if (visible === tabConfig.visible) {\n                return false;\n            }\n\n            return {\n                name: 'tabData',\n                action: 'update',\n                fields: {\n                    ...tabConfig,\n                    visible,\n                },\n            };\n        }).filter(value => value);\n\n        if (results.length) {\n            stateManager.processUpdates(results);\n        }\n    }\n\n    selectTab(stateManager, itemName) {\n        const results = [];\n\n        Array.from(stateManager.state.tabData).forEach(([tabName, tabData]) => {\n            if (tabName === itemName && !tabData.isActive) {\n                const newTabData = {\n                    ...tabData,\n                    isActive: true,\n                };\n                results.push({\n                    name: 'tabData',\n                    action: 'update',\n                    fields: newTabData,\n                });\n\n                results.push(...this.setItemVisibilities(stateManager, newTabData));\n            } else if (tabData.isActive) {\n                results.push({\n                    name: 'tabData',\n                    action: 'update',\n                    fields: {\n                        ...tabData,\n                        isActive: false,\n                    },\n                });\n            }\n        });\n\n        if (results.length) {\n            stateManager.processUpdates(results);\n        }\n    }\n\n    setItemVisibilities(stateManager, tabConfig) {\n        const results = Array.from(stateManager.state.items).map(([, item]) => {\n            let visible = true;\n            if (tabConfig.filterFunction) {\n                visible = tabConfig.filterFunction(item);\n            }\n\n            if (visible === item.visible) {\n                return false;\n            }\n\n            return {\n                name: 'items',\n                action: 'update',\n                fields: {\n                    ...item,\n                    visible,\n                },\n            };\n        }).filter(value => value);\n\n        return results;\n    }\n}\n"],"file":"mutations.min.js"}