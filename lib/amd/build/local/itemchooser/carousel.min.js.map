{"version":3,"sources":["../../../src/local/itemchooser/carousel.js"],"names":["name","selectors","item","getElement","carousel","interval","pause","keyboard","addEventListener","_handleResponse","watch","handler","_refreshVisibility","e","backButton","target","closest","preventDefault","reactive","dispatch","element","id","isActive","showModuleHelp","moduleData","modal","help","showFooter","setFooter","Templates","render","innerHTML","classList","add","spinnerPromise","transitionPromiseResolver","transitionPromise","Promise","resolve","contentPromise","renderForPromise","Object","assign","all","then","html","js","replaceNodeContents","querySelector","focus","catch","Notification","exception","one","BaseComponent"],"mappings":"sNAuBA,OAGA,uD,4vGAGa,CACL,KAAKA,IAAL,CAAY,UAAZ,CAEA,KAAKC,SAAL,CAAiB,CACbC,IAAI,CAAE,gBADO,CAGpB,C,+CAEY,CACT,cAAO,KAAKC,UAAL,EAAP,EAA0BC,QAA1B,CAAmC,CAC/BC,QAAQ,GADuB,CAE/BC,KAAK,GAF0B,CAG/BC,QAAQ,GAHuB,CAAnC,EAKA,KAAKC,gBAAL,CACI,KAAKL,UAAL,EADJ,CAEI,OAFJ,CAGI,KAAKM,eAHT,CAKH,C,iDAEa,CACV,MAAO,CAAC,CACJC,KAAK,CAAE,kBADH,CAEJC,OAAO,CAAE,KAAKC,kBAFV,CAAD,CAIV,C,wDAEeC,C,CAAG,CACf,GAAMC,CAAAA,CAAU,CAAGD,CAAC,CAACE,MAAF,CAASC,OAAT,CAAiB,gDAAjB,CAAnB,CACA,GAAIF,CAAJ,CAAgB,CACZD,CAAC,CAACI,cAAF,GACA,KAAKC,QAAL,CAAcC,QAAd,CAAuB,UAAvB,CAAmC,OAAnC,CACH,CACJ,C,gEAE6B,IAAVC,CAAAA,CAAU,GAAVA,OAAU,CAEpBhB,CAAQ,CAAG,cAAO,KAAKD,UAAL,EAAP,CAFS,CAI1B,GAAmB,MAAf,GAAAiB,CAAO,CAACC,EAAR,EAAyBD,CAAO,CAACE,QAArC,CAA+C,CAC3C,KAAKC,cAAL,CAAoBH,CAAO,CAAClB,IAA5B,EACAE,CAAQ,CAACA,QAAT,CAAkB,MAAlB,CACH,CAHD,IAGO,IAAIgB,CAAO,CAACE,QAAZ,CAAsB,CACzBlB,CAAQ,CAACA,QAAT,CAAkB,MAAlB,CACH,CAGJ,C,sDAEcoB,C,CAA0B,IAAdC,CAAAA,CAAc,wDAAN,IAAM,CAC/BC,CAAI,CAAG,KAAKvB,UAAL,CAAgB,KAAKF,SAAL,CAAeC,IAA/B,CAAqC,MAArC,CADwB,CAIrC,GAAc,IAAV,GAAAuB,CAAK,EAAa,KAAAD,CAAU,CAACG,UAAjC,CAAsD,CAClDF,CAAK,CAACG,SAAN,CAAgBC,CAAS,CAACC,MAAV,CAAiB,kDAAjB,CAAqEN,CAArE,CAAhB,CACH,CAEDE,CAAI,CAACK,SAAL,CAAiB,EAAjB,CACAL,CAAI,CAACM,SAAL,CAAeC,GAAf,CAAmB,QAAnB,EATqC,GAY/BC,CAAAA,CAAc,CAAG,yBAAmBR,CAAnB,CAZc,CAejCS,CAAyB,CAAG,IAfK,CAgB/BC,CAAiB,CAAG,GAAIC,CAAAA,OAAJ,CAAY,SAAAC,CAAO,CAAI,CAC7CH,CAAyB,CAAGG,CAC/B,CAFyB,CAhBW,CAqB/BC,CAAc,CAAGV,CAAS,CAACW,gBAAV,CACnB,wCADmB,CAEnBC,MAAM,CAACC,MAAP,CAAc,EAAd,CAAkBlB,CAAlB,CAFmB,CArBc,CA2BrCa,OAAO,CAACM,GAAR,CAAY,CAACJ,CAAD,CAAiBL,CAAjB,CAAiCE,CAAjC,CAAZ,EACCQ,IADD,CACM,gCAAGC,CAAH,GAAGA,IAAH,CAASC,CAAT,GAASA,EAAT,OAAkBjB,CAAAA,CAAS,CAACkB,mBAAV,CAA8BrB,CAA9B,CAAoCmB,CAApC,CAA0CC,CAA1C,CAAlB,CADN,EAECF,IAFD,CAEM,UAAM,CAERlB,CAAI,CAACsB,aAAL,CAAmB,kCAAnB,EAAqDC,KAArD,EAEH,CAND,EAOCC,KAPD,CAOOC,YAAY,CAACC,SAPpB,EAUA,GAAMhD,CAAAA,CAAQ,CAAG,cAAO,KAAKD,UAAL,EAAP,CAAjB,CACAC,CAAQ,CAACiD,GAAT,CAAa,kBAAb,CAAiC,UAAM,CACnClB,CAAyB,EAC5B,CAFD,CAGH,C,cA5FwBmB,e","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A tab containing a set of items.\n *\n * @module     core/local/itemchooser/carousel\n * @copyright  2021 Andrew Lyons <andrew@nicols.co.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as Templates from 'core/templates';\nimport {BaseComponent} from 'core/reactive';\nimport {addIconToContainer} from 'core/loadingicon';\nimport jQuery from 'jquery';\n\nexport default class extends BaseComponent {\n    create() {\n        this.name = 'carousel';\n\n        this.selectors = {\n            item: '.carousel-item',\n        };\n    }\n\n    stateReady() {\n        jQuery(this.getElement()).carousel({\n            interval: false,\n            pause: true,\n            keyboard: false,\n        });\n        this.addEventListener(\n            this.getElement(),\n            'click',\n            this._handleResponse,\n        );\n    }\n\n    getWatchers() {\n        return [{\n            watch: 'carousel:updated',\n            handler: this._refreshVisibility,\n        }];\n    }\n\n    _handleResponse(e) {\n        const backButton = e.target.closest('[data-action=\"close-chooser-option-summary\"]');\n        if (backButton) {\n            e.preventDefault();\n            this.reactive.dispatch('setPanel', 'items');\n        }\n    }\n\n    _refreshVisibility({element}) {\n        // Move to the next slide, and resolve the transition promise when it's done.\n        const carousel = jQuery(this.getElement());\n\n        if (element.id === 'help' && element.isActive) {\n            this.showModuleHelp(element.item);\n            carousel.carousel('next');\n        } else if (element.isActive) {\n            carousel.carousel('prev');\n        }\n\n        return;\n    }\n\n    showModuleHelp(moduleData, modal = null) {\n        const help = this.getElement(this.selectors.item, 'help');\n\n        // If we have a real footer then we need to change temporarily.\n        if (modal !== null && moduleData.showFooter === true) {\n            modal.setFooter(Templates.render('core_course/local/activitychooser/footer_partial', moduleData));\n        }\n\n        help.innerHTML = '';\n        help.classList.add('m-auto');\n\n        // Add a spinner.\n        const spinnerPromise = addIconToContainer(help);\n\n        // Used later...\n        let transitionPromiseResolver = null;\n        const transitionPromise = new Promise(resolve => {\n            transitionPromiseResolver = resolve;\n        });\n\n        // Build up the html & js ready to place into the help section.\n        const contentPromise = Templates.renderForPromise(\n            'core_course/local/activitychooser/help',\n            Object.assign({}, moduleData)\n        );\n\n        // Wait for the content to be ready, and for the transition to be complet.\n        Promise.all([contentPromise, spinnerPromise, transitionPromise])\n        .then(([{html, js}]) => Templates.replaceNodeContents(help, html, js))\n        .then(() => {\n            // TODO\n            help.querySelector('[data-region=\"summary-header\"]').focus();\n            return;\n        })\n        .catch(Notification.exception);\n\n        // Move to the next slide, and resolve the transition promise when it's done.\n        const carousel = jQuery(this.getElement());\n        carousel.one('slid.bs.carousel', () => {\n            transitionPromiseResolver();\n        });\n    }\n}\n"],"file":"carousel.min.js"}