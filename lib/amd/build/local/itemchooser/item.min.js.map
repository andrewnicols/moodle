{"version":3,"sources":["../../../src/local/itemchooser/item.js"],"names":["Item","name","selectors","favourite","items","addEventListener","getElement","_toggleFavourite","dataset","itemName","target","closest","e","favouriteButton","isFavouriteButton","preventDefault","wasFavourite","favourited","reactive","dispatch","getItemName","watch","handler","_refreshItem","element","state","id","targetState","get","_updateFavouriteState","_updateVisibility","querySelector","icon","classList","add","remove","ariaPressed","visible","BaseComponent"],"mappings":"8xDAyBqBA,CAAAA,C,+HACR,CACL,KAAKC,IAAL,CAAY,MAAZ,CAEA,KAAKC,SAAL,CAAiB,CACbC,SAAS,CAAE,6BADE,CAGbC,KAAK,CAAE,qBAHM,CAKpB,C,+CAEY,CACT,KAAKC,gBAAL,CACI,KAAKC,UAAL,EADJ,CAEI,OAFJ,CAGI,KAAKC,gBAHT,CAKH,C,iDAEa,CACV,MAAO,MAAKD,UAAL,GAAkBE,OAAlB,CAA0BC,QACpC,C,4DAEiBC,C,CAAQ,CACtB,MAAOA,CAAAA,CAAM,CAACC,OAAP,CAAe,KAAKT,SAAL,CAAeC,SAA9B,CACV,C,0DAKgBS,C,CAAG,CAChB,GAAMC,CAAAA,CAAe,CAAG,KAAKC,iBAAL,CAAuBF,CAAC,CAACF,MAAzB,CAAxB,CACA,GAAIG,CAAJ,CAAqB,CACjBD,CAAC,CAACG,cAAF,GAEA,GAAMC,CAAAA,CAAY,CAA0C,MAAvC,GAAAH,CAAe,CAACL,OAAhB,CAAwBS,UAA7C,CACA,KAAKC,QAAL,CAAcC,QAAd,CACI,iBADJ,CAEI,KAAKC,WAAL,EAFJ,CAGIJ,CAHJ,CAKH,CACJ,C,iDAEa,CACV,MAAO,CACH,CACIK,KAAK,CAAE,eADX,CAEIC,OAAO,CAAE,KAAKC,YAFlB,CADG,CAMV,C,oDAE8B,IAAjBC,CAAAA,CAAiB,GAAjBA,OAAiB,CAARC,CAAQ,GAARA,KAAQ,CAErBf,CAAM,CAAG,KAAKJ,UAAL,EAFY,CAG3B,GAAII,CAAM,CAACF,OAAP,CAAekB,EAAf,GAAsBF,CAAO,CAACE,EAAlC,CAAsC,CAClC,MACH,CAED,GAAMC,CAAAA,CAAW,CAAGF,CAAK,CAACrB,KAAN,CAAYwB,GAAZ,CAAgBJ,CAAO,CAACE,EAAxB,CAApB,CAEA,KAAKG,qBAAL,CAA2BF,CAA3B,CAAwCjB,CAAxC,EACA,KAAKoB,iBAAL,CAAuBH,CAAvB,CAAoCjB,CAApC,CACH,C,oEAEqBiB,C,CAAajB,C,CAAQ,IACjCG,CAAAA,CAAe,CAAGH,CAAM,CAACqB,aAAP,CAAqB,KAAK7B,SAAL,CAAeC,SAApC,CADe,CAEjC6B,CAAI,CAAGnB,CAAe,CAACkB,aAAhB,KAF0B,CAGvC,GAAIJ,CAAW,CAACxB,SAAhB,CAA2B,CAEvB6B,CAAI,CAACC,SAAL,CAAeC,GAAf,CAAmB,SAAnB,EACAF,CAAI,CAACC,SAAL,CAAeE,MAAf,CAAsB,WAAtB,EACAtB,CAAe,CAACoB,SAAhB,CAA0BC,GAA1B,CAA8B,cAA9B,EACArB,CAAe,CAACoB,SAAhB,CAA0BE,MAA1B,CAAiC,YAAjC,EACAtB,CAAe,CAACL,OAAhB,CAAwBS,UAAxB,IACAJ,CAAe,CAACuB,WAAhB,GACH,CARD,IAQO,CACHJ,CAAI,CAACC,SAAL,CAAeE,MAAf,CAAsB,SAAtB,EACAH,CAAI,CAACC,SAAL,CAAeC,GAAf,CAAmB,WAAnB,EACArB,CAAe,CAACoB,SAAhB,CAA0BC,GAA1B,CAA8B,YAA9B,EACArB,CAAe,CAACoB,SAAhB,CAA0BE,MAA1B,CAAiC,cAAjC,EACAtB,CAAe,CAACL,OAAhB,CAAwBS,UAAxB,IACAJ,CAAe,CAACuB,WAAhB,GACH,CACJ,C,4DAEiBT,C,CAAajB,C,CAAQ,CACnC,GAAIiB,CAAW,CAACU,OAAhB,CAAyB,CACrB3B,CAAM,CAACuB,SAAP,CAAiBE,MAAjB,CAAwB,QAAxB,CACH,CAFD,IAEO,CACHzB,CAAM,CAACuB,SAAP,CAAiBC,GAAjB,CAAqB,QAArB,CACH,CACJ,C,cA7F6BI,e","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * An individual item.\n *\n * @module     core_course/local/modchooser/item\n * @copyright  2021 Andrew Lyons <andrew@nicols.co.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {BaseComponent} from 'core/reactive';\n\nexport default class Item extends BaseComponent {\n    create() {\n        this.name = 'item';\n\n        this.selectors = {\n            favourite: '[data-toggle=\"favourite\"]',\n            // TODO Fix this to not use menuitem.\n            items: '[role=\"menuitem\"]',\n        };\n    }\n\n    stateReady() {\n        this.addEventListener(\n            this.getElement(),\n            'click',\n            this._toggleFavourite,\n        );\n    }\n\n    getItemName() {\n        return this.getElement().dataset.itemName;\n    }\n\n    isFavouriteButton(target) {\n        return target.closest(this.selectors.favourite);\n    }\n\n    /**\n     * @param {Event} e The click event\n     */\n    _toggleFavourite(e) {\n        const favouriteButton = this.isFavouriteButton(e.target);\n        if (favouriteButton) {\n            e.preventDefault();\n\n            const wasFavourite = favouriteButton.dataset.favourited === 'true';\n            this.reactive.dispatch(\n                'toggleFavourite',\n                this.getItemName(),\n                wasFavourite,\n            );\n        }\n    }\n\n    getWatchers() {\n        return [\n            {\n                watch: 'items:updated',\n                handler: this._refreshItem,\n            },\n        ];\n    }\n\n    _refreshItem({element, state}) {\n        // There must be a better way of doing this!\n        const target = this.getElement();\n        if (target.dataset.id !== element.id) {\n            return;\n        }\n\n        const targetState = state.items.get(element.id);\n\n        this._updateFavouriteState(targetState, target);\n        this._updateVisibility(targetState, target);\n    }\n\n    _updateFavouriteState(targetState, target) {\n        const favouriteButton = target.querySelector(this.selectors.favourite);\n        const icon = favouriteButton.querySelector(`i`);\n        if (targetState.favourite) {\n            // TODO Fix this because it's minging.\n            icon.classList.add('fa-star');\n            icon.classList.remove('fa-star-o');\n            favouriteButton.classList.add('text-primary');\n            favouriteButton.classList.remove('text-muted');\n            favouriteButton.dataset.favourited = true;\n            favouriteButton.ariaPressed = true;\n        } else {\n            icon.classList.remove('fa-star');\n            icon.classList.add('fa-star-o');\n            favouriteButton.classList.add('text-muted');\n            favouriteButton.classList.remove('text-primary');\n            favouriteButton.dataset.favourited = false;\n            favouriteButton.ariaPressed = false;\n        }\n    }\n\n    _updateVisibility(targetState, target) {\n        if (targetState.visible) {\n            target.classList.remove('d-none');\n        } else {\n            target.classList.add('d-none');\n        }\n    }\n}\n"],"file":"item.min.js"}