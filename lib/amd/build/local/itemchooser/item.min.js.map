{"version":3,"sources":["../../../src/local/itemchooser/item.js"],"names":["Item","name","selectors","favourite","items","addLink","helpButton","id","element","dataset","addEventListener","getElement","_handleResponse","e","itemName","getItemName","addButton","getAddButton","target","reactive","handleItemSelection","preventDefault","favouriteButton","getFavouriteButton","dispatch","getHelpButton","closest","watch","handler","_refreshItem","_updateFavouriteState","_updateVisibility","targetState","querySelector","icon","classList","toggle","favourited","ariaPressed","visible","BaseComponent"],"mappings":"8xDAyBqBA,CAAAA,C,+HACR,CACL,KAAKC,IAAL,CAAY,MAAZ,CAEA,KAAKC,SAAL,CAAiB,CACbC,SAAS,CAAE,6BADE,CAIbC,KAAK,CAAE,qBAJM,CAObC,OAAO,CAAE,sCAPI,CASbC,UAAU,CAAE,uCATC,CAAjB,CAYA,KAAKC,EAAL,CAAU,KAAKC,OAAL,CAAaC,OAAb,CAAqBF,EAClC,C,+CAEY,CACT,KAAKG,gBAAL,CACI,KAAKC,UAAL,EADJ,CAEI,OAFJ,CAGI,KAAKC,eAHT,CAKH,C,wDAEeC,C,CAAG,IACTC,CAAAA,CAAQ,CAAG,KAAKC,WAAL,EADF,CAGTC,CAAS,CAAG,KAAKC,YAAL,CAAkBJ,CAAC,CAACK,MAApB,CAHH,CAIf,GAAIF,CAAJ,CAAe,CACX,KAAKG,QAAL,CAAcC,mBAAd,CAAkCN,CAAlC,EACAD,CAAC,CAACQ,cAAF,GACA,MACH,CAED,GAAMC,CAAAA,CAAe,CAAG,KAAKC,kBAAL,CAAwBV,CAAC,CAACK,MAA1B,CAAxB,CACA,GAAII,CAAJ,CAAqB,CACjB,KAAKH,QAAL,CAAcK,QAAd,CAAuB,iBAAvB,CAA0CV,CAA1C,EACAD,CAAC,CAACQ,cAAF,GACA,MACH,CAED,GAAMf,CAAAA,CAAU,CAAG,KAAKmB,aAAL,CAAmBZ,CAAC,CAACK,MAArB,CAAnB,CACA,GAAIZ,CAAJ,CAAgB,CACZ,KAAKa,QAAL,CAAcK,QAAd,CAAuB,UAAvB,CAAmC,MAAnC,CAA2CV,CAA3C,EACAD,CAAC,CAACQ,cAAF,EAEH,CACJ,C,iDAEa,CACV,MAAO,MAAKV,UAAL,GAAkBF,OAAlB,CAA0BK,QACpC,C,8DAEkBI,C,CAAQ,CACvB,MAAOA,CAAAA,CAAM,CAACQ,OAAP,CAAe,KAAKxB,SAAL,CAAeC,SAA9B,CACV,C,kDAEYe,C,CAAQ,CACjB,MAAOA,CAAAA,CAAM,CAACQ,OAAP,CAAe,KAAKxB,SAAL,CAAeG,OAA9B,CACV,C,oDAEaa,C,CAAQ,CAClB,MAAOA,CAAAA,CAAM,CAACQ,OAAP,CAAe,KAAKxB,SAAL,CAAeI,UAA9B,CACV,C,iDAEa,CACV,MAAO,CACH,CACIqB,KAAK,iBAAW,KAAKpB,EAAhB,aADT,CAEIqB,OAAO,CAAE,KAAKC,YAFlB,CADG,CAMV,C,oDAEuB,IAAVrB,CAAAA,CAAU,GAAVA,OAAU,CAEdU,CAAM,CAAG,KAAKP,UAAL,EAFK,CAIpB,KAAKmB,qBAAL,CAA2BtB,CAA3B,CAAoCU,CAApC,EACA,KAAKa,iBAAL,CAAuBvB,CAAvB,CAAgCU,CAAhC,CACH,C,oEAEqBc,C,CAAad,C,CAAQ,IACjCI,CAAAA,CAAe,CAAGJ,CAAM,CAACe,aAAP,CAAqB,KAAK/B,SAAL,CAAeC,SAApC,CADe,CAEjC+B,CAAI,CAAGZ,CAAe,CAACW,aAAhB,KAF0B,CAIvCC,CAAI,CAACC,SAAL,CAAeC,MAAf,CAAsB,SAAtB,CAAiCJ,CAAW,CAAC7B,SAA7C,EACA+B,CAAI,CAACC,SAAL,CAAeC,MAAf,CAAsB,WAAtB,CAAmC,CAACJ,CAAW,CAAC7B,SAAhD,EACAmB,CAAe,CAACa,SAAhB,CAA0BC,MAA1B,CAAiC,cAAjC,CAAiDJ,CAAW,CAAC7B,SAA7D,EACAmB,CAAe,CAACa,SAAhB,CAA0BC,MAA1B,CAAiC,YAAjC,CAA+C,CAACJ,CAAW,CAAC7B,SAA5D,EACAmB,CAAe,CAACb,OAAhB,CAAwB4B,UAAxB,CAAqCL,CAAW,CAAC7B,SAAjD,CACAmB,CAAe,CAACgB,WAAhB,CAA8BN,CAAW,CAAC7B,SAC7C,C,4DAEiB6B,C,CAAad,C,CAAQ,CACnCA,CAAM,CAACiB,SAAP,CAAiBC,MAAjB,CAAwB,QAAxB,CAAkC,CAACJ,CAAW,CAACO,OAA/C,CACH,C,cAnG6BC,e","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * An individual item.\n *\n * @module     core/local/itemchooser/item\n * @copyright  2021 Andrew Lyons <andrew@nicols.co.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {BaseComponent} from 'core/reactive';\n\nexport default class Item extends BaseComponent {\n    create() {\n        this.name = 'item';\n\n        this.selectors = {\n            favourite: '[data-toggle=\"favourite\"]',\n\n            // TODO Fix this to not use menuitem.\n            items: '[role=\"menuitem\"]',\n\n            // TODO Rename chooser to itemchooser.\n            addLink: '[data-action=\"add-chooser-option\"]',\n\n            helpButton: '[data-action=\"show-option-summary\"]',\n        };\n\n        this.id = this.element.dataset.id;\n    }\n\n    stateReady() {\n        this.addEventListener(\n            this.getElement(),\n            'click',\n            this._handleResponse,\n        );\n    }\n\n    _handleResponse(e) {\n        const itemName = this.getItemName();\n\n        const addButton = this.getAddButton(e.target);\n        if (addButton) {\n            this.reactive.handleItemSelection(itemName);\n            e.preventDefault();\n            return;\n        }\n\n        const favouriteButton = this.getFavouriteButton(e.target);\n        if (favouriteButton) {\n            this.reactive.dispatch('toggleFavourite', itemName);\n            e.preventDefault();\n            return;\n        }\n\n        const helpButton = this.getHelpButton(e.target);\n        if (helpButton) {\n            this.reactive.dispatch('setPanel', 'help', itemName);\n            e.preventDefault();\n            return;\n        }\n    }\n\n    getItemName() {\n        return this.getElement().dataset.itemName;\n    }\n\n    getFavouriteButton(target) {\n        return target.closest(this.selectors.favourite);\n    }\n\n    getAddButton(target) {\n        return target.closest(this.selectors.addLink);\n    }\n\n    getHelpButton(target) {\n        return target.closest(this.selectors.helpButton);\n    }\n\n    getWatchers() {\n        return [\n            {\n                watch: `items[${this.id}]:updated`,\n                handler: this._refreshItem,\n            },\n        ];\n    }\n\n    _refreshItem({element}) {\n        // There must be a better way of doing this!\n        const target = this.getElement();\n\n        this._updateFavouriteState(element, target);\n        this._updateVisibility(element, target);\n    }\n\n    _updateFavouriteState(targetState, target) {\n        const favouriteButton = target.querySelector(this.selectors.favourite);\n        const icon = favouriteButton.querySelector(`i`);\n\n        icon.classList.toggle('fa-star', targetState.favourite);\n        icon.classList.toggle('fa-star-o', !targetState.favourite);\n        favouriteButton.classList.toggle('text-primary', targetState.favourite);\n        favouriteButton.classList.toggle('text-muted', !targetState.favourite);\n        favouriteButton.dataset.favourited = targetState.favourite;\n        favouriteButton.ariaPressed = targetState.favourite;\n    }\n\n    _updateVisibility(targetState, target) {\n        target.classList.toggle('d-none', !targetState.visible);\n    }\n}\n"],"file":"item.min.js"}