{"version":3,"sources":["../src/tree.js"],"names":["define","$","SELECTORS","ITEM","GROUP","CLOSED_GROUP","FIRST_ITEM","VISIBLE_ITEM","UNLOADED_AJAX_ITEM","Tree","selector","selectCallback","treeRoot","data","keys","tab","enter","space","pageup","pagedown","end","home","left","up","right","down","asterisk","initialiseNodes","setActiveItem","find","refreshVisibleItemsCache","bindEventHandlers","prototype","registerEnterCallback","callback","enterCallback","getVisibleItems","item","currentActive","closest","length","focusOnParentUnhidden","attr","isGroupItem","is","getGroupFromItem","ariaowns","plain","children","isGroupCollapsed","isGroupCollapsible","node","removeAllFromTabOrder","setAriaSelectedFalseOnItems","thisTree","each","unloadedNode","collapseGroup","expandGroup","expandAllGroups","groupNode","done","expandAllChildGroups","promise","Deferred","moduleName","p","addClass","require","loader","load","finishExpandingGroup","removeClass","resolve","group","removeAttr","toggleGroup","handleKeyDown","e","target","currentIndex","index","altKey","ctrlKey","metaKey","shiftKey","keyCode","first","focus","preventDefault","last","links","not","triggerHandler","window","location","href","firstLink","focusParent","tree","filter","has","prev","eq","next","handleClick","currentTarget","handleFocus","on","click","bind","keydown","hiddenParent","get","hiddenParentObserver","MutationObserver","mutationList","forEach","disconnect","observe","attributes","attributeFilter"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Implement an accessible aria tree widget, from a nested unordered list.\n * Based on http://oaa-accessibility.org/example/41/.\n *\n * @module     core/tree\n * @copyright  2015 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery'], function($) {\n    // Private variables and functions.\n    var SELECTORS = {\n        ITEM: '[role=treeitem]',\n        GROUP: '[role=treeitem]:has([role=group]), [role=treeitem][aria-owns], [role=treeitem][data-requires-ajax=true]',\n        CLOSED_GROUP: '[role=treeitem]:has([role=group])[aria-expanded=false], [role=treeitem][aria-owns][aria-expanded=false], ' +\n                 '[role=treeitem][data-requires-ajax=true][aria-expanded=false]',\n        FIRST_ITEM: '[role=treeitem]:first',\n        VISIBLE_ITEM: '[role=treeitem]:visible',\n        UNLOADED_AJAX_ITEM: '[role=treeitem][data-requires-ajax=true][data-loaded=false][aria-expanded=true]'\n    };\n\n    /**\n     * Constructor.\n     *\n     * @param {String} selector\n     * @param {function} selectCallback Called when the active node is changed.\n     */\n    var Tree = function(selector, selectCallback) {\n        this.treeRoot = $(selector);\n\n        this.treeRoot.data('activeItem', null);\n        this.selectCallback = selectCallback;\n        this.keys = {\n            tab:      9,\n            enter:    13,\n            space:    32,\n            pageup:   33,\n            pagedown: 34,\n            end:      35,\n            home:     36,\n            left:     37,\n            up:       38,\n            right:    39,\n            down:     40,\n            asterisk: 106\n        };\n\n        // Apply the standard default initialisation for all nodes, starting with the tree root.\n        this.initialiseNodes(this.treeRoot);\n        // Make the first item the active item for the tree so that it is added to the tab order.\n        this.setActiveItem(this.treeRoot.find(SELECTORS.FIRST_ITEM));\n        // Create the cache of the visible items.\n        this.refreshVisibleItemsCache();\n        // Create the event handlers for the tree.\n        this.bindEventHandlers();\n    };\n\n    Tree.prototype.registerEnterCallback = function(callback) {\n        this.enterCallback = callback;\n    };\n\n    /**\n     * Find all visible tree items and save a cache of them on the tree object.\n     *\n     * @method refreshVisibleItemsCache\n     */\n    Tree.prototype.refreshVisibleItemsCache = function() {\n        this.treeRoot.data('visibleItems', this.treeRoot.find(SELECTORS.VISIBLE_ITEM));\n    };\n\n    /**\n     * Get all visible tree items.\n     *\n     * @method getVisibleItems\n     * @return {Object} visible items\n     */\n    Tree.prototype.getVisibleItems = function() {\n        return this.treeRoot.data('visibleItems');\n    };\n\n    /**\n     * Mark the given item as active within the tree and fire the callback for when the active item is set.\n     *\n     * @method setActiveItem\n     * @param {object} item jquery object representing an item on the tree.\n     */\n    Tree.prototype.setActiveItem = function(item) {\n        var currentActive = this.treeRoot.data('activeItem');\n        if (item === currentActive) {\n            return;\n        }\n\n        if (this.treeRoot.closest('[aria-hidden]').length) {\n            this.focusOnParentUnhidden(item);\n            return;\n        }\n\n        // Remove previous active from tab order.\n        if (currentActive) {\n            currentActive.attr('tabindex', '-1');\n            currentActive.attr('aria-selected', 'false');\n        }\n\n        item.attr('tabindex', '0');\n        item.attr('aria-selected', 'true');\n\n        // Set the new active item.\n        this.treeRoot.data('activeItem', item);\n\n        if (typeof this.selectCallback === 'function') {\n            this.selectCallback(item);\n        }\n    };\n\n    /**\n     * Determines if the given item is a group item (contains child tree items) in the tree.\n     *\n     * @method isGroupItem\n     * @param {object} item jquery object representing an item on the tree.\n     * @returns {bool}\n     */\n    Tree.prototype.isGroupItem = function(item) {\n        return item.is(SELECTORS.GROUP);\n    };\n\n    /**\n     * Determines if the given item is a group item (contains child tree items) in the tree.\n     *\n     * @method isGroupItem\n     * @param {object} item jquery object representing an item on the tree.\n     * @returns {bool}\n     */\n    Tree.prototype.getGroupFromItem = function(item) {\n        var ariaowns = this.treeRoot.find('#' + item.attr('aria-owns'));\n        var plain = item.children('[role=group]');\n        if (ariaowns.length > plain.length) {\n            return ariaowns;\n        } else {\n            return plain;\n        }\n    };\n\n    /**\n     * Determines if the given group item (contains child tree items) is collapsed.\n     *\n     * @method isGroupCollapsed\n     * @param {object} item jquery object representing a group item on the tree.\n     * @returns {bool}\n     */\n    Tree.prototype.isGroupCollapsed = function(item) {\n        return item.attr('aria-expanded') === 'false';\n    };\n\n    /**\n     * Determines if the given group item (contains child tree items) can be collapsed.\n     *\n     * @method isGroupCollapsible\n     * @param {object} item jquery object representing a group item on the tree.\n     * @returns {bool}\n     */\n    Tree.prototype.isGroupCollapsible = function(item) {\n        return item.attr('data-collapsible') !== 'false';\n    };\n\n    /**\n     * Performs the tree initialisation for all child items from the given node,\n     * such as removing everything from the tab order and setting aria selected\n     * on items.\n     *\n     * @method initialiseNodes\n     * @param {object} node jquery object representing a node.\n     */\n    Tree.prototype.initialiseNodes = function(node) {\n        this.removeAllFromTabOrder(node);\n        this.setAriaSelectedFalseOnItems(node);\n\n        // Get all ajax nodes that have been rendered as expanded but haven't loaded the child items yet.\n        var thisTree = this;\n        node.find(SELECTORS.UNLOADED_AJAX_ITEM).each(function() {\n            var unloadedNode = $(this);\n            // Collapse and then expand to trigger the ajax loading.\n            thisTree.collapseGroup(unloadedNode);\n            thisTree.expandGroup(unloadedNode);\n        });\n    };\n\n    /**\n     * Removes all child DOM elements of the given node from the tab order.\n     *\n     * @method removeAllFromTabOrder\n     * @param {object} node jquery object representing a node.\n     */\n    Tree.prototype.removeAllFromTabOrder = function(node) {\n        node.find('*').attr('tabindex', '-1');\n        this.getGroupFromItem($(node)).find('*').attr('tabindex', '-1');\n    };\n\n    /**\n     * Find all child tree items from the given node and set the aria selected attribute to false.\n     *\n     * @method setAriaSelectedFalseOnItems\n     * @param {object} node jquery object representing a node.\n     */\n    Tree.prototype.setAriaSelectedFalseOnItems = function(node) {\n        node.find(SELECTORS.ITEM).attr('aria-selected', 'false');\n    };\n\n    /**\n     * Expand all group nodes within the tree.\n     *\n     * @method expandAllGroups\n     */\n    Tree.prototype.expandAllGroups = function() {\n        var thisTree = this;\n\n        this.treeRoot.find(SELECTORS.CLOSED_GROUP).each(function() {\n            var groupNode = $(this);\n\n            thisTree.expandGroup($(this)).done(function() {\n                thisTree.expandAllChildGroups(groupNode);\n            });\n        });\n    };\n\n    /**\n     * Find all child group nodes from the given node and expand them.\n     *\n     * @method expandAllChildGroups\n     * @param {Object} item is the jquery id of the group.\n     */\n    Tree.prototype.expandAllChildGroups = function(item) {\n        var thisTree = this;\n\n        this.getGroupFromItem(item).find(SELECTORS.CLOSED_GROUP).each(function() {\n            var groupNode = $(this);\n\n            thisTree.expandGroup($(this)).done(function() {\n                thisTree.expandAllChildGroups(groupNode);\n            });\n        });\n    };\n\n    /**\n     * Expand a collapsed group.\n     *\n     * Handles expanding nodes that are ajax loaded (marked with a data-requires-ajax attribute).\n     *\n     * @method expandGroup\n     * @param {Object} item is the jquery id of the parent item of the group.\n     * @return {Object} a promise that is resolved when the group has been expanded.\n     */\n    Tree.prototype.expandGroup = function(item) {\n        var promise = $.Deferred();\n        // Ignore nodes that are explicitly maked as not expandable or are already expanded.\n        if (item.attr('data-expandable') !== 'false' && this.isGroupCollapsed(item)) {\n            // If this node requires ajax load and we haven't already loaded it.\n            if (item.attr('data-requires-ajax') === 'true' && item.attr('data-loaded') !== 'true') {\n                item.attr('data-loaded', false);\n                // Get the closes ajax loading module specificed in the tree.\n                var moduleName = item.closest('[data-ajax-loader]').attr('data-ajax-loader');\n                var thisTree = this;\n                // Flag this node as loading.\n                const p = item.find('p');\n                p.addClass('loading');\n                // Require the ajax module (must be AMD) and try to load the items.\n                require([moduleName], function(loader) {\n                    // All ajax module must implement a \"load\" method.\n                    loader.load(item).done(function() {\n                        item.attr('data-loaded', true);\n\n                        // Set defaults on the newly constructed part of the tree.\n                        thisTree.initialiseNodes(item);\n                        thisTree.finishExpandingGroup(item);\n                        // Make sure no child elements of the item we just loaded are tabbable.\n                        p.removeClass('loading');\n                        promise.resolve();\n                    });\n                });\n            } else {\n                this.finishExpandingGroup(item);\n                promise.resolve();\n            }\n        } else {\n            promise.resolve();\n        }\n        return promise;\n    };\n\n    /**\n     * Perform the necessary DOM changes to display a group item.\n     *\n     * @method finishExpandingGroup\n     * @param {Object} item is the jquery id of the parent item of the group.\n     */\n    Tree.prototype.finishExpandingGroup = function(item) {\n        // Expand the group.\n        var group = this.getGroupFromItem(item);\n        group.removeAttr('aria-hidden');\n        item.attr('aria-expanded', 'true');\n\n        // Update the list of visible items.\n        this.refreshVisibleItemsCache();\n    };\n\n    /**\n     * Collapse an expanded group.\n     *\n     * @method collapseGroup\n     * @param {Object} item is the jquery id of the parent item of the group.\n     */\n    Tree.prototype.collapseGroup = function(item) {\n        // If the item is not collapsible or already collapsed then do nothing.\n        if (!this.isGroupCollapsible(item) || this.isGroupCollapsed(item)) {\n            return;\n        }\n\n        // Collapse the group.\n        var group = this.getGroupFromItem(item);\n        group.attr('aria-hidden', 'true');\n        item.attr('aria-expanded', 'false');\n\n        // Update the list of visible items.\n        this.refreshVisibleItemsCache();\n    };\n\n    /**\n     * Expand or collapse a group.\n     *\n     * @method toggleGroup\n     * @param {Object} item is the jquery id of the parent item of the group.\n     */\n    Tree.prototype.toggleGroup = function(item) {\n        if (item.attr('aria-expanded') === 'true') {\n            this.collapseGroup(item);\n        } else {\n            this.expandGroup(item);\n        }\n    };\n\n    /**\n     * Handle a key down event - ie navigate the tree.\n     *\n     * @method handleKeyDown\n     * @param {Event} e The event.\n     */\n     // This function should be simplified. In the meantime..\n     // eslint-disable-next-line complexity\n    Tree.prototype.handleKeyDown = function(e) {\n        var item = $(e.target);\n        var currentIndex = this.getVisibleItems().index(item);\n\n        if ((e.altKey || e.ctrlKey || e.metaKey) || (e.shiftKey && e.keyCode != this.keys.tab)) {\n            // Do nothing.\n            return;\n        }\n\n        switch (e.keyCode) {\n            case this.keys.home: {\n                // Jump to first item in tree.\n                this.getVisibleItems().first().focus();\n\n                e.preventDefault();\n                return;\n            }\n            case this.keys.end: {\n                // Jump to last visible item.\n                this.getVisibleItems().last().focus();\n\n                e.preventDefault();\n                return;\n            }\n            case this.keys.enter: {\n                var links = item.children('a').length ? item.children('a') : item.children().not(SELECTORS.GROUP).find('a');\n                if (links.length) {\n                    if (links.first().data('overrides-tree-activation-key-handler')) {\n                        // If the link overrides handling of activation keys, let it do so.\n                        links.first().triggerHandler(e);\n                    } else if (typeof this.enterCallback === 'function') {\n                        // Use callback if there is one.\n                        this.enterCallback(item);\n                    } else {\n                        window.location.href = links.first().attr('href');\n                    }\n                } else if (this.isGroupItem(item)) {\n                    this.toggleGroup(item, true);\n                }\n\n                e.preventDefault();\n                return;\n            }\n            case this.keys.space: {\n                if (this.isGroupItem(item)) {\n                    this.toggleGroup(item, true);\n                } else if (item.children('a').length) {\n                    var firstLink = item.children('a').first();\n\n                    if (firstLink.data('overrides-tree-activation-key-handler')) {\n                        firstLink.triggerHandler(e);\n                    }\n                }\n\n                e.preventDefault();\n                return;\n            }\n            case this.keys.left: {\n                var focusParent = function(tree) {\n                    // Get the immediate visible parent group item that contains this element.\n                    tree.getVisibleItems().filter(function() {\n                        return tree.getGroupFromItem($(this)).has(item).length;\n                    }).focus();\n                };\n\n                // If this is a goup item then collapse it and focus the parent group\n                // in accordance with the aria spec.\n                if (this.isGroupItem(item)) {\n                    if (this.isGroupCollapsed(item)) {\n                        focusParent(this);\n                    } else {\n                        this.collapseGroup(item);\n                    }\n                } else {\n                    focusParent(this);\n                }\n\n                e.preventDefault();\n                return;\n            }\n            case this.keys.right: {\n                // If this is a group item then expand it and focus the first child item\n                // in accordance with the aria spec.\n                if (this.isGroupItem(item)) {\n                    if (this.isGroupCollapsed(item)) {\n                        this.expandGroup(item);\n                    } else {\n                        // Move to the first item in the child group.\n                        this.getGroupFromItem(item).find(SELECTORS.ITEM).first().focus();\n                    }\n                }\n\n                e.preventDefault();\n                return;\n            }\n            case this.keys.up: {\n\n                if (currentIndex > 0) {\n                    var prev = this.getVisibleItems().eq(currentIndex - 1);\n\n                    prev.focus();\n                }\n\n                e.preventDefault();\n                return;\n            }\n            case this.keys.down: {\n\n                if (currentIndex < this.getVisibleItems().length - 1) {\n                    var next = this.getVisibleItems().eq(currentIndex + 1);\n\n                    next.focus();\n                }\n\n                e.preventDefault();\n                return;\n            }\n            case this.keys.asterisk: {\n                // Expand all groups.\n                this.expandAllGroups();\n                e.preventDefault();\n                return;\n            }\n        }\n    };\n\n    /**\n     * Handle a click (select).\n     *\n     * @method handleClick\n     * @param {Event} e The event.\n     */\n    Tree.prototype.handleClick = function(e) {\n        if (e.altKey || e.ctrlKey || e.shiftKey || e.metaKey) {\n            // Do nothing.\n            return;\n        }\n\n        // Get the closest tree item from the event target.\n        var item = $(e.target).closest('[role=\"treeitem\"]');\n        if (!item.is(e.currentTarget)) {\n            return;\n        }\n\n        // Update the active item.\n        item.focus();\n\n        // If the item is a group node.\n        if (this.isGroupItem(item)) {\n            this.toggleGroup(item);\n        }\n    };\n\n    /**\n     * Handle a focus event.\n     *\n     * @method handleFocus\n     * @param {Event} e The event.\n     */\n    Tree.prototype.handleFocus = function(e) {\n        this.setActiveItem($(e.target));\n    };\n\n    /**\n     * Bind the event listeners we require.\n     *\n     * @method bindEventHandlers\n     */\n    Tree.prototype.bindEventHandlers = function() {\n        // Bind event handlers to the tree items. Use event delegates to allow\n        // for dynamically loaded parts of the tree.\n        this.treeRoot.on({\n            click: this.handleClick.bind(this),\n            keydown: this.handleKeyDown.bind(this),\n            focus: this.handleFocus.bind(this),\n        }, SELECTORS.ITEM);\n    };\n\n    /**\n     * Handle setting the active item once the parent element is unhidden.\n     *\n     * @param {jQuery} item The item to set active focus on\n     */\n    Tree.prototype.focusOnParentUnhidden = function(item) {\n        const hiddenParent = this.treeRoot.closest('[aria-hidden]').get(0);\n\n        const hiddenParentObserver = new MutationObserver(mutationList => {\n            mutationList.forEach(() => {\n                hiddenParentObserver.disconnect();\n                this.setActiveItem(item);\n            });\n        });\n\n        hiddenParentObserver.observe(hiddenParent, {\n            attributes: true,\n            attributeFilter: ['aria-hidden'],\n        });\n    };\n\n    return Tree;\n});\n"],"file":"tree.min.js"}