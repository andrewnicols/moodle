{"version":3,"file":"tree.min.js","sources":["../src/tree.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Implement an accessible aria tree widget, from a nested unordered list.\n * Based on http://oaa-accessibility.org/example/41/.\n *\n * @module     core/tree\n * @copyright  2015 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\n\n// Private variables and functions.\nvar SELECTORS = {\n    ITEM: '[role=treeitem]',\n    GROUP: '[role=treeitem]:has([role=group]), [role=treeitem][aria-owns], [role=treeitem][data-requires-ajax=true]',\n    CLOSED_GROUP: '[role=treeitem]:has([role=group])[aria-expanded=false], [role=treeitem][aria-owns][aria-expanded=false], ' +\n        '[role=treeitem][data-requires-ajax=true][aria-expanded=false]',\n    FIRST_ITEM: '[role=treeitem]:first',\n    VISIBLE_ITEM: '[role=treeitem]:visible',\n    UNLOADED_AJAX_ITEM: '[role=treeitem][data-requires-ajax=true][data-loaded=false][aria-expanded=true]'\n};\n\nexport default class Tree {\n    keys = {\n        tab: 9,\n        enter: 13,\n        space: 32,\n        pageup: 33,\n        pagedown: 34,\n        end: 35,\n        home: 36,\n        left: 37,\n        up: 38,\n        right: 39,\n        down: 40,\n        asterisk: 106\n    };\n\n    /**\n     * Constructor.\n     *\n     * @param {String} selector\n     * @param {function} selectCallback Called when the active node is changed.\n     */\n    constructor(selector, selectCallback) {\n        this.treeRoot = $(selector);\n\n        this.treeRoot.data('activeItem', null);\n        this.selectCallback = selectCallback;\n\n        // Apply the standard default initialisation for all nodes, starting with the tree root.\n        this.initialiseNodes(this.treeRoot);\n        // Make the first item the active item for the tree so that it is added to the tab order.\n        this.setActiveItem(this.treeRoot.find(SELECTORS.FIRST_ITEM));\n        // Create the cache of the visible items.\n        this.refreshVisibleItemsCache();\n        // Create the event handlers for the tree.\n        this.bindEventHandlers();\n    }\n\n    registerEnterCallback(callback) {\n        this.enterCallback = callback;\n    }\n\n    /**\n     * Find all visible tree items and save a cache of them on the tree object.\n     *\n     * @method refreshVisibleItemsCache\n     */\n    refreshVisibleItemsCache() {\n        this.treeRoot.data('visibleItems', this.treeRoot.find(SELECTORS.VISIBLE_ITEM));\n    }\n\n    /**\n     * Get all visible tree items.\n     *\n     * @method getVisibleItems\n     * @return {Object} visible items\n     */\n    getVisibleItems() {\n        return this.treeRoot.data('visibleItems');\n    }\n\n    /**\n     * Mark the given item as active within the tree and fire the callback for when the active item is set.\n     *\n     * @method setActiveItem\n     * @param {object} item jquery object representing an item on the tree.\n     */\n    setActiveItem(item) {\n        var currentActive = this.treeRoot.data('activeItem');\n        if (item === currentActive) {\n            return;\n        }\n\n        // Remove previous active from tab order.\n        if (currentActive) {\n            currentActive.attr('tabindex', '-1');\n            currentActive.attr('aria-selected', 'false');\n        }\n        item.attr('tabindex', '0');\n        item.attr('aria-selected', 'true');\n\n        // Set the new active item.\n        this.treeRoot.data('activeItem', item);\n\n        if (typeof this.selectCallback === 'function') {\n            this.selectCallback(item);\n        }\n    }\n\n    /**\n     * Determines if the given item is a group item (contains child tree items) in the tree.\n     *\n     * @method isGroupItem\n     * @param {object} item jquery object representing an item on the tree.\n     * @returns {bool}\n     */\n    isGroupItem(item) {\n        return item.is(SELECTORS.GROUP);\n    }\n\n    /**\n     * Determines if the given item is a group item (contains child tree items) in the tree.\n     *\n     * @method isGroupItem\n     * @param {object} item jquery object representing an item on the tree.\n     * @returns {bool}\n     */\n    getGroupFromItem(item) {\n        var ariaowns = this.treeRoot.find('#' + item.attr('aria-owns'));\n        var plain = item.children('[role=group]');\n        if (ariaowns.length > plain.length) {\n            return ariaowns;\n        } else {\n            return plain;\n        }\n    }\n\n    /**\n     * Determines if the given group item (contains child tree items) is collapsed.\n     *\n     * @method isGroupCollapsed\n     * @param {object} item jquery object representing a group item on the tree.\n     * @returns {bool}\n     */\n    isGroupCollapsed(item) {\n        return item.attr('aria-expanded') === 'false';\n    }\n\n    /**\n     * Determines if the given group item (contains child tree items) can be collapsed.\n     *\n     * @method isGroupCollapsible\n     * @param {object} item jquery object representing a group item on the tree.\n     * @returns {bool}\n     */\n    isGroupCollapsible(item) {\n        return item.attr('data-collapsible') !== 'false';\n    }\n\n    /**\n     * Performs the tree initialisation for all child items from the given node,\n     * such as removing everything from the tab order and setting aria selected\n     * on items.\n     *\n     * @method initialiseNodes\n     * @param {object} node jquery object representing a node.\n     */\n    initialiseNodes(node) {\n        this.removeAllFromTabOrder(node);\n        this.setAriaSelectedFalseOnItems(node);\n\n        // Get all ajax nodes that have been rendered as expanded but haven't loaded the child items yet.\n        var thisTree = this;\n        node.find(SELECTORS.UNLOADED_AJAX_ITEM).each(function() {\n            var unloadedNode = $(this);\n            // Collapse and then expand to trigger the ajax loading.\n            thisTree.collapseGroup(unloadedNode);\n            thisTree.expandGroup(unloadedNode);\n        });\n    }\n\n    /**\n     * Removes all child DOM elements of the given node from the tab order.\n     *\n     * @method removeAllFromTabOrder\n     * @param {object} node jquery object representing a node.\n     */\n    removeAllFromTabOrder(node) {\n        node.find('*').attr('tabindex', '-1');\n        this.getGroupFromItem($(node)).find('*').attr('tabindex', '-1');\n    }\n\n    /**\n     * Find all child tree items from the given node and set the aria selected attribute to false.\n     *\n     * @method setAriaSelectedFalseOnItems\n     * @param {object} node jquery object representing a node.\n     */\n    setAriaSelectedFalseOnItems(node) {\n        node.find(SELECTORS.ITEM).attr('aria-selected', 'false');\n    }\n\n    /**\n     * Expand all group nodes within the tree.\n     *\n     * @method expandAllGroups\n     */\n    expandAllGroups() {\n        var thisTree = this;\n\n        this.treeRoot.find(SELECTORS.CLOSED_GROUP).each(function() {\n            var groupNode = $(this);\n\n            thisTree.expandGroup($(this)).done(function() {\n                thisTree.expandAllChildGroups(groupNode);\n            });\n        });\n    }\n\n    /**\n     * Find all child group nodes from the given node and expand them.\n     *\n     * @method expandAllChildGroups\n     * @param {Object} item is the jquery id of the group.\n     */\n    expandAllChildGroups(item) {\n        var thisTree = this;\n\n        this.getGroupFromItem(item).find(SELECTORS.CLOSED_GROUP).each(function() {\n            var groupNode = $(this);\n\n            thisTree.expandGroup($(this)).done(function() {\n                thisTree.expandAllChildGroups(groupNode);\n            });\n        });\n    }\n\n    /**\n     * Expand a collapsed group.\n     *\n     * Handles expanding nodes that are ajax loaded (marked with a data-requires-ajax attribute).\n     *\n     * @method expandGroup\n     * @param {Object} item is the jquery id of the parent item of the group.\n     * @return {Object} a promise that is resolved when the group has been expanded.\n     */\n    expandGroup(item) {\n        var promise = $.Deferred();\n        // Ignore nodes that are explicitly maked as not expandable or are already expanded.\n        if (item.attr('data-expandable') !== 'false' && this.isGroupCollapsed(item)) {\n            // If this node requires ajax load and we haven't already loaded it.\n            if (item.attr('data-requires-ajax') === 'true' && item.attr('data-loaded') !== 'true') {\n                item.attr('data-loaded', false);\n                // Get the closes ajax loading module specificed in the tree.\n                var moduleName = item.closest('[data-ajax-loader]').attr('data-ajax-loader');\n                var thisTree = this;\n                // Flag this node as loading.\n                const p = item.find('p');\n                p.addClass('loading');\n                // Require the ajax module (must be AMD) and try to load the items.\n                require([moduleName], function(loader) {\n                    // All ajax module must implement a \"load\" method.\n                    loader.load(item).done(function() {\n                        item.attr('data-loaded', true);\n\n                        // Set defaults on the newly constructed part of the tree.\n                        thisTree.initialiseNodes(item);\n                        thisTree.finishExpandingGroup(item);\n                        // Make sure no child elements of the item we just loaded are tabbable.\n                        p.removeClass('loading');\n                        promise.resolve();\n                    });\n                });\n            } else {\n                this.finishExpandingGroup(item);\n                promise.resolve();\n            }\n        } else {\n            promise.resolve();\n        }\n        return promise;\n    }\n\n    /**\n     * Perform the necessary DOM changes to display a group item.\n     *\n     * @method finishExpandingGroup\n     * @param {Object} item is the jquery id of the parent item of the group.\n     */\n    finishExpandingGroup(item) {\n        // Expand the group.\n        var group = this.getGroupFromItem(item);\n        group.removeAttr('aria-hidden');\n        item.attr('aria-expanded', 'true');\n\n        // Update the list of visible items.\n        this.refreshVisibleItemsCache();\n    }\n\n    /**\n     * Collapse an expanded group.\n     *\n     * @method collapseGroup\n     * @param {Object} item is the jquery id of the parent item of the group.\n     */\n    collapseGroup(item) {\n        // If the item is not collapsible or already collapsed then do nothing.\n        if (!this.isGroupCollapsible(item) || this.isGroupCollapsed(item)) {\n            return;\n        }\n\n        // Collapse the group.\n        var group = this.getGroupFromItem(item);\n        group.attr('aria-hidden', 'true');\n        item.attr('aria-expanded', 'false');\n\n        // Update the list of visible items.\n        this.refreshVisibleItemsCache();\n    }\n\n    /**\n     * Expand or collapse a group.\n     *\n     * @method toggleGroup\n     * @param {Object} item is the jquery id of the parent item of the group.\n     */\n    toggleGroup(item) {\n        if (item.attr('aria-expanded') === 'true') {\n            this.collapseGroup(item);\n        } else {\n            this.expandGroup(item);\n        }\n    }\n\n    /**\n     * Handle a key down event - ie navigate the tree.\n     *\n     * @method handleKeyDown\n     * @param {Event} e The event.\n     */\n     // This function should be simplified. In the meantime..\n     // eslint-disable-next-line complexity\n    handleKeyDown(e) {\n        var item = $(e.target);\n        var currentIndex = this.getVisibleItems()?.index(item);\n\n        if ((e.altKey || e.ctrlKey || e.metaKey) || (e.shiftKey && e.keyCode != this.keys.tab)) {\n            // Do nothing.\n            return;\n        }\n\n        switch (e.keyCode) {\n            case this.keys.home: {\n                // Jump to first item in tree.\n                this.getVisibleItems().first().focus();\n\n                e.preventDefault();\n                return;\n            }\n            case this.keys.end: {\n                // Jump to last visible item.\n                this.getVisibleItems().last().focus();\n\n                e.preventDefault();\n                return;\n            }\n            case this.keys.enter: {\n                var links = item.children('a').length ? item.children('a') : item.children().not(SELECTORS.GROUP).find('a');\n                if (links.length) {\n                    if (links.first().data('overrides-tree-activation-key-handler')) {\n                        // If the link overrides handling of activation keys, let it do so.\n                        links.first().triggerHandler(e);\n                    } else if (typeof this.enterCallback === 'function') {\n                        // Use callback if there is one.\n                        this.enterCallback(item);\n                    } else {\n                        window.location.href = links.first().attr('href');\n                    }\n                } else if (this.isGroupItem(item)) {\n                    this.toggleGroup(item, true);\n                }\n\n                e.preventDefault();\n                return;\n            }\n            case this.keys.space: {\n                if (this.isGroupItem(item)) {\n                    this.toggleGroup(item, true);\n                } else if (item.children('a').length) {\n                    var firstLink = item.children('a').first();\n\n                    if (firstLink.data('overrides-tree-activation-key-handler')) {\n                        firstLink.triggerHandler(e);\n                    }\n                }\n\n                e.preventDefault();\n                return;\n            }\n            case this.keys.left: {\n                var focusParent = function(tree) {\n                    // Get the immediate visible parent group item that contains this element.\n                    tree.getVisibleItems().filter(function() {\n                        return tree.getGroupFromItem($(this)).has(item).length;\n                    }).focus();\n                };\n\n                // If this is a group item then collapse it and focus the parent group\n                // in accordance with the aria spec.\n                if (this.isGroupItem(item)) {\n                    if (this.isGroupCollapsed(item)) {\n                        focusParent(this);\n                    } else {\n                        this.collapseGroup(item);\n                    }\n                } else {\n                    focusParent(this);\n                }\n\n                e.preventDefault();\n                return;\n            }\n            case this.keys.right: {\n                // If this is a group item then expand it and focus the first child item\n                // in accordance with the aria spec.\n                if (this.isGroupItem(item)) {\n                    if (this.isGroupCollapsed(item)) {\n                        this.expandGroup(item);\n                    } else {\n                        // Move to the first item in the child group.\n                        this.getGroupFromItem(item).find(SELECTORS.ITEM).first().focus();\n                    }\n                }\n\n                e.preventDefault();\n                return;\n            }\n            case this.keys.up: {\n\n                if (currentIndex > 0) {\n                    var prev = this.getVisibleItems().eq(currentIndex - 1);\n\n                    prev.focus();\n                }\n\n                e.preventDefault();\n                return;\n            }\n            case this.keys.down: {\n\n                if (currentIndex < this.getVisibleItems().length - 1) {\n                    var next = this.getVisibleItems().eq(currentIndex + 1);\n\n                    next.focus();\n                }\n\n                e.preventDefault();\n                return;\n            }\n            case this.keys.asterisk: {\n                // Expand all groups.\n                this.expandAllGroups();\n                e.preventDefault();\n                return;\n            }\n        }\n    }\n\n    /**\n     * Handle an item click.\n     *\n     * @param {Event} event the click event\n     * @param {jQuery} item the item clicked\n     */\n    handleItemClick(event, item) {\n        // Update the active item.\n        item.focus();\n\n        // If the item is a group node.\n        if (this.isGroupItem(item)) {\n            this.toggleGroup(item);\n        }\n    }\n\n    /**\n     * Handle a click (select).\n     *\n     * @method handleClick\n     * @param {Event} event The event.\n     */\n    handleClick(event) {\n        if (event.altKey || event.ctrlKey || event.shiftKey || event.metaKey) {\n            // Do nothing.\n            return;\n        }\n\n        // Get the closest tree item from the event target.\n        var item = $(event.target).closest('[role=\"treeitem\"]');\n        if (!item.is(event.currentTarget)) {\n            return;\n        }\n\n        this.handleItemClick(event, item);\n    }\n\n    /**\n     * Handle a focus event.\n     *\n     * @method handleFocus\n     * @param {Event} e The event.\n     */\n    handleFocus(e) {\n        this.setActiveItem($(e.target));\n    }\n\n    /**\n     * Bind the event listeners we require.\n     *\n     * @method bindEventHandlers\n     */\n    bindEventHandlers() {\n        // Bind event handlers to the tree items. Use event delegates to allow\n        // for dynamically loaded parts of the tree.\n        this.treeRoot.on({\n            click: this.handleClick.bind(this),\n            keydown: this.handleKeyDown.bind(this),\n            focus: this.handleFocus.bind(this),\n        }, SELECTORS.ITEM);\n    }\n}\n"],"names":["SELECTORS","constructor","selector","selectCallback","tab","enter","space","pageup","pagedown","end","home","left","up","right","down","asterisk","treeRoot","data","initialiseNodes","this","setActiveItem","find","refreshVisibleItemsCache","bindEventHandlers","registerEnterCallback","callback","enterCallback","getVisibleItems","item","currentActive","attr","isGroupItem","is","getGroupFromItem","ariaowns","plain","children","length","isGroupCollapsed","isGroupCollapsible","node","removeAllFromTabOrder","setAriaSelectedFalseOnItems","thisTree","each","unloadedNode","collapseGroup","expandGroup","expandAllGroups","groupNode","done","expandAllChildGroups","promise","$","Deferred","moduleName","closest","p","addClass","require","loader","load","finishExpandingGroup","removeClass","resolve","removeAttr","toggleGroup","handleKeyDown","e","target","currentIndex","_this$getVisibleItems","index","altKey","ctrlKey","metaKey","shiftKey","keyCode","keys","first","focus","preventDefault","last","links","not","triggerHandler","window","location","href","firstLink","focusParent","tree","filter","has","eq","handleItemClick","event","handleClick","currentTarget","handleFocus","on","click","bind","keydown"],"mappings":"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"}