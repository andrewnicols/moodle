define ("core/str",["exports","jquery","core/ajax","core/localstorage"],function(_exports,_jquery,_ajax,_localstorage){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.get_strings=_exports.get_string=_exports.cache_strings=void 0;_jquery=_interopRequireDefault(_jquery);_ajax=_interopRequireDefault(_ajax);_localstorage=_interopRequireDefault(_localstorage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1,source;i<arguments.length;i++){source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0})}else{obj[key]=value}return obj}var promiseCache=[];_exports.get_string=function get_string(key,component,param,lang){return get_strings([{key:key,component:component,param:param,lang:lang}]).then(function(results){return results[0]})};var get_strings=function(requests){var requestData=[],pageLang=(0,_jquery.default)("html").attr("lang").replace(/-/g,"_"),getCacheKey=function(_ref){var key=_ref.key,component=_ref.component,_ref$lang=_ref.lang,lang=void 0===_ref$lang?pageLang:_ref$lang;if(!component){component="core"}return"core_str/".concat(key,"/").concat(component,"/").concat(lang)},stringPromises=requests.map(function(request){var cacheKey=getCacheKey(request),component=request.component,key=request.key,param=request.param,_request$lang=request.lang,lang=void 0===_request$lang?pageLang:_request$lang,buildReturn=function(promise){promiseCache[cacheKey]=promise;return promise};if(component in M.str&&key in M.str[component]){return buildReturn(new Promise(function(resolve){resolve(M.util.get_string(key,component,param,lang))}))}var cached=_localstorage.default.get(cacheKey);if(cached){M.str[component]=_objectSpread(_objectSpread({},M.str[component]),{},_defineProperty({},key,cached));return buildReturn(new Promise(function(resolve){resolve(M.util.get_string(key,component,param,lang))}))}if(cacheKey in promiseCache){return buildReturn(promiseCache[cacheKey]).then(function(){return M.util.get_string(key,component,param,lang)})}else{return buildReturn(new Promise(function(resolve,reject){requestData.push({methodname:"core_get_string",args:{stringid:key,stringparams:[],component:component,lang:lang},done:function done(str){M.str[component]=_objectSpread(_objectSpread({},M.str[component]),{},_defineProperty({},key,str));_localstorage.default.set(cacheKey,str);resolve(M.util.get_string(key,component,param,lang))},fail:reject})}))}});if(requestData.length){_ajax.default.call(requestData,!0,!1,!1,0,M.cfg.langrev)}return _jquery.default.when.apply(_jquery.default,stringPromises).then(function(){for(var _len=arguments.length,strings=Array(_len),_key=0;_key<_len;_key++){strings[_key]=arguments[_key]}return strings})};_exports.get_strings=get_strings;var cache_strings=function(strings){var defaultLang=(0,_jquery.default)("html").attr("lang").replace(/-/g,"_");strings.forEach(function(_ref2){var key=_ref2.key,component=_ref2.component,value=_ref2.value,_ref2$lang=_ref2.lang,lang=void 0===_ref2$lang?defaultLang:_ref2$lang,cacheKey=["core_str",key,component,lang].join("/");if(!(component in M.str)||!(key in M.str[component])){if(!(component in M.str)){M.str[component]={}}M.str[component][key]=value}if(!_localstorage.default.get(cacheKey)){_localstorage.default.set(cacheKey,value)}if(!(cacheKey in promiseCache)){promiseCache[cacheKey]=_jquery.default.Deferred().resolve(value).promise()}})};_exports.cache_strings=cache_strings});
//# sourceMappingURL=str.min.js.map
