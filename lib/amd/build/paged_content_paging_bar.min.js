define ("core/paged_content_paging_bar",["jquery","core/custom_interaction_events","core/paged_content_events","core/str","core/pubsub","core/pending"],function($,CustomEvents,PagedContentEvents,Str,PubSub,Pending){var SELECTORS={ROOT:"[data-region=\"paging-bar\"]",PAGE:"[data-page]",PAGE_ITEM:"[data-region=\"page-item\"]",PAGE_LINK:"[data-region=\"page-link\"]",FIRST_BUTTON:"[data-control=\"first\"]",LAST_BUTTON:"[data-control=\"last\"]",NEXT_BUTTON:"[data-control=\"next\"]",PREVIOUS_BUTTON:"[data-control=\"previous\"]",DOTS_BUTTONS:"[data-dots]",BEGINNING_DOTS_BUTTON:"[data-dots=\"beginning\"]",ENDING_DOTS_BUTTON:"[data-dots=\"ending\"]"},getPageByNumber=function(root,pageNumber){return root.find(SELECTORS.PAGE_ITEM+"[data-page-number=\""+pageNumber+"\"]")},getNextButton=function(root){return root.find(SELECTORS.NEXT_BUTTON)},setLastPageNumber=function(root,number){root.attr("data-last-page-number",number)},getLastPageNumber=function(root){return parseInt(root.attr("data-last-page-number"),10)},getActivePageNumber=function(root){return parseInt(root.attr("data-active-page-number"),10)},setActivePageNumber=function(root,number){root.attr("data-active-page-number",number)},hasActivePageNumber=function(root){var number=getActivePageNumber(root);return!isNaN(number)&&0!=number},getPageNumber=function(root,page){if(page.attr("data-page")!=void 0){return parseInt(page.attr("data-page-number"),10)}var pageNumber=1,activePageNumber=null;switch(page.attr("data-control")){case"first":pageNumber=1;break;case"last":pageNumber=getLastPageNumber(root);break;case"next":activePageNumber=getActivePageNumber(root);var lastPage=getLastPageNumber(root);if(!lastPage){pageNumber=activePageNumber+1}else if(activePageNumber&&activePageNumber<lastPage){pageNumber=activePageNumber+1}else{pageNumber=lastPage}break;case"previous":activePageNumber=getActivePageNumber(root);if(activePageNumber&&1<activePageNumber){pageNumber=activePageNumber-1}else{pageNumber=1}break;default:pageNumber=1;break;}return parseInt(pageNumber,10)},getLimit=function(root){return parseInt(root.attr("data-items-per-page"),10)},setLimit=function(root,limit){root.attr("data-items-per-page",limit)},show=function(root){root.removeClass("hidden")},hide=function(root){root.addClass("hidden")},disableNextControlButtons=function(root){var nextButton=root.find(SELECTORS.NEXT_BUTTON),lastButton=root.find(SELECTORS.LAST_BUTTON);nextButton.addClass("disabled");nextButton.attr("aria-disabled",!0);lastButton.addClass("disabled");lastButton.attr("aria-disabled",!0)},enableNextControlButtons=function(root){var nextButton=root.find(SELECTORS.NEXT_BUTTON),lastButton=root.find(SELECTORS.LAST_BUTTON);nextButton.removeClass("disabled");nextButton.removeAttr("aria-disabled");lastButton.removeClass("disabled");lastButton.removeAttr("aria-disabled")},disablePreviousControlButtons=function(root){var previousButton=root.find(SELECTORS.PREVIOUS_BUTTON),firstButton=root.find(SELECTORS.FIRST_BUTTON);previousButton.addClass("disabled");previousButton.attr("aria-disabled",!0);firstButton.addClass("disabled");firstButton.attr("aria-disabled",!0)},adjustPagingBarSize=function(root){var activePageNumber=getActivePageNumber(root),lastPageNumber=getLastPageNumber(root),dotsButtons=root.find(SELECTORS.DOTS_BUTTONS),beginningDotsButton=root.find(SELECTORS.BEGINNING_DOTS_BUTTON),endingDotsButton=root.find(SELECTORS.ENDING_DOTS_BUTTON),pages=root.find(SELECTORS.PAGE),barSize=parseInt(root.attr("data-bar-size"),10);if(barSize&&lastPageNumber>barSize){var minpage=Math.max(activePageNumber-Math.round(barSize/2),1),maxpage=minpage+barSize-1;if(maxpage>=lastPageNumber){maxpage=lastPageNumber;minpage=maxpage-barSize+1}if(1<minpage){show(beginningDotsButton);minpage++}else{hide(beginningDotsButton)}if(maxpage<lastPageNumber){show(endingDotsButton);maxpage--}else{hide(endingDotsButton)}dotsButtons.addClass("disabled");dotsButtons.attr("aria-disabled",!0);hide(pages);pages.each(function(index,page){page=$(page);if(index+1>=minpage&&index+1<=maxpage){show(page)}})}else{hide(dotsButtons)}},enablePreviousControlButtons=function(root){var previousButton=root.find(SELECTORS.PREVIOUS_BUTTON),firstButton=root.find(SELECTORS.FIRST_BUTTON);previousButton.removeClass("disabled");previousButton.removeAttr("aria-disabled");firstButton.removeClass("disabled");firstButton.removeAttr("aria-disabled")},getPageAriaLabelComponents=function(root){var componentString=root.attr("data-aria-label-components-pagination-item"),components=componentString.split(",").map(function(component){return component.trim()});return components},getActivePageAriaLabelComponents=function(root){var componentString=root.attr("data-aria-label-components-pagination-active-item"),components=componentString.split(",").map(function(component){return component.trim()});return components},generatePageNumbers=function(root,items){var lastPageNumber=0;setActivePageNumber(root,0);items.each(function(index,item){var pageNumber=index+1;item=$(item);item.attr("data-page-number",pageNumber);lastPageNumber++;if(item.hasClass("active")){setActivePageNumber(root,pageNumber)}});setLastPageNumber(root,lastPageNumber)},generateAriaLabels=function(root){var pageAriaLabelComponents=getPageAriaLabelComponents(root),activePageAriaLabelComponents=getActivePageAriaLabelComponents(root),activePageNumber=getActivePageNumber(root),pageItems=root.find(SELECTORS.PAGE_ITEM),stringRequests=pageItems.map(function(index,page){page=$(page);var pageNumber=getPageNumber(root,page);if(pageNumber===activePageNumber){return{key:activePageAriaLabelComponents[0],component:activePageAriaLabelComponents[1],param:pageNumber}}else{return{key:pageAriaLabelComponents[0],component:pageAriaLabelComponents[1],param:pageNumber}}});Str.get_strings(stringRequests).then(function(strings){pageItems.each(function(index,page){page=$(page);var string=strings[index];page.attr("aria-label",string);page.find(SELECTORS.PAGE_LINK).attr("aria-label",string)});return strings}).catch(function(){})},showPage=function(root,pageNumber,id){var pendingPromise=new Pending("core/paged_content_paging_bar:showPage"),lastPageNumber=getLastPageNumber(root),isSamePage=pageNumber==getActivePageNumber(root),limit=getLimit(root);if(!isSamePage){root.find(SELECTORS.PAGE_ITEM).removeClass("active").removeAttr("aria-current");var page=getPageByNumber(root,pageNumber);page.addClass("active");page.attr("aria-current",!0);setActivePageNumber(root,pageNumber);adjustPagingBarSize(root)}if(lastPageNumber&&pageNumber>=lastPageNumber){disableNextControlButtons(root)}else{enableNextControlButtons(root)}if(1<pageNumber){enablePreviousControlButtons(root)}else{disablePreviousControlButtons(root)}generateAriaLabels(root);PubSub.publish(id+PagedContentEvents.SHOW_PAGES,[{pageNumber:pageNumber,limit:limit,offset:(pageNumber-1)*limit}]);pendingPromise.resolve()},registerEventListeners=function(root,id){var ignoreControlWhileLoading=root.attr("data-ignore-control-while-loading"),loading=!1;if(""==ignoreControlWhileLoading){ignoreControlWhileLoading=!0}CustomEvents.define(root,[CustomEvents.events.activate]);root.on(CustomEvents.events.activate,SELECTORS.PAGE_ITEM,function(e,data){data.originalEvent.preventDefault();data.originalEvent.stopPropagation();if(ignoreControlWhileLoading&&loading){return}var page=$(e.target).closest(SELECTORS.PAGE_ITEM);if(!page.hasClass("disabled")){var pageNumber=getPageNumber(root,page);showPage(root,pageNumber,id);loading=!0}});PubSub.subscribe(id+PagedContentEvents.ALL_ITEMS_LOADED,function(pageNumber){loading=!1;var currentLastPage=getLastPageNumber(root);if(!currentLastPage||pageNumber<currentLastPage){setLastPageNumber(root,pageNumber)}if(1===pageNumber&&root.attr("data-hide-control-on-single-page")){hide(root);disableNextControlButtons(root);disablePreviousControlButtons(root)}else{show(root);disableNextControlButtons(root)}});PubSub.subscribe(id+PagedContentEvents.PAGES_SHOWN,function(){loading=!1});PubSub.subscribe(id+PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT,function(limit){setLimit(root,limit);setLastPageNumber(root,0);setActivePageNumber(root,0);show(root);showPage(root,1,id)})};return{init:function init(root,id){root=$(root);var pages=root.find(SELECTORS.PAGE);generatePageNumbers(root,pages);registerEventListeners(root,id);if(hasActivePageNumber(root)){var activePageNumber=getActivePageNumber(root);getPageByNumber(root,activePageNumber).click();if(1==activePageNumber){disablePreviousControlButtons(root)}}else{getNextButton(root).click()}adjustPagingBarSize(root)},disableNextControlButtons:disableNextControlButtons,enableNextControlButtons:enableNextControlButtons,disablePreviousControlButtons:disablePreviousControlButtons,enablePreviousControlButtons:enablePreviousControlButtons,showPage:showPage,rootSelector:SELECTORS.ROOT}});
//# sourceMappingURL=paged_content_paging_bar.min.js.map
