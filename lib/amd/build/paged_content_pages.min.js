define ("core/paged_content_pages",["jquery","core/templates","core/notification","core/pubsub","core/paged_content_events","core/pending"],function($,Templates,Notification,PubSub,PagedContentEvents,Pending){var SELECTORS={ROOT:"[data-region=\"page-container\"]",PAGE_REGION:"[data-region=\"paged-content-page\"]",ACTIVE_PAGE_REGION:"[data-region=\"paged-content-page\"].active"},TEMPLATES={PAGING_CONTENT_ITEM:"core/paged_content_page",LOADING:"core/overlay_loading"},findPage=function(root,pageNumber){return root.find("[data-page=\""+pageNumber+"\"]")},startLoading=function(root){var deferred=$.Deferred();root.attr("aria-busy",!0);var pendingPromise=new Pending("core/paged_content_pages:startLoading");Templates.render(TEMPLATES.LOADING,{visible:!0}).then(function(html){var loadingSpinner=$(html),timerId=setTimeout(function(){root.css("position","relative");loadingSpinner.appendTo(root)},300);deferred.always(function(){clearTimeout(timerId);loadingSpinner.remove();root.css("position","");root.removeAttr("aria-busy");pendingPromise.resolve()})}).fail(Notification.exception);return deferred},renderPagePromise=function(root,pagePromise,pageNumber){var deferred=$.Deferred();pagePromise.then(function(html,pageJS){pageJS=pageJS||"";Templates.render(TEMPLATES.PAGING_CONTENT_ITEM,{page:pageNumber,content:html}).then(function(html){Templates.appendNodeContents(root,html,pageJS);var page=findPage(root,pageNumber);deferred.resolve(page)}).fail(function(exception){deferred.reject(exception)}).fail(Notification.exception)}).fail(function(exception){deferred.reject(exception)}).fail(Notification.exception);return deferred.promise()},showPages=function(root,pagesData,id,renderPagesContentCallback){var pendingPromise=new Pending("core/paged_content_pages:showPages"),existingPages=[],newPageData=[],newPagesPromise=$.Deferred();pagesData.forEach(function(pageData){var pageNumber=pageData.pageNumber,existingPage=findPage(root,pageNumber);if(existingPage.length){existingPages.push(existingPage)}else{newPageData.push(pageData)}});if(newPageData.length&&"function"==typeof renderPagesContentCallback){var promises=renderPagesContentCallback(newPageData,{allItemsLoaded:function(lastPageNumber){PubSub.publish(id+PagedContentEvents.ALL_ITEMS_LOADED,lastPageNumber)}}),renderPagePromises=promises.map(function(promise,index){return renderPagePromise(root,promise,newPageData[index].pageNumber)});$.when.apply($,renderPagePromises).then(function(){var newPages=Array.prototype.slice.call(arguments);newPagesPromise.resolve(newPages)}).fail(function(exception){newPagesPromise.reject(exception)}).fail(Notification.exception)}else{newPagesPromise.resolve([])}var loadingPromise=startLoading(root);newPagesPromise.then(function(newPages){var pagesToShow=existingPages.concat(newPages);root.find(SELECTORS.PAGE_REGION).addClass("hidden");pagesToShow.forEach(function(page){if(!0){page.removeClass("hidden")}})}).then(function(){PubSub.publish(id+PagedContentEvents.PAGES_SHOWN,pagesData)}).fail(Notification.exception).always(function(){loadingPromise.resolve();pendingPromise.resolve()}).catch()};return{init:function(root,id,renderPagesContentCallback){root=$(root);PubSub.subscribe(id+PagedContentEvents.SHOW_PAGES,function(pagesData){showPages(root,pagesData,id,renderPagesContentCallback)});PubSub.subscribe(id+PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT,function(){root.empty()})},rootSelector:SELECTORS.ROOT}});
//# sourceMappingURL=paged_content_pages.min.js.map
