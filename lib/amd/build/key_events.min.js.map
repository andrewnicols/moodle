{"version":3,"sources":["../src/key_events.js"],"names":["eventTypes","activated","arrowDownPressed","arrowUpPressed","asterixKeyPressed","endKeyPressed","enterKeyPressed","escapeKeyPressed","homeKeyPressed","keyboardActivated","metaPageDown","metaPageUp","nextKeyPressed","previousKeyPressed","scrollTopReached","isModifierPressed","e","shiftKey","metaKey","altKey","ctrlKey","documentEventMap","keydown","customEventName","filter","code","key","customEventNameFunction","document","querySelector","dir","click","elementEventMap","nativeEventName","target","window","scrollTop","scrollBottomReached","scrolledElement","scrollingElement","offsetHeight","scrollHeight","legacyEventMap","handleFiredEvent","eventDetails","hasOwnProperty","customEvent","cancelable","defaultPrevented","preventDefault","eventsRegistered","eventType","eventTypeDetails","addEventListener","forEach","Object","entries","watch","element","eventName","define","elementList","legacyEventNames","length","console","warn","join","legacyEventName","newEventName","off","on","trigger","originalEvent"],"mappings":"iNAyBA,uD,49BAGO,GAAMA,CAAAA,CAAU,CAAG,CACtBC,SAAS,CAAE,2BADW,CAEtBC,gBAAgB,CAAE,kCAFI,CAGtBC,cAAc,CAAE,gCAHM,CAItBC,iBAAiB,CAAE,mCAJG,CAKtBC,aAAa,CAAE,+BALO,CAMtBC,eAAe,CAAE,iCANK,CAOtBC,gBAAgB,CAAE,kCAPI,CAQtBC,cAAc,CAAE,gCARM,CAStBC,iBAAiB,CAAE,mCATG,CAUtBC,YAAY,CAAE,8BAVQ,CAWtBC,UAAU,CAAE,4BAXU,CAYtBC,cAAc,CAAE,gCAZM,CAatBC,kBAAkB,CAAE,oCAbE,CActBC,gBAAgB,CAAE,kCAdI,CAAnB,C,kBAwBDC,CAAAA,CAAiB,CAAG,SAAAC,CAAC,CAAI,CAC3B,MAAQA,CAAAA,CAAC,CAACC,QAAF,EAAcD,CAAC,CAACE,OAAhB,EAA2BF,CAAC,CAACG,MAA7B,EAAuCH,CAAC,CAACI,OACpD,C,CAEKC,CAAgB,CAAG,CACrBC,OAAO,CAAE,CACL,CAEIC,eAAe,CAAEvB,CAAU,CAACQ,cAFhC,CAGIgB,MAAM,CAAE,gBAAAR,CAAC,QAAe,MAAX,GAAAA,CAAC,CAACS,IAAN,CAHb,CADK,CAML,CAEIF,eAAe,CAAEvB,CAAU,CAACK,aAFhC,CAGImB,MAAM,CAAE,gBAAAR,CAAC,QAAe,KAAX,GAAAA,CAAC,CAACS,IAAN,CAHb,CANK,CAWL,CAEIF,eAAe,CAAEvB,CAAU,CAACO,gBAFhC,CAGIiB,MAAM,CAAE,gBAAAR,CAAC,QAAe,QAAX,GAAAA,CAAC,CAACS,IAAN,CAHb,CAXK,CAgBL,CAEIF,eAAe,CAAEvB,CAAU,CAACI,iBAFhC,CAGIoB,MAAM,CAAE,gBAAAR,CAAC,QAAc,GAAV,GAAAA,CAAC,CAACU,GAAN,CAHb,CAhBK,CAqBL,CAEIH,eAAe,CAAEvB,CAAU,CAACS,iBAFhC,CAGIe,MAAM,CAAE,gBAAAR,CAAC,CAAI,CACT,GAAID,CAAiB,CAACC,CAAD,CAArB,CAA0B,CACtB,QACH,CAED,GAAe,OAAX,GAAAA,CAAC,CAACS,IAAN,CAAwB,CACpB,QACH,CAED,GAAe,OAAX,GAAAT,CAAC,CAACS,IAAN,CAAwB,CACpB,QACH,CAED,QACH,CAjBL,CArBK,CAwCL,CAEIF,eAAe,CAAEvB,CAAU,CAACM,eAFhC,CAGIkB,MAAM,CAAE,gBAAAR,CAAC,CAAI,CACT,MAAkB,OAAX,GAAAA,CAAC,CAACS,IAAF,EAAsB,CAACV,CAAiB,CAACC,CAAD,CAClD,CALL,CAxCK,CA+CL,CAEIO,eAAe,CAAEvB,CAAU,CAACE,gBAFhC,CAGIsB,MAAM,CAAE,gBAAAR,CAAC,CAAI,CACT,MAAkB,WAAX,GAAAA,CAAC,CAACS,IAAF,EAA0B,CAACV,CAAiB,CAACC,CAAD,CACtD,CALL,CA/CK,CAsDL,CAEIO,eAAe,CAAEvB,CAAU,CAACG,cAFhC,CAGIqB,MAAM,CAAE,gBAAAR,CAAC,CAAI,CACT,MAAkB,SAAX,GAAAA,CAAC,CAACS,IAAF,EAAwB,CAACV,CAAiB,CAACC,CAAD,CACpD,CALL,CAtDK,CA6DL,CAEIQ,MAAM,CAAE,gBAAAR,CAAC,CAAI,CACT,MAAkB,WAAX,GAAAA,CAAC,CAACS,IAAF,EAA0B,CAACV,CAAiB,CAACC,CAAD,CACtD,CAJL,CAKIW,uBAAuB,CAAE,kCAAM,CAC3B,GAA2C,KAAvC,GAAAC,QAAQ,CAACC,aAAT,CAAuB,MAAvB,EAA+BC,GAAnC,CAAkD,CAC9C,MAAO9B,CAAAA,CAAU,CAACa,kBACrB,CAFD,IAEO,CACH,MAAOb,CAAAA,CAAU,CAACY,cACrB,CACJ,CAXL,CA7DK,CA0EL,CAEIY,MAAM,CAAE,gBAAAR,CAAC,CAAI,CACT,MAAkB,YAAX,GAAAA,CAAC,CAACS,IAAF,EAA2B,CAACV,CAAiB,CAACC,CAAD,CACvD,CAJL,CAKIW,uBAAuB,CAAE,kCAAM,CAC3B,GAA2C,KAAvC,GAAAC,QAAQ,CAACC,aAAT,CAAuB,MAAvB,EAA+BC,GAAnC,CAAkD,CAC9C,MAAO9B,CAAAA,CAAU,CAACY,cACrB,CAFD,IAEO,CACH,MAAOZ,CAAAA,CAAU,CAACa,kBACrB,CACJ,CAXL,CA1EK,CAuFL,CAEIU,eAAe,CAAEvB,CAAU,CAACW,UAFhC,CAGIa,MAAM,CAAE,gBAAAR,CAAC,CAAI,CACT,GAAe,QAAX,GAAAA,CAAC,CAACS,IAAN,CAAyB,CACrB,QACH,CAED,MAAOT,CAAAA,CAAC,CAACI,OACZ,CATL,CAvFK,CAkGL,CAEIG,eAAe,CAAEvB,CAAU,CAACU,YAFhC,CAGIc,MAAM,CAAE,gBAAAR,CAAC,CAAI,CACT,GAAe,UAAX,GAAAA,CAAC,CAACS,IAAN,CAA2B,CACvB,QACH,CAED,MAAOT,CAAAA,CAAC,CAACI,OACZ,CATL,CAlGK,CADY,CA+GrB,oCAAqC,CACjC,CAEIG,eAAe,CAAEvB,CAAU,CAACC,SAFhC,CAGIuB,MAAM,CAAE,2BAHZ,CADiC,CA/GhB,CAsHrBO,KAAK,CAAE,CACH,CAEIR,eAAe,CAAEvB,CAAU,CAACC,SAFhC,CAGIuB,MAAM,CAAE,2BAHZ,CADG,CAtHc,C,CA+HnBQ,CAAe,CAAG,E,CACxBA,CAAe,CAAChC,CAAU,CAACc,gBAAZ,CAAf,CAA+C,CAE3CmB,eAAe,CAAE,QAF0B,CAG3CV,eAAe,CAAEvB,CAAU,CAACc,gBAHe,CAI3CU,MAAM,CAAE,gBAAAR,CAAC,CAAI,CACT,GAAIA,CAAC,CAACkB,MAAF,GAAaN,QAAjB,CAA2B,CACvB,MAA4B,EAArB,GAAAO,MAAM,CAACC,SACjB,CAFD,IAEO,CACH,MAA8B,EAAvB,GAAApB,CAAC,CAACkB,MAAF,CAASE,SACnB,CACJ,CAV0C,CAA/C,CAaAJ,CAAe,CAAChC,CAAU,CAACqC,mBAAZ,CAAf,CAAkD,CAE9CJ,eAAe,CAAE,QAF6B,CAG9CV,eAAe,CAAEvB,CAAU,CAACqC,mBAHkB,CAI9Cb,MAAM,CAAE,gBAAAR,CAAC,CAAI,CACT,GAAIsB,CAAAA,CAAJ,CACA,GAAItB,CAAC,CAACkB,MAAF,GAAaN,QAAjB,CAA2B,CACvBU,CAAe,CAAGV,QAAQ,CAACW,gBAC9B,CAFD,IAEO,CACHD,CAAe,CAAGtB,CAAC,CAACkB,MACvB,CAED,MAAQI,CAAAA,CAAe,CAACF,SAAhB,CAA4BE,CAAe,CAACE,YAA7C,EAA8DF,CAAe,CAACG,YACxF,CAb6C,CAAlD,CAgBO,GAAMC,CAAAA,CAAc,CAAG,CAC1B,eAAgB1C,CAAU,CAACC,SADD,CAE1B,cAAeD,CAAU,CAACI,iBAFA,CAG1B,mBAAoBJ,CAAU,CAACU,YAHL,CAI1B,iBAAkBV,CAAU,CAACW,UAJH,CAK1B,WAAYX,CAAU,CAACE,gBALG,CAM1B,UAAWF,CAAU,CAACK,aANI,CAO1B,YAAaL,CAAU,CAACM,eAPE,CAQ1B,aAAcN,CAAU,CAACO,gBARC,CAS1B,WAAYP,CAAU,CAACQ,cATG,CAU1B,uBAAwBR,CAAU,CAACS,iBAVT,CAW1B,WAAYT,CAAU,CAACY,cAXG,CAY1B,eAAgBZ,CAAU,CAACa,kBAZD,CAa1B,SAAUb,CAAU,CAACG,cAbK,CAc1B,gBAAiBH,CAAU,CAACc,gBAdF,CAe1B,mBAAoBd,CAAU,CAACqC,mBAfL,CAAvB,C,sBAkBDM,CAAAA,CAAgB,CAAG,SAAC3B,CAAD,CAAI4B,CAAJ,CAAqB,CAC1C,GAAI,CAACA,CAAY,CAACpB,MAAb,CAAoBR,CAApB,CAAL,CAA6B,CAEzB,MACH,CAED,GAAIO,CAAAA,CAAe,CAAGqB,CAAY,CAACrB,eAAnC,CACA,GAAIqB,CAAY,CAACC,cAAb,CAA4BD,CAAY,CAACjB,uBAAzC,CAAJ,CAAuE,CACnEJ,CAAe,CAAGqB,CAAY,CAACjB,uBAAb,CAAqCX,CAArC,CACrB,CAGD,GAAM8B,CAAAA,CAAW,CAAG,oBAAcvB,CAAd,CAA+B,EAA/B,CAAmCP,CAAC,CAACkB,MAArC,CAA6C,CAC7Da,UAAU,CAAE/B,CAAC,CAAC+B,UAD+C,CAA7C,CAApB,CAIA,GAAID,CAAW,CAACE,gBAAhB,CAAkC,CAC9BhC,CAAC,CAACiC,cAAF,EACH,CAGJ,C,CAEGC,CAAgB,G,CAEpB,GAAI,CAACA,CAAL,CAAuB,CACnBA,CAAgB,GAAhB,CAEA,qCAAYC,CAAZ,MAAuBC,CAAvB,MAEIxB,QAAQ,CAACyB,gBAAT,CAA0BF,CAA1B,CAAqC,SAAAnC,CAAC,CAAI,CACtCoC,CAAgB,CAACE,OAAjB,CAAyB,SAAAV,CAAY,QAAID,CAAAA,CAAgB,CAAC3B,CAAD,CAAI4B,CAAJ,CAApB,CAArC,CACH,CAFD,CAFJ,QAA4CW,MAAM,CAACC,OAAP,CAAenC,CAAf,CAA5C,gBAA8E,IAK7E,CACJ,C,QAEoB,QAARoC,CAAAA,KAAQ,CAACC,CAAD,CAAUC,CAAV,CAAwB,CACzC,GAAI,CAAC3B,CAAe,CAACa,cAAhB,CAA+Bc,CAA/B,CAAL,CAAgD,CAC5C,MACH,CAED,GAAMf,CAAAA,CAAY,CAAGZ,CAAe,CAAC2B,CAAD,CAApC,CAEAD,CAAO,CAACL,gBAAR,CAAyBT,CAAY,CAACX,eAAtC,CAAuD,SAAAjB,CAAC,CAAI,CACxD2B,CAAgB,CAAC3B,CAAD,CAAI4B,CAAJ,CACnB,CAFD,CAGH,C,UAEqB,QAATgB,CAAAA,MAAS,CAACC,CAAD,CAAcC,CAAd,CAAmC,CACrD,GAAI,CAACA,CAAgB,CAACC,MAAtB,CAA8B,CAE1B,MACH,CAED5B,MAAM,CAAC6B,OAAP,CAAeC,IAAf,CACI,8FACcH,CAAgB,CAACI,IAAjB,CAAsB,IAAtB,CADd,8BADJ,EAKAJ,CAAgB,CAACR,OAAjB,CAAyB,SAAAa,CAAe,CAAI,CACxC,GAAI,CAACzB,CAAc,CAACG,cAAf,CAA8BsB,CAA9B,CAAL,CAAqD,CAEjD,MACH,CAED,GAAMC,CAAAA,CAAY,WAAM1B,CAAc,CAACyB,CAAD,CAApB,QAAlB,CAEA,cAAON,CAAP,EAGCQ,GAHD,CAGKD,CAHL,EAMCE,EAND,CAMIF,CANJ,CAMkB,SAAApD,CAAC,CAAI,CACnB,cAAOA,CAAC,CAACkB,MAAT,EAAiBqC,OAAjB,CAAyBJ,CAAzB,CAA0C,CAAC,CAACK,aAAa,CAAExD,CAAhB,CAAD,CAA1C,CACH,CARD,CASH,CAjBD,CAkBH,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/ //\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Key Events.\n *\n * @module     core/key_events\n * @package    core\n * @class      key_events\n * @copyright  2021 Andrew Nicols <andrew@nicols.co.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.11\n */\n\nimport jQuery from 'jquery';\nimport {dispatchEvent} from 'core/local/event/dispatcher';\n\nexport const eventTypes = {\n    activated: 'core/key_events:activated',\n    arrowDownPressed: 'core/key_events:arrowDownPressed',\n    arrowUpPressed: 'core/key_events:arrowUpPressed',\n    asterixKeyPressed: 'core/key_events:asterixKeyPressed',\n    endKeyPressed: 'core/key_events:endKeyPressed',\n    enterKeyPressed: 'core/key_events:enterKeyPressed',\n    escapeKeyPressed: 'core/key_events:escapeKeyPressed',\n    homeKeyPressed: 'core/key_events:homeKeyPressed',\n    keyboardActivated: 'core/key_events:keyboardActivated',\n    metaPageDown: 'core/key_events:metaPageDown',\n    metaPageUp: 'core/key_events:metaPageUp',\n    nextKeyPressed: 'core/key_events:nextKeyPressed',\n    previousKeyPressed: 'core/key_events:previousKeyPressed',\n    scrollTopReached: 'core/key_events:scrollTopReached',\n};\n\n/**\n * Check if any of the modifier keys have been pressed on the event.\n *\n * @method  isModifierPressed\n * @param   {Event} e\n * @returns {bool}\n */\nconst isModifierPressed = e => {\n    return (e.shiftKey || e.metaKey || e.altKey || e.ctrlKey);\n};\n\nconst documentEventMap = {\n    keydown: [\n        {\n            // This event is triggered when the escape key key is pressed.\n            customEventName: eventTypes.homeKeyPressed,\n            filter: e => e.code === 'Home',\n        },\n        {\n            // This event is triggered when the end key key is pressed.\n            customEventName: eventTypes.endKeyPressed,\n            filter: e => e.code === 'End',\n        },\n        {\n            // This event is triggered when the escape key key is pressed.\n            customEventName: eventTypes.escapeKeyPressed,\n            filter: e => e.code === 'Escape',\n        },\n        {\n            // This event is triggered when asterix key is pressed.\n            customEventName: eventTypes.asterixKeyPressed,\n            filter: e => e.key === '*',\n        },\n        {\n            // This event is triggered when enter or space are pressed without a modifier key.\n            customEventName: eventTypes.keyboardActivated,\n            filter: e => {\n                if (isModifierPressed(e)) {\n                    return false;\n                }\n\n                if (e.code === 'Enter') {\n                    return true;\n                }\n\n                if (e.code === 'Space') {\n                    return true;\n                }\n\n                return false;\n            },\n        },\n        {\n            // This event is triggered on click.\n            customEventName: eventTypes.enterKeyPressed,\n            filter: e => {\n                return e.code === 'Enter' && !isModifierPressed(e);\n            },\n        },\n        {\n            // This event is triggered when down key is pressed without a modifier key.\n            customEventName: eventTypes.arrowDownPressed,\n            filter: e => {\n                return e.code === 'ArrowDown' && !isModifierPressed(e);\n            },\n        },\n        {\n            // This event is triggered when up key is pressed without a modifier key.\n            customEventName: eventTypes.arrowUpPressed,\n            filter: e => {\n                return e.code === 'ArrowUp' && !isModifierPressed(e);\n            },\n        },\n        {\n            // This event is triggered when left key is pressed without a modifier key.\n            filter: e => {\n                return e.code === 'ArrowLeft' && !isModifierPressed(e);\n            },\n            customEventNameFunction: () => {\n                if (document.querySelector('html').dir === 'ltr') {\n                    return eventTypes.previousKeyPressed;\n                } else {\n                    return eventTypes.nextKeyPressed;\n                }\n            },\n        },\n        {\n            // This event is triggered when right key is pressed without a modifier key.\n            filter: e => {\n                return e.code === 'ArrowRight' && !isModifierPressed(e);\n            },\n            customEventNameFunction: () => {\n                if (document.querySelector('html').dir === 'ltr') {\n                    return eventTypes.nextKeyPressed;\n                } else {\n                    return eventTypes.previousKeyPressed;\n                }\n            },\n        },\n        {\n            // This event is triggered when PageUp key is pressed with the Control modifier key.\n            customEventName: eventTypes.metaPageUp,\n            filter: e => {\n                if (e.code !== 'PageUp') {\n                    return false;\n                }\n\n                return e.ctrlKey;\n            },\n        },\n        {\n            // This event is triggered when PageDown key is pressed with the Control modifier key.\n            customEventName: eventTypes.metaPageDown,\n            filter: e => {\n                if (e.code !== 'PageDown') {\n                    return false;\n                }\n\n                return e.ctrlKey;\n            },\n        },\n    ],\n    'core/key_events:keyboardActivated': [\n        {\n            // This event is triggered when enter or space are pressed without a modifier key.\n            customEventName: eventTypes.activated,\n            filter: () => true,\n        },\n    ],\n    click: [\n        {\n            // This event is triggered when the keyboardActivated event is triggered.\n            customEventName: eventTypes.activated,\n            filter: () => true,\n        },\n    ],\n};\n\nconst elementEventMap = {};\nelementEventMap[eventTypes.scrollTopReached] = {\n    // This event is triggered when a user scrolls to the top of the given element.\n    nativeEventName: 'scroll',\n    customEventName: eventTypes.scrollTopReached,\n    filter: e => {\n        if (e.target === document) {\n            return window.scrollTop === 0;\n        } else {\n            return e.target.scrollTop === 0;\n        }\n    },\n};\n\nelementEventMap[eventTypes.scrollBottomReached] = {\n    // This event is triggered when a user scrolls to the top of the given element.\n    nativeEventName: 'scroll',\n    customEventName: eventTypes.scrollBottomReached,\n    filter: e => {\n        let scrolledElement;\n        if (e.target === document) {\n            scrolledElement = document.scrollingElement;\n        } else {\n            scrolledElement = e.target;\n        }\n\n        return (scrolledElement.scrollTop + scrolledElement.offsetHeight) >= scrolledElement.scrollHeight;\n    },\n};\n\nexport const legacyEventMap = {\n    'cie:activate': eventTypes.activated,\n    'cie:asterix': eventTypes.asterixKeyPressed,\n    'cie:ctrlPageDown': eventTypes.metaPageDown,\n    'cie:ctrlPageUp': eventTypes.metaPageUp,\n    'cie:down': eventTypes.arrowDownPressed,\n    'cie:end': eventTypes.endKeyPressed,\n    'cie:enter': eventTypes.enterKeyPressed,\n    'cie:escape': eventTypes.escapeKeyPressed,\n    'cie:home': eventTypes.homeKeyPressed,\n    'cie:keyboardactivate': eventTypes.keyboardActivated,\n    'cie:next': eventTypes.nextKeyPressed,\n    'cie:previous': eventTypes.previousKeyPressed,\n    'cie:up': eventTypes.arrowUpPressed,\n    'cie:scrollTop': eventTypes.scrollTopReached,\n    'cie:scrollBottom': eventTypes.scrollBottomReached,\n};\n\nconst handleFiredEvent = (e, eventDetails) => {\n    if (!eventDetails.filter(e)) {\n        // This event does not meet the filter requirements.\n        return;\n    }\n\n    let customEventName = eventDetails.customEventName;\n    if (eventDetails.hasOwnProperty(eventDetails.customEventNameFunction)) {\n        customEventName = eventDetails.customEventNameFunction(e);\n    }\n\n    // Fire the custom event.\n    const customEvent = dispatchEvent(customEventName, {}, e.target, {\n        cancelable: e.cancelable,\n    });\n\n    if (customEvent.defaultPrevented) {\n        e.preventDefault();\n    }\n\n    return;\n};\n\nlet eventsRegistered = false;\n\nif (!eventsRegistered) {\n    eventsRegistered = true;\n\n    for (const [eventType, eventTypeDetails] of Object.entries(documentEventMap)) {\n        // Only register each event listener once.\n        document.addEventListener(eventType, e => {\n            eventTypeDetails.forEach(eventDetails => handleFiredEvent(e, eventDetails));\n        });\n    }\n}\n\nexport const watch = (element, eventName) => {\n    if (!elementEventMap.hasOwnProperty(eventName)) {\n        return;\n    }\n\n    const eventDetails = elementEventMap[eventName];\n\n    element.addEventListener(eventDetails.nativeEventName, e => {\n        handleFiredEvent(e, eventDetails);\n    });\n};\n\nexport const define = (elementList, legacyEventNames) => {\n    if (!legacyEventNames.length) {\n        // No events requested.\n        return;\n    }\n\n    window.console.warn(\n        `The custom_interaction_events::define() function has been deprecated. ` +\n        `The use of ${legacyEventNames.join(', ')} events should be updated.`\n    );\n\n    legacyEventNames.forEach(legacyEventName => {\n        if (!legacyEventMap.hasOwnProperty(legacyEventName)) {\n            // Unknown event.\n            return;\n        }\n\n        const newEventName = `${legacyEventMap[legacyEventName]}.cie`;\n\n        jQuery(elementList)\n\n        // Ensure that there is only one listener.\n        .off(newEventName)\n\n        // Listen to the new event and trigger the legacy one.\n        .on(newEventName, e => {\n            jQuery(e.target).trigger(legacyEventName, [{originalEvent: e}]);\n        });\n    });\n};\n"],"file":"key_events.min.js"}