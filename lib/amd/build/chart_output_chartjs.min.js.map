{"version":3,"sources":["../src/chart_output_chartjs.js"],"names":["define","$","Chartjs","Axis","Bar","Base","Line","Pie","Series","makeAxisId","xy","index","Output","prototype","constructor","apply","arguments","_canvas","_node","prop","append","_build","Object","create","_config","_chartjs","_makeConfig","_cleanData","data","Array","map","value","html","text","_getChartType","type","_chart","getType","TYPE","getHorizontal","getDoughnut","_makeAxisConfig","axis","scaleData","id","getPosition","POS_DEFAULT","position","getLabel","scaleLabel","display","labelString","getStepSize","ticks","stepSize","getMax","max","getMin","min","config","labels","getLabels","datasets","_makeDatasetsConfig","options","title","getTitle","legendOptions","getLegendOptions","legend","getXAxes","forEach","i","axisLabels","scales","xAxes","callback","stacked","_isStacked","bind","getYAxes","yAxes","parseInt","tooltips","callbacks","label","_makeTooltip","sets","getSeries","series","colors","hasColoredValues","getColors","getColor","dataset","getValues","fill","getFill","backgroundColor","borderColor","lineTension","_isSmooth","getXAxis","xAxisID","getYAxis","yAxisID","tooltipItem","datasetIndex","serieLabel","serieLabels","chartData","tooltipData","tooltip","xLabel","yLabel","chartLabels","push","smooth","getSmooth","TYPE_LINE","getStacked","update","extend"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Chart output for chart.js.\n *\n * @copyright  2016 Frédéric Massart - FMCorz.net\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @module     core/chart_output_chartjs\n */\ndefine([\n    'jquery',\n    'core/chartjs',\n    'core/chart_axis',\n    'core/chart_bar',\n    'core/chart_output_base',\n    'core/chart_line',\n    'core/chart_pie',\n    'core/chart_series'\n], function($, Chartjs, Axis, Bar, Base, Line, Pie, Series) {\n\n    /**\n     * Makes an axis ID.\n     *\n     * @param {String} xy Accepts 'x' and 'y'.\n     * @param {Number} index The axis index.\n     * @return {String}\n     */\n    var makeAxisId = function(xy, index) {\n        return 'axis-' + xy + '-' + index;\n    };\n\n    /**\n     * Chart output for Chart.js.\n     *\n     * @class\n     * @extends {module:core/chart_output_base}\n     */\n    function Output() {\n        Base.prototype.constructor.apply(this, arguments);\n\n        // Make sure that we've got a canvas tag.\n        this._canvas = this._node;\n        if (this._canvas.prop('tagName') != 'CANVAS') {\n            this._canvas = $('<canvas>');\n            this._node.append(this._canvas);\n        }\n\n        this._build();\n    }\n    Output.prototype = Object.create(Base.prototype);\n\n    /**\n     * Reference to the chart config object.\n     *\n     * @type {Object}\n     * @protected\n     */\n    Output.prototype._config = null;\n\n    /**\n     * Reference to the instance of chart.js.\n     *\n     * @type {Object}\n     * @protected\n     */\n    Output.prototype._chartjs = null;\n\n    /**\n     * Reference to the canvas node.\n     *\n     * @type {Jquery}\n     * @protected\n     */\n    Output.prototype._canvas = null;\n\n    /**\n     * Builds the config and the chart.\n     *\n     * @protected\n     */\n    Output.prototype._build = function() {\n        this._config = this._makeConfig();\n        this._chartjs = new Chartjs(this._canvas[0], this._config);\n    };\n\n    /**\n     * Clean data.\n     *\n     * @param {(String|String[])} data A single string or an array of strings.\n     * @returns {(String|String[])}\n     * @protected\n     */\n    Output.prototype._cleanData = function(data) {\n        if (data instanceof Array) {\n            return data.map(function(value) {\n                return $('<span>').html(value).text();\n            });\n        } else {\n            return $('<span>').html(data).text();\n        }\n    };\n\n    /**\n     * Get the chart type and handles the Chart.js specific chart types.\n     *\n     * By default returns the current chart TYPE value. Also does the handling of specific chart types, for example\n     * check if the bar chart should be horizontal and the pie chart should be displayed as a doughnut.\n     *\n     * @method getChartType\n     * @returns {String} the chart type.\n     * @protected\n     */\n    Output.prototype._getChartType = function() {\n        var type = this._chart.getType();\n\n        // Bars can be displayed vertically and horizontally, defining horizontalBar type.\n        if (this._chart.getType() === Bar.prototype.TYPE && this._chart.getHorizontal() === true) {\n            type = 'horizontalBar';\n        } else if (this._chart.getType() === Pie.prototype.TYPE && this._chart.getDoughnut() === true) {\n            // Pie chart can be displayed as doughnut.\n            type = 'doughnut';\n        }\n\n        return type;\n    };\n\n    /**\n     * Make the axis config.\n     *\n     * @protected\n     * @param {module:core/chart_axis} axis The axis.\n     * @param {String} xy Accepts 'x' or 'y'.\n     * @param {Number} index The axis index.\n     * @return {Object} The axis config.\n     */\n    Output.prototype._makeAxisConfig = function(axis, xy, index) {\n        var scaleData = {\n            id: makeAxisId(xy, index)\n        };\n\n        if (axis.getPosition() !== Axis.prototype.POS_DEFAULT) {\n            scaleData.position = axis.getPosition();\n        }\n\n        if (axis.getLabel() !== null) {\n            scaleData.scaleLabel = {\n                display: true,\n                labelString: this._cleanData(axis.getLabel())\n            };\n        }\n\n        if (axis.getStepSize() !== null) {\n            scaleData.ticks = scaleData.ticks || {};\n            scaleData.ticks.stepSize = axis.getStepSize();\n        }\n\n        if (axis.getMax() !== null) {\n            scaleData.ticks = scaleData.ticks || {};\n            scaleData.ticks.max = axis.getMax();\n        }\n\n        if (axis.getMin() !== null) {\n            scaleData.ticks = scaleData.ticks || {};\n            scaleData.ticks.min = axis.getMin();\n        }\n\n        return scaleData;\n    };\n\n    /**\n     * Make the config config.\n     *\n     * @protected\n     * @return {Object} The axis config.\n     */\n    Output.prototype._makeConfig = function() {\n        var config = {\n            type: this._getChartType(),\n            data: {\n                labels: this._cleanData(this._chart.getLabels()),\n                datasets: this._makeDatasetsConfig()\n            },\n            options: {\n                title: {\n                    display: this._chart.getTitle() !== null,\n                    text: this._cleanData(this._chart.getTitle())\n                }\n            }\n        };\n        var legendOptions = this._chart.getLegendOptions();\n        if (legendOptions) {\n            config.options.legend = legendOptions;\n        }\n\n\n        this._chart.getXAxes().forEach(function(axis, i) {\n            var axisLabels = axis.getLabels();\n\n            config.options.scales = config.options.scales || {};\n            config.options.scales.xAxes = config.options.scales.xAxes || [];\n            config.options.scales.xAxes[i] = this._makeAxisConfig(axis, 'x', i);\n\n            if (axisLabels !== null) {\n                config.options.scales.xAxes[i].ticks.callback = function(value, index) {\n                    return axisLabels[index] || '';\n                };\n            }\n            config.options.scales.xAxes[i].stacked = this._isStacked();\n        }.bind(this));\n\n        this._chart.getYAxes().forEach(function(axis, i) {\n            var axisLabels = axis.getLabels();\n\n            config.options.scales = config.options.scales || {};\n            config.options.scales.yAxes = config.options.scales.yAxes || [];\n            config.options.scales.yAxes[i] = this._makeAxisConfig(axis, 'y', i);\n\n            if (axisLabels !== null) {\n                config.options.scales.yAxes[i].ticks.callback = function(value) {\n                    return axisLabels[parseInt(value, 10)] || '';\n                };\n            }\n            config.options.scales.yAxes[i].stacked = this._isStacked();\n        }.bind(this));\n\n        config.options.tooltips = {\n            callbacks: {\n                label: this._makeTooltip.bind(this)\n            }\n        };\n\n        return config;\n    };\n\n    /**\n     * Get the datasets configurations.\n     *\n     * @protected\n     * @return {Object[]}\n     */\n    Output.prototype._makeDatasetsConfig = function() {\n        var sets = this._chart.getSeries().map(function(series) {\n            var colors = series.hasColoredValues() ? series.getColors() : series.getColor();\n            var dataset = {\n                label: this._cleanData(series.getLabel()),\n                data: series.getValues(),\n                type: series.getType(),\n                fill: series.getFill(),\n                backgroundColor: colors,\n                // Pie charts look better without borders.\n                borderColor: this._chart.getType() == Pie.prototype.TYPE ? '#fff' : colors,\n                lineTension: this._isSmooth(series) ? 0.3 : 0\n            };\n\n            if (series.getXAxis() !== null) {\n                dataset.xAxisID = makeAxisId('x', series.getXAxis());\n            }\n            if (series.getYAxis() !== null) {\n                dataset.yAxisID = makeAxisId('y', series.getYAxis());\n            }\n\n            return dataset;\n        }.bind(this));\n        return sets;\n    };\n\n    /**\n     * Get the chart data, add labels and rebuild the tooltip.\n     *\n     * @param {Object[]} tooltipItem The tooltip item data.\n     * @param {Object[]} data The chart data.\n     * @returns {String}\n     * @protected\n     */\n    Output.prototype._makeTooltip = function(tooltipItem, data) {\n\n        // Get series and chart data to rebuild the tooltip and add labels.\n        var series = this._chart.getSeries()[tooltipItem.datasetIndex];\n        var serieLabel = series.getLabel();\n        var serieLabels = series.getLabels();\n        var chartData = data.datasets[tooltipItem.datasetIndex].data;\n        var tooltipData = chartData[tooltipItem.index];\n\n        // Build default tooltip.\n        var tooltip = [];\n\n        // Pie and doughnut charts does not have axis.\n        if (tooltipItem.xLabel == '' && tooltipItem.yLabel == '') {\n            var chartLabels = this._cleanData(this._chart.getLabels());\n            tooltip.push(chartLabels[tooltipItem.index]);\n        }\n\n        // Add series labels to the tooltip if any.\n        if (serieLabels !== null) {\n            tooltip.push(this._cleanData(serieLabels[tooltipItem.index]));\n        } else {\n            tooltip.push(this._cleanData(serieLabel) + ': ' + tooltipData);\n        }\n\n        return tooltip;\n    };\n\n    /**\n     * Verify if the chart line is smooth or not.\n     *\n     * @protected\n     * @param {module:core/chart_series} series The series.\n     * @returns {Bool}\n     */\n    Output.prototype._isSmooth = function(series) {\n        var smooth = false;\n        if (this._chart.getType() === Line.prototype.TYPE) {\n            smooth = series.getSmooth();\n            if (smooth === null) {\n                smooth = this._chart.getSmooth();\n            }\n        } else if (series.getType() === Series.prototype.TYPE_LINE) {\n            smooth = series.getSmooth();\n        }\n\n        return smooth;\n    };\n\n    /**\n     * Verify if the bar chart is stacked or not.\n     *\n     * @protected\n     * @returns {Bool}\n     */\n    Output.prototype._isStacked = function() {\n        var stacked = false;\n\n        // Stacking is (currently) only supported for bar charts.\n        if (this._chart.getType() === Bar.prototype.TYPE) {\n            stacked = this._chart.getStacked();\n        }\n\n        return stacked;\n    };\n\n    /** @override */\n    Output.prototype.update = function() {\n        $.extend(true, this._config, this._makeConfig());\n        this._chartjs.update();\n    };\n\n    return Output;\n\n});\n"],"file":"chart_output_chartjs.min.js"}