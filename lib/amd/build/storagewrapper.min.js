define ("core/storagewrapper",["core/config"],function(config){var Wrapper=function(storage){this.storage=storage;this.supported=this.detectSupport();this.hashSource=config.wwwroot+"/"+config.jsrev;this.hash=this.hashString(this.hashSource);this.prefix=this.hash+"/";this.jsrevPrefix=this.hashString(config.wwwroot)+"/jsrev";this.validateCache()};Wrapper.prototype.detectSupport=function(){if(-1==config.jsrev){return!1}if("undefined"==typeof this.storage){return!1}try{if(null===this.storage){return!1}this.storage.setItem("test","1");this.storage.removeItem("test");return!0}catch(ex){return!1}};Wrapper.prototype.prefixKey=function(key){return this.prefix+key};Wrapper.prototype.validateCache=function(){var cacheVersion=this.storage.getItem(this.jsrevPrefix);if(null===cacheVersion){this.storage.setItem(this.jsrevPrefix,config.jsrev);return}var moodleVersion=config.jsrev;if(moodleVersion!=cacheVersion){this.storage.clear();this.storage.setItem(this.jsrevPrefix,config.jsrev)}};Wrapper.prototype.hashString=function(source){var hash=0,i,chr,len;if(0===source.length){return hash}for(i=0,len=source.length;i<len;i++){chr=source.charCodeAt(i);hash=(hash<<5)-hash+chr;hash|=0}return hash};Wrapper.prototype.get=function(key){if(!this.supported){return!1}key=this.prefixKey(key);return this.storage.getItem(key)};Wrapper.prototype.set=function(key,value){if(!this.supported){return!1}key=this.prefixKey(key);try{this.storage.setItem(key,value)}catch(e){return!1}return!0};return Wrapper});
//# sourceMappingURL=storagewrapper.min.js.map
