define ("core/paged_content_factory",["jquery","core/templates","core/notification","core/paged_content","core/paged_content_events","core/pubsub","core/ajax"],function($,Templates,Notification,PagedContent,PagedContentEvents,PubSub,Ajax){var TEMPLATES={PAGED_CONTENT:"core/paged_content"},DEFAULT={ITEMS_PER_PAGE_SINGLE:25,ITEMS_PER_PAGE_ARRAY:[25,50,100,0],MAX_PAGES:3},getDefaultTemplateContext=function(){return{pagingbar:!1,pagingdropdown:!1,skipjs:!0,ignorecontrolwhileloading:!0,controlplacementbottom:!1}},getDefaultPagingBarTemplateContext=function(){return{showitemsperpageselector:!1,itemsperpage:[{value:35,active:!0}],previous:!0,next:!0,activepagenumber:1,hidecontrolonsinglepage:!0,pages:[]}},calculateNumberOfPages=function(numberOfItems,itemsPerPage){var numberOfPages=1;if(0<numberOfItems){var partial=numberOfItems%itemsPerPage;if(partial){numberOfItems-=partial;numberOfPages=numberOfItems/itemsPerPage+1}else{numberOfPages=numberOfItems/itemsPerPage}}return numberOfPages},buildPagingBarTemplateContextKnownLength=function(numberOfItems,itemsPerPage){if(null===itemsPerPage){itemsPerPage=DEFAULT.ITEMS_PER_PAGE_SINGLE}if($.isArray(itemsPerPage)){itemsPerPage=itemsPerPage[0]}var context=getDefaultPagingBarTemplateContext();context.itemsperpage=buildItemsPerPagePagingBarContext(itemsPerPage);for(var numberOfPages=calculateNumberOfPages(numberOfItems,itemsPerPage),i=1,page;i<=numberOfPages;i++){page={number:i,page:""+i};if(1==i){page.active=!0}context.pages.push(page)}context.barsize=10;return context},buildItemsPerPagePagingBarContext=function(itemsPerPage){var context=[];if($.isArray(itemsPerPage)){context=itemsPerPage.map(function(num){if("number"==typeof num){return{value:num,active:!1}}else{return num}});var activeItems=context.filter(function(item){return item.active});if(!activeItems.length){context[0].active=!0}}else{context=[{value:itemsPerPage,active:!0}]}return context},buildPagingBarTemplateContextUnknownLength=function(itemsPerPage){if(null===itemsPerPage){itemsPerPage=DEFAULT.ITEMS_PER_PAGE_ARRAY}var context=getDefaultPagingBarTemplateContext();context.itemsperpage=buildItemsPerPagePagingBarContext(itemsPerPage);context.showitemsperpageselector=$.isArray(itemsPerPage)&&1<itemsPerPage.length;return context},buildPagingBarTemplateContext=function(numberOfItems,itemsPerPage){if(numberOfItems){return buildPagingBarTemplateContextKnownLength(numberOfItems,itemsPerPage)}else{return buildPagingBarTemplateContextUnknownLength(itemsPerPage)}},buildPagingDropdownTemplateContext=function(itemsPerPage,config){if(null===itemsPerPage){itemsPerPage=DEFAULT.ITEMS_PER_PAGE_SINGLE}if($.isArray(itemsPerPage)){return{options:itemsPerPage}}var context={options:[]},totalItems=0,lastIncrease=0,maxPages=DEFAULT.MAX_PAGES;if(config.hasOwnProperty("maxPages")){maxPages=config.maxPages}for(var i=1,itemCount;i<=maxPages;i++){itemCount=0;if(2>=i){itemCount=itemsPerPage;lastIncrease=itemsPerPage}else{lastIncrease=2*lastIncrease;itemCount=lastIncrease}totalItems+=itemCount;var option={itemcount:itemCount,content:totalItems};if(1==i){option.active=!0}context.options.push(option)}return context},buildTemplateContext=function(numberOfItems,itemsPerPage,config){var context=getDefaultTemplateContext();if(config.hasOwnProperty("ignoreControlWhileLoading")){context.ignorecontrolwhileloading=config.ignoreControlWhileLoading}if(config.hasOwnProperty("controlPlacementBottom")){context.controlplacementbottom=config.controlPlacementBottom}if(config.hasOwnProperty("hideControlOnSinglePage")){context.hidecontrolonsinglepage=config.hideControlOnSinglePage}if(config.hasOwnProperty("ariaLabels")){context.arialabels=config.ariaLabels}if(config.hasOwnProperty("dropdown")&&config.dropdown){context.pagingdropdown=buildPagingDropdownTemplateContext(itemsPerPage,config)}else{context.pagingbar=buildPagingBarTemplateContext(numberOfItems,itemsPerPage);if(config.hasOwnProperty("showFirstLast")&&config.showFirstLast){context.pagingbar.first=!0;context.pagingbar.last=!0}}return context},createWithTotalAndLimit=function(numberOfItems,itemsPerPage,renderPagesContentCallback,config){config=config||{};var deferred=$.Deferred(),templateContext=buildTemplateContext(numberOfItems,itemsPerPage,config);Templates.render(TEMPLATES.PAGED_CONTENT,templateContext).then(function(html,js){html=$(html);var id=html.attr("id");if(config.hasOwnProperty("eventNamespace")){id=config.eventNamespace}var container=html;PagedContent.init(container,renderPagesContentCallback,id);registerEvents(id,config);deferred.resolve(html,js)}).fail(function(exception){deferred.reject(exception)}).fail(Notification.exception);return deferred.promise()},generateLimitHandler=function(persistentLimitKey){return function callback(limit){Ajax.call([{methodname:"core_user_update_user_preferences",args:{preferences:[{type:persistentLimitKey,value:limit}]}}])}},registerEvents=function(namespace,config){if(config.hasOwnProperty("persistentLimitKey")){PubSub.subscribe(namespace+PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT,generateLimitHandler(config.persistentLimitKey))}};return{create:function create(renderPagesContentCallback,config){return createWithTotalAndLimit(null,null,renderPagesContentCallback,config)},createWithLimit:function createWithLimit(itemsPerPage,renderPagesContentCallback,config){return createWithTotalAndLimit(null,itemsPerPage,renderPagesContentCallback,config)},createWithTotalAndLimit:createWithTotalAndLimit,createFromStaticList:function createFromStaticList(contentItems,itemsPerPage,renderContentCallback,config){if("undefined"==typeof config){config={}}var numberOfItems=contentItems.length;return createWithTotalAndLimit(numberOfItems,itemsPerPage,function(pagesData){var contentToRender=[];pagesData.forEach(function(pageData){var begin=pageData.offset,end=pageData.limit?begin+pageData.limit:numberOfItems,items=contentItems.slice(begin,end);contentToRender.push(items)});return renderContentCallback(contentToRender)},config)},createFromAjax:createWithTotalAndLimit,resetLastPageNumber:function resetLastPageNumber(id,lastPageNumber){PubSub.publish(id+PagedContentEvents.ALL_ITEMS_LOADED,lastPageNumber)}}});
//# sourceMappingURL=paged_content_factory.min.js.map
