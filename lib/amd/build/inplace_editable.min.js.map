{"version":3,"sources":["../src/inplace_editable.js"],"names":["define","$","ajax","templates","notification","str","cfg","url","autocomplete","Pending","on","e","type","keyCode","editingEnabledPromise","stopImmediatePropagation","preventDefault","target","mainelement","closest","addSpinner","element","addClass","spinner","find","length","show","attr","imageUrl","append","removeSpinner","removeClass","hide","updateValue","value","pendingId","join","pendingPromise","call","methodname","args","itemid","component","itemtype","then","data","render","html","js","oldvalue","newelement","replaceNode","focus","trigger","ajaxreturn","resolve","fail","ex","Event","exception","newvalue","M","util","js_complete","isDefaultPrevented","turnEditingOff","el","off","removeAttr","uniqueId","prefix","idlength","uniqid","i","Math","floor","random","turnEditingOnText","get_string","done","s","instr","inputelement","lbl","select","behatsiterunning","val","turnEditingOnToggle","turnEditingOnSelect","options","key","turnEditingOnAutocomplete","attributes","saveelement","cancelelement","multiple","JSON","parse","renderPix","enhance","tags","placeholder","caseSensitive","showSuggestions","noSelectionString","stringify","empty","turnEditingOffEverywhere","each","turnEditingOn","parseJSON"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AJAX helper for the inline editing a value.\n *\n * This script is automatically included from template core/inplace_editable\n * It registers a click-listener on [data-inplaceeditablelink] link (the \"inplace edit\" icon),\n * then replaces the displayed value with an input field. On \"Enter\" it sends a request\n * to web service core_update_inplace_editable, which invokes the specified callback.\n * Any exception thrown by the web service (or callback) is displayed as an error popup.\n *\n * @module     core/inplace_editable\n * @copyright  2016 Marina Glancy\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.1\n */\ndefine(['jquery',\n        'core/ajax',\n        'core/templates',\n        'core/notification',\n        'core/str',\n        'core/config',\n        'core/url',\n        'core/form-autocomplete',\n        'core/pending',\n    ],\n    function($, ajax, templates, notification, str, cfg, url, autocomplete, Pending) {\n\n    $('body').on('click keypress', '[data-inplaceeditable] [data-inplaceeditablelink]', function(e) {\n        if (e.type === 'keypress' && e.keyCode !== 13) {\n            return;\n        }\n        var editingEnabledPromise = new Pending('autocomplete-start-editing');\n        e.stopImmediatePropagation();\n        e.preventDefault();\n        var target = $(this),\n            mainelement = target.closest('[data-inplaceeditable]');\n\n        var addSpinner = function(element) {\n            element.addClass('updating');\n            var spinner = element.find('img.spinner');\n            if (spinner.length) {\n                spinner.show();\n            } else {\n                spinner = $('<img/>')\n                        .attr('src', url.imageUrl('i/loading_small'))\n                        .addClass('spinner').addClass('smallicon')\n                    ;\n                element.append(spinner);\n            }\n        };\n\n        var removeSpinner = function(element) {\n            element.removeClass('updating');\n            element.find('img.spinner').hide();\n        };\n\n        var updateValue = function(mainelement, value) {\n            var pendingId = [\n                    mainelement.attr('data-itemid'),\n                    mainelement.attr('data-component'),\n                    mainelement.attr('data-itemtype'),\n                ].join('-');\n            var pendingPromise = new Pending(pendingId);\n\n            addSpinner(mainelement);\n            ajax.call([{\n                methodname: 'core_update_inplace_editable',\n                args: {\n                    itemid: mainelement.attr('data-itemid'),\n                    component: mainelement.attr('data-component'),\n                    itemtype: mainelement.attr('data-itemtype'),\n                    value: value,\n                },\n            }])[0]\n            .then(function(data) {\n                return templates.render('core/inplace_editable', data)\n                .then(function(html, js) {\n                    var oldvalue = mainelement.attr('data-value');\n                    var newelement = $(html);\n                    templates.replaceNode(mainelement, newelement, js);\n                    newelement.find('[data-inplaceeditablelink]').focus();\n                    newelement.trigger({\n                        type: 'updated',\n                        ajaxreturn: data,\n                        oldvalue: oldvalue,\n                    });\n\n                    return;\n                });\n            })\n            .then(function() {\n                return pendingPromise.resolve();\n            })\n            .fail(function(ex) {\n                var e = $.Event('updatefailed', {\n                        exception: ex,\n                        newvalue: value\n                    });\n                removeSpinner(mainelement);\n                M.util.js_complete(pendingId);\n                mainelement.trigger(e);\n                if (!e.isDefaultPrevented()) {\n                    notification.exception(ex);\n                }\n            });\n        };\n\n        var turnEditingOff = function(el) {\n            el.find('input').off();\n            el.find('select').off();\n            el.html(el.attr('data-oldcontent'));\n            el.removeAttr('data-oldcontent');\n            el.removeClass('inplaceeditingon');\n            el.find('[data-inplaceeditablelink]').focus();\n        };\n\n        var turnEditingOffEverywhere = function() {\n            $('span.inplaceeditable.inplaceeditingon').each(function() {\n                turnEditingOff($(this));\n            });\n        };\n\n        var uniqueId = function(prefix, idlength) {\n            var uniqid = prefix,\n                i;\n            for (i = 0; i < idlength; i++) {\n                uniqid += String(Math.floor(Math.random() * 10));\n            }\n            // Make sure this ID is not already taken by an existing element.\n            if ($(\"#\" + uniqid).length === 0) {\n                return uniqid;\n            }\n            return uniqueId(prefix, idlength);\n        };\n\n        var turnEditingOnText = function(el) {\n            str.get_string('edittitleinstructions').done(function(s) {\n                var instr = $('<span class=\"editinstructions\">' + s + '</span>').\n                        attr('id', uniqueId('id_editinstructions_', 20)),\n                    inputelement = $('<input type=\"text\"/>').\n                        attr('id', uniqueId('id_inplacevalue_', 20)).\n                        attr('value', el.attr('data-value')).\n                        attr('aria-describedby', instr.attr('id')).\n                        addClass('ignoredirty').\n                        addClass('form-control'),\n                    lbl = $('<label class=\"accesshide\">' + mainelement.attr('data-editlabel') + '</label>').\n                        attr('for', inputelement.attr('id'));\n                el.html('').append(instr).append(lbl).append(inputelement);\n\n                inputelement.focus();\n                inputelement.select();\n                inputelement.on('keyup keypress focusout', function(e) {\n                    if (cfg.behatsiterunning && e.type === 'focusout') {\n                        // Behat triggers focusout too often.\n                        return;\n                    }\n                    if (e.type === 'keypress' && e.keyCode === 13) {\n                        // We need 'keypress' event for Enter because keyup/keydown would catch Enter that was\n                        // pressed in other fields.\n                        var val = inputelement.val();\n                        turnEditingOff(el);\n                        updateValue(el, val);\n                    }\n                    if ((e.type === 'keyup' && e.keyCode === 27) || e.type === 'focusout') {\n                        // We need 'keyup' event for Escape because keypress does not work with Escape.\n                        turnEditingOff(el);\n                    }\n                });\n            });\n        };\n\n        var turnEditingOnToggle = function(el, newvalue) {\n            turnEditingOff(el);\n            updateValue(el, newvalue);\n        };\n\n        var turnEditingOnSelect = function(el, options) {\n            var i,\n                inputelement = $('<select></select>').\n                    attr('id', uniqueId('id_inplacevalue_', 20)).\n                    addClass('custom-select'),\n                lbl = $('<label class=\"accesshide\">' + mainelement.attr('data-editlabel') + '</label>')\n                    .attr('for', inputelement.attr('id'));\n            for (i in options) {\n                inputelement\n                    .append($('<option>')\n                    .attr('value', options[i].key)\n                    .html(options[i].value));\n            }\n            inputelement.val(el.attr('data-value'));\n\n            el.html('')\n                .append(lbl)\n                .append(inputelement);\n\n            inputelement.focus();\n            inputelement.select();\n            inputelement.on('keyup change focusout', function(e) {\n                if (cfg.behatsiterunning && e.type === 'focusout') {\n                    // Behat triggers focusout too often.\n                    return;\n                }\n                if (e.type === 'change') {\n                    var val = inputelement.val();\n                    turnEditingOff(el);\n                    updateValue(el, val);\n                }\n                if ((e.type === 'keyup' && e.keyCode === 27) || e.type === 'focusout') {\n                    // We need 'keyup' event for Escape because keypress does not work with Escape.\n                    turnEditingOff(el);\n                }\n            });\n        };\n\n        var turnEditingOnAutocomplete = function(el, args) {\n            var i,\n                inputelement = $('<select></select>').\n                    attr('id', uniqueId('id_inplacevalue_', 20)).\n                    addClass('form-autocomplete-original-select').\n                    addClass('custom-select'),\n                lbl = $('<label class=\"accesshide\">' + mainelement.attr('data-editlabel') + '</label>')\n                    .attr('for', inputelement.attr('id')),\n                options = args.options,\n                attributes = args.attributes,\n                saveelement = $('<a href=\"#\"></a>'),\n                cancelelement = $('<a href=\"#\"></a>');\n\n            for (i in options) {\n                inputelement\n                    .append($('<option>')\n                    .attr('value', options[i].key)\n                    .html(options[i].value));\n            }\n            if (attributes.multiple) {\n                inputelement.attr('multiple', 'true');\n            }\n            inputelement.val(JSON.parse(el.attr('data-value')));\n\n            str.get_string('savechanges', 'core').then(function(s) {\n                return templates.renderPix('e/save', 'core', s);\n            }).then(function(html) {\n                saveelement.append(html);\n                return;\n            }).fail(notification.exception);\n\n            str.get_string('cancel', 'core').then(function(s) {\n                return templates.renderPix('e/cancel', 'core', s);\n            }).then(function(html) {\n                cancelelement.append(html);\n                return;\n            }).fail(notification.exception);\n\n            el.html('')\n                .append(lbl)\n                .append(inputelement)\n                .append(saveelement)\n                .append(cancelelement);\n\n            inputelement.focus();\n            inputelement.select();\n            autocomplete.enhance(inputelement,\n                                 attributes.tags,\n                                 attributes.ajax,\n                                 attributes.placeholder,\n                                 attributes.caseSensitive,\n                                 attributes.showSuggestions,\n                                 attributes.noSelectionString)\n                .then(function() {\n                // Focus on the enhanced combobox.\n                el.find('[role=combobox]').focus();\n                // Stop eslint nagging.\n                return;\n            }).fail(notification.exception);\n\n            inputelement.on('keyup', function(e) {\n                if ((e.type === 'keyup' && e.keyCode === 27) || e.type === 'focusout') {\n                    // We need 'keyup' event for Escape because keypress does not work with Escape.\n                    turnEditingOff(el);\n                }\n            });\n            saveelement.on('click', function(e) {\n                var val = JSON.stringify(inputelement.val());\n                // We need to empty the node to destroy all event handlers etc.\n                inputelement.empty();\n                turnEditingOff(el);\n                updateValue(el, val);\n                e.preventDefault();\n            });\n            cancelelement.on('click', function(e) {\n                // We need to empty the node to destroy all event handlers etc.\n                inputelement.empty();\n                turnEditingOff(el);\n                e.preventDefault();\n            });\n        };\n\n        var turnEditingOn = function(el) {\n            el.addClass('inplaceeditingon');\n            el.attr('data-oldcontent', el.html());\n\n            var type = el.attr('data-type');\n            var options = el.attr('data-options');\n\n            if (type === 'toggle') {\n                turnEditingOnToggle(el, options);\n            } else if (type === 'select') {\n                turnEditingOnSelect(el, $.parseJSON(options));\n            } else if (type === 'autocomplete') {\n                turnEditingOnAutocomplete(el, $.parseJSON(options));\n            } else {\n                turnEditingOnText(el);\n            }\n        };\n\n        // Turn editing on for the current element and register handler for Enter/Esc keys.\n        turnEditingOffEverywhere();\n        turnEditingOn(mainelement);\n        editingEnabledPromise.resolve();\n\n    });\n\n    return {};\n});\n"],"file":"inplace_editable.min.js"}