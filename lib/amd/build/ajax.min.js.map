{"version":3,"file":"ajax.min.js","sources":["../src/ajax.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Standard Ajax wrapper for Moodle. It calls the central Ajax script,\n * which can call any existing webservice using the current session.\n * In addition, it can batch multiple requests and return multiple responses.\n *\n * @module     core/ajax\n * @copyright  2015 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      2.9\n */\n\nimport jQuery from 'jquery';\nimport {fetchMany} from './fetch';\n\n/**\n * Deprecation layer for the old ajax module.\n *\n * @param {Request} requests\n * @param {boolean} [async=true]\n * @param {boolean} [loginRequired=true]\n * @param {boolean} [noSessionUpdate=false]\n * @param {Number} [timeout=null]\n * @param {Number} [cacheKey=null]\n * @returns {Promise[]}\n */\nconst call = (\n    requests,\n    async = true,\n    loginRequired = true,\n    noSessionUpdate = false,\n    timeout = 0,\n    cacheKey = null,\n) => {\n    window.console.warn(\n        `The core/ajax:call function has been deprecated. ` +\n        `Please update your call to use either fetchOne, or fetchMany from the core/fetch module.`\n    );\n\n    if (!async) {\n        throw new Error(`The async flag has been deprecated. Please update your code.`);\n    }\n\n    // Perform the new fetch.\n    const promises = fetchMany(requests, loginRequired, {\n        updateSession: !noSessionUpdate,\n        timeout,\n        cacheKey,\n    });\n\n    // Convert the promises to jQuery promises.\n    const jQueryPromises = promises.map((promise) => jQuery.Deferred()\n        .resolve(promise)\n        .catch(value => jQuery.Deferred().reject(value))\n    );\n\n    // Handle the promise.done and promise.fail calls.\n    return jQueryPromises.map((promise, index) => {\n        if (requests[index].done) {\n            window.console.warn(`The use of the done and fail callbacks has been deprecated.`);\n            promise.done(requests[index].done);\n        }\n\n        if (requests[index].fail) {\n            window.console.warn(`The use of the done and fail callbacks has been deprecated.`);\n            promise.fail(requests[index].fail);\n        }\n\n        return promise;\n    });\n};\n\n/**\n *\n * @param {Array} args\n * @returns {Promise[]}\n */\nexport default {\n    call,\n};\n"],"names":["obj","_jquery","__esModule","default","_default","call","requests","async","arguments","length","undefined","loginRequired","noSessionUpdate","timeout","cacheKey","window","console","warn","Error","fetchMany","updateSession","map","promise","jQuery","Deferred","resolve","catch","value","reject","index","done","fail","_exports"],"mappings":"qFA0B4B,IAAAA;;;;;;;;;;qFAA5BC,SAA4BD,IAA5BC,UAA4BD,IAAAE,WAAAF,IAAAG,CAAAA,QAAAH,KA0D1B,IAAAI,SAOa,CACXC,KApDS,SACTC,UAMC,IALDC,QAAKC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,KAAAA,UAAA,GACLG,gBAAaH,UAAAC,OAAA,QAAAC,IAAAF,UAAA,KAAAA,UAAA,GACbI,gBAAeJ,UAAAC,OAAA,QAAAC,IAAAF,UAAA,IAAAA,UAAA,GACfK,QAAOL,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,EACVM,SAAQN,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,KAOX,GALAO,OAAOC,QAAQC,KACX,8IAICV,MACD,MAAM,IAAIW,MAAqE,gEAiBnF,OAbiB,EAAAC,OAAAA,WAAUb,SAAUK,cAAe,CAChDS,eAAgBR,gBAChBC,gBACAC,oBAI4BO,KAAKC,SAAYC,QAAAA,QAAOC,WACnDC,QAAQH,SACRI,OAAMC,OAASJ,gBAAOC,WAAWI,OAAOD,WAIvBN,KAAI,CAACC,QAASO,SAC5BvB,SAASuB,OAAOC,OAChBf,OAAOC,QAAQC,KAAmE,+DAClFK,QAAQQ,KAAKxB,SAASuB,OAAOC,OAG7BxB,SAASuB,OAAOE,OAChBhB,OAAOC,QAAQC,KAAmE,+DAClFK,QAAQS,KAAKzB,SAASuB,OAAOE,OAG1BT,aAWd,OAAAU,SAAA7B,QAAAC,SAAA4B,SAAA7B,OAAA"}