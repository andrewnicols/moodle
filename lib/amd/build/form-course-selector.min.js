define ("core/form-course-selector",["core/ajax","jquery"],function(ajax,$){return{processResults:function processResults(selector,data){var results=[],i=0,excludelist=($(selector).data("exclude")+"").split(",");for(i=0;i<data.courses.length;i++){if(-1===excludelist.indexOf(data.courses[i].id+"")){results.push({value:data.courses[i].id,label:data.courses[i].displayname})}}return results},transport:function transport(selector,query,success,failure){var el=$(selector),requiredcapabilities=el.data("requiredcapabilities");if(""!==requiredcapabilities.trim()){requiredcapabilities=requiredcapabilities.split(",")}else{requiredcapabilities=[]}var limittoenrolled=el.data("limittoenrolled"),includefrontpage=el.data("includefrontpage"),onlywithcompletion=el.data("onlywithcompletion"),promises=null;if("undefined"==typeof query){query=""}var searchargs={criterianame:"search",criteriavalue:query,page:0,perpage:100,requiredcapabilities:requiredcapabilities,limittoenrolled:limittoenrolled,onlywithcompletion:onlywithcompletion},calls=[{methodname:"core_course_search_courses",args:searchargs}];if(includefrontpage){calls.push({methodname:"core_course_get_courses",args:{options:{ids:[includefrontpage]}}})}promises=ajax.call(calls);$.when.apply($.when,promises).done(function(data,site){if(site&&1==site.length){var frontpage=site.pop(),matches=""===query||-1<frontpage.fullname.toUpperCase().indexOf(query.toUpperCase())||-1<frontpage.shortname.toUpperCase().indexOf(query.toUpperCase());if(matches){data.courses.splice(0,0,frontpage)}}success(data)}).fail(failure)}}});
//# sourceMappingURL=form-course-selector.min.js.map
