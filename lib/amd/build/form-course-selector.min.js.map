{"version":3,"sources":["../src/form-course-selector.js"],"names":["define","ajax","$","processResults","selector","data","results","i","excludelist","split","courses","length","indexOf","id","push","value","label","displayname","transport","query","success","failure","el","requiredcapabilities","trim","limittoenrolled","includefrontpage","onlywithcompletion","promises","searchargs","criterianame","criteriavalue","page","perpage","calls","methodname","args","options","ids","call","when","apply","done","site","frontpage","pop","matches","fullname","toUpperCase","shortname","splice","fail"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Course selector adaptor for auto-complete form element.\n *\n * @module     core/form-course-selector\n * @copyright  2016 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.1\n */\ndefine(['core/ajax', 'jquery'], function(ajax, $) {\n\n    return {\n        // Public variables and functions.\n        processResults: function(selector, data) {\n            // Mangle the results into an array of objects.\n            var results = [];\n            var i = 0;\n            var excludelist = String($(selector).data('exclude')).split(',');\n\n            for (i = 0; i < data.courses.length; i++) {\n                if (excludelist.indexOf(String(data.courses[i].id)) === -1) {\n                    results.push({value: data.courses[i].id, label: data.courses[i].displayname});\n                }\n            }\n            return results;\n        },\n\n        transport: function(selector, query, success, failure) {\n            var el = $(selector);\n\n            // Parse some data-attributes from the form element.\n            var requiredcapabilities = el.data('requiredcapabilities');\n            if (requiredcapabilities.trim() !== \"\") {\n                requiredcapabilities = requiredcapabilities.split(',');\n            } else {\n                requiredcapabilities = [];\n            }\n\n            var limittoenrolled = el.data('limittoenrolled');\n            var includefrontpage = el.data('includefrontpage');\n            var onlywithcompletion = el.data('onlywithcompletion');\n\n            // Build the query.\n            var promises = null;\n\n            if (typeof query === \"undefined\") {\n                query = '';\n            }\n\n            var searchargs = {\n                criterianame: 'search',\n                criteriavalue: query,\n                page: 0,\n                perpage: 100,\n                requiredcapabilities: requiredcapabilities,\n                limittoenrolled: limittoenrolled,\n                onlywithcompletion: onlywithcompletion\n            };\n\n            var calls = [{\n                methodname: 'core_course_search_courses', args: searchargs\n            }];\n            if (includefrontpage) {\n                calls.push({\n                    methodname: 'core_course_get_courses',\n                    args: {\n                        options: {\n                            ids: [includefrontpage]\n                        }\n                    }\n                });\n            }\n\n            // Go go go!\n            promises = ajax.call(calls);\n            $.when.apply($.when, promises).done(function(data, site) {\n                if (site && site.length == 1) {\n                    var frontpage = site.pop();\n                    var matches = query === ''\n                        || frontpage.fullname.toUpperCase().indexOf(query.toUpperCase()) > -1\n                        || frontpage.shortname.toUpperCase().indexOf(query.toUpperCase()) > -1;\n                    if (matches) {\n                        data.courses.splice(0, 0, frontpage);\n                    }\n                }\n                success(data);\n            }).fail(failure);\n        }\n    };\n});\n"],"file":"form-course-selector.min.js"}