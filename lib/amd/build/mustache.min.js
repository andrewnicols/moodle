(function(global,factory){if("object"==typeof exports&&exports&&"string"!=typeof exports.nodeName){factory(exports)}else if("function"==typeof define&&define.amd){define ("core/mustache",["exports"],factory)}else{global.Mustache={};factory(global.Mustache)}})(this,function(mustache){var objectToString=Object.prototype.toString,isArray=Array.isArray||function(object){return"[object Array]"===objectToString.call(object)};function isFunction(object){return"function"==typeof object}function typeStr(obj){return isArray(obj)?"array":typeof obj}function escapeRegExp(string){return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function hasProperty(obj,propName){return null!=obj&&"object"==typeof obj&&propName in obj}function primitiveHasOwnProperty(primitive,propName){return null!=primitive&&"object"!=typeof primitive&&primitive.hasOwnProperty&&primitive.hasOwnProperty(propName)}var regExpTest=RegExp.prototype.test;function testRegExp(re,string){return regExpTest.call(re,string)}function isWhitespace(string){return!testRegExp(/\S/,string)}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};var equalsRe=/\s*=/;function parseTemplate(template,tags){if(!template)return[];var lineHasNonSpace=!1,sections=[],tokens=[],spaces=[],hasTag=!1,nonSpace=!1,indentation="",tagIndex=0;function stripSpace(){if(hasTag&&!nonSpace){while(spaces.length)delete tokens[spaces.pop()]}else{spaces=[]}hasTag=!1;nonSpace=!1}var openingTagRe,closingTagRe,closingCurlyRe;function compileTags(tagsToCompile){if("string"==typeof tagsToCompile)tagsToCompile=tagsToCompile.split(/\s+/,2);if(!isArray(tagsToCompile)||2!==tagsToCompile.length)throw new Error("Invalid tags: "+tagsToCompile);openingTagRe=new RegExp(escapeRegExp(tagsToCompile[0])+"\\s*");closingTagRe=new RegExp("\\s*"+escapeRegExp(tagsToCompile[1]));closingCurlyRe=new RegExp("\\s*"+escapeRegExp("}"+tagsToCompile[1]))}compileTags(tags||mustache.tags);var scanner=new Scanner(template),start,type,value,chr,token,openSection;while(!scanner.eos()){start=scanner.pos;value=scanner.scanUntil(openingTagRe);if(value){for(var i=0,valueLength=value.length;i<valueLength;++i){chr=value.charAt(i);if(isWhitespace(chr)){spaces.push(tokens.length);indentation+=chr}else{nonSpace=!0;lineHasNonSpace=!0;indentation+=" "}tokens.push(["text",chr,start,start+1]);start+=1;if("\n"===chr){stripSpace();indentation="";tagIndex=0;lineHasNonSpace=!1}}}if(!scanner.scan(openingTagRe))break;hasTag=!0;type=scanner.scan(/#|\^|\/|>|\{|&|=|!|\$|</)||"name";scanner.scan(/\s*/);if("="===type){value=scanner.scanUntil(equalsRe);scanner.scan(equalsRe);scanner.scanUntil(closingTagRe)}else if("{"===type){value=scanner.scanUntil(closingCurlyRe);scanner.scan(/\s*\}/);scanner.scanUntil(closingTagRe);type="&"}else{value=scanner.scanUntil(closingTagRe)}if(!scanner.scan(closingTagRe))throw new Error("Unclosed tag at "+scanner.pos);if(">"==type){token=[type,value,start,scanner.pos,indentation,tagIndex,lineHasNonSpace]}else{token=[type,value,start,scanner.pos]}tagIndex++;tokens.push(token);if("#"===type||"^"===type||"$"===type||"<"===type){sections.push(token)}else if("/"===type){openSection=sections.pop();if(!openSection)throw new Error("Unopened section \""+value+"\" at "+start);if(openSection[1]!==value)throw new Error("Unclosed section \""+openSection[1]+"\" at "+start)}else if("name"===type||"{"===type||"&"===type){nonSpace=!0}else if("="===type){compileTags(value)}}stripSpace();openSection=sections.pop();if(openSection)throw new Error("Unclosed section \""+openSection[1]+"\" at "+scanner.pos);return nestTokens(squashTokens(tokens))}function squashTokens(tokens){for(var squashedTokens=[],token,lastToken,i=0,numTokens=tokens.length;i<numTokens;++i){token=tokens[i];if(token){if("text"===token[0]&&lastToken&&"text"===lastToken[0]){lastToken[1]+=token[1];lastToken[3]=token[3]}else{squashedTokens.push(token);lastToken=token}}}return squashedTokens}function nestTokens(tokens){for(var nestedTokens=[],collector=nestedTokens,sections=[],token,section,i=0,numTokens=tokens.length;i<numTokens;++i){token=tokens[i];switch(token[0]){case"$":case"<":case"#":case"^":collector.push(token);sections.push(token);collector=token[4]=[];break;case"/":section=sections.pop();section[5]=token[2];collector=0<sections.length?sections[sections.length-1][4]:nestedTokens;break;default:collector.push(token);}}return nestedTokens}function Scanner(string){this.string=string;this.tail=string;this.pos=0}Scanner.prototype.eos=function(){return""===this.tail};Scanner.prototype.scan=function(re){var match=this.tail.match(re);if(!match||0!==match.index)return"";var string=match[0];this.tail=this.tail.substring(string.length);this.pos+=string.length;return string};Scanner.prototype.scanUntil=function(re){var index=this.tail.search(re),match;switch(index){case-1:match=this.tail;this.tail="";break;case 0:match="";break;default:match=this.tail.substring(0,index);this.tail=this.tail.substring(index);}this.pos+=match.length;return match};function Context(view,parentContext){this.view=view;this.blocks={};this.cache={".":this.view};this.parent=parentContext}Context.prototype.push=function(view){return new Context(view,this)};Context.prototype.setBlockVar=function(name,value){var blocks=this.blocks;blocks[name]=value;return value};Context.prototype.clearBlockVars=function(){this.blocks={}};Context.prototype.getBlockVar=function(name){var blocks=this.blocks,value;if(blocks.hasOwnProperty(name)){value=blocks[name]}else{if(this.parent){value=this.parent.getBlockVar(name)}}return value};Context.prototype.lookup=function(name){var cache=this.cache,value;if(cache.hasOwnProperty(name)){value=cache[name]}else{var context=this,intermediateValue,names,index,lookupHit=!1;while(context){if(0<name.indexOf(".")){intermediateValue=context.view;names=name.split(".");index=0;while(null!=intermediateValue&&index<names.length){if(index===names.length-1)lookupHit=hasProperty(intermediateValue,names[index])||primitiveHasOwnProperty(intermediateValue,names[index]);intermediateValue=intermediateValue[names[index++]]}}else{intermediateValue=context.view[name];lookupHit=hasProperty(context.view,name)}if(lookupHit){value=intermediateValue;break}context=context.parent}cache[name]=value}if(isFunction(value))value=value.call(this.view);return value};function Writer(){this.cache={}}Writer.prototype.clearCache=function(){this.cache={}};Writer.prototype.parse=function(template,tags){var cache=this.cache,cacheKey=template+":"+(tags||mustache.tags).join(":"),tokens=cache[cacheKey];if(null==tokens)tokens=cache[cacheKey]=parseTemplate(template,tags);return tokens};Writer.prototype.render=function(template,view,partials,tags){var tokens=this.parse(template,tags),context=view instanceof Context?view:new Context(view);return this.renderTokens(tokens,context,partials,template,tags)};Writer.prototype.renderTokens=function(tokens,context,partials,originalTemplate,tags){for(var buffer="",token,symbol,value,i=0,numTokens=tokens.length;i<numTokens;++i){value=void 0;token=tokens[i];symbol=token[0];if("#"===symbol)value=this.renderSection(token,context,partials,originalTemplate);else if("^"===symbol)value=this.renderInverted(token,context,partials,originalTemplate);else if(">"===symbol)value=this.renderPartial(token,context,partials,tags);else if("<"===symbol)value=this.renderBlock(token,context,partials,originalTemplate);else if("$"===symbol)value=this.renderBlockVariable(token,context,partials,originalTemplate);else if("&"===symbol)value=this.unescapedValue(token,context);else if("name"===symbol)value=this.escapedValue(token,context);else if("text"===symbol)value=this.rawValue(token);if(value!==void 0)buffer+=value}return buffer};Writer.prototype.renderSection=function(token,context,partials,originalTemplate){var self=this,buffer="",value=context.lookup(token[1]);function subRender(template){return self.render(template,context,partials)}if(!value)return;if(isArray(value)){for(var j=0,valueLength=value.length;j<valueLength;++j){buffer+=this.renderTokens(token[4],context.push(value[j]),partials,originalTemplate)}}else if("object"==typeof value||"string"==typeof value||"number"==typeof value){buffer+=this.renderTokens(token[4],context.push(value),partials,originalTemplate)}else if(isFunction(value)){if("string"!=typeof originalTemplate)throw new Error("Cannot use higher-order sections without the original template");value=value.call(context.view,originalTemplate.slice(token[3],token[5]),subRender);if(null!=value)buffer+=value}else{buffer+=this.renderTokens(token[4],context,partials,originalTemplate)}return buffer};Writer.prototype.renderInverted=function(token,context,partials,originalTemplate){var value=context.lookup(token[1]);if(!value||isArray(value)&&0===value.length)return this.renderTokens(token[4],context,partials,originalTemplate)};Writer.prototype.indentPartial=function(partial,indentation,lineHasNonSpace){for(var filteredIndentation=indentation.replace(/[^ \t]/g,""),partialByNl=partial.split("\n"),i=0;i<partialByNl.length;i++){if(partialByNl[i].length&&(0<i||!lineHasNonSpace)){partialByNl[i]=filteredIndentation+partialByNl[i]}}return partialByNl.join("\n")};Writer.prototype.renderPartial=function(token,context,partials,tags){if(!partials)return;var value=isFunction(partials)?partials(token[1]):partials[token[1]];if(null!=value){var lineHasNonSpace=token[6],tagIndex=token[5],indentation=token[4],indentedValue=value;if(0==tagIndex&&indentation){indentedValue=this.indentPartial(value,indentation,lineHasNonSpace)}return this.renderTokens(this.parse(indentedValue,tags),context,partials,indentedValue)}};Writer.prototype.renderBlock=function(token,context,partials,originalTemplate){if(!partials)return;var value=isFunction(partials)?partials(token[1]):partials[token[1]];if(null!=value)context.clearBlockVars();this.renderTokens(token[4],context,partials,originalTemplate);var result=this.renderTokens(this.parse(value),context,partials,value);context.clearBlockVars();return result};Writer.prototype.renderBlockVariable=function(token,context,partials,originalTemplate){var value=token[1],exists=context.getBlockVar(value);if(!exists){context.setBlockVar(value,originalTemplate.slice(token[3],token[5]));return this.renderTokens(token[4],context,partials,originalTemplate)}else{return this.renderTokens(this.parse(exists),context,partials,exists)}};Writer.prototype.unescapedValue=function(token,context){var value=context.lookup(token[1]);if(null!=value)return value};Writer.prototype.escapedValue=function(token,context){var value=context.lookup(token[1]);if(null!=value)return mustache.escape(value)};Writer.prototype.rawValue=function(token){return token[1]};mustache.name="mustache.js";mustache.version="3.1.0";mustache.tags=["{{","}}"];var defaultWriter=new Writer;mustache.clearCache=function(){return defaultWriter.clearCache()};mustache.parse=function(template,tags){return defaultWriter.parse(template,tags)};mustache.render=function(template,view,partials,tags){if("string"!=typeof template){throw new TypeError("Invalid template! Template should be a \"string\" but \""+typeStr(template)+"\" was given as the first argument for mustache#render(template, view, partials)")}return defaultWriter.render(template,view,partials,tags)};mustache.to_html=function(template,view,partials,send){var result=mustache.render(template,view,partials);if(isFunction(send)){send(result)}else{return result}};mustache.escape=function(string){return(string+"").replace(/[&<>"'`=\/]/g,function(s){return entityMap[s]})};mustache.Scanner=Scanner;mustache.Context=Context;mustache.Writer=Writer;return mustache});
//# sourceMappingURL=mustache.min.js.map
