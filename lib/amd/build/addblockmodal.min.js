define ("core/addblockmodal",["exports","core/modal_factory","core/templates","core/str","core/ajax"],function(_exports,_modal_factory,_templates,_str,_ajax){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.init=void 0;_modal_factory=_interopRequireDefault(_modal_factory);_templates=_interopRequireDefault(_templates);_ajax=_interopRequireDefault(_ajax);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}var SELECTORS={ADD_BLOCK:"[data-key=\"addblock\"]"},listenerEventsRegistered=!1,registerListenerEvents=function(pageType,pageLayout,addBlockUrl,subPage){document.addEventListener("click",function(e){var addBlock=e.target.closest(SELECTORS.ADD_BLOCK);if(addBlock){e.preventDefault();var addBlockModal=null,addBlockModalUrl=null!==addBlockUrl&&void 0!==addBlockUrl?addBlockUrl:addBlock.dataset.url;buildAddBlockModal().then(function(modal){addBlockModal=modal;var modalBody=renderBlocks(addBlockModalUrl,pageType,pageLayout,subPage);modal.setBody(modalBody);modal.show();return modalBody}).catch(function(){addBlockModal.destroy()})}})},buildAddBlockModal=function(){return _modal_factory.default.create({type:_modal_factory.default.types.CANCEL,title:(0,_str.get_string)("addblock")})},renderBlocks=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(addBlockUrl,pageType,pageLayout,subPage){var blocks;return regeneratorRuntime.wrap(function(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getAddableBlocks(pageType,pageLayout,subPage);case 2:blocks=_context.sent;return _context.abrupt("return",_templates.default.render("core/add_block_body",{blocks:blocks,url:addBlockUrl}));case 4:case"end":return _context.stop();}}},_callee)}));return function(){return _ref.apply(this,arguments)}}(),getAddableBlocks=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(pageType,pageLayout,subPage){var request;return regeneratorRuntime.wrap(function(_context2){while(1){switch(_context2.prev=_context2.next){case 0:request={methodname:"core_block_fetch_addable_blocks",args:{pagecontextid:M.cfg.contextid,pagetype:pageType,pagelayout:pageLayout,subpage:subPage}};return _context2.abrupt("return",_ajax.default.call([request])[0]);case 2:case"end":return _context2.stop();}}},_callee2)}));return function(){return _ref2.apply(this,arguments)}}(),init=function(pageType,pageLayout){var addBlockUrl=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null,subPage=3<arguments.length&&arguments[3]!==void 0?arguments[3]:"";if(!listenerEventsRegistered){registerListenerEvents(pageType,pageLayout,addBlockUrl,subPage);listenerEventsRegistered=!0}};_exports.init=init});
//# sourceMappingURL=addblockmodal.min.js.map
