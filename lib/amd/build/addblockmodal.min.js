define ("core/addblockmodal",["exports","core/modal_factory","core/templates","core/str","core/ajax"],function(_exports,_modal_factory,_templates,_str,_ajax){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.init=void 0;_modal_factory=_interopRequireDefault(_modal_factory);_templates=_interopRequireDefault(_templates);_ajax=_interopRequireDefault(_ajax);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const SELECTORS={ADD_BLOCK:"[data-key=\"addblock\"]"};let listenerEventsRegistered=!1;const registerListenerEvents=(pageType,pageLayout,addBlockUrl,subPage)=>{document.addEventListener("click",e=>{const addBlock=e.target.closest(SELECTORS.ADD_BLOCK);if(addBlock){e.preventDefault();let addBlockModal=null,addBlockModalUrl=null!==addBlockUrl&&void 0!==addBlockUrl?addBlockUrl:addBlock.dataset.url;buildAddBlockModal().then(modal=>{addBlockModal=modal;const modalBody=renderBlocks(addBlockModalUrl,pageType,pageLayout,subPage);modal.setBody(modalBody);modal.show();return modalBody}).catch(()=>{addBlockModal.destroy()})}})},buildAddBlockModal=()=>{return _modal_factory.default.create({type:_modal_factory.default.types.CANCEL,title:(0,_str.get_string)("addblock")})},renderBlocks=async(addBlockUrl,pageType,pageLayout,subPage)=>{const blocks=await getAddableBlocks(pageType,pageLayout,subPage);return _templates.default.render("core/add_block_body",{blocks:blocks,url:addBlockUrl})},getAddableBlocks=async(pageType,pageLayout,subPage)=>{const request={methodname:"core_block_fetch_addable_blocks",args:{pagecontextid:M.cfg.contextid,pagetype:pageType,pagelayout:pageLayout,subpage:subPage}};return _ajax.default.call([request])[0]},init=function(pageType,pageLayout){let addBlockUrl=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null,subPage=3<arguments.length&&arguments[3]!==void 0?arguments[3]:"";if(!listenerEventsRegistered){registerListenerEvents(pageType,pageLayout,addBlockUrl,subPage);listenerEventsRegistered=!0}};_exports.init=init});
//# sourceMappingURL=addblockmodal.min.js.map
