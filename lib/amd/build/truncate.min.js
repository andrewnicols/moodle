define ("core/truncate",["jquery"],function($){var charLengthAt=function(text,position){var string=text+"",size=string.length,index=position?+position:0;if(index!=index){index=0}if(-1>=index||index>=size){return""}index=0|index;var cuFirst=string.charCodeAt(index),cuSecond,nextIndex=index+1,len=1;if(55296<=cuFirst&&56319>=cuFirst&&size>nextIndex){cuSecond=string.charCodeAt(nextIndex);if(56320<=cuSecond&&57343>=cuSecond){len=2}}return len},lengthMultiByte=function(text){for(var count=0,i=0;i<text.length;i+=charLengthAt(text,i)){count++}return count},getSliceLength=function(text,amount){if(!text.length){return 0}var length=0,count=0;do{length+=charLengthAt(text,length);count++}while(length<text.length&&count<amount);return length};$.truncate=function(html,options){return $("<div></div>").append(html).truncate(options).html()};$.fn.truncate=function(options){if(!isNaN(parseFloat(options)))options={length:options};var o=$.extend({},$.truncate.defaults,options);return this.each(function(){var self=$(this);if(o.noBreaks)self.find("br").replaceWith(" ");var ellipsisLength=o.ellipsis.length,text=self.text(),textLength=lengthMultiByte(text),excess=textLength-o.length+ellipsisLength;if(textLength<o.length)return;if(o.stripTags)self.text(text);if(o.words&&0<excess){var sliced=text.slice(0,getSliceLength(text,o.length-ellipsisLength)+1),replaced=sliced.replace(/(\s*\S+|\s)$/,""),truncated=lengthMultiByte(replaced),oneWord=sliced.match(/\s/)?!1:!0;if(o.keepFirstWord&&0===truncated){excess=textLength-lengthMultiByte(/^(\S*)/.exec(text)[0])-ellipsisLength}else if(oneWord&&0===truncated){excess=textLength-o.length+ellipsisLength}else{excess=textLength-truncated-1}}if(excess>textLength){excess=textLength-o.length}if(0>excess||!excess&&!o.truncated)return;$.each(self.contents().get().reverse(),function(i,el){var $el=$(el),text=$el.text(),length=lengthMultiByte(text);if(length<=excess){o.truncated=!0;excess-=length;$el.remove();return}if(3===el.nodeType){var splitAmount=length-excess;splitAmount=0<=splitAmount?getSliceLength(text,splitAmount):0;$(el.splitText(splitAmount)).replaceWith(o.ellipsis);return!1}$el.truncate($.extend(o,{length:length-excess+ellipsisLength}));return!1})})};$.truncate.defaults={stripTags:!1,words:!1,keepFirstWord:!1,noBreaks:!1,length:1/0,ellipsis:"\u2026"};return{truncate:$.truncate}});
//# sourceMappingURL=truncate.min.js.map
