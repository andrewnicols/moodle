define("core/treegrid",["exports","core/local/aria/selectors"],(function(_exports,_selectors){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_selectors=(obj=_selectors)&&obj.__esModule?obj:{default:obj};class TreeGrid{static createTreeGrid(treeElement){return new TreeGrid(treeElement)}constructor(treeElement){!function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(this,"treeElement",void 0),this.treeElement=treeElement,this.registerEventListeners(),this.initialiseAttributes()}initialiseAttributes(){this.treeElement.querySelectorAll(_selectors.default.elements.focusable).forEach((element=>{element.setAttribute("tabindex","-1")})),Array.from(this.treeElement.querySelectorAll("tr")).reverse().forEach((rowElement=>{rowElement.setAttribute("tabindex","-1")})),this.getFirstRow().setAttribute("tabindex","0")}registerEventListeners(){this.treeElement.addEventListener("keydown",this.handleKeyDown.bind(this)),this.treeElement.addEventListener("click",this.handleClick.bind(this)),this.treeElement.addEventListener("focusin",this.handleFocusIn.bind(this))}handleFocusIn(event){const focusedItem=event.target;Array.from(this.treeElement.querySelectorAll('[tabindex="0"]')).filter((item=>item!==focusedItem)).forEach((item=>{item.setAttribute("tabindex",-1)}))}handleClick(event){const clickedItem=event.target,focusableParent=clickedItem.closest(_selectors.default.elements.focusable);if(focusableParent)return void this.focus(focusableParent);const tabbableParent=clickedItem.closest(_selectors.default.elements.tabbable);tabbableParent&&this.focus(tabbableParent)}handleKeyDown(event){if("Enter"!==event.key)if("ArrowRight"!==event.key)if("ArrowLeft"!==event.key)if("ArrowUp"!==event.key){if("ArrowDown"!==event.key)return"Home"===event.key?event.ctrl?void this.handleKeyCtrlHome(event):void this.handleKeyHome(event):"End"===event.key?event.ctrl?void this.handleKeyCtrlEnd(event):void this.handleKeyEnd(event):void 0;this.handleKeyArrowDown(event)}else this.handleKeyArrowUp(event);else this.handleKeyArrowLeft(event);else this.handleKeyArrowRight(event);else this.handleKeyEnter(event)}handleKeyEnter(event){event.preventDefault()}handleKeyArrowRight(event){const focusedItem=this.getFocusedItem();return"false"===focusedItem.getAttribute("aria-expanded")?(event.preventDefault(),void this.expandRow(focusedItem)):"true"===focusedItem.getAttribute("aria-expanded")||this.isRow(focusedItem)?(event.preventDefault(),void this.focusFirstCell(focusedItem)):void(focusedItem.nextElementSibling&&(this.focusNextCell(focusedItem),event.preventDefault()))}handleKeyArrowLeft(event){const focusedItem=this.getFocusedItem(),isRow=this.isRow(focusedItem),isCell=this.isCell(focusedItem);if(isRow){if("true"===focusedItem.getAttribute("aria-expanded"))return event.preventDefault(),void this.collapseRow(focusedItem);if("false"===focusedItem.getAttribute("aria-expanded"))return}if(isCell){if(null===focusedItem.previousElementSibling)return this.rowFocusSupported()?(event.preventDefault(),void this.focusCurrentRow(focusedItem)):void 0;this.focusPreviousCell(this.getCellWithItem(focusedItem)),event.preventDefault()}}handleKeyArrowUp(event){const focusedItem=this.getFocusedItem();if(this.isRow(focusedItem)){if(null===focusedItem.previousElementSibling)return;return this.focusRowAbove(focusedItem),void event.preventDefault()}if(this.isCell(focusedItem)){if(null===this.getRowForItem(focusedItem).previousElementSibling)return;this.focusCellAbove(focusedItem),event.preventDefault()}}handleKeyArrowDown(event){const focusedItem=this.getFocusedItem();if(this.isRow(focusedItem)){if(null===focusedItem.nextElementSibling)return;return this.focusRowBelow(focusedItem),void event.preventDefault()}if(this.isCell(focusedItem)){if(null===this.getRowForItem(focusedItem).nextElementSibling)return;this.focusCellBelow(focusedItem),event.preventDefault()}}handleKeyHome(event){const focusedItem=this.getFocusedItem();if(this.isRow(focusedItem)){if(null===focusedItem.previousElementSibling)return;return this.focusFirstRow(focusedItem),void event.preventDefault()}if(this.isCell(focusedItem)){if(null===focusedItem.previousElementSibling)return;this.focusFirstCell(focusedItem),event.preventDefault()}}handleKeyEnd(event){const focusedItem=this.getFocusedItem();if(this.isRow(focusedItem)){if(null===focusedItem.nextElementSibling)return;return this.focusLastRow(focusedItem),void event.preventDefault()}if(this.isCell(focusedItem)){if(null===focusedItem.nextElementSibling)return;this.focusLastCell(focusedItem),event.preventDefault()}}handleKeyControlHome(event){const focusedItem=this.getFocusedItem();if(this.isRow(focusedItem)){if(null===this.getRowForItem(focusedItem).previousElementSibling)return;return this.focusFirstRow(focusedItem),void event.preventDefault()}if(this.isCell(focusedItem)){if(null===this.getRowForItem(focusedItem).previousElementSibling)return;this.focusFirstCellInRow(focusedItem),event.preventDefault()}}handleKeyControlEnd(event){const focusedItem=this.getFocusedItem();if(this.isRow(focusedItem)){if(null===this.getRowForItem(focusedItem).nextElementSibling)return;return this.focusLastRow(focusedItem),void event.preventDefault()}if(this.isCell(focusedItem)){if(null===this.getRowForItem(focusedItem).nextElementSibling)return;this.focusLastCellInRow(focusedItem),event.preventDefault()}}getFocusedItem(){return document.activeElement}getFocusableElements(parent){return Array.from(parent.closest(_selectors.default.elements.focusable))}isRow(item){return!!item.matches("tr")}isCell(item){return!!this.getCellWithItem(item)}focusCell(cell){const focusableChildren=this.getFocusableElements(cell);this.focus(focusableChildren[0]||cell)}focus(item){item.tabIndex=0,item.focus()}getRowForItem(item){return item.closest("tr")}expandRow(item){const row=this.getRowForItem(item);row.setAttribute("aria-expanded",!0),this.getChildRows(row).forEach((childRow=>{childRow.setAttribute("aria-hidden",!1)}))}collapseRow(item){const row=this.getRowForItem(item);this.getChildRows(row).forEach((childRow=>{childRow.setAttribute("aria-hidden",!0)})),row.setAttribute("aria-expanded",!1)}getChildRows(parent){const parentRow=this.getRowForItem(parent),parentRowLevel=this.getRowLevel(parentRow),allRows=this.getAllRows(),parentRowIndex=allRows.indexOf(parentRow),possibleChildren=allRows.slice(parentRowIndex+1),childRows=[];for(const childRow of possibleChildren){if(this.getRowLevel(childRow)!==parentRowLevel+1)break;childRows.push(childRow)}return childRows}getCellWithItem(item){return item.closest("td")}getNavigableRows(){return this.getAllRows().filter((row=>row.matches(':not([aria-hidden="true"]')))}getAllRows(){return Array.from(this.treeElement.querySelectorAll("tr")).filter((row=>!row.closest("thead")))}getNavigableColumns(row){return Array.from(row.getElementsByTagName("td"))}getFirstRow(){var _this$getNavigableRow;return null===(_this$getNavigableRow=this.getNavigableRows())||void 0===_this$getNavigableRow?void 0:_this$getNavigableRow.shift()}getLastRow(){var _this$getNavigableRow2;return null===(_this$getNavigableRow2=this.getNavigableRows())||void 0===_this$getNavigableRow2?void 0:_this$getNavigableRow2.pop()}getPreviousRow(item){const allRows=this.getNavigableRows(),currentRow=this.getRowForItem(item),index=allRows.indexOf(currentRow);return 0===index?null:allRows[index-1]}getNextRow(item){const allRows=this.getNavigableRows(),currentRow=this.getRowForItem(item),index=allRows.indexOf(currentRow);return index>=allRows.length-1?null:allRows[index+1]}focusSameCellInRow(currentItem,targetRow){if(!targetRow)return;const currentRow=this.getRowForItem(currentItem),currentIndex=this.getNavigableColumns(currentRow).indexOf(this.getCellWithItem(currentItem)),targetCols=this.getNavigableColumns(targetRow);this.focusCell(targetCols[currentIndex])}focusCellAbove(item){this.focusSameCellInRow(item,this.getPreviousRow(item))}focusCellBelow(item){this.focusSameCellInRow(item,this.getNextRow(item))}focusCurrentRow(rowChild){this.focus(this.getRowForItem(rowChild))}focusRowAbove(item){this.focus(this.getPreviousRow(item))}focusRowBelow(item){this.focus(this.getNextRow(item))}focusFirstCell(row){this.focus(row.querySelector("td"))}focusLastCell(row){this.focus(row.querySelectorAll("td").pop())}focusFirstCellInRow(item){this.focusFirstCell(this.getRowForItem(item))}focusLastCellInRow(item){this.focusLastCell(this.getRowForItem(item))}focusNextCell(item){this.focus(item.nextElementSibling)}focusPreviousCell(item){this.focus(item.previousElementSibling)}rowFocusSupported(){return!("focusRows"in this.treeElement.dataset)||this.treeElement.dataset.focusRows}getRowLevel(row){return parseInt(row.getAttribute("aria-level"))}}return _exports.default=TreeGrid,_exports.default}));

//# sourceMappingURL=treegrid.min.js.map