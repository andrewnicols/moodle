{"version":3,"file":"dynamic.min.js","sources":["../src/dynamic.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module to handle dynamic table features.\n *\n * @module     core_table/dynamic\n * @copyright  2020 Simey Lameze <simey@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport * as Selectors from 'core_table/local/dynamic/selectors';\nimport Events from './local/dynamic/events';\nimport Pending from 'core/pending';\nimport {addIconToContainer} from 'core/loadingicon';\nimport {fetch as fetchTableData} from 'core_table/local/dynamic/repository';\nimport Notification from 'core/notification';\n\nlet watching = false;\n\n/**\n * Ensure that a table is a dynamic table.\n *\n * @param {HTMLElement} tableRoot\n * @returns {Bool}\n */\nconst checkTableIsDynamic = tableRoot => {\n    if (!tableRoot) {\n        // The table is not a dynamic table.\n        throw new Error(\"The table specified is not a dynamic table and cannot be updated\");\n    }\n\n    if (!tableRoot.matches(Selectors.main.region)) {\n        // The table is not a dynamic table.\n        throw new Error(\"The table specified is not a dynamic table and cannot be updated\");\n    }\n\n    return true;\n};\n\n/**\n * Get the filterset data from a known dynamic table.\n *\n * @param {HTMLElement} tableRoot\n * @returns {Object}\n */\nconst getFiltersetFromTable = tableRoot => {\n    return JSON.parse(tableRoot.dataset.tableFilters);\n};\n\n/**\n * Update the specified table based on its current values.\n *\n * @param {HTMLElement} tableRoot\n * @param {Bool} resetContent\n * @returns {Promise}\n */\nexport const refreshTableContent = (tableRoot, resetContent = false) => {\n    const filterset = getFiltersetFromTable(tableRoot);\n    addIconToContainer(tableRoot);\n\n    const pendingPromise = new Pending('core_table/dynamic:refreshTableContent');\n\n    return fetchTableData(\n        tableRoot.dataset.tableComponent,\n        tableRoot.dataset.tableHandler,\n        tableRoot.dataset.tableUniqueid,\n        {\n            sortData: JSON.parse(tableRoot.dataset.tableSortData),\n            joinType: filterset.jointype,\n            filters: filterset.filters,\n            firstinitial: tableRoot.dataset.tableFirstInitial,\n            lastinitial: tableRoot.dataset.tableLastInitial,\n            pageNumber: tableRoot.dataset.tablePageNumber,\n            pageSize: tableRoot.dataset.tablePageSize,\n            hiddenColumns: JSON.parse(tableRoot.dataset.tableHiddenColumns),\n        },\n        resetContent,\n    )\n    .then(data => {\n        const placeholder = document.createElement('div');\n        placeholder.innerHTML = data.html;\n        tableRoot.replaceWith(...placeholder.childNodes);\n\n        // Update the tableRoot.\n        return getTableFromId(tableRoot.dataset.tableUniqueid);\n    }).then(tableRoot => {\n        tableRoot.dispatchEvent(new CustomEvent(Events.tableContentRefreshed, {\n            bubbles: true,\n        }));\n\n        return tableRoot;\n    })\n    .then(tableRoot => {\n        pendingPromise.resolve();\n\n        return tableRoot;\n    });\n};\n\nexport const updateTable = (tableRoot, {\n    sortBy = null,\n    sortOrder = null,\n    filters = null,\n    firstInitial = null,\n    lastInitial = null,\n    pageNumber = null,\n    pageSize = null,\n    hiddenColumns = null,\n} = {}, refreshContent = true) => {\n    checkTableIsDynamic(tableRoot);\n\n    const pendingPromise = new Pending('core_table/dynamic:updateTable');\n    let tableConfigChanged = false;\n\n    // Update sort fields.\n    if (sortBy && sortOrder) {\n        // Always update the table if requested and there were sort fields.\n        // These fields are only ever normalised in the backend.\n        tableConfigChanged = true;\n\n        const sortData = JSON.parse(tableRoot.dataset.tableSortData);\n        sortData.unshift({\n            sortby: sortBy,\n            sortorder: parseInt(sortOrder, 10),\n        });\n        tableRoot.dataset.tableSortData = JSON.stringify(sortData);\n    }\n\n    // Update initials.\n    if (firstInitial !== null) {\n        if (tableRoot.dataset.tableFirstInitial !== firstInitial) {\n            tableConfigChanged = true;\n        }\n\n        tableRoot.dataset.tableFirstInitial = firstInitial;\n    }\n\n    if (lastInitial !== null) {\n        if (tableRoot.dataset.tableLastInitial !== lastInitial) {\n            tableConfigChanged = true;\n        }\n\n        tableRoot.dataset.tableLastInitial = lastInitial;\n    }\n\n    if (pageSize !== null) {\n        if (tableRoot.dataset.tablePageSize != pageSize) {\n            tableConfigChanged = true;\n        }\n\n        tableRoot.dataset.tablePageSize = pageSize;\n    }\n\n    // Update filters.\n    if (filters) {\n        const filterJson = JSON.stringify(filters);\n\n        if (tableRoot.dataset.tableFilters !== filterJson) {\n            tableConfigChanged = true;\n        }\n\n        tableRoot.dataset.tableFilters = filterJson;\n    }\n\n    // Reset to page 1 when table content is being altered by filtering or sorting.\n    // This ensures the table page being loaded always exists, and gives a consistent experience.\n    if (tableConfigChanged) {\n        pageNumber = 1;\n    }\n\n    // Update hidden columns.\n    if (hiddenColumns) {\n        const columnJson = JSON.stringify(hiddenColumns);\n\n        if (tableRoot.dataset.tableHiddenColumns !== columnJson) {\n            tableConfigChanged = true;\n        }\n\n        tableRoot.dataset.tableHiddenColumns = columnJson;\n    }\n\n    if (pageNumber !== null) {\n        if (tableRoot.dataset.tablePageNumber != pageNumber) {\n            tableConfigChanged = true;\n        }\n\n        tableRoot.dataset.tablePageNumber = pageNumber;\n    }\n\n    // Refresh.\n    if (refreshContent && tableConfigChanged) {\n        return refreshTableContent(tableRoot)\n        .then(tableRoot => {\n            pendingPromise.resolve();\n            return tableRoot;\n        });\n    } else {\n        pendingPromise.resolve();\n        return Promise.resolve(tableRoot);\n    }\n};\n\n/**\n * Get the table dataset for the specified tableRoot, ensuring that the provided table is a dynamic table.\n *\n * @param {HTMLElement} tableRoot\n * @returns {DOMStringMap}\n */\nconst getTableData = tableRoot => {\n    checkTableIsDynamic(tableRoot);\n\n    return tableRoot.dataset;\n};\n\n/**\n * Update the specified table using the new filters.\n *\n * @param {HTMLElement} tableRoot\n * @param {Object} filters\n * @param {Bool} refreshContent\n * @returns {Promise}\n */\nexport const setFilters = (tableRoot, filters, refreshContent = true) =>\n    updateTable(tableRoot, {filters}, refreshContent);\n\n/**\n * Get the filter data for the specified table.\n *\n * @param {HTMLElement} tableRoot\n * @returns {Object}\n */\nexport const getFilters = tableRoot => {\n    checkTableIsDynamic(tableRoot);\n\n    return getFiltersetFromTable(tableRoot);\n};\n\n/**\n * Update the sort order.\n *\n * @param {HTMLElement} tableRoot\n * @param {String} sortBy\n * @param {Number} sortOrder\n * @param {Bool} refreshContent\n * @returns {Promise}\n */\nexport const setSortOrder = (tableRoot, sortBy, sortOrder, refreshContent = true) =>\n    updateTable(tableRoot, {sortBy, sortOrder}, refreshContent);\n\n/**\n * Set the page number.\n *\n * @param {HTMLElement} tableRoot\n * @param {String} pageNumber\n * @param {Bool} refreshContent\n * @returns {Promise}\n */\nexport const setPageNumber = (tableRoot, pageNumber, refreshContent = true) =>\n    updateTable(tableRoot, {pageNumber}, refreshContent);\n\n/**\n * Get the current page number.\n *\n * @param {HTMLElement} tableRoot\n * @returns {Number}\n */\nexport const getPageNumber = tableRoot => getTableData(tableRoot).tablePageNumber;\n\n/**\n * Set the page size.\n *\n * @param {HTMLElement} tableRoot\n * @param {Number} pageSize\n * @param {Bool} refreshContent\n * @returns {Promise}\n */\nexport const setPageSize = (tableRoot, pageSize, refreshContent = true) =>\n    updateTable(tableRoot, {pageSize, pageNumber: 1}, refreshContent);\n\n/**\n * Get the current page size.\n *\n * @param {HTMLElement} tableRoot\n * @returns {Number}\n */\nexport const getPageSize = tableRoot => getTableData(tableRoot).tablePageSize;\n\n/**\n * Update the first initial to show.\n *\n * @param {HTMLElement} tableRoot\n * @param {String} firstInitial\n * @param {Bool} refreshContent\n * @returns {Promise}\n */\nexport const setFirstInitial = (tableRoot, firstInitial, refreshContent = true) =>\n    updateTable(tableRoot, {firstInitial}, refreshContent);\n\n/**\n * Get the current first initial filter.\n *\n * @param {HTMLElement} tableRoot\n * @returns {String}\n */\nexport const getFirstInitial = tableRoot => getTableData(tableRoot).tableFirstInitial;\n\n/**\n * Update the last initial to show.\n *\n * @param {HTMLElement} tableRoot\n * @param {String} lastInitial\n * @param {Bool} refreshContent\n * @returns {Promise}\n */\nexport const setLastInitial = (tableRoot, lastInitial, refreshContent = true) =>\n    updateTable(tableRoot, {lastInitial}, refreshContent);\n\n/**\n * Get the current last initial filter.\n *\n * @param {HTMLElement} tableRoot\n * @returns {String}\n */\nexport const getLastInitial = tableRoot => getTableData(tableRoot).tableLastInitial;\n\n/**\n * Hide a column in the participants table.\n *\n * @param {HTMLElement} tableRoot\n * @param {String} columnToHide\n * @param {Bool} refreshContent\n * @returns {Promise}\n */\nexport const hideColumn = (tableRoot, columnToHide, refreshContent = true) => {\n    const hiddenColumns = JSON.parse(tableRoot.dataset.tableHiddenColumns);\n    hiddenColumns.push(columnToHide);\n\n    return updateTable(tableRoot, {hiddenColumns}, refreshContent);\n};\n\n/**\n * Make a hidden column visible in the participants table.\n *\n * @param {HTMLElement} tableRoot\n * @param {String} columnToShow\n * @param {Bool} refreshContent\n * @returns {Promise}\n */\nexport const showColumn = (tableRoot, columnToShow, refreshContent = true) => {\n    let hiddenColumns = JSON.parse(tableRoot.dataset.tableHiddenColumns);\n    hiddenColumns = hiddenColumns.filter(columnName => columnName !== columnToShow);\n\n    return updateTable(tableRoot, {hiddenColumns}, refreshContent);\n};\n\n/**\n * Reset table preferences.\n *\n * @param {HTMLElement} tableRoot\n * @returns {Promise}\n */\nconst resetTablePreferences = tableRoot => refreshTableContent(tableRoot, true);\n\n/**\n * Set up listeners to handle table updates.\n */\nexport const init = () => {\n    if (watching) {\n        // Already watching.\n        return;\n    }\n    watching = true;\n\n    document.addEventListener('click', e => {\n        const tableRoot = e.target.closest(Selectors.main.region);\n\n        if (!tableRoot) {\n            return;\n        }\n\n        const sortableLink = e.target.closest(Selectors.table.links.sortableColumn);\n        if (sortableLink) {\n            e.preventDefault();\n\n            setSortOrder(tableRoot, sortableLink.dataset.sortby, sortableLink.dataset.sortorder)\n            .catch(Notification.exception);\n        }\n\n        const firstInitialLink = e.target.closest(Selectors.initialsBar.links.firstInitial);\n        if (firstInitialLink !== null) {\n            e.preventDefault();\n\n            setFirstInitial(tableRoot, firstInitialLink.dataset.initial).catch(Notification.exception);\n        }\n\n        const lastInitialLink = e.target.closest(Selectors.initialsBar.links.lastInitial);\n        if (lastInitialLink !== null) {\n            e.preventDefault();\n\n            setLastInitial(tableRoot, lastInitialLink.dataset.initial).catch(Notification.exception);\n        }\n\n        const pageItem = e.target.closest(Selectors.paginationBar.links.pageItem);\n        if (pageItem) {\n            e.preventDefault();\n\n            setPageNumber(tableRoot, pageItem.dataset.pageNumber).catch(Notification.exception);\n        }\n\n        const hide = e.target.closest(Selectors.table.links.hide);\n        if (hide) {\n            e.preventDefault();\n\n            hideColumn(tableRoot, hide.dataset.column).catch(Notification.exception);\n        }\n\n        const show = e.target.closest(Selectors.table.links.show);\n        if (show) {\n            e.preventDefault();\n\n            showColumn(tableRoot, show.dataset.column).catch(Notification.exception);\n        }\n\n        const resetTablePreferencesLink = e.target.closest('.resettable a');\n        if (resetTablePreferencesLink) {\n            e.preventDefault();\n\n            resetTablePreferences(tableRoot).catch(Notification.exception);\n        }\n\n        const showCountLink = e.target.closest(Selectors.showCount.links.toggle);\n        if (showCountLink) {\n            e.preventDefault();\n\n            setPageSize(tableRoot, showCountLink.dataset.targetPageSize).catch(Notification.exception);\n        }\n    });\n};\n\n/**\n * Fetch the table via its table region id.\n *\n * @param {String} tableRegionId\n * @returns {HTMLElement}\n */\nexport const getTableFromId = tableRegionId => {\n    const tableRoot = document.querySelector(Selectors.main.fromRegionId(tableRegionId));\n\n\n    if (!tableRoot) {\n        // The table is not a dynamic table.\n        throw new Error(\"The table specified is not a dynamic table and cannot be updated\");\n    }\n\n    return tableRoot;\n};\n\nexport {\n    Events\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","_toConsumableArray","arr","_arrayWithoutHoles","Array","isArray","_arrayLikeToArray","iter","Symbol","iterator","from","_iterableToArray","o","minLen","n","Object","prototype","toString","call","slice","constructor","name","test","_unsupportedIterableToArray","TypeError","_nonIterableSpread","len","length","i","arr2","Selectors","_typeof","cache","has","get","newObj","hasPropertyDescriptor","defineProperty","getOwnPropertyDescriptor","key","hasOwnProperty","desc","set","_interopRequireWildcard","_events","_pending","_notification","watching","checkTableIsDynamic","tableRoot","Error","matches","main","region","getFiltersetFromTable","JSON","parse","dataset","tableFilters","refreshTableContent","resetContent","arguments","undefined","filterset","addIconToContainer","pendingPromise","Pending","fetchTableData","tableComponent","tableHandler","tableUniqueid","sortData","tableSortData","joinType","jointype","filters","firstinitial","tableFirstInitial","lastinitial","tableLastInitial","pageNumber","tablePageNumber","pageSize","tablePageSize","hiddenColumns","tableHiddenColumns","then","data","placeholder","document","createElement","innerHTML","html","replaceWith","apply","childNodes","getTableFromId","dispatchEvent","CustomEvent","Events","tableContentRefreshed","bubbles","resolve","_exports","updateTable","_ref","_ref$sortBy","sortBy","_ref$sortOrder","sortOrder","_ref$filters","_ref$firstInitial","firstInitial","_ref$lastInitial","lastInitial","_ref$pageNumber","_ref$pageSize","_ref$hiddenColumns","refreshContent","tableConfigChanged","unshift","sortby","sortorder","parseInt","stringify","filterJson","columnJson","Promise","getTableData","setFilters","getFilters","setSortOrder","setPageNumber","getPageNumber","setPageSize","getPageSize","setFirstInitial","getFirstInitial","setLastInitial","getLastInitial","hideColumn","columnToHide","push","showColumn","columnToShow","filter","columnName","init","addEventListener","e","target","closest","sortableLink","table","links","sortableColumn","preventDefault","catch","Notification","exception","firstInitialLink","initialsBar","initial","lastInitialLink","pageItem","paginationBar","hide","column","show","resetTablePreferences","showCountLink","showCount","toggle","targetPageSize","tableRegionId","querySelector","fromRegionId"],"mappings":"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"}