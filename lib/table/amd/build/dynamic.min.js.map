{"version":3,"sources":["../src/dynamic.js"],"names":["watching","checkTableIsDynamic","tableRoot","Error","matches","Selectors","main","region","getFiltersetFromTable","JSON","parse","dataset","tableFilters","refreshTableContent","resetContent","filterset","pendingPromise","Pending","tableComponent","tableHandler","tableUniqueid","sortData","tableSortData","joinType","jointype","filters","firstinitial","tableFirstInitial","lastinitial","tableLastInitial","pageNumber","tablePageNumber","pageSize","tablePageSize","hiddenColumns","tableHiddenColumns","then","data","placeholder","document","createElement","innerHTML","html","replaceWith","childNodes","getTableFromId","dispatchEvent","CustomEvent","Events","tableContentRefreshed","bubbles","resolve","updateTable","sortBy","sortOrder","firstInitial","lastInitial","refreshContent","tableConfigChanged","unshift","sortby","sortorder","parseInt","stringify","filterJson","columnJson","Promise","getTableData","setFilters","getFilters","setSortOrder","setPageNumber","getPageNumber","setPageSize","getPageSize","setFirstInitial","getFirstInitial","setLastInitial","getLastInitial","hideColumn","columnToHide","push","showColumn","columnToShow","filter","columnName","resetTablePreferences","init","addEventListener","e","target","closest","sortableLink","table","links","sortableColumn","preventDefault","catch","Notification","exception","firstInitialLink","initialsBar","initial","lastInitialLink","pageItem","paginationBar","hide","column","show","resetTablePreferencesLink","tableRegionId","querySelector","fromRegionId"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module to handle dynamic table features.\n *\n * @module     core_table/dynamic\n * @package    core_table\n * @copyright  2020 Simey Lameze <simey@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport * as Selectors from 'core_table/local/dynamic/selectors';\nimport Events from './local/dynamic/events';\nimport Pending from 'core/pending';\nimport {addIconToContainer} from 'core/loadingicon';\nimport {fetch as fetchTableData} from 'core_table/local/dynamic/repository';\nimport Notification from 'core/notification';\n\nlet watching = false;\n\n/**\n * Ensure that a table is a dynamic table.\n *\n * @param {HTMLElement} tableRoot\n * @returns {Bool}\n */\nconst checkTableIsDynamic = tableRoot => {\n    if (!tableRoot) {\n        // The table is not a dynamic table.\n        throw new Error(\"The table specified is not a dynamic table and cannot be updated\");\n    }\n\n    if (!tableRoot.matches(Selectors.main.region)) {\n        // The table is not a dynamic table.\n        throw new Error(\"The table specified is not a dynamic table and cannot be updated\");\n    }\n\n    return true;\n};\n\n/**\n * Get the filterset data from a known dynamic table.\n *\n * @param {HTMLElement} tableRoot\n * @returns {Object}\n */\nconst getFiltersetFromTable = tableRoot => {\n    return JSON.parse(tableRoot.dataset.tableFilters);\n};\n\n/**\n * Update the specified table based on its current values.\n *\n * @param {HTMLElement} tableRoot\n * @param {Bool} resetContent\n * @returns {Promise}\n */\nexport const refreshTableContent = (tableRoot, resetContent = false) => {\n    const filterset = getFiltersetFromTable(tableRoot);\n    addIconToContainer(tableRoot);\n\n    const pendingPromise = new Pending('core_table/dynamic:refreshTableContent');\n\n    return fetchTableData(\n        tableRoot.dataset.tableComponent,\n        tableRoot.dataset.tableHandler,\n        tableRoot.dataset.tableUniqueid,\n        {\n            sortData: JSON.parse(tableRoot.dataset.tableSortData),\n            joinType: filterset.jointype,\n            filters: filterset.filters,\n            firstinitial: tableRoot.dataset.tableFirstInitial,\n            lastinitial: tableRoot.dataset.tableLastInitial,\n            pageNumber: tableRoot.dataset.tablePageNumber,\n            pageSize: tableRoot.dataset.tablePageSize,\n            hiddenColumns: JSON.parse(tableRoot.dataset.tableHiddenColumns),\n        },\n        resetContent,\n    )\n    .then(data => {\n        const placeholder = document.createElement('div');\n        placeholder.innerHTML = data.html;\n        tableRoot.replaceWith(...placeholder.childNodes);\n\n        // Update the tableRoot.\n        return getTableFromId(tableRoot.dataset.tableUniqueid);\n    }).then(tableRoot => {\n        tableRoot.dispatchEvent(new CustomEvent(Events.tableContentRefreshed, {\n            bubbles: true,\n        }));\n\n        return tableRoot;\n    })\n    .then(tableRoot => {\n        pendingPromise.resolve();\n\n        return tableRoot;\n    });\n};\n\nexport const updateTable = (tableRoot, {\n    sortBy = null,\n    sortOrder = null,\n    filters = null,\n    firstInitial = null,\n    lastInitial = null,\n    pageNumber = null,\n    pageSize = null,\n    hiddenColumns = null,\n} = {}, refreshContent = true) => {\n    checkTableIsDynamic(tableRoot);\n\n    const pendingPromise = new Pending('core_table/dynamic:updateTable');\n    let tableConfigChanged = false;\n\n    // Update sort fields.\n    if (sortBy && sortOrder) {\n        // Always update the table if requested and there were sort fields.\n        // These fields are only ever normalised in the backend.\n        tableConfigChanged = true;\n\n        const sortData = JSON.parse(tableRoot.dataset.tableSortData);\n        sortData.unshift({\n            sortby: sortBy,\n            sortorder: parseInt(sortOrder, 10),\n        });\n        tableRoot.dataset.tableSortData = JSON.stringify(sortData);\n    }\n\n    // Update initials.\n    if (firstInitial !== null) {\n        if (tableRoot.dataset.tableFirstInitial !== firstInitial) {\n            tableConfigChanged = true;\n        }\n\n        tableRoot.dataset.tableFirstInitial = firstInitial;\n    }\n\n    if (lastInitial !== null) {\n        if (tableRoot.dataset.tableLastInitial !== lastInitial) {\n            tableConfigChanged = true;\n        }\n\n        tableRoot.dataset.tableLastInitial = lastInitial;\n    }\n\n    if (pageSize !== null) {\n        if (tableRoot.dataset.tablePageSize != pageSize) {\n            tableConfigChanged = true;\n        }\n\n        tableRoot.dataset.tablePageSize = pageSize;\n    }\n\n    // Update filters.\n    if (filters) {\n        const filterJson = JSON.stringify(filters);\n\n        if (tableRoot.dataset.tableFilters !== filterJson) {\n            tableConfigChanged = true;\n        }\n\n        tableRoot.dataset.tableFilters = filterJson;\n    }\n\n    // Reset to page 1 when table content is being altered by filtering or sorting.\n    // This ensures the table page being loaded always exists, and gives a consistent experience.\n    if (tableConfigChanged) {\n        pageNumber = 1;\n    }\n\n    // Update hidden columns.\n    if (hiddenColumns) {\n        const columnJson = JSON.stringify(hiddenColumns);\n\n        if (tableRoot.dataset.tableHiddenColumns !== columnJson) {\n            tableConfigChanged = true;\n        }\n\n        tableRoot.dataset.tableHiddenColumns = columnJson;\n    }\n\n    if (pageNumber !== null) {\n        if (tableRoot.dataset.tablePageNumber != pageNumber) {\n            tableConfigChanged = true;\n        }\n\n        tableRoot.dataset.tablePageNumber = pageNumber;\n    }\n\n    // Refresh.\n    if (refreshContent && tableConfigChanged) {\n        return refreshTableContent(tableRoot)\n        .then(tableRoot => {\n            pendingPromise.resolve();\n            return tableRoot;\n        });\n    } else {\n        pendingPromise.resolve();\n        return Promise.resolve(tableRoot);\n    }\n};\n\n/**\n * Get the table dataset for the specified tableRoot, ensuring that the provided table is a dynamic table.\n *\n * @param {HTMLElement} tableRoot\n * @returns {DOMStringMap}\n */\nconst getTableData = tableRoot => {\n    checkTableIsDynamic(tableRoot);\n\n    return tableRoot.dataset;\n};\n\n/**\n * Update the specified table using the new filters.\n *\n * @param {HTMLElement} tableRoot\n * @param {Object} filters\n * @param {Bool} refreshContent\n * @returns {Promise}\n */\nexport const setFilters = (tableRoot, filters, refreshContent = true) =>\n    updateTable(tableRoot, {filters}, refreshContent);\n\n/**\n * Get the filter data for the specified table.\n *\n * @param {HTMLElement} tableRoot\n * @returns {Object}\n */\nexport const getFilters = tableRoot => {\n    checkTableIsDynamic(tableRoot);\n\n    return getFiltersetFromTable(tableRoot);\n};\n\n/**\n * Update the sort order.\n *\n * @param {HTMLElement} tableRoot\n * @param {String} sortBy\n * @param {Number} sortOrder\n * @param {Bool} refreshContent\n * @returns {Promise}\n */\nexport const setSortOrder = (tableRoot, sortBy, sortOrder, refreshContent = true) =>\n    updateTable(tableRoot, {sortBy, sortOrder}, refreshContent);\n\n/**\n * Set the page number.\n *\n * @param {HTMLElement} tableRoot\n * @param {String} pageNumber\n * @param {Bool} refreshContent\n * @returns {Promise}\n */\nexport const setPageNumber = (tableRoot, pageNumber, refreshContent = true) =>\n    updateTable(tableRoot, {pageNumber}, refreshContent);\n\n/**\n * Get the current page number.\n *\n * @param {HTMLElement} tableRoot\n * @returns {Number}\n */\nexport const getPageNumber = tableRoot => getTableData(tableRoot).tablePageNumber;\n\n/**\n * Set the page size.\n *\n * @param {HTMLElement} tableRoot\n * @param {Number} pageSize\n * @param {Bool} refreshContent\n * @returns {Promise}\n */\nexport const setPageSize = (tableRoot, pageSize, refreshContent = true) =>\n    updateTable(tableRoot, {pageSize, pageNumber: 1}, refreshContent);\n\n/**\n * Get the current page size.\n *\n * @param {HTMLElement} tableRoot\n * @returns {Number}\n */\nexport const getPageSize = tableRoot => getTableData(tableRoot).tablePageSize;\n\n/**\n * Update the first initial to show.\n *\n * @param {HTMLElement} tableRoot\n * @param {String} firstInitial\n * @param {Bool} refreshContent\n * @returns {Promise}\n */\nexport const setFirstInitial = (tableRoot, firstInitial, refreshContent = true) =>\n    updateTable(tableRoot, {firstInitial}, refreshContent);\n\n/**\n * Get the current first initial filter.\n *\n * @param {HTMLElement} tableRoot\n * @returns {String}\n */\nexport const getFirstInitial = tableRoot => getTableData(tableRoot).tableFirstInitial;\n\n/**\n * Update the last initial to show.\n *\n * @param {HTMLElement} tableRoot\n * @param {String} lastInitial\n * @param {Bool} refreshContent\n * @returns {Promise}\n */\nexport const setLastInitial = (tableRoot, lastInitial, refreshContent = true) =>\n    updateTable(tableRoot, {lastInitial}, refreshContent);\n\n/**\n * Get the current last initial filter.\n *\n * @param {HTMLElement} tableRoot\n * @returns {String}\n */\nexport const getLastInitial = tableRoot => getTableData(tableRoot).tableLastInitial;\n\n/**\n * Hide a column in the participants table.\n *\n * @param {HTMLElement} tableRoot\n * @param {String} columnToHide\n * @param {Bool} refreshContent\n * @returns {Promise}\n */\nexport const hideColumn = (tableRoot, columnToHide, refreshContent = true) => {\n    const hiddenColumns = JSON.parse(tableRoot.dataset.tableHiddenColumns);\n    hiddenColumns.push(columnToHide);\n\n    return updateTable(tableRoot, {hiddenColumns}, refreshContent);\n};\n\n/**\n * Make a hidden column visible in the participants table.\n *\n * @param {HTMLElement} tableRoot\n * @param {String} columnToShow\n * @param {Bool} refreshContent\n * @returns {Promise}\n */\nexport const showColumn = (tableRoot, columnToShow, refreshContent = true) => {\n    let hiddenColumns = JSON.parse(tableRoot.dataset.tableHiddenColumns);\n    hiddenColumns = hiddenColumns.filter(columnName => columnName !== columnToShow);\n\n    return updateTable(tableRoot, {hiddenColumns}, refreshContent);\n};\n\n/**\n * Reset table preferences.\n *\n * @param {HTMLElement} tableRoot\n * @returns {Promise}\n */\nconst resetTablePreferences = tableRoot => refreshTableContent(tableRoot, true);\n\n/**\n * Set up listeners to handle table updates.\n */\nexport const init = () => {\n    if (watching) {\n        // Already watching.\n        return;\n    }\n    watching = true;\n\n    document.addEventListener('click', e => {\n        const tableRoot = e.target.closest(Selectors.main.region);\n\n        if (!tableRoot) {\n            return;\n        }\n\n        const sortableLink = e.target.closest(Selectors.table.links.sortableColumn);\n        if (sortableLink) {\n            e.preventDefault();\n\n            setSortOrder(tableRoot, sortableLink.dataset.sortby, sortableLink.dataset.sortorder)\n            .catch(Notification.exception);\n        }\n\n        const firstInitialLink = e.target.closest(Selectors.initialsBar.links.firstInitial);\n        if (firstInitialLink !== null) {\n            e.preventDefault();\n\n            setFirstInitial(tableRoot, firstInitialLink.dataset.initial).catch(Notification.exception);\n        }\n\n        const lastInitialLink = e.target.closest(Selectors.initialsBar.links.lastInitial);\n        if (lastInitialLink !== null) {\n            e.preventDefault();\n\n            setLastInitial(tableRoot, lastInitialLink.dataset.initial).catch(Notification.exception);\n        }\n\n        const pageItem = e.target.closest(Selectors.paginationBar.links.pageItem);\n        if (pageItem) {\n            e.preventDefault();\n\n            setPageNumber(tableRoot, pageItem.dataset.pageNumber).catch(Notification.exception);\n        }\n\n        const hide = e.target.closest(Selectors.table.links.hide);\n        if (hide) {\n            e.preventDefault();\n\n            hideColumn(tableRoot, hide.dataset.column).catch(Notification.exception);\n        }\n\n        const show = e.target.closest(Selectors.table.links.show);\n        if (show) {\n            e.preventDefault();\n\n            showColumn(tableRoot, show.dataset.column).catch(Notification.exception);\n        }\n\n        const resetTablePreferencesLink = e.target.closest('.resettable a');\n        if (resetTablePreferencesLink) {\n            e.preventDefault();\n\n            resetTablePreferences(tableRoot).catch(Notification.exception);\n        }\n    });\n};\n\n/**\n * Fetch the table via its table region id.\n *\n * @param {String} tableRegionId\n * @returns {HTMLElement}\n */\nexport const getTableFromId = tableRegionId => {\n    const tableRoot = document.querySelector(Selectors.main.fromRegionId(tableRegionId));\n\n\n    if (!tableRoot) {\n        // The table is not a dynamic table.\n        throw new Error(\"The table specified is not a dynamic table and cannot be updated\");\n    }\n\n    return tableRoot;\n};\n\nexport {\n    Events\n};\n"],"file":"dynamic.min.js"}