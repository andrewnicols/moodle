{"version":3,"file":"collapsesections.min.js","sources":["../src/collapsesections.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Collapse or expand all form sections on clicking the expand all / collapse al link.\n *\n * @module core_form/collapsesections\n * @copyright 2021 Bas Brands\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since 4.0\n */\n\nimport $ from 'jquery';\nimport Pending from 'core/pending';\n\nconst selectors = {\n    header: '.fheader',\n    container: '.fcontainer',\n    uncollapsedSections: '.fcontainer:not(.show)',\n};\n\nconst classes = {\n    collapsed: 'collapsed'\n};\n\nconst setAllExpanded = (collapseMenu) => {\n    collapseMenu.classList.remove(classes.collapsed);\n    collapseMenu.setAttribute('aria-expanded', true);\n};\n\nconst setSomeCollapsed = (collapseMenu) => {\n    collapseMenu.classList.add(classes.collapsed);\n    collapseMenu.removeAttribute('aria-expanded', true);\n};\n\nconst updateCollapseMenu = (collapseMenu) => {\n    if (!document.querySelectorAll(selectors.uncollapsedSections).length) {\n        setAllExpanded(collapseMenu);\n    } else {\n        setSomeCollapsed(collapseMenu);\n    }\n};\n\nconst toggleAllSections = (collapseMenu) => {\n    const collapsed = collapseMenu.classList.contains(classes.collapsed);\n\n    document.querySelectorAll(selectors.container).forEach((collapseContainer) => {\n        $(collapseContainer).collapse(collapsed ? 'show' : 'hide');\n    });\n    collapseMenu.classList.toggle(classes.collapsed);\n};\n\n/**\n * Initialises the form section collapse / expand action.\n *\n * @param {string} collapseSections the collapse/expand link id.\n */\nexport const init = (collapseSections) => {\n    // All jQuery in this code can be replaced when MDL-71979 is integrated (move to Bootstrap 5).\n    const pendingPromise = new Pending('core_form/collapseSections');\n    const collapseMenu = document.querySelector(collapseSections);\n    collapseMenu.addEventListener('keydown', e => {\n        if (e.key === 'Enter' || e.key === ' ') {\n            e.preventDefault();\n            toggleAllSections(collapseMenu);\n        }\n    });\n    collapseMenu.addEventListener('click', () => toggleAllSections(collapseMenu));\n\n    // Ensure collapse menu button adds aria-controls attribute referring to each collapsible element.\n    const collapsibleElementIds = Array.from(document.querySelectorAll(selectors.header)).map((element, index) => {\n        if (!element.id) {\n            element.id = `collapsible-${index}`;\n        }\n\n        return element.id;\n    });\n    collapseMenu.setAttribute('aria-controls', collapsibleElementIds.join(' '));\n\n    $(selectors.container).on('hidden.bs.collapse shown.bs.collapse', () => updateCollapseMenu(collapseMenu));\n    updateCollapseMenu(collapseMenu);\n\n    pendingPromise.resolve();\n};\n"],"names":["selectors","classes","updateCollapseMenu","collapseMenu","document","querySelectorAll","length","classList","add","removeAttribute","setSomeCollapsed","remove","setAttribute","setAllExpanded","toggleAllSections","collapsed","contains","forEach","collapseContainer","collapse","toggle","collapseSections","pendingPromise","Pending","querySelector","addEventListener","e","key","preventDefault","collapsibleElementIds","Array","from","map","element","index","id","join","on","resolve"],"mappings":";;;;;;;;0KA2BMA,iBACM,WADNA,oBAES,cAFTA,8BAGmB,yBAGnBC,kBACS,YAaTC,mBAAsBC,eACnBC,SAASC,iBAAiBL,+BAA+BM,OANxCH,CAAAA,eACtBA,aAAaI,UAAUC,IAAIP,mBAC3BE,aAAaM,gBAAgB,iBAAiB,IAO1CC,CAAiBP,cAdDA,CAAAA,eACpBA,aAAaI,UAAUI,OAAOV,mBAC9BE,aAAaS,aAAa,iBAAiB,IAUvCC,CAAeV,eAMjBW,kBAAqBX,qBACjBY,UAAYZ,aAAaI,UAAUS,SAASf,mBAElDG,SAASC,iBAAiBL,qBAAqBiB,SAASC,wCAClDA,mBAAmBC,SAASJ,UAAY,OAAS,WAEvDZ,aAAaI,UAAUa,OAAOnB,kCAQboB,yBAEXC,eAAiB,IAAIC,iBAAQ,8BAC7BpB,aAAeC,SAASoB,cAAcH,kBAC5ClB,aAAasB,iBAAiB,WAAWC,IACvB,UAAVA,EAAEC,KAA6B,MAAVD,EAAEC,MACvBD,EAAEE,iBACFd,kBAAkBX,kBAG1BA,aAAasB,iBAAiB,SAAS,IAAMX,kBAAkBX,sBAGzD0B,sBAAwBC,MAAMC,KAAK3B,SAASC,iBAAiBL,mBAAmBgC,KAAI,CAACC,QAASC,SAC3FD,QAAQE,KACTF,QAAQE,yBAAoBD,QAGzBD,QAAQE,MAEnBhC,aAAaS,aAAa,gBAAiBiB,sBAAsBO,KAAK,0BAEpEpC,qBAAqBqC,GAAG,wCAAwC,IAAMnC,mBAAmBC,gBAC3FD,mBAAmBC,cAEnBmB,eAAegB"}