define ("core_form/passwordunmask",["jquery","core/templates"],function($,Template){var PasswordUnmask=function(elementid){this.wrapperSelector="[data-passwordunmask=\"wrapper\"][data-passwordunmaskid=\""+elementid+"\"]";this.wrapper=$(this.wrapperSelector);this.editorSpace=this.wrapper.find("[data-passwordunmask=\"editor\"]");this.editLink=this.wrapper.find("a[data-passwordunmask=\"edit\"]");this.editInstructions=this.wrapper.find("[data-passwordunmask=\"instructions\"]");this.displayValue=this.wrapper.find("[data-passwordunmask=\"displayvalue\"]");this.inputFieldLabel=$("label[for=\""+elementid+"\"]");this.inputField=this.editorSpace.find(document.getElementById(elementid));this.inputField.attr("type","hidden");this.inputField.removeClass("hiddenifjs");if(!this.editInstructions.attr("id")){this.editInstructions.attr("id",elementid+"_instructions")}this.editInstructions.hide();this.setDisplayValue();this.addListeners()};PasswordUnmask.prototype.addListeners=function(){this.wrapper.on("click keypress","[data-passwordunmask=\"edit\"]",$.proxy(function(e){if("keypress"===e.type&&13!==e.keyCode){return}e.stopImmediatePropagation();e.preventDefault();if("hidden"!==this.inputField.attr("type")){if("click"!==e.type&&!$(e.relatedTarget).is(":input")){this.turnEditingOff(!0)}else{this.turnEditingOff(!1)}}else{this.turnEditingOn()}},this));this.wrapper.on("click keypress","[data-passwordunmask=\"unmask\"]",$.proxy(function(e){if("keypress"===e.type&&13!==e.keyCode){return}e.stopImmediatePropagation();e.preventDefault();this.wrapper.data("unmasked",!this.wrapper.data("unmasked"));this.setDisplayValue()},this));this.wrapper.on("keydown","input",$.proxy(function(e){if("keydown"===e.type&&13!==e.keyCode){return}e.stopImmediatePropagation();e.preventDefault();this.turnEditingOff(!0)},this));this.inputFieldLabel.on("click",$.proxy(function(e){e.preventDefault();this.turnEditingOn()},this));return this};PasswordUnmask.prototype.checkFocusOut=function(e){if(!this.isEditing()){return}window.setTimeout($.proxy(function(){var relatedTarget=e.relatedTarget||document.activeElement;if(this.wrapper.has($(relatedTarget)).length){return}this.turnEditingOff(!$(relatedTarget).is(":input,a"))},this),100)};PasswordUnmask.prototype.passwordVisible=function(){return!!this.wrapper.data("unmasked")};PasswordUnmask.prototype.isEditing=function(){return"hidden"!==this.inputField.attr("type")};PasswordUnmask.prototype.turnEditingOn=function(){var value=this.getDisplayValue();if(this.passwordVisible()){this.inputField.attr("type","text")}else{this.inputField.attr("type","password")}this.inputField.val(value);this.inputField.attr("size",this.inputField.attr("data-size"));if(this.editInstructions.length){this.inputField.attr("aria-describedby",this.editInstructions.attr("id"));this.editInstructions.show()}this.wrapper.attr("data-passwordunmask-visible",1);this.editLink.hide();this.inputField.focus().select();$("body").on("focusout",this.wrapperSelector,$.proxy(this.checkFocusOut,this));return this};PasswordUnmask.prototype.turnEditingOff=function(focusOnEditLink){$("body").off("focusout",this.wrapperSelector,this.checkFocusOut);var value=this.getDisplayValue();this.inputField.attr("type","hidden").attr("aria-describedby",null);this.inputField.val(value);this.editInstructions.hide();this.wrapper.removeAttr("data-passwordunmask-visible");this.inputField.removeAttr("size");this.editLink.show();this.setDisplayValue();if(focusOnEditLink){this.editLink.focus()}return this};PasswordUnmask.prototype.getDisplayValue=function(){return this.inputField.val()};PasswordUnmask.prototype.setDisplayValue=function(){var value=this.getDisplayValue();if(this.isEditing()){if(this.wrapper.data("unmasked")){this.inputField.attr("type","text")}else{this.inputField.attr("type","password")}this.inputField.val(value)}if(value&&this.wrapper.data("unmasked")){this.displayValue.text(value)}else{if(!value){value=""}Template.render("core_form/element-passwordunmask-fill",{element:{frozen:this.inputField.is("[readonly]"),value:value,valuechars:value.split("")}}).done($.proxy(function(html,js){this.displayValue.html(html);Template.runTemplateJS(js)},this))}return this};return PasswordUnmask});
//# sourceMappingURL=passwordunmask.min.js.map
