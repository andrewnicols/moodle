define ("core_form/submit",["exports","core_form/events"],function(_exports,_events){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.init=void 0;let cookieListener=0;const cookieListeningButtons=[];let currentUploadCount=0;const uploadListeningButtons=[];let uploadListenersRegistered=!1;const listenForDownloadCookie=button=>{cookieListeningButtons.push(button);if(!cookieListener){cookieListener=setInterval(()=>{const parts=document.cookie.split(getCookieName()+"=");if(2==parts.length){clearDownloadCookie();clearInterval(cookieListener);cookieListener=0;cookieListeningButtons.forEach(button=>{button.disabled=!1})}},500)}},getCookieName=()=>{return"moodledownload_"+M.cfg.sesskey},clearDownloadCookie=()=>{document.cookie=encodeURIComponent(getCookieName())+"=deleted; expires="+new Date(0).toUTCString()},checkUploadCount=()=>{if(currentUploadCount){uploadListeningButtons.forEach(button=>{button.disabled=!0})}else{uploadListeningButtons.forEach(button=>{button.disabled=!1})}},init=elementId=>{const button=document.getElementById(elementId);if(!button.disabled){uploadListeningButtons.push(button)}if(!uploadListenersRegistered){document.addEventListener(_events.eventTypes.uploadStarted,e=>{window.console.log(e.target);currentUploadCount++;checkUploadCount()});document.addEventListener(_events.eventTypes.uploadCompleted,e=>{window.console.log(e.target);currentUploadCount--;checkUploadCount()});uploadListenersRegistered=!0}if("off"===button.form.dataset.doubleSubmitProtection){return}button.form.addEventListener("submit",function(event){const disableAction=function(){if(event.defaultPrevented||button.disabled){return}button.disabled=!0;clearDownloadCookie();listenForDownloadCookie(button)};window.addEventListener("beforeunload",disableAction);setTimeout(function(){window.removeEventListener("beforeunload",disableAction)},0)},!1)};_exports.init=init});
//# sourceMappingURL=submit.min.js.map
