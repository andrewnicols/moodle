define ("core_form/showadvanced",["jquery","core/log","core/str","core/notification"],function($,Log,Strings,Notification){var SELECTORS={FIELDSETCONTAINSADVANCED:"fieldset.containsadvancedelements",DIVFITEMADVANCED:"div.fitem.advanced",DIVADVANCEDSECTION:"div#form-advanced-div",DIVFCONTAINER:"div.fcontainer",MORELESSLINK:"fieldset.containsadvancedelements .moreless-toggler"},CSS={SHOW:"show",MORELESSACTIONS:"moreless-actions",MORELESSTOGGLER:"moreless-toggler",SHOWLESS:"moreless-less"},WRAPPERS={FITEM:"<div class=\"fitem\"></div>",FELEMENT:"<div class=\"felement\"></div>",ADVANCEDDIV:"<div id=\"form-advanced-div\"></div>"},uniqIdSeed=0,ShowAdvanced=function(id){this.id=id;var form=$(document.getElementById(id));this.enhanceForm(form)};ShowAdvanced.prototype.id="";ShowAdvanced.prototype.enhanceForm=function(form){var fieldsets=form.find(SELECTORS.FIELDSETCONTAINSADVANCED);fieldsets.each(function(index,item){this.enhanceFieldset($(item))}.bind(this));form.on("click",SELECTORS.MORELESSLINK,this.switchState);form.on("keydown",SELECTORS.MORELESSLINK,function(e){if(13==e.which||32==e.which){return this.switchState(e)}return!0}.bind(this));return this};ShowAdvanced.prototype.generateId=function(node){var id=node.prop("id");if("undefined"==typeof id){id="showadvancedid-"+uniqIdSeed++;node.prop("id",id)}return id};ShowAdvanced.prototype.enhanceFieldset=function(fieldset){var statuselement=$("input[name=mform_showmore_"+fieldset.prop("id")+"]");if(!statuselement.length){Log.debug("M.form.showadvanced::processFieldset was called on an fieldset without a status field: '"+fieldset.prop("id")+"'");return this}Strings.get_strings([{key:"showmore",component:"core_form"},{key:"showless",component:"core_form"}]).then(function(results){var showmore=results[0],showless=results[1],morelesslink=$("<a href=\"#\"></a>");morelesslink.addClass(CSS.MORELESSTOGGLER);if("0"===statuselement.val()){morelesslink.html(showmore);morelesslink.attr("aria-expanded","false")}else{morelesslink.html(showless);morelesslink.attr("aria-expanded","true");morelesslink.addClass(CSS.SHOWLESS);fieldset.find(SELECTORS.DIVFITEMADVANCED).addClass(CSS.SHOW)}var idlist=[];fieldset.find(SELECTORS.DIVFITEMADVANCED).each(function(index,node){idlist[idlist.length]=this.generateId($(node))}.bind(this));morelesslink.attr("role","button");morelesslink.attr("aria-controls","form-advanced-div");var formadvancedsection=$(WRAPPERS.ADVANCEDDIV);fieldset.find(SELECTORS.DIVFITEMADVANCED).wrapAll(formadvancedsection);var fitem=$(WRAPPERS.FITEM);fitem.addClass(CSS.MORELESSACTIONS);var felement=$(WRAPPERS.FELEMENT);felement.append(morelesslink);fitem.append(felement);fieldset.find(SELECTORS.DIVADVANCEDSECTION).before(fitem);return!0}.bind(this)).fail(Notification.exception);return this};ShowAdvanced.prototype.switchState=function(e){e.preventDefault();Strings.get_strings([{key:"showmore",component:"core_form"},{key:"showless",component:"core_form"}]).then(function(results){var showmore=results[0],showless=results[1],fieldset=$(e.target).closest(SELECTORS.FIELDSETCONTAINSADVANCED);fieldset.find(SELECTORS.DIVFITEMADVANCED).toggleClass(CSS.SHOW);var statuselement=$("input[name=mform_showmore_"+fieldset.prop("id")+"]");if("0"===statuselement.val()){statuselement.val(1);$(e.target).addClass(CSS.SHOWLESS);$(e.target).html(showless);$(e.target).attr("aria-expanded","true")}else{statuselement.val(0);$(e.target).removeClass(CSS.SHOWLESS);$(e.target).html(showmore);$(e.target).attr("aria-expanded","false")}return!0}).fail(Notification.exception);return this};return{init:function(formid){return new ShowAdvanced(formid)}}});
//# sourceMappingURL=showadvanced.min.js.map
