{"version":3,"sources":["../src/view_nav.js"],"names":["define","$","CustomEvents","Repository","View","Selectors","SELECTORS","FILTERS","FILTER_OPTION","DISPLAY_OPTION","updatePreferences","filter","value","type","updateUserPreferences","preferences","registerSelector","root","Selector","find","events","activate","on","e","data","option","target","hasClass","attr","pref","customfieldvalue","courseView","region","init","originalEvent","preventDefault","reset"],"mappings":"AAsBAA,OAAM,6BACN,CACI,QADJ,CAEI,gCAFJ,CAGI,6BAHJ,CAII,uBAJJ,CAKI,4BALJ,CADM,CAQN,SACIC,CADJ,CAEIC,YAFJ,CAGIC,UAHJ,CAIIC,IAJJ,CAKIC,SALJ,CAME,IAEMC,CAAAA,SAAS,CAAG,CACZC,OAAO,CAAE,0BADG,CAEZC,aAAa,CAAE,eAFH,CAGZC,cAAc,CAAE,uBAHJ,CAFlB,CAcMC,iBAAiB,CAAG,SAASC,MAAT,CAAiBC,KAAjB,CAAwB,CAC5C,GAAIC,CAAAA,IAAI,CAAG,IAAX,CACA,GAAc,SAAV,EAAAF,MAAJ,CAAyB,CACrBE,IAAI,CAAG,uCACV,CAFD,IAEO,IAAc,MAAV,EAAAF,MAAJ,CAAsB,CACzBE,IAAI,CAAG,uCACV,CAFM,IAEA,IAAc,kBAAV,EAAAF,MAAJ,CAAkC,CACrCE,IAAI,CAAG,4DACV,CAFM,IAEA,CACHA,IAAI,CAAG,2CACV,CAEDV,UAAU,CAACW,qBAAX,CAAiC,CAC7BC,WAAW,CAAE,CACT,CACIF,IAAI,CAAEA,IADV,CAEID,KAAK,CAAEA,KAFX,CADS,CADgB,CAAjC,CAQH,CAlCH,CAyCMI,gBAAgB,CAAG,SAASC,IAAT,CAAe,CAElC,GAAIC,CAAAA,QAAQ,CAAGD,IAAI,CAACE,IAAL,CAAUb,SAAS,CAACC,OAApB,CAAf,CAEAL,YAAY,CAACF,MAAb,CAAoBkB,QAApB,CAA8B,CAAChB,YAAY,CAACkB,MAAb,CAAoBC,QAArB,CAA9B,EACAH,QAAQ,CAACI,EAAT,CACIpB,YAAY,CAACkB,MAAb,CAAoBC,QADxB,CAEIf,SAAS,CAACE,aAFd,CAGI,SAASe,CAAT,CAAYC,IAAZ,CAAkB,CACd,GAAIC,CAAAA,MAAM,CAAGxB,CAAC,CAACsB,CAAC,CAACG,MAAH,CAAd,CAEA,GAAID,MAAM,CAACE,QAAP,CAAgB,QAAhB,CAAJ,CAA+B,CAE3B,MACH,CANa,GAQVhB,CAAAA,MAAM,CAAGc,MAAM,CAACG,IAAP,CAAY,aAAZ,CARC,CASVC,IAAI,CAAGJ,MAAM,CAACG,IAAP,CAAY,WAAZ,CATG,CAUVE,gBAAgB,CAAGL,MAAM,CAACG,IAAP,CAAY,uBAAZ,CAVT,CAYdX,IAAI,CAACE,IAAL,CAAUd,SAAS,CAAC0B,UAAV,CAAqBC,MAA/B,EAAuCJ,IAAvC,CAA4C,QAAUjB,MAAtD,CAA8Dc,MAAM,CAACG,IAAP,CAAY,YAAZ,CAA9D,EACAlB,iBAAiB,CAACC,MAAD,CAASkB,IAAT,CAAjB,CAEA,GAAIC,gBAAJ,CAAsB,CAClBb,IAAI,CAACE,IAAL,CAAUd,SAAS,CAAC0B,UAAV,CAAqBC,MAA/B,EAAuCJ,IAAvC,CAA4C,uBAA5C,CAAqEE,gBAArE,EACApB,iBAAiB,CAAC,kBAAD,CAAqBoB,gBAArB,CACpB,CAGD1B,IAAI,CAAC6B,IAAL,CAAUhB,IAAV,EAEAO,IAAI,CAACU,aAAL,CAAmBC,cAAnB,EACH,CA3BL,EA8BAjC,YAAY,CAACF,MAAb,CAAoBkB,QAApB,CAA8B,CAAChB,YAAY,CAACkB,MAAb,CAAoBC,QAArB,CAA9B,EACAH,QAAQ,CAACI,EAAT,CACIpB,YAAY,CAACkB,MAAb,CAAoBC,QADxB,CAEIf,SAAS,CAACG,cAFd,CAGI,SAASc,CAAT,CAAYC,IAAZ,CAAkB,CACd,GAAIC,CAAAA,MAAM,CAAGxB,CAAC,CAACsB,CAAC,CAACG,MAAH,CAAd,CAEA,GAAID,MAAM,CAACE,QAAP,CAAgB,QAAhB,CAAJ,CAA+B,CAC3B,MACH,CALa,GAOVhB,CAAAA,MAAM,CAAGc,MAAM,CAACG,IAAP,CAAY,qBAAZ,CAPC,CAQVC,IAAI,CAAGJ,MAAM,CAACG,IAAP,CAAY,WAAZ,CARG,CAUdX,IAAI,CAACE,IAAL,CAAUd,SAAS,CAAC0B,UAAV,CAAqBC,MAA/B,EAAuCJ,IAAvC,CAA4C,cAA5C,CAA4DH,MAAM,CAACG,IAAP,CAAY,YAAZ,CAA5D,EACAlB,iBAAiB,CAACC,MAAD,CAASkB,IAAT,CAAjB,CACAzB,IAAI,CAACgC,KAAL,CAAWnB,IAAX,EACAO,IAAI,CAACU,aAAL,CAAmBC,cAAnB,EACH,CAjBL,CAmBH,CAhGH,CA6GE,MAAO,CACHF,IAAI,CANG,QAAPA,CAAAA,IAAO,CAAShB,IAAT,CAAe,CACtBA,IAAI,CAAGhB,CAAC,CAACgB,IAAD,CAAR,CACAD,gBAAgB,CAACC,IAAD,CACnB,CAEM,CAGV,CA9HK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manage the timeline view navigation for the overview block.\n *\n * @copyright  2018 Bas Brands <bas@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(\n[\n    'jquery',\n    'core/custom_interaction_events',\n    'block_myoverview/repository',\n    'block_myoverview/view',\n    'block_myoverview/selectors'\n],\nfunction(\n    $,\n    CustomEvents,\n    Repository,\n    View,\n    Selectors\n) {\n\n    var SELECTORS = {\n        FILTERS: '[data-region=\"filter\"]',\n        FILTER_OPTION: '[data-filter]',\n        DISPLAY_OPTION: '[data-display-option]'\n    };\n\n    /**\n     * Update the user preference for the block.\n     *\n     * @param {String} filter The type of filter: display/sort/grouping.\n     * @param {String} value The current preferred value.\n     */\n    var updatePreferences = function(filter, value) {\n        var type = null;\n        if (filter == 'display') {\n            type = 'block_myoverview_user_view_preference';\n        } else if (filter == 'sort') {\n            type = 'block_myoverview_user_sort_preference';\n        } else if (filter == 'customfieldvalue') {\n            type = 'block_myoverview_user_grouping_customfieldvalue_preference';\n        } else {\n            type = 'block_myoverview_user_grouping_preference';\n        }\n\n        Repository.updateUserPreferences({\n            preferences: [\n                {\n                    type: type,\n                    value: value\n                }\n            ]\n        });\n    };\n\n    /**\n     * Event listener for the Display filter (cards, list).\n     *\n     * @param {object} root The root element for the overview block\n     */\n    var registerSelector = function(root) {\n\n        var Selector = root.find(SELECTORS.FILTERS);\n\n        CustomEvents.define(Selector, [CustomEvents.events.activate]);\n        Selector.on(\n            CustomEvents.events.activate,\n            SELECTORS.FILTER_OPTION,\n            function(e, data) {\n                var option = $(e.target);\n\n                if (option.hasClass('active')) {\n                    // If it's already active then we don't need to do anything.\n                    return;\n                }\n\n                var filter = option.attr('data-filter');\n                var pref = option.attr('data-pref');\n                var customfieldvalue = option.attr('data-customfieldvalue');\n\n                root.find(Selectors.courseView.region).attr('data-' + filter, option.attr('data-value'));\n                updatePreferences(filter, pref);\n\n                if (customfieldvalue) {\n                    root.find(Selectors.courseView.region).attr('data-customfieldvalue', customfieldvalue);\n                    updatePreferences('customfieldvalue', customfieldvalue);\n                }\n\n                // Reset the views.\n                View.init(root);\n\n                data.originalEvent.preventDefault();\n            }\n        );\n\n        CustomEvents.define(Selector, [CustomEvents.events.activate]);\n        Selector.on(\n            CustomEvents.events.activate,\n            SELECTORS.DISPLAY_OPTION,\n            function(e, data) {\n                var option = $(e.target);\n\n                if (option.hasClass('active')) {\n                    return;\n                }\n\n                var filter = option.attr('data-display-option');\n                var pref = option.attr('data-pref');\n\n                root.find(Selectors.courseView.region).attr('data-display', option.attr('data-value'));\n                updatePreferences(filter, pref);\n                View.reset(root);\n                data.originalEvent.preventDefault();\n            }\n        );\n    };\n\n    /**\n     * Initialise the timeline view navigation by adding event listeners to\n     * the navigation elements.\n     *\n     * @param {object} root The root element for the myoverview block\n     */\n    var init = function(root) {\n        root = $(root);\n        registerSelector(root);\n    };\n\n    return {\n        init: init\n    };\n});\n"],"file":"view_nav.min.js"}