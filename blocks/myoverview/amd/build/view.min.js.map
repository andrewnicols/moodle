{"version":3,"sources":["../src/view.js"],"names":["define","$","Repository","PagedContentFactory","PubSub","CustomEvents","Notification","Templates","CourseEvents","Selectors","PagedContentEvents","Aria","SELECTORS","COURSE_REGION","ACTION_HIDE_COURSE","ACTION_SHOW_COURSE","ACTION_ADD_FAVOURITE","ACTION_REMOVE_FAVOURITE","FAVOURITE_ICON","ICON_IS_FAVOURITE","ICON_NOT_FAVOURITE","PAGED_CONTENT_CONTAINER","TEMPLATES","COURSES_CARDS","COURSES_LIST","COURSES_SUMMARY","NOCOURSES","GROUPINGS","GROUPING_ALLINCLUDINGHIDDEN","GROUPING_ALL","GROUPING_INPROGRESS","GROUPING_FUTURE","GROUPING_PAST","GROUPING_FAVOURITES","GROUPING_HIDDEN","NUMCOURSES_PERPAGE","loadedPages","courseOffset","lastPage","lastLimit","namespace","getFilterValues","root","courseRegion","find","courseView","region","display","attr","grouping","sort","displaycategories","customfieldname","customfieldvalue","DEFAULT_PAGED_CONTENT_CONFIG","ignoreControlWhileLoading","controlPlacementBottom","persistentLimitKey","getMyCourses","filters","limit","getEnrolledCoursesByTimeline","offset","classification","getFavouriteIconContainer","courseId","getPagedContentContainer","index","getCourseId","hideFavouriteIcon","iconContainer","isFavouriteIcon","addClass","hide","notFavourteIcon","removeClass","unhide","showFavouriteIcon","getAddFavouriteMenuItem","getRemoveFavouriteMenuItem","addToFavourites","removeAction","addAction","setCourseFavouriteState","then","success","publish","favourited","alert","catch","exception","removeFromFavourites","unfavorited","getHideCourseMenuItem","getShowCourseMenuItem","hideCourse","hideAction","showAction","setCourseHiddenState","hideElement","showCourse","status","updateUserPreferences","preferences","type","value","id","pagingBar","jumpto","parseInt","courseList","reducedCourse","courses","reduce","accumulator","current","push","newElement","slice","forEach","popElement","merge","length","pagedContentContainer","resetLastPageNumber","pagedContentPage","renderCourses","html","js","replaceNodeContents","page","remove","setFavouriteCourses","result","warnings","course","isfavourite","coursesData","currentTemplate","map","showcoursecategory","render","nocoursesimg","setLimit","registerPagedEventHandlers","event","SET_ITEMS_PER_PAGE_LIMIT","subscribe","bind","initializePagedContent","Math","random","pagingLimit","itemsPerPage","active","totalCourseCount","filter","pagingOption","config","extend","eventNamespace","pagedContentPromise","createWithLimit","pagesData","actions","promises","pageData","currentPage","pageNumber","allItemsLoaded","pagePromise","nextPageStart","pageCourses","currentPageLength","remainingCourses","nextoffset","registerEventListeners","events","activate","on","e","data","favourite","target","closest","originalEvent","preventDefault","init","reset"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manage the courses view for the overview block.\n *\n * @copyright  2018 Bas Brands <bas@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(\n[\n    'jquery',\n    'block_myoverview/repository',\n    'core/paged_content_factory',\n    'core/pubsub',\n    'core/custom_interaction_events',\n    'core/notification',\n    'core/templates',\n    'core_course/events',\n    'block_myoverview/selectors',\n    'core/paged_content_events',\n    'core/aria',\n],\nfunction(\n    $,\n    Repository,\n    PagedContentFactory,\n    PubSub,\n    CustomEvents,\n    Notification,\n    Templates,\n    CourseEvents,\n    Selectors,\n    PagedContentEvents,\n    Aria\n) {\n\n    var SELECTORS = {\n        COURSE_REGION: '[data-region=\"course-view-content\"]',\n        ACTION_HIDE_COURSE: '[data-action=\"hide-course\"]',\n        ACTION_SHOW_COURSE: '[data-action=\"show-course\"]',\n        ACTION_ADD_FAVOURITE: '[data-action=\"add-favourite\"]',\n        ACTION_REMOVE_FAVOURITE: '[data-action=\"remove-favourite\"]',\n        FAVOURITE_ICON: '[data-region=\"favourite-icon\"]',\n        ICON_IS_FAVOURITE: '[data-region=\"is-favourite\"]',\n        ICON_NOT_FAVOURITE: '[data-region=\"not-favourite\"]',\n        PAGED_CONTENT_CONTAINER: '[data-region=\"page-container\"]'\n\n    };\n\n    var TEMPLATES = {\n        COURSES_CARDS: 'block_myoverview/view-cards',\n        COURSES_LIST: 'block_myoverview/view-list',\n        COURSES_SUMMARY: 'block_myoverview/view-summary',\n        NOCOURSES: 'core_course/no-courses'\n    };\n\n    var GROUPINGS = {\n        GROUPING_ALLINCLUDINGHIDDEN: 'allincludinghidden',\n        GROUPING_ALL: 'all',\n        GROUPING_INPROGRESS: 'inprogress',\n        GROUPING_FUTURE: 'future',\n        GROUPING_PAST: 'past',\n        GROUPING_FAVOURITES: 'favourites',\n        GROUPING_HIDDEN: 'hidden'\n    };\n\n    var NUMCOURSES_PERPAGE = [12, 24, 48, 96, 0];\n\n    var loadedPages = [];\n\n    var courseOffset = 0;\n\n    var lastPage = 0;\n\n    var lastLimit = 0;\n\n    var namespace = null;\n\n    /**\n     * Get filter values from DOM.\n     *\n     * @param {object} root The root element for the courses view.\n     * @return {filters} Set filters.\n     */\n    var getFilterValues = function(root) {\n        var courseRegion = root.find(Selectors.courseView.region);\n        return {\n            display: courseRegion.attr('data-display'),\n            grouping: courseRegion.attr('data-grouping'),\n            sort: courseRegion.attr('data-sort'),\n            displaycategories: courseRegion.attr('data-displaycategories'),\n            customfieldname: courseRegion.attr('data-customfieldname'),\n            customfieldvalue: courseRegion.attr('data-customfieldvalue'),\n        };\n    };\n\n    // We want the paged content controls below the paged content area.\n    // and the controls should be ignored while data is loading.\n    var DEFAULT_PAGED_CONTENT_CONFIG = {\n        ignoreControlWhileLoading: true,\n        controlPlacementBottom: true,\n        persistentLimitKey: 'block_myoverview_user_paging_preference'\n    };\n\n    /**\n     * Get enrolled courses from backend.\n     *\n     * @param {object} filters The filters for this view.\n     * @param {int} limit The number of courses to show.\n     * @return {promise} Resolved with an array of courses.\n     */\n    var getMyCourses = function(filters, limit) {\n\n        return Repository.getEnrolledCoursesByTimeline({\n            offset: courseOffset,\n            limit: limit,\n            classification: filters.grouping,\n            sort: filters.sort,\n            customfieldname: filters.customfieldname,\n            customfieldvalue: filters.customfieldvalue\n        });\n    };\n\n    /**\n     * Get the container element for the favourite icon.\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     * @return {Object} The favourite icon container\n     */\n    var getFavouriteIconContainer = function(root, courseId) {\n        return root.find(SELECTORS.FAVOURITE_ICON + '[data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Get the paged content container element.\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} index Rendered page index.\n     * @return {Object} The rendered paged container.\n     */\n    var getPagedContentContainer = function(root, index) {\n        return root.find('[data-region=\"paged-content-page\"][data-page=\"' + index + '\"]');\n    };\n\n    /**\n     * Get the course id from a favourite element.\n     *\n     * @param {Object} root The favourite icon container element.\n     * @return {Number} Course id.\n     */\n    var getCourseId = function(root) {\n        return root.attr('data-course-id');\n    };\n\n    /**\n     * Hide the favourite icon.\n     *\n     * @param {Object} root The favourite icon container element.\n     * @param  {Number} courseId Course id number.\n     */\n    var hideFavouriteIcon = function(root, courseId) {\n        var iconContainer = getFavouriteIconContainer(root, courseId);\n\n        var isFavouriteIcon = iconContainer.find(SELECTORS.ICON_IS_FAVOURITE);\n        isFavouriteIcon.addClass('hidden');\n        Aria.hide(isFavouriteIcon);\n\n        var notFavourteIcon = iconContainer.find(SELECTORS.ICON_NOT_FAVOURITE);\n        notFavourteIcon.removeClass('hidden');\n        Aria.unhide(notFavourteIcon);\n    };\n\n    /**\n     * Show the favourite icon.\n     *\n     * @param  {Object} root The course overview container.\n     * @param  {Number} courseId Course id number.\n     */\n    var showFavouriteIcon = function(root, courseId) {\n        var iconContainer = getFavouriteIconContainer(root, courseId);\n\n        var isFavouriteIcon = iconContainer.find(SELECTORS.ICON_IS_FAVOURITE);\n        isFavouriteIcon.removeClass('hidden');\n        Aria.unhide(isFavouriteIcon);\n\n        var notFavourteIcon = iconContainer.find(SELECTORS.ICON_NOT_FAVOURITE);\n        notFavourteIcon.addClass('hidden');\n        Aria.hide(notFavourteIcon);\n    };\n\n    /**\n     * Get the action menu item\n     *\n     * @param {Object} root  root The course overview container\n     * @param {Number} courseId Course id.\n     * @return {Object} The add to favourite menu item.\n     */\n    var getAddFavouriteMenuItem = function(root, courseId) {\n        return root.find('[data-action=\"add-favourite\"][data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Get the action menu item\n     *\n     * @param {Object} root  root The course overview container\n     * @param {Number} courseId Course id.\n     * @return {Object} The remove from favourites menu item.\n     */\n    var getRemoveFavouriteMenuItem = function(root, courseId) {\n        return root.find('[data-action=\"remove-favourite\"][data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Add course to favourites\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     */\n    var addToFavourites = function(root, courseId) {\n        var removeAction = getRemoveFavouriteMenuItem(root, courseId);\n        var addAction = getAddFavouriteMenuItem(root, courseId);\n\n        setCourseFavouriteState(courseId, true).then(function(success) {\n            if (success) {\n                PubSub.publish(CourseEvents.favourited, courseId);\n                removeAction.removeClass('hidden');\n                addAction.addClass('hidden');\n                showFavouriteIcon(root, courseId);\n            } else {\n                Notification.alert('Starring course failed', 'Could not change favourite state');\n            }\n            return;\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Remove course from favourites\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     */\n    var removeFromFavourites = function(root, courseId) {\n        var removeAction = getRemoveFavouriteMenuItem(root, courseId);\n        var addAction = getAddFavouriteMenuItem(root, courseId);\n\n        setCourseFavouriteState(courseId, false).then(function(success) {\n            if (success) {\n                PubSub.publish(CourseEvents.unfavorited, courseId);\n                removeAction.addClass('hidden');\n                addAction.removeClass('hidden');\n                hideFavouriteIcon(root, courseId);\n            } else {\n                Notification.alert('Starring course failed', 'Could not change favourite state');\n            }\n            return;\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Get the action menu item\n     *\n     * @param {Object} root  root The course overview container\n     * @param {Number} courseId Course id.\n     * @return {Object} The hide course menu item.\n     */\n    var getHideCourseMenuItem = function(root, courseId) {\n        return root.find('[data-action=\"hide-course\"][data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Get the action menu item\n     *\n     * @param {Object} root  root The course overview container\n     * @param {Number} courseId Course id.\n     * @return {Object} The show course menu item.\n     */\n    var getShowCourseMenuItem = function(root, courseId) {\n        return root.find('[data-action=\"show-course\"][data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Hide course\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     */\n    var hideCourse = function(root, courseId) {\n        var hideAction = getHideCourseMenuItem(root, courseId);\n        var showAction = getShowCourseMenuItem(root, courseId);\n        var filters = getFilterValues(root);\n\n        setCourseHiddenState(courseId, true);\n\n        // Remove the course from this view as it is now hidden and thus not covered by this view anymore.\n        // Do only if we are not in \"All\" view mode where really all courses are shown.\n        if (filters.grouping != GROUPINGS.GROUPING_ALLINCLUDINGHIDDEN) {\n            hideElement(root, courseId);\n        }\n\n        hideAction.addClass('hidden');\n        showAction.removeClass('hidden');\n    };\n\n    /**\n     * Show course\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     */\n    var showCourse = function(root, courseId) {\n        var hideAction = getHideCourseMenuItem(root, courseId);\n        var showAction = getShowCourseMenuItem(root, courseId);\n        var filters = getFilterValues(root);\n\n        setCourseHiddenState(courseId, null);\n\n        // Remove the course from this view as it is now shown again and thus not covered by this view anymore.\n        // Do only if we are not in \"All\" view mode where really all courses are shown.\n        if (filters.grouping != GROUPINGS.GROUPING_ALLINCLUDINGHIDDEN) {\n            hideElement(root, courseId);\n        }\n\n        hideAction.removeClass('hidden');\n        showAction.addClass('hidden');\n    };\n\n    /**\n     * Set the courses hidden status and push to repository\n     *\n     * @param  {Number} courseId Course id to favourite.\n     * @param  {Bool} status new hidden status.\n     * @return {Promise} Repository promise.\n     */\n    var setCourseHiddenState = function(courseId, status) {\n\n        // If the given status is not hidden, the preference has to be deleted with a null value.\n        if (status === false) {\n            status = null;\n        }\n        return Repository.updateUserPreferences({\n            preferences: [\n                {\n                    type: 'block_myoverview_hidden_course_' + courseId,\n                    value: status\n                }\n            ]\n        });\n    };\n\n    /**\n     * Reset the loadedPages dataset to take into account the hidden element\n     *\n     * @param {Object} root The course overview container\n     * @param {Number} id The course id number\n     */\n    var hideElement = function(root, id) {\n        var pagingBar = root.find('[data-region=\"paging-bar\"]');\n        var jumpto = parseInt(pagingBar.attr('data-active-page-number'));\n\n        // Get a reduced dataset for the current page.\n        var courseList = loadedPages[jumpto];\n        var reducedCourse = courseList.courses.reduce(function(accumulator, current) {\n            if (id != current.id) {\n                accumulator.push(current);\n            }\n            return accumulator;\n        }, []);\n\n        // Get the next page's data if loaded and pop the first element from it\n        if (loadedPages[jumpto + 1] != undefined) {\n            var newElement = loadedPages[jumpto + 1].courses.slice(0, 1);\n\n            // Adjust the dataset for the reset of the pages that are loaded\n            loadedPages.forEach(function(courseList, index) {\n                if (index > jumpto) {\n                    var popElement = [];\n                    if (loadedPages[index + 1] != undefined) {\n                        popElement = loadedPages[index + 1].courses.slice(0, 1);\n                    }\n\n                    loadedPages[index].courses = $.merge(loadedPages[index].courses.slice(1), popElement);\n                }\n            });\n\n\n            reducedCourse = $.merge(reducedCourse, newElement);\n        }\n\n        // Check if the next page is the last page and if it still has data associated to it\n        if (lastPage == jumpto + 1 && loadedPages[jumpto + 1].courses.length == 0) {\n            var pagedContentContainer = root.find('[data-region=\"paged-content-container\"]');\n            PagedContentFactory.resetLastPageNumber($(pagedContentContainer).attr('id'), jumpto);\n        }\n\n        loadedPages[jumpto].courses = reducedCourse;\n\n        // Reduce the course offset\n        courseOffset--;\n\n        // Render the paged content for the current\n        var pagedContentPage = getPagedContentContainer(root, jumpto);\n        renderCourses(root, loadedPages[jumpto]).then(function(html, js) {\n            return Templates.replaceNodeContents(pagedContentPage, html, js);\n        }).catch(Notification.exception);\n\n        // Delete subsequent pages in order to trigger the callback\n        loadedPages.forEach(function(courseList, index) {\n            if (index > jumpto) {\n                var page = getPagedContentContainer(root, index);\n                page.remove();\n            }\n        });\n    };\n\n    /**\n     * Set the courses favourite status and push to repository\n     *\n     * @param  {Number} courseId Course id to favourite.\n     * @param  {Bool} status new favourite status.\n     * @return {Promise} Repository promise.\n     */\n    var setCourseFavouriteState = function(courseId, status) {\n\n        return Repository.setFavouriteCourses({\n            courses: [\n                    {\n                        'id': courseId,\n                        'favourite': status\n                    }\n                ]\n        }).then(function(result) {\n            if (result.warnings.length == 0) {\n                loadedPages.forEach(function(courseList) {\n                    courseList.courses.forEach(function(course, index) {\n                        if (course.id == courseId) {\n                            courseList.courses[index].isfavourite = status;\n                        }\n                    });\n                });\n                return true;\n            } else {\n                return false;\n            }\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Render the dashboard courses.\n     *\n     * @param {object} root The root element for the courses view.\n     * @param {array} coursesData containing array of returned courses.\n     * @return {promise} jQuery promise resolved after rendering is complete.\n     */\n    var renderCourses = function(root, coursesData) {\n\n        var filters = getFilterValues(root);\n\n        var currentTemplate = '';\n        if (filters.display == 'card') {\n            currentTemplate = TEMPLATES.COURSES_CARDS;\n        } else if (filters.display == 'list') {\n            currentTemplate = TEMPLATES.COURSES_LIST;\n        } else {\n            currentTemplate = TEMPLATES.COURSES_SUMMARY;\n        }\n\n        // Whether the course category should be displayed in the course item.\n        coursesData.courses = coursesData.courses.map(function(course) {\n            course.showcoursecategory = filters.displaycategories == 'on' ? true : false;\n            return course;\n        });\n\n        if (coursesData.courses.length) {\n            return Templates.render(currentTemplate, {\n                courses: coursesData.courses,\n            });\n        } else {\n            var nocoursesimg = root.find(Selectors.courseView.region).attr('data-nocoursesimg');\n            return Templates.render(TEMPLATES.NOCOURSES, {\n                nocoursesimg: nocoursesimg\n            });\n        }\n    };\n\n    /**\n     * Return the callback to be passed to the subscribe event\n     *\n     * @param {Number} limit The paged limit that is passed through the event\n     */\n    var setLimit = function(limit) {\n        this.find(Selectors.courseView.region).attr('data-paging', limit);\n    };\n\n    /**\n     * Intialise the paged list and cards views on page load.\n     * Returns an array of paged contents that we would like to handle here\n     *\n     * @param {object} root The root element for the courses view\n     * @param {string} namespace The namespace for all the events attached\n     */\n    var registerPagedEventHandlers = function(root, namespace) {\n        var event = namespace + PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT;\n        PubSub.subscribe(event, setLimit.bind(root));\n    };\n\n    /**\n     * Intialise the courses list and cards views on page load.\n     *\n     * @param {object} root The root element for the courses view.\n     */\n    var initializePagedContent = function(root) {\n        namespace = \"block_myoverview_\" + root.attr('id') + \"_\" + Math.random();\n\n        var pagingLimit = parseInt(root.find(Selectors.courseView.region).attr('data-paging'), 10);\n        var itemsPerPage = NUMCOURSES_PERPAGE.map(function(value) {\n            var active = false;\n            if (value == pagingLimit) {\n                active = true;\n            }\n\n            return {\n                value: value,\n                active: active\n            };\n        });\n\n        // Filter out all pagination options which are too large for the amount of courses user is enrolled in.\n        var totalCourseCount = parseInt(root.find(Selectors.courseView.region).attr('data-totalcoursecount'), 10);\n        itemsPerPage = itemsPerPage.filter(function(pagingOption) {\n            return pagingOption.value < totalCourseCount || pagingOption.value === 0;\n        });\n\n        var filters = getFilterValues(root);\n        var config = $.extend({}, DEFAULT_PAGED_CONTENT_CONFIG);\n        config.eventNamespace = namespace;\n\n        var pagedContentPromise = PagedContentFactory.createWithLimit(\n            itemsPerPage,\n            function(pagesData, actions) {\n                var promises = [];\n\n                pagesData.forEach(function(pageData) {\n                    var currentPage = pageData.pageNumber;\n                    var limit = (pageData.limit > 0) ? pageData.limit : 0;\n\n                    // Reset local variables if limits have changed\n                    if (lastLimit != limit) {\n                        loadedPages = [];\n                        courseOffset = 0;\n                        lastPage = 0;\n                    }\n\n                    if (lastPage == currentPage) {\n                        // If we are on the last page and have it's data then load it from cache\n                        actions.allItemsLoaded(lastPage);\n                        promises.push(renderCourses(root, loadedPages[currentPage]));\n                        return;\n                    }\n\n                    lastLimit = limit;\n\n                    // Get 2 pages worth of data as we will need it for the hidden functionality.\n                    if (loadedPages[currentPage + 1] == undefined) {\n                        if (loadedPages[currentPage] == undefined) {\n                            limit *= 2;\n                        }\n                    }\n\n                    var pagePromise = getMyCourses(\n                        filters,\n                        limit\n                    ).then(function(coursesData) {\n                        var courses = coursesData.courses;\n                        var nextPageStart = 0;\n                        var pageCourses = [];\n\n                        // If current page's data is loaded make sure we max it to page limit\n                        if (loadedPages[currentPage] != undefined) {\n                            pageCourses = loadedPages[currentPage].courses;\n                            var currentPageLength = pageCourses.length;\n                            if (currentPageLength < pageData.limit) {\n                                nextPageStart = pageData.limit - currentPageLength;\n                                pageCourses = $.merge(loadedPages[currentPage].courses, courses.slice(0, nextPageStart));\n                            }\n                        } else {\n                            // When the page limit is zero, there is only one page of courses, no start for next page.\n                            nextPageStart = pageData.limit || false;\n                            pageCourses = (pageData.limit > 0) ? courses.slice(0, pageData.limit) : courses;\n                        }\n\n                        // Finished setting up the current page\n                        loadedPages[currentPage] = {\n                            courses: pageCourses\n                        };\n\n                        // Set up the next page (if there is more than one page).\n                        var remainingCourses = nextPageStart !== false ? courses.slice(nextPageStart, courses.length) : [];\n                        if (remainingCourses.length) {\n                            loadedPages[currentPage + 1] = {\n                                courses: remainingCourses\n                            };\n                        }\n\n                        // Set the last page to either the current or next page\n                        if (loadedPages[currentPage].courses.length < pageData.limit || !remainingCourses.length) {\n                            lastPage = currentPage;\n                            actions.allItemsLoaded(currentPage);\n                        } else if (loadedPages[currentPage + 1] != undefined\n                            && loadedPages[currentPage + 1].courses.length < pageData.limit) {\n                            lastPage = currentPage + 1;\n                        }\n\n                        courseOffset = coursesData.nextoffset;\n                        return renderCourses(root, loadedPages[currentPage]);\n                    })\n                    .catch(Notification.exception);\n\n                    promises.push(pagePromise);\n                });\n\n                return promises;\n            },\n            config\n        );\n\n        pagedContentPromise.then(function(html, js) {\n            registerPagedEventHandlers(root, namespace);\n            return Templates.replaceNodeContents(root.find(Selectors.courseView.region), html, js);\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Listen to, and handle events for  the myoverview block.\n     *\n     * @param {Object} root The myoverview block container element.\n     */\n    var registerEventListeners = function(root) {\n        CustomEvents.define(root, [\n            CustomEvents.events.activate\n        ]);\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_ADD_FAVOURITE, function(e, data) {\n            var favourite = $(e.target).closest(SELECTORS.ACTION_ADD_FAVOURITE);\n            var courseId = getCourseId(favourite);\n            addToFavourites(root, courseId);\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_REMOVE_FAVOURITE, function(e, data) {\n            var favourite = $(e.target).closest(SELECTORS.ACTION_REMOVE_FAVOURITE);\n            var courseId = getCourseId(favourite);\n            removeFromFavourites(root, courseId);\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.FAVOURITE_ICON, function(e, data) {\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_HIDE_COURSE, function(e, data) {\n            var target = $(e.target).closest(SELECTORS.ACTION_HIDE_COURSE);\n            var courseId = getCourseId(target);\n            hideCourse(root, courseId);\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_SHOW_COURSE, function(e, data) {\n            var target = $(e.target).closest(SELECTORS.ACTION_SHOW_COURSE);\n            var courseId = getCourseId(target);\n            showCourse(root, courseId);\n            data.originalEvent.preventDefault();\n        });\n    };\n\n    /**\n     * Intialise the courses list and cards views on page load.\n     *\n     * @param {object} root The root element for the courses view.\n     */\n    var init = function(root) {\n        root = $(root);\n        loadedPages = [];\n        lastPage = 0;\n        courseOffset = 0;\n\n        initializePagedContent(root);\n\n        if (!root.attr('data-init')) {\n            registerEventListeners(root);\n            root.attr('data-init', true);\n        }\n    };\n\n    /**\n     * Reset the courses views to their original\n     *\n     * state on first page load.courseOffset\n     *\n     * This is called when configuration has changed for the event lists\n     * to cause them to reload their data.\n     *\n     * @param {Object} root The root element for the timeline view.\n     */\n    var reset = function(root) {\n        if (loadedPages.length > 0) {\n            loadedPages.forEach(function(courseList, index) {\n                var pagedContentPage = getPagedContentContainer(root, index);\n                renderCourses(root, courseList).then(function(html, js) {\n                    return Templates.replaceNodeContents(pagedContentPage, html, js);\n                }).catch(Notification.exception);\n            });\n        } else {\n            init(root);\n        }\n    };\n\n    return {\n        init: init,\n        reset: reset\n    };\n});\n"],"file":"view.min.js"}