{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the Recently accessed items block.\n *\n * @module     block_recentlyaccesseditems/main\n * @copyright  2018 Victor Deniz <victor@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport {getRecentItems} from './repository';\nimport Notification from 'core/notification';\nimport Templates from 'core/templates';\n\n\nconst NUM_ITEMS = 9;\n// Maximum number of elements to display in the block initially.\nconst NUM_ITEMS_INIT = 3;\n\nconst Selectors = {\n    CARDDECK_CONTAINER: '[data-region=\"recentlyaccesseditems-view\"]',\n    CARDDECK: '[data-region=\"recentlyaccesseditems-view-content\"]',\n    SHOWMORE_LINK: '[data-region=\"recentlyaccesseditems-view\"] [data-action=\"more-items\"]',\n};\n\n/**\n * Register event listeners.\n */\nconst registerEventListeners = () => {\n    const showmoreLink = document.querySelector(Selectors.SHOWMORE_LINK);\n\n    // Hide \"Show more\" link and show additional items.\n    showmoreLink.addEventListener('click', () => {\n        showmoreLink.classList.add('d-none');\n\n        const hiddenItems = document.querySelector('[data-region=\"items-list\"]').children;\n        hiddenItems.forEach(function(hiddenItem) {\n            hiddenItem.style = \"display: block\";\n        });\n    });\n};\n\n/**\n * Render the block content.\n *\n * @method renderItems\n * @param {object} root The root element for the items view.\n * @param {array} items containing array of returned items.\n * @return {promise} Resolved with HTML and JS strings\n */\nconst renderItems = function(root, items) {\n    if (items.length > 0) {\n        return Templates.renderForPromise('block_recentlyaccesseditems/view-cards', {\n            items,\n            hasmoreitems: (items.length > NUM_ITEMS_INIT),\n        });\n    } else {\n        return Templates.renderForPromise('block_recentlyaccesseditems/no-items', {\n            noitemsimgurl: root.attr('data-noitemsimgurl'),\n        });\n    }\n};\n\n/**\n * Get and show the recent items into the block.\n *\n * @param {object} root The root element for the items block.\n */\nexport const init = async (root) =>{\n    root = $(root);\n\n    const itemsContainer = root.find(Selectors.CARDDECK_CONTAINER);\n    const itemsContent = root.find(Selectors.CARDDECK);\n\n    try {\n        const items = await getRecentItems(NUM_ITEMS);\n        const {html, js} = await renderItems(itemsContainer, items);\n\n        Templates.replaceNodeContents(itemsContent, html, js);\n        if (items.length > 3) {\n            registerEventListeners();\n        }\n    } catch (error) {\n        Notification.exception(error);\n    }\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","_jquery","_notification","_templates","Selectors","_exports","init","async","itemsContainer","root","$","find","itemsContent","items","getRecentItems","html","js","length","Templates","renderForPromise","hasmoreitems","noitemsimgurl","attr","renderItems","replaceNodeContents","registerEventListeners","showmoreLink","document","querySelector","addEventListener","classList","add","children","forEach","hiddenItem","style","error","Notification","exception"],"mappings":"oLA2BuC,SAAAA,uBAAAC,KAAAA,OAAAA,KAAAA,IAAAC,WAAAD,IAAAE,CAAAA,QAAAF,IAAA;;;;;;;kFAHvCG,QAAAJ,uBAAAI,SAEAC,cAAAL,uBAAAK,eACAC,WAAAN,uBAAAM,YAGA,MAIMC,6BACkB,6CADlBA,mBAEQ,qDAFRA,wBAGa,wEA+DjBC,SAAAC,KAjBkBC,aAGhB,MAAMC,gBAFNC,MAAO,EAAAC,QAACV,SAACS,OAEmBE,KAAKP,8BAC3BQ,aAAeH,KAAKE,KAAKP,oBAE/B,IACI,MAAMS,YAAc,EAAAC,YAAcA,gBA5DxB,IA6DJC,KAACA,KAAIC,GAAEA,UA1BD,SAASP,KAAMI,OAC/B,OAAIA,MAAMI,OAAS,EACRC,WAASlB,QAACmB,iBAAiB,yCAA0C,CACxEN,YACAO,aAAeP,MAAMI,OArCV,IAwCRC,WAASlB,QAACmB,iBAAiB,uCAAwC,CACtEE,cAAeZ,KAAKa,KAAK,wBAkBJC,CAAYf,eAAgBK,OAErDK,WAASlB,QAACwB,oBAAoBZ,aAAcG,KAAMC,IAC9CH,MAAMI,OAAS,GAnDIQ,MAC3B,MAAMC,aAAeC,SAASC,cAAcxB,yBAG5CsB,aAAaG,iBAAiB,SAAS,KACnCH,aAAaI,UAAUC,IAAI,UAEPJ,SAASC,cAAc,8BAA8BI,SAC7DC,SAAQ,SAASC,YACzBA,WAAWC,MAAQ,gBACvB,GAAE,GACJ,EAyCMV,EAEP,CAAC,MAAOW,OACLC,cAAAA,QAAaC,UAAUF,MAC3B,EACF"}