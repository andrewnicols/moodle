function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("block_accessreview/module",["exports","core/str","core/ajax","core/templates"],function(a,b,c,d){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;d=f(d);function e(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;e=function(){return a};return a}function f(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=e();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a){if(Object.prototype.hasOwnProperty.call(a,f)){var g=d?Object.getOwnPropertyDescriptor(a,f):null;if(g&&(g.get||g.set)){Object.defineProperty(c,f,g)}else{c[f]=a[f]}}}c.default=a;if(b){b.set(a,c)}return c}function g(a,b){return m(a)||l(a,b)||j(a,b)||h()}function h(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function j(a,b){if(!a)return;if("string"==typeof a)return k(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return k(a,b)}function k(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function l(a,b){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(a)))return;var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0;f=a}finally{try{if(!d&&null!=g["return"])g["return"]()}finally{if(e)throw f}}return c}function m(a){if(Array.isArray(a))return a}function n(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function o(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){n(h,d,e,f,g,"next",a)}function g(a){n(h,d,e,f,g,"throw",a)}f(void 0)})}}var p=!0,q="",r="",s={},t=function(){(0,b.get_strings)([{key:"passed",component:"tool_brickfield"},{key:"failed",component:"tool_brickfield"},{key:"errors",component:"block_accessreview"},{key:"percenterrors",component:"block_accessreview"},{key:"success"}]).then(function(a){s.passed=a[0];s.failed=a[1];s.errors=a[2];s.percenterrors=a[3];s.success=a[4];return a}).catch()},u=function(a,b,c,d,e,f){var g=parseInt((b-e)/f*2),h="block_accessreview_success";if(1>g){h="block_accessreview_warning"}if(1<=g){h="block_accessreview_danger"}if(0==b){h="block_accessreview_success"}if(a){if("showicons"!=d){if(1<=a.className.search("label")){h+="_label"}a.className+=" alert block_accessreview "+h}if("showbackground"!=d){var i="block_accessreview_view";if(-1<a.className.search("label")){i+=" alert "+h}var j="<div class=\""+i+"\">";if(0==b){j+=r;j+=s.passed}else{j+=q;j+=s.failed;j+="&nbsp;&nbsp;";j+=b;j+="&nbsp;"+s.errors;j+="&nbsp;&nbsp;";j+=Math.round(100*(b/c));j+=s.percenterrors}j+="</div>";a.insertAdjacentHTML("beforeend",j)}}},v=function(){var a=o(regeneratorRuntime.mark(function a(b,c){var d,e,f,h,i,j,k;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return Promise.all(A(b));case 2:d=a.sent;e=g(d,2);f=e[0];h=e[1];i=y(f,h),j=i.minViews,k=i.viewDelta;f.forEach(function(a){var b=document.querySelector("#section-".concat(a.section," .summary"));if(!b){return}u(b,a.numerrors,a.numchecks,c,j,k)});h.forEach(function(a){var b=document.getElementById("module-".concat(a.cmid));if(!b){return}u(b,a.numerrors,a.numchecks,c,j,k)});case 9:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}(),w=function(){document.querySelectorAll(".block_accessreview_view").forEach(function(a){return a.remove()});var a=["alert","block_accessreview","block_accessreview_success","block_accessreview_warning","block_accessreview_danger","block_accessreview_view","block_accessreview_success_label","block_accessreview_warning_label","block_accessreview_danger_label","block_accessreview_view_label"];document.querySelectorAll(".block_accessreview.alert").forEach(function(b){var c;return(c=b.classList).remove.apply(c,a)})},x=function(a,b){if(p){w()}else{v(a,b)}p=!p;(0,c.call)([{methodname:"block_accessreview_set_toggle_preference",args:{toggle:p}}])},y=function(a,b){var c={totalErrors:0,totalUsers:0,minViews:0,maxViews:0,viewDelta:0};[].concat(a,b).forEach(function(a){c.totalErrors+=a.numerrors;if(a.numerrors<c.minViews){c.minViews=a.numerrors}if(a.numerrors>c.maxViews){c.maxViews=a.numerrors}c.totalUsers+=a.numchecks});c.viewDelta=c.maxViews-c.minViews+1;return c},z=function(a,b){document.addEventListener("click",function(c){if(c.target.closest("#toggle-accessmap")){c.preventDefault();x(a,b)}})},A=function(a){return(0,c.call)([{methodname:"block_accessreview_get_section_data",args:{courseid:a}},{methodname:"block_accessreview_get_module_data",args:{courseid:a}}])},B=function(){var a=o(regeneratorRuntime.mark(function a(b,c,e){var f;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:p=1==b;f=t();a.next=4;return f;case 4:a.next=6;return d.renderPix("t/check","core",s.success);case 6:r=a.sent;a.next=9;return d.renderPix("t/block","core",s.errors);case 9:q=a.sent;if(p){v(e,c)}z(e,c);case 12:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}();a.init=B});
//# sourceMappingURL=module.min.js.map
