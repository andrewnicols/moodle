{"version":3,"sources":["../src/ajax_response_renderer.js"],"names":["define","$","Templates","Notification","Url","Aria","NODETYPE","ACTIVITY","RESOURCE","buildDOM","rootElement","nodes","ul","attr","hide","each","index","node","li","p","id","key","icon","isBranch","expandable","haschildren","addClass","requiresajaxloading","type","eleToAddIcon","link","title","append","name","hidden","span","alt","imageUrl","pix","component","classes","className","prepend","renderPix","then","html","catch","exception","children","length","removeClass","render","element","item","first","group","find","unhide","hasClass"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Parse the response from the navblock ajax page and render the correct DOM\n * structure for the tree from it.\n *\n * @module     block_navigation/ajax_response_renderer\n * @copyright  2015 John Okely <john@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/templates',\n    'core/notification',\n    'core/url',\n    'core/aria',\n], function(\n    $,\n    Templates,\n    Notification,\n    Url,\n    Aria\n) {\n\n    // Mappings for the different types of nodes coming from the navigation.\n    // Copied from lib/navigationlib.php navigation_node constants.\n    var NODETYPE = {\n        // @type int Activity (course module) = 40.\n        ACTIVITY: 40,\n        // @type int Resource (course module = 50.\n        RESOURCE: 50,\n    };\n\n    /**\n     * Build DOM.\n     *\n     * @method buildDOM\n     * @param {Object} rootElement the root element of DOM.\n     * @param {object} nodes jquery object representing the nodes to be build.\n     */\n    function buildDOM(rootElement, nodes) {\n        var ul = $('<ul></ul>');\n        ul.attr('role', 'group');\n        Aria.hide(ul);\n\n        $.each(nodes, function(index, node) {\n            if (typeof node !== 'object') {\n                return;\n            }\n\n            var li = $('<li></li>');\n            var p = $('<p></p>');\n            var id = node.id || node.key + '_tree_item';\n            var icon = null;\n            var isBranch = (node.expandable || node.haschildren) ? true : false;\n\n            li.attr('role', 'treeitem');\n            p.addClass('tree_item');\n            p.attr('id', id);\n            // Negative tab index to allow it to receive focus.\n            p.attr('tabindex', '-1');\n\n            if (node.requiresajaxloading) {\n                li.attr('data-requires-ajax', true);\n                li.attr('data-node-id', node.id);\n                li.attr('data-node-key', node.key);\n                li.attr('data-node-type', node.type);\n            }\n\n            if (isBranch) {\n                li.addClass('collapsed contains_branch');\n                li.attr('aria-expanded', false);\n                p.addClass('branch');\n            }\n\n            var eleToAddIcon = null;\n            if (node.link) {\n                var link = $('<a title=\"' + node.title + '\" href=\"' + node.link + '\"></a>');\n\n                eleToAddIcon = link;\n                link.append('<span class=\"item-content-wrap\">' + node.name + '</span>');\n\n                if (node.hidden) {\n                    link.addClass('dimmed');\n                }\n\n                p.append(link);\n            } else {\n                var span = $('<span></span>');\n\n                eleToAddIcon = span;\n                span.append('<span class=\"item-content-wrap\">' + node.name + '</span>');\n\n                if (node.hidden) {\n                    span.addClass('dimmed');\n                }\n\n                p.append(span);\n            }\n\n            if (node.icon && (!isBranch || node.type === NODETYPE.ACTIVITY || node.type === NODETYPE.RESOURCE)) {\n                li.addClass('item_with_icon');\n                p.addClass('hasicon');\n\n                if (node.type === NODETYPE.ACTIVITY || node.type === NODETYPE.RESOURCE) {\n                    icon = $('<img/>');\n                    icon.attr('alt', node.icon.alt);\n                    icon.attr('title', node.icon.title);\n                    icon.attr('src', Url.imageUrl(node.icon.pix, node.icon.component));\n                    $.each(node.icon.classes, function(index, className) {\n                        icon.addClass(className);\n                    });\n                    eleToAddIcon.prepend(icon);\n                } else {\n                    if (node.icon.component == 'moodle') {\n                        node.icon.component = 'core';\n                    }\n                    Templates.renderPix(node.icon.pix, node.icon.component, node.icon.title).then(function(html) {\n                        // Prepend.\n                        eleToAddIcon.prepend(html);\n                        return;\n                    }).catch(Notification.exception);\n                }\n            }\n\n            li.append(p);\n            ul.append(li);\n\n            if (node.children && node.children.length) {\n                buildDOM(li, node.children);\n            } else if (isBranch && !node.requiresajaxloading) {\n                li.removeClass('contains_branch');\n                p.addClass('emptybranch');\n            }\n        });\n\n        rootElement.append(ul);\n        var id = rootElement.attr('id') + '_group';\n        ul.attr('id', id);\n        rootElement.attr('aria-owns', id);\n        rootElement.attr('role', 'treeitem');\n    }\n\n    return {\n        render: function(element, nodes) {\n            // The first element of the response is the existing node so we start with processing the children.\n            if (nodes.children && nodes.children.length) {\n                buildDOM(element, nodes.children);\n\n                var item = element.children(\"[role='treeitem']\").first();\n                var group = element.find('#' + item.attr('aria-owns'));\n\n                item.attr('aria-expanded', true);\n                Aria.unhide(group);\n            } else {\n                if (element.hasClass('contains_branch')) {\n                    element.removeClass('contains_branch');\n                    element.addClass('emptybranch');\n                }\n            }\n        }\n    };\n});\n"],"file":"ajax_response_renderer.min.js"}