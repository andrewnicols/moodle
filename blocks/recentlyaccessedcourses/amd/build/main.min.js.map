{"version":3,"sources":["../src/main.js"],"names":["define","$","CustomEvents","Notification","PubSub","PagedContentPagingBar","Templates","CourseEvents","CoursesRepository","SELECTORS","BLOCK_CONTAINER","CARD_CONTAINER","COURSE_IS_FAVOURITE","CONTENT","EMPTY_MESSAGE","LOADING_PLACEHOLDER","PAGING_BAR","PAGING_BAR_NEXT","PAGING_BAR_PREVIOUS","contentLoaded","allCourses","visibleCoursesId","cardWidth","viewIndex","availableVisibleCards","showEmptyMessage","root","find","removeClass","addClass","showContent","showPagingBar","pagingBar","css","attr","hidePagingBar","favouriteCourse","courseId","forEach","course","unfavouriteCourse","renderAllCourses","courses","showcoursecategory","data","promises","map","render","when","apply","then","renderedCourses","promise","html","push","catch","exception","loadContent","userid","getLastAccessedCourses","recalculateVisibleCourses","container","availableWidth","parseFloat","numberOfCourses","length","start","outerWidth","Math","floor","overflow","coursesToShow","slice","newVisibleCoursesId","reduce","carry","rootSelector","disablePreviousControlButtons","enablePreviousControlButtons","disableNextControlButtons","enableNextControlButtons","registerEventListeners","resizeTimeout","drawerToggling","subscribe","favourited","unfavorited","recalculationCount","doRecalculation","setTimeout","window","on","events","activate","e","button","target","closest","hasClass","originalEvent","preventDefault","init"],"mappings":"AAwBAA,OAAM,sCACF,CACI,QADJ,CAEI,gCAFJ,CAGI,mBAHJ,CAII,aAJJ,CAKI,+BALJ,CAMI,gBANJ,CAOI,oBAPJ,CAQI,wBARJ,CADE,CAWF,SACIC,CADJ,CAEIC,YAFJ,CAGIC,YAHJ,CAIIC,MAJJ,CAKIC,qBALJ,CAMIC,SANJ,CAOIC,YAPJ,CAQIC,iBARJ,CASE,IAIMC,CAAAA,SAAS,CAAG,CACZC,eAAe,CAAE,2CADL,CAEZC,cAAc,CAAE,6BAFJ,CAGZC,mBAAmB,CAAE,gCAHT,CAIZC,OAAO,CAAE,gCAJG,CAKZC,aAAa,CAAE,iCALH,CAMZC,mBAAmB,CAAE,uCANT,CAOZC,UAAU,CAAE,8BAPA,CAQZC,eAAe,CAAE,yBARL,CASZC,mBAAmB,CAAE,6BATT,CAJlB,CAgBMC,aAAa,GAhBnB,CAiBMC,UAAU,CAAG,EAjBnB,CAkBMC,gBAAgB,CAAG,IAlBzB,CAmBMC,SAAS,CAAG,IAnBlB,CAoBMC,SAAS,CAAG,CApBlB,CAqBMC,qBAAqB,CAAG,CArB9B,CA4BMC,gBAAgB,CAAG,SAASC,IAAT,CAAe,CAClCA,IAAI,CAACC,IAAL,CAAUlB,SAAS,CAACK,aAApB,EAAmCc,WAAnC,CAA+C,QAA/C,EACAF,IAAI,CAACC,IAAL,CAAUlB,SAAS,CAACM,mBAApB,EAAyCc,QAAzC,CAAkD,QAAlD,EACAH,IAAI,CAACC,IAAL,CAAUlB,SAAS,CAACI,OAApB,EAA6BgB,QAA7B,CAAsC,QAAtC,CACH,CAhCH,CAuCMC,WAAW,CAAG,SAASJ,IAAT,CAAe,CAC7BA,IAAI,CAACC,IAAL,CAAUlB,SAAS,CAACI,OAApB,EAA6Be,WAA7B,CAAyC,QAAzC,EACAF,IAAI,CAACC,IAAL,CAAUlB,SAAS,CAACK,aAApB,EAAmCe,QAAnC,CAA4C,QAA5C,EACAH,IAAI,CAACC,IAAL,CAAUlB,SAAS,CAACM,mBAApB,EAAyCc,QAAzC,CAAkD,QAAlD,CACH,CA3CH,CAkDME,aAAa,CAAG,SAASL,IAAT,CAAe,CAC/B,GAAIM,CAAAA,SAAS,CAAGN,IAAI,CAACC,IAAL,CAAUlB,SAAS,CAACO,UAApB,CAAhB,CACAgB,SAAS,CAACC,GAAV,CAAc,SAAd,CAAyB,CAAzB,EACAD,SAAS,CAACC,GAAV,CAAc,YAAd,CAA4B,SAA5B,EACAD,SAAS,CAACE,IAAV,CAAe,aAAf,CAA8B,OAA9B,CACH,CAvDH,CA8DMC,aAAa,CAAG,SAAST,IAAT,CAAe,CAC/B,GAAIM,CAAAA,SAAS,CAAGN,IAAI,CAACC,IAAL,CAAUlB,SAAS,CAACO,UAApB,CAAhB,CACAgB,SAAS,CAACC,GAAV,CAAc,SAAd,CAAyB,CAAzB,EACAD,SAAS,CAACC,GAAV,CAAc,YAAd,CAA4B,QAA5B,EACAD,SAAS,CAACE,IAAV,CAAe,aAAf,CAA8B,MAA9B,CACH,CAnEH,CA2EME,eAAe,CAAG,SAASV,IAAT,CAAeW,QAAf,CAAyB,CAC3CjB,UAAU,CAACkB,OAAX,CAAmB,SAASC,MAAT,CAAiB,CAChC,GAAIA,MAAM,CAACL,IAAP,CAAY,gBAAZ,GAAiCG,QAArC,CAA+C,CAC3CE,MAAM,CAACZ,IAAP,CAAYlB,SAAS,CAACG,mBAAtB,EAA2CgB,WAA3C,CAAuD,QAAvD,CACH,CACJ,CAJD,CAKH,CAjFH,CAyFMY,iBAAiB,CAAG,SAASd,IAAT,CAAeW,QAAf,CAAyB,CAC7CjB,UAAU,CAACkB,OAAX,CAAmB,SAASC,MAAT,CAAiB,CAChC,GAAIA,MAAM,CAACL,IAAP,CAAY,gBAAZ,GAAiCG,QAArC,CAA+C,CAC3CE,MAAM,CAACZ,IAAP,CAAYlB,SAAS,CAACG,mBAAtB,EAA2CiB,QAA3C,CAAoD,QAApD,CACH,CACJ,CAJD,CAKH,CA/FH,CAuGMY,gBAAgB,CAAG,SAASC,OAAT,CAAkB,IACjCC,CAAAA,kBAAkB,CAAG1C,CAAC,CAACQ,SAAS,CAACC,eAAX,CAAD,CAA6BkC,IAA7B,CAAkC,uBAAlC,CADY,CAEjCC,QAAQ,CAAGH,OAAO,CAACI,GAAR,CAAY,SAASP,MAAT,CAAiB,CACxCA,MAAM,CAACI,kBAAP,CAA4BA,kBAA5B,CACA,MAAOrC,CAAAA,SAAS,CAACyC,MAAV,CAAiB,2CAAjB,CAA8DR,MAA9D,CACV,CAHc,CAFsB,CAOrC,MAAOtC,CAAAA,CAAC,CAAC+C,IAAF,CAAOC,KAAP,CAAa,IAAb,CAAmBJ,QAAnB,EAA6BK,IAA7B,CAAkC,UAAW,CAChD,GAAIC,CAAAA,eAAe,CAAG,EAAtB,CAEAN,QAAQ,CAACP,OAAT,CAAiB,SAASc,OAAT,CAAkB,CAC/BA,OAAO,CAACF,IAAR,CAAa,SAASG,IAAT,CAAe,CACxBF,eAAe,CAACG,IAAhB,CAAqBrD,CAAC,CAACoD,IAAD,CAAtB,CAEH,CAHD,EAICE,KAJD,CAIOpD,YAAY,CAACqD,SAJpB,CAKH,CAND,EAQA,MAAOL,CAAAA,eACV,CAZM,CAaV,CA3HH,CAmIMM,WAAW,CAAG,SAASC,MAAT,CAAiB,CAC/B,MAAOlD,CAAAA,iBAAiB,CAACmD,sBAAlB,CAAyCD,MAAzC,KACFR,IADE,CACG,SAASR,OAAT,CAAkB,CACpB,MAAOD,CAAAA,gBAAgB,CAACC,OAAD,CAC1B,CAHE,CAIV,CAxIH,CA+IMkB,yBAAyB,CAAG,SAASlC,IAAT,CAAe,IACvCmC,CAAAA,SAAS,CAAGnC,IAAI,CAACC,IAAL,CAAUlB,SAAS,CAACI,OAApB,EAA6Bc,IAA7B,CAAkClB,SAAS,CAACE,cAA5C,CAD2B,CAEvCmD,cAAc,CAAGC,UAAU,CAACrC,IAAI,CAACO,GAAL,CAAS,OAAT,CAAD,CAFY,CAGvC+B,eAAe,CAAG5C,UAAU,CAAC6C,MAHU,CAIvCC,KAAK,CAAG,CAJ+B,CAM3C,GAAI,CAAC5C,SAAL,CAAgB,CACZuC,SAAS,CAACR,IAAV,CAAejC,UAAU,CAAC,CAAD,CAAzB,EAGAE,SAAS,CAAGF,UAAU,CAAC,CAAD,CAAV,CAAc+C,UAAd,IACf,CAED3C,qBAAqB,CAAG4C,IAAI,CAACC,KAAL,CAAWP,cAAc,CAAGxC,SAA5B,CAAxB,CAEA,GAAIC,SAAS,CAAGC,qBAAZ,CAAoCwC,eAAxC,CAAyD,CACrDE,KAAK,CAAG3C,SACX,CAFD,IAEO,CACH,GAAI+C,CAAAA,QAAQ,CAAI/C,SAAS,CAAGC,qBAAb,CAAsCwC,eAArD,CACAE,KAAK,CAAG3C,SAAS,CAAG+C,QAApB,CACAJ,KAAK,CAAY,CAAT,EAAAA,KAAK,CAAQA,KAAR,CAAgB,CAChC,CAGD,GAA8B,CAA1B,GAAA1C,qBAAJ,CAAiC,CAC7BA,qBAAqB,CAAG,CAC3B,CA1B0C,GA4BvC+C,CAAAA,aAAa,CAAGnD,UAAU,CAACoD,KAAX,CAAiBN,KAAjB,CAAwBA,KAAK,CAAG1C,qBAAhC,CA5BuB,CA8BvCiD,mBAAmB,CAAGF,aAAa,CAACG,MAAd,CAAqB,SAASC,KAAT,CAAgBpC,MAAhB,CAAwB,CACnE,MAAOoC,CAAAA,KAAK,CAAGpC,MAAM,CAACL,IAAP,CAAY,gBAAZ,CAClB,CAFyB,CAEvB,EAFuB,CA9BiB,CAmC3C,GAAId,UAAU,CAAC6C,MAAX,CAAoBM,aAAa,CAACN,MAAtC,CAA8C,CAC1CJ,SAAS,CAAChC,QAAV,CAAmB,wBAAnB,EACAgC,SAAS,CAACjC,WAAV,CAAsB,uBAAtB,CACH,CAHD,IAGO,CACHiC,SAAS,CAACjC,WAAV,CAAsB,wBAAtB,EACAiC,SAAS,CAAChC,QAAV,CAAmB,uBAAnB,CACH,CAGD,GAAIR,gBAAgB,EAAIoD,mBAAxB,CAA6C,CACzC,GAAIzC,CAAAA,SAAS,CAAGN,IAAI,CAACC,IAAL,CAAUtB,qBAAqB,CAACuE,YAAhC,CAAhB,CACAf,SAAS,CAACR,IAAV,CAAekB,aAAf,EACAlD,gBAAgB,CAAGoD,mBAAnB,CAEA,GAAIjD,qBAAqB,EAAIJ,UAAU,CAAC6C,MAAxC,CAAgD,CAC5C9B,aAAa,CAACT,IAAD,CAChB,CAFD,IAEO,CACHK,aAAa,CAACL,IAAD,CAAb,CAEA,GAAkB,CAAd,GAAAH,SAAJ,CAAqB,CACjBlB,qBAAqB,CAACwE,6BAAtB,CAAoD7C,SAApD,CACH,CAFD,IAEO,CACH3B,qBAAqB,CAACyE,4BAAtB,CAAmD9C,SAAnD,CACH,CAED,GAAIT,SAAS,CAAGC,qBAAZ,EAAqCJ,UAAU,CAAC6C,MAApD,CAA4D,CACxD5D,qBAAqB,CAAC0E,yBAAtB,CAAgD/C,SAAhD,CACH,CAFD,IAEO,CACH3B,qBAAqB,CAAC2E,wBAAtB,CAA+ChD,SAA/C,CACH,CACJ,CACJ,CACJ,CAlNH,CAyNMiD,sBAAsB,CAAG,SAASvD,IAAT,CAAe,IACpCwD,CAAAA,aAAa,CAAG,IADoB,CAEpCC,cAAc,GAFsB,CAIxC/E,MAAM,CAACgF,SAAP,CAAiB7E,YAAY,CAAC8E,UAA9B,CAA0C,SAAShD,QAAT,CAAmB,CACzDD,eAAe,CAACV,IAAD,CAAOW,QAAP,CAClB,CAFD,EAIAjC,MAAM,CAACgF,SAAP,CAAiB7E,YAAY,CAAC+E,WAA9B,CAA2C,SAASjD,QAAT,CAAmB,CAC1DG,iBAAiB,CAACd,IAAD,CAAOW,QAAP,CACpB,CAFD,EAIAjC,MAAM,CAACgF,SAAP,CAAiB,yBAAjB,CAA4C,UAAW,CACnD,GAAI,CAACjE,aAAD,EAAkB,CAACC,UAAU,CAAC6C,MAA9B,EAAwCkB,cAA5C,CAA4D,CAExD,MACH,CAEDA,cAAc,GAAd,CANmD,GAO/CI,CAAAA,kBAAkB,CAAG,CAP0B,CAU/CC,eAAe,CAAG,UAAW,CAC7BC,UAAU,CAAC,UAAW,CAClB7B,yBAAyB,CAAClC,IAAD,CAAzB,CACA6D,kBAAkB,GAElB,GAAyB,CAArB,CAAAA,kBAAkB,EAAQJ,cAA9B,CAA8C,CAG1CK,eAAe,EAClB,CACJ,CATS,CASP,GATO,CAUb,CArBkD,CAwBnDA,eAAe,CAAC9D,IAAD,CAClB,CAzBD,EA2BAtB,MAAM,CAACgF,SAAP,CAAiB,uBAAjB,CAA0C,UAAW,CACjDD,cAAc,GACjB,CAFD,EAIAlF,CAAC,CAACyF,MAAD,CAAD,CAAUC,EAAV,CAAa,QAAb,CAAuB,UAAW,CAC9B,GAAI,CAACxE,aAAD,EAAkB,CAACC,UAAU,CAAC6C,MAAlC,CAA0C,CAEtC,MACH,CAID,GAAI,CAACiB,aAAL,CAAoB,CAChBA,aAAa,CAAGO,UAAU,CAAC,UAAW,CAClCP,aAAa,CAAG,IAAhB,CACAtB,yBAAyB,CAAClC,IAAD,CAE5B,CAJyB,CAIvB,EAJuB,CAK7B,CACJ,CAfD,EAiBAxB,YAAY,CAACF,MAAb,CAAoB0B,IAApB,CAA0B,CAACxB,YAAY,CAAC0F,MAAb,CAAoBC,QAArB,CAA1B,EACAnE,IAAI,CAACiE,EAAL,CAAQzF,YAAY,CAAC0F,MAAb,CAAoBC,QAA5B,CAAsCpF,SAAS,CAACQ,eAAhD,CAAiE,SAAS6E,CAAT,CAAYlD,IAAZ,CAAkB,CAC/E,GAAImD,CAAAA,MAAM,CAAG9F,CAAC,CAAC6F,CAAC,CAACE,MAAH,CAAD,CAAYC,OAAZ,CAAoBxF,SAAS,CAACQ,eAA9B,CAAb,CACA,GAAI,CAAC8E,MAAM,CAACG,QAAP,CAAgB,UAAhB,CAAL,CAAkC,CAC9B3E,SAAS,CAAGA,SAAS,CAAGC,qBAAxB,CACAoC,yBAAyB,CAAClC,IAAD,CAC5B,CAEDkB,IAAI,CAACuD,aAAL,CAAmBC,cAAnB,EACH,CARD,EAUA1E,IAAI,CAACiE,EAAL,CAAQzF,YAAY,CAAC0F,MAAb,CAAoBC,QAA5B,CAAsCpF,SAAS,CAACS,mBAAhD,CAAqE,SAAS4E,CAAT,CAAYlD,IAAZ,CAAkB,CACnF,GAAImD,CAAAA,MAAM,CAAG9F,CAAC,CAAC6F,CAAC,CAACE,MAAH,CAAD,CAAYC,OAAZ,CAAoBxF,SAAS,CAACS,mBAA9B,CAAb,CACA,GAAI,CAAC6E,MAAM,CAACG,QAAP,CAAgB,UAAhB,CAAL,CAAkC,CAC9B3E,SAAS,CAAGA,SAAS,CAAGC,qBAAxB,CACAD,SAAS,CAAe,CAAZ,CAAAA,SAAS,CAAO,CAAP,CAAWA,SAAhC,CACAqC,yBAAyB,CAAClC,IAAD,CAC5B,CAEDkB,IAAI,CAACuD,aAAL,CAAmBC,cAAnB,EACH,CATD,CAUH,CA1SH,CAuUE,MAAO,CACHC,IAAI,CAtBG,QAAPA,CAAAA,IAAO,CAAS3C,MAAT,CAAiBhC,IAAjB,CAAuB,CAC9BA,IAAI,CAAGzB,CAAC,CAACyB,IAAD,CAAR,CAEAuD,sBAAsB,CAACvD,IAAD,CAAtB,CACA+B,WAAW,CAACC,MAAD,CAAX,CACKR,IADL,CACU,SAASC,eAAT,CAA0B,CAC5B/B,UAAU,CAAG+B,eAAb,CACAhC,aAAa,GAAb,CAEA,GAAIC,UAAU,CAAC6C,MAAf,CAAuB,CACnBnC,WAAW,CAACJ,IAAD,CAAX,CACAkC,yBAAyB,CAAClC,IAAD,CAC5B,CAHD,IAGO,CACHD,gBAAgB,CAACC,IAAD,CACnB,CAGJ,CAbL,EAcK6B,KAdL,CAcWpD,YAAY,CAACqD,SAdxB,CAeH,CAEM,CAGV,CA9VC,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the Recently accessed courses block.\n *\n * @module     block_recentlyaccessedcourses/main.js\n * @package    block_recentlyaccessedcourses\n * @copyright  2018 Victor Deniz <victor@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(\n    [\n        'jquery',\n        'core/custom_interaction_events',\n        'core/notification',\n        'core/pubsub',\n        'core/paged_content_paging_bar',\n        'core/templates',\n        'core_course/events',\n        'core_course/repository',\n    ],\n    function(\n        $,\n        CustomEvents,\n        Notification,\n        PubSub,\n        PagedContentPagingBar,\n        Templates,\n        CourseEvents,\n        CoursesRepository\n    ) {\n\n        // Constants.\n        var NUM_COURSES_TOTAL = 10;\n        var SELECTORS = {\n            BLOCK_CONTAINER: '[data-region=\"recentlyaccessedcourses\"]',\n            CARD_CONTAINER: '[data-region=\"card-deck\"]',\n            COURSE_IS_FAVOURITE: '[data-region=\"is-favourite\"]',\n            CONTENT: '[data-region=\"view-content\"]',\n            EMPTY_MESSAGE: '[data-region=\"empty-message\"]',\n            LOADING_PLACEHOLDER: '[data-region=\"loading-placeholder\"]',\n            PAGING_BAR: '[data-region=\"paging-bar\"]',\n            PAGING_BAR_NEXT: '[data-control=\"next\"]',\n            PAGING_BAR_PREVIOUS: '[data-control=\"previous\"]'\n        };\n        // Module variables.\n        var contentLoaded = false;\n        var allCourses = [];\n        var visibleCoursesId = null;\n        var cardWidth = null;\n        var viewIndex = 0;\n        var availableVisibleCards = 1;\n\n        /**\n         * Show the empty message when no course are found.\n         *\n         * @param {object} root The root element for the courses view.\n         */\n        var showEmptyMessage = function(root) {\n            root.find(SELECTORS.EMPTY_MESSAGE).removeClass('hidden');\n            root.find(SELECTORS.LOADING_PLACEHOLDER).addClass('hidden');\n            root.find(SELECTORS.CONTENT).addClass('hidden');\n        };\n\n        /**\n         * Show the empty message when no course are found.\n         *\n         * @param {object} root The root element for the courses view.\n         */\n        var showContent = function(root) {\n            root.find(SELECTORS.CONTENT).removeClass('hidden');\n            root.find(SELECTORS.EMPTY_MESSAGE).addClass('hidden');\n            root.find(SELECTORS.LOADING_PLACEHOLDER).addClass('hidden');\n        };\n\n        /**\n         * Show the paging bar.\n         *\n         * @param {object} root The root element for the courses view.\n         */\n        var showPagingBar = function(root) {\n            var pagingBar = root.find(SELECTORS.PAGING_BAR);\n            pagingBar.css('opacity', 1);\n            pagingBar.css('visibility', 'visible');\n            pagingBar.attr('aria-hidden', 'false');\n        };\n\n        /**\n         * Hide the paging bar.\n         *\n         * @param {object} root The root element for the courses view.\n         */\n        var hidePagingBar = function(root) {\n            var pagingBar = root.find(SELECTORS.PAGING_BAR);\n            pagingBar.css('opacity', 0);\n            pagingBar.css('visibility', 'hidden');\n            pagingBar.attr('aria-hidden', 'true');\n        };\n\n        /**\n         * Show the favourite indicator for the given course (if it's in the list).\n         *\n         * @param {object} root The root element for the courses view.\n         * @param {number} courseId The id of the course to be favourited.\n         */\n        var favouriteCourse = function(root, courseId) {\n            allCourses.forEach(function(course) {\n                if (course.attr('data-course-id') == courseId) {\n                    course.find(SELECTORS.COURSE_IS_FAVOURITE).removeClass('hidden');\n                }\n            });\n        };\n\n        /**\n         * Hide the favourite indicator for the given course (if it's in the list).\n         *\n         * @param {object} root The root element for the courses view.\n         * @param {number} courseId The id of the course to be unfavourited.\n         */\n        var unfavouriteCourse = function(root, courseId) {\n            allCourses.forEach(function(course) {\n                if (course.attr('data-course-id') == courseId) {\n                    course.find(SELECTORS.COURSE_IS_FAVOURITE).addClass('hidden');\n                }\n            });\n        };\n\n        /**\n         * Render the a list of courses.\n         *\n         * @param {array} courses containing array of courses.\n         * @return {promise} Resolved with list of rendered courses as jQuery objects.\n         */\n        var renderAllCourses = function(courses) {\n            var showcoursecategory = $(SELECTORS.BLOCK_CONTAINER).data('displaycoursecategory');\n            var promises = courses.map(function(course) {\n                course.showcoursecategory = showcoursecategory;\n                return Templates.render('block_recentlyaccessedcourses/course-card', course);\n            });\n\n            return $.when.apply(null, promises).then(function() {\n                var renderedCourses = [];\n\n                promises.forEach(function(promise) {\n                    promise.then(function(html) {\n                        renderedCourses.push($(html));\n                        return;\n                    })\n                    .catch(Notification.exception);\n                });\n\n                return renderedCourses;\n            });\n        };\n\n        /**\n         * Fetch user's recently accessed courses and reload the content of the block.\n         *\n         * @param {int} userid User whose courses will be shown\n         * @returns {promise} The updated content for the block.\n         */\n        var loadContent = function(userid) {\n            return CoursesRepository.getLastAccessedCourses(userid, NUM_COURSES_TOTAL)\n                .then(function(courses) {\n                    return renderAllCourses(courses);\n                });\n        };\n\n        /**\n         * Recalculate the number of courses that should be visible.\n         *\n         * @param {object} root The root element for the courses view.\n         */\n        var recalculateVisibleCourses = function(root) {\n            var container = root.find(SELECTORS.CONTENT).find(SELECTORS.CARD_CONTAINER);\n            var availableWidth = parseFloat(root.css('width'));\n            var numberOfCourses = allCourses.length;\n            var start = 0;\n\n            if (!cardWidth) {\n                container.html(allCourses[0]);\n                // Render one card initially to calculate the width of the cards\n                // including the margins.\n                cardWidth = allCourses[0].outerWidth(true);\n            }\n\n            availableVisibleCards = Math.floor(availableWidth / cardWidth);\n\n            if (viewIndex + availableVisibleCards < numberOfCourses) {\n                start = viewIndex;\n            } else {\n                var overflow = (viewIndex + availableVisibleCards) - numberOfCourses;\n                start = viewIndex - overflow;\n                start = start >= 0 ? start : 0;\n            }\n\n            // At least show one card.\n            if (availableVisibleCards === 0) {\n                availableVisibleCards = 1;\n            }\n\n            var coursesToShow = allCourses.slice(start, start + availableVisibleCards);\n            // Create an id for the list of courses we expect to be displayed.\n            var newVisibleCoursesId = coursesToShow.reduce(function(carry, course) {\n                return carry + course.attr('data-course-id');\n            }, '');\n\n            // Centre the courses if we have an overflow of courses.\n            if (allCourses.length > coursesToShow.length) {\n                container.addClass('justify-content-center');\n                container.removeClass('justify-content-start');\n            } else {\n                container.removeClass('justify-content-center');\n                container.addClass('justify-content-start');\n            }\n\n            // Don't bother updating the DOM unless the visible courses have changed.\n            if (visibleCoursesId != newVisibleCoursesId) {\n                var pagingBar = root.find(PagedContentPagingBar.rootSelector);\n                container.html(coursesToShow);\n                visibleCoursesId = newVisibleCoursesId;\n\n                if (availableVisibleCards >= allCourses.length) {\n                    hidePagingBar(root);\n                } else {\n                    showPagingBar(root);\n\n                    if (viewIndex === 0) {\n                        PagedContentPagingBar.disablePreviousControlButtons(pagingBar);\n                    } else {\n                        PagedContentPagingBar.enablePreviousControlButtons(pagingBar);\n                    }\n\n                    if (viewIndex + availableVisibleCards >= allCourses.length) {\n                        PagedContentPagingBar.disableNextControlButtons(pagingBar);\n                    } else {\n                        PagedContentPagingBar.enableNextControlButtons(pagingBar);\n                    }\n                }\n            }\n        };\n\n        /**\n         * Register event listeners for the block.\n         *\n         * @param {object} root The root element for the recentlyaccessedcourses block.\n         */\n        var registerEventListeners = function(root) {\n            var resizeTimeout = null;\n            var drawerToggling = false;\n\n            PubSub.subscribe(CourseEvents.favourited, function(courseId) {\n                favouriteCourse(root, courseId);\n            });\n\n            PubSub.subscribe(CourseEvents.unfavorited, function(courseId) {\n                unfavouriteCourse(root, courseId);\n            });\n\n            PubSub.subscribe('nav-drawer-toggle-start', function() {\n                if (!contentLoaded || !allCourses.length || drawerToggling) {\n                    // Nothing to recalculate.\n                    return;\n                }\n\n                drawerToggling = true;\n                var recalculationCount = 0;\n                // This function is going to recalculate the number of courses while\n                // the nav drawer is opening or closes (up to a maximum of 5 recalcs).\n                var doRecalculation = function() {\n                    setTimeout(function() {\n                        recalculateVisibleCourses(root);\n                        recalculationCount++;\n\n                        if (recalculationCount < 5 && drawerToggling) {\n                            // If we haven't done too many recalculations and the drawer\n                            // is still toggling then recurse.\n                            doRecalculation();\n                        }\n                    }, 100);\n                };\n\n                // Start the recalculations.\n                doRecalculation(root);\n            });\n\n            PubSub.subscribe('nav-drawer-toggle-end', function() {\n                drawerToggling = false;\n            });\n\n            $(window).on('resize', function() {\n                if (!contentLoaded || !allCourses.length) {\n                    // Nothing to reclculate.\n                    return;\n                }\n\n                // Resize events fire rapidly so recalculating the visible courses each\n                // time can be expensive. Let's debounce them,\n                if (!resizeTimeout) {\n                    resizeTimeout = setTimeout(function() {\n                        resizeTimeout = null;\n                        recalculateVisibleCourses(root);\n                    // The recalculateVisibleCourses function will execute at a rate of 15fps.\n                    }, 66);\n                }\n            });\n\n            CustomEvents.define(root, [CustomEvents.events.activate]);\n            root.on(CustomEvents.events.activate, SELECTORS.PAGING_BAR_NEXT, function(e, data) {\n                var button = $(e.target).closest(SELECTORS.PAGING_BAR_NEXT);\n                if (!button.hasClass('disabled')) {\n                    viewIndex = viewIndex + availableVisibleCards;\n                    recalculateVisibleCourses(root);\n                }\n\n                data.originalEvent.preventDefault();\n            });\n\n            root.on(CustomEvents.events.activate, SELECTORS.PAGING_BAR_PREVIOUS, function(e, data) {\n                var button = $(e.target).closest(SELECTORS.PAGING_BAR_PREVIOUS);\n                if (!button.hasClass('disabled')) {\n                    viewIndex = viewIndex - availableVisibleCards;\n                    viewIndex = viewIndex < 0 ? 0 : viewIndex;\n                    recalculateVisibleCourses(root);\n                }\n\n                data.originalEvent.preventDefault();\n            });\n        };\n\n        /**\n         * Get and show the recent courses into the block.\n         *\n         * @param {int} userid User from which the courses will be obtained\n         * @param {object} root The root element for the recentlyaccessedcourses block.\n         */\n        var init = function(userid, root) {\n            root = $(root);\n\n            registerEventListeners(root);\n            loadContent(userid)\n                .then(function(renderedCourses) {\n                    allCourses = renderedCourses;\n                    contentLoaded = true;\n\n                    if (allCourses.length) {\n                        showContent(root);\n                        recalculateVisibleCourses(root);\n                    } else {\n                        showEmptyMessage(root);\n                    }\n\n                    return;\n                })\n                .catch(Notification.exception);\n        };\n\n        return {\n            init: init\n        };\n    });\n"],"file":"main.min.js"}