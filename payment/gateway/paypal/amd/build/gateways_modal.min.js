define ("paygw_paypal/gateways_modal",["exports","./repository","core/templates","core/truncate","core/modal_factory","core/modal_events","core/str"],function(_exports,Repository,_templates,_truncate,_modal_factory,_modal_events,_str){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.process=void 0;Repository=_interopRequireWildcard(Repository);_templates=_interopRequireDefault(_templates);_truncate=_interopRequireDefault(_truncate);_modal_factory=_interopRequireDefault(_modal_factory);_modal_events=_interopRequireDefault(_modal_events);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj}if(null===obj||"object"!=typeof obj&&"function"!=typeof obj){return{default:obj}}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if("default"!=key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj.default=obj;if(cache){cache.set(obj,newObj)}return newObj}const showModalWithPlaceholder=async()=>{const modal=await _modal_factory.default.create({body:await _templates.default.render("paygw_paypal/paypal_button_placeholder",{})});modal.show();return modal},process=(component,paymentArea,itemId,description)=>{return Promise.all([showModalWithPlaceholder(),Repository.getConfigForJs(component,paymentArea,itemId)]).then(_ref=>{let[modal,paypalConfig]=_ref;modal.getRoot().on(_modal_events.default.hidden,()=>{modal.destroy()});return Promise.all([modal,paypalConfig,switchSdk(paypalConfig.clientid,paypalConfig.currency)])}).then(_ref2=>{let[modal,paypalConfig]=_ref2;modal.setBody("");return new Promise(resolve=>{window.paypal.Buttons({createOrder:function(data,actions){return actions.order.create({purchase_units:[{amount:{currency_code:paypalConfig.currency_code,value:paypalConfig.cost},description:_truncate.default.truncate(description,{length:127,stripTags:!0})}],application_context:{shipping_preference:"NO_SHIPPING",brand_name:_truncate.default.truncate(paypalConfig.brandname,{length:127,stripTags:!0})}})},onApprove:function(data){modal.getRoot().on(_modal_events.default.outsideClick,e=>{e.preventDefault()});modal.setBody((0,_str.get_string)("authorising","paygw_paypal"));Repository.markTransactionComplete(component,paymentArea,itemId,data.orderID).then(res=>{modal.hide();return res}).then(resolve)}}).render(modal.getBody()[0])})}).then(res=>{if(res.success){return Promise.resolve(res.message)}return Promise.reject(res.message)})};_exports.process=process;const switchSdk=(clientId,currency)=>{const sdkUrl="https://www.paypal.com/sdk/js?client-id=".concat(clientId,"&currency=").concat(currency);if(switchSdk.currentlyloaded===sdkUrl){return Promise.resolve()}if(switchSdk.currentlyloaded){const suspectedScript=document.querySelector("script[src=\"".concat(switchSdk.currentlyloaded,"\"]"));if(suspectedScript){suspectedScript.parentNode.removeChild(suspectedScript)}}const script=document.createElement("script");return new Promise(resolve=>{if(script.readyState){script.onreadystatechange=function(){if("complete"==this.readyState||"loaded"==this.readyState){this.onreadystatechange=null;resolve()}}}else{script.onload=function(){resolve()}}script.setAttribute("src",sdkUrl);document.head.appendChild(script);switchSdk.currentlyloaded=sdkUrl})};switchSdk.currentlyloaded=""});
//# sourceMappingURL=gateways_modal.min.js.map
