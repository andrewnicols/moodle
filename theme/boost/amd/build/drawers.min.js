function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define ("theme_boost/drawers",["exports","core/modal_backdrop","core/templates","core/aria","core/event_dispatcher","core/utils","core/pending","jquery"],function(_exports,_modal_backdrop,_templates,Aria,_event_dispatcher,_utils,_pending,_jquery){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.default=void 0;_modal_backdrop=_interopRequireDefault(_modal_backdrop);_templates=_interopRequireDefault(_templates);Aria=_interopRequireWildcard(Aria);_pending=_interopRequireDefault(_pending);_jquery=_interopRequireDefault(_jquery);function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj}if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj){return{default:obj}}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if("default"!=key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj.default=obj;if(cache){cache.set(obj,newObj)}return newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0,descriptor;i<props.length;i++){descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value"in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:!1});return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0})}else{obj[key]=value}return obj}var backdropPromise=null,drawerMap=new Map,SELECTORS={BUTTONS:"[data-toggler=\"drawers\"]",CLOSEBTN:"[data-toggler=\"drawers\"][data-action=\"closedrawer\"]",OPENBTN:"[data-toggler=\"drawers\"][data-action=\"opendrawer\"]",TOGGLEBTN:"[data-toggler=\"drawers\"][data-action=\"toggle\"]",DRAWERS:"[data-region=\"fixed-drawer\"]",CONTAINER:"#page.drawers",DRAWERCONTENT:".drawercontent"},CLASSES={SCROLLED:"scrolled",SHOW:"show",NOTINITIALISED:"not-initialized"},sizes={medium:991,large:1400},getCurrentWidth=function(){var DomRect=document.body.getBoundingClientRect();return DomRect.x+DomRect.width},isSmall=function(){var browserWidth=getCurrentWidth();return browserWidth<sizes.medium},isLarge=function(){var browserWidth=getCurrentWidth();return browserWidth>=sizes.large},getBackdrop=function(){if(!backdropPromise){backdropPromise=_templates.default.render("core/modal_backdrop",{}).then(function(html){return new _modal_backdrop.default(html)}).then(function(modalBackdrop){modalBackdrop.getAttachmentPoint().get(0).addEventListener("click",function(e){e.preventDefault();Drawers.closeAllDrawers()});return modalBackdrop}).catch()}return backdropPromise},getDrawerOpenButton=function(drawerId){var openButton=document.querySelector("".concat(SELECTORS.OPENBTN,"[data-target=\"").concat(drawerId,"\"]"));if(!openButton){openButton=document.querySelector("".concat(SELECTORS.TOGGLEBTN,"[data-target=\"").concat(drawerId,"\"]"))}return openButton},disableDrawerTooltips=function(drawerNode){var buttons=[drawerNode.querySelector(SELECTORS.CLOSEBTN),getDrawerOpenButton(drawerNode.id)];buttons.forEach(function(button){if(!button){return}disableButtonTooltip(button)})},disableButtonTooltip=function(button,enableOnBlur){if(button.hasAttribute("data-original-title")){(0,_jquery.default)(button).tooltip("disable");button.setAttribute("title",button.dataset.originalTitle)}else{button.dataset.disabledToggle=button.dataset.toggle;button.removeAttribute("data-toggle")}if(enableOnBlur){button.dataset.restoreTooltipOnBlur=!0}},enableDrawerTooltips=function(drawerNode){var buttons=[drawerNode.querySelector(SELECTORS.CLOSEBTN),getDrawerOpenButton(drawerNode.id)];buttons.forEach(function(button){if(!button){return}enableButtonTooltip(button)})},enableButtonTooltip=function(button){if(button.hasAttribute("data-original-title")){(0,_jquery.default)(button).tooltip("enable");button.removeAttribute("title")}else if(button.dataset.disabledToggle){button.dataset.toggle=button.dataset.disabledToggle;(0,_jquery.default)(button).tooltip()}delete button.dataset.restoreTooltipOnBlur},addInnerScrollListener=function(drawerNode){var content=drawerNode.querySelector(SELECTORS.DRAWERCONTENT);if(!content){return}content.addEventListener("scroll",function(){drawerNode.classList.toggle(CLASSES.SCROLLED,0!=content.scrollTop)})},Drawers=function(){function Drawers(drawerNode){_classCallCheck(this,Drawers);_defineProperty(this,"drawerNode",null);this.drawerNode=drawerNode;if(isSmall()){this.closeDrawer({focusOnOpenButton:!1,updatePreferences:!1})}if(this.drawerNode.classList.contains(CLASSES.SHOW)){this.openDrawer({focusOnCloseButton:!1})}else if(1==this.drawerNode.dataset.forceopen){if(!isSmall()){this.openDrawer({focusOnCloseButton:!1})}}else{Aria.hide(this.drawerNode)}if(isSmall()){disableDrawerTooltips(this.drawerNode)}addInnerScrollListener(this.drawerNode);drawerMap.set(drawerNode,this);drawerNode.classList.remove(CLASSES.NOTINITIALISED)}_createClass(Drawers,[{key:"isOpen",get:function get(){return this.drawerNode.classList.contains(CLASSES.SHOW)}},{key:"closeOnResize",get:function get(){return!!parseInt(this.drawerNode.dataset.closeOnResize)}},{key:"dispatchEvent",value:function dispatchEvent(eventname){var cancelable=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1;return(0,_event_dispatcher.dispatchEvent)(eventname,{drawerInstance:this},this.drawerNode,{cancelable:cancelable})}},{key:"openDrawer",value:function openDrawer(){var _this$drawerNode$quer,_ref=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},_ref$focusOnCloseButt=_ref.focusOnCloseButton,focusOnCloseButton=void 0===_ref$focusOnCloseButt?!0:_ref$focusOnCloseButt,pendingPromise=new _pending.default("theme_boost/drawers:open"),showEvent=this.dispatchEvent(Drawers.eventTypes.drawerShow,!0);if(showEvent.defaultPrevented){return}null===(_this$drawerNode$quer=this.drawerNode.querySelector(SELECTORS.CLOSEBTN))||void 0===_this$drawerNode$quer?void 0:_this$drawerNode$quer.classList.toggle("hidden",!0);var openButton=getDrawerOpenButton(this.drawerNode.id);if(openButton&&openButton.hasAttribute("data-original-title")){var _jQuery;null===(_jQuery=(0,_jquery.default)(openButton))||void 0===_jQuery?void 0:_jQuery.tooltip("hide")}Aria.unhide(this.drawerNode);this.drawerNode.classList.add(CLASSES.SHOW);var preference=this.drawerNode.dataset.preference;if(preference&&!isSmall()&&1!=this.drawerNode.dataset.forceopen){M.util.set_user_preference(preference,!0)}var state=this.drawerNode.dataset.state;if(state){var page=document.getElementById("page");page.classList.add(state)}if(isSmall()){getBackdrop().then(function(backdrop){backdrop.show();var pageWrapper=document.getElementById("page-wrapper");pageWrapper.style.overflow="hidden";return backdrop}).catch()}var closeButton=this.drawerNode.querySelector(SELECTORS.CLOSEBTN);if(focusOnCloseButton&&closeButton){disableButtonTooltip(closeButton,!0)}setTimeout(function(){closeButton.classList.toggle("hidden",!1);if(focusOnCloseButton){closeButton.focus()}pendingPromise.resolve()},300);this.dispatchEvent(Drawers.eventTypes.drawerShown)}},{key:"closeDrawer",value:function closeDrawer(){var _ref2=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},_ref2$focusOnOpenButt=_ref2.focusOnOpenButton,focusOnOpenButton=void 0===_ref2$focusOnOpenButt?!0:_ref2$focusOnOpenButt,_ref2$updatePreferenc=_ref2.updatePreferences,updatePreferences=void 0===_ref2$updatePreferenc?!0:_ref2$updatePreferenc,pendingPromise=new _pending.default("theme_boost/drawers:close"),hideEvent=this.dispatchEvent(Drawers.eventTypes.drawerHide,!0);if(hideEvent.defaultPrevented){return}var closeButton=this.drawerNode.querySelector(SELECTORS.CLOSEBTN);null===closeButton||void 0===closeButton?void 0:closeButton.classList.toggle("hidden",!0);if(closeButton.hasAttribute("data-original-title")){var _jQuery2;null===(_jQuery2=(0,_jquery.default)(closeButton))||void 0===_jQuery2?void 0:_jQuery2.tooltip("hide")}var preference=this.drawerNode.dataset.preference;if(preference&&updatePreferences&&!isSmall()){M.util.set_user_preference(preference,!1)}var state=this.drawerNode.dataset.state;if(state){var page=document.getElementById("page");page.classList.remove(state)}Aria.hide(this.drawerNode);this.drawerNode.classList.remove(CLASSES.SHOW);getBackdrop().then(function(backdrop){backdrop.hide();if(isSmall()){var pageWrapper=document.getElementById("page-wrapper");pageWrapper.style.overflow="auto"}return backdrop}).catch();var openButton=getDrawerOpenButton(this.drawerNode.id);if(openButton){disableButtonTooltip(openButton,!0)}setTimeout(function(){if(openButton&&focusOnOpenButton){openButton.focus()}pendingPromise.resolve()},300);this.dispatchEvent(Drawers.eventTypes.drawerHidden)}},{key:"toggleVisibility",value:function toggleVisibility(){if(this.drawerNode.classList.contains(CLASSES.SHOW)){this.closeDrawer()}else{this.openDrawer()}}}],[{key:"getDrawerInstanceForNode",value:function getDrawerInstanceForNode(drawerNode){if(!drawerMap.has(drawerNode)){new Drawers(drawerNode)}return drawerMap.get(drawerNode)}},{key:"closeAllDrawers",value:function closeAllDrawers(){drawerMap.forEach(function(drawerInstance){drawerInstance.closeDrawer()})}},{key:"closeOtherDrawers",value:function closeOtherDrawers(comparisonInstance){drawerMap.forEach(function(drawerInstance){if(drawerInstance===comparisonInstance){return}drawerInstance.closeDrawer()})}}]);return Drawers}();_exports.default=Drawers;_defineProperty(Drawers,"eventTypes",{drawerShow:"theme_boost/drawers:show",drawerShown:"theme_boost/drawers:shown",drawerHide:"theme_boost/drawers:hide",drawerHidden:"theme_boost/drawers:hidden"});var setLastUsedToggle=function(toggleButton){if(toggleButton.dataset.target){document.querySelectorAll("".concat(SELECTORS.BUTTONS,"[data-target=\"").concat(toggleButton.dataset.target,"\"]")).forEach(function(btn){btn.dataset.lastused=!1});toggleButton.dataset.lastused=!0}},focusLastUsedToggle=function(target){var lastUsedButton=document.querySelector("".concat(SELECTORS.BUTTONS,"[data-target=\"").concat(target,"\"][data-lastused=\"true\""));if(lastUsedButton){lastUsedButton.focus()}};(function scroller(){var body=document.querySelector("body"),drawerLayout=document.querySelector(SELECTORS.CONTAINER);if(drawerLayout){drawerLayout.addEventListener("scroll",function(){if(drawerLayout.scrollTop>=window.innerHeight){body.classList.add(CLASSES.SCROLLED)}else{body.classList.remove(CLASSES.SCROLLED)}})}})();(function registerListeners(){document.addEventListener("click",function(e){var toggleButton=e.target.closest(SELECTORS.TOGGLEBTN);if(toggleButton&&toggleButton.dataset.target){e.preventDefault();var targetDrawer=document.getElementById(toggleButton.dataset.target),drawerInstance=Drawers.getDrawerInstanceForNode(targetDrawer);setLastUsedToggle(toggleButton);drawerInstance.toggleVisibility()}var openDrawerButton=e.target.closest(SELECTORS.OPENBTN);if(openDrawerButton&&openDrawerButton.dataset.target){e.preventDefault();var _targetDrawer=document.getElementById(openDrawerButton.dataset.target),_drawerInstance=Drawers.getDrawerInstanceForNode(_targetDrawer);setLastUsedToggle(toggleButton);_drawerInstance.openDrawer()}var closeDrawerButton=e.target.closest(SELECTORS.CLOSEBTN);if(closeDrawerButton&&closeDrawerButton.dataset.target){e.preventDefault();var _targetDrawer2=document.getElementById(closeDrawerButton.dataset.target),_drawerInstance2=Drawers.getDrawerInstanceForNode(_targetDrawer2);_drawerInstance2.closeDrawer();focusLastUsedToggle(closeDrawerButton.dataset.target)}});document.addEventListener(Drawers.eventTypes.drawerShow,function(e){if(isLarge()){return}Drawers.closeOtherDrawers(e.detail.drawerInstance)});var btnSelector="".concat(SELECTORS.TOGGLEBTN,", ").concat(SELECTORS.OPENBTN,", ").concat(SELECTORS.CLOSEBTN);document.addEventListener("focusout",function(e){var button=e.target.closest(btnSelector);if((null===button||void 0===button?void 0:button.dataset.restoreTooltipOnBlur)!==void 0){enableButtonTooltip(button)}});window.addEventListener("resize",(0,_utils.debounce)(function closeOnResizeListener(){if(isSmall()){var anyOpen=!1;drawerMap.forEach(function(drawerInstance){disableDrawerTooltips(drawerInstance.drawerNode);if(drawerInstance.isOpen){if(drawerInstance.closeOnResize){drawerInstance.closeDrawer()}else{anyOpen=!0}}});if(anyOpen){getBackdrop().then(function(backdrop){return backdrop.show()}).catch()}}else{drawerMap.forEach(function(drawerInstance){enableDrawerTooltips(drawerInstance.drawerNode)});getBackdrop().then(function(backdrop){return backdrop.hide()}).catch()}},400))})();var drawers=document.querySelectorAll(SELECTORS.DRAWERS);drawers.forEach(function(drawerNode){return Drawers.getDrawerInstanceForNode(drawerNode)});return _exports.default});
//# sourceMappingURL=drawers.min.js.map
