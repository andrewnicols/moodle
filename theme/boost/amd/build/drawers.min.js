define ("theme_boost/drawers",["exports","core/modal_backdrop","core/templates","core/aria","core/event_dispatcher","core/utils","core/pending","jquery"],function(_exports,_modal_backdrop,_templates,Aria,_event_dispatcher,_utils,_pending,_jquery){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.default=void 0;_modal_backdrop=_interopRequireDefault(_modal_backdrop);_templates=_interopRequireDefault(_templates);Aria=_interopRequireWildcard(Aria);_pending=_interopRequireDefault(_pending);_jquery=_interopRequireDefault(_jquery);function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj}if(null===obj||"object"!=typeof obj&&"function"!=typeof obj){return{default:obj}}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if("default"!=key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj.default=obj;if(cache){cache.set(obj,newObj)}return newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0})}else{obj[key]=value}return obj}let backdropPromise=null;const drawerMap=new Map,SELECTORS={BUTTONS:"[data-toggler=\"drawers\"]",CLOSEBTN:"[data-toggler=\"drawers\"][data-action=\"closedrawer\"]",OPENBTN:"[data-toggler=\"drawers\"][data-action=\"opendrawer\"]",TOGGLEBTN:"[data-toggler=\"drawers\"][data-action=\"toggle\"]",DRAWERS:"[data-region=\"fixed-drawer\"]",CONTAINER:"#page.drawers",DRAWERCONTENT:".drawercontent"},CLASSES={SCROLLED:"scrolled",SHOW:"show",NOTINITIALISED:"not-initialized"},sizes={medium:991,large:1400},getCurrentWidth=()=>{const DomRect=document.body.getBoundingClientRect();return DomRect.x+DomRect.width},isSmall=()=>{const browserWidth=getCurrentWidth();return browserWidth<sizes.medium},isLarge=()=>{const browserWidth=getCurrentWidth();return browserWidth>=sizes.large},getBackdrop=()=>{if(!backdropPromise){backdropPromise=_templates.default.render("core/modal_backdrop",{}).then(html=>new _modal_backdrop.default(html)).then(modalBackdrop=>{modalBackdrop.getAttachmentPoint().get(0).addEventListener("click",e=>{e.preventDefault();Drawers.closeAllDrawers()});return modalBackdrop}).catch()}return backdropPromise},getDrawerOpenButton=drawerId=>{let openButton=document.querySelector("".concat(SELECTORS.OPENBTN,"[data-target=\"").concat(drawerId,"\"]"));if(!openButton){openButton=document.querySelector("".concat(SELECTORS.TOGGLEBTN,"[data-target=\"").concat(drawerId,"\"]"))}return openButton},disableDrawerTooltips=drawerNode=>{const buttons=[drawerNode.querySelector(SELECTORS.CLOSEBTN),getDrawerOpenButton(drawerNode.id)];buttons.forEach(button=>{if(!button){return}disableButtonTooltip(button)})},disableButtonTooltip=(button,enableOnBlur)=>{if(button.hasAttribute("data-original-title")){(0,_jquery.default)(button).tooltip("disable");button.setAttribute("title",button.dataset.originalTitle)}else{button.dataset.disabledToggle=button.dataset.toggle;button.removeAttribute("data-toggle")}if(enableOnBlur){button.dataset.restoreTooltipOnBlur=!0}},enableDrawerTooltips=drawerNode=>{const buttons=[drawerNode.querySelector(SELECTORS.CLOSEBTN),getDrawerOpenButton(drawerNode.id)];buttons.forEach(button=>{if(!button){return}enableButtonTooltip(button)})},enableButtonTooltip=button=>{if(button.hasAttribute("data-original-title")){(0,_jquery.default)(button).tooltip("enable");button.removeAttribute("title")}else if(button.dataset.disabledToggle){button.dataset.toggle=button.dataset.disabledToggle;(0,_jquery.default)(button).tooltip()}delete button.dataset.restoreTooltipOnBlur},addInnerScrollListener=drawerNode=>{const content=drawerNode.querySelector(SELECTORS.DRAWERCONTENT);if(!content){return}content.addEventListener("scroll",()=>{drawerNode.classList.toggle(CLASSES.SCROLLED,0!=content.scrollTop)})};class Drawers{constructor(drawerNode){_defineProperty(this,"drawerNode",null);this.drawerNode=drawerNode;if(isSmall()){this.closeDrawer({focusOnOpenButton:!1,updatePreferences:!1})}if(this.drawerNode.classList.contains(CLASSES.SHOW)){this.openDrawer({focusOnCloseButton:!1})}else if(1==this.drawerNode.dataset.forceopen){if(!isSmall()){this.openDrawer({focusOnCloseButton:!1})}}else{Aria.hide(this.drawerNode)}if(isSmall()){disableDrawerTooltips(this.drawerNode)}addInnerScrollListener(this.drawerNode);drawerMap.set(drawerNode,this);drawerNode.classList.remove(CLASSES.NOTINITIALISED)}get isOpen(){return this.drawerNode.classList.contains(CLASSES.SHOW)}get closeOnResize(){return!!parseInt(this.drawerNode.dataset.closeOnResize)}static getDrawerInstanceForNode(drawerNode){if(!drawerMap.has(drawerNode)){new Drawers(drawerNode)}return drawerMap.get(drawerNode)}dispatchEvent(eventname){let cancelable=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1;return(0,_event_dispatcher.dispatchEvent)(eventname,{drawerInstance:this},this.drawerNode,{cancelable})}openDrawer(){var _this$drawerNode$quer;let{focusOnCloseButton=!0}=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};const pendingPromise=new _pending.default("theme_boost/drawers:open"),showEvent=this.dispatchEvent(Drawers.eventTypes.drawerShow,!0);if(showEvent.defaultPrevented){return}null===(_this$drawerNode$quer=this.drawerNode.querySelector(SELECTORS.CLOSEBTN))||void 0===_this$drawerNode$quer?void 0:_this$drawerNode$quer.classList.toggle("hidden",!0);let openButton=getDrawerOpenButton(this.drawerNode.id);if(openButton&&openButton.hasAttribute("data-original-title")){var _jQuery;null===(_jQuery=(0,_jquery.default)(openButton))||void 0===_jQuery?void 0:_jQuery.tooltip("hide")}Aria.unhide(this.drawerNode);this.drawerNode.classList.add(CLASSES.SHOW);const preference=this.drawerNode.dataset.preference;if(preference&&!isSmall()&&1!=this.drawerNode.dataset.forceopen){M.util.set_user_preference(preference,!0)}const state=this.drawerNode.dataset.state;if(state){const page=document.getElementById("page");page.classList.add(state)}if(isSmall()){getBackdrop().then(backdrop=>{backdrop.show();const pageWrapper=document.getElementById("page-wrapper");pageWrapper.style.overflow="hidden";return backdrop}).catch()}const closeButton=this.drawerNode.querySelector(SELECTORS.CLOSEBTN);if(focusOnCloseButton&&closeButton){disableButtonTooltip(closeButton,!0)}setTimeout(()=>{closeButton.classList.toggle("hidden",!1);if(focusOnCloseButton){closeButton.focus()}pendingPromise.resolve()},300);this.dispatchEvent(Drawers.eventTypes.drawerShown)}closeDrawer(){let{focusOnOpenButton=!0,updatePreferences=!0}=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};const pendingPromise=new _pending.default("theme_boost/drawers:close"),hideEvent=this.dispatchEvent(Drawers.eventTypes.drawerHide,!0);if(hideEvent.defaultPrevented){return}const closeButton=this.drawerNode.querySelector(SELECTORS.CLOSEBTN);null===closeButton||void 0===closeButton?void 0:closeButton.classList.toggle("hidden",!0);if(closeButton.hasAttribute("data-original-title")){var _jQuery2;null===(_jQuery2=(0,_jquery.default)(closeButton))||void 0===_jQuery2?void 0:_jQuery2.tooltip("hide")}const preference=this.drawerNode.dataset.preference;if(preference&&updatePreferences&&!isSmall()){M.util.set_user_preference(preference,!1)}const state=this.drawerNode.dataset.state;if(state){const page=document.getElementById("page");page.classList.remove(state)}Aria.hide(this.drawerNode);this.drawerNode.classList.remove(CLASSES.SHOW);getBackdrop().then(backdrop=>{backdrop.hide();if(isSmall()){const pageWrapper=document.getElementById("page-wrapper");pageWrapper.style.overflow="auto"}return backdrop}).catch();let openButton=getDrawerOpenButton(this.drawerNode.id);if(openButton){disableButtonTooltip(openButton,!0)}setTimeout(()=>{if(openButton&&focusOnOpenButton){openButton.focus()}pendingPromise.resolve()},300);this.dispatchEvent(Drawers.eventTypes.drawerHidden)}toggleVisibility(){if(this.drawerNode.classList.contains(CLASSES.SHOW)){this.closeDrawer()}else{this.openDrawer()}}static closeAllDrawers(){drawerMap.forEach(drawerInstance=>{drawerInstance.closeDrawer()})}static closeOtherDrawers(comparisonInstance){drawerMap.forEach(drawerInstance=>{if(drawerInstance===comparisonInstance){return}drawerInstance.closeDrawer()})}}_exports.default=Drawers;_defineProperty(Drawers,"eventTypes",{drawerShow:"theme_boost/drawers:show",drawerShown:"theme_boost/drawers:shown",drawerHide:"theme_boost/drawers:hide",drawerHidden:"theme_boost/drawers:hidden"});const setLastUsedToggle=toggleButton=>{if(toggleButton.dataset.target){document.querySelectorAll("".concat(SELECTORS.BUTTONS,"[data-target=\"").concat(toggleButton.dataset.target,"\"]")).forEach(btn=>{btn.dataset.lastused=!1});toggleButton.dataset.lastused=!0}},focusLastUsedToggle=target=>{const lastUsedButton=document.querySelector("".concat(SELECTORS.BUTTONS,"[data-target=\"").concat(target,"\"][data-lastused=\"true\""));if(lastUsedButton){lastUsedButton.focus()}};(()=>{const body=document.querySelector("body"),drawerLayout=document.querySelector(SELECTORS.CONTAINER);if(drawerLayout){drawerLayout.addEventListener("scroll",()=>{if(drawerLayout.scrollTop>=window.innerHeight){body.classList.add(CLASSES.SCROLLED)}else{body.classList.remove(CLASSES.SCROLLED)}})}})();(()=>{document.addEventListener("click",e=>{const toggleButton=e.target.closest(SELECTORS.TOGGLEBTN);if(toggleButton&&toggleButton.dataset.target){e.preventDefault();const targetDrawer=document.getElementById(toggleButton.dataset.target),drawerInstance=Drawers.getDrawerInstanceForNode(targetDrawer);setLastUsedToggle(toggleButton);drawerInstance.toggleVisibility()}const openDrawerButton=e.target.closest(SELECTORS.OPENBTN);if(openDrawerButton&&openDrawerButton.dataset.target){e.preventDefault();const targetDrawer=document.getElementById(openDrawerButton.dataset.target),drawerInstance=Drawers.getDrawerInstanceForNode(targetDrawer);setLastUsedToggle(toggleButton);drawerInstance.openDrawer()}const closeDrawerButton=e.target.closest(SELECTORS.CLOSEBTN);if(closeDrawerButton&&closeDrawerButton.dataset.target){e.preventDefault();const targetDrawer=document.getElementById(closeDrawerButton.dataset.target),drawerInstance=Drawers.getDrawerInstanceForNode(targetDrawer);drawerInstance.closeDrawer();focusLastUsedToggle(closeDrawerButton.dataset.target)}});document.addEventListener(Drawers.eventTypes.drawerShow,e=>{if(isLarge()){return}Drawers.closeOtherDrawers(e.detail.drawerInstance)});const btnSelector="".concat(SELECTORS.TOGGLEBTN,", ").concat(SELECTORS.OPENBTN,", ").concat(SELECTORS.CLOSEBTN);document.addEventListener("focusout",e=>{const button=e.target.closest(btnSelector);if((null===button||void 0===button?void 0:button.dataset.restoreTooltipOnBlur)!==void 0){enableButtonTooltip(button)}});window.addEventListener("resize",(0,_utils.debounce)(()=>{if(isSmall()){let anyOpen=!1;drawerMap.forEach(drawerInstance=>{disableDrawerTooltips(drawerInstance.drawerNode);if(drawerInstance.isOpen){if(drawerInstance.closeOnResize){drawerInstance.closeDrawer()}else{anyOpen=!0}}});if(anyOpen){getBackdrop().then(backdrop=>backdrop.show()).catch()}}else{drawerMap.forEach(drawerInstance=>{enableDrawerTooltips(drawerInstance.drawerNode)});getBackdrop().then(backdrop=>backdrop.hide()).catch()}},400))})();const drawers=document.querySelectorAll(SELECTORS.DRAWERS);drawers.forEach(drawerNode=>Drawers.getDrawerInstanceForNode(drawerNode));return _exports.default});
//# sourceMappingURL=drawers.min.js.map
