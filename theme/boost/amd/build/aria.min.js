define ("theme_boost/aria",["exports","core/key_codes","jquery","core/pending"],function(_exports,_key_codes,_jquery,_pending){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.init=void 0;_jquery=_interopRequireDefault(_jquery);_pending=_interopRequireDefault(_pending);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var dropdownFix=function(){var focusEnd=!1,setFocusEnd=function(){focusEnd=!0},getFocusEnd=function(){var result=focusEnd;focusEnd=!1;return result};document.addEventListener("keydown",function(e){if(e.target.matches("[data-toggle=\"dropdown\"]")){var trigger=e.which;if(trigger==_key_codes.arrowUp){setFocusEnd()}if(trigger==_key_codes.space||trigger==_key_codes.enter){e.preventDefault();e.target.click()}}});var shiftFocus=function(element){setTimeout(function delayedFocus(pendingPromise){element.focus();pendingPromise.resolve()},50,new _pending.default("core/aria:delayed-focus"))};(0,_jquery.default)(".dropdown").on("shown.bs.dropdown",function(e){var menu=e.target.querySelector("[role=\"menu\"]"),menuItems=!1,foundMenuItem=!1;if(menu){menuItems=menu.querySelectorAll("[role=\"menuitem\"]")}if(menuItems&&0<menuItems.length){if(getFocusEnd()){foundMenuItem=menuItems[menuItems.length-1]}else{foundMenuItem=menuItems[0]}}if(foundMenuItem){shiftFocus(foundMenuItem)}});document.addEventListener("keypress",function(e){if(e.target.matches(".dropdown [role=\"menu\"] [role=\"menuitem\"]")){var trigger=String.fromCharCode(e.which).toLowerCase(),menu=e.target.closest("[role=\"menu\"]");if(!menu){return}var menuItems=menu.querySelectorAll("[role=\"menuitem\"]");if(!menuItems){return}for(var i=0;i<menuItems.length;i++){var item=menuItems[i],itemText=item.text.trim().toLowerCase();if(0==itemText.indexOf(trigger)){shiftFocus(item);break}}}});document.addEventListener("keydown",function(e){if(e.target.matches(".dropdown [role=\"menu\"] [role=\"menuitem\"]")){var trigger=e.which,next=!1,menu=e.target.closest("[role=\"menu\"]");if(!menu){return}var menuItems=menu.querySelectorAll("[role=\"menuitem\"]");if(!menuItems){return}if(trigger==_key_codes.arrowDown){for(var i=0;i<menuItems.length-1;i++){if(menuItems[i]==e.target){next=menuItems[i+1];break}}if(!next){next=menuItems[0]}}else if(trigger==_key_codes.arrowUp){for(var _i=1;_i<menuItems.length;_i++){if(menuItems[_i]==e.target){next=menuItems[_i-1];break}}if(!next){next=menuItems[menuItems.length-1]}}else if(trigger==_key_codes.home){next=menuItems[0]}else if(trigger==_key_codes.end){next=menuItems[menuItems.length-1]}if(next){e.preventDefault();shiftFocus(next)}}});(0,_jquery.default)(".dropdown").on("hidden.bs.dropdown",function(e){var trigger=e.target.querySelector("[data-toggle=\"dropdown\"]");if(trigger){shiftFocus(trigger)}})},autoFocus=function(){window.addEventListener("load",function(){var alerts=document.querySelectorAll("[data-aria-autofocus=\"true\"][role=\"alert\"]");Array.prototype.forEach.call(alerts,function(autofocusElement){autofocusElement.innerHTML+=" ";autofocusElement.removeAttribute("data-aria-autofocus")})})},updateTabFocus=function(e){for(var tabList=e.target.closest("[role=\"tablist\"]"),vertical="vertical"==tabList.getAttribute("aria-orientation"),rtl=window.right_to_left(),arrowNext=vertical?_key_codes.arrowDown:rtl?_key_codes.arrowLeft:_key_codes.arrowRight,arrowPrevious=vertical?_key_codes.arrowUp:rtl?_key_codes.arrowRight:_key_codes.arrowLeft,tabs=Array.prototype.filter.call(tabList.querySelectorAll("[role=\"tab\"]"),function(tab){return"none"!==getComputedStyle(tab).display}),i=0;i<tabs.length;i++){tabs[i].index=i}switch(e.keyCode){case arrowNext:e.preventDefault();if(e.target.index!==void 0&&tabs[e.target.index+1]){tabs[e.target.index+1].focus()}else{tabs[0].focus()}break;case arrowPrevious:e.preventDefault();if(e.target.index!==void 0&&tabs[e.target.index-1]){tabs[e.target.index-1].focus()}else{tabs[tabs.length-1].focus()}break;case _key_codes.home:e.preventDefault();tabs[0].focus();break;case _key_codes.end:e.preventDefault();tabs[tabs.length-1].focus();break;case _key_codes.enter:case _key_codes.space:e.preventDefault();(0,_jquery.default)(e.target).tab("show");tabs.forEach(function(tab){tab.tabIndex=-1});e.target.tabIndex=0;}},tabElementFix=function(){document.addEventListener("keydown",function(e){if([_key_codes.arrowUp,_key_codes.arrowDown,_key_codes.arrowLeft,_key_codes.arrowRight,_key_codes.home,_key_codes.end,_key_codes.enter,_key_codes.space].includes(e.keyCode)){if(e.target.matches("[role=\"tablist\"] [role=\"tab\"]")){updateTabFocus(e)}}});document.addEventListener("click",function(e){if(e.target.matches("[role=\"tablist\"] [role=\"tab\"]")){var tabs=e.target.closest("[role=\"tablist\"]").querySelectorAll("[role=\"tab\"]");e.preventDefault();(0,_jquery.default)(e.target).tab("show");tabs.forEach(function(tab){tab.tabIndex=-1});e.target.tabIndex=0}})};_exports.init=function init(){dropdownFix();autoFocus();tabElementFix()}});
//# sourceMappingURL=aria.min.js.map
