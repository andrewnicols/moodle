define ("theme_boost/aria",["exports","jquery","core/pending"],function(_exports,_jquery,_pending){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.init=void 0;_jquery=_interopRequireDefault(_jquery);_pending=_interopRequireDefault(_pending);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const dropdownFix=()=>{let focusEnd=!1;const setFocusEnd=()=>{focusEnd=!0},getFocusEnd=()=>{const result=focusEnd;focusEnd=!1;return result};document.addEventListener("keydown",e=>{if(e.target.matches("[data-toggle=\"dropdown\"]")){const trigger=e.key;if("ArrowUp"==trigger){setFocusEnd()}if(" "==trigger||"Enter"==trigger){e.preventDefault();e.target.click()}}});const shiftFocus=element=>{setTimeout(pendingPromise=>{element.focus();pendingPromise.resolve()},50,new _pending.default("core/aria:delayed-focus"))};(0,_jquery.default)(".dropdown").on("shown.bs.dropdown",e=>{const menu=e.target.querySelector("[role=\"menu\"]");let menuItems=!1,foundMenuItem=!1;if(menu){menuItems=menu.querySelectorAll("[role=\"menuitem\"]")}if(menuItems&&0<menuItems.length){if(getFocusEnd()){foundMenuItem=menuItems[menuItems.length-1]}else{foundMenuItem=menuItems[0]}}if(foundMenuItem){shiftFocus(foundMenuItem)}});document.addEventListener("keypress",e=>{if(e.target.matches(".dropdown [role=\"menu\"] [role=\"menuitem\"]")){const menu=e.target.closest("[role=\"menu\"]");if(!menu){return}const menuItems=menu.querySelectorAll("[role=\"menuitem\"]");if(!menuItems){return}const trigger=e.key.toLowerCase();for(let i=0;i<menuItems.length;i++){const item=menuItems[i],itemText=item.text.trim().toLowerCase();if(0==itemText.indexOf(trigger)){shiftFocus(item);break}}}});document.addEventListener("keydown",e=>{if(e.target.matches(".dropdown [role=\"menu\"] [role=\"menuitem\"]")){const trigger=e.key;let next=!1;const menu=e.target.closest("[role=\"menu\"]");if(!menu){return}const menuItems=menu.querySelectorAll("[role=\"menuitem\"]");if(!menuItems){return}if("ArrowDown"==trigger){for(let i=0;i<menuItems.length-1;i++){if(menuItems[i]==e.target){next=menuItems[i+1];break}}if(!next){next=menuItems[0]}}else if("ArrowUp"==trigger){for(let i=1;i<menuItems.length;i++){if(menuItems[i]==e.target){next=menuItems[i-1];break}}if(!next){next=menuItems[menuItems.length-1]}}else if("Home"==trigger){next=menuItems[0]}else if("End"==trigger){next=menuItems[menuItems.length-1]}if(next){e.preventDefault();shiftFocus(next)}}});(0,_jquery.default)(".dropdown").on("hidden.bs.dropdown",e=>{const trigger=e.target.querySelector("[data-toggle=\"dropdown\"]");if(trigger){shiftFocus(trigger)}})},autoFocus=()=>{window.addEventListener("load",()=>{const alerts=document.querySelectorAll("[data-aria-autofocus=\"true\"][role=\"alert\"]");Array.prototype.forEach.call(alerts,autofocusElement=>{autofocusElement.innerHTML+=" ";autofocusElement.removeAttribute("data-aria-autofocus")})})},updateTabFocus=e=>{const tabList=e.target.closest("[role=\"tablist\"]"),vertical="vertical"==tabList.getAttribute("aria-orientation"),rtl=window.right_to_left(),arrowNext=vertical?"ArrowDown":rtl?"ArrowLeft":"ArrowRight",arrowPrevious=vertical?"ArrowUp":rtl?"ArrowRight":"ArrowLeft",tabs=Array.prototype.filter.call(tabList.querySelectorAll("[role=\"tab\"]"),tab=>"none"!==getComputedStyle(tab).display);for(let i=0;i<tabs.length;i++){tabs[i].index=i}switch(e.key){case arrowNext:e.preventDefault();if(e.target.index!==void 0&&tabs[e.target.index+1]){tabs[e.target.index+1].focus()}else{tabs[0].focus()}break;case arrowPrevious:e.preventDefault();if(e.target.index!==void 0&&tabs[e.target.index-1]){tabs[e.target.index-1].focus()}else{tabs[tabs.length-1].focus()}break;case"Home":e.preventDefault();tabs[0].focus();break;case"End":e.preventDefault();tabs[tabs.length-1].focus();break;case"Enter":case" ":e.preventDefault();(0,_jquery.default)(e.target).tab("show");tabs.forEach(tab=>{tab.tabIndex=-1});e.target.tabIndex=0;}},tabElementFix=()=>{document.addEventListener("keydown",e=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Home","End","Enter"," "].includes(e.key)){if(e.target.matches("[role=\"tablist\"] [role=\"tab\"]")){updateTabFocus(e)}}});document.addEventListener("click",e=>{if(e.target.matches("[role=\"tablist\"] [role=\"tab\"]")){const tabs=e.target.closest("[role=\"tablist\"]").querySelectorAll("[role=\"tab\"]");e.preventDefault();(0,_jquery.default)(e.target).tab("show");tabs.forEach(tab=>{tab.tabIndex=-1});e.target.tabIndex=0}})};_exports.init=()=>{dropdownFix();autoFocus();tabElementFix()}});
//# sourceMappingURL=aria.min.js.map
