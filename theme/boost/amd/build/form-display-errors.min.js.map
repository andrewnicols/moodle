{"version":3,"sources":["../src/form-display-errors.js"],"names":["define","$","FormEvent","enhance","elementid","element","document","getElementById","addEventListener","eventTypes","formFieldValidationFailed","e","msg","detail","message","preventDefault","parent","closest","feedback","find","feedbackId","attr","describedBy","describedByIds","length","split","feedbackIndex","indexOf","prop","addClass","data","push","join","html","is","show","focus","removeClass","splice","removeAttr","hide","form","dataset","visibleError","boostFormErrorsEnhanced"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Custom form error event handler to manipulate the bootstrap markup and show\n * nicely styled errors in an mform.\n *\n * @module     theme_boost/form-display-errors\n * @copyright  2016 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core_form/events'], function($, FormEvent) {\n    return {\n        /**\n         * Enhance the supplied element to handle form field errors.\n         *\n         * @method\n         * @param {String} elementid\n         * @listens event:formFieldValidationFailed\n         */\n        enhance: function(elementid) {\n            var element = document.getElementById(elementid);\n            if (!element) {\n                // Some elements (e.g. static) don't have a form field.\n                // Hence there is no validation. So, no setup required here.\n                return;\n            }\n\n            element.addEventListener(FormEvent.eventTypes.formFieldValidationFailed, e => {\n                const msg = e.detail.message;\n                e.preventDefault();\n\n                var parent = $(element).closest('.form-group');\n                var feedback = parent.find('.form-control-feedback');\n                const feedbackId = feedback.attr('id');\n\n                // Get current aria-describedby value.\n                let describedBy = $(element).attr('aria-describedby');\n                if (typeof describedBy === \"undefined\") {\n                    describedBy = '';\n                }\n                // Split aria-describedby attribute into an array of IDs if necessary.\n                let describedByIds = [];\n                if (describedBy.length) {\n                    describedByIds = describedBy.split(\" \");\n                }\n                // Find the the feedback container in the aria-describedby attribute.\n                const feedbackIndex = describedByIds.indexOf(feedbackId);\n\n                // Sometimes (atto) we have a hidden textarea backed by a real contenteditable div.\n                if (($(element).prop(\"tagName\") == 'TEXTAREA') && parent.find('[contenteditable]')) {\n                    element = parent.find('[contenteditable]');\n                }\n                if (msg !== '') {\n                    parent.addClass('has-danger');\n                    parent.data('client-validation-error', true);\n                    $(element).addClass('is-invalid');\n                    // Append the feedback ID to the aria-describedby attribute if it doesn't exist yet.\n                    if (feedbackIndex === -1) {\n                        describedByIds.push(feedbackId);\n                        $(element).attr('aria-describedby', describedByIds.join(\" \"));\n                    }\n                    $(element).attr('aria-invalid', true);\n                    feedback.attr('tabindex', 0);\n                    feedback.html(msg);\n\n                    // Only display and focus when the error was not already visible.\n                    // This is so that, when tabbing around the form, you don't get stuck.\n                    if (!feedback.is(':visible')) {\n                        feedback.show();\n                        feedback.focus();\n                    }\n\n                } else {\n                    if (parent.data('client-validation-error') === true) {\n                        parent.removeClass('has-danger');\n                        parent.data('client-validation-error', false);\n                        $(element).removeClass('is-invalid');\n                        // If the aria-describedby attribute contains the error container's ID, remove it.\n                        if (feedbackIndex > -1) {\n                            describedByIds.splice(feedbackIndex, 1);\n                        }\n                        // Check the remaining element IDs in the aria-describedby attribute.\n                        if (describedByIds.length) {\n                            // If there's at least one, combine them with a blank space and update the aria-describedby attribute.\n                            describedBy = describedByIds.join(\" \");\n                            // Put back the new describedby attribute.\n                            $(element).attr('aria-describedby', describedBy);\n                        } else {\n                            // If there's none, remove the aria-describedby attribute.\n                            $(element).removeAttr('aria-describedby');\n                        }\n                        $(element).attr('aria-invalid', false);\n                        feedback.hide();\n                    }\n                }\n            });\n\n            var form = element.closest('form');\n            if (form && !('boostFormErrorsEnhanced' in form.dataset)) {\n                form.addEventListener('submit', function() {\n                    var visibleError = $('.form-control-feedback:visible');\n                    if (visibleError.length) {\n                        visibleError[0].focus();\n                    }\n                });\n                form.dataset.boostFormErrorsEnhanced = 1;\n            }\n        }\n    };\n});\n"],"file":"form-display-errors.min.js"}