define ("enrol_manual/form-potential-user-selector",["jquery","core/ajax","core/templates","core/str"],function($,Ajax,Templates,Str){return{processResults:function processResults(selector,results){var users=[];if($.isArray(results)){$.each(results,function(index,user){users.push({value:user.id,label:user._label})});return users}else{return results}},transport:function transport(selector,query,success,failure){var promise,courseid=$(selector).attr("courseid"),userfields=$(selector).attr("userfields").split(",");if("undefined"==typeof courseid){courseid="1"}var enrolid=$(selector).attr("enrolid");if("undefined"==typeof enrolid){enrolid=""}var perpage=parseInt($(selector).attr("perpage"));if(isNaN(perpage)){perpage=100}promise=Ajax.call([{methodname:"core_enrol_get_potential_users",args:{courseid:courseid,enrolid:enrolid,search:query,searchanywhere:!0,page:0,perpage:perpage+1}}]);promise[0].then(function(results){var promises=[],i=0;if(results.length<=perpage){$.each(results,function(index,user){var ctx=user,identity=[];$.each(userfields,function(i,k){var result=/^profile_field_(.*)$/.exec(k);if(result){if(user.customfields){user.customfields.forEach(function(customfield){if(customfield.shortname===result[1]){ctx.hasidentity=!0;identity.push(customfield.value)}})}}else{if("undefined"!=typeof user[k]&&""!==user[k]){ctx.hasidentity=!0;identity.push(user[k])}}});ctx.identity=identity.join(", ");promises.push(Templates.render("enrol_manual/form-user-selector-suggestion",ctx))});return $.when.apply($.when,promises).then(function(){var args=arguments;$.each(results,function(index,user){user._label=args[i];i++});success(results)})}else{return Str.get_string("toomanyuserstoshow","core",">"+perpage).then(function(toomanyuserstoshow){success(toomanyuserstoshow)})}}).fail(failure)}}});
//# sourceMappingURL=form-potential-user-selector.min.js.map
