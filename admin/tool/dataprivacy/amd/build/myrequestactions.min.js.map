{"version":3,"file":"myrequestactions.min.js","sources":["../src/myrequestactions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module to enable users to manage their own data requests.\n *\n * @module     tool_dataprivacy/myrequestactions\n * @copyright  2018 Jun Pataleta\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport Pending from 'core/pending';\nimport {get_strings as getStrings} from 'core/str';\n\nconst SELECTORS = {\n    CANCEL_REQUEST: '[data-action=\"cancel\"][data-requestid]',\n};\n\n/**\n * Initialize module\n */\nexport const init = () => {\n    document.addEventListener('click', event => {\n        const triggerElement = event.target.closest(SELECTORS.CANCEL_REQUEST);\n        if (triggerElement === null) {\n            return;\n        }\n\n        event.preventDefault();\n\n        const requiredStrings = [\n            {key: 'cancelrequest', component: 'tool_dataprivacy'},\n            {key: 'cancelrequestconfirmation', component: 'tool_dataprivacy'},\n        ];\n\n        getStrings(requiredStrings).then(([cancelRequest, cancelConfirm]) => {\n            return Notification.confirm(cancelRequest, cancelConfirm, cancelRequest, null, () => {\n                const pendingPromise = new Pending('tool/dataprivacy:cancelRequest');\n                const request = {\n                    methodname: 'tool_dataprivacy_cancel_data_request',\n                    args: {requestid: triggerElement.dataset.requestid}\n                };\n\n                Ajax.call([request])[0].then(response => {\n                    if (response.result) {\n                        window.location.reload();\n                    } else {\n                        Notification.addNotification({\n                            type: 'error',\n                            message: response.warnings[0].message\n                        });\n                    }\n                    return pendingPromise.resolve();\n                }).catch(Notification.exception);\n            });\n        }).catch();\n    });\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","_slicedToArray","arr","i","Array","isArray","_arrayWithHoles","_i","Symbol","iterator","_s","_e","_x","_r","_arr","_n","_d","call","next","Object","done","push","value","length","err","return","_iterableToArrayLimit","o","minLen","_arrayLikeToArray","n","prototype","toString","slice","constructor","name","from","test","_unsupportedIterableToArray","TypeError","_nonIterableRest","len","arr2","_ajax","_notification","_pending","SELECTORS","_exports","init","document","addEventListener","event","triggerElement","target","closest","preventDefault","getStrings","key","component","then","_ref","_ref2","cancelRequest","cancelConfirm","Notification","confirm","pendingPromise","Pending","request","methodname","args","requestid","dataset","Ajax","response","result","window","location","reload","addNotification","type","message","warnings","resolve","catch","exception"],"mappings":"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"}