{"version":3,"sources":["../src/defaultsactions.js"],"names":["define","$","Ajax","Notification","Str","ModalFactory","ModalEvents","Templates","ACTIONS","EDIT_LEVEL_DEFAULTS","NEW_ACTIVITY_DEFAULTS","EDIT_ACTIVITY_DEFAULTS","DELETE_ACTIVITY_DEFAULTS","INHERIT","DefaultsActions","registerEvents","prototype","click","e","preventDefault","button","contextLevel","data","category","purpose","promises","call","methodname","args","titlePromise","get_string","text","when","then","categoryResponse","purposeResponse","title","categories","options","purposes","showDefaultsFormModal","catch","exception","activityResponse","activities","activity","activityDisplayName","create","body","render","type","types","SAVE_CANCEL","large","modal","setSaveButtonText","getRoot","on","save","setContextDefaults","hidden","destroy","show","categoryOptions","purposeOptions","activityOptions","forEach","currentValue","id","selected","templateContext","length","newactivitydefaults","name","modemodule","activityoptions","activityVal","val","override","overrideVal","is","done","result","window","location","reload"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for data registry defaults actions.\n *\n * @module     tool_dataprivacy/defaultsactions\n * @copyright  2018 Jun Pataleta\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'core/str',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/templates'],\nfunction($, Ajax, Notification, Str, ModalFactory, ModalEvents, Templates) {\n\n    /**\n     * List of action selectors.\n     *\n     * @type {{EDIT_LEVEL_DEFAULTS: string}}\n     * @type {{NEW_ACTIVITY_DEFAULTS: string}}\n     * @type {{EDIT_ACTIVITY_DEFAULTS: string}}\n     * @type {{DELETE_ACTIVITY_DEFAULTS: string}}\n     */\n    var ACTIONS = {\n        EDIT_LEVEL_DEFAULTS: '[data-action=\"edit-level-defaults\"]',\n        NEW_ACTIVITY_DEFAULTS: '[data-action=\"new-activity-defaults\"]',\n        EDIT_ACTIVITY_DEFAULTS: '[data-action=\"edit-activity-defaults\"]',\n        DELETE_ACTIVITY_DEFAULTS: '[data-action=\"delete-activity-defaults\"]'\n    };\n\n    /** @type {{INHERIT: Number}} **/\n    var INHERIT = -1;\n\n    /**\n     * DefaultsActions class.\n     */\n    var DefaultsActions = function() {\n        this.registerEvents();\n    };\n\n    /**\n     * Register event listeners.\n     */\n    DefaultsActions.prototype.registerEvents = function() {\n        $(ACTIONS.EDIT_LEVEL_DEFAULTS).click(function(e) {\n            e.preventDefault();\n\n            var button = $(this);\n            var contextLevel = button.data('contextlevel');\n            var category = button.data('category');\n            var purpose = button.data('purpose');\n\n            // Get options.\n            var requests = [\n                {methodname: 'tool_dataprivacy_get_category_options', args: {}},\n                {methodname: 'tool_dataprivacy_get_purpose_options', args: {}}\n            ];\n\n            var promises = Ajax.call(requests);\n            var titlePromise = Str.get_string('editdefaults', 'tool_dataprivacy', $('#defaults-header').text());\n            $.when(promises[0], promises[1], titlePromise).then(function(categoryResponse, purposeResponse, title) {\n                var categories = categoryResponse.options;\n                var purposes = purposeResponse.options;\n                showDefaultsFormModal(title, contextLevel, category, purpose, null, categories, purposes, null);\n\n                return true;\n            }).catch(Notification.exception);\n        });\n\n        $(ACTIONS.NEW_ACTIVITY_DEFAULTS).click(function(e) {\n            e.preventDefault();\n\n            var button = $(this);\n            var contextLevel = button.data('contextlevel');\n\n            // Get options.\n            var requests = [\n                {methodname: 'tool_dataprivacy_get_category_options', args: {}},\n                {methodname: 'tool_dataprivacy_get_purpose_options', args: {}},\n                {methodname: 'tool_dataprivacy_get_activity_options', args: {'nodefaults': true}}\n            ];\n\n            var promises = Ajax.call(requests);\n            var titlePromise = Str.get_string('addnewdefaults', 'tool_dataprivacy');\n\n            $.when(promises[0], promises[1], promises[2], titlePromise).then(\n                function(categoryResponse, purposeResponse, activityResponse, title) {\n                    var categories = categoryResponse.options;\n                    var purposes = purposeResponse.options;\n                    var activities = activityResponse.options;\n\n                    showDefaultsFormModal(title, contextLevel, null, null, null, categories, purposes, activities);\n\n                    return true;\n\n                }).catch(Notification.exception);\n            }\n        );\n\n        $(ACTIONS.EDIT_ACTIVITY_DEFAULTS).click(function(e) {\n            e.preventDefault();\n\n            var button = $(this);\n            var contextLevel = button.data('contextlevel');\n            var category = button.data('category');\n            var purpose = button.data('purpose');\n            var activity = button.data('activityname');\n\n            // Get options.\n            var requests = [\n                {methodname: 'tool_dataprivacy_get_category_options', args: {}},\n                {methodname: 'tool_dataprivacy_get_purpose_options', args: {}},\n                {methodname: 'tool_dataprivacy_get_activity_options', args: {}}\n            ];\n\n            var promises = Ajax.call(requests);\n            var titlePromise = Str.get_string('editmoduledefaults', 'tool_dataprivacy');\n\n            $.when(promises[0], promises[1], promises[2], titlePromise).then(\n                function(categoryResponse, purposeResponse, activityResponse, title) {\n                    var categories = categoryResponse.options;\n                    var purposes = purposeResponse.options;\n                    var activities = activityResponse.options;\n\n                    showDefaultsFormModal(title, contextLevel, category, purpose, activity, categories, purposes, activities);\n\n                    return true;\n\n                }).catch(Notification.exception);\n            }\n        );\n\n        $(ACTIONS.DELETE_ACTIVITY_DEFAULTS).click(function(e) {\n            e.preventDefault();\n\n            var button = $(this);\n            var contextLevel = button.data('contextlevel');\n            var activity = button.data('activityname');\n            var activityDisplayName = button.data('activitydisplayname');\n            // Set category and purpose to inherit (-1).\n            var category = INHERIT;\n            var purpose = INHERIT;\n\n            ModalFactory.create({\n                title: Str.get_string('deletedefaults', 'tool_dataprivacy', activityDisplayName),\n                body: Templates.render('tool_dataprivacy/delete_activity_defaults', {\"activityname\": activityDisplayName}),\n                type: ModalFactory.types.SAVE_CANCEL,\n                large: true\n            }).then(function(modal) {\n                modal.setSaveButtonText(Str.get_string('delete'));\n\n                // Handle save event.\n                modal.getRoot().on(ModalEvents.save, function() {\n                    setContextDefaults(contextLevel, category, purpose, activity, false);\n                });\n\n                // Handle hidden event.\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    // Destroy when hidden.\n                    modal.destroy();\n                });\n\n                modal.show();\n\n                return true;\n            }).catch(Notification.exception);\n        });\n    };\n\n    /**\n     * Prepares and renders the modal for setting the defaults for the given context level/plugin.\n     *\n     * @param {String} title The modal's title.\n     * @param {Number} contextLevel The context level to set defaults for.\n     * @param {Number} category The current category ID.\n     * @param {Number} purpose The current purpose ID.\n     * @param {String} activity The plugin name of the activity. Optional.\n     * @param {Array} categoryOptions The list of category options.\n     * @param {Array} purposeOptions The list of purpose options.\n     * @param {Array} activityOptions The list of activity options. Optional.\n     */\n    function showDefaultsFormModal(title, contextLevel, category, purpose, activity,\n                                   categoryOptions, purposeOptions, activityOptions) {\n\n        if (category !== null) {\n            categoryOptions.forEach(function(currentValue) {\n                if (currentValue.id === category) {\n                    currentValue.selected = true;\n                }\n            });\n        }\n\n        if (purpose !== null) {\n            purposeOptions.forEach(function(currentValue) {\n                if (currentValue.id === purpose) {\n                    currentValue.selected = true;\n                }\n            });\n        }\n\n        var templateContext = {\n            \"contextlevel\": contextLevel,\n            \"categoryoptions\": categoryOptions,\n            \"purposeoptions\": purposeOptions\n        };\n\n        // Check the activityOptions parameter that was passed.\n        if (activityOptions !== null && activityOptions.length) {\n            // Check the activity parameter that was passed.\n            if (activity === null) {\n                // We're setting a new defaults for a module.\n                templateContext.newactivitydefaults = true;\n\n            } else {\n                // Edit mode. Set selection.\n                activityOptions.forEach(function(currentValue) {\n                    if (activity === currentValue.name) {\n                        currentValue.selected = true;\n                    }\n                });\n            }\n\n            templateContext.modemodule = true;\n            templateContext.activityoptions = activityOptions;\n        }\n\n        ModalFactory.create({\n            title: title,\n            body: Templates.render('tool_dataprivacy/category_purpose_form', templateContext),\n            type: ModalFactory.types.SAVE_CANCEL,\n            large: true\n        }).then(function(modal) {\n\n            // Handle save event.\n            modal.getRoot().on(ModalEvents.save, function() {\n                var activity = $('#activity');\n                var activityVal = typeof activity !== 'undefined' ? activity.val() : null;\n                var override = $('#override');\n                var overrideVal = typeof override !== 'undefined' ? override.is(':checked') : false;\n\n                setContextDefaults($('#contextlevel').val(), $('#category').val(), $('#purpose').val(), activityVal, overrideVal);\n            });\n\n            // Handle hidden event.\n            modal.getRoot().on(ModalEvents.hidden, function() {\n                // Destroy when hidden.\n                modal.destroy();\n            });\n\n            modal.show();\n\n            return modal;\n        }).catch(Notification.exception);\n    }\n\n    /**\n     * Calls a the tool_dataprivacy_set_context_defaults WS function.\n     *\n     * @param {Number} contextLevel The context level.\n     * @param {Number} category The category ID.\n     * @param {Number} purpose The purpose ID.\n     * @param {String} activity The plugin name of the activity module.\n     * @param {Boolean} override Whether to override custom instances.\n     */\n    function setContextDefaults(contextLevel, category, purpose, activity, override) {\n        var request = {\n            methodname: 'tool_dataprivacy_set_context_defaults',\n            args: {\n                'contextlevel': contextLevel,\n                'category': category,\n                'purpose': purpose,\n                'override': override,\n                'activity': activity\n            }\n        };\n\n        Ajax.call([request])[0].done(function(data) {\n            if (data.result) {\n                window.location.reload();\n            }\n        });\n    }\n\n    return /** @alias module:tool_dataprivacy/defaultsactions */ {\n        // Public variables and functions.\n\n        /**\n         * Initialise the module.\n         *\n         * @method init\n         * @return {DefaultsActions}\n         */\n        'init': function() {\n            return new DefaultsActions();\n        }\n    };\n});\n"],"file":"defaultsactions.min.js"}