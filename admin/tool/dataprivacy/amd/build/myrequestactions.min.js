define ("tool_dataprivacy/myrequestactions",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","core/templates","core/pending"],function($,Ajax,Notification,Str,ModalFactory,ModalEvents,Templates,Pending){var ACTIONS={CANCEL_REQUEST:"[data-action=\"cancel\"]",CONTACT_DPO:"[data-action=\"contactdpo\"]"},MyRequestActions=function(){this.registerEvents()};MyRequestActions.prototype.registerEvents=function(){$(ACTIONS.CANCEL_REQUEST).click(function(e){e.preventDefault();var requestId=$(this).data("requestid");Str.get_strings([{key:"cancelrequest",component:"tool_dataprivacy"},{key:"cancelrequestconfirmation",component:"tool_dataprivacy"}]).then(function(langStrings){var title=langStrings[0],confirmMessage=langStrings[1];return ModalFactory.create({title:title,body:confirmMessage,type:ModalFactory.types.SAVE_CANCEL}).then(function(modal){modal.setSaveButtonText(title);modal.getRoot().on(ModalEvents.save,function(){Ajax.call([{methodname:"tool_dataprivacy_cancel_data_request",args:{requestid:requestId}}])[0].done(function(data){if(data.result){window.location.reload()}else{Notification.addNotification({message:data.warnings[0].message,type:"error"})}}).fail(Notification.exception)});modal.getRoot().on(ModalEvents.hidden,function(){modal.destroy()});return modal})}).done(function(modal){modal.show()}).fail(Notification.exception)});$(ACTIONS.CONTACT_DPO).click(function(e){var pendingPromise=new Pending("dataprivacy/crud:initModal:contactdpo");e.preventDefault();var replyToEmail=$(this).data("replytoemail"),sendButtonText="";Str.get_strings([{key:"contactdataprotectionofficer",component:"tool_dataprivacy"},{key:"send",component:"tool_dataprivacy"}]).then(function(langStrings){var modalTitle=langStrings[0];sendButtonText=langStrings[1];return ModalFactory.create({title:modalTitle,body:Templates.render("tool_dataprivacy/contact_dpo",{replytoemail:replyToEmail}),type:ModalFactory.types.SAVE_CANCEL,large:!0})}).then(function(modal){modal.setSaveButtonText(sendButtonText);modal.show();modal.getRoot().on(ModalEvents.save,function(e){var message=$("#message").val().trim();if(0===message.length){e.preventDefault();$("[data-region=\"messageinput\"]").addClass("has-danger notifyproblem");$("#id_error_message").removeAttr("hidden")}else{sendMessageToDPO(message)}});modal.getRoot().on(ModalEvents.hidden,function(){modal.destroy()})}).then(pendingPromise.resolve).catch(Notification.exception)})};function sendMessageToDPO(message){var requestType="success";Ajax.call([{methodname:"tool_dataprivacy_contact_dpo",args:{message:message}}])[0].then(function(data){if(data.result){return Str.get_string("requestsubmitted","tool_dataprivacy")}requestType="error";return data.warnings.join("<br>")}).done(function(message){Notification.addNotification({message:message,type:requestType})}).fail(Notification.exception)}return{init:function init(){return new MyRequestActions}}});
//# sourceMappingURL=myrequestactions.min.js.map
