define ("tool_dataprivacy/defaultsactions",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","core/templates"],function($,Ajax,Notification,Str,ModalFactory,ModalEvents,Templates){var ACTIONS={EDIT_LEVEL_DEFAULTS:"[data-action=\"edit-level-defaults\"]",NEW_ACTIVITY_DEFAULTS:"[data-action=\"new-activity-defaults\"]",EDIT_ACTIVITY_DEFAULTS:"[data-action=\"edit-activity-defaults\"]",DELETE_ACTIVITY_DEFAULTS:"[data-action=\"delete-activity-defaults\"]"},INHERIT=-1,DefaultsActions=function(){this.registerEvents()};DefaultsActions.prototype.registerEvents=function(){$(ACTIONS.EDIT_LEVEL_DEFAULTS).click(function(e){e.preventDefault();var button=$(this),contextLevel=button.data("contextlevel"),category=button.data("category"),purpose=button.data("purpose"),promises=Ajax.call([{methodname:"tool_dataprivacy_get_category_options",args:{}},{methodname:"tool_dataprivacy_get_purpose_options",args:{}}]),titlePromise=Str.get_string("editdefaults","tool_dataprivacy",$("#defaults-header").text());$.when(promises[0],promises[1],titlePromise).then(function(categoryResponse,purposeResponse,title){var categories=categoryResponse.options,purposes=purposeResponse.options;showDefaultsFormModal(title,contextLevel,category,purpose,null,categories,purposes,null);return!0}).catch(Notification.exception)});$(ACTIONS.NEW_ACTIVITY_DEFAULTS).click(function(e){e.preventDefault();var button=$(this),contextLevel=button.data("contextlevel"),promises=Ajax.call([{methodname:"tool_dataprivacy_get_category_options",args:{}},{methodname:"tool_dataprivacy_get_purpose_options",args:{}},{methodname:"tool_dataprivacy_get_activity_options",args:{nodefaults:!0}}]),titlePromise=Str.get_string("addnewdefaults","tool_dataprivacy");$.when(promises[0],promises[1],promises[2],titlePromise).then(function(categoryResponse,purposeResponse,activityResponse,title){var categories=categoryResponse.options,purposes=purposeResponse.options,activities=activityResponse.options;showDefaultsFormModal(title,contextLevel,null,null,null,categories,purposes,activities);return!0}).catch(Notification.exception)});$(ACTIONS.EDIT_ACTIVITY_DEFAULTS).click(function(e){e.preventDefault();var button=$(this),contextLevel=button.data("contextlevel"),category=button.data("category"),purpose=button.data("purpose"),activity=button.data("activityname"),promises=Ajax.call([{methodname:"tool_dataprivacy_get_category_options",args:{}},{methodname:"tool_dataprivacy_get_purpose_options",args:{}},{methodname:"tool_dataprivacy_get_activity_options",args:{}}]),titlePromise=Str.get_string("editmoduledefaults","tool_dataprivacy");$.when(promises[0],promises[1],promises[2],titlePromise).then(function(categoryResponse,purposeResponse,activityResponse,title){var categories=categoryResponse.options,purposes=purposeResponse.options,activities=activityResponse.options;showDefaultsFormModal(title,contextLevel,category,purpose,activity,categories,purposes,activities);return!0}).catch(Notification.exception)});$(ACTIONS.DELETE_ACTIVITY_DEFAULTS).click(function(e){e.preventDefault();var button=$(this),contextLevel=button.data("contextlevel"),activity=button.data("activityname"),activityDisplayName=button.data("activitydisplayname");ModalFactory.create({title:Str.get_string("deletedefaults","tool_dataprivacy",activityDisplayName),body:Templates.render("tool_dataprivacy/delete_activity_defaults",{activityname:activityDisplayName}),type:ModalFactory.types.SAVE_CANCEL,large:!0}).then(function(modal){modal.setSaveButtonText(Str.get_string("delete"));modal.getRoot().on(ModalEvents.save,function(){setContextDefaults(contextLevel,INHERIT,INHERIT,activity,!1)});modal.getRoot().on(ModalEvents.hidden,function(){modal.destroy()});modal.show();return!0}).catch(Notification.exception)})};function showDefaultsFormModal(title,contextLevel,category,purpose,activity,categoryOptions,purposeOptions,activityOptions){if(null!==category){categoryOptions.forEach(function(currentValue){if(currentValue.id===category){currentValue.selected=!0}})}if(null!==purpose){purposeOptions.forEach(function(currentValue){if(currentValue.id===purpose){currentValue.selected=!0}})}var templateContext={contextlevel:contextLevel,categoryoptions:categoryOptions,purposeoptions:purposeOptions};if(null!==activityOptions&&activityOptions.length){if(null===activity){templateContext.newactivitydefaults=!0}else{activityOptions.forEach(function(currentValue){if(activity===currentValue.name){currentValue.selected=!0}})}templateContext.modemodule=!0;templateContext.activityoptions=activityOptions}ModalFactory.create({title:title,body:Templates.render("tool_dataprivacy/category_purpose_form",templateContext),type:ModalFactory.types.SAVE_CANCEL,large:!0}).then(function(modal){modal.getRoot().on(ModalEvents.save,function(){var activity=$("#activity"),activityVal="undefined"!=typeof activity?activity.val():null,override=$("#override"),overrideVal="undefined"!=typeof override?override.is(":checked"):!1;setContextDefaults($("#contextlevel").val(),$("#category").val(),$("#purpose").val(),activityVal,overrideVal)});modal.getRoot().on(ModalEvents.hidden,function(){modal.destroy()});modal.show();return modal}).catch(Notification.exception)}function setContextDefaults(contextLevel,category,purpose,activity,override){Ajax.call([{methodname:"tool_dataprivacy_set_context_defaults",args:{contextlevel:contextLevel,category:category,purpose:purpose,override:override,activity:activity}}])[0].done(function(data){if(data.result){window.location.reload()}})}return{init:function(){return new DefaultsActions}}});
//# sourceMappingURL=defaultsactions.min.js.map
