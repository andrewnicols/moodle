{"version":3,"sources":["../src/data_deletion.js"],"names":["define","$","Ajax","Notification","Str","ModalFactory","ModalEvents","ACTIONS","MARK_FOR_DELETION","SELECT_ALL","SELECTORS","SELECTCONTEXT","DataDeletionActions","registerEvents","prototype","click","e","preventDefault","selectedIds","each","checkbox","is","push","val","showConfirmation","change","selectallnone","attr","removeAttr","ids","modalTitle","get_strings","key","component","then","langStrings","confirmMessage","create","title","body","type","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","on","save","call","methodname","args","done","data","result","window","location","reload","addNotification","message","warnings","fail","exception","hidden","destroy","show"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Request actions.\n *\n * @module     tool_dataprivacy/data_deletion\n * @package    tool_dataprivacy\n * @copyright  2018 Jun Pataleta\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'core/str',\n    'core/modal_factory',\n    'core/modal_events'],\nfunction($, Ajax, Notification, Str, ModalFactory, ModalEvents) {\n\n    /**\n     * List of action selectors.\n     *\n     * @type {{MARK_FOR_DELETION: string}}\n     * @type {{SELECT_ALL: string}}\n     */\n    var ACTIONS = {\n        MARK_FOR_DELETION: '[data-action=\"markfordeletion\"]',\n        SELECT_ALL: '[data-action=\"selectall\"]',\n    };\n\n    /**\n     * List of selectors.\n     *\n     * @type {{SELECTCONTEXT: string}}\n     */\n    var SELECTORS = {\n        SELECTCONTEXT: '.selectcontext',\n    };\n\n    /**\n     * DataDeletionActions class.\n     */\n    var DataDeletionActions = function() {\n        this.registerEvents();\n    };\n\n    /**\n     * Register event listeners.\n     */\n    DataDeletionActions.prototype.registerEvents = function() {\n        $(ACTIONS.MARK_FOR_DELETION).click(function(e) {\n            e.preventDefault();\n\n            var selectedIds = [];\n            $(SELECTORS.SELECTCONTEXT).each(function() {\n                var checkbox = $(this);\n                if (checkbox.is(':checked')) {\n                    selectedIds.push(checkbox.val());\n                }\n            });\n            showConfirmation(selectedIds);\n        });\n\n        $(ACTIONS.SELECT_ALL).change(function(e) {\n            e.preventDefault();\n\n            var selectallnone = $(this);\n            if (selectallnone.is(':checked')) {\n                $(SELECTORS.SELECTCONTEXT).attr('checked', 'checked');\n            } else {\n                $(SELECTORS.SELECTCONTEXT).removeAttr('checked');\n            }\n        });\n    };\n\n    /**\n     * Show the confirmation dialogue.\n     *\n     * @param {Array} ids The array of expired context record IDs.\n     */\n    function showConfirmation(ids) {\n        var keys = [\n            {\n                key: 'confirm',\n                component: 'moodle'\n            },\n            {\n                key: 'confirmcontextdeletion',\n                component: 'tool_dataprivacy'\n            }\n        ];\n        var wsfunction = 'tool_dataprivacy_confirm_contexts_for_deletion';\n\n        var modalTitle = '';\n        Str.get_strings(keys).then(function(langStrings) {\n            modalTitle = langStrings[0];\n            var confirmMessage = langStrings[1];\n            return ModalFactory.create({\n                title: modalTitle,\n                body: confirmMessage,\n                type: ModalFactory.types.SAVE_CANCEL\n            });\n        }).then(function(modal) {\n            modal.setSaveButtonText(modalTitle);\n\n            // Handle save event.\n            modal.getRoot().on(ModalEvents.save, function() {\n                // Confirm the request.\n                var params = {\n                    'ids': ids\n                };\n\n                var request = {\n                    methodname: wsfunction,\n                    args: params\n                };\n\n                Ajax.call([request])[0].done(function(data) {\n                    if (data.result) {\n                        window.location.reload();\n                    } else {\n                        Notification.addNotification({\n                            message: data.warnings[0].message,\n                            type: 'error'\n                        });\n                    }\n                }).fail(Notification.exception);\n            });\n\n            // Handle hidden event.\n            modal.getRoot().on(ModalEvents.hidden, function() {\n                // Destroy when hidden.\n                modal.destroy();\n            });\n\n            return modal;\n        }).done(function(modal) {\n            modal.show();\n        }).fail(Notification.exception);\n    }\n\n    return DataDeletionActions;\n});\n"],"file":"data_deletion.min.js"}