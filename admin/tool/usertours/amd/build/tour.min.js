define ("tool_usertours/tour",["exports","jquery","core/aria","core/popper"],function(_exports,_jquery,Aria,_popper){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.default=void 0;_jquery=_interopRequireDefault(_jquery);Aria=_interopRequireWildcard(Aria);_popper=_interopRequireDefault(_popper);function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj}if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj){return{default:obj}}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if("default"!=key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj.default=obj;if(cache){cache.set(obj,newObj)}return newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0,descriptor;i<props.length;i++){descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value"in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:!1});return Constructor}var Tour=function(){function Tour(config){_classCallCheck(this,Tour);this.init(config)}_createClass(Tour,[{key:"init",value:function init(config){this.eventHandlers={};this.reset();this.originalConfiguration=config||{};this.configure.apply(this,arguments);try{this.storage=window.sessionStorage;this.storageKey="tourstate_"+this.tourName}catch(e){this.storage=!1;this.storageKey=""}return this}},{key:"reset",value:function reset(){this.hide();this.eventHandlers=[];this.resetStepListeners();this.originalConfiguration={};this.steps=[];this.currentStepNumber=0;return this}},{key:"configure",value:function configure(config){var _this=this;if("object"===_typeof(config)){if("undefined"!=typeof config.tourName){this.tourName=config.tourName}if(config.eventHandlers){var _loop=function(eventName){config.eventHandlers[eventName].forEach(function(handler){this.addEventHandler(eventName,handler)},_this)};for(var eventName in config.eventHandlers){_loop(eventName)}}this.resetStepDefaults(!0);if("object"===_typeof(config.steps)){this.steps=config.steps}if("undefined"!=typeof config.template){this.templateContent=config.template}}this.checkMinimumRequirements();return this}},{key:"checkMinimumRequirements",value:function checkMinimumRequirements(){if(!this.tourName){throw new Error("Tour Name required")}if(!this.steps||!this.steps.length){throw new Error("Steps must be specified")}}},{key:"resetStepDefaults",value:function resetStepDefaults(loadOriginalConfiguration){if("undefined"==typeof loadOriginalConfiguration){loadOriginalConfiguration=!0}this.stepDefaults={};if(!loadOriginalConfiguration||"undefined"==typeof this.originalConfiguration.stepDefaults){this.setStepDefaults({})}else{this.setStepDefaults(this.originalConfiguration.stepDefaults)}return this}},{key:"setStepDefaults",value:function setStepDefaults(stepDefaults){if(!this.stepDefaults){this.stepDefaults={}}_jquery.default.extend(this.stepDefaults,{element:"",placement:"top",delay:0,moveOnClick:!1,moveAfterTime:0,orphan:!1,direction:1},stepDefaults);return this}},{key:"getCurrentStepNumber",value:function getCurrentStepNumber(){return parseInt(this.currentStepNumber,10)}},{key:"setCurrentStepNumber",value:function setCurrentStepNumber(stepNumber){this.currentStepNumber=stepNumber;if(this.storage){try{this.storage.setItem(this.storageKey,stepNumber)}catch(e){if(e.code===DOMException.QUOTA_EXCEEDED_ERR){this.storage.removeItem(this.storageKey)}}}}},{key:"getNextStepNumber",value:function getNextStepNumber(stepNumber){if("undefined"==typeof stepNumber){stepNumber=this.getCurrentStepNumber()}var nextStepNumber=stepNumber+1;while(nextStepNumber<=this.steps.length){if(this.isStepPotentiallyVisible(this.getStepConfig(nextStepNumber))){return nextStepNumber}nextStepNumber++}return null}},{key:"getPreviousStepNumber",value:function getPreviousStepNumber(stepNumber){if("undefined"==typeof stepNumber){stepNumber=this.getCurrentStepNumber()}var previousStepNumber=stepNumber-1;while(0<=previousStepNumber){if(this.isStepPotentiallyVisible(this.getStepConfig(previousStepNumber))){return previousStepNumber}previousStepNumber--}return null}},{key:"isLastStep",value:function isLastStep(stepNumber){var nextStepNumber=this.getNextStepNumber(stepNumber);return null===nextStepNumber}},{key:"isFirstStep",value:function isFirstStep(stepNumber){var previousStepNumber=this.getPreviousStepNumber(stepNumber);return null===previousStepNumber}},{key:"isStepPotentiallyVisible",value:function isStepPotentiallyVisible(stepConfig){if(!stepConfig){return!1}if(this.isStepActuallyVisible(stepConfig)){return!0}if("undefined"!=typeof stepConfig.orphan&&stepConfig.orphan){return!0}if("undefined"!=typeof stepConfig.delay&&stepConfig.delay){return!0}return!1}},{key:"isStepActuallyVisible",value:function isStepActuallyVisible(stepConfig){if(!stepConfig){return!1}var target=this.getStepTarget(stepConfig);if(target&&target.length&&target.is(":visible")){return!!target.length}return!1}},{key:"next",value:function next(){return this.gotoStep(this.getNextStepNumber())}},{key:"previous",value:function previous(){return this.gotoStep(this.getPreviousStepNumber(),-1)}},{key:"gotoStep",value:function gotoStep(stepNumber,direction){if(0>stepNumber){return this.endTour()}var stepConfig=this.getStepConfig(stepNumber);if(null===stepConfig){return this.endTour()}return this._gotoStep(stepConfig,direction)}},{key:"_gotoStep",value:function _gotoStep(stepConfig,direction){if(!stepConfig){return this.endTour()}if("undefined"!=typeof stepConfig.delay&&stepConfig.delay&&!stepConfig.delayed){stepConfig.delayed=!0;window.setTimeout(this._gotoStep.bind(this),stepConfig.delay,stepConfig,direction);return this}else if(!stepConfig.orphan&&!this.isStepActuallyVisible(stepConfig)){var fn=-1==direction?"getPreviousStepNumber":"getNextStepNumber";return this.gotoStep(this[fn](stepConfig.stepNumber),direction)}this.hide();this.fireEventHandlers("beforeRender",stepConfig);this.renderStep(stepConfig);this.fireEventHandlers("afterRender",stepConfig);return this}},{key:"getStepConfig",value:function getStepConfig(stepNumber){if(null===stepNumber||0>stepNumber||stepNumber>=this.steps.length){return null}var stepConfig=this.normalizeStepConfig(this.steps[stepNumber]);stepConfig=_jquery.default.extend(stepConfig,{stepNumber:stepNumber});return stepConfig}},{key:"normalizeStepConfig",value:function normalizeStepConfig(stepConfig){if("undefined"!=typeof stepConfig.reflex&&"undefined"==typeof stepConfig.moveAfterClick){stepConfig.moveAfterClick=stepConfig.reflex}if("undefined"!=typeof stepConfig.element&&"undefined"==typeof stepConfig.target){stepConfig.target=stepConfig.element}if("undefined"!=typeof stepConfig.content&&"undefined"==typeof stepConfig.body){stepConfig.body=stepConfig.content}stepConfig=_jquery.default.extend({},this.stepDefaults,stepConfig);stepConfig=_jquery.default.extend({},{attachTo:stepConfig.target,attachPoint:"after"},stepConfig);if(stepConfig.attachTo){stepConfig.attachTo=(0,_jquery.default)(stepConfig.attachTo).first()}return stepConfig}},{key:"getStepTarget",value:function getStepTarget(stepConfig){if(stepConfig.target){return(0,_jquery.default)(stepConfig.target)}return null}},{key:"fireEventHandlers",value:function fireEventHandlers(eventName,data){if("undefined"==typeof this.eventHandlers[eventName]){return this}this.eventHandlers[eventName].forEach(function(thisEvent){thisEvent.call(this,data)},this);return this}},{key:"addEventHandler",value:function addEventHandler(eventName,handler){if("undefined"==typeof this.eventHandlers[eventName]){this.eventHandlers[eventName]=[]}this.eventHandlers[eventName].push(handler);return this}},{key:"processStepListeners",value:function processStepListeners(stepConfig){this.listeners.push({node:this.currentStepNode,args:["click","[data-role=\"next\"]",_jquery.default.proxy(this.next,this)]},{node:this.currentStepNode,args:["click","[data-role=\"previous\"]",_jquery.default.proxy(this.previous,this)]},{node:this.currentStepNode,args:["click","[data-role=\"end\"]",_jquery.default.proxy(this.endTour,this)]},{node:(0,_jquery.default)("[data-flexitour=\"backdrop\"]"),args:["click",_jquery.default.proxy(this.hide,this)]},{node:(0,_jquery.default)("body"),args:["keydown",_jquery.default.proxy(this.handleKeyDown,this)]});if(stepConfig.moveOnClick){var targetNode=this.getStepTarget(stepConfig);this.listeners.push({node:targetNode,args:["click",_jquery.default.proxy(function(e){if(0===(0,_jquery.default)(e.target).parents("[data-flexitour=\"container\"]").length){window.setTimeout(_jquery.default.proxy(this.next,this),500)}},this)]})}this.listeners.forEach(function(listener){listener.node.on.apply(listener.node,listener.args)});return this}},{key:"resetStepListeners",value:function resetStepListeners(){if(this.listeners){this.listeners.forEach(function(listener){listener.node.off.apply(listener.node,listener.args)})}this.listeners=[];return this}},{key:"renderStep",value:function renderStep(stepConfig){this.currentStepConfig=stepConfig;this.setCurrentStepNumber(stepConfig.stepNumber);var template=(0,_jquery.default)(this.getTemplateContent());template.find("[data-placeholder=\"title\"]").html(stepConfig.title);template.find("[data-placeholder=\"body\"]").html(stepConfig.body);if(this.isFirstStep(stepConfig.stepNumber)){template.find("[data-role=\"previous\"]").hide()}else{template.find("[data-role=\"previous\"]").prop("disabled",!1)}if(this.isLastStep(stepConfig.stepNumber)){template.find("[data-role=\"next\"]").hide();template.find("[data-role=\"end\"]").removeClass("btn-secondary").addClass("btn-primary")}else{template.find("[data-role=\"next\"]").prop("disabled",!1)}template.find("[data-role=\"previous\"]").attr("role","button");template.find("[data-role=\"next\"]").attr("role","button");template.find("[data-role=\"end\"]").attr("role","button");stepConfig.template=template;this.addStepToPage(stepConfig);this.processStepListeners(stepConfig);return this}},{key:"getTemplateContent",value:function getTemplateContent(){return(0,_jquery.default)(this.templateContent).clone()}},{key:"addStepToPage",value:function addStepToPage(stepConfig){var currentStepNode=(0,_jquery.default)("<span data-flexitour=\"container\"></span>").html(stepConfig.template).hide(),animationTarget=(0,_jquery.default)("body, html").stop(!0,!0);if(this.isStepActuallyVisible(stepConfig)){var targetNode=this.getStepTarget(stepConfig);targetNode.data("flexitour","target");var zIndex=this.calculateZIndex(targetNode);if(zIndex){stepConfig.zIndex=zIndex+1}if(stepConfig.zIndex){currentStepNode.css("zIndex",stepConfig.zIndex+1)}this.positionBackdrop(stepConfig);(0,_jquery.default)(document.body).append(currentStepNode);this.currentStepNode=currentStepNode;this.currentStepNode.css({top:0,left:0});animationTarget.animate({scrollTop:this.calculateScrollTop(stepConfig)}).promise().then(function(){this.positionStep(stepConfig);this.revealStep(stepConfig)}.bind(this)).catch(function(){})}else if(stepConfig.orphan){stepConfig.isOrphan=!0;stepConfig.attachTo=(0,_jquery.default)("body").first();stepConfig.attachPoint="append";this.positionBackdrop(stepConfig);currentStepNode.addClass("orphan");(0,_jquery.default)(document.body).append(currentStepNode);this.currentStepNode=currentStepNode;this.currentStepNode.offset(this.calculateStepPositionInPage());this.currentStepNode.css("position","fixed");this.currentStepPopper=new _popper.default((0,_jquery.default)("body"),this.currentStepNode[0],{removeOnDestroy:!0,placement:stepConfig.placement+"-start",arrowElement:"[data-role=\"arrow\"]",modifiers:{hide:{enabled:!1},applyStyle:{onLoad:null,enabled:!1}}});this.revealStep(stepConfig)}return this}},{key:"revealStep",value:function revealStep(stepConfig){this.currentStepNode.fadeIn("",_jquery.default.proxy(function(){this.announceStep(stepConfig);this.currentStepNode.focus();window.setTimeout(_jquery.default.proxy(function(){if(this.currentStepNode){this.currentStepNode.focus()}},this),100)},this));return this}},{key:"announceStep",value:function announceStep(stepConfig){var stepId="tour-step-"+this.tourName+"-"+stepConfig.stepNumber;this.currentStepNode.attr("id",stepId);var bodyRegion=this.currentStepNode.find("[data-placeholder=\"body\"]").first();bodyRegion.attr("id",stepId+"-body");bodyRegion.attr("role","document");var headerRegion=this.currentStepNode.find("[data-placeholder=\"title\"]").first();headerRegion.attr("id",stepId+"-title");headerRegion.attr("aria-labelledby",stepId+"-body");this.currentStepNode.attr("role","dialog");this.currentStepNode.attr("tabindex",0);this.currentStepNode.attr("aria-labelledby",stepId+"-title");this.currentStepNode.attr("aria-describedby",stepId+"-body");var target=this.getStepTarget(stepConfig);if(target){if(!target.attr("tabindex")){target.attr("tabindex",0)}target.data("original-describedby",target.attr("aria-describedby")).attr("aria-describedby",stepId+"-body")}this.accessibilityShow(stepConfig);return this}},{key:"handleKeyDown",value:function handleKeyDown(e){var tabbableSelector="a[href], link[href], [draggable=true], [contenteditable=true], ";tabbableSelector+=":input:enabled, [tabindex], button:enabled";switch(e.keyCode){case 27:this.endTour();break;case 9:(function(){if(!this.currentStepConfig.hasBackdrop){return}var activeElement=(0,_jquery.default)(document.activeElement),stepTarget=this.getStepTarget(this.currentStepConfig),tabbableNodes=(0,_jquery.default)(tabbableSelector),dialogContainer=(0,_jquery.default)("span[data-flexitour=\"container\"]"),currentIndex;if(stepTarget){tabbableNodes=tabbableNodes.filter(function(index,element){return null!==stepTarget&&(stepTarget.has(element).length||dialogContainer.has(element).length||stepTarget.is(element)||dialogContainer.is(element))})}tabbableNodes.each(function(index,element){if(activeElement.is(element)){currentIndex=index;return!1}return!0});var nextIndex,nextNode,focusRelevant;if(void 0!=currentIndex){var direction=1;if(e.shiftKey){direction=-1}nextIndex=currentIndex;do{nextIndex+=direction;nextNode=(0,_jquery.default)(tabbableNodes[nextIndex])}while(nextNode.length&&nextNode.is(":disabled")||nextNode.is(":hidden"));if(nextNode.length){focusRelevant=nextNode.closest(stepTarget).length;focusRelevant=focusRelevant||nextNode.closest(this.currentStepNode).length}else{focusRelevant=!1}}if(focusRelevant){nextNode.focus()}else{if(e.shiftKey){this.currentStepNode.find(tabbableSelector).last().focus()}else{if(this.currentStepConfig.isOrphan){this.currentStepNode.focus()}else{stepTarget.focus()}}}e.preventDefault()}).call(this);break;}}},{key:"startTour",value:function startTour(startAt){if(this.storage&&"undefined"==typeof startAt){var storageStartValue=this.storage.getItem(this.storageKey);if(storageStartValue){var storageStartAt=parseInt(storageStartValue,10);if(storageStartAt<=this.steps.length){startAt=storageStartAt}}}if("undefined"==typeof startAt){startAt=this.getCurrentStepNumber()}this.fireEventHandlers("beforeStart",startAt);this.gotoStep(startAt);this.fireEventHandlers("afterStart",startAt);return this}},{key:"restartTour",value:function restartTour(){return this.startTour(0)}},{key:"endTour",value:function endTour(){this.fireEventHandlers("beforeEnd");if(this.currentStepConfig){var previousTarget=this.getStepTarget(this.currentStepConfig);if(previousTarget){if(!previousTarget.attr("tabindex")){previousTarget.attr("tabindex","-1")}previousTarget.focus()}}this.hide(!0);this.fireEventHandlers("afterEnd");return this}},{key:"hide",value:function hide(transition){this.fireEventHandlers("beforeHide");if(this.currentStepNode&&this.currentStepNode.length){this.currentStepNode.hide();if(this.currentStepPopper){this.currentStepPopper.destroy()}}if(this.currentStepConfig){var target=this.getStepTarget(this.currentStepConfig);if(target){if(target.data("original-labelledby")){target.attr("aria-labelledby",target.data("original-labelledby"))}if(target.data("original-describedby")){target.attr("aria-describedby",target.data("original-describedby"))}if(target.data("original-tabindex")){target.attr("tabindex",target.data("tabindex"))}}this.currentStepConfig=null}var fadeTime=0;if(transition){fadeTime=400}(0,_jquery.default)("[data-flexitour=\"step-background\"]").remove();(0,_jquery.default)("[data-flexitour=\"step-backdrop\"]").removeAttr("data-flexitour");(0,_jquery.default)("[data-flexitour=\"backdrop\"]").fadeOut(fadeTime,function(){(0,_jquery.default)(this).remove()});if(this.currentStepNode&&this.currentStepNode.length){var stepId=this.currentStepNode.attr("id");if(stepId){var currentStepElement="[aria-describedby=\""+stepId+"-body\"]";(0,_jquery.default)(currentStepElement).removeAttr("tabindex");(0,_jquery.default)(currentStepElement).removeAttr("aria-describedby")}}this.resetStepListeners();this.accessibilityHide();this.fireEventHandlers("afterHide");this.currentStepNode=null;this.currentStepPopper=null;return this}},{key:"show",value:function show(){var startAt=this.getCurrentStepNumber();return this.gotoStep(startAt)}},{key:"getStepContainer",value:function getStepContainer(){return(0,_jquery.default)(this.currentStepNode)}},{key:"calculateScrollTop",value:function calculateScrollTop(stepConfig){var scrollTop=(0,_jquery.default)(window).scrollTop(),viewportHeight=(0,_jquery.default)(window).height(),targetNode=this.getStepTarget(stepConfig);if("top"===stepConfig.placement){scrollTop=targetNode.offset().top-viewportHeight/2}else if("bottom"===stepConfig.placement){scrollTop=targetNode.offset().top+targetNode.height()-viewportHeight/2}else if(targetNode.height()<=.8*viewportHeight){scrollTop=targetNode.offset().top-(viewportHeight-targetNode.height())/2}else{scrollTop=targetNode.offset().top-.2*viewportHeight}scrollTop=Math.max(0,scrollTop);scrollTop=Math.min((0,_jquery.default)(document).height()-viewportHeight,scrollTop);return Math.ceil(scrollTop)}},{key:"calculateStepPositionInPage",value:function calculateStepPositionInPage(){var viewportHeight=(0,_jquery.default)(window).height(),stepHeight=this.currentStepNode.height(),viewportWidth=(0,_jquery.default)(window).width(),stepWidth=this.currentStepNode.width();return{top:Math.ceil((viewportHeight-stepHeight)/2),left:Math.ceil((viewportWidth-stepWidth)/2)}}},{key:"positionStep",value:function positionStep(stepConfig){var content=this.currentStepNode;if(!content||!content.length){return this}stepConfig.placement=this.recalculatePlacement(stepConfig);var flipBehavior;switch(stepConfig.placement){case"left":flipBehavior=["left","right","top","bottom"];break;case"right":flipBehavior=["right","left","top","bottom"];break;case"top":flipBehavior=["top","bottom","right","left"];break;case"bottom":flipBehavior=["bottom","top","right","left"];break;default:flipBehavior="flip";break;}var target=this.getStepTarget(stepConfig),config={placement:stepConfig.placement+"-start",removeOnDestroy:!0,modifiers:{flip:{behaviour:flipBehavior},arrow:{element:"[data-role=\"arrow\"]"}},onCreate:function onCreate(data){recalculateArrowPosition(data)},onUpdate:function onUpdate(data){recalculateArrowPosition(data)}},recalculateArrowPosition=function(data){var placement=data.placement.split("-")[0],isVertical=-1!==["left","right"].indexOf(placement),arrowElement=data.instance.popper.querySelector("[data-role=\"arrow\"]"),stepElement=(0,_jquery.default)(data.instance.popper.querySelector("[data-role=\"flexitour-step\"]"));if(isVertical){var arrowHeight=parseFloat(window.getComputedStyle(arrowElement).height),arrowOffset=parseFloat(window.getComputedStyle(arrowElement).top),popperHeight=parseFloat(window.getComputedStyle(data.instance.popper).height),popperOffset=parseFloat(window.getComputedStyle(data.instance.popper).top),popperBorderWidth=parseFloat(stepElement.css("borderTopWidth")),popperBorderRadiusWidth=2*parseFloat(stepElement.css("borderTopLeftRadius")),arrowPos=arrowOffset+arrowHeight/2,maxPos=popperHeight+popperOffset-popperBorderWidth-popperBorderRadiusWidth,minPos=popperOffset+popperBorderWidth+popperBorderRadiusWidth;if(arrowPos>=maxPos||arrowPos<=minPos){var newArrowPos=0;if(arrowPos>popperHeight/2){newArrowPos=maxPos-arrowHeight}else{newArrowPos=minPos+arrowHeight}(0,_jquery.default)(arrowElement).css("top",newArrowPos)}}else{var arrowWidth=parseFloat(window.getComputedStyle(arrowElement).width),_arrowOffset=parseFloat(window.getComputedStyle(arrowElement).left),popperWidth=parseFloat(window.getComputedStyle(data.instance.popper).width),_popperOffset=parseFloat(window.getComputedStyle(data.instance.popper).left),_popperBorderWidth=parseFloat(stepElement.css("borderTopWidth")),_popperBorderRadiusWidth=2*parseFloat(stepElement.css("borderTopLeftRadius")),_arrowPos=_arrowOffset+arrowWidth/2,_maxPos=popperWidth+_popperOffset-_popperBorderWidth-_popperBorderRadiusWidth,_minPos=_popperOffset+_popperBorderWidth+_popperBorderRadiusWidth;if(_arrowPos>=_maxPos||_arrowPos<=_minPos){var _newArrowPos=0;if(_arrowPos>popperWidth/2){_newArrowPos=_maxPos-arrowWidth}else{_newArrowPos=_minPos+arrowWidth}(0,_jquery.default)(arrowElement).css("left",_newArrowPos)}}},background=(0,_jquery.default)("[data-flexitour=\"step-background\"]");if(background.length){target=background}this.currentStepPopper=new _popper.default(target,content[0],config);return this}},{key:"recalculatePlacement",value:function recalculatePlacement(stepConfig){var target=this.getStepTarget(stepConfig),widthContent=this.currentStepNode.width()+16,targetOffsetLeft=target.offset().left-10,targetOffsetRight=target.offset().left+target.width()+10,placement=stepConfig.placement;if(-1!==["left","right"].indexOf(placement)){if(targetOffsetLeft<widthContent+10&&targetOffsetRight+widthContent+10>document.documentElement.clientWidth){placement="top"}}return placement}},{key:"positionBackdrop",value:function positionBackdrop(stepConfig){if(stepConfig.backdrop){this.currentStepConfig.hasBackdrop=!0;var backdrop=(0,_jquery.default)("<div data-flexitour=\"backdrop\"></div>");if(stepConfig.zIndex){if("append"===stepConfig.attachPoint){stepConfig.attachTo.append(backdrop)}else{backdrop.insertAfter(stepConfig.attachTo)}}else{(0,_jquery.default)("body").append(backdrop)}if(this.isStepActuallyVisible(stepConfig)){var background=(0,_jquery.default)("<div data-flexitour=\"step-background\"></div>"),targetNode=this.getStepTarget(stepConfig),buffer=10,colorNode=targetNode;if(buffer){colorNode=(0,_jquery.default)("body")}background.css({width:targetNode.outerWidth()+buffer+buffer,height:targetNode.outerHeight()+buffer+buffer,left:targetNode.offset().left-buffer,top:targetNode.offset().top-buffer,backgroundColor:this.calculateInherittedBackgroundColor(colorNode)});if(targetNode.offset().left<buffer){background.css({width:targetNode.outerWidth()+targetNode.offset().left+buffer,left:targetNode.offset().left})}if(targetNode.offset().top<buffer){background.css({height:targetNode.outerHeight()+targetNode.offset().top+buffer,top:targetNode.offset().top})}var targetRadius=targetNode.css("borderRadius");if(targetRadius&&targetRadius!==(0,_jquery.default)("body").css("borderRadius")){background.css("borderRadius",targetRadius)}var targetPosition=this.calculatePosition(targetNode);if("fixed"===targetPosition){background.css("top",0)}else if("absolute"===targetPosition){background.css("position","fixed")}var fader=background.clone();fader.css({backgroundColor:backdrop.css("backgroundColor"),opacity:backdrop.css("opacity")});fader.attr("data-flexitour","step-background-fader");if(stepConfig.zIndex){if("append"===stepConfig.attachPoint){stepConfig.attachTo.append(background)}else{fader.insertAfter(stepConfig.attachTo);background.insertAfter(stepConfig.attachTo)}}else{(0,_jquery.default)("body").append(fader);(0,_jquery.default)("body").append(background)}targetNode.attr("data-flexitour","step-backdrop");if(stepConfig.zIndex){backdrop.css("zIndex",stepConfig.zIndex);background.css("zIndex",stepConfig.zIndex+1);targetNode.css("zIndex",stepConfig.zIndex+2)}fader.fadeOut("2000",function(){(0,_jquery.default)(this).remove()})}}return this}},{key:"calculateZIndex",value:function calculateZIndex(elem){elem=(0,_jquery.default)(elem);while(elem.length&&elem[0]!==document){var position=elem.css("position");if("absolute"===position||"relative"===position||"fixed"===position){var value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&0!==value){return value}}elem=elem.parent()}return 0}},{key:"calculateInherittedBackgroundColor",value:function calculateInherittedBackgroundColor(elem){var fakeNode=(0,_jquery.default)("<div>").hide();(0,_jquery.default)("body").append(fakeNode);var fakeElemColor=fakeNode.css("backgroundColor");fakeNode.remove();elem=(0,_jquery.default)(elem);while(elem.length&&elem[0]!==document){var color=elem.css("backgroundColor");if(color!==fakeElemColor){return color}elem=elem.parent()}return null}},{key:"calculatePosition",value:function calculatePosition(elem){elem=(0,_jquery.default)(elem);while(elem.length&&elem[0]!==document){var position=elem.css("position");if("static"!==position){return position}elem=elem.parent()}return null}},{key:"accessibilityShow",value:function accessibilityShow(){var hideFunction=function(child){var flexitourRole=child.data("flexitour");if(flexitourRole){switch(flexitourRole){case"container":case"target":return;}}var hidden=child.attr("aria-hidden");if(!hidden){child.attr("data-has-hidden",!0);Aria.hide(child)}};this.currentStepNode.siblings().each(function(index,node){hideFunction((0,_jquery.default)(node))});this.currentStepNode.parentsUntil("body").siblings().each(function(index,node){hideFunction((0,_jquery.default)(node))})}},{key:"accessibilityHide",value:function accessibilityHide(){var showFunction=function(child){var hidden=child.attr("data-has-hidden");if("undefined"!=typeof hidden){child.removeAttr("data-has-hidden");Aria.unhide(child)}};(0,_jquery.default)("[data-has-hidden]").each(function(index,node){showFunction((0,_jquery.default)(node))})}}]);return Tour}();_exports.default=Tour;return _exports.default});
//# sourceMappingURL=tour.min.js.map
