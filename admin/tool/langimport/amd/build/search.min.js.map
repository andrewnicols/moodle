{"version":3,"sources":["../src/search.js"],"names":["SELECTORS","AVAILABLE_LANG_SELECT","AVAILABLE_LANG_SEARCH","DEBOUNCE_TIMER","init","form","availableLangsElement","querySelector","availableLangsFilter","event","pendingPromise","Pending","querySelectorAll","forEach","option","remove","searchTerm","target","value","toLowerCase","availableLanguages","JSON","parse","dataset","filteredLanguages","Object","keys","reduce","matches","langcode","includes","entries","langname","document","createElement","innerText","append","resolve","text","stringify","availableLangsSearch","addEventListener","key","preventDefault","setTimeout"],"mappings":"yMAuBA,+E,KAGMA,CAAAA,SAAS,CAAG,CACdC,qBAAqB,CAAE,QADT,CAEdC,qBAAqB,CAAE,0BAFT,C,CAKZC,cAAc,CAAG,G,kBAiER,CACXC,IAAI,CA3DMC,IAAD,EAAU,MACbC,CAAAA,qBAAqB,CAAGD,IAAI,CAACE,aAAL,CAAmBP,SAAS,CAACC,qBAA7B,CADX,CAGbO,oBAAoB,CAAIC,KAAD,EAAW,CACpC,KAAMC,CAAAA,cAAc,CAAG,GAAIC,iBAAJ,CAAY,+BAAZ,CAAvB,CAGAL,qBAAqB,CAACM,gBAAtB,CAAuC,QAAvC,EAAiDC,OAAjD,CAA0DC,MAAD,EAAY,CACjEA,MAAM,CAACC,MAAP,EACH,CAFD,EAJoC,KAS9BC,CAAAA,UAAU,CAAGP,KAAK,CAACQ,MAAN,CAAaC,KAAb,CAAmBC,WAAnB,EATiB,CAU9BC,kBAAkB,CAAGC,IAAI,CAACC,KAAL,CAAWhB,qBAAqB,CAACiB,OAAtB,CAA8BH,kBAAzC,CAVS,CAW9BI,iBAAiB,CAAGC,MAAM,CAACC,IAAP,CAAYN,kBAAZ,EAAgCO,MAAhC,CAAuC,CAACC,OAAD,CAAUC,QAAV,GAAuB,CACpF,GAAIT,kBAAkB,CAACS,QAAD,CAAlB,CAA6BV,WAA7B,GAA2CW,QAA3C,CAAoDd,UAApD,CAAJ,CAAqE,CACjEY,OAAO,CAACC,QAAD,CAAP,CAAoBT,kBAAkB,CAACS,QAAD,CACzC,CACD,MAAOD,CAAAA,OACV,CALyB,CAKvB,EALuB,CAXU,CAmBpCH,MAAM,CAACM,OAAP,CAAeP,iBAAf,EAAkCX,OAAlC,CAA0C,MAA0B,IAAzB,CAACgB,QAAD,CAAWG,QAAX,CAAyB,MAChE,KAAMlB,CAAAA,MAAM,CAAGmB,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAf,CACApB,MAAM,CAACI,KAAP,CAAeW,QAAf,CACAf,MAAM,CAACqB,SAAP,CAAmBH,QAAnB,CACA1B,qBAAqB,CAAC8B,MAAtB,CAA6BtB,MAA7B,CACH,CALD,EAOAJ,cAAc,CAAC2B,OAAf,EACH,CA9BkB,CAiCbjB,kBAAkB,CAAG,EAjCR,CAkCnBd,qBAAqB,CAACM,gBAAtB,CAAuC,QAAvC,EAAiDC,OAAjD,CAA0DC,MAAD,EAAY,CACjEM,kBAAkB,CAACN,MAAM,CAACI,KAAR,CAAlB,CAAmCJ,MAAM,CAACwB,IAC7C,CAFD,EAGAhC,qBAAqB,CAACiB,OAAtB,CAA8BH,kBAA9B,CAAmDC,IAAI,CAACkB,SAAL,CAAenB,kBAAf,CAAnD,CAGA,KAAMoB,CAAAA,oBAAoB,CAAGnC,IAAI,CAACE,aAAL,CAAmBP,SAAS,CAACE,qBAA7B,CAA7B,CACAsC,oBAAoB,CAACC,gBAArB,CAAsC,SAAtC,CAAkDhC,KAAD,EAAW,CACxD,GAAkB,OAAd,GAAAA,KAAK,CAACiC,GAAV,CAA2B,CACvBjC,KAAK,CAACkC,cAAN,EACH,CACJ,CAJD,EAOAH,oBAAoB,CAACC,gBAArB,CAAsC,OAAtC,CAAgDhC,KAAD,EAAW,CACtD,KAAMC,CAAAA,cAAc,CAAG,GAAIC,iBAAJ,CAAY,8BAAZ,CAAvB,CAEA,oBAASH,oBAAT,CAA+BL,cAA/B,EAA+CM,KAA/C,EACAmC,UAAU,CAAC,IAAM,CACblC,cAAc,CAAC2B,OAAf,EACH,CAFS,CAEPlC,cAFO,CAGb,CAPD,CAQH,CAEc,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Add search filtering of available language packs\n *\n * @module      tool_langimport/search\n * @copyright   2021 Paul Holden <paulh@moodle.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Pending from 'core/pending';\nimport {debounce} from 'core/utils';\n\nconst SELECTORS = {\n    AVAILABLE_LANG_SELECT: 'select',\n    AVAILABLE_LANG_SEARCH: '[data-action=\"search\"]',\n};\n\nconst DEBOUNCE_TIMER = 250;\n\n/**\n * Initialize module\n *\n * @param {Element} form\n */\nconst init = (form) => {\n    const availableLangsElement = form.querySelector(SELECTORS.AVAILABLE_LANG_SELECT);\n\n    const availableLangsFilter = (event) => {\n        const pendingPromise = new Pending('tool_langimport/search:filter');\n\n        // Remove existing options.\n        availableLangsElement.querySelectorAll('option').forEach((option) => {\n            option.remove();\n        });\n\n        // Filter for matching languages.\n        const searchTerm = event.target.value.toLowerCase();\n        const availableLanguages = JSON.parse(availableLangsElement.dataset.availableLanguages);\n        const filteredLanguages = Object.keys(availableLanguages).reduce((matches, langcode) => {\n            if (availableLanguages[langcode].toLowerCase().includes(searchTerm)) {\n                matches[langcode] = availableLanguages[langcode];\n            }\n            return matches;\n        }, []);\n\n        // Re-create filtered options.\n        Object.entries(filteredLanguages).forEach(([langcode, langname]) => {\n            const option = document.createElement('option');\n            option.value = langcode;\n            option.innerText = langname;\n            availableLangsElement.append(option);\n        });\n\n        pendingPromise.resolve();\n    };\n\n    // Cache initial available language options.\n    const availableLanguages = {};\n    availableLangsElement.querySelectorAll('option').forEach((option) => {\n        availableLanguages[option.value] = option.text;\n    });\n    availableLangsElement.dataset.availableLanguages = JSON.stringify(availableLanguages);\n\n    // Register event listeners on the search element.\n    const availableLangsSearch = form.querySelector(SELECTORS.AVAILABLE_LANG_SEARCH);\n    availableLangsSearch.addEventListener('keydown', (event) => {\n        if (event.key === 'Enter') {\n            event.preventDefault();\n        }\n    });\n\n    // Debounce the event listener to allow the user to finish typing.\n    availableLangsSearch.addEventListener('keyup', (event) => {\n        const pendingPromise = new Pending('tool_langimport/search:keyup');\n\n        debounce(availableLangsFilter, DEBOUNCE_TIMER)(event);\n        setTimeout(() => {\n            pendingPromise.resolve();\n        }, DEBOUNCE_TIMER);\n    });\n};\n\nexport default {\n    init: init,\n};\n"],"file":"search.min.js"}