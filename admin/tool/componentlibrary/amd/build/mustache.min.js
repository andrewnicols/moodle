define ("tool_componentlibrary/mustache",["exports","tool_componentlibrary/selectors","core/ajax","core/config","core/templates","core/log","core/notification"],function(_exports,_selectors,_ajax,_config,_templates,_log,_notification){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.mustache=void 0;_selectors=_interopRequireDefault(_selectors);_ajax=_interopRequireDefault(_ajax);_config=_interopRequireDefault(_config);_templates=_interopRequireDefault(_templates);_log=_interopRequireDefault(_log);_notification=_interopRequireDefault(_notification);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}var renderTemplate=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(container,templateName,context){var _yield$Templates$rend,html,js,rendercontainer;return regeneratorRuntime.wrap(function(_context){while(1){switch(_context.prev=_context.next){case 0:try{context=JSON.parse(context)}catch(e){_log.default.debug("Could not parse json example context for template.");_log.default.debug(e)}_context.next=3;return _templates.default.renderForPromise(templateName,context);case 3:_yield$Templates$rend=_context.sent;html=_yield$Templates$rend.html;js=_yield$Templates$rend.js;rendercontainer=container.querySelector(_selectors.default.mustacherendered);_context.next=9;return _templates.default.replaceNodeContents(rendercontainer,html,js);case 9:case"end":return _context.stop();}}},_callee)}));return function(){return _ref.apply(this,arguments)}}(),loadTemplate=function(container){var sourcecontainer=container.querySelector(_selectors.default.mustachesource),contextcontainer=container.querySelector(_selectors.default.mustachecontext),templateName=container.dataset.template,context=container.querySelector(_selectors.default.mustacherawcontext).textContent,parts=templateName.split("/"),component=parts.shift(),name=parts.join("/"),request={methodname:"core_output_load_template",args:{component:component,template:name,themename:_config.default.theme,includecomments:!0}};_ajax.default.call([request])[0].done(function(source){sourcecontainer.textContent=source;if(!context){var example=source.match(/Example context \(json\):([\s\S]+?)(}})/);context=example[1];var precontainer=document.createElement("pre");precontainer.innerHTML=JSON.stringify(JSON.parse(context),null,4);contextcontainer.parentNode.appendChild(precontainer);contextcontainer.classList.add("d-none")}renderTemplate(container,templateName,context)}).fail(_notification.default.exception)},mustache=function(){document.querySelectorAll(_selectors.default.mustachecode).forEach(function(container){loadTemplate(container)})};_exports.mustache=mustache});
//# sourceMappingURL=mustache.min.js.map
