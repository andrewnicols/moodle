define ("tool_componentlibrary/search",["exports","tool_componentlibrary/lunr","tool_componentlibrary/selectors","core/log","core/notification","core/key_codes"],function(_exports,_lunr,_selectors,_log,_notification,_key_codes){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.search=void 0;_lunr=_interopRequireDefault(_lunr);_selectors=_interopRequireDefault(_selectors);_log=_interopRequireDefault(_log);_notification=_interopRequireDefault(_notification);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}var lunrIndex=null,pagesIndex=null,fetchJson=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(jsonFile){var response;return regeneratorRuntime.wrap(function(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(jsonFile);case 2:response=_context.sent;if(!response.ok){_log.default.debug("Error getting Hugo index file: ".concat(response.status))}_context.next=6;return response.json();case 6:return _context.abrupt("return",_context.sent);case 7:case"end":return _context.stop();}}},_callee)}));return function(){return _ref.apply(this,arguments)}}(),initLunr=function(jsonFile){fetchJson(jsonFile).then(function(jsondata){pagesIndex=jsondata;lunrIndex=(0,_lunr.default)(function(){var _this=this;this.ref("uri");this.field("title",{boost:10});this.field("content");this.field("tags",{boost:5});jsondata.forEach(function(p){_this.add(p)})});return null}).catch(_notification.default.exception)},initUI=function(){var searchInput=document.querySelector(_selectors.default.searchinput);searchInput.addEventListener("keyup",function(e){var query=e.currentTarget.value;if(2>query.length){document.querySelector(_selectors.default.dropdownmenu).classList.remove("show");return}renderResults(searchIndex(query))});searchInput.addEventListener("keydown",function(e){if(e.keyCode===_key_codes.enter){e.preventDefault()}if(e.keyCode===_key_codes.escape){searchInput.value=""}})},searchIndex=function(query){return lunrIndex.search(query+" "+query+"*").map(function(result){return pagesIndex.filter(function(page){return page.uri===result.ref})[0]})},renderResults=function(results){var dropdownMenu=document.querySelector(_selectors.default.dropdownmenu);if(!results.length){dropdownMenu.classList.remove("show");return}dropdownMenu.innerHTML="";var baseUrl=M.cfg.wwwroot+"/admin/tool/componentlibrary/docspage.php";results.slice(0,10).forEach(function(result){var link=document.createElement("a"),chapter=result.uri.split("/")[1];link.appendChild(document.createTextNode("".concat(chapter," > ").concat(result.title)));link.classList.add("dropdown-item");link.href=baseUrl+result.uri;dropdownMenu.appendChild(link)});dropdownMenu.classList.add("show")};_exports.search=function search(jsonFile){initLunr(jsonFile);initUI()}});
//# sourceMappingURL=search.min.js.map
