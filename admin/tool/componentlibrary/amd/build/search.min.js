define ("tool_componentlibrary/search",["exports","tool_componentlibrary/lunr","tool_componentlibrary/selectors","core/log","core/notification","core/key_codes"],function(_exports,_lunr,_selectors,_log,_notification,_key_codes){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.search=void 0;_lunr=_interopRequireDefault(_lunr);_selectors=_interopRequireDefault(_selectors);_log=_interopRequireDefault(_log);_notification=_interopRequireDefault(_notification);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}let lunrIndex=null,pagesIndex=null;const fetchJson=async jsonFile=>{const response=await fetch(jsonFile);if(!response.ok){_log.default.debug("Error getting Hugo index file: ".concat(response.status))}return await response.json()},initLunr=jsonFile=>{fetchJson(jsonFile).then(jsondata=>{pagesIndex=jsondata;lunrIndex=(0,_lunr.default)(function(){this.ref("uri");this.field("title",{boost:10});this.field("content");this.field("tags",{boost:5});jsondata.forEach(p=>{this.add(p)})});return null}).catch(_notification.default.exception)},initUI=()=>{const searchInput=document.querySelector(_selectors.default.searchinput);searchInput.addEventListener("keyup",e=>{const query=e.currentTarget.value;if(2>query.length){document.querySelector(_selectors.default.dropdownmenu).classList.remove("show");return}renderResults(searchIndex(query))});searchInput.addEventListener("keydown",e=>{if(e.keyCode===_key_codes.enter){e.preventDefault()}if(e.keyCode===_key_codes.escape){searchInput.value=""}})},searchIndex=query=>{return lunrIndex.search(query+" "+query+"*").map(result=>{return pagesIndex.filter(page=>{return page.uri===result.ref})[0]})},renderResults=results=>{const dropdownMenu=document.querySelector(_selectors.default.dropdownmenu);if(!results.length){dropdownMenu.classList.remove("show");return}dropdownMenu.innerHTML="";const baseUrl=M.cfg.wwwroot+"/admin/tool/componentlibrary/docspage.php";results.slice(0,10).forEach(function(result){const link=document.createElement("a"),chapter=result.uri.split("/")[1];link.appendChild(document.createTextNode("".concat(chapter," > ").concat(result.title)));link.classList.add("dropdown-item");link.href=baseUrl+result.uri;dropdownMenu.appendChild(link)});dropdownMenu.classList.add("show")};_exports.search=jsonFile=>{initLunr(jsonFile);initUI()}});
//# sourceMappingURL=search.min.js.map
