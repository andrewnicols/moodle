{"version":3,"sources":["../src/competencies.js"],"names":["define","$","notification","ajax","templates","str","Picker","dragdrop","Pending","competencies","itemid","itemtype","pagectxid","pageContextId","pickerInstance","prop","registerEvents","registerDragDrop","prototype","localthis","get_string","done","movestring","identifier","component","drag","drop","handleDrop","fail","exception","fromid","data","toid","requests","pendingPromise","call","methodname","args","courseid","competencyidfrom","competencyidto","templateid","planid","resolve","then","catch","pickCompetency","self","pagerender","pageregion","pageContextIncludes","on","e","compIds","competencyIds","each","index","compId","push","competencyid","moduleid","pagecontext","contextid","length","context","render","html","js","replaceNode","display","doDelete","deleteid","deleteHandler","message","id","competency","get_strings","key","param","shortname","strings","confirm","coursecompetencyid","target","ruleoutcome","val","click","preventDefault","closest"],"mappings":"AAuBAA,OAAM,wBAAC,CAAC,QAAD,CACC,mBADD,CAEC,WAFD,CAGC,gBAHD,CAIC,UAJD,CAKC,0BALD,CAMC,0BAND,CAOC,cAPD,CAAD,CAQC,SAASC,CAAT,CAAYC,CAAZ,CAA0BC,CAA1B,CAAgCC,CAAhC,CAA2CC,CAA3C,CAAgDC,CAAhD,CAAwDC,CAAxD,CAAkEC,CAAlE,CAA2E,CAS9E,GAAIC,CAAAA,CAAY,CAAG,SAASC,CAAT,CAAiBC,CAAjB,CAA2BC,CAA3B,CAAsC,CACrD,KAAKF,MAAL,CAAcA,CAAd,CACA,KAAKC,QAAL,CAAgBA,CAAhB,CACA,KAAKE,aAAL,CAAqBD,CAArB,CACA,KAAKE,cAAL,CAAsB,IAAtB,CAEAb,CAAC,CAAC,kCAAD,CAAD,CAAoCc,IAApC,CAAyC,UAAzC,KACA,KAAKC,cAAL,GACA,KAAKC,gBAAL,EACH,CATD,CAeAR,CAAY,CAACS,SAAb,CAAuBD,gBAAvB,CAA0C,UAAW,CACjD,GAAIE,CAAAA,CAAS,CAAG,IAAhB,CAEAd,CAAG,CAACe,UAAJ,CAAe,gBAAf,CAAiC,SAAjC,EAA4CC,IAA5C,CACI,SAASC,CAAT,CAAqB,CACjBf,CAAQ,CAACA,QAAT,CAAkB,gBAAlB,CACkBe,CADlB,CAEkB,CAACC,UAAU,CAAE,gBAAb,CAA+BC,SAAS,CAAE,SAA1C,CAFlB,CAGkB,CAACD,UAAU,CAAE,qBAAb,CAAoCC,SAAS,CAAE,SAA/C,CAHlB,CAIkB,eAJlB,CAKkB,iBALlB,CAMkB,sBANlB,CAOkB,SAASC,CAAT,CAAeC,CAAf,CAAqB,CACjBP,CAAS,CAACQ,UAAV,CAAqBF,CAArB,CAA2BC,CAA3B,CACH,CATnB,CAUH,CAZL,EAaEE,IAbF,CAaO1B,CAAY,CAAC2B,SAbpB,CAeH,CAlBD,CA2BApB,CAAY,CAACS,SAAb,CAAuBS,UAAvB,CAAoC,SAASF,CAAT,CAAeC,CAAf,CAAqB,IACjDI,CAAAA,CAAM,CAAG7B,CAAC,CAACwB,CAAD,CAAD,CAAQM,IAAR,CAAa,IAAb,CADwC,CAEjDC,CAAI,CAAG/B,CAAC,CAACyB,CAAD,CAAD,CAAQK,IAAR,CAAa,IAAb,CAF0C,CAGjDZ,CAAS,CAAG,IAHqC,CAIjDc,CAAQ,CAAG,EAJsC,CAKjDC,CAAc,CAAG,GAAI1B,CAAAA,CAAJ,CAAY,iCAAZ,CALgC,CAOrD,GAA0B,QAAtB,EAAAW,CAAS,CAACR,QAAd,CAAoC,CAChCsB,CAAQ,CAAG9B,CAAI,CAACgC,IAAL,CAAU,CACjB,CACIC,UAAU,CAAE,2CADhB,CAEIC,IAAI,CAAE,CAACC,QAAQ,CAAEnB,CAAS,CAACT,MAArB,CAA6B6B,gBAAgB,CAAET,CAA/C,CAAuDU,cAAc,CAAER,CAAvE,CAFV,CADiB,CAAV,CAMd,CAPD,IAOO,IAA0B,UAAtB,EAAAb,CAAS,CAACR,QAAd,CAAsC,CACzCsB,CAAQ,CAAG9B,CAAI,CAACgC,IAAL,CAAU,CACjB,CACIC,UAAU,CAAE,6CADhB,CAEIC,IAAI,CAAE,CAACI,UAAU,CAAEtB,CAAS,CAACT,MAAvB,CAA+B6B,gBAAgB,CAAET,CAAjD,CAAyDU,cAAc,CAAER,CAAzE,CAFV,CADiB,CAAV,CAMd,CAPM,IAOA,IAA0B,MAAtB,EAAAb,CAAS,CAACR,QAAd,CAAkC,CACrCsB,CAAQ,CAAG9B,CAAI,CAACgC,IAAL,CAAU,CACjB,CACIC,UAAU,CAAE,yCADhB,CAEIC,IAAI,CAAE,CAACK,MAAM,CAAEvB,CAAS,CAACT,MAAnB,CAA2B6B,gBAAgB,CAAET,CAA7C,CAAqDU,cAAc,CAAER,CAArE,CAFV,CADiB,CAAV,CAMd,CAPM,IAOA,CACHE,CAAc,CAACS,OAAf,GACA,MACH,CAEDV,CAAQ,CAAC,CAAD,CAAR,CACCW,IADD,CACMV,CAAc,CAACS,OADrB,EAECE,KAFD,CAEO3C,CAAY,CAAC2B,SAFpB,CAGH,CApCD,CA4CApB,CAAY,CAACS,SAAb,CAAuB4B,cAAvB,CAAwC,UAAW,IAC3CC,CAAAA,CAAI,CAAG,IADoC,CAE3Cd,CAF2C,CAG3Ce,CAH2C,CAI3CC,CAJ2C,CAK3CC,CAL2C,CAO/C,GAAI,CAACH,CAAI,CAACjC,cAAV,CAA0B,CACtB,GAAsB,UAAlB,GAAAiC,CAAI,CAACpC,QAAL,EAAkD,QAAlB,GAAAoC,CAAI,CAACpC,QAAzC,CAAgE,CAC5DuC,CAAmB,CAAG,SACzB,CACDH,CAAI,CAACjC,cAAL,CAAsB,GAAIR,CAAAA,CAAJ,CAAWyC,CAAI,CAAClC,aAAhB,IAAsCqC,CAAtC,CAAtB,CACAH,CAAI,CAACjC,cAAL,CAAoBqC,EAApB,CAAuB,MAAvB,CAA+B,SAASC,CAAT,CAAYrB,CAAZ,CAAkB,IACzCsB,CAAAA,CAAO,CAAGtB,CAAI,CAACuB,aAD0B,CAEzCpB,CAAc,CAAG,GAAI1B,CAAAA,CAFoB,CAI7C,GAAsB,QAAlB,GAAAuC,CAAI,CAACpC,QAAT,CAAgC,CAC5BsB,CAAQ,CAAG,EAAX,CAEAhC,CAAC,CAACsD,IAAF,CAAOF,CAAP,CAAgB,SAASG,CAAT,CAAgBC,CAAhB,CAAwB,CACpCxB,CAAQ,CAACyB,IAAT,CAAc,CACVtB,UAAU,CAAE,0CADF,CAEVC,IAAI,CAAE,CAACC,QAAQ,CAAES,CAAI,CAACrC,MAAhB,CAAwBiD,YAAY,CAAEF,CAAtC,CAFI,CAAd,CAIH,CALD,EAMAxB,CAAQ,CAACyB,IAAT,CAAc,CACVtB,UAAU,CAAE,2CADF,CAEVC,IAAI,CAAE,CAACC,QAAQ,CAAES,CAAI,CAACrC,MAAhB,CAAwBkD,QAAQ,CAAE,CAAlC,CAFI,CAAd,EAKAZ,CAAU,CAAG,kCAAb,CACAC,CAAU,CAAG,wBAEhB,CAjBD,IAiBO,IAAsB,UAAlB,GAAAF,CAAI,CAACpC,QAAT,CAAkC,CACrCsB,CAAQ,CAAG,EAAX,CAEAhC,CAAC,CAACsD,IAAF,CAAOF,CAAP,CAAgB,SAASG,CAAT,CAAgBC,CAAhB,CAAwB,CACpCxB,CAAQ,CAACyB,IAAT,CAAc,CACVtB,UAAU,CAAE,4CADF,CAEVC,IAAI,CAAE,CAACI,UAAU,CAAEM,CAAI,CAACrC,MAAlB,CAA0BiD,YAAY,CAAEF,CAAxC,CAFI,CAAd,CAIH,CALD,EAMAxB,CAAQ,CAACyB,IAAT,CAAc,CACVtB,UAAU,CAAE,6CADF,CAEVC,IAAI,CAAE,CAACI,UAAU,CAAEM,CAAI,CAACrC,MAAlB,CAA0BmD,WAAW,CAAE,CAACC,SAAS,CAAEf,CAAI,CAAClC,aAAjB,CAAvC,CAFI,CAAd,EAIAmC,CAAU,CAAG,oCAAb,CACAC,CAAU,CAAG,0BAChB,CAfM,IAeA,IAAsB,MAAlB,GAAAF,CAAI,CAACpC,QAAT,CAA8B,CACjCsB,CAAQ,CAAG,EAAX,CAEAhC,CAAC,CAACsD,IAAF,CAAOF,CAAP,CAAgB,SAASG,CAAT,CAAgBC,CAAhB,CAAwB,CACpCxB,CAAQ,CAACyB,IAAT,CAAc,CACVtB,UAAU,CAAE,wCADF,CAEVC,IAAI,CAAE,CAACK,MAAM,CAAEK,CAAI,CAACrC,MAAd,CAAsBiD,YAAY,CAAEF,CAApC,CAFI,CAAd,CAIH,CALD,EAMAxB,CAAQ,CAACyB,IAAT,CAAc,CACTtB,UAAU,CAAE,4BADH,CAETC,IAAI,CAAE,CAACK,MAAM,CAAEK,CAAI,CAACrC,MAAd,CAFG,CAAd,EAIAsC,CAAU,CAAG,mBAAb,CACAC,CAAU,CAAG,WAChB,CACD9C,CAAI,CAACgC,IAAL,CAAUF,CAAV,EAAoBA,CAAQ,CAAC8B,MAAT,CAAkB,CAAtC,EACCnB,IADD,CACM,SAASoB,CAAT,CAAkB,CACpB,MAAO5D,CAAAA,CAAS,CAAC6D,MAAV,CAAiBjB,CAAjB,CAA6BgB,CAA7B,CACV,CAHD,EAICpB,IAJD,CAIM,SAASsB,CAAT,CAAeC,CAAf,CAAmB,CACrB/D,CAAS,CAACgE,WAAV,CAAsBnE,CAAC,CAAC,kBAAmBgD,CAAnB,CAAgC,KAAjC,CAAvB,CAA+DiB,CAA/D,CAAqEC,CAArE,CAEH,CAPD,EAQCvB,IARD,CAQMV,CAAc,CAACS,OARrB,EASCE,KATD,CASO3C,CAAY,CAAC2B,SATpB,CAUH,CA9DD,CA+DH,CAED,MAAOkB,CAAAA,CAAI,CAACjC,cAAL,CAAoBuD,OAApB,EACV,CA9ED,CAsFA5D,CAAY,CAACS,SAAb,CAAuBoD,QAAvB,CAAkC,SAASC,CAAT,CAAmB,IAC7CpD,CAAAA,CAAS,CAAG,IADiC,CAE7Cc,CAAQ,CAAG,EAFkC,CAG7Ce,CAAU,CAAG,EAHgC,CAI7CC,CAAU,CAAG,EAJgC,CAK7Cf,CAAc,CAAG,GAAI1B,CAAAA,CAAJ,CAAY,+BAAZ,CAL4B,CAQjD,GAA0B,QAAtB,EAAAW,CAAS,CAACR,QAAd,CAAoC,CAChCsB,CAAQ,CAAG9B,CAAI,CAACgC,IAAL,CAAU,CACjB,CAACC,UAAU,CAAE,+CAAb,CACIC,IAAI,CAAE,CAACC,QAAQ,CAAEnB,CAAS,CAACT,MAArB,CAA6BiD,YAAY,CAAEY,CAA3C,CADV,CADiB,CAGjB,CAACnC,UAAU,CAAE,2CAAb,CACIC,IAAI,CAAE,CAACC,QAAQ,CAAEnB,CAAS,CAACT,MAArB,CAA6BkD,QAAQ,CAAE,CAAvC,CADV,CAHiB,CAAV,CAAX,CAMAZ,CAAU,CAAG,kCAAb,CACAC,CAAU,CAAG,wBAChB,CATD,IASO,IAA0B,UAAtB,EAAA9B,CAAS,CAACR,QAAd,CAAsC,CACzCsB,CAAQ,CAAG9B,CAAI,CAACgC,IAAL,CAAU,CACjB,CAACC,UAAU,CAAE,iDAAb,CACIC,IAAI,CAAE,CAACI,UAAU,CAAEtB,CAAS,CAACT,MAAvB,CAA+BiD,YAAY,CAAEY,CAA7C,CADV,CADiB,CAGjB,CAACnC,UAAU,CAAE,6CAAb,CACIC,IAAI,CAAE,CAACI,UAAU,CAAEtB,CAAS,CAACT,MAAvB,CAA+BmD,WAAW,CAAE,CAACC,SAAS,CAAE3C,CAAS,CAACN,aAAtB,CAA5C,CADV,CAHiB,CAAV,CAAX,CAMAmC,CAAU,CAAG,oCAAb,CACAC,CAAU,CAAG,0BAChB,CATM,IASA,IAA0B,MAAtB,EAAA9B,CAAS,CAACR,QAAd,CAAkC,CACrCsB,CAAQ,CAAG9B,CAAI,CAACgC,IAAL,CAAU,CACjB,CAACC,UAAU,CAAE,6CAAb,CACIC,IAAI,CAAE,CAACK,MAAM,CAAEvB,CAAS,CAACT,MAAnB,CAA2BiD,YAAY,CAAEY,CAAzC,CADV,CADiB,CAGjB,CAACnC,UAAU,CAAE,4BAAb,CACIC,IAAI,CAAE,CAACK,MAAM,CAAEvB,CAAS,CAACT,MAAnB,CADV,CAHiB,CAAV,CAAX,CAMAsC,CAAU,CAAG,mBAAb,CACAC,CAAU,CAAG,WAChB,CAEDhB,CAAQ,CAAC,CAAD,CAAR,CACCW,IADD,CACM,SAASoB,CAAT,CAAkB,CACpB,MAAO5D,CAAAA,CAAS,CAAC6D,MAAV,CAAiBjB,CAAjB,CAA6BgB,CAA7B,CACV,CAHD,EAICpB,IAJD,CAIM,SAASsB,CAAT,CAAeC,CAAf,CAAmB,CACrB,MAAO/D,CAAAA,CAAS,CAACgE,WAAV,CAAsBnE,CAAC,CAAC,kBAAmBgD,CAAnB,CAAgC,KAAjC,CAAvB,CAA+DiB,CAA/D,CAAqEC,CAArE,CACV,CAND,EAOCvB,IAPD,CAOMV,CAAc,CAACS,OAPrB,EAQCE,KARD,CAQO3C,CAAY,CAAC2B,SARpB,CAUH,CA/CD,CAuDApB,CAAY,CAACS,SAAb,CAAuBsD,aAAvB,CAAuC,SAASD,CAAT,CAAmB,IAClDpD,CAAAA,CAAS,CAAG,IADsC,CAElDsD,CAFkD,CAItD,GAA0B,QAAtB,EAAAtD,CAAS,CAACR,QAAd,CAAoC,CAChC8D,CAAO,CAAG,wBACb,CAFD,IAEO,IAA0B,UAAtB,EAAAtD,CAAS,CAACR,QAAd,CAAsC,CACzC8D,CAAO,CAAG,0BACb,CAFM,IAEA,IAA0B,MAAtB,EAAAtD,CAAS,CAACR,QAAd,CAAkC,CACrC8D,CAAO,CAAG,sBACb,CAFM,IAEA,CACH,MACH,CAED,GAAIvC,CAAAA,CAAc,CAAG,GAAI1B,CAAAA,CAAJ,CAAY,oCAAZ,CAArB,CACAL,CAAI,CAACgC,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,iCADL,CAEPC,IAAI,CAAE,CAACqC,EAAE,CAAEH,CAAL,CAFC,CAAD,CAAV,EAGI,CAHJ,EAIC3B,IAJD,CAIM,SAAS+B,CAAT,CAAqB,CACvB,MAAOtE,CAAAA,CAAG,CAACuE,WAAJ,CAAgB,CACnB,CAACC,GAAG,CAAE,SAAN,CAAiBrD,SAAS,CAAE,QAA5B,CADmB,CAEnB,CAACqD,GAAG,CAAEJ,CAAN,CAAejD,SAAS,CAAE,SAA1B,CAAqCsD,KAAK,CAAEH,CAAU,CAACI,SAAvD,CAFmB,CAGnB,CAACF,GAAG,CAAE,SAAN,CAAiBrD,SAAS,CAAE,QAA5B,CAHmB,CAInB,CAACqD,GAAG,CAAE,QAAN,CAAgBrD,SAAS,CAAE,QAA3B,CAJmB,CAAhB,CAMV,CAXD,EAYCoB,IAZD,CAYM,SAASoC,CAAT,CAAkB,CACpB,MAAO9E,CAAAA,CAAY,CAAC+E,OAAb,CACHD,CAAO,CAAC,CAAD,CADJ,CAEHA,CAAO,CAAC,CAAD,CAFJ,CAGHA,CAAO,CAAC,CAAD,CAHJ,CAIHA,CAAO,CAAC,CAAD,CAJJ,CAKH,UAAW,CACP7D,CAAS,CAACmD,QAAV,CAAmBC,CAAnB,CACH,CAPE,CASV,CAtBD,EAuBC3B,IAvBD,CAuBMV,CAAc,CAACS,OAvBrB,EAwBCE,KAxBD,CAwBO3C,CAAY,CAAC2B,SAxBpB,CAyBH,CAxCD,CA+CApB,CAAY,CAACS,SAAb,CAAuBF,cAAvB,CAAwC,UAAW,CAC/C,GAAIG,CAAAA,CAAS,CAAG,IAAhB,CAEA,GAA0B,QAAtB,EAAAA,CAAS,CAACR,QAAd,CAAoC,CAEhCV,CAAC,CAAC,0CAAD,CAAD,CAA4CkD,EAA5C,CAA+C,QAA/C,CAAyD,oCAAzD,CAA6F,SAASC,CAAT,CAAY,IACjGlB,CAAAA,CAAc,CAAG,GAAI1B,CAAAA,CAD4E,CAEjGyB,CAAQ,CAAG,EAFsF,CAKjGiD,CAAkB,CAAGjF,CAAC,CAACmD,CAAC,CAAC+B,MAAH,CAAD,CAAYpD,IAAZ,CAAiB,IAAjB,CAL4E,CAMjGqD,CAAW,CAAGnF,CAAC,CAACmD,CAAC,CAAC+B,MAAH,CAAD,CAAYE,GAAZ,EANmF,CAOrGpD,CAAQ,CAAG9B,CAAI,CAACgC,IAAL,CAAU,CACjB,CAACC,UAAU,CAAE,mDAAb,CACEC,IAAI,CAAE,CAAC6C,kBAAkB,CAAEA,CAArB,CAAyCE,WAAW,CAAEA,CAAtD,CADR,CADiB,CAGjB,CAAChD,UAAU,CAAE,2CAAb,CACEC,IAAI,CAAE,CAACC,QAAQ,CAAEnB,CAAS,CAACT,MAArB,CAA6BkD,QAAQ,CAAE,CAAvC,CADR,CAHiB,CAAV,CAAX,CAOA3B,CAAQ,CAAC,CAAD,CAAR,CAAYW,IAAZ,CAAiB,SAASoB,CAAT,CAAkB,CAC/B,MAAO5D,CAAAA,CAAS,CAAC6D,MAAV,CAZM,kCAYN,CAA6BD,CAA7B,CACV,CAFD,EAGCpB,IAHD,CAGM,SAASsB,CAAT,CAAeC,CAAf,CAAmB,CACrB,MAAO/D,CAAAA,CAAS,CAACgE,WAAV,CAAsBnE,CAAC,CAAC,kBAdlB,wBAckB,CAAgC,KAAjC,CAAvB,CAA+DiE,CAA/D,CAAqEC,CAArE,CACV,CALD,EAMCvB,IAND,CAMMV,CAAc,CAACS,OANrB,EAOCE,KAPD,CAOO3C,CAAY,CAAC2B,SAPpB,CAQH,CAtBD,CAuBH,CAED5B,CAAC,CAAC,kCAAD,CAAD,CAAoCqF,KAApC,CAA0C,SAASlC,CAAT,CAAY,CAClD,GAAIlB,CAAAA,CAAc,CAAG,GAAI1B,CAAAA,CAAzB,CACA4C,CAAC,CAACmC,cAAF,GAEApE,CAAS,CAAC2B,cAAV,GACKF,IADL,CACUV,CAAc,CAACS,OADzB,EAEKE,KAFL,EAGH,CAPD,EAQA5C,CAAC,CAAC,0CAAD,CAAD,CAA4CqF,KAA5C,CAAkD,SAASlC,CAAT,CAAY,CAC1DA,CAAC,CAACmC,cAAF,GAEA,GAAIhB,CAAAA,CAAQ,CAAGtE,CAAC,CAACmD,CAAC,CAAC+B,MAAH,CAAD,CAAYK,OAAZ,CAAoB,WAApB,EAAiCzD,IAAjC,CAAsC,IAAtC,CAAf,CACAZ,CAAS,CAACqD,aAAV,CAAwBD,CAAxB,CACH,CALD,CAMH,CA5CD,CA8CA,MAAiD9D,CAAAA,CACpD,CAlVK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle add/remove competency links.\n *\n * @module     tool_lp/competencies\n * @package    tool_lp\n * @copyright  2015 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery',\n        'core/notification',\n        'core/ajax',\n        'core/templates',\n        'core/str',\n        'tool_lp/competencypicker',\n        'tool_lp/dragdrop-reorder',\n        'core/pending'],\n       function($, notification, ajax, templates, str, Picker, dragdrop, Pending) {\n\n    /**\n     * Constructor\n     *\n     * @param {Number} itemid\n     * @param {String} itemtype\n     * @param {Number} pagectxid\n     */\n    var competencies = function(itemid, itemtype, pagectxid) {\n        this.itemid = itemid;\n        this.itemtype = itemtype;\n        this.pageContextId = pagectxid;\n        this.pickerInstance = null;\n\n        $('[data-region=\"actions\"] button').prop('disabled', false);\n        this.registerEvents();\n        this.registerDragDrop();\n    };\n\n    /**\n     * Initialise the drag/drop code.\n     * @method registerDragDrop\n     */\n    competencies.prototype.registerDragDrop = function() {\n        var localthis = this;\n        // Init this module.\n        str.get_string('movecompetency', 'tool_lp').done(\n            function(movestring) {\n                dragdrop.dragdrop('movecompetency',\n                                  movestring,\n                                  {identifier: 'movecompetency', component: 'tool_lp'},\n                                  {identifier: 'movecompetencyafter', component: 'tool_lp'},\n                                  'drag-samenode',\n                                  'drag-parentnode',\n                                  'drag-handlecontainer',\n                                  function(drag, drop) {\n                                      localthis.handleDrop(drag, drop);\n                                  });\n            }\n        ).fail(notification.exception);\n\n    };\n\n    /**\n     * Handle a drop from a drag/drop operation.\n     *\n     * @method handleDrop\n     * @param {DOMNode} drag The dragged node.\n     * @param {DOMNode} drop The dropped on node.\n     */\n    competencies.prototype.handleDrop = function(drag, drop) {\n        var fromid = $(drag).data('id');\n        var toid = $(drop).data('id');\n        var localthis = this;\n        var requests = [];\n        var pendingPromise = new Pending('tool_lp/competencies:handleDrop');\n\n        if (localthis.itemtype == 'course') {\n            requests = ajax.call([\n                {\n                    methodname: 'core_competency_reorder_course_competency',\n                    args: {courseid: localthis.itemid, competencyidfrom: fromid, competencyidto: toid}\n                }\n            ]);\n        } else if (localthis.itemtype == 'template') {\n            requests = ajax.call([\n                {\n                    methodname: 'core_competency_reorder_template_competency',\n                    args: {templateid: localthis.itemid, competencyidfrom: fromid, competencyidto: toid}\n                }\n            ]);\n        } else if (localthis.itemtype == 'plan') {\n            requests = ajax.call([\n                {\n                    methodname: 'core_competency_reorder_plan_competency',\n                    args: {planid: localthis.itemid, competencyidfrom: fromid, competencyidto: toid}\n                }\n            ]);\n        } else {\n            pendingPromise.resolve();\n            return;\n        }\n\n        requests[0]\n        .then(pendingPromise.resolve)\n        .catch(notification.exception);\n    };\n\n    /**\n     * Pick a competency\n     *\n     * @method pickCompetency\n     * @return {Promise}\n     */\n    competencies.prototype.pickCompetency = function() {\n        var self = this;\n        var requests;\n        var pagerender;\n        var pageregion;\n        var pageContextIncludes;\n\n        if (!self.pickerInstance) {\n            if (self.itemtype === 'template' || self.itemtype === 'course') {\n                pageContextIncludes = 'parents';\n            }\n            self.pickerInstance = new Picker(self.pageContextId, false, pageContextIncludes);\n            self.pickerInstance.on('save', function(e, data) {\n                var compIds = data.competencyIds;\n                var pendingPromise = new Pending();\n\n                if (self.itemtype === \"course\") {\n                    requests = [];\n\n                    $.each(compIds, function(index, compId) {\n                        requests.push({\n                            methodname: 'core_competency_add_competency_to_course',\n                            args: {courseid: self.itemid, competencyid: compId}\n                        });\n                    });\n                    requests.push({\n                        methodname: 'tool_lp_data_for_course_competencies_page',\n                        args: {courseid: self.itemid, moduleid: 0}\n                    });\n\n                    pagerender = 'tool_lp/course_competencies_page';\n                    pageregion = 'coursecompetenciespage';\n\n                } else if (self.itemtype === \"template\") {\n                    requests = [];\n\n                    $.each(compIds, function(index, compId) {\n                        requests.push({\n                            methodname: 'core_competency_add_competency_to_template',\n                            args: {templateid: self.itemid, competencyid: compId}\n                        });\n                    });\n                    requests.push({\n                        methodname: 'tool_lp_data_for_template_competencies_page',\n                        args: {templateid: self.itemid, pagecontext: {contextid: self.pageContextId}}\n                    });\n                    pagerender = 'tool_lp/template_competencies_page';\n                    pageregion = 'templatecompetenciespage';\n                } else if (self.itemtype === \"plan\") {\n                    requests = [];\n\n                    $.each(compIds, function(index, compId) {\n                        requests.push({\n                            methodname: 'core_competency_add_competency_to_plan',\n                            args: {planid: self.itemid, competencyid: compId}\n                        });\n                    });\n                    requests.push({\n                         methodname: 'tool_lp_data_for_plan_page',\n                         args: {planid: self.itemid}\n                    });\n                    pagerender = 'tool_lp/plan_page';\n                    pageregion = 'plan-page';\n                }\n                ajax.call(requests)[requests.length - 1]\n                .then(function(context) {\n                    return templates.render(pagerender, context);\n                })\n                .then(function(html, js) {\n                    templates.replaceNode($('[data-region=\"' + pageregion + '\"]'), html, js);\n                    return;\n                })\n                .then(pendingPromise.resolve)\n                .catch(notification.exception);\n            });\n        }\n\n        return self.pickerInstance.display();\n    };\n\n    /**\n     * Delete the link between competency and course, template or plan. Reload the page.\n     *\n     * @method doDelete\n     * @param {int} deleteid The id of record to delete.\n     */\n    competencies.prototype.doDelete = function(deleteid) {\n        var localthis = this;\n        var requests = [];\n        var pagerender = '';\n        var pageregion = '';\n        var pendingPromise = new Pending('tool_lp/competencies:doDelete');\n\n        // Delete the link and reload the page template.\n        if (localthis.itemtype == 'course') {\n            requests = ajax.call([\n                {methodname: 'core_competency_remove_competency_from_course',\n                    args: {courseid: localthis.itemid, competencyid: deleteid}},\n                {methodname: 'tool_lp_data_for_course_competencies_page',\n                    args: {courseid: localthis.itemid, moduleid: 0}}\n            ]);\n            pagerender = 'tool_lp/course_competencies_page';\n            pageregion = 'coursecompetenciespage';\n        } else if (localthis.itemtype == 'template') {\n            requests = ajax.call([\n                {methodname: 'core_competency_remove_competency_from_template',\n                    args: {templateid: localthis.itemid, competencyid: deleteid}},\n                {methodname: 'tool_lp_data_for_template_competencies_page',\n                    args: {templateid: localthis.itemid, pagecontext: {contextid: localthis.pageContextId}}}\n            ]);\n            pagerender = 'tool_lp/template_competencies_page';\n            pageregion = 'templatecompetenciespage';\n        } else if (localthis.itemtype == 'plan') {\n            requests = ajax.call([\n                {methodname: 'core_competency_remove_competency_from_plan',\n                    args: {planid: localthis.itemid, competencyid: deleteid}},\n                {methodname: 'tool_lp_data_for_plan_page',\n                    args: {planid: localthis.itemid}}\n            ]);\n            pagerender = 'tool_lp/plan_page';\n            pageregion = 'plan-page';\n        }\n\n        requests[1]\n        .then(function(context) {\n            return templates.render(pagerender, context);\n        })\n        .then(function(html, js) {\n            return templates.replaceNode($('[data-region=\"' + pageregion + '\"]'), html, js);\n        })\n        .then(pendingPromise.resolve)\n        .catch(notification.exception);\n\n    };\n\n    /**\n     * Show a confirm dialogue before deleting a competency.\n     *\n     * @method deleteHandler\n     * @param {int} deleteid The id of record to delete.\n     */\n    competencies.prototype.deleteHandler = function(deleteid) {\n        var localthis = this;\n        var message;\n\n        if (localthis.itemtype == 'course') {\n            message = 'unlinkcompetencycourse';\n        } else if (localthis.itemtype == 'template') {\n            message = 'unlinkcompetencytemplate';\n        } else if (localthis.itemtype == 'plan') {\n            message = 'unlinkcompetencyplan';\n        } else {\n            return;\n        }\n\n        var pendingPromise = new Pending('tool_lp/competencies:deleteHandler');\n        ajax.call([{\n            methodname: 'core_competency_read_competency',\n            args: {id: deleteid}\n        }])[0]\n        .then(function(competency) {\n            return str.get_strings([\n                {key: 'confirm', component: 'moodle'},\n                {key: message, component: 'tool_lp', param: competency.shortname},\n                {key: 'confirm', component: 'moodle'},\n                {key: 'cancel', component: 'moodle'},\n            ]);\n        })\n        .then(function(strings) {\n            return notification.confirm(\n                strings[0], // Confirm.\n                strings[1], // Unlink the competency X from the course?\n                strings[2], // Confirm.\n                strings[3], // Cancel.\n                function() {\n                    localthis.doDelete(deleteid);\n                }\n            );\n        })\n        .then(pendingPromise.resolve)\n        .catch(notification.exception);\n    };\n\n    /**\n     * Register the javascript event handlers for this page.\n     *\n     * @method registerEvents\n     */\n    competencies.prototype.registerEvents = function() {\n        var localthis = this;\n\n        if (localthis.itemtype == 'course') {\n            // Course completion rule handling.\n            $('[data-region=\"coursecompetenciespage\"]').on('change', 'select[data-field=\"ruleoutcome\"]', function(e) {\n                var pendingPromise = new Pending();\n                var requests = [];\n                var pagerender = 'tool_lp/course_competencies_page';\n                var pageregion = 'coursecompetenciespage';\n                var coursecompetencyid = $(e.target).data('id');\n                var ruleoutcome = $(e.target).val();\n                requests = ajax.call([\n                    {methodname: 'core_competency_set_course_competency_ruleoutcome',\n                      args: {coursecompetencyid: coursecompetencyid, ruleoutcome: ruleoutcome}},\n                    {methodname: 'tool_lp_data_for_course_competencies_page',\n                      args: {courseid: localthis.itemid, moduleid: 0}}\n                ]);\n\n                requests[1].then(function(context) {\n                    return templates.render(pagerender, context);\n                })\n                .then(function(html, js) {\n                    return templates.replaceNode($('[data-region=\"' + pageregion + '\"]'), html, js);\n                })\n                .then(pendingPromise.resolve)\n                .catch(notification.exception);\n            });\n        }\n\n        $('[data-region=\"actions\"] button').click(function(e) {\n            var pendingPromise = new Pending();\n            e.preventDefault();\n\n            localthis.pickCompetency()\n                .then(pendingPromise.resolve)\n                .catch();\n        });\n        $('[data-action=\"delete-competency-link\"]').click(function(e) {\n            e.preventDefault();\n\n            var deleteid = $(e.target).closest('[data-id]').data('id');\n            localthis.deleteHandler(deleteid);\n        });\n    };\n\n    return /** @alias module:tool_lp/competencies */ competencies;\n});\n"],"file":"competencies.min.js"}