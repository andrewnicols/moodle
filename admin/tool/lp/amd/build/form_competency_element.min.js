define ("tool_lp/form_competency_element",["jquery","tool_lp/competencypicker","core/ajax","core/notification","core/templates"],function($,Picker,Ajax,Notification,Templates){var pickerInstance=null,pageContextId=1,renderCompetencies=function(){var currentCompetencies=$("[data-action=\"competencies\"]").val(),requests=[],i=0;if(""!=currentCompetencies){currentCompetencies=currentCompetencies.split(",");for(i=0;i<currentCompetencies.length;i++){requests[requests.length]={methodname:"core_competency_read_competency",args:{id:currentCompetencies[i]}}}}$.when.apply($,Ajax.call(requests,!1)).then(function(){var i=0,competencies=[];for(i=0;i<arguments.length;i++){competencies[i]=arguments[i]}return Templates.render("tool_lp/form_competency_list",{competencies:competencies})}).then(function(html,js){Templates.replaceNode($("[data-region=\"competencies\"]"),html,js);return!0}).fail(Notification.exception);return!0},unpickCompetenciesHandler=function(e){var currentCompetencies=$("[data-action=\"competencies\"]").val().split(","),newCompetencies=[],i,toRemove=$(e.currentTarget).data("id");for(i=0;i<currentCompetencies.length;i++){if(currentCompetencies[i]!=toRemove){newCompetencies[newCompetencies.length]=currentCompetencies[i]}}$("[data-action=\"competencies\"]").val(newCompetencies.join(","));return renderCompetencies()},pickCompetenciesHandler=function(){var currentCompetencies=$("[data-action=\"competencies\"]").val().split(",");if(!pickerInstance){pickerInstance=new Picker(pageContextId,!1,"parents",!0);pickerInstance.on("save",function(e,data){var before=$("[data-action=\"competencies\"]").val(),compIds=data.competencyIds;if(""!=before){compIds=compIds.concat(before.split(","))}var value=compIds.join(",");$("[data-action=\"competencies\"]").val(value);return renderCompetencies()})}pickerInstance.setDisallowedCompetencyIDs(currentCompetencies);pickerInstance.display()};return{init:function init(contextId){pageContextId=contextId;renderCompetencies();$("[data-action=\"select-competencies\"]").on("click",pickCompetenciesHandler);$("body").on("click","[data-action=\"deselect-competency\"]",unpickCompetenciesHandler)}}});
//# sourceMappingURL=form_competency_element.min.js.map
