define ("tool_lp/menubar",["jquery"],function($){var documentClickHandlerRegistered=!1,menuActive=!1,closeAllSubMenus=function(){$(".tool-lp-menu .tool-lp-sub-menu").attr("aria-hidden","true");menuActive=!1},Menubar=function(menuRoot,handlers){this.menuRoot=menuRoot;this.handlers=handlers;this.rootMenus=this.menuRoot.children("li");this.subMenus=this.rootMenus.children("ul");this.subMenuItems=this.subMenus.children("li");this.allItems=this.rootMenus.add(this.subMenuItems);this.activeItem=null;this.isChildOpen=!1;this.keys={tab:9,enter:13,esc:27,space:32,left:37,up:38,right:39,down:40};this.addAriaAttributes();this.addEventListeners()};Menubar.prototype.openSubMenu=function(menu){this.setOpenDirection();closeAllSubMenus();menu.attr("aria-hidden","false");menuActive=!0};Menubar.prototype.addEventListeners=function(){var currentThis=this;if(!1===documentClickHandlerRegistered){$(document).click(function(){if(menuActive){closeAllSubMenus()}});documentClickHandlerRegistered=!0}this.subMenuItems.mouseenter(function(){$(this).addClass("menu-hover");return!0});this.subMenuItems.mouseout(function(){$(this).removeClass("menu-hover");return!0});this.allItems.click(function(e){return currentThis.handleClick($(this),e)});this.allItems.keydown(function(e){return currentThis.handleKeyDown($(this),e)});this.allItems.focus(function(){return currentThis.handleFocus($(this))});this.allItems.blur(function(){return currentThis.handleBlur($(this))})};Menubar.prototype.handleClick=function(item,e){e.stopPropagation();var parentUL=item.parent();if(parentUL.is(".tool-lp-menu")){if("true"==item.children("ul").first().attr("aria-hidden")){this.openSubMenu(item.children("ul").first())}else{item.children("ul").first().attr("aria-hidden","true")}}else{this.allItems.removeClass("menu-hover menu-focus");this.activeItem=null;this.menuRoot.find("ul").not(".root-level").attr("aria-hidden","true");var anchor=item.find("a").first(),clickEvent=new $.Event("click");clickEvent.target=anchor;var eventHandled=!1;if(this.handlers){$.each(this.handlers,function(selector,handler){if(eventHandled){return}if(0<item.find(selector).length){var callable=$.proxy(handler,anchor);eventHandled=!1===callable(clickEvent)||clickEvent.isDefaultPrevented()}})}if(!eventHandled&&"#"!==anchor.attr("href")){window.location.href=anchor.attr("href")}}return!1};Menubar.prototype.handleFocus=function(item){if(null===this.activeItem){this.activeItem=item}else if(item[0]!=this.activeItem[0]){return!0}var parentItems=this.activeItem.parentsUntil("ul.tool-lp-menu").filter("li");this.allItems.removeClass("menu-focus");this.activeItem.addClass("menu-focus");parentItems.addClass("menu-focus");if(!0===this.isChildOpen){var itemUL=item.parent();if(itemUL.is(".tool-lp-menu")&&"true"==item.attr("aria-haspopup")){this.openSubMenu(item.children("ul").first())}}return!0};Menubar.prototype.handleBlur=function(item){item.removeClass("menu-focus");return!0};Menubar.prototype.setOpenDirection=function(){var pos=this.menuRoot.offset(),isRTL=$(document.body).hasClass("dir-rtl"),heightmenuRoot=this.rootMenus.outerHeight(),widthmenuRoot=this.rootMenus.outerWidth(),subMenuContainer=this.rootMenus.find("ul.tool-lp-sub-menu");subMenuContainer.css("margin-right","");subMenuContainer.css("margin-left","");subMenuContainer.css("margin-top","");subMenuContainer.attr("aria-hidden",!1);var menuRealWidth=subMenuContainer.outerWidth(),menuRealHeight=subMenuContainer.outerHeight(),margintop=null,marginright=null,marginleft=null,top=pos.top-$(window).scrollTop();if(top+menuRealHeight>$(window).height()){margintop=menuRealHeight+heightmenuRoot;subMenuContainer.css("margin-top","-"+margintop+"px")}if(isRTL){if(0>pos.left-menuRealWidth){marginright=menuRealWidth-widthmenuRoot;subMenuContainer.css("margin-right","-"+marginright+"px")}}else{if(pos.left+menuRealWidth>$(window).width()){marginleft=menuRealWidth-widthmenuRoot;subMenuContainer.css("margin-left","-"+marginleft+"px")}}if(!0){this.menuRoot.addClass("tool-lp-menu-open-left")}else{this.menuRoot.removeClass("tool-lp-menu-open-left")}};Menubar.prototype.handleKeyDown=function(item,e){if(e.altKey||e.ctrlKey){return!0}switch(e.keyCode){case this.keys.tab:{this.menuRoot.find("ul").attr("aria-hidden","true");this.allItems.removeClass("menu-focus");this.activeItem=null;this.isChildOpen=!1;break}case this.keys.esc:{var itemUL=item.parent();if(itemUL.is(".tool-lp-menu")){item.children("ul").first().attr("aria-hidden","true")}else{this.activeItem=itemUL.parent();this.isChildOpen=!1;this.activeItem.focus();itemUL.attr("aria-hidden","true")}e.stopPropagation();return!1}case this.keys.enter:case this.keys.space:{return this.handleClick(item,e)}case this.keys.left:{this.activeItem=this.moveToPrevious(item);this.activeItem.focus();e.stopPropagation();return!1}case this.keys.right:{this.activeItem=this.moveToNext(item);this.activeItem.focus();e.stopPropagation();return!1}case this.keys.up:{this.activeItem=this.moveUp(item);this.activeItem.focus();e.stopPropagation();return!1}case this.keys.down:{this.activeItem=this.moveDown(item);this.activeItem.focus();e.stopPropagation();return!1}}return!0};Menubar.prototype.moveToNext=function(item){var itemUL=item.parent(),menuItems=itemUL.children("li"),menuNum=menuItems.length,menuIndex=menuItems.index(item),newItem=null,childMenu=null;if(itemUL.is(".tool-lp-menu")){if(menuIndex<menuNum-1){newItem=item.next()}else{newItem=menuItems.first()}if("true"==item.attr("aria-haspopup")){childMenu=item.children("ul").first();if("false"==childMenu.attr("aria-hidden")){childMenu.attr("aria-hidden","true");this.isChildOpen=!0}}item.removeClass("menu-focus");if("true"===newItem.attr("aria-haspopup")&&!0===this.isChildOpen){childMenu=newItem.children("ul").first();this.openSubMenu(childMenu)}}else{if("true"==item.attr("aria-haspopup")){childMenu=item.children("ul").first();newItem=childMenu.children("li").first();this.openSubMenu(childMenu)}else{var parentMenus=null,rootItem=null;parentMenus=item.parentsUntil("ul.tool-lp-menu").filter("ul").not(".tool-lp-menu");parentMenus.attr("aria-hidden","true");parentMenus.find("li").removeClass("menu-focus");parentMenus.last().parent().removeClass("menu-focus");rootItem=parentMenus.last().parent();menuIndex=this.rootMenus.index(rootItem);if(menuIndex<this.rootMenus.length-1){newItem=rootItem.next()}else{newItem=this.rootMenus.first()}newItem.addClass("menu-focus");if("true"==newItem.attr("aria-haspopup")){childMenu=newItem.children("ul").first();newItem=childMenu.children("li").first();this.openSubMenu(childMenu);this.isChildOpen=!0}}}return newItem};Menubar.prototype.moveToPrevious=function(item){var itemUL=item.parent(),menuItems=itemUL.children("li"),menuIndex=menuItems.index(item),newItem=null,childMenu=null;if(itemUL.is(".tool-lp-menu")){if(0<menuIndex){newItem=item.prev()}else{newItem=menuItems.last()}if("true"==item.attr("aria-haspopup")){childMenu=item.children("ul").first();if("false"==childMenu.attr("aria-hidden")){childMenu.attr("aria-hidden","true");this.isChildOpen=!0}}item.removeClass("menu-focus");if("true"===newItem.attr("aria-haspopup")&&!0===this.isChildOpen){childMenu=newItem.children("ul").first();this.openSubMenu(childMenu)}}else{var parentLI=itemUL.parent(),parentUL=parentLI.parent();if(!parentUL.is(".tool-lp-menu")){newItem=itemUL.parent();itemUL.attr("aria-hidden","true");item.removeClass("menu-focus")}else{itemUL.attr("aria-hidden","true");item.removeClass("menu-focus");parentLI.removeClass("menu-focus");menuIndex=this.rootMenus.index(parentLI);if(0<menuIndex){newItem=parentLI.prev()}else{newItem=this.rootMenus.last()}newItem.addClass("menu-focus");if("true"==newItem.attr("aria-haspopup")){childMenu=newItem.children("ul").first();this.openSubMenu(childMenu);this.isChildOpen=!0;newItem=childMenu.children("li").first()}}}return newItem};Menubar.prototype.moveDown=function(item,startChr){var itemUL=item.parent(),menuItems=itemUL.children("li").not(".separator"),menuNum=menuItems.length,menuIndex=menuItems.index(item),newItem=null,newItemUL=null;if(itemUL.is(".tool-lp-menu")){if("true"!=item.attr("aria-haspopup")){return item}newItemUL=item.children("ul").first();newItem=newItemUL.children("li").first();this.openSubMenu(newItemUL);return newItem}if(startChr){var match=!1,curNdx=menuIndex+1;if(curNdx==menuNum){curNdx=0}while(curNdx!=menuIndex){var titleChr=menuItems.eq(curNdx).html().charAt(0);if(titleChr.toLowerCase()==startChr){match=!0;break}curNdx=curNdx+1;if(curNdx==menuNum){curNdx=0}}if(!0==match){newItem=menuItems.eq(curNdx);item.removeClass("menu-focus");return newItem}else{return item}}else{if(menuIndex<menuNum-1){newItem=menuItems.eq(menuIndex+1)}else{newItem=menuItems.first()}}item.removeClass("menu-focus");return newItem};Menubar.prototype.moveUp=function(item){var itemUL=item.parent(),menuItems=itemUL.children("li").not(".separator"),menuIndex=menuItems.index(item),newItem=null;if(itemUL.is(".tool-lp-menu")){return item}if(0<menuIndex){newItem=menuItems.eq(menuIndex-1)}else{newItem=menuItems.last()}item.removeClass("menu-focus");return newItem};Menubar.prototype.addAriaAttributes=function(){this.menuRoot.attr("role","menubar");this.rootMenus.attr("role","menuitem");this.rootMenus.attr("tabindex","0");this.rootMenus.attr("aria-haspopup","true");this.subMenus.attr("role","menu");this.subMenus.attr("aria-hidden","true");this.subMenuItems.attr("role","menuitem");this.subMenuItems.attr("tabindex","-1");this.menuRoot.addClass("tool-lp-menu");this.allItems.addClass("tool-lp-menu-item");this.rootMenus.addClass("tool-lp-root-menu");this.subMenus.addClass("tool-lp-sub-menu");this.subMenuItems.addClass("dropdown-item")};return{enhance:function enhance(selector,handler){$(selector).each(function(index,element){var menuRoot=$(element);if(!0!==menuRoot.data("menubarEnhanced")){new Menubar(menuRoot,handler);menuRoot.data("menubarEnhanced",!0)}})},closeAll:closeAllSubMenus}});
//# sourceMappingURL=menubar.min.js.map
