{"version":3,"sources":["../src/grade_user_competency_inline.js"],"names":["define","$","notification","ajax","log","GradeDialogue","EventBase","ScaleValues","InlineEditor","selector","scaleId","competencyId","userId","planId","courseId","chooseStr","prototype","constructor","apply","trigger","length","Error","_scaleId","_competencyId","_userId","_planId","_courseId","_chooseStr","_setUp","click","e","preventDefault","_dialogue","display","bind","_methodName","_args","competencyid","planid","courseid","userid","Object","create","options","self","M","util","js_pending","promise","get_values","then","scalevalues","push","value","name","i","optionConfig","id","dialogue","on","data","args","grade","rating","note","call","methodname","done","evidence","_trigger","fail","exception","js_complete"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module to enable inline editing of a comptency grade.\n *\n * @package    tool_lp\n * @copyright  2015 Damyon Wiese\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery',\n        'core/notification',\n        'core/ajax',\n        'core/log',\n        'tool_lp/grade_dialogue',\n        'tool_lp/event_base',\n        'tool_lp/scalevalues',\n    ], function($, notification, ajax, log, GradeDialogue, EventBase, ScaleValues) {\n\n    /**\n     * InlineEditor\n     *\n     * @param {String} selector The selector to trigger the grading.\n     * @param {Number} scaleId The id of the scale for this competency.\n     * @param {Number} competencyId The id of the competency.\n     * @param {Number} userId The id of the user.\n     * @param {Number} planId The id of the plan.\n     * @param {Number} courseId The id of the course.\n     * @param {String} chooseStr Language string for choose a rating.\n     */\n    var InlineEditor = function(selector, scaleId, competencyId, userId, planId, courseId, chooseStr) {\n        EventBase.prototype.constructor.apply(this, []);\n\n        var trigger = $(selector);\n        if (!trigger.length) {\n            throw new Error('Could not find the trigger');\n        }\n\n        this._scaleId = scaleId;\n        this._competencyId = competencyId;\n        this._userId = userId;\n        this._planId = planId;\n        this._courseId = courseId;\n        this._chooseStr = chooseStr;\n        this._setUp();\n\n        trigger.click(function(e) {\n            e.preventDefault();\n            this._dialogue.display();\n        }.bind(this));\n\n        if (this._planId) {\n            this._methodName = 'core_competency_grade_competency_in_plan';\n            this._args = {\n                competencyid: this._competencyId,\n                planid: this._planId\n            };\n        } else if (this._courseId) {\n            this._methodName = 'core_competency_grade_competency_in_course';\n            this._args = {\n                competencyid: this._competencyId,\n                courseid: this._courseId,\n                userid: this._userId\n            };\n        } else {\n            this._methodName = 'core_competency_grade_competency';\n            this._args = {\n                userid: this._userId,\n                competencyid: this._competencyId\n            };\n        }\n    };\n    InlineEditor.prototype = Object.create(EventBase.prototype);\n\n    /**\n     * Setup.\n     *\n     * @method _setUp\n     */\n    InlineEditor.prototype._setUp = function() {\n        var options = [],\n            self = this;\n\n        M.util.js_pending('tool_lp/grade_user_competency_inline:_setUp');\n        var promise = ScaleValues.get_values(self._scaleId);\n        promise.then(function(scalevalues) {\n            options.push({\n                value: '',\n                name: self._chooseStr\n            });\n\n            for (var i = 0; i < scalevalues.length; i++) {\n                var optionConfig = scalevalues[i];\n                options.push({\n                    value: optionConfig.id,\n                    name: optionConfig.name\n                });\n            }\n\n            return options;\n        })\n        .then(function(options) {\n            return new GradeDialogue(options);\n        })\n        .then(function(dialogue) {\n            dialogue.on('rated', function(e, data) {\n                var args = self._args;\n                args.grade = data.rating;\n                args.note = data.note;\n                ajax.call([{\n                    methodname: self._methodName,\n                    args: args,\n                    done: function(evidence) {\n                        self._trigger('competencyupdated', {args: args, evidence: evidence});\n                    },\n                    fail: notification.exception\n                }]);\n            });\n\n            return dialogue;\n        })\n        .then(function(dialogue) {\n            self._dialogue = dialogue;\n\n            M.util.js_complete('tool_lp/grade_user_competency_inline:_setUp');\n            return;\n        })\n        .fail(notification.exception);\n    };\n\n    /** @type {Number} The scale id for this competency. */\n    InlineEditor.prototype._scaleId = null;\n    /** @type {Number} The id of the competency. */\n    InlineEditor.prototype._competencyId = null;\n    /** @type {Number} The id of the user. */\n    InlineEditor.prototype._userId = null;\n    /** @type {Number} The id of the plan. */\n    InlineEditor.prototype._planId = null;\n    /** @type {Number} The id of the course. */\n    InlineEditor.prototype._courseId = null;\n    /** @type {String} The text for Choose rating. */\n    InlineEditor.prototype._chooseStr = null;\n    /** @type {GradeDialogue} The grading dialogue. */\n    InlineEditor.prototype._dialogue = null;\n\n    return /** @alias module:tool_lp/grade_user_competency_inline */ InlineEditor;\n\n});\n"],"file":"grade_user_competency_inline.min.js"}