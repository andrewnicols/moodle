define ("tool_lp/tree",["jquery","core/url","core/log"],function($,url,log){var expandedImage=$("<img alt=\"\" src=\""+url.imageUrl("t/expanded")+"\"/>"),collapsedImage=$("<img alt=\"\" src=\""+url.imageUrl("t/collapsed")+"\"/>"),Tree=function(selector,multiSelect){this.treeRoot=$(selector);this.multiSelect="undefined"==typeof multiSelect||!0===multiSelect;this.items=this.treeRoot.find("li");this.expandAll=20>this.items.length;this.parents=this.treeRoot.find("li:has(ul)");if(multiSelect){this.treeRoot.attr("aria-multiselectable","true")}this.items.attr("aria-selected","false");this.visibleItems=null;this.activeItem=null;this.lastActiveItem=null;this.keys={tab:9,enter:13,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,eight:56,asterisk:106};this.init();this.bindEventHandlers()};Tree.prototype.init=function(){this.parents.attr("aria-expanded","true");this.parents.prepend(expandedImage.clone());this.items.attr("role","tree-item");this.items.attr("tabindex","-1");this.parents.attr("role","group");this.treeRoot.attr("role","tree");this.visibleItems=this.treeRoot.find("li");var thisObj=this;if(!this.expandAll){this.parents.each(function(){thisObj.collapseGroup($(this))});this.expandGroup(this.parents.first())}};Tree.prototype.expandGroup=function(item){var group=item.children("ul");group.show().attr("aria-hidden","false");item.attr("aria-expanded","true");item.children("img").attr("src",expandedImage.attr("src"));this.visibleItems=this.treeRoot.find("li:visible")};Tree.prototype.collapseGroup=function(item){var group=item.children("ul");group.hide().attr("aria-hidden","true");item.attr("aria-expanded","false");item.children("img").attr("src",collapsedImage.attr("src"));this.visibleItems=this.treeRoot.find("li:visible")};Tree.prototype.toggleGroup=function(item){if("true"==item.attr("aria-expanded")){this.collapseGroup(item)}else{this.expandGroup(item)}};Tree.prototype.triggerChange=function(){var allSelected=this.items.filter("[aria-selected=true]");if(!this.multiSelect){allSelected=allSelected.first()}this.treeRoot.trigger("selectionchanged",{selected:allSelected})};Tree.prototype.multiSelectItem=function(item){if(!this.multiSelect){this.items.attr("aria-selected","false")}else if(null!==this.lastActiveItem){var lastIndex=this.visibleItems.index(this.lastActiveItem),currentIndex=this.visibleItems.index(this.activeItem),oneItem=null;while(lastIndex<currentIndex){oneItem=$(this.visibleItems.get(lastIndex));oneItem.attr("aria-selected","true");lastIndex++}while(lastIndex>currentIndex){oneItem=$(this.visibleItems.get(lastIndex));oneItem.attr("aria-selected","true");lastIndex--}}item.attr("aria-selected","true");this.triggerChange()};Tree.prototype.selectItem=function(item){var walk=item.parent();while("tree"!=walk.attr("role")){walk=walk.parent();if("false"==walk.attr("aria-expanded")){this.expandGroup(walk)}walk=walk.parent()}this.items.attr("aria-selected","false");item.attr("aria-selected","true");this.triggerChange()};Tree.prototype.toggleItem=function(item){if(!this.multiSelect){this.selectItem(item);return}var current=item.attr("aria-selected");if("true"===current){current="false"}else{current="true"}item.attr("aria-selected",current);this.triggerChange()};Tree.prototype.updateFocus=function(item){this.lastActiveItem=this.activeItem;this.activeItem=item;var walk=item.parent();while("tree"!=walk.attr("role")){walk=walk.parent();if("false"==walk.attr("aria-expanded")){this.expandGroup(walk)}walk=walk.parent()}this.items.attr("tabindex","-1");item.attr("tabindex",0)};Tree.prototype.handleKeyDown=function(item,e){var currentIndex=this.visibleItems.index(item),newItem=null,hasKeyModifier=e.shiftKey||e.ctrlKey||e.metaKey||e.altKey,thisObj=this;switch(e.keyCode){case this.keys.home:{newItem=this.parents.first();newItem.focus();if(e.shiftKey){this.multiSelectItem(newItem)}else if(!hasKeyModifier){this.selectItem(newItem)}e.stopPropagation();return!1}case this.keys.end:{newItem=this.visibleItems.last();newItem.focus();if(e.shiftKey){this.multiSelectItem(newItem)}else if(!hasKeyModifier){this.selectItem(newItem)}e.stopPropagation();return!1}case this.keys.enter:case this.keys.space:{if(e.shiftKey){this.multiSelectItem(item)}else if(e.metaKey||e.ctrlKey){this.toggleItem(item)}else{this.selectItem(item)}e.stopPropagation();return!1}case this.keys.left:{if(item.has("ul")&&"true"==item.attr("aria-expanded")){this.collapseGroup(item)}else{var itemUL=item.parent(),itemParent=itemUL.parent();if(itemParent.is("li")){itemParent.focus();if(e.shiftKey){this.multiSelectItem(itemParent)}else if(!hasKeyModifier){this.selectItem(itemParent)}}}e.stopPropagation();return!1}case this.keys.right:{if(item.has("ul")&&"false"==item.attr("aria-expanded")){this.expandGroup(item)}else{newItem=item.children("ul").children("li").first();if(0<newItem.length){newItem.focus();if(e.shiftKey){this.multiSelectItem(newItem)}else if(!hasKeyModifier){this.selectItem(newItem)}}}e.stopPropagation();return!1}case this.keys.up:{if(0<currentIndex){var prev=this.visibleItems.eq(currentIndex-1);prev.focus();if(e.shiftKey){this.multiSelectItem(prev)}else if(!hasKeyModifier){this.selectItem(prev)}}e.stopPropagation();return!1}case this.keys.down:{if(currentIndex<this.visibleItems.length-1){var next=this.visibleItems.eq(currentIndex+1);next.focus();if(e.shiftKey){this.multiSelectItem(next)}else if(!hasKeyModifier){this.selectItem(next)}}e.stopPropagation();return!1}case this.keys.asterisk:{this.parents.each(function(){thisObj.expandGroup($(this))});e.stopPropagation();return!1}case this.keys.eight:{if(e.shiftKey){this.parents.each(function(){thisObj.expandGroup($(this))});e.stopPropagation()}return!1}}return!0};Tree.prototype.handleKeyPress=function(item,e){if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey){return!0}switch(e.keyCode){case this.keys.tab:{return!0}case this.keys.enter:case this.keys.home:case this.keys.end:case this.keys.left:case this.keys.right:case this.keys.up:case this.keys.down:{e.stopPropagation();return!1}default:{var chr=String.fromCharCode(e.which),match=!1,itemIndex=this.visibleItems.index(item),itemCount=this.visibleItems.length,currentIndex=itemIndex+1;if(currentIndex==itemCount){currentIndex=0}while(currentIndex!=itemIndex){var currentItem=this.visibleItems.eq(currentIndex),titleChr=currentItem.text().charAt(0);if(currentItem.has("ul")){titleChr=currentItem.find("span").text().charAt(0)}if(titleChr.toLowerCase()==chr){match=!0;break}currentIndex=currentIndex+1;if(currentIndex==itemCount){currentIndex=0}}if(!0===match){this.updateFocus(this.visibleItems.eq(currentIndex))}e.stopPropagation();return!1}}return!0};Tree.prototype.on=function(eventname,handler){if("selectionchanged"!==eventname){log.warning("Invalid custom event name for tree. Only \"selectionchanged\" is supported.")}else{this.treeRoot.on(eventname,handler)}};Tree.prototype.handleDblClick=function(item,e){if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey){return!0}this.updateFocus(item);this.toggleGroup(item);e.stopPropagation();return!1};Tree.prototype.handleExpandCollapseClick=function(item,e){this.toggleGroup(item);e.stopPropagation();return!1};Tree.prototype.handleClick=function(item,e){if(e.shiftKey){this.multiSelectItem(item)}else if(e.metaKey||e.ctrlKey){this.toggleItem(item)}else{this.selectItem(item)}this.updateFocus(item);e.stopPropagation();return!1};Tree.prototype.handleBlur=function(){return!0};Tree.prototype.handleFocus=function(item){this.updateFocus(item);return!0};Tree.prototype.bindEventHandlers=function(){var thisObj=this;this.parents.dblclick(function(e){return thisObj.handleDblClick($(this),e)});this.items.click(function(e){return thisObj.handleClick($(this),e)});this.items.children("img").click(function(e){return thisObj.handleExpandCollapseClick($(this).parent(),e)});this.items.keydown(function(e){return thisObj.handleKeyDown($(this),e)});this.items.keypress(function(e){return thisObj.handleKeyPress($(this),e)});this.items.focus(function(e){return thisObj.handleFocus($(this),e)});this.items.blur(function(e){return thisObj.handleBlur($(this),e)})};return Tree});
//# sourceMappingURL=tree.min.js.map
