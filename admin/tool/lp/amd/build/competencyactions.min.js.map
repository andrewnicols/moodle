{"version":3,"sources":["../src/competencyactions.js"],"names":["define","$","url","templates","notification","str","ajax","dragdrop","Ariatree","Dialogue","menubar","Picker","Outcomes","RuleConfig","Pending","treeModel","moveSource","moveTarget","pageContextId","pickerInstance","ruleConfigInstance","relatedTarget","taxonomiesConstants","rulesModules","selectedCompetencyId","addHandler","parent","data","params","competencyframeworkid","getCompetencyFrameworkId","pagecontextid","parentid","id","relocate","queryparams","param","window","location","relativeUrl","hasRule","get_strings","key","component","shortname","done","strings","confirm","fail","exception","doMove","frameworkid","requests","call","methodname","args","competencyid","search","val","reloadPage","confirmMove","targetComp","getCompetency","sourceComp","confirmMessage","showConfirm","path","indexOf","initMovePopup","popup","body","getContent","treeRoot","find","tree","on","evt","target","selected","show","close","addCompetencyChildren","competencies","i","length","haschildren","children","moveHandler","e","preventDefault","competency","searchtext","when","apply","framework","competenciestree","onecompetency","render","editHandler","context","newhtml","newjs","replaceWith","runTemplateJS","updateSearchHandler","moveUpHandler","moveDownHandler","seeCoursesHandler","courses","html","get_string","linkedcourses","relateCompetenciesHandler","pendingPromise","compIds","competencyIds","calls","each","index","value","push","relatedcompetencyid","promises","then","js","updatedRelatedCompetencies","resolve","catch","setDisallowedCompetencyIDs","display","ruleConfigHandler","setTargetCompetencyId","ruleConfigSaveHandler","config","update","idnumber","description","descriptionformat","ruletype","ruleoutcome","ruleconfig","promise","result","renderCompetencySummary","doDelete","success","alert","deleteCompetencyHandler","dragStart","originalEvent","dataTransfer","setData","allowDrop","dropEffect","dragEnter","addClass","dragLeave","removeClass","dropOver","getData","deleteRelatedHandler","relatedid","substr","removeRelated","triggerCompetencyViewedEvent","getTaxonomyAtLevel","level","constant","Deferred","showdeleterelatedaction","showrelatedcompetencies","showrule","pluginbaseurl","NONE","getString","name","modInfo","type","strs","rule","outcome","replaceNodeContents","strAddTaxonomy","strSelectedTaxonomy","selectionChanged","node","btn","actionMenu","selectedTitle","sublevel","closeAll","clone","remove","end","text","hide","getCompetencyLevel","parseTaxonomies","taxonomiesstr","all","split","unshift","init","model","pagectxid","taxonomies","rulesMods","enhance","bind","top"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle selection changes and actions on the competency tree.\n *\n * @module     tool_lp/competencyactions\n * @package    tool_lp\n * @copyright  2015 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery',\n        'core/url',\n        'core/templates',\n        'core/notification',\n        'core/str',\n        'core/ajax',\n        'tool_lp/dragdrop-reorder',\n        'tool_lp/tree',\n        'tool_lp/dialogue',\n        'tool_lp/menubar',\n        'tool_lp/competencypicker',\n        'tool_lp/competency_outcomes',\n        'tool_lp/competencyruleconfig',\n        'core/pending',\n        ],\n       function(\n            $, url, templates, notification, str, ajax, dragdrop, Ariatree, Dialogue, menubar, Picker, Outcomes, RuleConfig, Pending\n        ) {\n\n    // Private variables and functions.\n    /** @var {Object} treeModel - This is an object representing the nodes in the tree. */\n    var treeModel = null;\n    /** @var {Node} moveSource - The start of a drag operation */\n    var moveSource = null;\n    /** @var {Node} moveTarget - The end of a drag operation */\n    var moveTarget = null;\n    /** @var {Number} pageContextId The page context ID. */\n    var pageContextId;\n    /** @type {Object} Picker instance. */\n    var pickerInstance;\n    /** @type {Object} Rule config instance. */\n    var ruleConfigInstance;\n    /** @type {Object} The competency we're picking a relation to. */\n    var relatedTarget;\n    /** @type {Object} Taxonomy constants indexed per level. */\n    var taxonomiesConstants;\n    /** @type {Array} The rules modules. Values are object containing type, namd and amd. */\n    var rulesModules;\n    /** @type {Number} the selected competency ID. */\n    var selectedCompetencyId = null;\n\n    /**\n     * Respond to choosing the \"Add\" menu item for the selected node in the tree.\n     * @method addHandler\n     */\n    var addHandler = function() {\n        var parent = $('[data-region=\"competencyactions\"]').data('competency');\n\n        var params = {\n            competencyframeworkid: treeModel.getCompetencyFrameworkId(),\n            pagecontextid: pageContextId\n        };\n\n        if (parent !== null) {\n            // We are adding at a sub node.\n            params.parentid = parent.id;\n        }\n\n        var relocate = function() {\n            var queryparams = $.param(params);\n            window.location = url.relativeUrl('/admin/tool/lp/editcompetency.php?' + queryparams);\n        };\n\n        if (parent !== null && treeModel.hasRule(parent.id)) {\n            str.get_strings([\n                {key: 'confirm', component: 'moodle'},\n                {key: 'addingcompetencywillresetparentrule', component: 'tool_lp', param: parent.shortname},\n                {key: 'yes', component: 'core'},\n                {key: 'no', component: 'core'}\n            ]).done(function(strings) {\n                notification.confirm(\n                    strings[0],\n                    strings[1],\n                    strings[2],\n                    strings[3],\n                    relocate\n                );\n            }).fail(notification.exception);\n        } else {\n            relocate();\n        }\n    };\n\n    /**\n     * A source and destination has been chosen - so time to complete a move.\n     * @method doMove\n     */\n    var doMove = function() {\n        var frameworkid = $('[data-region=\"filtercompetencies\"]').data('frameworkid');\n        var requests = ajax.call([{\n            methodname: 'core_competency_set_parent_competency',\n            args: {competencyid: moveSource, parentid: moveTarget}\n        }, {\n            methodname: 'tool_lp_data_for_competencies_manage_page',\n            args: {competencyframeworkid: frameworkid,\n                    search: $('[data-region=\"filtercompetencies\"] input').val()}\n        }]);\n        requests[1].done(reloadPage).fail(notification.exception);\n    };\n\n    /**\n     * Confirms a competency move.\n     *\n     * @method confirmMove\n     */\n    var confirmMove = function() {\n        moveTarget = typeof moveTarget === \"undefined\" ? 0 : moveTarget;\n        if (moveTarget == moveSource) {\n            // No move to do.\n            return;\n        }\n\n        var targetComp = treeModel.getCompetency(moveTarget) || {},\n            sourceComp = treeModel.getCompetency(moveSource) || {},\n            confirmMessage = 'movecompetencywillresetrules',\n            showConfirm = false;\n\n        // We shouldn't be moving the competency to the same parent.\n        if (sourceComp.parentid == moveTarget) {\n            return;\n        }\n\n        // If we are moving to a child of self.\n        if (targetComp.path && targetComp.path.indexOf('/' + sourceComp.id + '/') >= 0) {\n            confirmMessage = 'movecompetencytochildofselfwillresetrules';\n\n            // Show a confirmation if self has rules, as they'll disappear.\n            showConfirm = showConfirm || treeModel.hasRule(sourceComp.id);\n        }\n\n        // Show a confirmation if the current parent, or the destination have rules.\n        showConfirm = showConfirm || (treeModel.hasRule(targetComp.id) || treeModel.hasRule(sourceComp.parentid));\n\n        // Show confirm, and/or do the things.\n        if (showConfirm) {\n            str.get_strings([\n                {key: 'confirm', component: 'moodle'},\n                {key: confirmMessage, component: 'tool_lp'},\n                {key: 'yes', component: 'moodle'},\n                {key: 'no', component: 'moodle'}\n            ]).done(function(strings) {\n                notification.confirm(\n                    strings[0], // Confirm.\n                    strings[1], // Delete competency X?\n                    strings[2], // Delete.\n                    strings[3], // Cancel.\n                    doMove\n                );\n            }).fail(notification.exception);\n\n        } else {\n            doMove();\n        }\n    };\n\n    /**\n     * A move competency popup was opened - initialise the aria tree in it.\n     * @method initMovePopup\n     * @param {dialogue} popup The tool_lp/dialogue that was created.\n     */\n    var initMovePopup = function(popup) {\n        var body = $(popup.getContent());\n        var treeRoot = body.find('[data-enhance=movetree]');\n        var tree = new Ariatree(treeRoot, false);\n        tree.on('selectionchanged', function(evt, params) {\n            var target = params.selected;\n            moveTarget = $(target).data('id');\n        });\n        treeRoot.show();\n\n        body.on('click', '[data-action=\"move\"]', function() {\n          popup.close();\n          confirmMove();\n        });\n        body.on('click', '[data-action=\"cancel\"]', function() {\n          popup.close();\n        });\n    };\n\n    /**\n     * Turn a flat list of competencies into a tree structure (recursive).\n     * @method addCompetencyChildren\n     * @param {Object} parent The current parent node in the tree\n     * @param {Object[]} competencies The flat list of competencies\n     */\n    var addCompetencyChildren = function(parent, competencies) {\n        var i;\n\n        for (i = 0; i < competencies.length; i++) {\n            if (competencies[i].parentid == parent.id) {\n                parent.haschildren = true;\n                competencies[i].children = [];\n                competencies[i].haschildren = false;\n                parent.children[parent.children.length] = competencies[i];\n                addCompetencyChildren(competencies[i], competencies);\n            }\n        }\n    };\n\n    /**\n     * A node was chosen and \"Move\" was selected from the menu. Open a popup to select the target.\n     * @param {Event} e\n     * @method moveHandler\n     */\n    var moveHandler = function(e) {\n        e.preventDefault();\n        var competency = $('[data-region=\"competencyactions\"]').data('competency');\n\n        // Remember what we are moving.\n        moveSource = competency.id;\n\n        // Load data for the template.\n        var requests = ajax.call([\n            {\n                methodname: 'core_competency_search_competencies',\n                args: {\n                    competencyframeworkid: competency.competencyframeworkid,\n                    searchtext: ''\n                }\n            }, {\n                methodname: 'core_competency_read_competency_framework',\n                args: {\n                    id: competency.competencyframeworkid\n                }\n            }\n        ]);\n\n        // When all data has arrived, continue.\n        $.when.apply(null, requests).done(function(competencies, framework) {\n\n            // Expand the list of competencies into a tree.\n            var i;\n            var competenciestree = [];\n            for (i = 0; i < competencies.length; i++) {\n                var onecompetency = competencies[i];\n                if (onecompetency.parentid == \"0\") {\n                    onecompetency.children = [];\n                    onecompetency.haschildren = 0;\n                    competenciestree[competenciestree.length] = onecompetency;\n                    addCompetencyChildren(onecompetency, competencies);\n                }\n            }\n\n            str.get_strings([\n                {key: 'movecompetency', component: 'tool_lp', param: competency.shortname},\n                {key: 'move', component: 'tool_lp'},\n                {key: 'cancel', component: 'moodle'}\n            ]).done(function(strings) {\n\n                var context = {\n                    framework: framework,\n                    competencies: competenciestree\n                };\n\n                templates.render('tool_lp/competencies_move_tree', context)\n                   .done(function(tree) {\n                       new Dialogue(\n                           strings[0], // Move competency x.\n                           tree, // The move tree.\n                           initMovePopup\n                       );\n\n                   }).fail(notification.exception);\n\n           }).fail(notification.exception);\n\n        }).fail(notification.exception);\n\n    };\n\n    /**\n     * Edit the selected competency.\n     * @method editHandler\n     */\n    var editHandler = function() {\n        var competency = $('[data-region=\"competencyactions\"]').data('competency');\n\n        var params = {\n            competencyframeworkid: treeModel.getCompetencyFrameworkId(),\n            id: competency.id,\n            parentid: competency.parentid,\n            pagecontextid: pageContextId\n        };\n\n        var queryparams = $.param(params);\n        window.location = url.relativeUrl('/admin/tool/lp/editcompetency.php?' + queryparams);\n    };\n\n    /**\n     * Re-render the page with the latest data.\n     * @param {Object} context\n     * @method reloadPage\n     */\n    var reloadPage = function(context) {\n        templates.render('tool_lp/manage_competencies_page', context)\n            .done(function(newhtml, newjs) {\n                $('[data-region=\"managecompetencies\"]').replaceWith(newhtml);\n                templates.runTemplateJS(newjs);\n            })\n           .fail(notification.exception);\n    };\n\n    /**\n     * Perform a search and render the page with the new search results.\n     * @param {Event} e\n     * @method updateSearchHandler\n     */\n    var updateSearchHandler = function(e) {\n        e.preventDefault();\n\n        var frameworkid = $('[data-region=\"filtercompetencies\"]').data('frameworkid');\n\n        var requests = ajax.call([{\n            methodname: 'tool_lp_data_for_competencies_manage_page',\n            args: {competencyframeworkid: frameworkid,\n                    search: $('[data-region=\"filtercompetencies\"] input').val()}\n        }]);\n        requests[0].done(reloadPage).fail(notification.exception);\n    };\n\n    /**\n     * Move a competency \"up\". This only affects the sort order within the same branch of the tree.\n     * @method moveUpHandler\n     */\n    var moveUpHandler = function() {\n        // We are chaining ajax requests here.\n        var competency = $('[data-region=\"competencyactions\"]').data('competency');\n        var requests = ajax.call([{\n            methodname: 'core_competency_move_up_competency',\n            args: {id: competency.id}\n        }, {\n            methodname: 'tool_lp_data_for_competencies_manage_page',\n            args: {competencyframeworkid: competency.competencyframeworkid,\n                    search: $('[data-region=\"filtercompetencies\"] input').val()}\n        }]);\n        requests[1].done(reloadPage).fail(notification.exception);\n    };\n\n    /**\n     * Move a competency \"down\". This only affects the sort order within the same branch of the tree.\n     * @method moveDownHandler\n     */\n    var moveDownHandler = function() {\n        // We are chaining ajax requests here.\n        var competency = $('[data-region=\"competencyactions\"]').data('competency');\n        var requests = ajax.call([{\n            methodname: 'core_competency_move_down_competency',\n            args: {id: competency.id}\n        }, {\n            methodname: 'tool_lp_data_for_competencies_manage_page',\n            args: {competencyframeworkid: competency.competencyframeworkid,\n                    search: $('[data-region=\"filtercompetencies\"] input').val()}\n        }]);\n        requests[1].done(reloadPage).fail(notification.exception);\n    };\n\n    /**\n     * Open a dialogue to show all the courses using the selected competency.\n     * @method seeCoursesHandler\n     */\n    var seeCoursesHandler = function() {\n        var competency = $('[data-region=\"competencyactions\"]').data('competency');\n\n        var requests = ajax.call([{\n            methodname: 'tool_lp_list_courses_using_competency',\n            args: {id: competency.id}\n        }]);\n\n        requests[0].done(function(courses) {\n            var context = {\n                courses: courses\n            };\n            templates.render('tool_lp/linked_courses_summary', context).done(function(html) {\n                str.get_string('linkedcourses', 'tool_lp').done(function(linkedcourses) {\n                    new Dialogue(\n                        linkedcourses, // Title.\n                        html, // The linked courses.\n                        initMovePopup\n                    );\n                }).fail(notification.exception);\n            }).fail(notification.exception);\n        }).fail(notification.exception);\n    };\n\n    /**\n     * Open a competencies popup to relate competencies.\n     *\n     * @method relateCompetenciesHandler\n     */\n    var relateCompetenciesHandler = function() {\n        relatedTarget = $('[data-region=\"competencyactions\"]').data('competency');\n\n        if (!pickerInstance) {\n            pickerInstance = new Picker(pageContextId, relatedTarget.competencyframeworkid);\n            pickerInstance.on('save', function(e, data) {\n                var pendingPromise = new Pending();\n                var compIds = data.competencyIds;\n\n                var calls = [];\n                $.each(compIds, function(index, value) {\n                    calls.push({\n                        methodname: 'core_competency_add_related_competency',\n                        args: {competencyid: value, relatedcompetencyid: relatedTarget.id}\n                    });\n                });\n\n                calls.push({\n                    methodname: 'tool_lp_data_for_related_competencies_section',\n                    args: {competencyid: relatedTarget.id}\n                });\n\n                var promises = ajax.call(calls);\n\n                promises[calls.length - 1].then(function(context) {\n                    return templates.render('tool_lp/related_competencies', context);\n                }).then(function(html, js) {\n                    $('[data-region=\"relatedcompetencies\"]').replaceWith(html);\n                    templates.runTemplateJS(js);\n                    updatedRelatedCompetencies();\n                    return;\n                })\n                .then(pendingPromise.resolve)\n                .catch(notification.exception);\n            });\n        }\n\n        pickerInstance.setDisallowedCompetencyIDs([relatedTarget.id]);\n        pickerInstance.display();\n    };\n\n    var ruleConfigHandler = function(e) {\n        e.preventDefault();\n        relatedTarget = $('[data-region=\"competencyactions\"]').data('competency');\n        ruleConfigInstance.setTargetCompetencyId(relatedTarget.id);\n        ruleConfigInstance.display();\n    };\n\n    var ruleConfigSaveHandler = function(e, config) {\n        var update = {\n            id: relatedTarget.id,\n            shortname: relatedTarget.shortname,\n            idnumber: relatedTarget.idnumber,\n            description: relatedTarget.description,\n            descriptionformat: relatedTarget.descriptionformat,\n            ruletype: config.ruletype,\n            ruleoutcome: config.ruleoutcome,\n            ruleconfig: config.ruleconfig\n        };\n        var promise = ajax.call([{\n            methodname: 'core_competency_update_competency',\n            args: {competency: update}\n        }]);\n        promise[0].then(function(result) {\n            if (result) {\n                relatedTarget.ruletype = config.ruletype;\n                relatedTarget.ruleoutcome = config.ruleoutcome;\n                relatedTarget.ruleconfig = config.ruleconfig;\n                renderCompetencySummary(relatedTarget);\n            }\n            return;\n        }).catch(notification.exception);\n    };\n\n    /**\n     * Delete a competency.\n     * @method doDelete\n     */\n    var doDelete = function() {\n        // We are chaining ajax requests here.\n        var competency = $('[data-region=\"competencyactions\"]').data('competency');\n        var requests = ajax.call([{\n            methodname: 'core_competency_delete_competency',\n            args: {id: competency.id}\n        }, {\n            methodname: 'tool_lp_data_for_competencies_manage_page',\n            args: {competencyframeworkid: competency.competencyframeworkid,\n                    search: $('[data-region=\"filtercompetencies\"] input').val()}\n        }]);\n        requests[0].done(function(success) {\n            if (success === false) {\n                str.get_strings([\n                {key: 'competencycannotbedeleted', component: 'tool_lp', param: competency.shortname},\n                {key: 'cancel', component: 'moodle'}\n                ]).done(function(strings) {\n                    notification.alert(\n                        null,\n                        strings[0]\n                    );\n                }).fail(notification.exception);\n            }\n        }).fail(notification.exception);\n        requests[1].done(reloadPage).fail(notification.exception);\n    };\n\n    /**\n     * Show a confirm dialogue before deleting a competency.\n     * @method deleteCompetencyHandler\n     */\n    var deleteCompetencyHandler = function() {\n        var competency = $('[data-region=\"competencyactions\"]').data('competency'),\n            confirmMessage = 'deletecompetency';\n\n        if (treeModel.hasRule(competency.parentid)) {\n            confirmMessage = 'deletecompetencyparenthasrule';\n        }\n\n        str.get_strings([\n            {key: 'confirm', component: 'moodle'},\n            {key: confirmMessage, component: 'tool_lp', param: competency.shortname},\n            {key: 'delete', component: 'moodle'},\n            {key: 'cancel', component: 'moodle'}\n        ]).done(function(strings) {\n            notification.confirm(\n                strings[0], // Confirm.\n                strings[1], // Delete competency X?\n                strings[2], // Delete.\n                strings[3], // Cancel.\n                doDelete\n            );\n        }).fail(notification.exception);\n    };\n\n    /**\n     * HTML5 implementation of drag/drop (there is an accesible alternative in the menus).\n     * @method dragStart\n     * @param {Event} e\n     */\n    var dragStart = function(e) {\n        e.originalEvent.dataTransfer.setData('text', $(e.target).parent().data('id'));\n    };\n\n    /**\n     * HTML5 implementation of drag/drop (there is an accesible alternative in the menus).\n     * @method allowDrop\n     * @param {Event} e\n     */\n    var allowDrop = function(e) {\n        e.originalEvent.dataTransfer.dropEffect = 'move';\n        e.preventDefault();\n    };\n\n    /**\n     * HTML5 implementation of drag/drop (there is an accesible alternative in the menus).\n     * @method dragEnter\n     * @param {Event} e\n     */\n    var dragEnter = function(e) {\n        e.preventDefault();\n        $(this).addClass('currentdragtarget');\n    };\n\n    /**\n     * HTML5 implementation of drag/drop (there is an accesible alternative in the menus).\n     * @method dragLeave\n     * @param {Event} e\n     */\n    var dragLeave = function(e) {\n        e.preventDefault();\n        $(this).removeClass('currentdragtarget');\n    };\n\n    /**\n     * HTML5 implementation of drag/drop (there is an accesible alternative in the menus).\n     * @method dropOver\n     * @param {Event} e\n     */\n    var dropOver = function(e) {\n        e.preventDefault();\n        moveSource = e.originalEvent.dataTransfer.getData('text');\n        moveTarget = $(e.target).parent().data('id');\n        $(this).removeClass('currentdragtarget');\n\n        confirmMove();\n    };\n\n    /**\n     * Deletes a related competency without confirmation.\n     *\n     * @param {Event} e The event that triggered the action.\n     * @method deleteRelatedHandler\n     */\n    var deleteRelatedHandler = function(e) {\n        e.preventDefault();\n\n        var relatedid = this.id.substr(11);\n        var competency = $('[data-region=\"competencyactions\"]').data('competency');\n        var removeRelated = ajax.call([\n            {methodname: 'core_competency_remove_related_competency',\n              args: {relatedcompetencyid: relatedid, competencyid: competency.id}},\n            {methodname: 'tool_lp_data_for_related_competencies_section',\n              args: {competencyid: competency.id}}\n        ]);\n\n        removeRelated[1].done(function(context) {\n            templates.render('tool_lp/related_competencies', context).done(function(html) {\n                $('[data-region=\"relatedcompetencies\"]').replaceWith(html);\n                updatedRelatedCompetencies();\n            }).fail(notification.exception);\n        }).fail(notification.exception);\n    };\n\n    /**\n     * Updates the competencies list (with relations) and add listeners.\n     *\n     * @method updatedRelatedCompetencies\n     */\n    var updatedRelatedCompetencies = function() {\n\n        // Listeners to newly loaded related competencies.\n        $('[data-action=\"deleterelation\"]').on('click', deleteRelatedHandler);\n\n    };\n\n    /**\n     * Log the competency viewed event.\n     *\n     * @param  {Object} competency The competency.\n     * @method triggerCompetencyViewedEvent\n     */\n    var triggerCompetencyViewedEvent = function(competency) {\n        if (competency.id !== selectedCompetencyId) {\n            // Set the selected competency id.\n            selectedCompetencyId = competency.id;\n            ajax.call([{\n                    methodname: 'core_competency_competency_viewed',\n                    args: {id: competency.id}\n            }]);\n        }\n    };\n\n    /**\n     * Return the taxonomy constant for a level.\n     *\n     * @param  {Number} level The level.\n     * @return {String}\n     * @function getTaxonomyAtLevel\n     */\n    var getTaxonomyAtLevel = function(level) {\n        var constant = taxonomiesConstants[level];\n        if (!constant) {\n            constant = 'competency';\n        }\n        return constant;\n    };\n\n    /**\n     * Render the competency summary.\n     *\n     * @param  {Object} competency The competency.\n     */\n    var renderCompetencySummary = function(competency) {\n        var promise = $.Deferred().resolve().promise(),\n            context = {};\n\n        context.competency = competency;\n        context.showdeleterelatedaction = true;\n        context.showrelatedcompetencies = true;\n        context.showrule = false;\n        context.pluginbaseurl = url.relativeUrl('/admin/tool/lp');\n\n        if (competency.ruleoutcome != Outcomes.NONE) {\n            // Get the outcome and rule name.\n            promise = Outcomes.getString(competency.ruleoutcome).then(function(str) {\n                var name;\n                $.each(rulesModules, function(index, modInfo) {\n                    if (modInfo.type == competency.ruletype) {\n                        name = modInfo.name;\n                    }\n                });\n                return [str, name];\n            });\n        }\n\n        promise.then(function(strs) {\n            if (typeof strs !== 'undefined') {\n                context.showrule = true;\n                context.rule = {\n                    outcome: strs[0],\n                    type: strs[1]\n                };\n            }\n            return context;\n        }).then(function(context) {\n            return templates.render('tool_lp/competency_summary', context);\n        }).then(function(html) {\n            $('[data-region=\"competencyinfo\"]').html(html);\n            $('[data-action=\"deleterelation\"]').on('click', deleteRelatedHandler);\n            return templates.render('tool_lp/loading', {});\n        }).then(function(html, js) {\n            templates.replaceNodeContents('[data-region=\"relatedcompetencies\"]', html, js);\n            return ajax.call([{\n                methodname: 'tool_lp_data_for_related_competencies_section',\n                args: {competencyid: competency.id}\n            }])[0];\n        }).then(function(context) {\n            return templates.render('tool_lp/related_competencies', context);\n        }).then(function(html, js) {\n            $('[data-region=\"relatedcompetencies\"]').replaceWith(html);\n            templates.runTemplateJS(js);\n            updatedRelatedCompetencies();\n            return;\n        }).catch(notification.exception);\n    };\n\n    /**\n     * Return the string \"Add <taxonomy>\".\n     *\n     * @param  {Number} level The level.\n     * @return {String}\n     * @function strAddTaxonomy\n     */\n    var strAddTaxonomy = function(level) {\n        return str.get_string('taxonomy_add_' + getTaxonomyAtLevel(level), 'tool_lp');\n    };\n\n    /**\n     * Return the string \"Selected <taxonomy>\".\n     *\n     * @param  {Number} level The level.\n     * @return {String}\n     * @function strSelectedTaxonomy\n     */\n    var strSelectedTaxonomy = function(level) {\n        return str.get_string('taxonomy_selected_' + getTaxonomyAtLevel(level), 'tool_lp');\n    };\n\n    /**\n     * Handler when a node in the aria tree is selected.\n     * @method selectionChanged\n     * @param {Event} evt The event that triggered the selection change.\n     * @param {Object} params The parameters for the event. Contains a list of selected nodes.\n     * @return {Boolean}\n     */\n    var selectionChanged = function(evt, params) {\n        var node = params.selected,\n            id = $(node).data('id'),\n            btn = $('[data-region=\"competencyactions\"] [data-action=\"add\"]'),\n            actionMenu = $('[data-region=\"competencyactionsmenu\"]'),\n            selectedTitle = $('[data-region=\"selected-competency\"]'),\n            level = 0,\n            sublevel = 1;\n\n        menubar.closeAll();\n\n        if (typeof id === \"undefined\") {\n            // Assume this is the root of the tree.\n            // Here we are only getting the text from the top of the tree, to do it we clone the tree,\n            // remove all children and then call text on the result.\n            $('[data-region=\"competencyinfo\"]').html(node.clone().children().remove().end().text());\n            $('[data-region=\"competencyactions\"]').data('competency', null);\n            actionMenu.hide();\n\n        } else {\n            var competency = treeModel.getCompetency(id);\n\n            level = treeModel.getCompetencyLevel(id);\n            sublevel = level + 1;\n\n            actionMenu.show();\n            $('[data-region=\"competencyactions\"]').data('competency', competency);\n            renderCompetencySummary(competency);\n            // Log Competency viewed event.\n            triggerCompetencyViewedEvent(competency);\n        }\n        strSelectedTaxonomy(level).then(function(str) {\n            selectedTitle.text(str);\n            return;\n        }).catch(notification.exception);\n\n        strAddTaxonomy(sublevel).then(function(str) {\n            btn.show()\n                .find('[data-region=\"term\"]')\n                .text(str);\n            return;\n        }).catch(notification.exception);\n\n        // We handled this event so consume it.\n        evt.preventDefault();\n        return false;\n    };\n\n    /**\n     * Return the string \"Selected <taxonomy>\".\n     *\n     * @function parseTaxonomies\n     * @param  {String} taxonomiesstr Comma separated list of taxonomies.\n     * @return {Array} of level => taxonomystr\n     */\n    var parseTaxonomies = function(taxonomiesstr) {\n        var all = taxonomiesstr.split(',');\n        all.unshift(\"\");\n        delete all[0];\n\n        // Note we don't need to fill holes, because other functions check for empty anyway.\n        return all;\n    };\n\n    return {\n        /**\n         * Initialise this page (attach event handlers etc).\n         *\n         * @method init\n         * @param {Object} model The tree model provides some useful functions for loading and searching competencies.\n         * @param {Number} pagectxid The page context ID.\n         * @param {Object} taxonomies Constants indexed by level.\n         * @param {Object} rulesMods The modules of the rules.\n         */\n        init: function(model, pagectxid, taxonomies, rulesMods) {\n            treeModel = model;\n            pageContextId = pagectxid;\n            taxonomiesConstants = parseTaxonomies(taxonomies);\n            rulesModules = rulesMods;\n\n            $('[data-region=\"competencyactions\"] [data-action=\"add\"]').on('click', addHandler);\n\n            menubar.enhance('.competencyactionsmenu', {\n                '[data-action=\"edit\"]': editHandler,\n                '[data-action=\"delete\"]': deleteCompetencyHandler,\n                '[data-action=\"move\"]': moveHandler,\n                '[data-action=\"moveup\"]': moveUpHandler,\n                '[data-action=\"movedown\"]': moveDownHandler,\n                '[data-action=\"linkedcourses\"]': seeCoursesHandler,\n                '[data-action=\"relatedcompetencies\"]': relateCompetenciesHandler.bind(this),\n                '[data-action=\"competencyrules\"]': ruleConfigHandler.bind(this)\n            });\n            $('[data-region=\"competencyactionsmenu\"]').hide();\n            $('[data-region=\"competencyactions\"] [data-action=\"add\"]').hide();\n\n            $('[data-region=\"filtercompetencies\"]').on('submit', updateSearchHandler);\n            // Simple html5 drag drop because we already added an accessible alternative.\n            var top = $('[data-region=\"managecompetencies\"] [data-enhance=\"tree\"]');\n            top.on('dragstart', 'li>span', dragStart)\n                .on('dragover', 'li>span', allowDrop)\n                .on('dragenter', 'li>span', dragEnter)\n                .on('dragleave', 'li>span', dragLeave)\n                .on('drop', 'li>span', dropOver);\n\n            model.on('selectionchanged', selectionChanged);\n\n            // Prepare the configuration tool.\n            ruleConfigInstance = new RuleConfig(treeModel, rulesModules);\n            ruleConfigInstance.on('save', ruleConfigSaveHandler.bind(this));\n        }\n    };\n});\n"],"file":"competencyactions.min.js"}