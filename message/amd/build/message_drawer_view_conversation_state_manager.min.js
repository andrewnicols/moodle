define ("core_message/message_drawer_view_conversation_state_manager",["jquery"],function($){var cloneState=function(state){return $.extend(!0,{},state)},formatMessages=function(messages,loggedInUserId,members){return messages.map(function(message){var fromLoggedInUser=message.useridfrom==loggedInUserId;return{id:""+message.id,fromLoggedInUser:fromLoggedInUser,userFrom:members[message.useridfrom],text:message.text,timeCreated:message.timecreated?parseInt(message.timecreated,10):null}})},formatMembers=function(members){return members.map(function(member){return{id:member.id,fullname:member.fullname,profileurl:member.profileurl,profileimageurl:member.profileimageurl,profileimageurlsmall:member.profileimageurlsmall,isonline:member.isonline,showonlinestatus:member.showonlinestatus,isblocked:member.isblocked,iscontact:member.iscontact,isdeleted:member.isdeleted,canmessage:member.canmessage,canmessageevenifblocked:member.canmessageevenifblocked,requirescontact:member.requirescontact,contactrequests:member.contactrequests||[]}})};return{buildInitialState:function(midnight,loggedInUserId,id,messagePollMin,messagePollMax,messagePollAfterMax){return{midnight:midnight,loggedInUserId:loggedInUserId,id:id,messagePollMin:messagePollMin,messagePollMax:messagePollMax,messagePollAfterMax:messagePollAfterMax,name:null,subname:null,type:null,totalMemberCount:null,imageUrl:null,isFavourite:null,isMuted:null,canDeleteMessagesForAllUsers:!1,deleteMessagesForAllUsers:!1,members:{},messages:[],hasTriedToLoadMessages:!1,loadingMessages:!0,loadingMembers:!0,loadingConfirmAction:!1,pendingBlockUserIds:[],pendingUnblockUserIds:[],pendingRemoveContactIds:[],pendingAddContactIds:[],pendingDeleteMessageIds:[],pendingSendMessageIds:[],pendingDeleteConversation:!1,selectedMessageIds:[],showEmojiAutoComplete:!1,showEmojiPicker:!1}},addMessages:function(state,messages){var newState=cloneState(state),formattedMessages=formatMessages(messages,state.loggedInUserId,state.members);formattedMessages=formattedMessages.map(function(message){message.sendState=null;message.timeAdded=Date.now();message.errorMessage=null;return message});var allMessages=state.messages.concat(formattedMessages);allMessages.sort(function(a,b){if(null===a.timeCreated&&null===b.timeCreated){if(a.timeAdded<b.timeAdded){return-1}else if(a.timeAdded>b.timeAdded){return 1}}if(null===a.timeCreated&&null!==b.timeCreated){return 1}else if(null!==a.timeCreated&&null===b.timeCreated){return-1}else if(a.timeCreated<b.timeCreated){return-1}else if(a.timeCreated>b.timeCreated){return 1}else if(a.id<b.id){return-1}else if(a.id>b.id){return 1}else{return 0}});newState.messages=allMessages.filter(function(message,index,sortedMessages){return!index||message.id!=sortedMessages[index-1].id});return newState},updateMessages:function(state,data){var newState=cloneState(state),updatesById=data.reduce(function(carry,messageData){var oldMessage=messageData[0],newMessage=messageData[1],formattedMessages=formatMessages([newMessage],state.loggedInUserId,state.members),formattedMessage=formattedMessages[0];carry[oldMessage.id]=formattedMessage;return carry},{});newState.messages=newState.messages.map(function(message){if(message.id in updatesById){return $.extend(message,updatesById[message.id])}else{return message}});return newState},removeMessages:function(state,messages){var newState=cloneState(state),removeMessageIds=messages.map(function(message){return""+message.id});newState.messages=newState.messages.filter(function(message){return 0>removeMessageIds.indexOf(message.id)});return newState},removeMessagesById:function(state,messageIds){var newState=cloneState(state);messageIds=messageIds.map(function(id){return""+id});newState.messages=newState.messages.filter(function(message){return 0>messageIds.indexOf(message.id)});return newState},addMembers:function(state,members){var newState=cloneState(state),formattedMembers=formatMembers(members);formattedMembers.forEach(function(member){newState.members[member.id]=member});return newState},removeMembers:function(state,members){var newState=cloneState(state);members.forEach(function(member){delete newState.members[member.id]});return newState},setLoadingMessages:function(state,value){var newState=cloneState(state);newState.loadingMessages=value;if(state.loadingMessages&&!value){newState.hasTriedToLoadMessages=!0}return newState},setLoadingMembers:function(state,value){var newState=cloneState(state);newState.loadingMembers=value;return newState},setId:function(state,value){var newState=cloneState(state);newState.id=value;return newState},setName:function(state,value){var newState=cloneState(state);newState.name=value;return newState},setSubname:function(state,value){var newState=cloneState(state);newState.subname=value;return newState},setType:function(state,type){var newState=cloneState(state);newState.type=type;return newState},setIsFavourite:function(state,isFavourite){var newState=cloneState(state);newState.isFavourite=isFavourite;return newState},setIsMuted:function(state,isMuted){var newState=cloneState(state);newState.isMuted=isMuted;return newState},setCanDeleteMessagesForAllUsers:function(state,value){var newState=cloneState(state);newState.canDeleteMessagesForAllUsers=value;return newState},setDeleteMessagesForAllUsers:function(state,value){var newState=cloneState(state);newState.deleteMessagesForAllUsers=value;return newState},setTotalMemberCount:function(state,count){var newState=cloneState(state);newState.totalMemberCount=count;return newState},setImageUrl:function(state,url){var newState=cloneState(state);newState.imageUrl=url;return newState},setLoadingConfirmAction:function(state,value){var newState=cloneState(state);newState.loadingConfirmAction=value;return newState},setPendingDeleteConversation:function(state,value){var newState=cloneState(state);newState.pendingDeleteConversation=value;return newState},setMessagesSendPendingById:function(state,messageIds){var newState=cloneState(state);messageIds=messageIds.map(function(id){return""+id});newState.messages.forEach(function(message){if(0<=messageIds.indexOf(message.id)){message.sendState="pending";message.errorMessage=null}});return newState},setMessagesSendSuccessById:function(state,messageIds){var newState=cloneState(state);messageIds=messageIds.map(function(id){return""+id});newState.messages.forEach(function(message){if(0<=messageIds.indexOf(message.id)){message.sendState="sent";message.errorMessage=null}});return newState},setMessagesSendFailById:function(state,messageIds,errorMessage){var newState=cloneState(state);messageIds=messageIds.map(function(id){return""+id});newState.messages.forEach(function(message){if(0<=messageIds.indexOf(message.id)){message.sendState="error";message.errorMessage=errorMessage}});return newState},setShowEmojiAutoComplete:function(state,show){var newState=cloneState(state);newState.showEmojiAutoComplete=show;return newState},setShowEmojiPicker:function(state,show){var newState=cloneState(state);newState.showEmojiPicker=show;return newState},addPendingBlockUsersById:function(state,userIds){var newState=cloneState(state);userIds.forEach(function(id){newState.pendingBlockUserIds.push(id)});return newState},addPendingRemoveContactsById:function(state,userIds){var newState=cloneState(state);userIds.forEach(function(id){newState.pendingRemoveContactIds.push(id)});return newState},addPendingUnblockUsersById:function(state,userIds){var newState=cloneState(state);userIds.forEach(function(id){newState.pendingUnblockUserIds.push(id)});return newState},addPendingAddContactsById:function(state,userIds){var newState=cloneState(state);userIds.forEach(function(id){newState.pendingAddContactIds.push(id)});return newState},addPendingDeleteMessagesById:function(state,messageIds){var newState=cloneState(state);messageIds.forEach(function(id){newState.pendingDeleteMessageIds.push(id)});return newState},removePendingBlockUsersById:function(state,userIds){var newState=cloneState(state);newState.pendingBlockUserIds=newState.pendingBlockUserIds.filter(function(id){return 0>userIds.indexOf(id)});return newState},removePendingRemoveContactsById:function(state,userIds){var newState=cloneState(state);newState.pendingRemoveContactIds=newState.pendingRemoveContactIds.filter(function(id){return 0>userIds.indexOf(id)});return newState},removePendingUnblockUsersById:function(state,userIds){var newState=cloneState(state);newState.pendingUnblockUserIds=newState.pendingUnblockUserIds.filter(function(id){return 0>userIds.indexOf(id)});return newState},removePendingAddContactsById:function(state,userIds){var newState=cloneState(state);newState.pendingAddContactIds=newState.pendingAddContactIds.filter(function(id){return 0>userIds.indexOf(id)});return newState},removePendingDeleteMessagesById:function(state,messageIds){var newState=cloneState(state);messageIds=messageIds.map(function(id){return""+id});newState.pendingDeleteMessageIds=newState.pendingDeleteMessageIds.filter(function(id){return 0>messageIds.indexOf(id)});return newState},addSelectedMessagesById:function(state,messageIds){var newState=cloneState(state);messageIds=messageIds.map(function(id){return""+id});newState.selectedMessageIds=newState.selectedMessageIds.concat(messageIds);return newState},removeSelectedMessagesById:function(state,messageIds){var newState=cloneState(state);messageIds=messageIds.map(function(id){return""+id});newState.selectedMessageIds=newState.selectedMessageIds.filter(function(id){return 0>messageIds.indexOf(id)});return newState},markMessagesAsRead:function(state,readMessages){var newState=cloneState(state),readMessageIds=readMessages.map(function(message){return message.id});newState.messages=newState.messages.map(function(message){if(0<=readMessageIds.indexOf(message.id)){message.isRead=!0}return message});return newState},addContactRequests:function(state,requests){var newState=cloneState(state);requests.forEach(function(request){var fromUserId=request.userid,toUserId=request.requesteduserid;newState.members[fromUserId].contactrequests.push(request);newState.members[toUserId].contactrequests.push(request)});return newState},removeContactRequests:function(state,requests){var newState=cloneState(state);requests.forEach(function(request){var fromUserId=request.userid,toUserId=request.requesteduserid;newState.members[fromUserId].contactrequests=newState.members[fromUserId].contactrequests.filter(function(existing){return existing.userid!=fromUserId});newState.members[toUserId].contactrequests=newState.members[toUserId].contactrequests.filter(function(existing){return existing.requesteduserid!=toUserId})});return newState}}});
//# sourceMappingURL=message_drawer_view_conversation_state_manager.min.js.map
