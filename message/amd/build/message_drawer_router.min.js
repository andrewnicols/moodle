define ("core_message/message_drawer_router",["jquery","core/pubsub","core/str","core_message/message_drawer_events","core/aria"],function($,PubSub,Str,MessageDrawerEvents,Aria){var routes={},history={},SELECTORS={CAN_RECEIVE_FOCUS:"input:not([type=\"hidden\"]), a[href], button, textarea, select, [tabindex]",ROUTES_BACK:"[data-route-back]"},changeRoute=function(namespace,newRoute){var newConfig,fromPanel=[].slice.call(arguments).some(function(arg){return"frompanel"==arg}),args=[].slice.call(arguments,2),renderPromise=$.Deferred().resolve().promise();Object.keys(routes[namespace]).forEach(function(route){var config=routes[namespace][route],isMatch=route===newRoute;if(isMatch){newConfig=config}config.parameters.forEach(function(element){if("object"!=typeof element||null===element){return}element.removeClass("previous");element.attr("data-from-panel",!1);if(isMatch){if(fromPanel){element.attr("data-from-panel",!0)}element.removeClass("hidden");Aria.unhide(element.get())}else{if(!element.attr("data-in-panel")){element.addClass("hidden");Aria.hide(element.get())}else if("view-search"==newRoute||"view-overview"==newRoute){element.addClass("hidden");Aria.hide(element.get())}}})});if(newConfig){if(newConfig.onGo){renderPromise=newConfig.onGo.apply(void 0,newConfig.parameters.concat(args));for(var currentFocusElement=$(document.activeElement),hasFocus=!1,firstFocusable=null,i=1,element;i<newConfig.parameters.length;i++){element=newConfig.parameters[i];if("object"!=typeof element||null===element){continue}if(!firstFocusable){firstFocusable=element}if(element.has(currentFocusElement).length){hasFocus=!0;break}}if(!hasFocus){firstFocusable.find(SELECTORS.CAN_RECEIVE_FOCUS).filter(":visible").first().focus()}}}var record={route:newRoute,params:args,renderPromise:renderPromise};PubSub.publish(MessageDrawerEvents.ROUTE_CHANGED,record);return record},go=function(namespace){var currentFocusElement=$(document.activeElement),record=changeRoute.apply(namespace,arguments),inHistory=!1;if(!history[namespace]){history[namespace]=[]}history[namespace]=history[namespace].reduce(function(carry,previous){if(previous.route===record.route){inHistory=!0}if(!inHistory){carry.push(previous)}return carry},[]);var historylength=history[namespace].length,previousRecord=historylength?history[namespace][historylength-1]:null;if(previousRecord){for(var prevConfig=routes[namespace][previousRecord.route],elements=prevConfig.parameters,i=1;i<elements.length;i++){if("object"!=typeof elements[i]||null===elements[i]){continue}elements[i].addClass("previous")}previousRecord.focusElement=currentFocusElement;if(prevConfig.getDescription){prevConfig.getDescription.apply(null,prevConfig.parameters.concat(previousRecord.params)).then(function(description){return Str.get_string("backto","core_message",description)}).then(function(label){return record.renderPromise.then(function(){routes[namespace][record.route].parameters.forEach(function(element){if("object"!=typeof element||!element){return}element.find(SELECTORS.ROUTES_BACK).attr("aria-label",label)})})}).catch(function(){})}}history[namespace].push(record);return record};return{add:function(namespace,route,parameters,onGo,getDescription){if(!routes[namespace]){routes[namespace]=[]}routes[namespace][route]={parameters:parameters,onGo:onGo,getDescription:getDescription}},go:go,back:function(namespace){if(history[namespace].length){history[namespace].pop();var previous=history[namespace].pop();if(previous){go.apply(void 0,[namespace,previous.route].concat(previous.params));window.setTimeout(function(){previous.focusElement.focus()},50)}}}}});
//# sourceMappingURL=message_drawer_router.min.js.map
