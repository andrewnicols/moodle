define ("core_message/notification_preference",["jquery","core/ajax","core/notification","core_message/notification_processor"],function($,Ajax,Notification,NotificationProcessor){var SELECTORS={PROCESSOR:"[data-processor-name]",STATE_INPUTS:"[data-state] input"},NotificationPreference=function(element,userId){this.root=$(element);this.userId=userId};NotificationPreference.prototype.getPreferenceKey=function(){return this.root.attr("data-preference-key")};NotificationPreference.prototype.getEnabledPreferenceKey=function(){return this.getPreferenceKey()+"_enabled"};NotificationPreference.prototype.getProcessors=function(){return this.root.find(SELECTORS.PROCESSOR).map(function(index,element){return new NotificationProcessor($(element))})};NotificationPreference.prototype.startLoading=function(){this.root.addClass("loading");this.root.find(SELECTORS.STATE_INPUTS).prop("disabled",!0)};NotificationPreference.prototype.stopLoading=function(){this.root.removeClass("loading");this.root.find(SELECTORS.STATE_INPUTS).prop("disabled",!1)};NotificationPreference.prototype.isLoading=function(){return this.root.hasClass("loading")};NotificationPreference.prototype.save=function(){if(this.isLoading()){return $.Deferred().resolve()}this.startLoading();var enabledValue="";this.getProcessors().each(function(index,processor){if(processor.isEnabled()){if(""===enabledValue){enabledValue=processor.getName()}else{enabledValue+=","+processor.getName()}}});if(""===enabledValue){enabledValue="none"}var args={userid:this.userId,preferences:[{type:this.getEnabledPreferenceKey(),value:enabledValue}]};return Ajax.call([{methodname:"core_user_update_user_preferences",args:args}])[0].fail(Notification.exception).always(function(){this.stopLoading()}.bind(this))};return NotificationPreference});
//# sourceMappingURL=notification_preference.min.js.map
