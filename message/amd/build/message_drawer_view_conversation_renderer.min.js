define ("core_message/message_drawer_view_conversation_renderer",["jquery","core/notification","core/str","core/templates","core/user_date","core_message/message_drawer_view_conversation_constants","core/aria"],function($,Notification,Str,Templates,UserDate,Constants,Aria){var SELECTORS=Constants.SELECTORS,TEMPLATES=Constants.TEMPLATES,CONVERSATION_TYPES=Constants.CONVERSATION_TYPES,getMessagesContainer=function(body){return body.find(SELECTORS.CONTENT_MESSAGES_CONTAINER)},showMessagesContainer=function(body){getMessagesContainer(body).removeClass("hidden")},hideMessagesContainer=function(body){getMessagesContainer(body).addClass("hidden")},getSelfConversationMessageContainer=function(body){return body.find(SELECTORS.SELF_CONVERSATION_MESSAGE_CONTAINER)},hideSelfConversationMessageContainer=function(body){return getSelfConversationMessageContainer(body).addClass("hidden")},getContactRequestSentContainer=function(body){return body.find(SELECTORS.CONTACT_REQUEST_SENT_MESSAGE_CONTAINER)},hideContactRequestSentContainer=function(body){return getContactRequestSentContainer(body).addClass("hidden")},getFooterContentContainer=function(footer){return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_CONTAINER)},showFooterContent=function(footer){getFooterContentContainer(footer).removeClass("hidden")},hideFooterContent=function(footer){getFooterContentContainer(footer).addClass("hidden")},getFooterEditModeContainer=function(footer){return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_EDIT_MODE_CONTAINER)},showFooterEditMode=function(footer){getFooterEditModeContainer(footer).removeClass("hidden")},hideFooterEditMode=function(footer){getFooterEditModeContainer(footer).addClass("hidden")},getFooterPlaceholderContainer=function(footer){return footer.find(SELECTORS.PLACEHOLDER_CONTAINER)},showFooterPlaceholder=function(footer){getFooterPlaceholderContainer(footer).removeClass("hidden")},hideFooterPlaceholder=function(footer){getFooterPlaceholderContainer(footer).addClass("hidden")},getFooterRequireContactContainer=function(footer){return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_REQUIRE_CONTACT_CONTAINER)},showFooterRequireContact=function(footer){getFooterRequireContactContainer(footer).removeClass("hidden")},hideFooterRequireContact=function(footer){getFooterRequireContactContainer(footer).addClass("hidden")},getFooterRequireUnblockContainer=function(footer){return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_REQUIRE_UNBLOCK_CONTAINER)},showFooterRequireUnblock=function(footer){getFooterRequireUnblockContainer(footer).removeClass("hidden")},hideFooterRequireUnblock=function(footer){getFooterRequireUnblockContainer(footer).addClass("hidden")},getFooterUnableToMessageContainer=function(footer){return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_UNABLE_TO_MESSAGE_CONTAINER)},showFooterUnableToMessage=function(footer){getFooterUnableToMessageContainer(footer).removeClass("hidden")},hideFooterUnableToMessage=function(footer){getFooterUnableToMessageContainer(footer).addClass("hidden")},hideAllHeaderElements=function(header){hideHeaderContent(header);hideHeaderEditMode(header);hideHeaderPlaceholder(header)},hideAllFooterElements=function(footer){hideFooterContent(footer);hideFooterEditMode(footer);hideFooterPlaceholder(footer);hideFooterRequireContact(footer);hideFooterRequireUnblock(footer);hideFooterUnableToMessage(footer)},getContentPlaceholderContainer=function(body){return body.find(SELECTORS.CONTENT_PLACEHOLDER_CONTAINER)},showContentPlaceholder=function(body){getContentPlaceholderContainer(body).removeClass("hidden")},hideContentPlaceholder=function(body){getContentPlaceholderContainer(body).addClass("hidden")},getHeaderContent=function(header){return header.find(SELECTORS.HEADER)},showHeaderContent=function(header){getHeaderContent(header).removeClass("hidden")},hideHeaderContent=function(header){getHeaderContent(header).addClass("hidden")},getHeaderEditMode=function(header){return header.find(SELECTORS.HEADER_EDIT_MODE)},showHeaderEditMode=function(header){getHeaderEditMode(header).removeClass("hidden")},hideHeaderEditMode=function(header){getHeaderEditMode(header).addClass("hidden")},getHeaderPlaceholderContainer=function(header){return header.find(SELECTORS.HEADER_PLACEHOLDER_CONTAINER)},showHeaderPlaceholder=function(header){getHeaderPlaceholderContainer(header).removeClass("hidden")},hideHeaderPlaceholder=function(header){getHeaderPlaceholderContainer(header).addClass("hidden")},getEmojiPickerContainer=function(footer){return footer.find(SELECTORS.EMOJI_PICKER_CONTAINER)},getEmojiAutoCompleteContainer=function(footer){return footer.find(SELECTORS.EMOJI_AUTO_COMPLETE_CONTAINER)},getMessageElement=function(body,messageId){var messagesContainer=getMessagesContainer(body);return messagesContainer.find("[data-message-id=\""+messageId+"\"]")},getDayElement=function(body,dayTimeCreated){var messagesContainer=getMessagesContainer(body);return messagesContainer.find("[data-day-id=\""+dayTimeCreated+"\"]")},getMoreMessagesLoadingIconContainer=function(body){return body.find(SELECTORS.MORE_MESSAGES_LOADING_ICON_CONTAINER)},showMoreMessagesLoadingIcon=function(body){getMoreMessagesLoadingIconContainer(body).removeClass("hidden")},hideMoreMessagesLoadingIcon=function(body){getMoreMessagesLoadingIconContainer(body).addClass("hidden")},getConfirmDialogueContainer=function(root){return root.find(SELECTORS.CONFIRM_DIALOGUE_CONTAINER)},showConfirmDialogueContainer=function(root){var container=getConfirmDialogueContainer(root),siblings=container.siblings(":not(.hidden)");Aria.hide(siblings.get());siblings.attr("data-confirm-dialogue-hidden",!0);container.removeClass("hidden")},hideConfirmDialogueContainer=function(root){var container=getConfirmDialogueContainer(root),siblings=container.siblings("[data-confirm-dialogue-hidden=\"true\"]");Aria.unhide(siblings.get());siblings.removeAttr("data-confirm-dialogue-hidden");container.addClass("hidden")},setMessagesSelectedCount=function(header,value){getHeaderEditMode(header).find(SELECTORS.MESSAGES_SELECTED_COUNT).text(value)},formatMessagesForTemplate=function(messages,datesCache){return messages.map(function(message){return{id:message.id,isread:message.isRead,fromloggedinuser:message.fromLoggedInUser,userfrom:message.userFrom,text:message.text,formattedtime:message.timeCreated?datesCache[message.timeCreated]:null}})},renderAddDays=function(header,body,footer,days,datesCache){var messagesContainer=getMessagesContainer(body),daysRenderPromises=days.map(function(data){return Templates.render(TEMPLATES.DAY,{timestamp:data.value.timestamp,messages:formatMessagesForTemplate(data.value.messages,datesCache)})});return $.when.apply($,daysRenderPromises).then(function(){days.forEach(function(data,index){daysRenderPromises[index].then(function(html){if(data.before){var element=getDayElement(body,data.before.timestamp);return $(html).insertBefore(element)}else{return messagesContainer.append(html)}}).catch(function(){})})})},renderAddMessages=function(header,body,footer,messages,datesCache){var messagesData=messages.map(function(data){return data.value}),formattedMessages=formatMessagesForTemplate(messagesData,datesCache);return Templates.render(TEMPLATES.MESSAGES,{messages:formattedMessages}).then(function(html){var messageList=$(html);messages.forEach(function(data){var messageHtml=messageList.find("[data-message-id=\""+data.value.id+"\"]");if(data.before){var element=getMessageElement(body,data.before.id);return messageHtml.insertBefore(element)}else{var dayContainer=getDayElement(body,data.day.timestamp),dayMessagesContainer=dayContainer.find(SELECTORS.DAY_MESSAGES_CONTAINER);return dayMessagesContainer.append(messageHtml)}})})},renderUpdateMessages=function(header,body,footer,messages,datesCache){messages.forEach(function(message){var before=message.before,after=message.after,element=getMessageElement(body,before.id);if(before.id!=after.id){element.attr("data-message-id",after.id)}if(before.timeCreated!=after.timeCreated){var formattedTime=datesCache[after.timeCreated];element.find(SELECTORS.LOADING_ICON_CONTAINER).addClass("hidden");element.find(SELECTORS.TIME_CREATED).text(formattedTime).removeClass("hidden")}if(before.sendState!=after.sendState){var loading=element.find(SELECTORS.LOADING_ICON_CONTAINER),time=element.find(SELECTORS.TIME_CREATED),retry=element.find(SELECTORS.RETRY_SEND);loading.addClass("hidden");Aria.hide(loading.get());time.addClass("hidden");Aria.hide(time.get());retry.addClass("hidden");Aria.hide(retry.get());element.removeClass("border border-danger");switch(after.sendState){case"pending":loading.removeClass("hidden");Aria.unhide(loading.get());break;case"error":retry.removeClass("hidden");Aria.unhide(retry.get());element.addClass("border border-danger");break;case"sent":time.removeClass("hidden");Aria.unhide(time.get());break;}}if(before.text!=after.text){element.find(SELECTORS.TEXT_CONTAINER).html(after.text)}if(before.errorMessage!=after.errorMessage){var messageContainer=element.find(SELECTORS.ERROR_MESSAGE_CONTAINER),message=messageContainer.find(SELECTORS.ERROR_MESSAGE);if(after.errorMessage){messageContainer.removeClass("hidden");Aria.unhide(messageContainer.get());message.text(after.errorMessage)}else{messageContainer.addClass("hidden");Aria.unhide(messageContainer.get());message.text("")}}})},renderRemoveDays=function(body,days){days.forEach(function(data){getDayElement(body,data.timestamp).remove()})},renderRemoveMessages=function(body,messages){messages.forEach(function(data){getMessageElement(body,data.id).remove()})},renderConversation=function(header,body,footer,data){var renderingPromises=[],hasAddDays=0<data.days.add.length,hasAddMessages=0<data.messages.add.length,hasUpdateMessages=0<data.messages.update.length,timestampsToFormat=[],datesCachePromise=$.Deferred().resolve({}).promise();if(hasAddDays){timestampsToFormat=timestampsToFormat.concat(data.days.add.reduce(function(carry,day){return carry.concat(day.value.messages.reduce(function(timestamps,message){if(message.timeCreated){timestamps.push(message.timeCreated)}return timestamps},[]))},[]))}if(hasAddMessages){timestampsToFormat=timestampsToFormat.concat(data.messages.add.reduce(function(timestamps,message){if(message.value.timeCreated){timestamps.push(message.value.timeCreated)}return timestamps},[]))}if(hasUpdateMessages){timestampsToFormat=timestampsToFormat.concat(data.messages.update.reduce(function(timestamps,message){if(message.before.timeCreated!=message.after.timeCreated){timestamps.push(message.after.timeCreated)}return timestamps},[]))}if(timestampsToFormat.length){datesCachePromise=Str.get_string("strftimetime24","core_langconfig").then(function(format){var requests=timestampsToFormat.map(function(timestamp){return{timestamp:timestamp,format:format}});return UserDate.get(requests)}).then(function(formattedTimes){return timestampsToFormat.reduce(function(carry,timestamp,index){carry[timestamp]=formattedTimes[index];return carry},{})})}if(hasAddDays){renderingPromises.push(datesCachePromise.then(function(datesCache){return renderAddDays(header,body,footer,data.days.add,datesCache)}))}if(hasAddMessages){renderingPromises.push(datesCachePromise.then(function(datesCache){return renderAddMessages(header,body,footer,data.messages.add,datesCache)}))}if(hasUpdateMessages){renderingPromises.push(datesCachePromise.then(function(datesCache){return renderUpdateMessages(header,body,footer,data.messages.update,datesCache)}))}if(0<data.days.remove.length){renderRemoveDays(body,data.days.remove)}if(0<data.messages.remove.length){renderRemoveMessages(body,data.messages.remove)}return $.when.apply($,renderingPromises)},renderHeader=function(header,body,footer,data){var headerContainer=getHeaderContent(header),template=TEMPLATES.HEADER_PUBLIC;data.context.showrouteback="false"===header.attr("data-from-panel");if(data.type==CONVERSATION_TYPES.PRIVATE){template=data.showControls?TEMPLATES.HEADER_PRIVATE:TEMPLATES.HEADER_PRIVATE_NO_CONTROLS}else if(data.type==CONVERSATION_TYPES.SELF){template=TEMPLATES.HEADER_SELF}return Templates.render(template,data.context).then(function(html,js){Templates.replaceNodeContents(headerContainer,html,js)})},renderFooter=function(header,body,footer,data){hideAllFooterElements(footer);switch(data.type){case"placeholder":return showFooterPlaceholder(footer);case"add-contact":return Str.get_strings([{key:"requirecontacttomessage",component:"core_message",param:data.user.fullname},{key:"isnotinyourcontacts",component:"core_message",param:data.user.fullname}]).then(function(strings){var title=strings[1],text=strings[0],footerContainer=getFooterRequireContactContainer(footer);footerContainer.find(SELECTORS.TITLE).text(title);footerContainer.find(SELECTORS.TEXT).text(text);showFooterRequireContact(footer);return strings});case"edit-mode":return showFooterEditMode(footer);case"content":return showFooterContent(footer);case"unblock":return showFooterRequireUnblock(footer);case"unable-to-message":return showFooterUnableToMessage(footer);}return!0},renderScrollToMessage=function(header,body,footer,messageId){var messagesContainer=getMessagesContainer(body),messageElement=getMessageElement(body,messageId),position=messageElement.position();if(position){var scrollTop=messagesContainer.scrollTop()+position.top;messagesContainer.scrollTop(scrollTop)}},renderLoadingMembers=function(header,body,footer,isLoadingMembers){if(isLoadingMembers){hideHeaderContent(header);showHeaderPlaceholder(header)}else{showHeaderContent(header);hideHeaderPlaceholder(header)}},renderLoadingFirstMessages=function(header,body,footer,isLoadingFirstMessages){if(isLoadingFirstMessages){hideMessagesContainer(body);showContentPlaceholder(body)}else{showMessagesContainer(body);hideContentPlaceholder(body)}},renderLoadingMessages=function(header,body,footer,isLoading){if(isLoading){showMoreMessagesLoadingIcon(body)}else{hideMoreMessagesLoadingIcon(body)}},renderShowEmojiPicker=function(header,body,footer,show){var container=getEmojiPickerContainer(footer);if(show){container.removeClass("hidden");Aria.unhide(container.get());container.find(SELECTORS.EMOJI_PICKER_SEARCH_INPUT).focus()}else{container.addClass("hidden");Aria.hide(container.get())}},renderShowEmojiAutoComplete=function(header,body,footer,show){var container=getEmojiAutoCompleteContainer(footer);if(show){container.removeClass("hidden");Aria.unhide(container.get())}else{container.addClass("hidden");Aria.hide(container.get())}},showConfirmDialogue=function(header,body,footer,buttonSelectors,bodyText,headerText,canCancel,skipHeader,showOk){var dialogue=getConfirmDialogueContainer(body),buttons=buttonSelectors.map(function(selector){return dialogue.find(selector)}),cancelButton=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_CANCEL_BUTTON),okayButton=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_OKAY_BUTTON),text=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_TEXT),dialogueHeader=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_HEADER);dialogue.find("button").addClass("hidden");if(canCancel){cancelButton.removeClass("hidden")}else{cancelButton.addClass("hidden")}if(showOk){okayButton.removeClass("hidden")}else{okayButton.addClass("hidden")}if(headerText){dialogueHeader=$("<h3 class=\"h6\" data-region=\"dialogue-header\"></h3>");dialogueHeader.text(headerText);var confirmDialogue=dialogue.find(SELECTORS.CONFIRM_DIALOGUE);confirmDialogue.prepend(dialogueHeader)}else if(dialogueHeader.length){dialogueHeader.remove()}buttons.forEach(function(button){button.removeClass("hidden")});text.text(bodyText);showConfirmDialogueContainer(footer);showConfirmDialogueContainer(body);if(!skipHeader){showConfirmDialogueContainer(header)}dialogue.find(SELECTORS.CAN_RECEIVE_FOCUS).filter(":visible").first().focus()},hideConfirmDialogue=function(header,body,footer){var dialogue=getConfirmDialogueContainer(body),cancelButton=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_CANCEL_BUTTON),okayButton=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_OKAY_BUTTON),text=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_TEXT),dialogueHeader=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_HEADER);hideCheckDeleteDialogue(body);hideConfirmDialogueContainer(body);hideConfirmDialogueContainer(footer);hideConfirmDialogueContainer(header);dialogue.find("button").addClass("hidden");cancelButton.removeClass("hidden");okayButton.removeClass("hidden");text.text("");if(dialogueHeader.length){dialogueHeader.remove()}header.find(SELECTORS.CAN_RECEIVE_FOCUS).first().focus();return!0},renderConfirmBlockUser=function(header,body,footer,user){if(user){if(user.canmessageevenifblocked){return Str.get_string("cantblockuser","core_message",user.fullname).then(function(string){return showConfirmDialogue(header,body,footer,[],string,"",!1,!1,!0)})}else{return Str.get_string("blockuserconfirm","core_message",user.fullname).then(function(string){return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_CONFIRM_BLOCK],string,"",!0,!1)})}}else{return hideConfirmDialogue(header,body,footer)}},renderConfirmUnblockUser=function(header,body,footer,user){if(user){return Str.get_string("unblockuserconfirm","core_message",user.fullname).then(function(string){return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_CONFIRM_UNBLOCK],string,"",!0,!1)})}else{return hideConfirmDialogue(header,body,footer)}},renderConfirmAddContact=function(header,body,footer,user){if(user){return Str.get_string("addcontactconfirm","core_message",user.fullname).then(function(string){return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_CONFIRM_ADD_CONTACT],string,"",!0,!1)})}else{return hideConfirmDialogue(header,body,footer)}},renderConfirmRemoveContact=function(header,body,footer,user){if(user){return Str.get_string("removecontactconfirm","core_message",user.fullname).then(function(string){return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_CONFIRM_REMOVE_CONTACT],string,"",!0,!1)})}else{return hideConfirmDialogue(header,body,footer)}},renderConfirmDeleteSelectedMessages=function(header,body,footer,data){var showmessage=null;if(data.type==CONVERSATION_TYPES.SELF){showmessage="deleteselectedmessagesconfirmselfconversation"}else{if(data.canDeleteMessagesForAllUsers){showCheckDeleteDialogue(body);showmessage="deleteforeveryoneselectedmessagesconfirm"}else{showmessage="deleteselectedmessagesconfirm"}}if(data.show){return Str.get_string(showmessage,"core_message").then(function(string){return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_CONFIRM_DELETE_SELECTED_MESSAGES],string,"",!0,!1)})}else{return hideConfirmDialogue(header,body,footer)}},renderConfirmDeleteConversation=function(header,body,footer,type){var showmessage=null;if(type==CONVERSATION_TYPES.SELF){showmessage="deleteallselfconfirm"}else if(type){showmessage="deleteallconfirm"}if(showmessage){return Str.get_string(showmessage,"core_message").then(function(string){return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_CONFIRM_DELETE_CONVERSATION],string,"",!0,!1)})}else{return hideConfirmDialogue(header,body,footer)}},renderConfirmContactRequest=function(header,body,footer,user){if(user){return Str.get_string("userwouldliketocontactyou","core_message",user.fullname).then(function(string){var buttonSelectors=[SELECTORS.ACTION_ACCEPT_CONTACT_REQUEST,SELECTORS.ACTION_DECLINE_CONTACT_REQUEST];return showConfirmDialogue(header,body,footer,buttonSelectors,string,"",!1,!0)})}else{return hideConfirmDialogue(header,body,footer)}},showCheckDeleteDialogue=function(body){var dialogue=getConfirmDialogueContainer(body),checkboxRegion=dialogue.find(SELECTORS.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER);checkboxRegion.removeClass("hidden")},hideCheckDeleteDialogue=function(body){var dialogue=getConfirmDialogueContainer(body),checkboxRegion=dialogue.find(SELECTORS.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER),checkbox=dialogue.find(SELECTORS.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE);checkbox.prop("checked",!1);checkboxRegion.addClass("hidden")},renderIsBlocked=function(header,body,footer,isBlocked){if(isBlocked){header.find(SELECTORS.ACTION_REQUEST_BLOCK).addClass("hidden");header.find(SELECTORS.ACTION_REQUEST_UNBLOCK).removeClass("hidden")}else{header.find(SELECTORS.ACTION_REQUEST_BLOCK).removeClass("hidden");header.find(SELECTORS.ACTION_REQUEST_UNBLOCK).addClass("hidden")}},renderIsFavourite=function(header,body,footer,state){var favouriteIcon=header.find(SELECTORS.FAVOURITE_ICON_CONTAINER),addFavourite=header.find(SELECTORS.ACTION_CONFIRM_FAVOURITE),removeFavourite=header.find(SELECTORS.ACTION_CONFIRM_UNFAVOURITE);switch(state){case"hide":favouriteIcon.addClass("hidden");addFavourite.addClass("hidden");removeFavourite.addClass("hidden");break;case"show-add":favouriteIcon.addClass("hidden");addFavourite.removeClass("hidden");removeFavourite.addClass("hidden");break;case"show-remove":favouriteIcon.removeClass("hidden");addFavourite.addClass("hidden");removeFavourite.removeClass("hidden");break;}},renderIsMuted=function(header,body,footer,state){var muteIcon=header.find(SELECTORS.MUTED_ICON_CONTAINER),setMuted=header.find(SELECTORS.ACTION_CONFIRM_MUTE),unsetMuted=header.find(SELECTORS.ACTION_CONFIRM_UNMUTE);switch(state){case"hide":muteIcon.addClass("hidden");setMuted.addClass("hidden");unsetMuted.addClass("hidden");break;case"show-mute":muteIcon.addClass("hidden");setMuted.removeClass("hidden");unsetMuted.addClass("hidden");break;case"show-unmute":muteIcon.removeClass("hidden");setMuted.addClass("hidden");unsetMuted.removeClass("hidden");break;}},renderIsContact=function(header,body,footer,state){var addContact=header.find(SELECTORS.ACTION_REQUEST_ADD_CONTACT),removeContact=header.find(SELECTORS.ACTION_REQUEST_REMOVE_CONTACT);switch(state){case"pending-contact":addContact.addClass("hidden");removeContact.addClass("hidden");break;case"contact":addContact.addClass("hidden");removeContact.removeClass("hidden");break;case"non-contact":addContact.removeClass("hidden");removeContact.addClass("hidden");break;}},renderLoadingConfirmAction=function(header,body,footer,isLoading){var dialogue=getConfirmDialogueContainer(body),buttons=dialogue.find("button"),buttonText=dialogue.find(SELECTORS.CONFIRM_DIALOGUE_BUTTON_TEXT),loadingIcon=dialogue.find(SELECTORS.LOADING_ICON_CONTAINER);if(isLoading){buttons.prop("disabled",!0);buttonText.addClass("hidden");loadingIcon.removeClass("hidden")}else{buttons.prop("disabled",!1);buttonText.removeClass("hidden");loadingIcon.addClass("hidden")}},renderInEditMode=function(header,body,footer,inEditMode){var messages=null;if(inEditMode){messages=body.find(SELECTORS.MESSAGE_NOT_SELECTED);messages.find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).removeClass("hidden");hideHeaderContent(header);showHeaderEditMode(header)}else{messages=getMessagesContainer(body);messages.find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).addClass("hidden");messages.find(SELECTORS.MESSAGE_SELECTED_ICON).addClass("hidden");showHeaderContent(header);hideHeaderEditMode(header)}},renderSelectedMessages=function(header,body,footer,data){var hasSelectedMessages=0<data.count;if(data.add.length){data.add.forEach(function(messageId){var message=getMessageElement(body,messageId);message.find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).addClass("hidden");message.find(SELECTORS.MESSAGE_SELECTED_ICON).removeClass("hidden");message.attr("aria-checked",!0)})}if(data.remove.length){data.remove.forEach(function(messageId){var message=getMessageElement(body,messageId);if(hasSelectedMessages){message.find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).removeClass("hidden")}message.find(SELECTORS.MESSAGE_SELECTED_ICON).addClass("hidden");message.attr("aria-checked",!1)})}setMessagesSelectedCount(header,data.count)},renderRequireAddContact=function(header,body,footer,data){if(data.show&&!data.hasMessages){return Str.get_strings([{key:"requirecontacttomessage",component:"core_message",param:data.user.fullname},{key:"isnotinyourcontacts",component:"core_message",param:data.user.fullname}]).then(function(strings){var title=strings[1],text=strings[0];return showConfirmDialogue(header,body,footer,[SELECTORS.ACTION_REQUEST_ADD_CONTACT],text,title,!1,!0)})}else{return hideConfirmDialogue(header,body,footer)}},renderSelfConversationMessage=function(header,body,footer,displayMessage){var container=getSelfConversationMessageContainer(body);if(displayMessage){container.removeClass("hidden")}else{container.addClass("hidden")}return!0},renderContactRequestSent=function(header,body,footer,userFullName){var container=getContactRequestSentContainer(body);if(userFullName){return Str.get_string("yourcontactrequestpending","core_message",userFullName).then(function(string){container.find(SELECTORS.TEXT).text(string);container.removeClass("hidden");return string})}else{container.addClass("hidden");return!0}},renderReset=function(header,body,footer){hideConfirmDialogue(header,body,footer);hideContactRequestSentContainer(body);hideSelfConversationMessageContainer(body);hideAllHeaderElements(header);showHeaderPlaceholder(header);hideAllFooterElements(footer);showFooterPlaceholder(footer);return!0};return{render:function render(header,body,footer,patch){var configs=[{reset:renderReset},{conversation:renderConversation,header:renderHeader,footer:renderFooter,confirmBlockUser:renderConfirmBlockUser,confirmUnblockUser:renderConfirmUnblockUser,confirmAddContact:renderConfirmAddContact,confirmRemoveContact:renderConfirmRemoveContact,confirmDeleteSelectedMessages:renderConfirmDeleteSelectedMessages,confirmDeleteConversation:renderConfirmDeleteConversation,confirmContactRequest:renderConfirmContactRequest,requireAddContact:renderRequireAddContact,selfConversationMessage:renderSelfConversationMessage,contactRequestSent:renderContactRequestSent},{loadingMembers:renderLoadingMembers,loadingFirstMessages:renderLoadingFirstMessages,loadingMessages:renderLoadingMessages,isBlocked:renderIsBlocked,isContact:renderIsContact,isFavourite:renderIsFavourite,isMuted:renderIsMuted,loadingConfirmAction:renderLoadingConfirmAction,inEditMode:renderInEditMode,showEmojiPicker:renderShowEmojiPicker,showEmojiAutoComplete:renderShowEmojiAutoComplete},{scrollToMessage:renderScrollToMessage,selectedMessages:renderSelectedMessages}],processConfig=function(config){var results=[];for(var key in patch){if(config.hasOwnProperty(key)){var renderFunc=config[key],patchValue=patch[key];results.push(renderFunc(header,body,footer,patchValue))}}return results},renderingPromises=processConfig(configs[0]);renderingPromises=renderingPromises.concat(processConfig(configs[1]));return $.when.apply($,renderingPromises).then(function(){for(var i=2;i<configs.length;i++){processConfig(configs[i])}}).catch(Notification.exception)}}});
//# sourceMappingURL=message_drawer_view_conversation_renderer.min.js.map
