{"version":3,"sources":["../src/message_drawer.js"],"names":["define","$","CustomEvents","PubSub","ViewContact","ViewContacts","ViewConversation","ViewGroupInfo","ViewOverview","ViewSearch","ViewSettings","Router","Routes","Events","Pending","Drawer","SELECTORS","DRAWER","JUMPTO","PANEL_BODY_CONTAINER","PANEL_HEADER_CONTAINER","VIEW_CONTACT","VIEW_CONTACTS","VIEW_CONVERSATION","VIEW_GROUP_INFO","VIEW_OVERVIEW","VIEW_SEARCH","VIEW_SETTINGS","ROUTES","ROUTES_BACK","HEADER_CONTAINER","BODY_CONTAINER","FOOTER_CONTAINER","CLOSE_BUTTON","getParametersForRoute","namespace","root","selector","header","find","length","body","footer","routes","show","description","createRoutes","forEach","route","add","attr","go","drawerRoot","getDrawerRoot","hide","isVisible","setJumpFrom","buttonid","registerEventListeners","alwaysVisible","events","activate","paramRegex","on","e","data","element","target","closest","attributes","i","push","paramAttributes","filter","attribute","name","nodeName","match","test","sort","a","b","aParts","exec","bParts","aIndex","bIndex","params","map","nodeValue","routeParams","concat","apply","originalEvent","preventDefault","back","pendingPromise","one","resolve","focus","firstInput","button","subscribe","SHOW","HIDE","TOGGLE_VISIBILITY","SHOW_CONVERSATION","args","conversationid","closebutton","publish","CREATE_CONVERSATION_WITH_USER","userid","SHOW_SETTINGS","PREFERENCES_UPDATED","preferences","filteredPreferences","preference","type","enterToSendPreference","viewConversationFooter","value","init","uniqueId","path"],"mappings":"AAsBAA,OAAM,+BACN,CACI,QADJ,CAEI,gCAFJ,CAGI,aAHJ,CAII,0CAJJ,CAKI,2CALJ,CAMI,+CANJ,CAOI,6CAPJ,CAQI,2CARJ,CASI,yCATJ,CAUI,2CAVJ,CAWI,oCAXJ,CAYI,oCAZJ,CAaI,oCAbJ,CAcI,cAdJ,CAeI,aAfJ,CADM,CAkBN,SACIC,CADJ,CAEIC,YAFJ,CAGIC,MAHJ,CAIIC,WAJJ,CAKIC,YALJ,CAMIC,gBANJ,CAOIC,aAPJ,CAQIC,YARJ,CASIC,UATJ,CAUIC,YAVJ,CAWIC,MAXJ,CAYIC,MAZJ,CAaIC,MAbJ,CAcIC,OAdJ,CAeIC,MAfJ,CAgBE,IAEMC,CAAAA,SAAS,CAAG,CACZC,MAAM,CAAE,qCADI,CAEZC,MAAM,CAAE,0CAFI,CAGZC,oBAAoB,CAAE,wCAHV,CAIZC,sBAAsB,CAAE,0CAJZ,CAKZC,YAAY,CAAE,gCALF,CAMZC,aAAa,CAAE,iCANH,CAOZC,iBAAiB,CAAE,qCAPP,CAQZC,eAAe,CAAE,mCARL,CASZC,aAAa,CAAE,iCATH,CAUZC,WAAW,CAAE,+BAVD,CAWZC,aAAa,CAAE,iCAXH,CAYZC,MAAM,CAAE,cAZI,CAaZC,WAAW,CAAE,mBAbD,CAcZC,gBAAgB,CAAE,oCAdN,CAeZC,cAAc,CAAE,kCAfJ,CAgBZC,gBAAgB,CAAE,oCAhBN,CAiBZC,YAAY,CAAE,+BAjBF,CAFlB,CA+BMC,qBAAqB,CAAG,SAASC,SAAT,CAAoBC,IAApB,CAA0BC,QAA1B,CAAoC,CAE5D,GAAIC,CAAAA,MAAM,CAAGF,IAAI,CAACG,IAAL,CAAUvB,SAAS,CAACc,gBAApB,EAAsCS,IAAtC,CAA2CF,QAA3C,CAAb,CACA,GAAI,CAACC,MAAM,CAACE,MAAZ,CAAoB,CAChBF,MAAM,CAAGF,IAAI,CAACG,IAAL,CAAUvB,SAAS,CAACI,sBAApB,EAA4CmB,IAA5C,CAAiDF,QAAjD,CACZ,CACD,GAAII,CAAAA,IAAI,CAAGL,IAAI,CAACG,IAAL,CAAUvB,SAAS,CAACe,cAApB,EAAoCQ,IAApC,CAAyCF,QAAzC,CAAX,CACA,GAAI,CAACI,IAAI,CAACD,MAAV,CAAkB,CACdC,IAAI,CAAGL,IAAI,CAACG,IAAL,CAAUvB,SAAS,CAACG,oBAApB,EAA0CoB,IAA1C,CAA+CF,QAA/C,CACV,CACD,GAAIK,CAAAA,MAAM,CAAGN,IAAI,CAACG,IAAL,CAAUvB,SAAS,CAACgB,gBAApB,EAAsCO,IAAtC,CAA2CF,QAA3C,CAAb,CAEA,MAAO,CACHF,SADG,CAEHG,MAAM,CAACE,MAAP,CAAgBF,MAAhB,CAAyB,IAFtB,CAGHG,IAAI,CAACD,MAAL,CAAcC,IAAd,CAAqB,IAHlB,CAIHC,MAAM,CAACF,MAAP,CAAgBE,MAAhB,CAAyB,IAJtB,CAMV,CAjDH,CAmDMC,MAAM,CAAG,CACT,CAAC/B,MAAM,CAACS,YAAR,CAAsBL,SAAS,CAACK,YAAhC,CAA8CjB,WAAW,CAACwC,IAA1D,CAAgExC,WAAW,CAACyC,WAA5E,CADS,CAET,CAACjC,MAAM,CAACU,aAAR,CAAuBN,SAAS,CAACM,aAAjC,CAAgDjB,YAAY,CAACuC,IAA7D,CAAmEvC,YAAY,CAACwC,WAAhF,CAFS,CAGT,CAACjC,MAAM,CAACW,iBAAR,CAA2BP,SAAS,CAACO,iBAArC,CAAwDjB,gBAAgB,CAACsC,IAAzE,CAA+EtC,gBAAgB,CAACuC,WAAhG,CAHS,CAIT,CAACjC,MAAM,CAACY,eAAR,CAAyBR,SAAS,CAACQ,eAAnC,CAAoDjB,aAAa,CAACqC,IAAlE,CAAwErC,aAAa,CAACsC,WAAtF,CAJS,CAKT,CAACjC,MAAM,CAACa,aAAR,CAAuBT,SAAS,CAACS,aAAjC,CAAgDjB,YAAY,CAACoC,IAA7D,CAAmEpC,YAAY,CAACqC,WAAhF,CALS,CAMT,CAACjC,MAAM,CAACc,WAAR,CAAqBV,SAAS,CAACU,WAA/B,CAA4CjB,UAAU,CAACmC,IAAvD,CAA6DnC,UAAU,CAACoC,WAAxE,CANS,CAOT,CAACjC,MAAM,CAACe,aAAR,CAAuBX,SAAS,CAACW,aAAjC,CAAgDjB,YAAY,CAACkC,IAA7D,CAAmElC,YAAY,CAACmC,WAAhF,CAPS,CAnDf,CAmEMC,YAAY,CAAG,SAASX,SAAT,CAAoBC,IAApB,CAA0B,CACzCO,MAAM,CAACI,OAAP,CAAe,SAASC,KAAT,CAAgB,CAC3BrC,MAAM,CAACsC,GAAP,CAAWd,SAAX,CAAsBa,KAAK,CAAC,CAAD,CAA3B,CAAgCd,qBAAqB,CAACC,SAAD,CAAYC,IAAZ,CAAkBY,KAAK,CAAC,CAAD,CAAvB,CAArD,CAAkFA,KAAK,CAAC,CAAD,CAAvF,CAA4FA,KAAK,CAAC,CAAD,CAAjG,CACH,CAFD,CAGH,CAvEH,CA+EMJ,IAAI,CAAG,SAAST,SAAT,CAAoBC,IAApB,CAA0B,CACjC,GAAI,CAACA,IAAI,CAACc,IAAL,CAAU,YAAV,CAAL,CAA8B,CAC1BvC,MAAM,CAACwC,EAAP,CAAUhB,SAAV,CAAqBvB,MAAM,CAACa,aAA5B,EACAW,IAAI,CAACc,IAAL,CAAU,YAAV,IACH,CAED,GAAIE,CAAAA,UAAU,CAAGrC,MAAM,CAACsC,aAAP,CAAqBjB,IAArB,CAAjB,CACA,GAAIgB,UAAU,CAACZ,MAAf,CAAuB,CACnBzB,MAAM,CAAC6B,IAAP,CAAYQ,UAAZ,CACH,CACJ,CAzFH,CAgGME,IAAI,CAAG,SAASlB,IAAT,CAAe,CACtB,GAAIgB,CAAAA,UAAU,CAAGrC,MAAM,CAACsC,aAAP,CAAqBjB,IAArB,CAAjB,CACA,GAAIgB,UAAU,CAACZ,MAAf,CAAuB,CACnBzB,MAAM,CAACuC,IAAP,CAAYF,UAAZ,CACH,CACJ,CArGH,CA6GMG,SAAS,CAAG,SAASnB,IAAT,CAAe,CAC3B,GAAIgB,CAAAA,UAAU,CAAGrC,MAAM,CAACsC,aAAP,CAAqBjB,IAArB,CAAjB,CACA,GAAIgB,UAAU,CAACZ,MAAf,CAAuB,CACnB,MAAOzB,CAAAA,MAAM,CAACwC,SAAP,CAAiBH,UAAjB,CACV,CACD,QACH,CAnHH,CA0HMI,WAAW,CAAG,SAASC,QAAT,CAAmB,CACjCxD,CAAC,CAACe,SAAS,CAACC,MAAX,CAAD,CAAoBiC,IAApB,CAAyB,aAAzB,CAAwCO,QAAxC,CACH,CA5HH,CAqIMC,sBAAsB,CAAG,SAASvB,SAAT,CAAoBC,IAApB,CAA0BuB,aAA1B,CAAyC,CAClEzD,YAAY,CAACF,MAAb,CAAoBoC,IAApB,CAA0B,CAAClC,YAAY,CAAC0D,MAAb,CAAoBC,QAArB,CAA1B,EACA,GAAIC,CAAAA,UAAU,CAAG,2BAAjB,CAEA1B,IAAI,CAAC2B,EAAL,CAAQ7D,YAAY,CAAC0D,MAAb,CAAoBC,QAA5B,CAAsC7C,SAAS,CAACY,MAAhD,CAAwD,SAASoC,CAAT,CAAYC,IAAZ,CAAkB,CAKtE,OAJIC,CAAAA,OAAO,CAAGjE,CAAC,CAAC+D,CAAC,CAACG,MAAH,CAAD,CAAYC,OAAZ,CAAoBpD,SAAS,CAACY,MAA9B,CAId,CAHIoB,KAAK,CAAGkB,OAAO,CAAChB,IAAR,CAAa,YAAb,CAGZ,CAFImB,UAAU,CAAG,EAEjB,CAASC,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGJ,OAAO,CAAC,CAAD,CAAP,CAAWG,UAAX,CAAsB7B,MAA1C,CAAkD8B,CAAC,EAAnD,CAAuD,CACnDD,UAAU,CAACE,IAAX,CAAgBL,OAAO,CAAC,CAAD,CAAP,CAAWG,UAAX,CAAsBC,CAAtB,CAAhB,CACH,CAED,GAAIE,CAAAA,eAAe,CAAGH,UAAU,CAACI,MAAX,CAAkB,SAASC,SAAT,CAAoB,IACpDC,CAAAA,IAAI,CAAGD,SAAS,CAACE,QADmC,CAEpDC,KAAK,CAAGf,UAAU,CAACgB,IAAX,CAAgBH,IAAhB,CAF4C,CAGxD,MAAOE,CAAAA,KACV,CAJqB,CAAtB,CAKAL,eAAe,CAACO,IAAhB,CAAqB,SAASC,CAAT,CAAYC,CAAZ,CAAe,IAC5BC,CAAAA,MAAM,CAAGpB,UAAU,CAACqB,IAAX,CAAgBH,CAAC,CAACJ,QAAlB,CADmB,CAE5BQ,MAAM,CAAGtB,UAAU,CAACqB,IAAX,CAAgBF,CAAC,CAACL,QAAlB,CAFmB,CAG5BS,MAAM,CAAmB,CAAhB,CAAAH,MAAM,CAAC1C,MAAP,CAAoB0C,MAAM,CAAC,CAAD,CAA1B,CAAgC,CAHb,CAI5BI,MAAM,CAAmB,CAAhB,CAAAF,MAAM,CAAC5C,MAAP,CAAoB4C,MAAM,CAAC,CAAD,CAA1B,CAAgC,CAJb,CAMhC,GAAIC,MAAM,CAAGC,MAAb,CAAqB,CACjB,MAAO,CAAC,CACX,CAFD,IAEO,IAAIA,MAAM,CAAGD,MAAb,CAAqB,CACxB,MAAO,EACV,CAFM,IAEA,CACH,MAAO,EACV,CACJ,CAbD,EAdsE,GA6BlEE,CAAAA,MAAM,CAAGf,eAAe,CAACgB,GAAhB,CAAoB,SAASd,SAAT,CAAoB,CACjD,MAAOA,CAAAA,SAAS,CAACe,SACpB,CAFY,CA7ByD,CAiClEC,WAAW,CAAG,CAACvD,SAAD,CAAYa,KAAZ,EAAmB2C,MAAnB,CAA0BJ,MAA1B,CAjCoD,CAmCtE5E,MAAM,CAACwC,EAAP,CAAUyC,KAAV,CAAgB,IAAhB,CAAsBF,WAAtB,EAEAzB,IAAI,CAAC4B,aAAL,CAAmBC,cAAnB,EACH,CAtCD,EAwCA1D,IAAI,CAAC2B,EAAL,CAAQ7D,YAAY,CAAC0D,MAAb,CAAoBC,QAA5B,CAAsC7C,SAAS,CAACa,WAAhD,CAA6D,SAASmC,CAAT,CAAYC,IAAZ,CAAkB,CAC3EtD,MAAM,CAACoF,IAAP,CAAY5D,SAAZ,EAEA8B,IAAI,CAAC4B,aAAL,CAAmBC,cAAnB,EACH,CAJD,EAQA1D,IAAI,CAAC2B,EAAL,CAAQ,kBAAR,CAA4B,WAA5B,CAAyC,SAASC,CAAT,CAAY,CACjD,GAAIgC,CAAAA,cAAc,CAAG,GAAIlF,CAAAA,OAAzB,CACAb,CAAC,CAAC+D,CAAC,CAACG,MAAH,CAAD,CAAY8B,GAAZ,CAAgB,oBAAhB,CAAsC,UAAW,CAC7CD,cAAc,CAACE,OAAf,EACH,CAFD,CAGH,CALD,EAOA9D,IAAI,CAAC2B,EAAL,CAAQ,kBAAR,CAA4B,WAA5B,CAAyC,SAASC,CAAT,CAAY,CACjD,GAAIgC,CAAAA,cAAc,CAAG,GAAIlF,CAAAA,OAAzB,CACAb,CAAC,CAAC+D,CAAC,CAACG,MAAH,CAAD,CAAY8B,GAAZ,CAAgB,mBAAhB,CAAqC,UAAW,CAC5CD,cAAc,CAACE,OAAf,EACH,CAFD,CAGH,CALD,EAOAjG,CAAC,CAACe,SAAS,CAACE,MAAX,CAAD,CAAoBiF,KAApB,CAA0B,UAAW,CACjC,GAAIC,CAAAA,UAAU,CAAGnG,CAAC,CAACe,SAAS,CAACc,gBAAX,CAAD,CAA8BS,IAA9B,CAAmC,eAAnC,CAAjB,CACA,GAAI6D,UAAU,CAAC5D,MAAf,CAAuB,CACnB4D,UAAU,CAACD,KAAX,EACH,CAFD,IAEO,CACHlG,CAAC,CAACe,SAAS,CAACc,gBAAX,CAAD,CAA8BS,IAA9B,CAAmCvB,SAAS,CAACa,WAA7C,EAA0DsE,KAA1D,EACH,CACJ,CAPD,EASAlG,CAAC,CAACe,SAAS,CAACC,MAAX,CAAD,CAAoBkF,KAApB,CAA0B,UAAW,CACjC,GAAIE,CAAAA,MAAM,CAAGpG,CAAC,CAAC,IAAD,CAAD,CAAQiD,IAAR,CAAa,aAAb,CAAb,CACA,GAAImD,MAAJ,CAAY,CACRpG,CAAC,CAAC,IAAMoG,MAAP,CAAD,CAAgBF,KAAhB,EACH,CACJ,CALD,EAOA,GAAI,CAACxC,aAAL,CAAoB,CAChBxD,MAAM,CAACmG,SAAP,CAAiBzF,MAAM,CAAC0F,IAAxB,CAA8B,UAAW,CACrC3D,IAAI,CAACT,SAAD,CAAYC,IAAZ,CACP,CAFD,EAIAjC,MAAM,CAACmG,SAAP,CAAiBzF,MAAM,CAAC2F,IAAxB,CAA8B,UAAW,CACrClD,IAAI,CAAClB,IAAD,CACP,CAFD,EAIAjC,MAAM,CAACmG,SAAP,CAAiBzF,MAAM,CAAC4F,iBAAxB,CAA2C,SAAShD,QAAT,CAAmB,CAC1D,GAAIF,SAAS,CAACnB,IAAD,CAAb,CAAqB,CACjBkB,IAAI,CAAClB,IAAD,CAAJ,CACAnC,CAAC,CAACe,SAAS,CAACE,MAAX,CAAD,CAAoBgC,IAApB,CAAyB,UAAzB,CAAqC,CAAC,CAAtC,CACH,CAHD,IAGO,CACHN,IAAI,CAACT,SAAD,CAAYC,IAAZ,CAAJ,CACAoB,WAAW,CAACC,QAAD,CAAX,CACAxD,CAAC,CAACe,SAAS,CAACE,MAAX,CAAD,CAAoBgC,IAApB,CAAyB,UAAzB,CAAqC,CAArC,CACH,CACJ,CATD,CAUH,CAED/C,MAAM,CAACmG,SAAP,CAAiBzF,MAAM,CAAC6F,iBAAxB,CAA2C,SAASC,IAAT,CAAe,CACtDnD,WAAW,CAACmD,IAAI,CAAClD,QAAN,CAAX,CACAb,IAAI,CAACT,SAAD,CAAYC,IAAZ,CAAJ,CACAzB,MAAM,CAACwC,EAAP,CAAUhB,SAAV,CAAqBvB,MAAM,CAACW,iBAA5B,CAA+CoF,IAAI,CAACC,cAApD,CACH,CAJD,EAMA,GAAIC,CAAAA,WAAW,CAAGzE,IAAI,CAACG,IAAL,CAAUvB,SAAS,CAACiB,YAApB,CAAlB,CACA4E,WAAW,CAAC9C,EAAZ,CAAe7D,YAAY,CAAC0D,MAAb,CAAoBC,QAAnC,CAA6C,UAAW,CACpD1D,MAAM,CAAC2G,OAAP,CAAejG,MAAM,CAAC4F,iBAAtB,CACH,CAFD,EAIAtG,MAAM,CAACmG,SAAP,CAAiBzF,MAAM,CAACkG,6BAAxB,CAAuD,SAASJ,IAAT,CAAe,CAClEnD,WAAW,CAACmD,IAAI,CAAClD,QAAN,CAAX,CACAb,IAAI,CAACT,SAAD,CAAYC,IAAZ,CAAJ,CACAzB,MAAM,CAACwC,EAAP,CAAUhB,SAAV,CAAqBvB,MAAM,CAACW,iBAA5B,CAA+C,IAA/C,CAAqD,QAArD,CAA+DoF,IAAI,CAACK,MAApE,CACH,CAJD,EAMA7G,MAAM,CAACmG,SAAP,CAAiBzF,MAAM,CAACoG,aAAxB,CAAuC,UAAW,CAC9CrE,IAAI,CAACT,SAAD,CAAYC,IAAZ,CAAJ,CACAzB,MAAM,CAACwC,EAAP,CAAUhB,SAAV,CAAqBvB,MAAM,CAACe,aAA5B,CACH,CAHD,EAKAxB,MAAM,CAACmG,SAAP,CAAiBzF,MAAM,CAACqG,mBAAxB,CAA6C,SAASC,WAAT,CAAsB,IAC3DC,CAAAA,mBAAmB,CAAGD,WAAW,CAAC1C,MAAZ,CAAmB,SAAS4C,UAAT,CAAqB,CAC9D,MAA0B,qBAAnB,EAAAA,UAAU,CAACC,IACrB,CAFyB,CADqC,CAI3DC,qBAAqB,CAAGH,mBAAmB,CAAC5E,MAApB,CAA6B4E,mBAAmB,CAAC,CAAD,CAAhD,CAAsD,IAJnB,CAM/D,GAAIG,qBAAJ,CAA2B,CACvB,GAAIC,CAAAA,sBAAsB,CAAGpF,IAAI,CAACG,IAAL,CAAUvB,SAAS,CAACgB,gBAApB,EAAsCO,IAAtC,CAA2CvB,SAAS,CAACO,iBAArD,CAA7B,CACAiG,sBAAsB,CAACtE,IAAvB,CAA4B,oBAA5B,CAAkDqE,qBAAqB,CAACE,KAAxE,CACH,CACJ,CAVD,CAWH,CA7QH,CAuSE,MAAO,CACHC,IAAI,CAjBG,QAAPA,CAAAA,IAAO,CAAStF,IAAT,CAAeuF,QAAf,CAAyBhE,aAAzB,CAAwCX,KAAxC,CAA+C,CACtDZ,IAAI,CAAGnC,CAAC,CAACmC,IAAD,CAAR,CACAU,YAAY,CAAC6E,QAAD,CAAWvF,IAAX,CAAZ,CACAsB,sBAAsB,CAACiE,QAAD,CAAWvF,IAAX,CAAiBuB,aAAjB,CAAtB,CAEA,GAAIA,aAAJ,CAAmB,CACff,IAAI,CAAC+E,QAAD,CAAWvF,IAAX,CAAJ,CAEA,GAAIY,KAAJ,CAAW,CACP,GAAI0C,CAAAA,WAAW,CAAG1C,KAAK,CAACuC,MAAN,EAAgB,EAAlC,CACAG,WAAW,CAAG,CAACiC,QAAD,CAAW3E,KAAK,CAAC4E,IAAjB,EAAuBjC,MAAvB,CAA8BD,WAA9B,CAAd,CACA/E,MAAM,CAACwC,EAAP,CAAUyC,KAAV,CAAgB,IAAhB,CAAsBF,WAAtB,CACH,CACJ,CACJ,CAEM,CAGV,CA5UK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Controls the message drawer.\n *\n * @module     core_message/message_drawer\n * @copyright  2018 Ryan Wyllie <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(\n[\n    'jquery',\n    'core/custom_interaction_events',\n    'core/pubsub',\n    'core_message/message_drawer_view_contact',\n    'core_message/message_drawer_view_contacts',\n    'core_message/message_drawer_view_conversation',\n    'core_message/message_drawer_view_group_info',\n    'core_message/message_drawer_view_overview',\n    'core_message/message_drawer_view_search',\n    'core_message/message_drawer_view_settings',\n    'core_message/message_drawer_router',\n    'core_message/message_drawer_routes',\n    'core_message/message_drawer_events',\n    'core/pending',\n    'core/drawer',\n],\nfunction(\n    $,\n    CustomEvents,\n    PubSub,\n    ViewContact,\n    ViewContacts,\n    ViewConversation,\n    ViewGroupInfo,\n    ViewOverview,\n    ViewSearch,\n    ViewSettings,\n    Router,\n    Routes,\n    Events,\n    Pending,\n    Drawer\n) {\n\n    var SELECTORS = {\n        DRAWER: '[data-region=\"right-hand-drawer\"]',\n        JUMPTO: '.popover-region [data-region=\"jumpto\"]',\n        PANEL_BODY_CONTAINER: '[data-region=\"panel-body-container\"]',\n        PANEL_HEADER_CONTAINER: '[data-region=\"panel-header-container\"]',\n        VIEW_CONTACT: '[data-region=\"view-contact\"]',\n        VIEW_CONTACTS: '[data-region=\"view-contacts\"]',\n        VIEW_CONVERSATION: '[data-region=\"view-conversation\"]',\n        VIEW_GROUP_INFO: '[data-region=\"view-group-info\"]',\n        VIEW_OVERVIEW: '[data-region=\"view-overview\"]',\n        VIEW_SEARCH: '[data-region=\"view-search\"]',\n        VIEW_SETTINGS: '[data-region=\"view-settings\"]',\n        ROUTES: '[data-route]',\n        ROUTES_BACK: '[data-route-back]',\n        HEADER_CONTAINER: '[data-region=\"header-container\"]',\n        BODY_CONTAINER: '[data-region=\"body-container\"]',\n        FOOTER_CONTAINER: '[data-region=\"footer-container\"]',\n        CLOSE_BUTTON: '[data-action=\"closedrawer\"]'\n    };\n\n    /**\n     * Get elements for route.\n     *\n     * @param {String} namespace Unique identifier for the Routes\n     * @param {Object} root The message drawer container.\n     * @param {string} selector The route container.\n     *\n     * @return {array} elements Found route container objects.\n    */\n    var getParametersForRoute = function(namespace, root, selector) {\n\n        var header = root.find(SELECTORS.HEADER_CONTAINER).find(selector);\n        if (!header.length) {\n            header = root.find(SELECTORS.PANEL_HEADER_CONTAINER).find(selector);\n        }\n        var body = root.find(SELECTORS.BODY_CONTAINER).find(selector);\n        if (!body.length) {\n            body = root.find(SELECTORS.PANEL_BODY_CONTAINER).find(selector);\n        }\n        var footer = root.find(SELECTORS.FOOTER_CONTAINER).find(selector);\n\n        return [\n            namespace,\n            header.length ? header : null,\n            body.length ? body : null,\n            footer.length ? footer : null\n        ];\n    };\n\n    var routes = [\n        [Routes.VIEW_CONTACT, SELECTORS.VIEW_CONTACT, ViewContact.show, ViewContact.description],\n        [Routes.VIEW_CONTACTS, SELECTORS.VIEW_CONTACTS, ViewContacts.show, ViewContacts.description],\n        [Routes.VIEW_CONVERSATION, SELECTORS.VIEW_CONVERSATION, ViewConversation.show, ViewConversation.description],\n        [Routes.VIEW_GROUP_INFO, SELECTORS.VIEW_GROUP_INFO, ViewGroupInfo.show, ViewGroupInfo.description],\n        [Routes.VIEW_OVERVIEW, SELECTORS.VIEW_OVERVIEW, ViewOverview.show, ViewOverview.description],\n        [Routes.VIEW_SEARCH, SELECTORS.VIEW_SEARCH, ViewSearch.show, ViewSearch.description],\n        [Routes.VIEW_SETTINGS, SELECTORS.VIEW_SETTINGS, ViewSettings.show, ViewSettings.description]\n    ];\n\n    /**\n     * Create routes.\n     *\n     * @param {String} namespace Unique identifier for the Routes\n     * @param {Object} root The message drawer container.\n     */\n    var createRoutes = function(namespace, root) {\n        routes.forEach(function(route) {\n            Router.add(namespace, route[0], getParametersForRoute(namespace, root, route[1]), route[2], route[3]);\n        });\n    };\n\n    /**\n     * Show the message drawer.\n     *\n     * @param {string} namespace The route namespace.\n     * @param {Object} root The message drawer container.\n     */\n    var show = function(namespace, root) {\n        if (!root.attr('data-shown')) {\n            Router.go(namespace, Routes.VIEW_OVERVIEW);\n            root.attr('data-shown', true);\n        }\n\n        var drawerRoot = Drawer.getDrawerRoot(root);\n        if (drawerRoot.length) {\n            Drawer.show(drawerRoot);\n        }\n    };\n\n    /**\n     * Hide the message drawer.\n     *\n     * @param {Object} root The message drawer container.\n     */\n    var hide = function(root) {\n        var drawerRoot = Drawer.getDrawerRoot(root);\n        if (drawerRoot.length) {\n            Drawer.hide(drawerRoot);\n        }\n    };\n\n    /**\n     * Check if the drawer is visible.\n     *\n     * @param {Object} root The message drawer container.\n     * @return {boolean}\n     */\n    var isVisible = function(root) {\n        var drawerRoot = Drawer.getDrawerRoot(root);\n        if (drawerRoot.length) {\n            return Drawer.isVisible(drawerRoot);\n        }\n        return true;\n    };\n\n    /**\n     * Set Jump from button\n     *\n     * @param {String} buttonid The originating button id\n     */\n    var setJumpFrom = function(buttonid) {\n        $(SELECTORS.DRAWER).attr('data-origin', buttonid);\n    };\n\n    /**\n     * Listen to and handle events for routing, showing and hiding the message drawer.\n     *\n     * @param {string} namespace The route namespace.\n     * @param {Object} root The message drawer container.\n     * @param {bool} alwaysVisible Is this messaging app always shown?\n     */\n    var registerEventListeners = function(namespace, root, alwaysVisible) {\n        CustomEvents.define(root, [CustomEvents.events.activate]);\n        var paramRegex = /^data-route-param-?(\\d*)$/;\n\n        root.on(CustomEvents.events.activate, SELECTORS.ROUTES, function(e, data) {\n            var element = $(e.target).closest(SELECTORS.ROUTES);\n            var route = element.attr('data-route');\n            var attributes = [];\n\n            for (var i = 0; i < element[0].attributes.length; i++) {\n                attributes.push(element[0].attributes[i]);\n            }\n\n            var paramAttributes = attributes.filter(function(attribute) {\n                var name = attribute.nodeName;\n                var match = paramRegex.test(name);\n                return match;\n            });\n            paramAttributes.sort(function(a, b) {\n                var aParts = paramRegex.exec(a.nodeName);\n                var bParts = paramRegex.exec(b.nodeName);\n                var aIndex = aParts.length > 1 ? aParts[1] : 0;\n                var bIndex = bParts.length > 1 ? bParts[1] : 0;\n\n                if (aIndex < bIndex) {\n                    return -1;\n                } else if (bIndex < aIndex) {\n                    return 1;\n                } else {\n                    return 0;\n                }\n            });\n\n            var params = paramAttributes.map(function(attribute) {\n                return attribute.nodeValue;\n            });\n\n            var routeParams = [namespace, route].concat(params);\n\n            Router.go.apply(null, routeParams);\n\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ROUTES_BACK, function(e, data) {\n            Router.back(namespace);\n\n            data.originalEvent.preventDefault();\n        });\n\n        // These are theme-specific to help us fix random behat fails.\n        // These events target those events defined in BS3 and BS4 onwards.\n        root.on('hide.bs.collapse', '.collapse', function(e) {\n            var pendingPromise = new Pending();\n            $(e.target).one('hidden.bs.collapse', function() {\n                pendingPromise.resolve();\n            });\n        });\n\n        root.on('show.bs.collapse', '.collapse', function(e) {\n            var pendingPromise = new Pending();\n            $(e.target).one('shown.bs.collapse', function() {\n                pendingPromise.resolve();\n            });\n        });\n\n        $(SELECTORS.JUMPTO).focus(function() {\n            var firstInput = $(SELECTORS.HEADER_CONTAINER).find('input:visible');\n            if (firstInput.length) {\n                firstInput.focus();\n            } else {\n                $(SELECTORS.HEADER_CONTAINER).find(SELECTORS.ROUTES_BACK).focus();\n            }\n        });\n\n        $(SELECTORS.DRAWER).focus(function() {\n            var button = $(this).attr('data-origin');\n            if (button) {\n                $('#' + button).focus();\n            }\n        });\n\n        if (!alwaysVisible) {\n            PubSub.subscribe(Events.SHOW, function() {\n                show(namespace, root);\n            });\n\n            PubSub.subscribe(Events.HIDE, function() {\n                hide(root);\n            });\n\n            PubSub.subscribe(Events.TOGGLE_VISIBILITY, function(buttonid) {\n                if (isVisible(root)) {\n                    hide(root);\n                    $(SELECTORS.JUMPTO).attr('tabindex', -1);\n                } else {\n                    show(namespace, root);\n                    setJumpFrom(buttonid);\n                    $(SELECTORS.JUMPTO).attr('tabindex', 0);\n                }\n            });\n        }\n\n        PubSub.subscribe(Events.SHOW_CONVERSATION, function(args) {\n            setJumpFrom(args.buttonid);\n            show(namespace, root);\n            Router.go(namespace, Routes.VIEW_CONVERSATION, args.conversationid);\n        });\n\n        var closebutton = root.find(SELECTORS.CLOSE_BUTTON);\n        closebutton.on(CustomEvents.events.activate, function() {\n            PubSub.publish(Events.TOGGLE_VISIBILITY);\n        });\n\n        PubSub.subscribe(Events.CREATE_CONVERSATION_WITH_USER, function(args) {\n            setJumpFrom(args.buttonid);\n            show(namespace, root);\n            Router.go(namespace, Routes.VIEW_CONVERSATION, null, 'create', args.userid);\n        });\n\n        PubSub.subscribe(Events.SHOW_SETTINGS, function() {\n            show(namespace, root);\n            Router.go(namespace, Routes.VIEW_SETTINGS);\n        });\n\n        PubSub.subscribe(Events.PREFERENCES_UPDATED, function(preferences) {\n            var filteredPreferences = preferences.filter(function(preference) {\n                return preference.type == 'message_entertosend';\n            });\n            var enterToSendPreference = filteredPreferences.length ? filteredPreferences[0] : null;\n\n            if (enterToSendPreference) {\n                var viewConversationFooter = root.find(SELECTORS.FOOTER_CONTAINER).find(SELECTORS.VIEW_CONVERSATION);\n                viewConversationFooter.attr('data-enter-to-send', enterToSendPreference.value);\n            }\n        });\n    };\n\n    /**\n     * Initialise the message drawer.\n     *\n     * @param {Object} root The message drawer container.\n     * @param {String} uniqueId Unique identifier for the Routes\n     * @param {bool} alwaysVisible Should we show the app now, or wait for the user?\n     * @param {Object} route\n     */\n    var init = function(root, uniqueId, alwaysVisible, route) {\n        root = $(root);\n        createRoutes(uniqueId, root);\n        registerEventListeners(uniqueId, root, alwaysVisible);\n\n        if (alwaysVisible) {\n            show(uniqueId, root);\n\n            if (route) {\n                var routeParams = route.params || [];\n                routeParams = [uniqueId, route.path].concat(routeParams);\n                Router.go.apply(null, routeParams);\n            }\n        }\n    };\n\n    return {\n        init: init,\n    };\n});\n"],"file":"message_drawer.min.js"}