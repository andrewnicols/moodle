{"version":3,"sources":["../src/message_drawer_lazy_load_list.js"],"names":["define","$","CustomEvents","SELECTORS","ROOT","LOADING_ICON_CONTAINER","CONTENT_CONTAINER","EMPTY_MESSAGE","PLACEHOLDER","startLoading","root","attr","stopLoading","isLoading","getUserId","getContentContainer","find","showLoadingIcon","removeClass","hideLoadingIcon","addClass","showEmptyMessage","showPlaceholder","hidePlaceholder","showContent","hideContent","hasLoadedAll","setLoadedAll","value","canLoadMore","loadAndRender","loadCallback","renderCallback","userId","then","items","length","contentContainer","catch","initialLoadAndRender","empty","registerEventListeners","events","scrollBottom","on","show","getRoot","containerElement","hideEmptyMessage"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Lazy loaded list of items.\n *\n * @module     core_message/message_drawer_lazy_load_list\n * @copyright  2018 Ryan Wyllie <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(\n[\n    'jquery',\n    'core/custom_interaction_events'\n],\nfunction(\n    $,\n    CustomEvents\n) {\n\n    var SELECTORS = {\n        ROOT: '[data-region=\"lazy-load-list\"]',\n        LOADING_ICON_CONTAINER: '[data-region=\"loading-icon-container\"]',\n        CONTENT_CONTAINER: '[data-region=\"content-container\"]',\n        EMPTY_MESSAGE: '[data-region=\"empty-message-container\"]',\n        PLACEHOLDER: '[data-region=\"placeholder-container\"]'\n    };\n\n    /**\n     * Flag element as loading.\n     *\n     * @param {Object} root The section container element.\n     */\n    var startLoading = function(root) {\n        root.attr('data-loading', true);\n    };\n\n    /**\n     * Flag element as not loading.\n     *\n     * @param {Object} root The section container element.\n     */\n    var stopLoading = function(root) {\n        root.attr('data-loading', false);\n    };\n\n    /**\n     * Check if the element is loading.\n     *\n     * @param {Object} root The section container element.\n     * @return {Bool}\n     */\n    var isLoading = function(root) {\n        return root.attr('data-loading') === 'true';\n    };\n\n    /**\n     * Get user id\n     *\n     * @param  {Object} root The section container element.\n     * @return {Number} Logged in user id.\n     */\n    var getUserId = function(root) {\n        return root.attr('data-user-id');\n    };\n\n    /**\n     * Get the section content container element.\n     *\n     * @param  {Object} root The section container element.\n     * @return {Object} The section content container element.\n     */\n    var getContentContainer = function(root) {\n        return root.find(SELECTORS.CONTENT_CONTAINER);\n    };\n\n    /**\n     * Get the root element.\n     *\n     * @param  {Object} containerElement The container element to search in.\n     * @return {Object} The list root element.\n     */\n    var getRoot = function(containerElement) {\n        return containerElement.find(SELECTORS.ROOT);\n    };\n\n    /**\n     * Show the loading icon.\n     *\n     * @param {Object} root The section container element.\n     */\n    var showLoadingIcon = function(root) {\n        root.find(SELECTORS.LOADING_ICON_CONTAINER).removeClass('hidden');\n    };\n\n    /**\n     * Hide the loading icon.\n     *\n     * @param {Object} root The section container element.\n     */\n    var hideLoadingIcon = function(root) {\n        root.find(SELECTORS.LOADING_ICON_CONTAINER).addClass('hidden');\n    };\n\n    /**\n     * Show the empty message.\n     *\n     * @param {Object} root The section container element.\n     */\n    var showEmptyMessage = function(root) {\n        root.find(SELECTORS.EMPTY_MESSAGE).removeClass('hidden');\n    };\n\n    /**\n     * Hide the empty message.\n     *\n     * @param {Object} root The section container element.\n     */\n    var hideEmptyMessage = function(root) {\n        root.find(SELECTORS.EMPTY_MESSAGE).addClass('hidden');\n    };\n\n    /**\n     * Show the placeholder element.\n     *\n     * @param {Object} root The section container element.\n     */\n    var showPlaceholder = function(root) {\n        root.find(SELECTORS.PLACEHOLDER).removeClass('hidden');\n    };\n\n    /**\n     * Hide the placeholder element.\n     *\n     * @param {Object} root The section container element.\n     */\n    var hidePlaceholder = function(root) {\n        root.find(SELECTORS.PLACEHOLDER).addClass('hidden');\n    };\n\n    /**\n     * Show the section content container.\n     *\n     * @param {Object} root The section container element.\n     */\n    var showContent = function(root) {\n        getContentContainer(root).removeClass('hidden');\n    };\n\n    /**\n     * Hide the section content container.\n     *\n     * @param {Object} root The section container element.\n     */\n    var hideContent = function(root) {\n        getContentContainer(root).addClass('hidden');\n    };\n\n    /**\n     * If the section has loaded all content.\n     *\n     * @param {Object} root The section container element.\n     * @return {Bool}\n     */\n    var hasLoadedAll = function(root) {\n        return root.attr('data-loaded-all') == 'true';\n    };\n\n    /**\n     * If the section has loaded all content.\n     *\n     * @param {Object} root The section container element.\n     * @param {Bool} value If all items have been loaded.\n     */\n    var setLoadedAll = function(root, value) {\n        root.attr('data-loaded-all', value);\n    };\n\n    /**\n     * If the section can load more items.\n     *\n     * @param {Object} root The section container element.\n     * @return {Bool}\n     */\n    var canLoadMore = function(root) {\n        return !hasLoadedAll(root) && !isLoading(root);\n    };\n\n    /**\n     * Load all items in this container from callback and render them.\n     *\n     * @param {Object} root The section container element.\n     * @param {Function} loadCallback The callback to load items.\n     * @param {Function} renderCallback The callback to render the results.\n     * @return {Object} jQuery promise\n     */\n    var loadAndRender = function(root, loadCallback, renderCallback) {\n        var userId = getUserId(root);\n        startLoading(root);\n\n        return loadCallback(root, userId)\n            .then(function(items) {\n                if (items.length > 0) {\n                    var contentContainer = getContentContainer(root);\n                    return renderCallback(contentContainer, items, userId)\n                        .then(function() {\n                            return items;\n                        });\n                } else {\n                    return items;\n                }\n            })\n            .then(function(items) {\n                stopLoading(root);\n                root.attr('data-seen', true);\n\n                if (!items.length) {\n                    setLoadedAll(root, true);\n                }\n\n                return items;\n            })\n            .catch(function() {\n                stopLoading(root);\n                root.attr('data-seen', true);\n                return;\n            });\n    };\n\n    /**\n     * First load of this section.\n     *\n     * @param {Object} root The section container element.\n     * @param {Function} loadCallback The callback to load items.\n     * @param {Function} renderCallback The callback to render the results.\n     * @return {Object} promise\n     */\n    var initialLoadAndRender = function(root, loadCallback, renderCallback) {\n        getContentContainer(root).empty();\n        showPlaceholder(root);\n        hideContent(root);\n        return loadAndRender(root, loadCallback, renderCallback)\n            .then(function(items) {\n                hidePlaceholder(root);\n\n                if (!items.length) {\n                    showEmptyMessage(root);\n                } else {\n                    showContent(root);\n                }\n\n                return;\n            })\n            .catch(function() {\n                hidePlaceholder(root);\n                showContent(root);\n                return;\n            });\n    };\n\n    /**\n     * Listen to, and handle events in this section.\n     *\n     * @param {Object} root The section container element.\n     * @param {Function} loadCallback The callback to load items.\n     * @param {Function} renderCallback The callback to render the results.\n     */\n    var registerEventListeners = function(root, loadCallback, renderCallback) {\n        CustomEvents.define(root, [\n            CustomEvents.events.scrollBottom\n        ]);\n\n        root.on(CustomEvents.events.scrollBottom, function() {\n            if (canLoadMore(root)) {\n                showLoadingIcon(root);\n                loadAndRender(root, loadCallback, renderCallback)\n                    .then(function() {\n                        return hideLoadingIcon(root);\n                    })\n                    .catch(function() {\n                        return hideLoadingIcon(root);\n                    });\n            }\n        });\n    };\n\n    /**\n     * Setup the section.\n     *\n     * @param {Object} root The section container element.\n     * @param {Function} loadCallback The callback to load items.\n     * @param {Function} renderCallback The callback to render the results.\n     */\n    var show = function(root, loadCallback, renderCallback) {\n        root = $(root);\n\n        if (!root.attr('data-init')) {\n            registerEventListeners(root, loadCallback, renderCallback);\n            initialLoadAndRender(root, loadCallback, renderCallback);\n            root.attr('data-init', true);\n        }\n    };\n\n    return {\n        show: show,\n        getContentContainer: getContentContainer,\n        getRoot: getRoot,\n        setLoadedAll: setLoadedAll,\n        showEmptyMessage: showEmptyMessage,\n        hideEmptyMessage: hideEmptyMessage,\n        showContent: showContent,\n        hideContent: hideContent\n    };\n});\n"],"file":"message_drawer_lazy_load_list.min.js"}