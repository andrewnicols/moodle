define ("core_message/message_drawer_view_contacts_section_contacts",["jquery","core/notification","core/pubsub","core/templates","core_message/message_repository","core_message/message_drawer_events","core_message/message_drawer_lazy_load_list"],function($,Notification,PubSub,Templates,MessageRepository,Events,LazyLoadList){var SELECTORS={BLOCK_ICON_CONTAINER:"[data-region=\"block-icon-container\"]",CONTACT:"[data-region=\"contact\"]",CONTENT_CONTAINER:"[data-region=\"contacts-content-container\"]"},TEMPLATES={CONTACTS_LIST:"core_message/message_drawer_contacts_list"},findContact=function(body,userId){return body.find("[data-contact-user-id=\""+userId+"\"]")},render=function(contentContainer,contacts){var formattedContacts=contacts.map(function(contact){return $.extend(contact,{id:contact.userid})});return Templates.render(TEMPLATES.CONTACTS_LIST,{contacts:formattedContacts}).then(function(html){contentContainer.append(html);return html}).catch(Notification.exception)},getLoadFunction=function(offset){return function(listRoot,userId){return MessageRepository.getContacts(userId,101,offset).then(function(result){return result}).then(function(contacts){if(contacts.length>100){contacts.pop()}else{LazyLoadList.setLoadedAll(listRoot,!0)}return contacts}).then(function(contacts){offset=offset+100;return contacts}).catch(Notification.exception)}},removeContact=function(body,userId){findContact(body,userId).remove()},showContactBlocked=function(body,userId){var contact=findContact(body,userId);if(contact.length){contact.find(SELECTORS.BLOCK_ICON_CONTAINER).removeClass("hidden")}},showContactUnblocked=function(body,userId){var contact=findContact(body,userId);if(contact.length){contact.find(SELECTORS.BLOCK_ICON_CONTAINER).addClass("hidden")}},registerEventListeners=function(root){PubSub.subscribe(Events.CONTACT_ADDED,function(profile){var listContentContainer=LazyLoadList.getContentContainer(root);render(listContentContainer,[profile]);LazyLoadList.hideEmptyMessage(root);LazyLoadList.showContent(root)});PubSub.subscribe(Events.CONTACT_REMOVED,function(userId){removeContact(root,userId);var contacts=root.find(SELECTORS.CONTACT);if(!contacts.length){LazyLoadList.hideContent(root);LazyLoadList.showEmptyMessage(root)}});PubSub.subscribe(Events.CONTACT_BLOCKED,function(userId){showContactBlocked(root,userId)});PubSub.subscribe(Events.CONTACT_UNBLOCKED,function(userId){showContactUnblocked(root,userId)})};return{show:function show(root){if(!root.attr("data-contacts-init")){registerEventListeners(root);root.attr("data-contacts-init",!0)}LazyLoadList.show(root,getLoadFunction(0),render)}}});
//# sourceMappingURL=message_drawer_view_contacts_section_contacts.min.js.map
