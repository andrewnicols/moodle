{"version":3,"sources":["../src/message_drawer_view_conversation_renderer.js"],"names":["define","$","Notification","Str","Templates","UserDate","Constants","Aria","SELECTORS","TEMPLATES","CONVERSATION_TYPES","getMessagesContainer","body","find","CONTENT_MESSAGES_CONTAINER","showMessagesContainer","removeClass","hideMessagesContainer","addClass","getSelfConversationMessageContainer","SELF_CONVERSATION_MESSAGE_CONTAINER","hideSelfConversationMessageContainer","getContactRequestSentContainer","CONTACT_REQUEST_SENT_MESSAGE_CONTAINER","hideContactRequestSentContainer","getFooterContentContainer","footer","CONTENT_MESSAGES_FOOTER_CONTAINER","showFooterContent","hideFooterContent","getFooterEditModeContainer","CONTENT_MESSAGES_FOOTER_EDIT_MODE_CONTAINER","showFooterEditMode","hideFooterEditMode","getFooterPlaceholderContainer","PLACEHOLDER_CONTAINER","showFooterPlaceholder","hideFooterPlaceholder","getFooterRequireContactContainer","CONTENT_MESSAGES_FOOTER_REQUIRE_CONTACT_CONTAINER","showFooterRequireContact","hideFooterRequireContact","getFooterRequireUnblockContainer","CONTENT_MESSAGES_FOOTER_REQUIRE_UNBLOCK_CONTAINER","showFooterRequireUnblock","hideFooterRequireUnblock","getFooterUnableToMessageContainer","CONTENT_MESSAGES_FOOTER_UNABLE_TO_MESSAGE_CONTAINER","showFooterUnableToMessage","hideFooterUnableToMessage","hideAllHeaderElements","header","hideHeaderContent","hideHeaderEditMode","hideHeaderPlaceholder","hideAllFooterElements","getContentPlaceholderContainer","CONTENT_PLACEHOLDER_CONTAINER","showContentPlaceholder","hideContentPlaceholder","getHeaderContent","HEADER","showHeaderContent","getHeaderEditMode","HEADER_EDIT_MODE","showHeaderEditMode","getHeaderPlaceholderContainer","HEADER_PLACEHOLDER_CONTAINER","showHeaderPlaceholder","getEmojiPickerContainer","EMOJI_PICKER_CONTAINER","getEmojiAutoCompleteContainer","EMOJI_AUTO_COMPLETE_CONTAINER","getMessageElement","messageId","messagesContainer","getDayElement","dayTimeCreated","getMoreMessagesLoadingIconContainer","MORE_MESSAGES_LOADING_ICON_CONTAINER","showMoreMessagesLoadingIcon","hideMoreMessagesLoadingIcon","getConfirmDialogueContainer","root","CONFIRM_DIALOGUE_CONTAINER","showConfirmDialogueContainer","container","siblings","hide","get","attr","hideConfirmDialogueContainer","unhide","removeAttr","setMessagesSelectedCount","value","MESSAGES_SELECTED_COUNT","text","formatMessagesForTemplate","messages","datesCache","map","message","id","isread","isRead","fromloggedinuser","fromLoggedInUser","userfrom","userFrom","formattedtime","timeCreated","renderAddDays","days","daysRenderPromises","data","render","DAY","timestamp","when","apply","then","forEach","index","html","before","element","insertBefore","append","catch","renderAddMessages","messagesData","formattedMessages","MESSAGES","messageList","messageHtml","dayContainer","day","dayMessagesContainer","DAY_MESSAGES_CONTAINER","renderUpdateMessages","after","formattedTime","LOADING_ICON_CONTAINER","TIME_CREATED","sendState","loading","time","retry","RETRY_SEND","TEXT_CONTAINER","errorMessage","messageContainer","ERROR_MESSAGE_CONTAINER","ERROR_MESSAGE","renderRemoveDays","remove","renderRemoveMessages","renderConversation","renderingPromises","hasAddDays","add","length","hasAddMessages","hasUpdateMessages","update","timestampsToFormat","datesCachePromise","Deferred","resolve","promise","concat","reduce","carry","timestamps","push","get_string","format","requests","formattedTimes","renderHeader","headerContainer","template","HEADER_PUBLIC","context","showrouteback","type","PRIVATE","showControls","HEADER_PRIVATE","HEADER_PRIVATE_NO_CONTROLS","SELF","HEADER_SELF","js","replaceNodeContents","renderFooter","get_strings","key","component","param","user","fullname","strings","title","footerContainer","TITLE","TEXT","renderScrollToMessage","messageElement","position","scrollTop","top","renderLoadingMembers","isLoadingMembers","renderLoadingFirstMessages","isLoadingFirstMessages","renderLoadingMessages","isLoading","renderShowEmojiPicker","show","EMOJI_PICKER_SEARCH_INPUT","focus","renderShowEmojiAutoComplete","showConfirmDialogue","buttonSelectors","bodyText","headerText","canCancel","skipHeader","showOk","dialogue","buttons","selector","cancelButton","CONFIRM_DIALOGUE_CANCEL_BUTTON","okayButton","CONFIRM_DIALOGUE_OKAY_BUTTON","CONFIRM_DIALOGUE_TEXT","dialogueHeader","CONFIRM_DIALOGUE_HEADER","confirmDialogue","CONFIRM_DIALOGUE","prepend","button","CAN_RECEIVE_FOCUS","filter","first","hideConfirmDialogue","hideCheckDeleteDialogue","renderConfirmBlockUser","canmessageevenifblocked","string","ACTION_CONFIRM_BLOCK","renderConfirmUnblockUser","ACTION_CONFIRM_UNBLOCK","renderConfirmAddContact","ACTION_CONFIRM_ADD_CONTACT","renderConfirmRemoveContact","ACTION_CONFIRM_REMOVE_CONTACT","renderConfirmDeleteSelectedMessages","showmessage","canDeleteMessagesForAllUsers","showCheckDeleteDialogue","ACTION_CONFIRM_DELETE_SELECTED_MESSAGES","renderConfirmDeleteConversation","ACTION_CONFIRM_DELETE_CONVERSATION","renderConfirmContactRequest","ACTION_ACCEPT_CONTACT_REQUEST","ACTION_DECLINE_CONTACT_REQUEST","checkboxRegion","DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER","checkbox","DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE","prop","renderIsBlocked","isBlocked","ACTION_REQUEST_BLOCK","ACTION_REQUEST_UNBLOCK","renderIsFavourite","state","favouriteIcon","FAVOURITE_ICON_CONTAINER","addFavourite","ACTION_CONFIRM_FAVOURITE","removeFavourite","ACTION_CONFIRM_UNFAVOURITE","renderIsMuted","muteIcon","MUTED_ICON_CONTAINER","setMuted","ACTION_CONFIRM_MUTE","unsetMuted","ACTION_CONFIRM_UNMUTE","renderIsContact","addContact","ACTION_REQUEST_ADD_CONTACT","removeContact","ACTION_REQUEST_REMOVE_CONTACT","renderLoadingConfirmAction","buttonText","CONFIRM_DIALOGUE_BUTTON_TEXT","loadingIcon","renderInEditMode","inEditMode","MESSAGE_NOT_SELECTED","MESSAGE_NOT_SELECTED_ICON","MESSAGE_SELECTED_ICON","renderSelectedMessages","hasSelectedMessages","count","renderRequireAddContact","hasMessages","renderSelfConversationMessage","displayMessage","renderContactRequestSent","userFullName","renderReset","patch","configs","reset","conversation","confirmBlockUser","confirmUnblockUser","confirmAddContact","confirmRemoveContact","confirmDeleteSelectedMessages","confirmDeleteConversation","confirmContactRequest","requireAddContact","selfConversationMessage","contactRequestSent","loadingMembers","loadingFirstMessages","loadingMessages","isContact","isFavourite","isMuted","loadingConfirmAction","showEmojiPicker","showEmojiAutoComplete","scrollToMessage","selectedMessages","processConfig","config","results","hasOwnProperty","renderFunc","patchValue","i","exception"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module updates the UI for the conversation page in the message\n * drawer.\n *\n * The module will take a patch from the message_drawer_view_conversation_patcher\n * module and update the UI to reflect the changes.\n *\n * This is the only module that ever modifies the UI of the conversation page.\n *\n * @module     core_message/message_drawer_view_conversation_renderer\n * @copyright  2018 Ryan Wyllie <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(\n[\n    'jquery',\n    'core/notification',\n    'core/str',\n    'core/templates',\n    'core/user_date',\n    'core_message/message_drawer_view_conversation_constants',\n    'core/aria',\n],\nfunction(\n    $,\n    Notification,\n    Str,\n    Templates,\n    UserDate,\n    Constants,\n    Aria\n) {\n    var SELECTORS = Constants.SELECTORS;\n    var TEMPLATES = Constants.TEMPLATES;\n    var CONVERSATION_TYPES = Constants.CONVERSATION_TYPES;\n\n    /**\n     * Get the messages container element.\n     *\n     * @param  {Object} body Conversation body container element.\n     * @return {Object} The messages container element.\n     */\n    var getMessagesContainer = function(body) {\n        return body.find(SELECTORS.CONTENT_MESSAGES_CONTAINER);\n    };\n\n    /**\n     * Show the messages container element.\n     *\n     * @param  {Object} body Conversation body container element.\n     */\n    var showMessagesContainer = function(body) {\n        getMessagesContainer(body).removeClass('hidden');\n    };\n\n    /**\n     * Hide the messages container element.\n     *\n     * @param  {Object} body Conversation body container element.\n     */\n    var hideMessagesContainer = function(body) {\n        getMessagesContainer(body).addClass('hidden');\n    };\n\n    /**\n     * Get the self-conversation message container element.\n     *\n     * @param  {Object} body Conversation body container element.\n     * @return {Object} The messages container element.\n     */\n    var getSelfConversationMessageContainer = function(body) {\n        return body.find(SELECTORS.SELF_CONVERSATION_MESSAGE_CONTAINER);\n    };\n\n    /**\n     * Hide the self-conversation message container element.\n     *\n     * @param  {Object} body Conversation body container element.\n     * @return {Object} The messages container element.\n     */\n    var hideSelfConversationMessageContainer = function(body) {\n        return getSelfConversationMessageContainer(body).addClass('hidden');\n    };\n\n    /**\n     * Get the contact request sent container element.\n     *\n     * @param  {Object} body Conversation body container element.\n     * @return {Object} The messages container element.\n     */\n    var getContactRequestSentContainer = function(body) {\n        return body.find(SELECTORS.CONTACT_REQUEST_SENT_MESSAGE_CONTAINER);\n    };\n\n    /**\n     * Hide the contact request sent container element.\n     *\n     * @param  {Object} body Conversation body container element.\n     * @return {Object} The messages container element.\n     */\n    var hideContactRequestSentContainer = function(body) {\n        return getContactRequestSentContainer(body).addClass('hidden');\n    };\n\n    /**\n     * Get the footer container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     * @return {Object} The footer container element.\n     */\n    var getFooterContentContainer = function(footer) {\n        return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_CONTAINER);\n    };\n\n    /**\n     * Show the footer container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var showFooterContent = function(footer) {\n        getFooterContentContainer(footer).removeClass('hidden');\n    };\n\n    /**\n     * Hide the footer container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var hideFooterContent = function(footer) {\n        getFooterContentContainer(footer).addClass('hidden');\n    };\n\n    /**\n     * Get the footer edit mode container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     * @return {Object} The footer container element.\n     */\n    var getFooterEditModeContainer = function(footer) {\n        return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_EDIT_MODE_CONTAINER);\n    };\n\n    /**\n     * Show the footer edit mode container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var showFooterEditMode = function(footer) {\n        getFooterEditModeContainer(footer).removeClass('hidden');\n    };\n\n    /**\n     * Hide the footer edit mode container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var hideFooterEditMode = function(footer) {\n        getFooterEditModeContainer(footer).addClass('hidden');\n    };\n\n    /**\n     * Get the footer placeholder.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     * @return {Object} The footer placeholder container element.\n     */\n    var getFooterPlaceholderContainer = function(footer) {\n        return footer.find(SELECTORS.PLACEHOLDER_CONTAINER);\n    };\n\n    /**\n     * Show the footer placeholder\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var showFooterPlaceholder = function(footer) {\n        getFooterPlaceholderContainer(footer).removeClass('hidden');\n    };\n\n    /**\n     * Hide the footer placeholder\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var hideFooterPlaceholder = function(footer) {\n        getFooterPlaceholderContainer(footer).addClass('hidden');\n    };\n\n    /**\n     * Get the footer Require add as contact container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     * @return {Object} The footer Require add as contact container element.\n     */\n    var getFooterRequireContactContainer = function(footer) {\n        return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_REQUIRE_CONTACT_CONTAINER);\n    };\n\n    /**\n     * Show the footer add as contact dialogue.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var showFooterRequireContact = function(footer) {\n        getFooterRequireContactContainer(footer).removeClass('hidden');\n    };\n\n    /**\n     * Hide the footer add as contact dialogue.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var hideFooterRequireContact = function(footer) {\n        getFooterRequireContactContainer(footer).addClass('hidden');\n    };\n\n    /**\n     * Get the footer Required to unblock contact container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     * @return {Object} The footer Required to unblock contact container element.\n     */\n    var getFooterRequireUnblockContainer = function(footer) {\n        return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_REQUIRE_UNBLOCK_CONTAINER);\n    };\n\n    /**\n     * Show the footer Required to unblock contact container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var showFooterRequireUnblock = function(footer) {\n        getFooterRequireUnblockContainer(footer).removeClass('hidden');\n    };\n\n    /**\n     * Hide the footer Required to unblock contact container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var hideFooterRequireUnblock = function(footer) {\n        getFooterRequireUnblockContainer(footer).addClass('hidden');\n    };\n\n    /**\n     * Get the footer Unable to message contact container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     * @return {Object} The footer Unable to message contact container element.\n     */\n    var getFooterUnableToMessageContainer = function(footer) {\n        return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_UNABLE_TO_MESSAGE_CONTAINER);\n    };\n\n    /**\n     * Show the footer Unable to message contact container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var showFooterUnableToMessage = function(footer) {\n        getFooterUnableToMessageContainer(footer).removeClass('hidden');\n    };\n\n    /**\n     * Hide the footer Unable to message contact container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var hideFooterUnableToMessage = function(footer) {\n        getFooterUnableToMessageContainer(footer).addClass('hidden');\n    };\n\n    /**\n     * Hide all header elements.\n     *\n     * @param  {Object} header Conversation header container element.\n     */\n    var hideAllHeaderElements = function(header) {\n        hideHeaderContent(header);\n        hideHeaderEditMode(header);\n        hideHeaderPlaceholder(header);\n    };\n\n    /**\n     * Hide all footer dialogues and messages.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     */\n    var hideAllFooterElements = function(footer) {\n        hideFooterContent(footer);\n        hideFooterEditMode(footer);\n        hideFooterPlaceholder(footer);\n        hideFooterRequireContact(footer);\n        hideFooterRequireUnblock(footer);\n        hideFooterUnableToMessage(footer);\n    };\n\n    /**\n     * Get the content placeholder container element.\n     *\n     * @param  {Object} body Conversation body container element.\n     * @return {Object} The body placeholder container element.\n     */\n    var getContentPlaceholderContainer = function(body) {\n        return body.find(SELECTORS.CONTENT_PLACEHOLDER_CONTAINER);\n    };\n\n    /**\n     * Show the content placeholder.\n     *\n     * @param  {Object} body Conversation body container element.\n     */\n    var showContentPlaceholder = function(body) {\n        getContentPlaceholderContainer(body).removeClass('hidden');\n    };\n\n    /**\n     * Hide the content placeholder.\n     *\n     * @param  {Object} body Conversation body container element.\n     */\n    var hideContentPlaceholder = function(body) {\n        getContentPlaceholderContainer(body).addClass('hidden');\n    };\n\n    /**\n     * Get the header content container element.\n     *\n     * @param  {Object} header Conversation header container element.\n     * @return {Object} The header content container element.\n     */\n    var getHeaderContent = function(header) {\n        return header.find(SELECTORS.HEADER);\n    };\n\n    /**\n     * Show the header content.\n     *\n     * @param  {Object} header Conversation header container element.\n     */\n    var showHeaderContent = function(header) {\n        getHeaderContent(header).removeClass('hidden');\n    };\n\n    /**\n     * Hide the header content.\n     *\n     * @param  {Object} header Conversation header container element.\n     */\n    var hideHeaderContent = function(header) {\n        getHeaderContent(header).addClass('hidden');\n    };\n\n    /**\n     * Get the header edit mode container element.\n     *\n     * @param  {Object} header Conversation header container element.\n     * @return {Object} The header content container element.\n     */\n    var getHeaderEditMode = function(header) {\n        return header.find(SELECTORS.HEADER_EDIT_MODE);\n    };\n\n    /**\n     * Show the header edit mode container.\n     *\n     * @param  {Object} header Conversation header container element.\n     */\n    var showHeaderEditMode = function(header) {\n        getHeaderEditMode(header).removeClass('hidden');\n    };\n\n    /**\n     * Hide the header edit mode container.\n     *\n     * @param  {Object} header Conversation header container element.\n     */\n    var hideHeaderEditMode = function(header) {\n        getHeaderEditMode(header).addClass('hidden');\n    };\n\n    /**\n     * Get the header placeholder container element.\n     *\n     * @param  {Object} header Conversation header container element.\n     * @return {Object} The header placeholder container element.\n     */\n    var getHeaderPlaceholderContainer = function(header) {\n        return header.find(SELECTORS.HEADER_PLACEHOLDER_CONTAINER);\n    };\n\n    /**\n     * Show the header placeholder.\n     *\n     * @param  {Object} header Conversation header container element.\n     */\n    var showHeaderPlaceholder = function(header) {\n        getHeaderPlaceholderContainer(header).removeClass('hidden');\n    };\n\n    /**\n     * Hide the header placeholder.\n     *\n     * @param  {Object} header Conversation header container element.\n     */\n    var hideHeaderPlaceholder = function(header) {\n        getHeaderPlaceholderContainer(header).addClass('hidden');\n    };\n\n    /**\n     * Get the emoji picker container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     * @return {Object} The emoji picker container element.\n     */\n    var getEmojiPickerContainer = function(footer) {\n        return footer.find(SELECTORS.EMOJI_PICKER_CONTAINER);\n    };\n\n    /**\n     * Get the emoji picker container element.\n     *\n     * @param  {Object} footer Conversation footer container element.\n     * @return {Object} The emoji picker container element.\n     */\n    var getEmojiAutoCompleteContainer = function(footer) {\n        return footer.find(SELECTORS.EMOJI_AUTO_COMPLETE_CONTAINER);\n    };\n\n    /**\n     * Get a message element.\n     *\n     * @param  {Object} body Conversation body container element.\n     * @param  {Number} messageId the Message id.\n     * @return {Object} A message element from the conversation.\n     */\n    var getMessageElement = function(body, messageId) {\n        var messagesContainer = getMessagesContainer(body);\n        return messagesContainer.find('[data-message-id=\"' + messageId + '\"]');\n    };\n\n    /**\n     * Get the day container element. The day container element holds a list of messages for that day.\n     *\n     * @param  {Object} body Conversation body container element.\n     * @param  {Number} dayTimeCreated Midnight timestamp for the day.\n     * @return {Object} jQuery object\n     */\n    var getDayElement = function(body, dayTimeCreated) {\n        var messagesContainer = getMessagesContainer(body);\n        return messagesContainer.find('[data-day-id=\"' + dayTimeCreated + '\"]');\n    };\n\n    /**\n     * Get the more messages loading icon container element.\n     *\n     * @param  {Object} body Conversation body container element.\n     * @return {Object} The more messages loading container element.\n     */\n    var getMoreMessagesLoadingIconContainer = function(body) {\n        return body.find(SELECTORS.MORE_MESSAGES_LOADING_ICON_CONTAINER);\n    };\n\n    /**\n     * Show the more messages loading icon.\n     *\n     * @param  {Object} body Conversation body container element.\n     */\n    var showMoreMessagesLoadingIcon = function(body) {\n        getMoreMessagesLoadingIconContainer(body).removeClass('hidden');\n    };\n\n    /**\n     * Hide the more messages loading icon.\n     *\n     * @param  {Object} body Conversation body container element.\n     */\n    var hideMoreMessagesLoadingIcon = function(body) {\n        getMoreMessagesLoadingIconContainer(body).addClass('hidden');\n    };\n\n    /**\n     * Get the confirm dialogue container element.\n     *\n     * @param  {Object} root The container element to search.\n     * @return {Object} The confirm dialogue container element.\n     */\n    var getConfirmDialogueContainer = function(root) {\n        return root.find(SELECTORS.CONFIRM_DIALOGUE_CONTAINER);\n    };\n\n    /**\n     * Show the confirm dialogue container element.\n     *\n     * @param  {Object} root The container element containing a dialogue.\n     */\n    var showConfirmDialogueContainer = function(root) {\n        var container = getConfirmDialogueContainer(root);\n        var siblings = container.siblings(':not(.hidden)');\n        Aria.hide(siblings.get());\n        siblings.attr('data-confirm-dialogue-hidden', true);\n\n        container.removeClass('hidden');\n    };\n\n    /**\n     * Hide the confirm dialogue container element.\n     *\n     * @param  {Object} root The container element containing a dialogue.\n     */\n    var hideConfirmDialogueContainer = function(root) {\n        var container = getConfirmDialogueContainer(root);\n        var siblings = container.siblings('[data-confirm-dialogue-hidden=\"true\"]');\n        Aria.unhide(siblings.get());\n        siblings.removeAttr('data-confirm-dialogue-hidden');\n\n        container.addClass('hidden');\n    };\n\n    /**\n     * Set the number of selected messages.\n     *\n     * @param {Object} header The header container element.\n     * @param {Number} value The new number to display.\n     */\n    var setMessagesSelectedCount = function(header, value) {\n        getHeaderEditMode(header).find(SELECTORS.MESSAGES_SELECTED_COUNT).text(value);\n    };\n\n    /**\n     * Format message for the mustache template, transform camelCase properties to lowercase properties.\n     *\n     * @param  {Array} messages Array of message objects.\n     * @param  {Object} datesCache Cache timestamps and their formatted date string.\n     * @return {Array} Messages formated for mustache template.\n     */\n    var formatMessagesForTemplate = function(messages, datesCache) {\n        return messages.map(function(message) {\n            return {\n                id: message.id,\n                isread: message.isRead,\n                fromloggedinuser: message.fromLoggedInUser,\n                userfrom: message.userFrom,\n                text: message.text,\n                formattedtime: message.timeCreated ? datesCache[message.timeCreated] : null\n            };\n        });\n    };\n\n    /**\n     * Create rendering promises for each day containing messages.\n     *\n     * @param  {Object} header The header container element.\n     * @param  {Object} body The body container element.\n     * @param  {Object} footer The footer container element.\n     * @param  {Array} days Array of days containing messages.\n     * @param  {Object} datesCache Cache timestamps and their formatted date string.\n     * @return {Promise} Days rendering promises.\n     */\n    var renderAddDays = function(header, body, footer, days, datesCache) {\n        var messagesContainer = getMessagesContainer(body);\n        var daysRenderPromises = days.map(function(data) {\n            return Templates.render(TEMPLATES.DAY, {\n                timestamp: data.value.timestamp,\n                messages: formatMessagesForTemplate(data.value.messages, datesCache)\n            });\n        });\n\n        return $.when.apply($, daysRenderPromises).then(function() {\n            // Wait until all of the rendering is done for each of the days\n            // to ensure they are added to the page in the correct order.\n            days.forEach(function(data, index) {\n                daysRenderPromises[index]\n                    .then(function(html) {\n                        if (data.before) {\n                            var element = getDayElement(body, data.before.timestamp);\n                            return $(html).insertBefore(element);\n                        } else {\n                            return messagesContainer.append(html);\n                        }\n                    })\n                    .catch(function() {\n                        // Fail silently.\n                    });\n            });\n\n            return;\n        });\n    };\n\n    /**\n     * Add (more) messages to day containers.\n     *\n     * @param  {Object} header The header container element.\n     * @param  {Object} body The body container element.\n     * @param  {Object} footer The footer container element.\n     * @param  {Array} messages List of messages.\n     * @param  {Object} datesCache Cache timestamps and their formatted date string.\n     * @return {Promise} Messages rendering promises.\n     */\n    var renderAddMessages = function(header, body, footer, messages, datesCache) {\n        var messagesData = messages.map(function(data) {\n            return data.value;\n        });\n        var formattedMessages = formatMessagesForTemplate(messagesData, datesCache);\n\n        return Templates.render(TEMPLATES.MESSAGES, {messages: formattedMessages})\n            .then(function(html) {\n                var messageList = $(html);\n                messages.forEach(function(data) {\n                    var messageHtml = messageList.find('[data-message-id=\"' + data.value.id + '\"]');\n                    if (data.before) {\n                        var element = getMessageElement(body, data.before.id);\n                        return messageHtml.insertBefore(element);\n                    } else {\n                        var dayContainer = getDayElement(body, data.day.timestamp);\n                        var dayMessagesContainer = dayContainer.find(SELECTORS.DAY_MESSAGES_CONTAINER);\n                        return dayMessagesContainer.append(messageHtml);\n                    }\n                });\n\n                return;\n            });\n    };\n\n    /**\n     * Update existing messages.\n     *\n     * @param  {Object} header The header container element.\n     * @param  {Object} body The body container element.\n     * @param  {Object} footer The footer container element.\n     * @param  {Array} messages List of messages.\n     * @param  {Object} datesCache Cache timestamps and their formatted date string.\n     */\n    var renderUpdateMessages = function(header, body, footer, messages, datesCache) {\n        messages.forEach(function(message) {\n            var before = message.before;\n            var after = message.after;\n            var element = getMessageElement(body, before.id);\n\n            if (before.id != after.id) {\n                element.attr('data-message-id', after.id);\n            }\n\n            if (before.timeCreated != after.timeCreated) {\n                var formattedTime = datesCache[after.timeCreated];\n                element.find(SELECTORS.LOADING_ICON_CONTAINER).addClass('hidden');\n                element.find(SELECTORS.TIME_CREATED).text(formattedTime).removeClass('hidden');\n            }\n\n            if (before.sendState != after.sendState) {\n                var loading = element.find(SELECTORS.LOADING_ICON_CONTAINER);\n                var time = element.find(SELECTORS.TIME_CREATED);\n                var retry = element.find(SELECTORS.RETRY_SEND);\n\n                loading.addClass('hidden');\n                Aria.hide(loading.get());\n\n                time.addClass('hidden');\n                Aria.hide(time.get());\n\n                retry.addClass('hidden');\n                Aria.hide(retry.get());\n\n                element.removeClass('border border-danger');\n\n                switch (after.sendState) {\n                    case 'pending':\n                        loading.removeClass('hidden');\n                        Aria.unhide(loading.get());\n                        break;\n                    case 'error':\n                        retry.removeClass('hidden');\n                        Aria.unhide(retry.get());\n                        element.addClass('border border-danger');\n                        break;\n                    case 'sent':\n                        time.removeClass('hidden');\n                        Aria.unhide(time.get());\n                        break;\n                }\n            }\n\n            if (before.text != after.text) {\n                element.find(SELECTORS.TEXT_CONTAINER).html(after.text);\n            }\n\n            if (before.errorMessage != after.errorMessage) {\n                var messageContainer = element.find(SELECTORS.ERROR_MESSAGE_CONTAINER);\n                var message = messageContainer.find(SELECTORS.ERROR_MESSAGE);\n\n                if (after.errorMessage) {\n                    messageContainer.removeClass('hidden');\n                    Aria.unhide(messageContainer.get());\n                    message.text(after.errorMessage);\n                } else {\n                    messageContainer.addClass('hidden');\n                    Aria.unhide(messageContainer.get());\n                    message.text('');\n                }\n            }\n        });\n    };\n\n    /**\n     * Remove days from conversation.\n     *\n     * @param  {Object} body The body container element.\n     * @param  {Array} days Array of days to be removed.\n     */\n    var renderRemoveDays = function(body, days) {\n        days.forEach(function(data) {\n            getDayElement(body, data.timestamp).remove();\n        });\n    };\n\n    /**\n     * Remove messages from conversation.\n     *\n     * @param  {Object} body The body container element.\n     * @param  {Array} messages Array of messages to be removed.\n     */\n    var renderRemoveMessages = function(body, messages) {\n        messages.forEach(function(data) {\n            getMessageElement(body, data.id).remove();\n        });\n    };\n\n    /**\n     * Render the full conversation base on input from the statemanager.\n     *\n     * This will pre-load all of the formatted timestamps for each message that\n     * needs to render to reduce the number of networks requests.\n     *\n     * @param  {Object} header The header container element.\n     * @param  {Object} body The body container element.\n     * @param  {Object} footer The footer container element.\n     * @param  {Object} data The conversation diff.\n     * @return {Object} jQuery promise.\n     */\n    var renderConversation = function(header, body, footer, data) {\n        var renderingPromises = [];\n        var hasAddDays = data.days.add.length > 0;\n        var hasAddMessages = data.messages.add.length > 0;\n        var hasUpdateMessages = data.messages.update.length > 0;\n        var timestampsToFormat = [];\n        var datesCachePromise = $.Deferred().resolve({}).promise();\n\n        if (hasAddDays) {\n            // Search for all of the timeCreated values in all of the messages in all of\n            // the days that we need to render.\n            timestampsToFormat = timestampsToFormat.concat(data.days.add.reduce(function(carry, day) {\n                return carry.concat(day.value.messages.reduce(function(timestamps, message) {\n                    if (message.timeCreated) {\n                        timestamps.push(message.timeCreated);\n                    }\n                    return timestamps;\n                }, []));\n            }, []));\n        }\n\n        if (hasAddMessages) {\n            // Search for all of the timeCreated values in all of the messages that we\n            // need to render.\n            timestampsToFormat = timestampsToFormat.concat(data.messages.add.reduce(function(timestamps, message) {\n                if (message.value.timeCreated) {\n                    timestamps.push(message.value.timeCreated);\n                }\n                return timestamps;\n            }, []));\n        }\n\n        if (hasUpdateMessages) {\n            timestampsToFormat = timestampsToFormat.concat(data.messages.update.reduce(function(timestamps, message) {\n                if (message.before.timeCreated != message.after.timeCreated) {\n                    timestamps.push(message.after.timeCreated);\n                }\n                return timestamps;\n            }, []));\n        }\n\n        if (timestampsToFormat.length) {\n            // If we have timestamps then pre-load the formatted version of each of them\n            // in a single request to the server. This saves the templates doing multiple\n            // individual requests.\n            datesCachePromise = Str.get_string('strftimetime24', 'core_langconfig')\n                .then(function(format) {\n                    var requests = timestampsToFormat.map(function(timestamp) {\n                        return {\n                            timestamp: timestamp,\n                            format: format\n                        };\n                    });\n\n                    return UserDate.get(requests);\n                })\n                .then(function(formattedTimes) {\n                    return timestampsToFormat.reduce(function(carry, timestamp, index) {\n                        carry[timestamp] = formattedTimes[index];\n                        return carry;\n                    }, {});\n                });\n        }\n\n        if (hasAddDays) {\n            renderingPromises.push(datesCachePromise.then(function(datesCache) {\n                return renderAddDays(header, body, footer, data.days.add, datesCache);\n            }));\n        }\n\n        if (hasAddMessages) {\n            renderingPromises.push(datesCachePromise.then(function(datesCache) {\n                return renderAddMessages(header, body, footer, data.messages.add, datesCache);\n            }));\n        }\n\n        if (hasUpdateMessages) {\n            renderingPromises.push(datesCachePromise.then(function(datesCache) {\n                return renderUpdateMessages(header, body, footer, data.messages.update, datesCache);\n            }));\n        }\n\n        if (data.days.remove.length > 0) {\n            renderRemoveDays(body, data.days.remove);\n        }\n\n        if (data.messages.remove.length > 0) {\n            renderRemoveMessages(body, data.messages.remove);\n        }\n\n        return $.when.apply($, renderingPromises);\n    };\n\n    /**\n     * Render the conversation header.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} data Data for header.\n     * @return {Object} jQuery promise\n     */\n    var renderHeader = function(header, body, footer, data) {\n        var headerContainer = getHeaderContent(header);\n        var template = TEMPLATES.HEADER_PUBLIC;\n        data.context.showrouteback = (header.attr('data-from-panel') === \"false\");\n        if (data.type == CONVERSATION_TYPES.PRIVATE) {\n            template = data.showControls ? TEMPLATES.HEADER_PRIVATE : TEMPLATES.HEADER_PRIVATE_NO_CONTROLS;\n        } else if (data.type == CONVERSATION_TYPES.SELF) {\n            template = TEMPLATES.HEADER_SELF;\n        }\n\n        return Templates.render(template, data.context)\n            .then(function(html, js) {\n                Templates.replaceNodeContents(headerContainer, html, js);\n                return;\n            });\n    };\n\n    /**\n     * Render the conversation footer.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} data Data for footer.\n     * @return {Object} jQuery promise.\n     */\n    var renderFooter = function(header, body, footer, data) {\n        hideAllFooterElements(footer);\n\n        switch (data.type) {\n            case 'placeholder':\n                return showFooterPlaceholder(footer);\n            case 'add-contact':\n                return Str.get_strings([\n                        {\n                            key: 'requirecontacttomessage',\n                            component: 'core_message',\n                            param: data.user.fullname\n                        },\n                        {\n                            key: 'isnotinyourcontacts',\n                            component: 'core_message',\n                            param: data.user.fullname\n                        }\n                    ])\n                    .then(function(strings) {\n                        var title = strings[1];\n                        var text = strings[0];\n                        var footerContainer = getFooterRequireContactContainer(footer);\n                        footerContainer.find(SELECTORS.TITLE).text(title);\n                        footerContainer.find(SELECTORS.TEXT).text(text);\n                        showFooterRequireContact(footer);\n                        return strings;\n                    });\n            case 'edit-mode':\n                return showFooterEditMode(footer);\n            case 'content':\n                return showFooterContent(footer);\n            case 'unblock':\n                return showFooterRequireUnblock(footer);\n            case 'unable-to-message':\n                return showFooterUnableToMessage(footer);\n        }\n\n        return true;\n    };\n\n    /**\n     * Scroll to a message in the conversation.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Number} messageId Message id.\n     */\n    var renderScrollToMessage = function(header, body, footer, messageId) {\n        var messagesContainer = getMessagesContainer(body);\n        var messageElement = getMessageElement(body, messageId);\n        var position = messageElement.position();\n        // Scroll the message container down to the top of the message element.\n        if (position) {\n            var scrollTop = messagesContainer.scrollTop() + position.top;\n            messagesContainer.scrollTop(scrollTop);\n        }\n    };\n\n    /**\n     * Hide or show the conversation header.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} isLoadingMembers Members loading.\n     */\n    var renderLoadingMembers = function(header, body, footer, isLoadingMembers) {\n        if (isLoadingMembers) {\n            hideHeaderContent(header);\n            showHeaderPlaceholder(header);\n        } else {\n            showHeaderContent(header);\n            hideHeaderPlaceholder(header);\n        }\n    };\n\n    /**\n     * Hide or show loading conversation messages.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} isLoadingFirstMessages Messages loading.\n     */\n    var renderLoadingFirstMessages = function(header, body, footer, isLoadingFirstMessages) {\n        if (isLoadingFirstMessages) {\n            hideMessagesContainer(body);\n            showContentPlaceholder(body);\n        } else {\n            showMessagesContainer(body);\n            hideContentPlaceholder(body);\n        }\n    };\n\n    /**\n     * Hide or show loading more messages.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} isLoading Messages loading.\n     */\n    var renderLoadingMessages = function(header, body, footer, isLoading) {\n        if (isLoading) {\n            showMoreMessagesLoadingIcon(body);\n        } else {\n            hideMoreMessagesLoadingIcon(body);\n        }\n    };\n\n    /**\n     * Hide or show the emoji picker.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} show Should the emoji picker be visible.\n     */\n    var renderShowEmojiPicker = function(header, body, footer, show) {\n        var container = getEmojiPickerContainer(footer);\n\n        if (show) {\n            container.removeClass('hidden');\n            Aria.unhide(container.get());\n            container.find(SELECTORS.EMOJI_PICKER_SEARCH_INPUT).focus();\n        } else {\n            container.addClass('hidden');\n            Aria.hide(container.get());\n        }\n    };\n\n    /**\n     * Hide or show the emoji auto complete.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} show Should the emoji picker be visible.\n     */\n    var renderShowEmojiAutoComplete = function(header, body, footer, show) {\n        var container = getEmojiAutoCompleteContainer(footer);\n\n        if (show) {\n            container.removeClass('hidden');\n            Aria.unhide(container.get());\n        } else {\n            container.addClass('hidden');\n            Aria.hide(container.get());\n        }\n    };\n\n    /**\n     * Show a confirmation dialogue\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {String} buttonSelectors Selectors for the buttons to show.\n     * @param {String} bodyText Text to show in dialogue.\n     * @param {String} headerText Text to show in dialogue header.\n     * @param {Bool} canCancel Can this dialogue be cancelled.\n     * @param {Bool} skipHeader Skip blanking out the header\n     * @param {Bool} showOk Show an 'Okay' button for a dialogue which will close it\n     */\n    var showConfirmDialogue = function(\n        header,\n        body,\n        footer,\n        buttonSelectors,\n        bodyText,\n        headerText,\n        canCancel,\n        skipHeader,\n        showOk\n    ) {\n        var dialogue = getConfirmDialogueContainer(body);\n        var buttons = buttonSelectors.map(function(selector) {\n            return dialogue.find(selector);\n        });\n        var cancelButton = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_CANCEL_BUTTON);\n        var okayButton = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_OKAY_BUTTON);\n        var text = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_TEXT);\n        var dialogueHeader = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_HEADER);\n\n        dialogue.find('button').addClass('hidden');\n\n        if (canCancel) {\n            cancelButton.removeClass('hidden');\n        } else {\n            cancelButton.addClass('hidden');\n        }\n\n        if (showOk) {\n            okayButton.removeClass('hidden');\n        } else {\n            okayButton.addClass('hidden');\n        }\n\n        if (headerText) {\n            // Create the dialogue header.\n            dialogueHeader = $('<h3 class=\"h6\" data-region=\"dialogue-header\"></h3>');\n            dialogueHeader.text(headerText);\n            // Prepend it to the confirmation body.\n            var confirmDialogue = dialogue.find(SELECTORS.CONFIRM_DIALOGUE);\n            confirmDialogue.prepend(dialogueHeader);\n        } else if (dialogueHeader.length) {\n            // Header text is empty but dialogue header is present, so remove it.\n            dialogueHeader.remove();\n        }\n\n        buttons.forEach(function(button) {\n            button.removeClass('hidden');\n        });\n        text.text(bodyText);\n        showConfirmDialogueContainer(footer);\n        showConfirmDialogueContainer(body);\n\n        if (!skipHeader) {\n            showConfirmDialogueContainer(header);\n        }\n\n        dialogue.find(SELECTORS.CAN_RECEIVE_FOCUS).filter(':visible').first().focus();\n    };\n\n    /**\n     * Hide the dialogue\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @return {Bool} always true.\n     */\n    var hideConfirmDialogue = function(header, body, footer) {\n        var dialogue = getConfirmDialogueContainer(body);\n        var cancelButton = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_CANCEL_BUTTON);\n        var okayButton = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_OKAY_BUTTON);\n        var text = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_TEXT);\n        var dialogueHeader = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_HEADER);\n\n        hideCheckDeleteDialogue(body);\n        hideConfirmDialogueContainer(body);\n        hideConfirmDialogueContainer(footer);\n        hideConfirmDialogueContainer(header);\n        dialogue.find('button').addClass('hidden');\n        cancelButton.removeClass('hidden');\n        okayButton.removeClass('hidden');\n        text.text('');\n\n        // Remove dialogue header if present.\n        if (dialogueHeader.length) {\n            dialogueHeader.remove();\n        }\n\n        header.find(SELECTORS.CAN_RECEIVE_FOCUS).first().focus();\n        return true;\n    };\n\n    /**\n     * Render the confirm block user dialogue.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} user User to block.\n     * @return {Object} jQuery promise\n     */\n    var renderConfirmBlockUser = function(header, body, footer, user) {\n        if (user) {\n            if (user.canmessageevenifblocked) {\n                return Str.get_string('cantblockuser', 'core_message', user.fullname)\n                    .then(function(string) {\n                        return showConfirmDialogue(header, body, footer, [], string, '', false, false, true);\n                    });\n            } else {\n                return Str.get_string('blockuserconfirm', 'core_message', user.fullname)\n                    .then(function(string) {\n                        return showConfirmDialogue(header, body, footer, [SELECTORS.ACTION_CONFIRM_BLOCK], string, '', true, false);\n                    });\n            }\n        } else {\n            return hideConfirmDialogue(header, body, footer);\n        }\n    };\n\n    /**\n     * Render the confirm unblock user dialogue.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} user User to unblock.\n     * @return {Object} jQuery promise\n     */\n    var renderConfirmUnblockUser = function(header, body, footer, user) {\n        if (user) {\n            return Str.get_string('unblockuserconfirm', 'core_message', user.fullname)\n                .then(function(string) {\n                    return showConfirmDialogue(header, body, footer, [SELECTORS.ACTION_CONFIRM_UNBLOCK], string, '', true, false);\n                });\n        } else {\n            return hideConfirmDialogue(header, body, footer);\n        }\n    };\n\n    /**\n     * Render the add user as contact dialogue.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} user User to add as contact.\n     * @return {Object} jQuery promise\n     */\n    var renderConfirmAddContact = function(header, body, footer, user) {\n        if (user) {\n            return Str.get_string('addcontactconfirm', 'core_message', user.fullname)\n                .then(function(string) {\n                    return showConfirmDialogue(\n                        header,\n                        body,\n                        footer,\n                        [SELECTORS.ACTION_CONFIRM_ADD_CONTACT],\n                        string,\n                        '',\n                        true,\n                        false\n                    );\n                });\n        } else {\n            return hideConfirmDialogue(header, body, footer);\n        }\n    };\n\n    /**\n     * Render the remove user from contacts dialogue.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} user User to remove from contacts.\n     * @return {Object} jQuery promise\n     */\n    var renderConfirmRemoveContact = function(header, body, footer, user) {\n        if (user) {\n            return Str.get_string('removecontactconfirm', 'core_message', user.fullname)\n                .then(function(string) {\n                    return showConfirmDialogue(\n                        header,\n                        body,\n                        footer,\n                        [SELECTORS.ACTION_CONFIRM_REMOVE_CONTACT],\n                        string,\n                        '',\n                        true,\n                        false\n                    );\n                });\n        } else {\n            return hideConfirmDialogue(header, body, footer);\n        }\n    };\n\n    /**\n     * Render the delete selected messages dialogue.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} data If the dialogue should show and checkbox shows to delete message for all users.\n     * @return {Object} jQuery promise\n     */\n    var renderConfirmDeleteSelectedMessages = function(header, body, footer, data) {\n        var showmessage = null;\n        if (data.type == CONVERSATION_TYPES.SELF) {\n            // Message displayed to self-conversations is slighly different.\n            showmessage = 'deleteselectedmessagesconfirmselfconversation';\n        } else {\n            // This other message should be displayed.\n            if (data.canDeleteMessagesForAllUsers) {\n                showCheckDeleteDialogue(body);\n                showmessage = 'deleteforeveryoneselectedmessagesconfirm';\n            } else {\n                showmessage = 'deleteselectedmessagesconfirm';\n            }\n        }\n\n        if (data.show) {\n            return Str.get_string(showmessage, 'core_message')\n                .then(function(string) {\n                    return showConfirmDialogue(\n                        header,\n                        body,\n                        footer,\n                        [SELECTORS.ACTION_CONFIRM_DELETE_SELECTED_MESSAGES],\n                        string,\n                        '',\n                        true,\n                        false\n                    );\n                });\n        } else {\n            return hideConfirmDialogue(header, body, footer);\n        }\n    };\n\n    /**\n     * Render the confirm delete conversation dialogue.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {int|Null} type The conversation type to be removed.\n     * @return {Object} jQuery promise\n     */\n    var renderConfirmDeleteConversation = function(header, body, footer, type) {\n        var showmessage = null;\n        if (type == CONVERSATION_TYPES.SELF) {\n            // Message displayed to self-conversations is slighly different.\n            showmessage = 'deleteallselfconfirm';\n        } else if (type) {\n            // This other message should be displayed.\n            showmessage = 'deleteallconfirm';\n        }\n\n        if (showmessage) {\n            return Str.get_string(showmessage, 'core_message')\n                .then(function(string) {\n                    return showConfirmDialogue(\n                        header,\n                        body,\n                        footer,\n                        [SELECTORS.ACTION_CONFIRM_DELETE_CONVERSATION],\n                        string,\n                        '',\n                        true,\n                        false\n                    );\n                });\n        } else {\n            return hideConfirmDialogue(header, body, footer);\n        }\n    };\n\n    /**\n     * Render the confirm delete conversation dialogue.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} user The other user object.\n     * @return {Object} jQuery promise\n     */\n    var renderConfirmContactRequest = function(header, body, footer, user) {\n        if (user) {\n            return Str.get_string('userwouldliketocontactyou', 'core_message', user.fullname)\n                .then(function(string) {\n                    var buttonSelectors = [\n                        SELECTORS.ACTION_ACCEPT_CONTACT_REQUEST,\n                        SELECTORS.ACTION_DECLINE_CONTACT_REQUEST\n                    ];\n                    return showConfirmDialogue(header, body, footer, buttonSelectors, string, '', false, true);\n                });\n        } else {\n            return hideConfirmDialogue(header, body, footer);\n        }\n    };\n\n    /**\n     * Show the checkbox to allow delete message for all.\n     *\n     * @param {Object} body The body container element.\n     */\n    var showCheckDeleteDialogue = function(body) {\n        var dialogue = getConfirmDialogueContainer(body);\n        var checkboxRegion = dialogue.find(SELECTORS.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER);\n        checkboxRegion.removeClass('hidden');\n    };\n\n    /**\n     * Hide the checkbox to allow delete message for all.\n     *\n     * @param {Object} body The body container element.\n     */\n    var hideCheckDeleteDialogue = function(body) {\n        var dialogue = getConfirmDialogueContainer(body);\n        var checkboxRegion = dialogue.find(SELECTORS.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER);\n        var checkbox = dialogue.find(SELECTORS.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE);\n        checkbox.prop('checked', false);\n        checkboxRegion.addClass('hidden');\n    };\n\n    /**\n     * Show or hide the block / unblock option in the header dropdown menu.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} isBlocked is user blocked.\n     */\n    var renderIsBlocked = function(header, body, footer, isBlocked) {\n        if (isBlocked) {\n            header.find(SELECTORS.ACTION_REQUEST_BLOCK).addClass('hidden');\n            header.find(SELECTORS.ACTION_REQUEST_UNBLOCK).removeClass('hidden');\n        } else {\n            header.find(SELECTORS.ACTION_REQUEST_BLOCK).removeClass('hidden');\n            header.find(SELECTORS.ACTION_REQUEST_UNBLOCK).addClass('hidden');\n        }\n    };\n\n    /**\n     * Show or hide the favourite / unfavourite option in the header dropdown menu\n     * and the favourite star in the header title.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} state is this conversation a favourite.\n     */\n    var renderIsFavourite = function(header, body, footer, state) {\n        var favouriteIcon = header.find(SELECTORS.FAVOURITE_ICON_CONTAINER);\n        var addFavourite = header.find(SELECTORS.ACTION_CONFIRM_FAVOURITE);\n        var removeFavourite = header.find(SELECTORS.ACTION_CONFIRM_UNFAVOURITE);\n\n        switch (state) {\n            case 'hide':\n                favouriteIcon.addClass('hidden');\n                addFavourite.addClass('hidden');\n                removeFavourite.addClass('hidden');\n                break;\n            case 'show-add':\n                favouriteIcon.addClass('hidden');\n                addFavourite.removeClass('hidden');\n                removeFavourite.addClass('hidden');\n                break;\n            case 'show-remove':\n                favouriteIcon.removeClass('hidden');\n                addFavourite.addClass('hidden');\n                removeFavourite.removeClass('hidden');\n                break;\n        }\n    };\n\n    /**\n     * Show or hide the mute / unmute option in the header dropdown menu\n     * and the muted icon in the header title.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {string} state The state of the conversation as defined by the patcher.\n     */\n    var renderIsMuted = function(header, body, footer, state) {\n        var muteIcon = header.find(SELECTORS.MUTED_ICON_CONTAINER);\n        var setMuted = header.find(SELECTORS.ACTION_CONFIRM_MUTE);\n        var unsetMuted = header.find(SELECTORS.ACTION_CONFIRM_UNMUTE);\n\n        switch (state) {\n            case 'hide':\n                muteIcon.addClass('hidden');\n                setMuted.addClass('hidden');\n                unsetMuted.addClass('hidden');\n                break;\n            case 'show-mute':\n                muteIcon.addClass('hidden');\n                setMuted.removeClass('hidden');\n                unsetMuted.addClass('hidden');\n                break;\n            case 'show-unmute':\n                muteIcon.removeClass('hidden');\n                setMuted.addClass('hidden');\n                unsetMuted.removeClass('hidden');\n                break;\n        }\n    };\n\n    /**\n     * Show or hide the add / remove user as contact option in the header dropdown menu.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} state the contact state.\n     */\n    var renderIsContact = function(header, body, footer, state) {\n        var addContact = header.find(SELECTORS.ACTION_REQUEST_ADD_CONTACT);\n        var removeContact = header.find(SELECTORS.ACTION_REQUEST_REMOVE_CONTACT);\n\n        switch (state) {\n            case 'pending-contact':\n                addContact.addClass('hidden');\n                removeContact.addClass('hidden');\n                break;\n            case 'contact':\n                addContact.addClass('hidden');\n                removeContact.removeClass('hidden');\n                break;\n            case 'non-contact':\n                addContact.removeClass('hidden');\n                removeContact.addClass('hidden');\n                break;\n        }\n    };\n\n    /**\n     * Show or hide confirm action from confirm dialogue is loading.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} isLoading confirm action is loading.\n     */\n    var renderLoadingConfirmAction = function(header, body, footer, isLoading) {\n        var dialogue = getConfirmDialogueContainer(body);\n        var buttons = dialogue.find('button');\n        var buttonText = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_BUTTON_TEXT);\n        var loadingIcon = dialogue.find(SELECTORS.LOADING_ICON_CONTAINER);\n\n        if (isLoading) {\n            buttons.prop('disabled', true);\n            buttonText.addClass('hidden');\n            loadingIcon.removeClass('hidden');\n        } else {\n            buttons.prop('disabled', false);\n            buttonText.removeClass('hidden');\n            loadingIcon.addClass('hidden');\n        }\n    };\n\n    /**\n     * Show or hide the header and footer content for edit mode.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Bool} inEditMode In edit mode or not.\n     */\n    var renderInEditMode = function(header, body, footer, inEditMode) {\n        var messages = null;\n\n        if (inEditMode) {\n            messages = body.find(SELECTORS.MESSAGE_NOT_SELECTED);\n            messages.find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).removeClass('hidden');\n            hideHeaderContent(header);\n            showHeaderEditMode(header);\n        } else {\n            messages = getMessagesContainer(body);\n            messages.find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).addClass('hidden');\n            messages.find(SELECTORS.MESSAGE_SELECTED_ICON).addClass('hidden');\n            showHeaderContent(header);\n            hideHeaderEditMode(header);\n        }\n    };\n\n    /**\n     * Select or unselect messages.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} data The messages to select or unselect.\n     */\n    var renderSelectedMessages = function(header, body, footer, data) {\n        var hasSelectedMessages = data.count > 0;\n\n        if (data.add.length) {\n            data.add.forEach(function(messageId) {\n                var message = getMessageElement(body, messageId);\n                message.find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).addClass('hidden');\n                message.find(SELECTORS.MESSAGE_SELECTED_ICON).removeClass('hidden');\n                message.attr('aria-checked', true);\n            });\n        }\n\n        if (data.remove.length) {\n            data.remove.forEach(function(messageId) {\n                var message = getMessageElement(body, messageId);\n\n                if (hasSelectedMessages) {\n                    message.find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).removeClass('hidden');\n                }\n\n                message.find(SELECTORS.MESSAGE_SELECTED_ICON).addClass('hidden');\n                message.attr('aria-checked', false);\n            });\n        }\n\n        setMessagesSelectedCount(header, data.count);\n    };\n\n    /**\n     * Show or hide the require add contact panel.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} data Whether the user has to be added a a contact.\n     * @return {Object} jQuery promise\n     */\n    var renderRequireAddContact = function(header, body, footer, data) {\n        if (data.show && !data.hasMessages) {\n            return Str.get_strings([\n                    {\n                        key: 'requirecontacttomessage',\n                        component: 'core_message',\n                        param: data.user.fullname\n                    },\n                    {\n                        key: 'isnotinyourcontacts',\n                        component: 'core_message',\n                        param: data.user.fullname\n                    }\n                ])\n                .then(function(strings) {\n                    var title = strings[1];\n                    var text = strings[0];\n                    return showConfirmDialogue(\n                        header,\n                        body,\n                        footer,\n                        [SELECTORS.ACTION_REQUEST_ADD_CONTACT],\n                        text,\n                        title,\n                        false,\n                        true\n                    );\n                });\n        } else {\n            return hideConfirmDialogue(header, body, footer);\n        }\n    };\n\n    /**\n     * Show or hide the self-conversation message.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} displayMessage should the message be displayed?.\n     * @return {Object|true} jQuery promise\n     */\n    var renderSelfConversationMessage = function(header, body, footer, displayMessage) {\n        var container = getSelfConversationMessageContainer(body);\n        if (displayMessage) {\n            container.removeClass('hidden');\n        } else {\n            container.addClass('hidden');\n        }\n        return true;\n    };\n\n    /**\n     * Show or hide the require add contact panel.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @param {Object} userFullName Full name of the other user.\n     * @return {Object|true} jQuery promise\n     */\n    var renderContactRequestSent = function(header, body, footer, userFullName) {\n        var container = getContactRequestSentContainer(body);\n        if (userFullName) {\n            return Str.get_string('yourcontactrequestpending', 'core_message', userFullName)\n                .then(function(string) {\n                    container.find(SELECTORS.TEXT).text(string);\n                    container.removeClass('hidden');\n                    return string;\n                });\n        } else {\n            container.addClass('hidden');\n            return true;\n        }\n    };\n\n    /**\n     * Reset the UI to the initial state.\n     *\n     * @param {Object} header The header container element.\n     * @param {Object} body The body container element.\n     * @param {Object} footer The footer container element.\n     * @return {Bool}\n     */\n    var renderReset = function(header, body, footer) {\n        hideConfirmDialogue(header, body, footer);\n        hideContactRequestSentContainer(body);\n        hideSelfConversationMessageContainer(body);\n        hideAllHeaderElements(header);\n        showHeaderPlaceholder(header);\n        hideAllFooterElements(footer);\n        showFooterPlaceholder(footer);\n        return true;\n    };\n\n    var render = function(header, body, footer, patch) {\n        var configs = [\n            {\n                // Resetting the UI needs to come first, if it's required.\n                reset: renderReset\n            },\n            {\n                // Any async rendering (stuff that requires templates, strings etc) should\n                // go in here.\n                conversation: renderConversation,\n                header: renderHeader,\n                footer: renderFooter,\n                confirmBlockUser: renderConfirmBlockUser,\n                confirmUnblockUser: renderConfirmUnblockUser,\n                confirmAddContact: renderConfirmAddContact,\n                confirmRemoveContact: renderConfirmRemoveContact,\n                confirmDeleteSelectedMessages: renderConfirmDeleteSelectedMessages,\n                confirmDeleteConversation: renderConfirmDeleteConversation,\n                confirmContactRequest: renderConfirmContactRequest,\n                requireAddContact: renderRequireAddContact,\n                selfConversationMessage: renderSelfConversationMessage,\n                contactRequestSent: renderContactRequestSent\n            },\n            {\n                loadingMembers: renderLoadingMembers,\n                loadingFirstMessages: renderLoadingFirstMessages,\n                loadingMessages: renderLoadingMessages,\n                isBlocked: renderIsBlocked,\n                isContact: renderIsContact,\n                isFavourite: renderIsFavourite,\n                isMuted: renderIsMuted,\n                loadingConfirmAction: renderLoadingConfirmAction,\n                inEditMode: renderInEditMode,\n                showEmojiPicker: renderShowEmojiPicker,\n                showEmojiAutoComplete: renderShowEmojiAutoComplete,\n            },\n            {\n                // Scrolling should be last to make sure everything\n                // on the page is visible.\n                scrollToMessage: renderScrollToMessage,\n                selectedMessages: renderSelectedMessages\n            }\n        ];\n        // Helper function to process each of the configs above.\n        var processConfig = function(config) {\n            var results = [];\n\n            for (var key in patch) {\n                if (config.hasOwnProperty(key)) {\n                    var renderFunc = config[key];\n                    var patchValue = patch[key];\n                    results.push(renderFunc(header, body, footer, patchValue));\n                }\n            }\n\n            return results;\n        };\n\n        // The first config is special because it resets the UI.\n        var renderingPromises = processConfig(configs[0]);\n        // The second config is special because it contains async rendering.\n        renderingPromises = renderingPromises.concat(processConfig(configs[1]));\n\n        // Wait for the async rendering to complete before processing the\n        // rest of the configs, in order.\n        return $.when.apply($, renderingPromises)\n            .then(function() {\n                for (var i = 2; i < configs.length; i++) {\n                    processConfig(configs[i]);\n                }\n\n                return;\n            })\n            .catch(Notification.exception);\n    };\n\n    return {\n        render: render,\n    };\n});\n"],"file":"message_drawer_view_conversation_renderer.min.js"}