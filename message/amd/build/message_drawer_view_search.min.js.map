{"version":3,"sources":["../src/message_drawer_view_search.js"],"names":["define","$","CustomEvents","Notification","PubSub","Str","Templates","Repository","Events","USERS_SEARCH_LIMIT","USERS_INITIAL_SEARCH_LIMIT","SELECTORS","BLOCK_ICON_CONTAINER","CANCEL_SEARCH_BUTTON","CONTACTS_CONTAINER","CONTACTS_LIST","EMPTY_MESSAGE_CONTAINER","LIST","LOADING_ICON_CONTAINER","LOADING_PLACEHOLDER","MESSAGES_LIST","MESSAGES_CONTAINER","NON_CONTACTS_CONTAINER","NON_CONTACTS_LIST","SEARCH_ICON_CONTAINER","SEARCH_ACTION","SEARCH_INPUT","SEARCH_RESULTS_CONTAINER","LOAD_MORE_USERS","LOAD_MORE_MESSAGES","BUTTON_TEXT","NO_RESULTS_CONTAINTER","ALL_CONTACTS_CONTAINER","TEMPLATES","getLoggedInUserId","body","attr","getEmptyMessageContainer","find","getLoadingIconContainer","header","getLoadingPlaceholder","getSearchIconContainer","getSearchInput","getSearchResultsContainer","getContactsContainer","getNonContactsContainer","getMessagesContainer","showEmptyMessage","removeClass","hideEmptyMessage","addClass","showLoadingIcon","hideLoadingIcon","showLoadingPlaceholder","hideLoadingPlaceholder","showSearchIcon","hideSearchIcon","showSearchResults","hideSearchResults","showNoSearchResults","container","hideNoSearchResults","showAllContactsSearchResults","hideAllContactsSearchResults","showContactsSearchResults","hideContactsSearchResults","showNonContactsSearchResults","hideNonContactsSearchResults","showMessagesSearchResults","hideMessagesSearchResults","disableSearchInput","prop","enableSearchInput","clearSearchInput","val","clearAllSearchResults","empty","showLoadMoreUsersButton","showLoadMoreMessagesButton","startLoading","stopLoading","showUsersLoadingIcon","root","button","hideUsersLoadingIcon","hideLoadMoreUsersButton","showMessagesLoadingIcon","hideMessagesLoadingIcon","hideLoadMoreMessagesButton","findContact","userId","addContact","contact","nonContactsContainer","nonContact","userid","length","remove","contactsContainer","append","children","removeContact","blockContact","unblockContact","highlightSearch","content","searchText","regex","RegExp","replace","renderContacts","contacts","frompanel","list","render","then","html","renderNonContacts","nonContacts","noncontacts","renderMessages","messages","loadMoreUsers","loggedInUserId","text","limit","offset","loadedAll","searchUsers","results","slice","contactsCount","nonContactsCount","forEach","highlight","fullname","when","counts","catch","error","loadMoreMessages","searchMessages","message","lastmessage","count","search","usersLimit","usersOffset","messagesLimit","messagesOffset","userCounts","messagesCount","registerEventListeners","searchInput","searchEventHandler","e","data","trim","focus","exception","originalEvent","preventDefault","events","enter","activate","on","subscribe","CONTACT_ADDED","CONTACT_REMOVED","CONTACT_BLOCKED","CONTACT_UNBLOCKED","show","namespace","Deferred","resolve","promise","description","get_string"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Controls the search page of the message drawer.\n *\n * @module     core_message/message_drawer_view_search\n * @copyright  2018 Ryan Wyllie <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(\n[\n    'jquery',\n    'core/custom_interaction_events',\n    'core/notification',\n    'core/pubsub',\n    'core/str',\n    'core/templates',\n    'core_message/message_repository',\n    'core_message/message_drawer_events',\n],\nfunction(\n    $,\n    CustomEvents,\n    Notification,\n    PubSub,\n    Str,\n    Templates,\n    Repository,\n    Events\n) {\n\n    var MESSAGE_SEARCH_LIMIT = 50;\n    var USERS_SEARCH_LIMIT = 50;\n    var USERS_INITIAL_SEARCH_LIMIT = 3;\n\n    var SELECTORS = {\n        BLOCK_ICON_CONTAINER: '[data-region=\"block-icon-container\"]',\n        CANCEL_SEARCH_BUTTON: '[data-action=\"cancel-search\"]',\n        CONTACTS_CONTAINER: '[data-region=\"contacts-container\"]',\n        CONTACTS_LIST: '[data-region=\"contacts-container\"] [data-region=\"list\"]',\n        EMPTY_MESSAGE_CONTAINER: '[data-region=\"empty-message-container\"]',\n        LIST: '[data-region=\"list\"]',\n        LOADING_ICON_CONTAINER: '[data-region=\"loading-icon-container\"]',\n        LOADING_PLACEHOLDER: '[data-region=\"loading-placeholder\"]',\n        MESSAGES_LIST: '[data-region=\"messages-container\"] [data-region=\"list\"]',\n        MESSAGES_CONTAINER: '[data-region=\"messages-container\"]',\n        NON_CONTACTS_CONTAINER: '[data-region=\"non-contacts-container\"]',\n        NON_CONTACTS_LIST: '[data-region=\"non-contacts-container\"] [data-region=\"list\"]',\n        SEARCH_ICON_CONTAINER: '[data-region=\"search-icon-container\"]',\n        SEARCH_ACTION: '[data-action=\"search\"]',\n        SEARCH_INPUT: '[data-region=\"search-input\"]',\n        SEARCH_RESULTS_CONTAINER: '[data-region=\"search-results-container\"]',\n        LOAD_MORE_USERS: '[data-action=\"load-more-users\"]',\n        LOAD_MORE_MESSAGES: '[data-action=\"load-more-messages\"]',\n        BUTTON_TEXT: '[data-region=\"button-text\"]',\n        NO_RESULTS_CONTAINTER: '[data-region=\"no-results-container\"]',\n        ALL_CONTACTS_CONTAINER: '[data-region=\"all-contacts-container\"]'\n    };\n\n    var TEMPLATES = {\n        CONTACTS_LIST: 'core_message/message_drawer_contacts_list',\n        NON_CONTACTS_LIST: 'core_message/message_drawer_non_contacts_list',\n        MESSAGES_LIST: 'core_message/message_drawer_messages_list'\n    };\n\n    /**\n     * Get the logged in user id.\n     *\n     * @param  {Object} body Search body container element.\n     * @return {Number} User id.\n     */\n    var getLoggedInUserId = function(body) {\n        return body.attr('data-user-id');\n    };\n\n    /**\n     * Show the no messages container element.\n     *\n     * @param  {Object} body Search body container element.\n     * @return {Object} No messages container element.\n     */\n    var getEmptyMessageContainer = function(body) {\n        return body.find(SELECTORS.EMPTY_MESSAGE_CONTAINER);\n    };\n\n    /**\n     * Get the search loading icon.\n     *\n     * @param  {Object} header Search header container element.\n     * @return {Object} Loading icon element.\n     */\n    var getLoadingIconContainer = function(header) {\n        return header.find(SELECTORS.LOADING_ICON_CONTAINER);\n    };\n\n    /**\n     * Get the loading container element.\n     *\n     * @param  {Object} body Search body container element.\n     * @return {Object} Loading container element.\n     */\n    var getLoadingPlaceholder = function(body) {\n        return body.find(SELECTORS.LOADING_PLACEHOLDER);\n    };\n\n    /**\n     * Get the search icon container.\n     *\n     * @param  {Object} header Search header container element.\n     * @return {Object} Search icon container.\n     */\n    var getSearchIconContainer = function(header) {\n        return header.find(SELECTORS.SEARCH_ICON_CONTAINER);\n    };\n\n    /**\n     * Get the search input container.\n     *\n     * @param  {Object} header Search header container element.\n     * @return {Object} Search input container.\n     */\n    var getSearchInput = function(header) {\n        return header.find(SELECTORS.SEARCH_INPUT);\n    };\n\n    /**\n     * Get the search results container.\n     *\n     * @param  {Object} body Search body container element.\n     * @return {Object} Search results container.\n     */\n    var getSearchResultsContainer = function(body) {\n        return body.find(SELECTORS.SEARCH_RESULTS_CONTAINER);\n    };\n\n    /**\n     * Get the search contacts container.\n     *\n     * @param  {Object} body Search body container element.\n     * @return {Object} Search contacts container.\n     */\n    var getContactsContainer = function(body) {\n        return body.find(SELECTORS.CONTACTS_CONTAINER);\n    };\n\n    /**\n     * Get the search non contacts container.\n     *\n     * @param  {Object} body Search body container element.\n     * @return {Object} Search non contacts container.\n     */\n    var getNonContactsContainer = function(body) {\n        return body.find(SELECTORS.NON_CONTACTS_CONTAINER);\n    };\n\n    /**\n     * Get the search messages container.\n     *\n     * @param  {Object} body Search body container element.\n     * @return {Object} Search messages container.\n     */\n    var getMessagesContainer = function(body) {\n        return body.find(SELECTORS.MESSAGES_CONTAINER);\n    };\n\n\n    /**\n     * Show the messages empty container.\n     *\n     * @param {Object} body Search body container element.\n     */\n    var showEmptyMessage = function(body) {\n        getEmptyMessageContainer(body).removeClass('hidden');\n    };\n\n    /**\n     * Hide the messages empty container.\n     *\n     * @param {Object} body Search body container element.\n     */\n    var hideEmptyMessage = function(body) {\n        getEmptyMessageContainer(body).addClass('hidden');\n    };\n\n\n    /**\n     * Show the loading icon.\n     *\n     * @param {Object} header Search header container element.\n     */\n    var showLoadingIcon = function(header) {\n        getLoadingIconContainer(header).removeClass('hidden');\n    };\n\n    /**\n     * Hide the loading icon.\n     *\n     * @param {Object} header Search header container element.\n     */\n    var hideLoadingIcon = function(header) {\n        getLoadingIconContainer(header).addClass('hidden');\n    };\n\n    /**\n     * Show loading placeholder.\n     *\n     * @param {Object} body Search body container element.\n     */\n    var showLoadingPlaceholder = function(body) {\n        getLoadingPlaceholder(body).removeClass('hidden');\n    };\n\n    /**\n     * Hide loading placeholder.\n     *\n     * @param {Object} body Search body container element.\n     */\n    var hideLoadingPlaceholder = function(body) {\n        getLoadingPlaceholder(body).addClass('hidden');\n    };\n\n    /**\n     * Show search icon.\n     *\n     * @param {Object} header Search header container element.\n     */\n    var showSearchIcon = function(header) {\n        getSearchIconContainer(header).removeClass('hidden');\n    };\n\n    /**\n     * Hide search icon.\n     *\n     * @param {Object} header Search header container element.\n     */\n    var hideSearchIcon = function(header) {\n        getSearchIconContainer(header).addClass('hidden');\n    };\n\n    /**\n     * Show search results.\n     *\n     * @param {Object} body Search body container element.\n     */\n    var showSearchResults = function(body) {\n        getSearchResultsContainer(body).removeClass('hidden');\n    };\n\n    /**\n     * Hide search results.\n     *\n     * @param {Object} body Search body container element.\n     */\n    var hideSearchResults = function(body) {\n        getSearchResultsContainer(body).addClass('hidden');\n    };\n\n    /**\n     * Show the no search results message.\n     *\n     * @param {Object} body Search body container element.\n     */\n    var showNoSearchResults = function(body) {\n        var container = getSearchResultsContainer(body);\n        container.find(SELECTORS.ALL_CONTACTS_CONTAINER).addClass('hidden');\n        container.find(SELECTORS.MESSAGES_CONTAINER).addClass('hidden');\n        container.find(SELECTORS.NO_RESULTS_CONTAINTER).removeClass('hidden');\n    };\n\n    /**\n     * Hide the no search results message.\n     *\n     * @param {Object} body Search body container element.\n     */\n    var hideNoSearchResults = function(body) {\n        var container = getSearchResultsContainer(body);\n        container.find(SELECTORS.ALL_CONTACTS_CONTAINER).removeClass('hidden');\n        container.find(SELECTORS.MESSAGES_CONTAINER).removeClass('hidden');\n        container.find(SELECTORS.NO_RESULTS_CONTAINTER).addClass('hidden');\n    };\n\n    /**\n     * Show the whole contacts results area.\n     *\n     * @param {Object} body Search body container element.\n     */\n    var showAllContactsSearchResults = function(body) {\n        var container = getSearchResultsContainer(body);\n        container.find(SELECTORS.ALL_CONTACTS_CONTAINER).removeClass('hidden');\n    };\n\n    /**\n     * Hide the whole contacts results area.\n     *\n     * @param {Object} body Search body container element.\n     */\n    var hideAllContactsSearchResults = function(body) {\n        var container = getSearchResultsContainer(body);\n        container.find(SELECTORS.ALL_CONTACTS_CONTAINER).addClass('hidden');\n    };\n\n    /**\n     * Show the contacts results.\n     *\n     * @param {Object} body Search body container element.\n     */\n    var showContactsSearchResults = function(body) {\n        var container = getSearchResultsContainer(body);\n        container.find(SELECTORS.CONTACTS_CONTAINER).removeClass('hidden');\n    };\n\n    /**\n     * Hide the contacts results.\n     *\n     * @param {Object} body Search body container element.\n     */\n    var hideContactsSearchResults = function(body) {\n        var container = getSearchResultsContainer(body);\n        container.find(SELECTORS.CONTACTS_CONTAINER).addClass('hidden');\n    };\n\n    /**\n     * Show the non contacts results.\n     *\n     * @param {Object} body Search body container element.\n     */\n    var showNonContactsSearchResults = function(body) {\n        var container = getSearchResultsContainer(body);\n        container.find(SELECTORS.NON_CONTACTS_CONTAINER).removeClass('hidden');\n    };\n\n    /**\n     * Hide the non contacts results.\n     *\n     * @param {Object} body Search body container element.\n     */\n    var hideNonContactsSearchResults = function(body) {\n        var container = getSearchResultsContainer(body);\n        container.find(SELECTORS.NON_CONTACTS_CONTAINER).addClass('hidden');\n    };\n\n    /**\n     * Show the messages results.\n     *\n     * @param {Object} body Search body container element.\n     */\n    var showMessagesSearchResults = function(body) {\n        var container = getSearchResultsContainer(body);\n        container.find(SELECTORS.MESSAGES_CONTAINER).removeClass('hidden');\n    };\n\n    /**\n     * Hide the messages results.\n     *\n     * @param {Object} body Search body container element.\n     */\n    var hideMessagesSearchResults = function(body) {\n        var container = getSearchResultsContainer(body);\n        container.find(SELECTORS.MESSAGES_CONTAINER).addClass('hidden');\n    };\n\n    /**\n     * Disable the search input.\n     *\n     * @param {Object} header Search header container element.\n     */\n    var disableSearchInput = function(header) {\n        getSearchInput(header).prop('disabled', true);\n    };\n\n    /**\n     * Enable the search input.\n     *\n     * @param {Object} header Search header container element.\n     */\n    var enableSearchInput = function(header) {\n        getSearchInput(header).prop('disabled', false);\n    };\n\n    /**\n     * Clear the search input.\n     *\n     * @param {Object} header Search header container element.\n     */\n    var clearSearchInput = function(header) {\n        getSearchInput(header).val('');\n    };\n\n    /**\n     * Clear all search results\n     *\n     * @param {Object} body Search body container element.\n     */\n    var clearAllSearchResults = function(body) {\n        body.find(SELECTORS.CONTACTS_LIST).empty();\n        body.find(SELECTORS.NON_CONTACTS_LIST).empty();\n        body.find(SELECTORS.MESSAGES_LIST).empty();\n        hideNoSearchResults(body);\n        showAllContactsSearchResults(body);\n        showContactsSearchResults(body);\n        showNonContactsSearchResults(body);\n        showMessagesSearchResults(body);\n        showLoadMoreUsersButton(body);\n        showLoadMoreMessagesButton(body);\n    };\n\n    /**\n     * Update the body and header to indicate the search is loading.\n     *\n     * @param {Object} header Search header container element.\n     * @param {Object} body Search body container element.\n     */\n    var startLoading = function(header, body) {\n        hideSearchIcon(header);\n        hideEmptyMessage(body);\n        hideSearchResults(body);\n        showLoadingIcon(header);\n        showLoadingPlaceholder(body);\n        disableSearchInput(header);\n    };\n\n    /**\n     * Update the body and header to indicate the search has stopped loading.\n     *\n     * @param {Object} header Search header container element.\n     * @param {Object} body Search body container element.\n     */\n    var stopLoading = function(header, body) {\n        showSearchIcon(header);\n        hideEmptyMessage(body);\n        showSearchResults(body);\n        hideLoadingIcon(header);\n        hideLoadingPlaceholder(body);\n        enableSearchInput(header);\n    };\n\n    /**\n     * Show the more users loading icon.\n     *\n     * @param {Object} root The more users container element.\n     */\n    var showUsersLoadingIcon = function(root) {\n        var button = root.find(SELECTORS.LOAD_MORE_USERS);\n        button.prop('disabled', true);\n        button.find(SELECTORS.BUTTON_TEXT).addClass('hidden');\n        button.find(SELECTORS.LOADING_ICON_CONTAINER).removeClass('hidden');\n    };\n\n    /**\n     * Hide the more users loading icon.\n     *\n     * @param {Object} root The more users container element.\n     */\n    var hideUsersLoadingIcon = function(root) {\n        var button = root.find(SELECTORS.LOAD_MORE_USERS);\n        button.prop('disabled', false);\n        button.find(SELECTORS.BUTTON_TEXT).removeClass('hidden');\n        button.find(SELECTORS.LOADING_ICON_CONTAINER).addClass('hidden');\n    };\n\n    /**\n     * Show the load more users button.\n     *\n     * @param {Object} root The users container element.\n     */\n    var showLoadMoreUsersButton = function(root) {\n        root.find(SELECTORS.LOAD_MORE_USERS).removeClass('hidden');\n    };\n\n    /**\n     * Hide the load more users button.\n     *\n     * @param {Object} root The users container element.\n     */\n    var hideLoadMoreUsersButton = function(root) {\n        root.find(SELECTORS.LOAD_MORE_USERS).addClass('hidden');\n    };\n\n    /**\n     * Show the messages are loading icon.\n     *\n     * @param {Object} root Messages root element.\n     */\n    var showMessagesLoadingIcon = function(root) {\n        var button = root.find(SELECTORS.LOAD_MORE_MESSAGES);\n        button.prop('disabled', true);\n        button.find(SELECTORS.BUTTON_TEXT).addClass('hidden');\n        button.find(SELECTORS.LOADING_ICON_CONTAINER).removeClass('hidden');\n    };\n\n    /**\n     * Hide the messages are loading icon.\n     *\n     * @param {Object} root Messages root element.\n     */\n    var hideMessagesLoadingIcon = function(root) {\n        var button = root.find(SELECTORS.LOAD_MORE_MESSAGES);\n        button.prop('disabled', false);\n        button.find(SELECTORS.BUTTON_TEXT).removeClass('hidden');\n        button.find(SELECTORS.LOADING_ICON_CONTAINER).addClass('hidden');\n    };\n\n    /**\n     * Show the load more messages button.\n     *\n     * @param  {Object} root The messages container element.\n     */\n    var showLoadMoreMessagesButton = function(root) {\n        root.find(SELECTORS.LOAD_MORE_MESSAGES).removeClass('hidden');\n    };\n\n    /**\n     * Hide the load more messages button.\n     *\n     * @param  {Object} root The messages container element.\n     */\n    var hideLoadMoreMessagesButton = function(root) {\n        root.find(SELECTORS.LOAD_MORE_MESSAGES).addClass('hidden');\n    };\n\n    /**\n     * Find a contact in the search results.\n     *\n     * @param  {Object} root Search results container element.\n     * @param  {Number} userId User id.\n     * @return {Object} User container element.\n     */\n    var findContact = function(root, userId) {\n        return root.find('[data-contact-user-id=\"' + userId + '\"]');\n    };\n\n    /**\n     * Add a contact to the search results.\n     *\n     * @param {Object} root Search results container.\n     * @param {Object} contact User in contacts list.\n     */\n    var addContact = function(root, contact) {\n        var nonContactsContainer = getNonContactsContainer(root);\n        var nonContact = findContact(nonContactsContainer, contact.userid);\n\n        if (nonContact.length) {\n            nonContact.remove();\n            var contactsContainer = getContactsContainer(root);\n            contactsContainer.removeClass('hidden');\n            contactsContainer.find(SELECTORS.LIST).append(nonContact);\n        }\n\n        if (!nonContactsContainer.find(SELECTORS.LIST).children().length) {\n            nonContactsContainer.addClass('hidden');\n        }\n    };\n\n    /**\n     * Remove a contact from the contacts results.\n     *\n     * @param {Object} root Search results container.\n     * @param {Object} userId Contact user id.\n     */\n    var removeContact = function(root, userId) {\n        var contactsContainer = getContactsContainer(root);\n        var contact = findContact(contactsContainer, userId);\n\n        if (contact.length) {\n            contact.remove();\n            var nonContactsContainer = getNonContactsContainer(root);\n            nonContactsContainer.removeClass('hidden');\n            nonContactsContainer.find(SELECTORS.LIST).append(contact);\n        }\n\n        if (!contactsContainer.find(SELECTORS.LIST).children().length) {\n            contactsContainer.addClass('hidden');\n        }\n    };\n\n    /**\n     * Show the contact is blocked icon.\n     *\n     * @param {Object} root Search results container.\n     * @param {Object} userId Contact user id.\n     */\n    var blockContact = function(root, userId) {\n        var contact = findContact(root, userId);\n        if (contact.length) {\n            contact.find(SELECTORS.BLOCK_ICON_CONTAINER).removeClass('hidden');\n        }\n    };\n\n    /**\n     * Hide the contact is blocked icon.\n     *\n     * @param {Object} root Search results container.\n     * @param {Object} userId Contact user id.\n     */\n    var unblockContact = function(root, userId) {\n        var contact = findContact(root, userId);\n        if (contact.length) {\n            contact.find(SELECTORS.BLOCK_ICON_CONTAINER).addClass('hidden');\n        }\n    };\n\n    /**\n     * Highlight words in search results.\n     *\n     * @param  {String} content HTML to search.\n     * @param  {String} searchText Search text.\n     * @return {String} searchText with search wrapped in matchtext span.\n     */\n    var highlightSearch = function(content, searchText) {\n        if (!content) {\n            return '';\n        }\n        var regex = new RegExp('(' + searchText + ')', 'gi');\n        return content.replace(regex, '<span class=\"matchtext\">$1</span>');\n    };\n\n\n    /**\n     * Render contacts in the contacts search results.\n     *\n     * @param {Object} root Search results container.\n     * @param {Array} contacts List of contacts.\n     * @return {Promise} Renderer promise.\n     */\n    var renderContacts = function(root, contacts) {\n        var container = getContactsContainer(root);\n        var frompanel = root.attr('data-in-panel');\n        var list = container.find(SELECTORS.LIST);\n\n        return Templates.render(TEMPLATES.CONTACTS_LIST, {contacts: contacts, frompanel: frompanel})\n            .then(function(html) {\n                list.append(html);\n                return html;\n            });\n    };\n\n    /**\n     * Render non contacts in the contacts search results.\n     *\n     * @param {Object} root Search results container.\n     * @param {Array} nonContacts List of non contacts.\n     * @return {Promise} Renderer promise.\n     */\n    var renderNonContacts = function(root, nonContacts) {\n        var container = getNonContactsContainer(root);\n        var frompanel = root.attr('data-in-panel');\n        var list = container.find(SELECTORS.LIST);\n\n        return Templates.render(TEMPLATES.NON_CONTACTS_LIST, {noncontacts: nonContacts, frompanel: frompanel})\n            .then(function(html) {\n                list.append(html);\n                return html;\n            });\n    };\n\n    /**\n     * Render messages in the messages search results.\n     *\n     * @param {Object} root Search results container.\n     * @param {Array} messages List of messages.\n     * @return {Promise} Renderer promise.\n     */\n    var renderMessages = function(root, messages) {\n        var container = getMessagesContainer(root);\n        var frompanel = root.attr('data-in-panel');\n        var list = container.find(SELECTORS.LIST);\n\n        return Templates.render(TEMPLATES.MESSAGES_LIST, {messages: messages, frompanel: frompanel})\n            .then(function(html) {\n                list.append(html);\n                return html;\n            });\n    };\n\n    /**\n     * Load more users from the repository and render the results into the users search results.\n     *\n     * @param  {Object} root Search results container.\n     * @param  {Number} loggedInUserId Current logged in user.\n     * @param  {String} text Search text.\n     * @param  {Number} limit Number of users to get.\n     * @param  {Number} offset Load users from\n     * @return {Object} jQuery promise\n     */\n    var loadMoreUsers = function(root, loggedInUserId, text, limit, offset) {\n        var loadedAll = false;\n        showUsersLoadingIcon(root);\n\n        return Repository.searchUsers(loggedInUserId, text, limit + 1, offset)\n            .then(function(results) {\n                var contacts = results.contacts;\n                var noncontacts = results.noncontacts;\n\n                if (contacts.length <= limit && noncontacts.length <= limit) {\n                    loadedAll = true;\n                    return {\n                        contacts: contacts,\n                        noncontacts: noncontacts\n                    };\n                } else {\n                    return {\n                        contacts: contacts.slice(0, limit),\n                        noncontacts: noncontacts.slice(0, limit)\n                    };\n                }\n            })\n            .then(function(results) {\n                var contactsCount = results.contacts.length;\n                var nonContactsCount = results.noncontacts.length;\n\n                if (contactsCount) {\n                    results.contacts.forEach(function(contact) {\n                        contact.highlight = highlightSearch(contact.fullname, text);\n                    });\n                }\n\n                if (nonContactsCount) {\n                    results.noncontacts.forEach(function(contact) {\n                        contact.highlight = highlightSearch(contact.fullname, text);\n                    });\n                }\n\n                return $.when(\n                    contactsCount ? renderContacts(root, results.contacts) : true,\n                    nonContactsCount ? renderNonContacts(root, results.noncontacts) : true\n                )\n                .then(function() {\n                    return {\n                        contactsCount: contactsCount,\n                        nonContactsCount: nonContactsCount\n                    };\n                });\n            })\n            .then(function(counts) {\n                hideUsersLoadingIcon(root);\n\n                if (loadedAll) {\n                    hideLoadMoreUsersButton(root);\n                }\n\n                return counts;\n            })\n            .catch(function(error) {\n                hideUsersLoadingIcon(root);\n                // Rethrow error for other handlers.\n                throw error;\n            });\n    };\n\n    /**\n     * Load more messages from the repository and render the results into the messages search results.\n     *\n     * @param  {Object} root Search results container.\n     * @param  {Number} loggedInUserId Current logged in user.\n     * @param  {String} text Search text.\n     * @param  {Number} limit Number of messages to get.\n     * @param  {Number} offset Load messages from\n     * @return {Object} jQuery promise\n     */\n    var loadMoreMessages = function(root, loggedInUserId, text, limit, offset) {\n        var loadedAll = false;\n        showMessagesLoadingIcon(root);\n\n        return Repository.searchMessages(loggedInUserId, text, limit + 1, offset)\n            .then(function(results) {\n                var messages = results.contacts;\n\n                if (messages.length <= limit) {\n                    loadedAll = true;\n                    return messages;\n                } else {\n                    return messages.slice(0, limit);\n                }\n            })\n            .then(function(messages) {\n                if (messages.length) {\n                    messages.forEach(function(message) {\n                        message.lastmessage = highlightSearch(message.lastmessage, text);\n                    });\n                    return renderMessages(root, messages)\n                        .then(function() {\n                            return messages.length;\n                        });\n                } else {\n                    return messages.length;\n                }\n            })\n            .then(function(count) {\n                hideMessagesLoadingIcon(root);\n\n                if (loadedAll) {\n                    hideLoadMoreMessagesButton(root);\n                }\n\n                return count;\n            })\n            .catch(function(error) {\n                hideMessagesLoadingIcon(root);\n                // Rethrow error for other handlers.\n                throw error;\n            });\n    };\n\n    /**\n     * Search for users and messages.\n     *\n     * @param {Object} header Search header container element.\n     * @param {Object} body Search body container element.\n     * @param {String} searchText Search text.\n     * @param {Number} usersLimit The users limit.\n     * @param {Number} usersOffset The users offset.\n     * @param {Number} messagesLimit The message limit.\n     * @param {Number} messagesOffset The message offset.\n     * @return {Object} jQuery promise\n     */\n    var search = function(header, body, searchText, usersLimit, usersOffset, messagesLimit, messagesOffset) {\n        var loggedInUserId = getLoggedInUserId(body);\n        startLoading(header, body);\n        clearAllSearchResults(body);\n\n        return $.when(\n            loadMoreUsers(body, loggedInUserId, searchText, usersLimit, usersOffset),\n            loadMoreMessages(body, loggedInUserId, searchText, messagesLimit, messagesOffset)\n        )\n        .then(function(userCounts, messagesCount) {\n            var contactsCount = userCounts.contactsCount;\n            var nonContactsCount = userCounts.nonContactsCount;\n\n            stopLoading(header, body);\n\n            if (!contactsCount && !nonContactsCount && !messagesCount) {\n                showNoSearchResults(body);\n            } else {\n                if (!contactsCount && !nonContactsCount) {\n                    hideAllContactsSearchResults(body);\n                } else {\n                    if (!contactsCount) {\n                        hideContactsSearchResults(body);\n                    }\n\n                    if (!nonContactsCount) {\n                        hideNonContactsSearchResults(body);\n                    }\n                }\n\n                if (!messagesCount) {\n                    hideMessagesSearchResults(body);\n                }\n            }\n\n            return;\n        });\n    };\n\n\n    /**\n     * Listen to and handle events for searching.\n     *\n     * @param {Object} header Search header container element.\n     * @param {Object} body Search body container element.\n     */\n    var registerEventListeners = function(header, body) {\n        var loggedInUserId = getLoggedInUserId(body);\n        var searchInput = getSearchInput(header);\n        var searchText = '';\n        var messagesOffset = 0;\n        var usersOffset = 0;\n\n        var searchEventHandler = function(e, data) {\n            searchText = searchInput.val().trim();\n\n            if (searchText !== '') {\n                messagesOffset = 0;\n                usersOffset = 0;\n                search(\n                    header,\n                    body,\n                    searchText,\n                    USERS_INITIAL_SEARCH_LIMIT,\n                    usersOffset,\n                    MESSAGE_SEARCH_LIMIT,\n                    messagesOffset\n                )\n                .then(function() {\n                    searchInput.focus();\n                    usersOffset = usersOffset + USERS_INITIAL_SEARCH_LIMIT;\n                    messagesOffset = messagesOffset + MESSAGE_SEARCH_LIMIT;\n                    return;\n                })\n                .catch(Notification.exception);\n            }\n\n            data.originalEvent.preventDefault();\n        };\n\n        CustomEvents.define(searchInput, [CustomEvents.events.enter]);\n        CustomEvents.define(header, [CustomEvents.events.activate]);\n        CustomEvents.define(body, [CustomEvents.events.activate]);\n\n        searchInput.on(CustomEvents.events.enter, searchEventHandler);\n\n        header.on(CustomEvents.events.activate, SELECTORS.SEARCH_ACTION, searchEventHandler);\n\n        body.on(CustomEvents.events.activate, SELECTORS.LOAD_MORE_MESSAGES, function(e, data) {\n            if (searchText !== '') {\n                loadMoreMessages(body, loggedInUserId, searchText, MESSAGE_SEARCH_LIMIT, messagesOffset)\n                    .then(function() {\n                        messagesOffset = messagesOffset + MESSAGE_SEARCH_LIMIT;\n                        return;\n                    })\n                    .catch(Notification.exception);\n            }\n            data.originalEvent.preventDefault();\n        });\n\n        body.on(CustomEvents.events.activate, SELECTORS.LOAD_MORE_USERS, function(e, data) {\n            if (searchText !== '') {\n                loadMoreUsers(body, loggedInUserId, searchText, USERS_SEARCH_LIMIT, usersOffset)\n                    .then(function() {\n                        usersOffset = usersOffset + USERS_SEARCH_LIMIT;\n                        return;\n                    })\n                    .catch(Notification.exception);\n            }\n            data.originalEvent.preventDefault();\n        });\n\n        header.on(CustomEvents.events.activate, SELECTORS.CANCEL_SEARCH_BUTTON, function() {\n            clearSearchInput(header);\n            showEmptyMessage(body);\n            showSearchIcon(header);\n            hideSearchResults(body);\n            hideLoadingIcon(header);\n            hideLoadingPlaceholder(body);\n            usersOffset = 0;\n            messagesOffset = 0;\n        });\n\n        PubSub.subscribe(Events.CONTACT_ADDED, function(userId) {\n            addContact(body, userId);\n        });\n\n        PubSub.subscribe(Events.CONTACT_REMOVED, function(userId) {\n            removeContact(body, userId);\n        });\n\n        PubSub.subscribe(Events.CONTACT_BLOCKED, function(userId) {\n            blockContact(body, userId);\n        });\n\n        PubSub.subscribe(Events.CONTACT_UNBLOCKED, function(userId) {\n            unblockContact(body, userId);\n        });\n    };\n\n    /**\n     * Setup the search page.\n     *\n     * @param {string} namespace The route namespace.\n     * @param {Object} header Contacts header container element.\n     * @param {Object} body Contacts body container element.\n     * @return {Object} jQuery promise\n     */\n    var show = function(namespace, header, body) {\n        if (!body.attr('data-init')) {\n            registerEventListeners(header, body);\n            body.attr('data-init', true);\n        }\n        var searchInput = getSearchInput(header);\n        searchInput.focus();\n\n        return $.Deferred().resolve().promise();\n    };\n\n    /**\n     * String describing this page used for aria-labels.\n     *\n     * @param {string} namespace The route namespace.\n     * @param {Object} header Contacts header container element.\n     * @return {Object} jQuery promise\n     */\n    var description = function(namespace, header) {\n        if (typeof header !== 'object') {\n            return Str.get_string('messagedrawerviewsearch', 'core_message');\n        }\n        var searchInput = getSearchInput(header);\n        var searchText = searchInput.val().trim();\n        return Str.get_string('messagedrawerviewsearch', 'core_message', searchText);\n    };\n\n    return {\n        show: show,\n        description: description\n    };\n});\n"],"file":"message_drawer_view_search.min.js"}