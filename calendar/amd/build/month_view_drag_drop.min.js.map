{"version":3,"sources":["../src/month_view_drag_drop.js"],"names":["define","$","Notification","Str","CalendarEvents","DataStore","SELECTORS","ROOT","DRAGGABLE","DROP_ZONE","WEEK","INVALID_DROP_ZONE_CLASS","INVALID_HOVER_CLASS","VALID_HOVER_CLASS","ALL_CLASSES","registered","getDropZoneFromEvent","e","dropZone","target","closest","length","isValidDropZone","dropTimestamp","attr","minTimestart","getMinTimestart","maxTimestart","getMaxTimestart","getDropZoneError","getMinError","getMaxError","clearAllDropZonesState","find","each","index","removeClass","updateHoverState","hovered","count","getDurationDays","valid","addClass","nextDropZone","next","nextWeek","children","first","updateAllDropZonesState","dragstartHandler","draggableElement","eventElement","eventId","minError","maxError","eventsSelector","duration","setEventId","setDurationDays","setMinTimestart","setMaxTimestart","setMinError","setMaxError","dataTransfer","effectAllowed","dropEffect","setData","dragoverHandler","hasEventId","preventDefault","dragleaveHandler","dropHandler","clearAll","getEventId","eventElementSelector","origin","trigger","moveEvent","message","get_string","then","string","exception","name","dragendHandler","calendarMonthChangedHandler","init","document","addEventListener","on","monthChanged"],"mappings":"AAuBAA,OAAM,sCAAC,CACK,QADL,CAEK,mBAFL,CAGK,UAHL,CAIK,sBAJL,CAKK,oCALL,CAAD,CAOE,SACIC,CADJ,CAEIC,YAFJ,CAGIC,GAHJ,CAIIC,cAJJ,CAKIC,SALJ,CAME,IAEFC,CAAAA,SAAS,CAAG,CACZC,IAAI,CAAE,0BADM,CAEZC,SAAS,CAAE,kDAFC,CAGZC,SAAS,CAAE,qCAHC,CAIZC,IAAI,CAAE,mCAJM,CAFV,CAQFC,uBAAuB,CAAG,UARxB,CASFC,mBAAmB,CAAG,sBATpB,CAUFC,iBAAiB,CAAG,uBAVlB,CAWFC,WAAW,CAAGH,uBAAuB,CAAG,GAA1B,CAAgCC,mBAAhC,CAAsD,GAAtD,CAA4DC,iBAXxE,CAaFE,UAAU,GAbR,CAsBFC,oBAAoB,CAAG,SAASC,CAAT,CAAY,CACnC,GAAIC,CAAAA,QAAQ,CAAGjB,CAAC,CAACgB,CAAC,CAACE,MAAH,CAAD,CAAYC,OAAZ,CAAoBd,SAAS,CAACG,SAA9B,CAAf,CACA,MAAQS,CAAAA,QAAQ,CAACG,MAAV,CAAoBH,QAApB,CAA+B,IACzC,CAzBK,CAqCFI,eAAe,CAAG,SAASJ,QAAT,CAAmB,IACjCK,CAAAA,aAAa,CAAGL,QAAQ,CAACM,IAAT,CAAc,oBAAd,CADiB,CAEjCC,YAAY,CAAGpB,SAAS,CAACqB,eAAV,EAFkB,CAGjCC,YAAY,CAAGtB,SAAS,CAACuB,eAAV,EAHkB,CAKrC,GAAIH,YAAY,EAAIA,YAAY,CAAGF,aAAnC,CAAkD,CAC9C,QACH,CAED,GAAII,YAAY,EAAIA,YAAY,CAAGJ,aAAnC,CAAkD,CAC9C,QACH,CAED,QACH,CAnDK,CA4DFM,gBAAgB,CAAG,SAASX,QAAT,CAAmB,IAClCK,CAAAA,aAAa,CAAGL,QAAQ,CAACM,IAAT,CAAc,oBAAd,CADkB,CAElCC,YAAY,CAAGpB,SAAS,CAACqB,eAAV,EAFmB,CAGlCC,YAAY,CAAGtB,SAAS,CAACuB,eAAV,EAHmB,CAKtC,GAAIH,YAAY,EAAIA,YAAY,CAAGF,aAAnC,CAAkD,CAC9C,MAAOlB,CAAAA,SAAS,CAACyB,WAAV,EACV,CAED,GAAIH,YAAY,EAAIA,YAAY,CAAGJ,aAAnC,CAAkD,CAC9C,MAAOlB,CAAAA,SAAS,CAAC0B,WAAV,EACV,CAED,MAAO,KACV,CA1EK,CA+EFC,sBAAsB,CAAG,UAAW,CACpC/B,CAAC,CAACK,SAAS,CAACC,IAAX,CAAD,CAAkB0B,IAAlB,CAAuB3B,SAAS,CAACG,SAAjC,EAA4CyB,IAA5C,CAAiD,SAASC,KAAT,CAAgBjB,QAAhB,CAA0B,CACvEA,QAAQ,CAAGjB,CAAC,CAACiB,QAAD,CAAZ,CACAA,QAAQ,CAACkB,WAAT,CAAqBtB,WAArB,CACH,CAHD,CAIH,CApFK,CA2GFuB,gBAAgB,CAAG,SAASnB,QAAT,CAAmBoB,OAAnB,CAA4BC,KAA5B,CAAmC,CACtD,GAAqB,WAAjB,QAAOA,CAAAA,KAAX,CAAkC,CAE9BA,KAAK,CAAGlC,SAAS,CAACmC,eAAV,EACX,CAED,GAAIC,CAAAA,KAAK,CAAGnB,eAAe,CAACJ,QAAD,CAA3B,CACAA,QAAQ,CAACkB,WAAT,CAAqBtB,WAArB,EAEA,GAAIwB,OAAJ,CAAa,CAET,GAAIG,KAAJ,CAAW,CACPvB,QAAQ,CAACwB,QAAT,CAAkB7B,iBAAlB,CACH,CAFD,IAEO,CACHK,QAAQ,CAACwB,QAAT,CAAkB9B,mBAAlB,CACH,CACJ,CAPD,IAOO,CACHM,QAAQ,CAACkB,WAAT,CAAqBvB,iBAAiB,CAAG,GAApB,CAA0BD,mBAA/C,EAEA,GAAI,CAAC6B,KAAL,CAAY,CACRvB,QAAQ,CAACwB,QAAT,CAAkB/B,uBAAlB,CACH,CACJ,CAED4B,KAAK,GAIL,GAAY,CAAR,CAAAA,KAAJ,CAAe,CACX,GAAII,CAAAA,YAAY,CAAGzB,QAAQ,CAAC0B,IAAT,EAAnB,CAIA,GAAI,CAACD,YAAY,CAACtB,MAAlB,CAA0B,CACtB,GAAIwB,CAAAA,QAAQ,CAAG3B,QAAQ,CAACE,OAAT,CAAiBd,SAAS,CAACI,IAA3B,EAAiCkC,IAAjC,EAAf,CAEA,GAAIC,QAAQ,CAACxB,MAAb,CAAqB,CACjBsB,YAAY,CAAGE,QAAQ,CAACC,QAAT,CAAkBxC,SAAS,CAACG,SAA5B,EAAuCsC,KAAvC,EAClB,CACJ,CAID,GAAIJ,YAAY,CAACtB,MAAjB,CAAyB,CACrBgB,gBAAgB,CAACM,YAAD,CAAeL,OAAf,CAAwBC,KAAxB,CACnB,CACJ,CACJ,CA1JK,CAgKFS,uBAAuB,CAAG,UAAW,CACrC/C,CAAC,CAACK,SAAS,CAACC,IAAX,CAAD,CAAkB0B,IAAlB,CAAuB3B,SAAS,CAACG,SAAjC,EAA4CyB,IAA5C,CAAiD,SAASC,KAAT,CAAgBjB,QAAhB,CAA0B,CACvEA,QAAQ,CAAGjB,CAAC,CAACiB,QAAD,CAAZ,CAEA,GAAI,CAACI,eAAe,CAACJ,QAAD,CAApB,CAAgC,CAC5BmB,gBAAgB,CAACnB,QAAD,IACnB,CACJ,CAND,CAOH,CAxKK,CAiLF+B,gBAAgB,CAAG,SAAShC,CAAT,CAAY,IAC3BE,CAAAA,MAAM,CAAGlB,CAAC,CAACgB,CAAC,CAACE,MAAH,CADiB,CAE3B+B,gBAAgB,CAAG/B,MAAM,CAACC,OAAP,CAAed,SAAS,CAACE,SAAzB,CAFQ,CAI/B,GAAI,CAAC0C,gBAAgB,CAAC7B,MAAtB,CAA8B,CAC1B,MACH,CAN8B,GAQ3B8B,CAAAA,YAAY,CAAGD,gBAAgB,CAACjB,IAAjB,CAAsB,iBAAtB,CARY,CAS3BmB,OAAO,CAAGD,YAAY,CAAC3B,IAAb,CAAkB,eAAlB,CATiB,CAU3BC,YAAY,CAAGyB,gBAAgB,CAAC1B,IAAjB,CAAsB,wBAAtB,CAVY,CAW3BG,YAAY,CAAGuB,gBAAgB,CAAC1B,IAAjB,CAAsB,wBAAtB,CAXY,CAY3B6B,QAAQ,CAAGH,gBAAgB,CAAC1B,IAAjB,CAAsB,oBAAtB,CAZgB,CAa3B8B,QAAQ,CAAGJ,gBAAgB,CAAC1B,IAAjB,CAAsB,oBAAtB,CAbgB,CAc3B+B,cAAc,CAAGjD,SAAS,CAACC,IAAV,CAAiB,oBAAjB,CAAuC6C,OAAvC,CAAiD,KAdvC,CAe3BI,QAAQ,CAAGvD,CAAC,CAACsD,cAAD,CAAD,CAAkBlC,MAfF,CAiB/BhB,SAAS,CAACoD,UAAV,CAAqBL,OAArB,EACA/C,SAAS,CAACqD,eAAV,CAA0BF,QAA1B,EAEA,GAAI/B,YAAJ,CAAkB,CACdpB,SAAS,CAACsD,eAAV,CAA0BlC,YAA1B,CACH,CAED,GAAIE,YAAJ,CAAkB,CACdtB,SAAS,CAACuD,eAAV,CAA0BjC,YAA1B,CACH,CAED,GAAI0B,QAAJ,CAAc,CACVhD,SAAS,CAACwD,WAAV,CAAsBR,QAAtB,CACH,CAED,GAAIC,QAAJ,CAAc,CACVjD,SAAS,CAACyD,WAAV,CAAsBR,QAAtB,CACH,CAEDrC,CAAC,CAAC8C,YAAF,CAAeC,aAAf,CAA+B,MAA/B,CACA/C,CAAC,CAAC8C,YAAF,CAAeE,UAAf,CAA4B,MAA5B,CAGAhD,CAAC,CAAC8C,YAAF,CAAeG,OAAf,CAAuB,YAAvB,CAAqCd,OAArC,EACAnC,CAAC,CAACgD,UAAF,CAAe,MAAf,CAEAjB,uBAAuB,EAC1B,CA7NK,CAwOFmB,eAAe,CAAG,SAASlD,CAAT,CAAY,CAE9B,GAAI,CAACZ,SAAS,CAAC+D,UAAV,EAAL,CAA6B,CACzB,MACH,CAEDnD,CAAC,CAACoD,cAAF,GAEA,GAAInD,CAAAA,QAAQ,CAAGF,oBAAoB,CAACC,CAAD,CAAnC,CAEA,GAAI,CAACC,QAAL,CAAe,CACX,MACH,CAEDmB,gBAAgB,CAACnB,QAAD,IACnB,CAvPK,CAkQFoD,gBAAgB,CAAG,SAASrD,CAAT,CAAY,CAE/B,GAAI,CAACZ,SAAS,CAAC+D,UAAV,EAAL,CAA6B,CACzB,MACH,CAED,GAAIlD,CAAAA,QAAQ,CAAGF,oBAAoB,CAACC,CAAD,CAAnC,CAEA,GAAI,CAACC,QAAL,CAAe,CACX,MACH,CAEDmB,gBAAgB,CAACnB,QAAD,IAAhB,CACAD,CAAC,CAACoD,cAAF,EACH,CAhRK,CA6RFE,WAAW,CAAG,SAAStD,CAAT,CAAY,CAE1B,GAAI,CAACZ,SAAS,CAAC+D,UAAV,EAAL,CAA6B,CACzB,MACH,CAED,GAAIlD,CAAAA,QAAQ,CAAGF,oBAAoB,CAACC,CAAD,CAAnC,CAEA,GAAI,CAACC,QAAL,CAAe,CACXb,SAAS,CAACmE,QAAV,GACAxC,sBAAsB,GACtB,MACH,CAED,GAAIV,eAAe,CAACJ,QAAD,CAAnB,CAA+B,IACvBkC,CAAAA,OAAO,CAAG/C,SAAS,CAACoE,UAAV,EADa,CAEvBC,oBAAoB,CAAGpE,SAAS,CAACC,IAAV,CAAiB,oBAAjB,CAAuC6C,OAAvC,CAAiD,KAFjD,CAGvBD,YAAY,CAAGlD,CAAC,CAACyE,oBAAD,CAHO,CAIvBC,MAAM,CAAG,IAJc,CAM3B,GAAIxB,YAAY,CAAC9B,MAAjB,CAAyB,CACrBsD,MAAM,CAAGxB,YAAY,CAAC/B,OAAb,CAAqBd,SAAS,CAACG,SAA/B,CACZ,CAEDR,CAAC,CAAC,MAAD,CAAD,CAAU2E,OAAV,CAAkBxE,cAAc,CAACyE,SAAjC,CAA4C,CAACzB,OAAD,CAAUuB,MAAV,CAAkBzD,QAAlB,CAA5C,CACH,CAXD,IAWO,CAGH,GAAI4D,CAAAA,OAAO,CAAGjD,gBAAgB,CAACX,QAAD,CAA9B,CACAf,GAAG,CAAC4E,UAAJ,CAAe,kBAAf,CAAmC,UAAnC,EAA+CC,IAA/C,CAAoD,SAASC,MAAT,CAAiB,CACjE/E,YAAY,CAACgF,SAAb,CAAuB,CACnBC,IAAI,CAAEF,MADa,CAEnBH,OAAO,CAAEA,OAAO,EAAIG,MAFD,CAAvB,CAIH,CALD,CAMH,CAED5E,SAAS,CAACmE,QAAV,GACAxC,sBAAsB,GAEtBf,CAAC,CAACoD,cAAF,EACH,CAtUK,CA4UFe,cAAc,CAAG,UAAW,CAC5B/E,SAAS,CAACmE,QAAV,GACAxC,sBAAsB,EACzB,CA/UK,CAsVFqD,2BAA2B,CAAG,UAAW,CACzCrC,uBAAuB,EAC1B,CAxVK,CA0VN,MAAO,CAIHsC,IAAI,CAAE,eAAW,CACb,GAAI,CAACvE,UAAL,CAAiB,CAKbwE,QAAQ,CAACC,gBAAT,CAA0B,WAA1B,CAAuCvC,gBAAvC,KACAsC,QAAQ,CAACC,gBAAT,CAA0B,UAA1B,CAAsCrB,eAAtC,KACAoB,QAAQ,CAACC,gBAAT,CAA0B,WAA1B,CAAuClB,gBAAvC,KACAiB,QAAQ,CAACC,gBAAT,CAA0B,MAA1B,CAAkCjB,WAAlC,KACAgB,QAAQ,CAACC,gBAAT,CAA0B,SAA1B,CAAqCJ,cAArC,KACAnF,CAAC,CAAC,MAAD,CAAD,CAAUwF,EAAV,CAAarF,cAAc,CAACsF,YAA5B,CAA0CL,2BAA1C,EACAtE,UAAU,GACb,CACJ,CAlBE,CAoBV,CA3XK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to handle calendar drag and drop in the calendar\n * month view.\n *\n * @module     core_calendar/month_view_drag_drop\n * @copyright  2017 Ryan Wyllie <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n            'jquery',\n            'core/notification',\n            'core/str',\n            'core_calendar/events',\n            'core_calendar/drag_drop_data_store'\n        ],\n        function(\n            $,\n            Notification,\n            Str,\n            CalendarEvents,\n            DataStore\n        ) {\n\n    var SELECTORS = {\n        ROOT: \"[data-region='calendar']\",\n        DRAGGABLE: '[draggable=\"true\"][data-region=\"event-item\"]',\n        DROP_ZONE: '[data-drop-zone=\"month-view-day\"]',\n        WEEK: '[data-region=\"month-view-week\"]',\n    };\n    var INVALID_DROP_ZONE_CLASS = 'bg-faded';\n    var INVALID_HOVER_CLASS = 'bg-danger text-white';\n    var VALID_HOVER_CLASS = 'bg-primary text-white';\n    var ALL_CLASSES = INVALID_DROP_ZONE_CLASS + ' ' + INVALID_HOVER_CLASS + ' ' + VALID_HOVER_CLASS;\n    /* @var {bool} registered If the event listeners have been added */\n    var registered = false;\n\n    /**\n     * Get the correct drop zone element from the given javascript\n     * event.\n     *\n     * @param {event} e The javascript event\n     * @return {object|null}\n     */\n    var getDropZoneFromEvent = function(e) {\n        var dropZone = $(e.target).closest(SELECTORS.DROP_ZONE);\n        return (dropZone.length) ? dropZone : null;\n    };\n\n    /**\n     * Determine if the given dropzone element is within the acceptable\n     * time range.\n     *\n     * The drop zone timestamp is midnight on that day so we should check\n     * that the event's acceptable timestart value\n     *\n     * @param {object} dropZone The drop zone day from the calendar\n     * @return {bool}\n     */\n    var isValidDropZone = function(dropZone) {\n        var dropTimestamp = dropZone.attr('data-day-timestamp');\n        var minTimestart = DataStore.getMinTimestart();\n        var maxTimestart = DataStore.getMaxTimestart();\n\n        if (minTimestart && minTimestart > dropTimestamp) {\n            return false;\n        }\n\n        if (maxTimestart && maxTimestart < dropTimestamp) {\n            return false;\n        }\n\n        return true;\n    };\n\n    /**\n     * Get the error string to display for a given drop zone element\n     * if it is invalid.\n     *\n     * @param {object} dropZone The drop zone day from the calendar\n     * @return {string}\n     */\n    var getDropZoneError = function(dropZone) {\n        var dropTimestamp = dropZone.attr('data-day-timestamp');\n        var minTimestart = DataStore.getMinTimestart();\n        var maxTimestart = DataStore.getMaxTimestart();\n\n        if (minTimestart && minTimestart > dropTimestamp) {\n            return DataStore.getMinError();\n        }\n\n        if (maxTimestart && maxTimestart < dropTimestamp) {\n            return DataStore.getMaxError();\n        }\n\n        return null;\n    };\n\n    /**\n     * Remove all of the styling from each of the drop zones in the calendar.\n     */\n    var clearAllDropZonesState = function() {\n        $(SELECTORS.ROOT).find(SELECTORS.DROP_ZONE).each(function(index, dropZone) {\n            dropZone = $(dropZone);\n            dropZone.removeClass(ALL_CLASSES);\n        });\n    };\n\n    /**\n     * Update the hover state for the event in the calendar to reflect\n     * which days the event will be moved to.\n     *\n     * If the drop zone is not being hovered then it will apply some\n     * styling to reflect whether the drop zone is a valid or invalid\n     * drop place for the current dragging event.\n     *\n     * This funciton supports events spanning multiple days and will\n     * recurse to highlight (or remove highlight) each of the days\n     * that the event will be moved to.\n     *\n     * For example: An event with a duration of 3 days will have\n     * 3 days highlighted when it's dragged elsewhere in the calendar.\n     * The current drag target and the 2 days following it (including\n     * wrapping to the next week if necessary).\n     *\n     * @param {string|object} dropZone The drag target element\n     * @param {bool} hovered If the target is hovered or not\n     * @param {Number} count How many days to highlight (default to duration)\n     */\n    var updateHoverState = function(dropZone, hovered, count) {\n        if (typeof count === 'undefined') {\n            // This is how many days we need to highlight.\n            count = DataStore.getDurationDays();\n        }\n\n        var valid = isValidDropZone(dropZone);\n        dropZone.removeClass(ALL_CLASSES);\n\n        if (hovered) {\n\n            if (valid) {\n                dropZone.addClass(VALID_HOVER_CLASS);\n            } else {\n                dropZone.addClass(INVALID_HOVER_CLASS);\n            }\n        } else {\n            dropZone.removeClass(VALID_HOVER_CLASS + ' ' + INVALID_HOVER_CLASS);\n\n            if (!valid) {\n                dropZone.addClass(INVALID_DROP_ZONE_CLASS);\n            }\n        }\n\n        count--;\n\n        // If we've still got days to highlight then we should\n        // find the next day.\n        if (count > 0) {\n            var nextDropZone = dropZone.next();\n\n            // If there are no more days in this week then we\n            // need to move down to the next week in the calendar.\n            if (!nextDropZone.length) {\n                var nextWeek = dropZone.closest(SELECTORS.WEEK).next();\n\n                if (nextWeek.length) {\n                    nextDropZone = nextWeek.children(SELECTORS.DROP_ZONE).first();\n                }\n            }\n\n            // If we found another day then let's recursively\n            // update it's hover state.\n            if (nextDropZone.length) {\n                updateHoverState(nextDropZone, hovered, count);\n            }\n        }\n    };\n\n    /**\n     * Find all of the calendar event drop zones in the calendar and update the display\n     * for the user to indicate which zones are valid and invalid.\n     */\n    var updateAllDropZonesState = function() {\n        $(SELECTORS.ROOT).find(SELECTORS.DROP_ZONE).each(function(index, dropZone) {\n            dropZone = $(dropZone);\n\n            if (!isValidDropZone(dropZone)) {\n                updateHoverState(dropZone, false);\n            }\n        });\n    };\n\n\n    /**\n     * Set up the module level variables to track which event is being\n     * dragged and how many days it spans.\n     *\n     * @param {event} e The dragstart event\n     */\n    var dragstartHandler = function(e) {\n        var target = $(e.target);\n        var draggableElement = target.closest(SELECTORS.DRAGGABLE);\n\n        if (!draggableElement.length) {\n            return;\n        }\n\n        var eventElement = draggableElement.find('[data-event-id]');\n        var eventId = eventElement.attr('data-event-id');\n        var minTimestart = draggableElement.attr('data-min-day-timestamp');\n        var maxTimestart = draggableElement.attr('data-max-day-timestamp');\n        var minError = draggableElement.attr('data-min-day-error');\n        var maxError = draggableElement.attr('data-max-day-error');\n        var eventsSelector = SELECTORS.ROOT + ' [data-event-id=\"' + eventId + '\"]';\n        var duration = $(eventsSelector).length;\n\n        DataStore.setEventId(eventId);\n        DataStore.setDurationDays(duration);\n\n        if (minTimestart) {\n            DataStore.setMinTimestart(minTimestart);\n        }\n\n        if (maxTimestart) {\n            DataStore.setMaxTimestart(maxTimestart);\n        }\n\n        if (minError) {\n            DataStore.setMinError(minError);\n        }\n\n        if (maxError) {\n            DataStore.setMaxError(maxError);\n        }\n\n        e.dataTransfer.effectAllowed = \"move\";\n        e.dataTransfer.dropEffect = \"move\";\n        // Firefox requires a value to be set here or the drag won't\n        // work and the dragover handler won't fire.\n        e.dataTransfer.setData('text/plain', eventId);\n        e.dropEffect = \"move\";\n\n        updateAllDropZonesState();\n    };\n\n    /**\n     * Update the hover state of the target day element when\n     * the user is dragging an event over it.\n     *\n     * This will add a visual indicator to the calendar UI to\n     * indicate which day(s) the event will be moved to.\n     *\n     * @param {event} e The dragstart event\n     */\n    var dragoverHandler = function(e) {\n        // Ignore dragging of non calendar events.\n        if (!DataStore.hasEventId()) {\n            return;\n        }\n\n        e.preventDefault();\n\n        var dropZone = getDropZoneFromEvent(e);\n\n        if (!dropZone) {\n            return;\n        }\n\n        updateHoverState(dropZone, true);\n    };\n\n    /**\n     * Update the hover state of the target day element that was\n     * previously dragged over but has is no longer a drag target.\n     *\n     * This will remove the visual indicator from the calendar UI\n     * that was added by the dragoverHandler.\n     *\n     * @param {event} e The dragstart event\n     */\n    var dragleaveHandler = function(e) {\n        // Ignore dragging of non calendar events.\n        if (!DataStore.hasEventId()) {\n            return;\n        }\n\n        var dropZone = getDropZoneFromEvent(e);\n\n        if (!dropZone) {\n            return;\n        }\n\n        updateHoverState(dropZone, false);\n        e.preventDefault();\n    };\n\n    /**\n     * Determines the event element, origin day, and destination day\n     * once the user drops the calendar event. These three bits of data\n     * are provided as the payload to the \"moveEvent\" calendar javascript\n     * event that is fired.\n     *\n     * This will remove the visual indicator from the calendar UI\n     * that was added by the dragoverHandler.\n     *\n     * @param {event} e The dragstart event\n     */\n    var dropHandler = function(e) {\n        // Ignore dragging of non calendar events.\n        if (!DataStore.hasEventId()) {\n            return;\n        }\n\n        var dropZone = getDropZoneFromEvent(e);\n\n        if (!dropZone) {\n            DataStore.clearAll();\n            clearAllDropZonesState();\n            return;\n        }\n\n        if (isValidDropZone(dropZone)) {\n            var eventId = DataStore.getEventId();\n            var eventElementSelector = SELECTORS.ROOT + ' [data-event-id=\"' + eventId + '\"]';\n            var eventElement = $(eventElementSelector);\n            var origin = null;\n\n            if (eventElement.length) {\n                origin = eventElement.closest(SELECTORS.DROP_ZONE);\n            }\n\n            $('body').trigger(CalendarEvents.moveEvent, [eventId, origin, dropZone]);\n        } else {\n            // If the drop zone is not valid then there is not need for us to\n            // try to process it. Instead we can just show an error to the user.\n            var message = getDropZoneError(dropZone);\n            Str.get_string('errorinvaliddate', 'calendar').then(function(string) {\n                Notification.exception({\n                    name: string,\n                    message: message || string\n                });\n            });\n        }\n\n        DataStore.clearAll();\n        clearAllDropZonesState();\n\n        e.preventDefault();\n    };\n\n    /**\n     * Clear the data store and remove the drag indicators from the UI\n     * when the drag event has finished.\n     */\n    var dragendHandler = function() {\n        DataStore.clearAll();\n        clearAllDropZonesState();\n    };\n\n    /**\n     * Re-render the drop zones in the new month to highlight\n     * which areas are or aren't acceptable to drop the calendar\n     * event.\n     */\n    var calendarMonthChangedHandler = function() {\n        updateAllDropZonesState();\n    };\n\n    return {\n        /**\n         * Initialise the event handlers for the drag events.\n         */\n        init: function() {\n            if (!registered) {\n                // These handlers are only added the first time the module\n                // is loaded because we don't want to have a new listener\n                // added each time the \"init\" function is called otherwise we'll\n                // end up with lots of stale handlers.\n                document.addEventListener('dragstart', dragstartHandler, false);\n                document.addEventListener('dragover', dragoverHandler, false);\n                document.addEventListener('dragleave', dragleaveHandler, false);\n                document.addEventListener('drop', dropHandler, false);\n                document.addEventListener('dragend', dragendHandler, false);\n                $('body').on(CalendarEvents.monthChanged, calendarMonthChangedHandler);\n                registered = true;\n            }\n        },\n    };\n});\n"],"file":"month_view_drag_drop.min.js"}