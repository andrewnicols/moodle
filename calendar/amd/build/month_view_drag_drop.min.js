define ("core_calendar/month_view_drag_drop",["jquery","core/notification","core/str","core_calendar/events","core_calendar/drag_drop_data_store"],function($,Notification,Str,CalendarEvents,DataStore){var SELECTORS={ROOT:"[data-region='calendar']",DRAGGABLE:"[draggable=\"true\"][data-region=\"event-item\"]",DROP_ZONE:"[data-drop-zone=\"month-view-day\"]",WEEK:"[data-region=\"month-view-week\"]"},INVALID_DROP_ZONE_CLASS="bg-faded",INVALID_HOVER_CLASS="bg-danger text-white",VALID_HOVER_CLASS="bg-primary text-white",ALL_CLASSES=INVALID_DROP_ZONE_CLASS+" "+INVALID_HOVER_CLASS+" "+VALID_HOVER_CLASS,registered=!1,getDropZoneFromEvent=function(e){var dropZone=$(e.target).closest(SELECTORS.DROP_ZONE);return dropZone.length?dropZone:null},isValidDropZone=function(dropZone){var dropTimestamp=dropZone.attr("data-day-timestamp"),minTimestart=DataStore.getMinTimestart(),maxTimestart=DataStore.getMaxTimestart();if(minTimestart&&minTimestart>dropTimestamp){return!1}if(maxTimestart&&maxTimestart<dropTimestamp){return!1}return!0},getDropZoneError=function(dropZone){var dropTimestamp=dropZone.attr("data-day-timestamp"),minTimestart=DataStore.getMinTimestart(),maxTimestart=DataStore.getMaxTimestart();if(minTimestart&&minTimestart>dropTimestamp){return DataStore.getMinError()}if(maxTimestart&&maxTimestart<dropTimestamp){return DataStore.getMaxError()}return null},clearAllDropZonesState=function(){$(SELECTORS.ROOT).find(SELECTORS.DROP_ZONE).each(function(index,dropZone){dropZone=$(dropZone);dropZone.removeClass(ALL_CLASSES)})},updateHoverState=function(dropZone,hovered,count){if("undefined"==typeof count){count=DataStore.getDurationDays()}var valid=isValidDropZone(dropZone);dropZone.removeClass(ALL_CLASSES);if(hovered){if(valid){dropZone.addClass(VALID_HOVER_CLASS)}else{dropZone.addClass(INVALID_HOVER_CLASS)}}else{dropZone.removeClass(VALID_HOVER_CLASS+" "+INVALID_HOVER_CLASS);if(!valid){dropZone.addClass(INVALID_DROP_ZONE_CLASS)}}count--;if(0<count){var nextDropZone=dropZone.next();if(!nextDropZone.length){var nextWeek=dropZone.closest(SELECTORS.WEEK).next();if(nextWeek.length){nextDropZone=nextWeek.children(SELECTORS.DROP_ZONE).first()}}if(nextDropZone.length){updateHoverState(nextDropZone,hovered,count)}}},updateAllDropZonesState=function(){$(SELECTORS.ROOT).find(SELECTORS.DROP_ZONE).each(function(index,dropZone){dropZone=$(dropZone);if(!isValidDropZone(dropZone)){updateHoverState(dropZone,!1)}})},dragstartHandler=function(e){var target=$(e.target),draggableElement=target.closest(SELECTORS.DRAGGABLE);if(!draggableElement.length){return}var eventElement=draggableElement.find("[data-event-id]"),eventId=eventElement.attr("data-event-id"),minTimestart=draggableElement.attr("data-min-day-timestamp"),maxTimestart=draggableElement.attr("data-max-day-timestamp"),minError=draggableElement.attr("data-min-day-error"),maxError=draggableElement.attr("data-max-day-error"),eventsSelector=SELECTORS.ROOT+" [data-event-id=\""+eventId+"\"]",duration=$(eventsSelector).length;DataStore.setEventId(eventId);DataStore.setDurationDays(duration);if(minTimestart){DataStore.setMinTimestart(minTimestart)}if(maxTimestart){DataStore.setMaxTimestart(maxTimestart)}if(minError){DataStore.setMinError(minError)}if(maxError){DataStore.setMaxError(maxError)}e.dataTransfer.effectAllowed="move";e.dataTransfer.dropEffect="move";e.dataTransfer.setData("text/plain",eventId);e.dropEffect="move";updateAllDropZonesState()},dragoverHandler=function(e){if(!DataStore.hasEventId()){return}e.preventDefault();var dropZone=getDropZoneFromEvent(e);if(!dropZone){return}updateHoverState(dropZone,!0)},dragleaveHandler=function(e){if(!DataStore.hasEventId()){return}var dropZone=getDropZoneFromEvent(e);if(!dropZone){return}updateHoverState(dropZone,!1);e.preventDefault()},dropHandler=function(e){if(!DataStore.hasEventId()){return}var dropZone=getDropZoneFromEvent(e);if(!dropZone){DataStore.clearAll();clearAllDropZonesState();return}if(isValidDropZone(dropZone)){var eventId=DataStore.getEventId(),eventElementSelector=SELECTORS.ROOT+" [data-event-id=\""+eventId+"\"]",eventElement=$(eventElementSelector),origin=null;if(eventElement.length){origin=eventElement.closest(SELECTORS.DROP_ZONE)}$("body").trigger(CalendarEvents.moveEvent,[eventId,origin,dropZone])}else{var message=getDropZoneError(dropZone);Str.get_string("errorinvaliddate","calendar").then(function(string){Notification.exception({name:string,message:message||string})})}DataStore.clearAll();clearAllDropZonesState();e.preventDefault()},dragendHandler=function(){DataStore.clearAll();clearAllDropZonesState()},calendarMonthChangedHandler=function(){updateAllDropZonesState()};return{init:function init(){if(!registered){document.addEventListener("dragstart",dragstartHandler,!1);document.addEventListener("dragover",dragoverHandler,!1);document.addEventListener("dragleave",dragleaveHandler,!1);document.addEventListener("drop",dropHandler,!1);document.addEventListener("dragend",dragendHandler,!1);$("body").on(CalendarEvents.monthChanged,calendarMonthChangedHandler);registered=!0}}}});
//# sourceMappingURL=month_view_drag_drop.min.js.map
