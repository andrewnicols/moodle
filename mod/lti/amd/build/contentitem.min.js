define ("mod_lti/contentitem",["jquery","core/notification","core/str","core/templates","mod_lti/form-field","core/modal_factory","core/modal_events"],function($,notification,str,templates,FormField,ModalFactory,ModalEvents){var dialogue,doneCallback,ltiFormFields=[new FormField("name",FormField.TYPES.TEXT,!1,""),new FormField("introeditor",FormField.TYPES.EDITOR,!1,""),new FormField("toolurl",FormField.TYPES.TEXT,!0,""),new FormField("securetoolurl",FormField.TYPES.TEXT,!0,""),new FormField("instructorchoiceacceptgrades",FormField.TYPES.CHECKBOX,!0,!0),new FormField("instructorchoicesendname",FormField.TYPES.CHECKBOX,!0,!0),new FormField("instructorchoicesendemailaddr",FormField.TYPES.CHECKBOX,!0,!0),new FormField("instructorcustomparameters",FormField.TYPES.TEXT,!0,""),new FormField("icon",FormField.TYPES.TEXT,!0,""),new FormField("secureicon",FormField.TYPES.TEXT,!0,""),new FormField("launchcontainer",FormField.TYPES.SELECT,!0,0),new FormField("grade_modgrade_point",FormField.TYPES.TEXT,!1,""),new FormField("lineitemresourceid",FormField.TYPES.TEXT,!0,""),new FormField("lineitemtag",FormField.TYPES.TEXT,!0,"")];const hideElement=e=>{e.setAttribute("hidden","true");e.setAttribute("aria-hidden","true");e.setAttribute("tab-index","-1")},showElement=e=>{e.removeAttribute("hidden");e.setAttribute("aria-hidden","false");e.setAttribute("tab-index","1")},showMultipleSummaryAndHideForm=async function(items){const form=document.querySelector("#region-main-box form"),toolArea=form.querySelector("[data-attribute=\"dynamic-import\"]"),buttonGroup=form.querySelector("#fgroup_id_buttonar"),submitAndLaunch=form.querySelector("#id_submitbutton");Array.from(form.children).forEach(hideElement);hideElement(submitAndLaunch);const{html,js}=await templates.renderForPromise("mod_lti/tool_deeplinking_results",{items:items});await templates.replaceNodeContents(toolArea,html,js);showElement(toolArea);showElement(buttonGroup)};var configToVariant=config=>{const variant={};["name","toolurl","securetoolurl","instructorcustomparameters","icon","secureicon","launchcontainer","lineitemresourceid","lineitemtag"].forEach(function(name){variant[name]=config[name]||""});variant["introeditor[text]"]=config.introeditor?config.introeditor.text:"";variant["introeditor[format]"]=config.introeditor?config.introeditor.format:"";if(1===config.instructorchoiceacceptgrades){variant.instructorchoiceacceptgrades="1";variant["grade[modgrade_point]"]=config.grade_modgrade_point||"100"}else{variant.instructorchoiceacceptgrades="0"}return variant};window.processContentItemReturnData=function(returnData){if(dialogue){dialogue.hide()}if(returnData.multiple){for(var index in ltiFormFields){ltiFormFields[index].setFieldValue("name"===ltiFormFields[index].name?"item":null)}var variants=[];returnData.multiple.forEach(function(v){variants.push(configToVariant(v))});showMultipleSummaryAndHideForm(returnData.multiple);const submitAndCourse=document.querySelector("#id_submitbutton2");submitAndCourse.onclick=e=>{e.preventDefault();submitAndCourse.disabled=!0;const fd=new FormData(document.querySelector("form.mform")),backToCourse=()=>{document.querySelector("#id_cancel").click()};variants.reduce((promise,variant)=>{Object.entries(variant).forEach(entry=>fd.set(entry[0],entry[1]));const body=new URLSearchParams(fd),doPost=()=>fetch(document.location.pathname,{method:"post",body});return promise.then(doPost).catch(doPost)},Promise.resolve()).then(backToCourse).catch(backToCourse)}}else{for(index in ltiFormFields){var field=ltiFormFields[index],value=null;if("undefined"!=typeof returnData[field.name]){value=returnData[field.name]}field.setFieldValue(value)}field.setFieldValue(value)}if(doneCallback){doneCallback(returnData)}};return{init:function(url,postData,cb){doneCallback=cb;var bodyPromise=templates.render("mod_lti/contentitem",{url:url,postData:postData});if(dialogue){dialogue.setBody(bodyPromise);dialogue.show();return}str.get_string("selectcontent","lti").then(function(title){return ModalFactory.create({title:title,body:bodyPromise,large:!0})}).then(function(modal){dialogue=modal;modal.getRoot().on(ModalEvents.hidden,function(){modal.setBody("");notification.fetchNotifications()});modal.show()}).catch(notification.exception)}}});
//# sourceMappingURL=contentitem.min.js.map
