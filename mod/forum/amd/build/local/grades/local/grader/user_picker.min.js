define ("mod_forum/local/grades/local/grader/user_picker",["exports","core/templates","./user_picker/selectors","core/str"],function(_exports,_templates,_selectors,_str){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.default=void 0;_templates=_interopRequireDefault(_templates);_selectors=_interopRequireDefault(_selectors);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1,source;i<arguments.length;i++){source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0})}else{obj[key]=value}return obj}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor)n=o.constructor.name;if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(null==len||len>arr.length)len=arr.length;for(var i=0,arr2=Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _arr=[],_n=!0,_d=!1,_s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=!0){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=!0;_e=err}finally{try{if(!_n&&null!=_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0,descriptor;i<props.length;i++){descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value"in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:!1});return Constructor}var UserPicker=function(){function UserPicker(userList,showUserCallback,preChangeUserCallback){_classCallCheck(this,UserPicker);this.userList=userList;this.showUserCallback=showUserCallback;this.preChangeUserCallback=preChangeUserCallback;this.currentUserIndex=0;this.render=this.render.bind(this);this.setUserId=this.setUserId.bind(this)}_createClass(UserPicker,[{key:"setUserId",value:function setUserId(userId){var userIndex=this.userList.findIndex(function(user){return user.id===parseInt(userId)});if(-1===userIndex){throw Error("User with id ".concat(userId," not found"))}this.currentUserIndex=userIndex}},{key:"render",value:function(){var _render=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var _yield$this$renderNav,html,js;return regeneratorRuntime.wrap(function(_context){while(1){switch(_context.prev=_context.next){case 0:this.root=document.createElement("div");_context.next=3;return this.renderNavigator();case 3:_yield$this$renderNav=_context.sent;html=_yield$this$renderNav.html;js=_yield$this$renderNav.js;_templates.default.replaceNodeContents(this.root,html,js);_context.next=9;return this.showUser(this.currentUser);case 9:this.registerEventListeners();case 10:case"end":return _context.stop();}}},_callee,this)}));return function render(){return _render.apply(this,arguments)}}()},{key:"renderNavigator",value:function renderNavigator(){return _templates.default.renderForPromise("".concat("mod_forum/local/grades/local/grader","/user_picker"),{})}},{key:"renderUserChange",value:function renderUserChange(context){return _templates.default.renderForPromise("".concat("mod_forum/local/grades/local/grader","/user_picker/user"),context)}},{key:"showUser",value:function(){var _showUser=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(user){var _yield$Promise$all,_yield$Promise$all2,_yield$Promise$all2$,html,js,userRegion,currentUserRegion;return regeneratorRuntime.wrap(function(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return Promise.all([this.renderUserChange(user),this.showUserCallback(user)]);case 2:_yield$Promise$all=_context2.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,1);_yield$Promise$all2$=_yield$Promise$all2[0];html=_yield$Promise$all2$.html;js=_yield$Promise$all2$.js;userRegion=this.root.querySelector(_selectors.default.regions.userRegion);_templates.default.replaceNodeContents(userRegion,html,js);currentUserRegion=this.root.querySelector(_selectors.default.regions.currentUser);_context2.next=12;return(0,_str.get_string)("nowgradinguser","mod_forum",user.fullname);case 12:currentUserRegion.textContent=_context2.sent;case 13:case"end":return _context2.stop();}}},_callee2,this)}));return function showUser(){return _showUser.apply(this,arguments)}}()},{key:"registerEventListeners",value:function registerEventListeners(){var _this=this;this.root.addEventListener("click",function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(e){var button,result;return regeneratorRuntime.wrap(function(_context3){while(1){switch(_context3.prev=_context3.next){case 0:button=e.target.closest(_selectors.default.actions.changeUser);if(!button){_context3.next=9;break}_context3.next=4;return _this.preChangeUserCallback(_this.currentUser);case 4:result=_context3.sent;if(result.failed){_context3.next=9;break}_this.updateIndex(parseInt(button.dataset.direction));_context3.next=9;return _this.showUser(_this.currentUser);case 9:case"end":return _context3.stop();}}},_callee3)}));return function(){return _ref.apply(this,arguments)}}())}},{key:"updateIndex",value:function updateIndex(direction){this.currentUserIndex+=direction;if(0>this.currentUserIndex){this.currentUserIndex=this.userList.length-1}else if(this.currentUserIndex>this.userList.length-1){this.currentUserIndex=0}return this.currentUserIndex}},{key:"currentUser",get:function get(){return _objectSpread(_objectSpread({},this.userList[this.currentUserIndex]),{},{total:this.userList.length,displayIndex:this.currentUserIndex+1})}},{key:"rootNode",get:function get(){return this.root}}]);return UserPicker}(),_default=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(users,showUserCallback,preChangeUserCallback){var _ref3,_ref3$initialUserId,initialUserId,userPicker,_args4=arguments;return regeneratorRuntime.wrap(function(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_ref3=3<_args4.length&&_args4[3]!==void 0?_args4[3]:{},_ref3$initialUserId=_ref3.initialUserId,initialUserId=void 0===_ref3$initialUserId?null:_ref3$initialUserId;userPicker=new UserPicker(users,showUserCallback,preChangeUserCallback);if(initialUserId){userPicker.setUserId(initialUserId)}_context4.next=5;return userPicker.render();case 5:return _context4.abrupt("return",userPicker);case 6:case"end":return _context4.stop();}}},_callee4)}));return function(){return _ref2.apply(this,arguments)}}();_exports.default=_default;return _exports.default});
//# sourceMappingURL=user_picker.min.js.map
