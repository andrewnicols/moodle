{"version":3,"file":"fullscreen.min.js","sources":["../../../src/local/layout/fullscreen.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Full screen window layout.\n *\n * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {addIconToContainer} from 'core/loadingicon';\nimport {addToastRegion} from 'core/toast';\nimport * as FocusLockManager from 'core/local/aria/focuslock';\n\n/**\n * @param {string} templateName\n * @param {object} context\n * @return {object}\n */\nconst getComposedLayout = ({\n    fullscreen = true,\n    showLoader = false,\n    focusOnClose = null,\n} = {}) => {\n    const container = document.createElement('div');\n    document.body.append(container);\n    container.classList.add('layout');\n    container.classList.add('fullscreen');\n    container.setAttribute('role', 'application');\n    addToastRegion(container);\n\n    // Lock scrolling on the document body.\n    lockBodyScroll();\n\n    // Lock tab control.\n    FocusLockManager.trapFocus(container);\n\n    const helpers = getLayoutHelpers(container, FocusLockManager, focusOnClose);\n\n    if (showLoader) {\n        helpers.showLoadingIcon();\n    }\n\n    if (fullscreen) {\n        helpers.requestFullscreen();\n    }\n\n    return helpers;\n};\n\nconst getLayoutHelpers = (layoutNode, FocusLockManager, focusOnClose) => {\n    const contentNode = document.createElement('div');\n    layoutNode.append(contentNode);\n\n    const loadingNode = document.createElement('div');\n    layoutNode.append(loadingNode);\n\n    /**\n     * Close and destroy the window container.\n     */\n    const close = () => {\n        exitFullscreen();\n        unlockBodyScroll();\n        FocusLockManager.untrapFocus();\n\n        layoutNode.remove();\n\n        if (focusOnClose) {\n            try {\n                focusOnClose.focus();\n            } catch (e) {\n                // eslint-disable-line\n            }\n        }\n    };\n\n    /**\n     * Attempt to make the conatiner full screen.\n     */\n    const requestFullscreen = () => {\n        if (layoutNode.requestFullscreen) {\n            layoutNode.requestFullscreen();\n        } else if (layoutNode.msRequestFullscreen) {\n            layoutNode.msRequestFullscreen();\n        } else if (layoutNode.mozRequestFullscreen) {\n            layoutNode.mozRequestFullscreen();\n        } else if (layoutNode.webkitRequestFullscreen) {\n            layoutNode.webkitRequestFullscreen();\n        } else {\n            // Not supported.\n            // Hack to make this act like full-screen as much as possible.\n            layoutNode.setTop(0);\n        }\n    };\n\n    /**\n     * Exit full screen but do not close the container fully.\n     */\n    const exitFullscreen = () => {\n        if (document.exitRequestFullScreen) {\n            if (document.fullScreenElement !== layoutNode) {\n                return;\n            }\n            document.exitRequestFullScreen();\n        } else if (document.msExitFullscreen) {\n            if (document.msFullscreenElement !== layoutNode) {\n                return;\n            }\n            document.msExitFullscreen();\n        } else if (document.mozCancelFullScreen) {\n            if (document.mozFullScreenElement !== layoutNode) {\n                return;\n            }\n            document.mozCancelFullScreen();\n        } else if (document.webkitExitFullscreen) {\n            if (document.webkitFullscreenElement !== layoutNode) {\n                return;\n            }\n            document.webkitExitFullscreen();\n        }\n    };\n\n    const toggleFullscreen = () => {\n        if (document.exitRequestFullScreen) {\n            if (document.fullScreenElement === layoutNode) {\n                exitFullscreen();\n            } else {\n                requestFullscreen();\n            }\n        } else if (document.msExitFullscreen) {\n            if (document.msFullscreenElement === layoutNode) {\n                exitFullscreen();\n            } else {\n                requestFullscreen();\n            }\n        } else if (document.mozCancelFullScreen) {\n            if (document.mozFullScreenElement === layoutNode) {\n                exitFullscreen();\n            } else {\n                requestFullscreen();\n            }\n        } else if (document.webkitExitFullscreen) {\n            if (document.webkitFullscreenElement === layoutNode) {\n                exitFullscreen();\n            } else {\n                requestFullscreen();\n            }\n        }\n    };\n\n    /**\n     * Get the Node which is fullscreen.\n     *\n     * @return {Element}\n     */\n    const getContainer = () => {\n        return contentNode;\n    };\n\n    const setContent = (content) => {\n        hideLoadingIcon();\n\n        // Note: It would be better to use replaceWith, but this is not compatible with IE.\n        let child = contentNode.lastElementChild;\n        while (child) {\n            contentNode.removeChild(child);\n            child = contentNode.lastElementChild;\n        }\n        contentNode.append(content);\n    };\n\n    const showLoadingIcon = () => {\n        addIconToContainer(loadingNode);\n    };\n\n    const hideLoadingIcon = () => {\n        // Hide the loading container.\n        let child = loadingNode.lastElementChild;\n        while (child) {\n            loadingNode.removeChild(child);\n            child = loadingNode.lastElementChild;\n        }\n    };\n\n    /**\n     * @return {Object}\n     */\n    return {\n        close,\n\n        toggleFullscreen,\n        requestFullscreen,\n        exitFullscreen,\n\n        getContainer,\n        setContent,\n\n        showLoadingIcon,\n        hideLoadingIcon,\n    };\n};\n\nconst lockBodyScroll = () => {\n    document.querySelector('body').classList.add('overflow-hidden');\n};\n\nconst unlockBodyScroll = () => {\n    document.querySelector('body').classList.remove('overflow-hidden');\n};\n\nexport const createLayout = getComposedLayout;\n"],"names":["_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","FocusLockManager","obj","__esModule","_typeof","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_interopRequireWildcard","getLayoutHelpers","layoutNode","focusOnClose","contentNode","document","createElement","append","loadingNode","requestFullscreen","msRequestFullscreen","mozRequestFullscreen","webkitRequestFullscreen","setTop","exitFullscreen","exitRequestFullScreen","fullScreenElement","msExitFullscreen","msFullscreenElement","mozCancelFullScreen","mozFullScreenElement","webkitExitFullscreen","webkitFullscreenElement","hideLoadingIcon","child","lastElementChild","removeChild","close","unlockBodyScroll","untrapFocus","remove","focus","e","toggleFullscreen","getContainer","setContent","content","showLoadingIcon","addIconToContainer","lockBodyScroll","querySelector","classList","add","createLayout","_ref","arguments","length","undefined","_ref$fullscreen","fullscreen","_ref$showLoader","showLoader","_ref$focusOnClose","container","body","setAttribute","addToastRegion","trapFocus","helpers","_exports"],"mappings":"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"}