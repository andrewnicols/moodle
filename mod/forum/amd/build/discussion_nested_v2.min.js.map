{"version":3,"sources":["../src/discussion_nested_v2.js"],"names":["ANIMATION_DURATION","getPostContainer","element","closest","Selectors","post","getPostContainerById","id","find","getParentPostContainers","parents","getPostContentContainer","postContainer","children","not","repliesContainer","forumCoreContent","getInPageReplyContainer","filter","inpageReplyContainer","getInPageReplyForm","inpageReplyContent","getInPageReplyCreateButton","inpageReplyCreateButton","getRepliesVisibilityToggleContainer","repliesVisibilityToggleContainer","getRepliesContainer","hasReplies","length","getShowRepliesButton","replyVisibilityToggleContainer","showReplies","getHideRepliesButton","hideReplies","repliesVisible","is","postIdToSee","showButton","hideButton","addClass","removeClass","slideDown","duration","queue","complete","postContainerToSee","scrollIntoView","css","fadeIn","slideUp","fadeOut","showInPageReplyForm","buildShowInPageReplyFormFunction","additionalTemplateContext","inPageReplyContainer","inPageReplyCreateButton","hasInPageReplyForm","html","renderInPageReplyTemplate","Templates","appendNodeContents","e","Notification","exception","FormChangeChecker","watchForm","querySelector","inPageReplyForm","focus","hideInPageReplyForm","button","postContentContainer","currentSubject","forumSubject","text","currentAuthorName","authorName","context","postid","data","attr","sesskey","M","cfg","parentsubject","parentauthorname","canreplyprivately","postformat","InPageReply","CONTENT_FORMATS","MOODLE","render","incrementTotalReplyCount","replyCount","each","index","currentCount","parseInt","innerText","registerEventListeners","root","CustomEvents","define","events","activate","AutoRows","init","on","originalEvent","preventDefault","currentTarget","inpageReplyCancelButton","target","EVENTS","POST_CREATED","inpageSubmitBtn","newPostId","postContainers","container","Discussion","discussionToolsContainer","discussion","tools","LockToggle","FavouriteToggle","toggleElement","response","newTargetState","userstate","favourited","Pin","pinned","Subscribe","subscribed"],"mappings":"4oBAsBA,wCACA,8CACA,8EACA,6DACA,oDACA,8CACA,gDACA,oDACA,kDACA,4DACA,gDACA,8CACA,kE,+hCAEMA,CAAAA,kBAAkB,CAAG,G,CAQrBC,gBAAgB,CAAIC,OAAD,EAAa,CAClC,MAAOA,CAAAA,OAAO,CAACC,OAAR,CAAgBC,mBAAUC,IAAV,CAAeA,IAA/B,CACV,C,CASKC,oBAAoB,CAAG,CAACJ,OAAD,CAAUK,EAAV,GAAiB,CAC1C,MAAOL,CAAAA,OAAO,CAACM,IAAR,WAAgBJ,mBAAUC,IAAV,CAAeA,IAA/B,0BAAoDE,EAApD,MACV,C,CAQKE,uBAAuB,CAAIP,OAAD,EAAa,CACzC,MAAOA,CAAAA,OAAO,CAACQ,OAAR,CAAgBN,mBAAUC,IAAV,CAAeA,IAA/B,CACV,C,CAQKM,uBAAuB,CAAIC,aAAD,EAAmB,CAC/C,MAAOA,CAAAA,aAAa,CAACC,QAAd,GAAyBC,GAAzB,CAA6BV,mBAAUC,IAAV,CAAeU,gBAA5C,EAA8DP,IAA9D,CAAmEJ,mBAAUC,IAAV,CAAeW,gBAAlF,CACV,C,CAQKC,uBAAuB,CAAIL,aAAD,EAAmB,CAC/C,MAAOA,CAAAA,aAAa,CAACC,QAAd,GAAyBK,MAAzB,CAAgCd,mBAAUC,IAAV,CAAec,oBAA/C,CACV,C,CAQKC,kBAAkB,CAAIR,aAAD,EAAmB,CAC1C,MAAOK,CAAAA,uBAAuB,CAACL,aAAD,CAAvB,CAAuCJ,IAAvC,CAA4CJ,mBAAUC,IAAV,CAAegB,kBAA3D,CACV,C,CAQKC,0BAA0B,CAAIV,aAAD,EAAmB,CAClD,MAAOD,CAAAA,uBAAuB,CAACC,aAAD,CAAvB,CAAuCJ,IAAvC,CAA4CJ,mBAAUC,IAAV,CAAekB,uBAA3D,CACV,C,CASKC,mCAAmC,CAAIZ,aAAD,EAAmB,CAC3D,MAAOA,CAAAA,aAAa,CAACC,QAAd,CAAuBT,mBAAUC,IAAV,CAAeoB,gCAAtC,CACV,C,CAQKC,mBAAmB,CAAId,aAAD,EAAmB,CAC3C,MAAOA,CAAAA,aAAa,CAACC,QAAd,CAAuBT,mBAAUC,IAAV,CAAeU,gBAAtC,CACV,C,CAQKY,UAAU,CAAIf,aAAD,EAAmB,CAClC,MAA8D,EAAvD,CAAAc,mBAAmB,CAACd,aAAD,CAAnB,CAAmCC,QAAnC,GAA8Ce,MACxD,C,CAQKC,oBAAoB,CAAIC,8BAAD,EAAoC,CAC7D,MAAOA,CAAAA,8BAA8B,CAACtB,IAA/B,CAAoCJ,mBAAUC,IAAV,CAAe0B,WAAnD,CACV,C,CAQKC,oBAAoB,CAAIF,8BAAD,EAAoC,CAC7D,MAAOA,CAAAA,8BAA8B,CAACtB,IAA/B,CAAoCJ,mBAAUC,IAAV,CAAe4B,WAAnD,CACV,C,CAQKC,cAAc,CAAItB,aAAD,EAAmB,CACtC,KAAMG,CAAAA,gBAAgB,CAAGW,mBAAmB,CAACd,aAAD,CAA5C,CACA,MAAOG,CAAAA,gBAAgB,CAACoB,EAAjB,CAAoB,UAApB,CACV,C,CAQKJ,WAAW,CAAG,SAACnB,aAAD,CAAuC,IAAvBwB,CAAAA,WAAuB,wDAAT,IAAS,MACjDrB,CAAAA,gBAAgB,CAAGW,mBAAmB,CAACd,aAAD,CADW,CAEjDkB,8BAA8B,CAAGN,mCAAmC,CAACZ,aAAD,CAFnB,CAGjDyB,UAAU,CAAGR,oBAAoB,CAACC,8BAAD,CAHgB,CAIjDQ,UAAU,CAAGN,oBAAoB,CAACF,8BAAD,CAJgB,CAMvDO,UAAU,CAACE,QAAX,CAAoB,QAApB,EACAD,UAAU,CAACE,WAAX,CAAuB,QAAvB,EAEAzB,gBAAgB,CAAC0B,SAAjB,CAA2B,CACvBC,QAAQ,CAAE1C,kBADa,CAEvB2C,KAAK,GAFkB,CAGvBC,QAAQ,CAAE,IAAM,CACZ,GAAIR,WAAJ,CAAiB,CACb,KAAMS,CAAAA,kBAAkB,CAAGvC,oBAAoB,CAACS,gBAAD,CAAmBqB,WAAnB,CAA/C,CACA,GAAIS,kBAAkB,CAACjB,MAAvB,CAA+B,CAC3BiB,kBAAkB,CAAC,CAAD,CAAlB,CAAsBC,cAAtB,EACH,CACJ,CACJ,CAVsB,CAA3B,EAWGC,GAXH,CAWO,SAXP,CAWkB,MAXlB,EAW0BC,MAX1B,CAWiChD,kBAXjC,CAYH,C,CAOKiC,WAAW,CAAIrB,aAAD,EAAmB,MAC7BG,CAAAA,gBAAgB,CAAGW,mBAAmB,CAACd,aAAD,CADT,CAE7BkB,8BAA8B,CAAGN,mCAAmC,CAACZ,aAAD,CAFvC,CAG7ByB,UAAU,CAAGR,oBAAoB,CAACC,8BAAD,CAHJ,CAI7BQ,UAAU,CAAGN,oBAAoB,CAACF,8BAAD,CAJJ,CAMnCO,UAAU,CAACG,WAAX,CAAuB,QAAvB,EACAF,UAAU,CAACC,QAAX,CAAoB,QAApB,EAEAxB,gBAAgB,CAACkC,OAAjB,CAAyB,CACrBP,QAAQ,CAAE1C,kBADW,CAErB2C,KAAK,GAFgB,CAAzB,EAGGO,OAHH,CAGWlD,kBAHX,CAIH,C,CAGD,GAAImD,CAAAA,mBAAmB,CAAG,IAA1B,C,KAQMC,CAAAA,gCAAgC,CAAIC,yBAAD,EAA+B,CAOpE,MAAO,MAAMzC,CAAAA,aAAN,EAAwB,MAErB0C,CAAAA,oBAAoB,CAAGrC,uBAAuB,CAACL,aAAD,CAFzB,CAGrBa,gCAAgC,CAAGD,mCAAmC,CAACZ,aAAD,CAHjD,CAIrB2C,uBAAuB,CAAGjC,0BAA0B,CAACV,aAAD,CAJ/B,CAM3B,GAAI,CAAC4C,kBAAkB,CAACF,oBAAD,CAAvB,CAA+C,CAC3C,GAAI,CACA,KAAMG,CAAAA,IAAI,CAAG,KAAMC,CAAAA,yBAAyB,CAACL,yBAAD,CAA4BE,uBAA5B,CAAqD3C,aAArD,CAA5C,CACA+C,mBAAUC,kBAAV,CAA6BN,oBAA7B,CAAmDG,IAAnD,CAAyD,EAAzD,CACH,CAAC,MAAOI,CAAP,CAAU,CACRC,sBAAaC,SAAb,CAAuBF,CAAvB,CACH,CAEDG,iBAAiB,CAACC,SAAlB,CAA4BrD,aAAa,CAAC,CAAD,CAAb,CAAiBsD,aAAjB,CAA+B,MAA/B,CAA5B,CACH,CAEDX,uBAAuB,CAACL,OAAxB,CAAgClD,kBAAhC,CAAoD,IAAM,CACtD,KAAMmE,CAAAA,eAAe,CAAG/C,kBAAkB,CAACR,aAAD,CAA1C,CACAuD,eAAe,CAAC1B,SAAhB,CAA0B,CACtBC,QAAQ,CAAE1C,kBADY,CAEtB2C,KAAK,GAFiB,CAGtBC,QAAQ,CAAE,IAAM,CACZuB,eAAe,CAAC3D,IAAhB,CAAqB,UAArB,EAAiC4D,KAAjC,EACH,CALqB,CAA1B,EAMGrB,GANH,CAMO,SANP,CAMkB,MANlB,EAM0BC,MAN1B,CAMiChD,kBANjC,EAQA,GAAIyB,gCAAgC,CAACG,MAAjC,EAA2CD,UAAU,CAACf,aAAD,CAAzD,CAA0E,CACtEa,gCAAgC,CAACuB,MAAjC,CAAwChD,kBAAxC,EACAiC,WAAW,CAACrB,aAAD,CACd,CACJ,CAdD,CAeH,CACJ,C,CASKyD,mBAAmB,CAAG,SAACzD,aAAD,CAAuC,IAAvBwB,CAAAA,WAAuB,wDAAT,IAAS,MACzD+B,CAAAA,eAAe,CAAG/C,kBAAkB,CAACR,aAAD,CADqB,CAEzD2C,uBAAuB,CAAGjC,0BAA0B,CAACV,aAAD,CAFK,CAGzDa,gCAAgC,CAAGD,mCAAmC,CAACZ,aAAD,CAHb,CAK/D,GAAIa,gCAAgC,CAACG,MAAjC,EAA2CD,UAAU,CAACf,aAAD,CAAzD,CAA0E,CACtEa,gCAAgC,CAACyB,OAAjC,CAAyClD,kBAAzC,EACA,GAAI,CAACkC,cAAc,CAACtB,aAAD,CAAnB,CAAoC,CAChCmB,WAAW,CAACnB,aAAD,CAAgBwB,WAAhB,CACd,CACJ,CAED+B,eAAe,CAAClB,OAAhB,CAAwB,CACpBP,QAAQ,CAAE1C,kBADU,CAEpB2C,KAAK,GAFe,CAGpBC,QAAQ,CAAE,IAAM,CACZW,uBAAuB,CAACP,MAAxB,CAA+BhD,kBAA/B,CACH,CALmB,CAAxB,EAMGkD,OANH,CAMW,GANX,CAOH,C,CAQKM,kBAAkB,CAAIF,oBAAD,EAA0B,CACjD,MAA6E,EAAtE,CAAAA,oBAAoB,CAAC9C,IAArB,CAA0BJ,mBAAUC,IAAV,CAAegB,kBAAzC,EAA6DO,MACvE,C,CAUK8B,yBAAyB,CAAG,CAACL,yBAAD,CAA4BiB,MAA5B,CAAoC1D,aAApC,GAAsD,MAC9E2D,CAAAA,oBAAoB,CAAG5D,uBAAuB,CAACC,aAAD,CADgC,CAE9E4D,cAAc,CAAGD,oBAAoB,CAAC/D,IAArB,CAA0BJ,mBAAUC,IAAV,CAAeoE,YAAzC,EAAuDC,IAAvD,EAF6D,CAG9EC,iBAAiB,CAAGJ,oBAAoB,CAAC/D,IAArB,CAA0BJ,mBAAUC,IAAV,CAAeuE,UAAzC,EAAqDF,IAArD,EAH0D,CAI9EG,OAAO,CAAG,CACZC,MAAM,CAAElE,aAAa,CAACmE,IAAd,CAAmB,SAAnB,CADI,CAEZ,UAAaT,MAAM,CAACU,IAAP,CAAY,WAAZ,CAFD,CAGZC,OAAO,CAAEC,CAAC,CAACC,GAAF,CAAMF,OAHH,CAIZG,aAAa,CAAEZ,cAJH,CAKZa,gBAAgB,CAAEV,iBALN,CAMZW,iBAAiB,CAAEhB,MAAM,CAACS,IAAP,CAAY,qBAAZ,CANP,CAOZQ,UAAU,CAAEC,sBAAYC,eAAZ,CAA4BC,MAP5B,CAQZ,GAAGrC,yBARS,CAJoE,CAepF,MAAOM,oBAAUgC,MAAV,CAAiB,2BAAjB,CAA8Cd,OAA9C,CACV,C,CAOKe,wBAAwB,CAAIhF,aAAD,EAAmB,CAChDY,mCAAmC,CAACZ,aAAD,CAAnC,CAAmDJ,IAAnD,CAAwDJ,mBAAUC,IAAV,CAAewF,UAAvE,EAAmFC,IAAnF,CAAwF,CAACC,KAAD,CAAQ7F,OAAR,GAAoB,CACxG,KAAM8F,CAAAA,YAAY,CAAGC,QAAQ,CAAC/F,OAAO,CAACgG,SAAT,CAAoB,EAApB,CAA7B,CACAhG,OAAO,CAACgG,SAAR,CAAoBF,YAAY,CAAG,CACtC,CAHD,CAIH,C,CAOKG,sBAAsB,CAAIC,IAAD,EAAU,CACrCC,mCAAaC,MAAb,CAAoBF,IAApB,CAA0B,CAACC,mCAAaE,MAAb,CAAoBC,QAArB,CAA1B,EAEAC,mBAASC,IAAT,CAAcN,IAAd,EAGAA,IAAI,CAACO,EAAL,CAAQN,mCAAaE,MAAb,CAAoBC,QAA5B,CAAsCpG,mBAAUC,IAAV,CAAekB,uBAArD,CAA8E,CAACsC,CAAD,CAAIkB,IAAJ,GAAa,CACvFA,IAAI,CAAC6B,aAAL,CAAmBC,cAAnB,GACA,KAAMjG,CAAAA,aAAa,CAAGX,gBAAgB,CAAC,oBAAE4D,CAAC,CAACiD,aAAJ,CAAD,CAAtC,CACA3D,mBAAmB,CAACvC,aAAD,CACtB,CAJD,EAOAwF,IAAI,CAACO,EAAL,CAAQN,mCAAaE,MAAb,CAAoBC,QAA5B,CAAsCpG,mBAAUC,IAAV,CAAe0G,uBAArD,CAA8E,CAAClD,CAAD,CAAIkB,IAAJ,GAAa,CACvFA,IAAI,CAAC6B,aAAL,CAAmBC,cAAnB,GACA,KAAMjG,CAAAA,aAAa,CAAGX,gBAAgB,CAAC,oBAAE4D,CAAC,CAACiD,aAAJ,CAAD,CAAtC,CACAzC,mBAAmB,CAACzD,aAAD,CACtB,CAJD,EAOAwF,IAAI,CAACO,EAAL,CAAQN,mCAAaE,MAAb,CAAoBC,QAA5B,CAAsCpG,mBAAUC,IAAV,CAAe0B,WAArD,CAAkE,CAAC8B,CAAD,CAAIkB,IAAJ,GAAa,CAC3EA,IAAI,CAAC6B,aAAL,CAAmBC,cAAnB,GACA,KAAMjG,CAAAA,aAAa,CAAGX,gBAAgB,CAAC,oBAAE4D,CAAC,CAACmD,MAAJ,CAAD,CAAtC,CACAjF,WAAW,CAACnB,aAAD,CACd,CAJD,EAOAwF,IAAI,CAACO,EAAL,CAAQN,mCAAaE,MAAb,CAAoBC,QAA5B,CAAsCpG,mBAAUC,IAAV,CAAe4B,WAArD,CAAkE,CAAC4B,CAAD,CAAIkB,IAAJ,GAAa,CAC3EA,IAAI,CAAC6B,aAAL,CAAmBC,cAAnB,GACA,KAAMjG,CAAAA,aAAa,CAAGX,gBAAgB,CAAC,oBAAE4D,CAAC,CAACmD,MAAJ,CAAD,CAAtC,CACA/E,WAAW,CAACrB,aAAD,CACd,CAJD,EAOAwF,IAAI,CAACO,EAAL,CAAQnB,sBAAYyB,MAAZ,CAAmBC,YAA3B,CAAyC9G,mBAAUC,IAAV,CAAe8G,eAAxD,CAAyE,CAACtD,CAAD,CAAIuD,SAAJ,GAAkB,MACjFN,CAAAA,aAAa,CAAG,oBAAEjD,CAAC,CAACiD,aAAJ,CADiE,CAEjFlG,aAAa,CAAGX,gBAAgB,CAAC6G,aAAD,CAFiD,CAGjFO,cAAc,CAAG5G,uBAAuB,CAACqG,aAAD,CAHyC,CAIvFzC,mBAAmB,CAACzD,aAAD,CAAgBwG,SAAhB,CAAnB,CAEAC,cAAc,CAACvB,IAAf,CAAoB,CAACC,KAAD,CAAQuB,SAAR,GAAsB,CACtC1B,wBAAwB,CAAC,oBAAE0B,SAAF,CAAD,CAC3B,CAFD,CAGH,CATD,CAUH,C,CAQYZ,IAAI,CAAG,CAACN,IAAD,CAAOvB,OAAP,GAAmB,CAEnC1B,mBAAmB,CAAGC,gCAAgC,CAACyB,OAAD,CAAtD,CAEAsB,sBAAsB,CAACC,IAAD,CAAtB,CAEAmB,oBAAWb,IAAX,CAAgBN,IAAhB,EAEAZ,sBAAYkB,IAAZ,CAAiBN,IAAjB,EAGA,KAAMoB,CAAAA,wBAAwB,CAAGpB,IAAI,CAAC5F,IAAL,CAAUJ,mBAAUqH,UAAV,CAAqBC,KAA/B,CAAjC,CACAC,qBAAWjB,IAAX,CAAgBc,wBAAhB,KACAI,0BAAgBlB,IAAhB,CAAqBc,wBAArB,IAAsD,CAACK,aAAD,CAAgBC,QAAhB,GAA6B,CAC/E,KAAMC,CAAAA,cAAc,CAAGD,QAAQ,CAACE,SAAT,CAAmBC,UAAnB,CAAgC,CAAhC,CAAoC,CAA3D,CACA,MAAOJ,CAAAA,aAAa,CAAC9C,IAAd,CAAmB,aAAnB,CAAkCgD,cAAlC,CACV,CAHD,EAIAG,oBAAIxB,IAAJ,CAASc,wBAAT,IAA0C,CAACK,aAAD,CAAgBC,QAAhB,GAA6B,CACnE,KAAMC,CAAAA,cAAc,CAAGD,QAAQ,CAACK,MAAT,CAAkB,CAAlB,CAAsB,CAA7C,CACA,MAAON,CAAAA,aAAa,CAAC9C,IAAd,CAAmB,aAAnB,CAAkCgD,cAAlC,CACV,CAHD,EAIAK,6BAAU1B,IAAV,CAAec,wBAAf,IAAgD,CAACK,aAAD,CAAgBC,QAAhB,GAA6B,CACzE,KAAMC,CAAAA,cAAc,CAAGD,QAAQ,CAACE,SAAT,CAAmBK,UAAnB,CAAgC,CAAhC,CAAoC,CAA3D,CACAR,aAAa,CAAC9C,IAAd,CAAmB,aAAnB,CAAkCgD,cAAlC,CACH,CAHD,CAIH,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module for viewing a discussion in nested v2 view.\n *\n * @module mod_Forum/discussion_nested_v2\n * @copyright  2019 Ryan Wyllie <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport AutoRows from 'core/auto_rows';\nimport CustomEvents from 'core/custom_interaction_events';\nimport * as FormChangeChecker from 'core_form/changechecker';\nimport Notification from 'core/notification';\nimport Templates from 'core/templates';\nimport Discussion from 'mod_forum/discussion';\nimport InPageReply from 'mod_forum/inpage_reply';\nimport LockToggle from 'mod_forum/lock_toggle';\nimport FavouriteToggle from 'mod_forum/favourite_toggle';\nimport Pin from 'mod_forum/pin_toggle';\nimport Selectors from 'mod_forum/selectors';\nimport Subscribe from 'mod_forum/subscription_toggle';\n\nconst ANIMATION_DURATION = 150;\n\n/**\n * Get the closest post container element from the given element.\n *\n * @param {Object} element jQuery element to search from\n * @return {Object} jQuery element\n */\nconst getPostContainer = (element) => {\n    return element.closest(Selectors.post.post);\n};\n\n/**\n * Get the closest post container element from the given element.\n *\n * @param {Object} element jQuery element to search from\n * @param {Number} id Id of the post to find.\n * @return {Object} jQuery element\n */\nconst getPostContainerById = (element, id) => {\n    return element.find(`${Selectors.post.post}[data-post-id=${id}]`);\n};\n\n/**\n * Get the parent post container elements from the given element.\n *\n * @param {Object} element jQuery element to search from\n * @return {Object} jQuery element\n */\nconst getParentPostContainers = (element) => {\n    return element.parents(Selectors.post.post);\n};\n\n/**\n * Get the post content container element from the post container element.\n *\n * @param {Object} postContainer jQuery element for the post container\n * @return {Object} jQuery element\n */\nconst getPostContentContainer = (postContainer) => {\n    return postContainer.children().not(Selectors.post.repliesContainer).find(Selectors.post.forumCoreContent);\n};\n\n/**\n * Get the in page reply container element from the post container element.\n *\n * @param {Object} postContainer jQuery element for the post container\n * @return {Object} jQuery element\n */\nconst getInPageReplyContainer = (postContainer) => {\n    return postContainer.children().filter(Selectors.post.inpageReplyContainer);\n};\n\n/**\n * Get the in page reply form element from the post container element.\n *\n * @param {Object} postContainer jQuery element for the post container\n * @return {Object} jQuery element\n */\nconst getInPageReplyForm = (postContainer) => {\n    return getInPageReplyContainer(postContainer).find(Selectors.post.inpageReplyContent);\n};\n\n/**\n * Get the in page reply create (reply) button element from the post container element.\n *\n * @param {Object} postContainer jQuery element for the post container\n * @return {Object} jQuery element\n */\nconst getInPageReplyCreateButton = (postContainer) => {\n    return getPostContentContainer(postContainer).find(Selectors.post.inpageReplyCreateButton);\n};\n\n/**\n * Get the replies visibility toggle container (show/hide replies button container) element\n * from the post container element.\n *\n * @param {Object} postContainer jQuery element for the post container\n * @return {Object} jQuery element\n */\nconst getRepliesVisibilityToggleContainer = (postContainer) => {\n    return postContainer.children(Selectors.post.repliesVisibilityToggleContainer);\n};\n\n/**\n * Get the replies container element from the post container element.\n *\n * @param {Object} postContainer jQuery element for the post container\n * @return {Object} jQuery element\n */\nconst getRepliesContainer = (postContainer) => {\n    return postContainer.children(Selectors.post.repliesContainer);\n};\n\n/**\n * Check if the post has any replies.\n *\n * @param {Object} postContainer jQuery element for the post container\n * @return {Bool}\n */\nconst hasReplies = (postContainer) => {\n    return getRepliesContainer(postContainer).children().length > 0;\n};\n\n/**\n * Get the show replies button element from the replies visibility toggle container element.\n *\n * @param {Object} replyVisibilityToggleContainer jQuery element for the toggle container\n * @return {Object} jQuery element\n */\nconst getShowRepliesButton = (replyVisibilityToggleContainer) => {\n    return replyVisibilityToggleContainer.find(Selectors.post.showReplies);\n};\n\n/**\n * Get the hide replies button element from the replies visibility toggle container element.\n *\n * @param {Object} replyVisibilityToggleContainer jQuery element for the toggle container\n * @return {Object} jQuery element\n */\nconst getHideRepliesButton = (replyVisibilityToggleContainer) => {\n    return replyVisibilityToggleContainer.find(Selectors.post.hideReplies);\n};\n\n/**\n * Check if the replies are visible.\n *\n * @param {Object} postContainer jQuery element for the post container\n * @return {Bool}\n */\nconst repliesVisible = (postContainer) => {\n    const repliesContainer = getRepliesContainer(postContainer);\n    return repliesContainer.is(':visible');\n};\n\n/**\n * Show the post replies.\n *\n * @param {Object} postContainer jQuery element for the post container\n * @param {Number|null} postIdToSee Id of the post to scroll into view (if any)\n */\nconst showReplies = (postContainer, postIdToSee = null) => {\n    const repliesContainer = getRepliesContainer(postContainer);\n    const replyVisibilityToggleContainer = getRepliesVisibilityToggleContainer(postContainer);\n    const showButton = getShowRepliesButton(replyVisibilityToggleContainer);\n    const hideButton = getHideRepliesButton(replyVisibilityToggleContainer);\n\n    showButton.addClass('hidden');\n    hideButton.removeClass('hidden');\n\n    repliesContainer.slideDown({\n        duration: ANIMATION_DURATION,\n        queue: false,\n        complete: () => {\n            if (postIdToSee) {\n                const postContainerToSee = getPostContainerById(repliesContainer, postIdToSee);\n                if (postContainerToSee.length) {\n                    postContainerToSee[0].scrollIntoView();\n                }\n            }\n        }\n    }).css('display', 'none').fadeIn(ANIMATION_DURATION);\n};\n\n/**\n * Hide the post replies.\n *\n * @param {Object} postContainer jQuery element for the post container\n */\nconst hideReplies = (postContainer) => {\n    const repliesContainer = getRepliesContainer(postContainer);\n    const replyVisibilityToggleContainer = getRepliesVisibilityToggleContainer(postContainer);\n    const showButton = getShowRepliesButton(replyVisibilityToggleContainer);\n    const hideButton = getHideRepliesButton(replyVisibilityToggleContainer);\n\n    showButton.removeClass('hidden');\n    hideButton.addClass('hidden');\n\n    repliesContainer.slideUp({\n        duration: ANIMATION_DURATION,\n        queue: false\n    }).fadeOut(ANIMATION_DURATION);\n};\n\n/** Variable to hold the showInPageReplyForm function after it's built. */\nlet showInPageReplyForm = null;\n\n/**\n * Build the showInPageReplyForm function with the given additional template context.\n *\n * @param {Object} additionalTemplateContext Additional render context for the in page reply template.\n * @return {Function}\n */\nconst buildShowInPageReplyFormFunction = (additionalTemplateContext) => {\n    /**\n     * Show the in page reply form in the given in page reply container. The form\n     * display will be animated.\n     *\n     * @param {Object} postContainer jQuery element for the post container\n     */\n    return async(postContainer) => {\n\n        const inPageReplyContainer = getInPageReplyContainer(postContainer);\n        const repliesVisibilityToggleContainer = getRepliesVisibilityToggleContainer(postContainer);\n        const inPageReplyCreateButton = getInPageReplyCreateButton(postContainer);\n\n        if (!hasInPageReplyForm(inPageReplyContainer)) {\n            try {\n                const html = await renderInPageReplyTemplate(additionalTemplateContext, inPageReplyCreateButton, postContainer);\n                Templates.appendNodeContents(inPageReplyContainer, html, '');\n            } catch (e) {\n                Notification.exception(e);\n            }\n\n            FormChangeChecker.watchForm(postContainer[0].querySelector('form'));\n        }\n\n        inPageReplyCreateButton.fadeOut(ANIMATION_DURATION, () => {\n            const inPageReplyForm = getInPageReplyForm(postContainer);\n            inPageReplyForm.slideDown({\n                duration: ANIMATION_DURATION,\n                queue: false,\n                complete: () => {\n                    inPageReplyForm.find('textarea').focus();\n                }\n            }).css('display', 'none').fadeIn(ANIMATION_DURATION);\n\n            if (repliesVisibilityToggleContainer.length && hasReplies(postContainer)) {\n                repliesVisibilityToggleContainer.fadeIn(ANIMATION_DURATION);\n                hideReplies(postContainer);\n            }\n        });\n    };\n};\n\n/**\n * Hide the in page reply form in the given in page reply container. The form\n * display will be animated.\n *\n * @param {Object} postContainer jQuery element for the post container\n * @param {Number|null} postIdToSee Id of the post to scroll into view (if any)\n */\nconst hideInPageReplyForm = (postContainer, postIdToSee = null) => {\n    const inPageReplyForm = getInPageReplyForm(postContainer);\n    const inPageReplyCreateButton = getInPageReplyCreateButton(postContainer);\n    const repliesVisibilityToggleContainer = getRepliesVisibilityToggleContainer(postContainer);\n\n    if (repliesVisibilityToggleContainer.length && hasReplies(postContainer)) {\n        repliesVisibilityToggleContainer.fadeOut(ANIMATION_DURATION);\n        if (!repliesVisible(postContainer)) {\n            showReplies(postContainer, postIdToSee);\n        }\n    }\n\n    inPageReplyForm.slideUp({\n        duration: ANIMATION_DURATION,\n        queue: false,\n        complete: () => {\n            inPageReplyCreateButton.fadeIn(ANIMATION_DURATION);\n        }\n    }).fadeOut(200);\n};\n\n/**\n * Check if the in page reply container contains the in page reply form.\n *\n * @param {Object} inPageReplyContainer jQuery element for the in page reply container\n * @return {Bool}\n */\nconst hasInPageReplyForm = (inPageReplyContainer) => {\n    return inPageReplyContainer.find(Selectors.post.inpageReplyContent).length > 0;\n};\n\n/**\n * Render the template to generate the in page reply form HTML.\n *\n * @param {Object} additionalTemplateContext Additional render context for the in page reply template\n * @param {Object} button jQuery element for the reply button that was clicked\n * @param {Object} postContainer jQuery element for the post container\n * @return {Object} jQuery promise\n */\nconst renderInPageReplyTemplate = (additionalTemplateContext, button, postContainer) => {\n    const postContentContainer = getPostContentContainer(postContainer);\n    const currentSubject = postContentContainer.find(Selectors.post.forumSubject).text();\n    const currentAuthorName = postContentContainer.find(Selectors.post.authorName).text();\n    const context = {\n        postid: postContainer.data('post-id'),\n        \"reply_url\": button.attr('data-href'),\n        sesskey: M.cfg.sesskey,\n        parentsubject: currentSubject,\n        parentauthorname: currentAuthorName,\n        canreplyprivately: button.data('can-reply-privately'),\n        postformat: InPageReply.CONTENT_FORMATS.MOODLE,\n        ...additionalTemplateContext\n    };\n\n    return Templates.render('mod_forum/inpage_reply_v2', context);\n};\n\n/**\n * Increment the total reply count in the show/hide replies buttons for the post.\n *\n * @param {Object} postContainer jQuery element for the post container\n */\nconst incrementTotalReplyCount = (postContainer) => {\n    getRepliesVisibilityToggleContainer(postContainer).find(Selectors.post.replyCount).each((index, element) => {\n        const currentCount = parseInt(element.innerText, 10);\n        element.innerText = currentCount + 1;\n    });\n};\n\n/**\n * Create all of the event listeners for the discussion.\n *\n * @param {Object} root jQuery element for the discussion container\n */\nconst registerEventListeners = (root) => {\n    CustomEvents.define(root, [CustomEvents.events.activate]);\n    // Auto expanding text area for in page reply.\n    AutoRows.init(root);\n\n    // Reply button is clicked.\n    root.on(CustomEvents.events.activate, Selectors.post.inpageReplyCreateButton, (e, data) => {\n        data.originalEvent.preventDefault();\n        const postContainer = getPostContainer($(e.currentTarget));\n        showInPageReplyForm(postContainer);\n    });\n\n    // Cancel in page reply button.\n    root.on(CustomEvents.events.activate, Selectors.post.inpageReplyCancelButton, (e, data) => {\n        data.originalEvent.preventDefault();\n        const postContainer = getPostContainer($(e.currentTarget));\n        hideInPageReplyForm(postContainer);\n    });\n\n    // Show replies button clicked.\n    root.on(CustomEvents.events.activate, Selectors.post.showReplies, (e, data) => {\n        data.originalEvent.preventDefault();\n        const postContainer = getPostContainer($(e.target));\n        showReplies(postContainer);\n    });\n\n    // Hide replies button clicked.\n    root.on(CustomEvents.events.activate, Selectors.post.hideReplies, (e, data) => {\n        data.originalEvent.preventDefault();\n        const postContainer = getPostContainer($(e.target));\n        hideReplies(postContainer);\n    });\n\n    // Post created with in page reply.\n    root.on(InPageReply.EVENTS.POST_CREATED, Selectors.post.inpageSubmitBtn, (e, newPostId) => {\n        const currentTarget = $(e.currentTarget);\n        const postContainer = getPostContainer(currentTarget);\n        const postContainers = getParentPostContainers(currentTarget);\n        hideInPageReplyForm(postContainer, newPostId);\n\n        postContainers.each((index, container) => {\n            incrementTotalReplyCount($(container));\n        });\n    });\n};\n\n/**\n * Initialise the javascript for the discussion in nested v2 display mode.\n *\n * @param {Object} root jQuery element for the discussion container\n * @param {Object} context Additional render context for the in page reply template\n */\nexport const init = (root, context) => {\n    // Build the showInPageReplyForm function with the additional render context.\n    showInPageReplyForm = buildShowInPageReplyFormFunction(context);\n    // Add discussion event listeners.\n    registerEventListeners(root);\n    // Initialise default discussion javascript (keyboard nav etc).\n    Discussion.init(root);\n    // Add in page reply javascript.\n    InPageReply.init(root);\n\n    // Initialise the settings menu javascript.\n    const discussionToolsContainer = root.find(Selectors.discussion.tools);\n    LockToggle.init(discussionToolsContainer, false);\n    FavouriteToggle.init(discussionToolsContainer, false, (toggleElement, response) => {\n        const newTargetState = response.userstate.favourited ? 0 : 1;\n        return toggleElement.data('targetstate', newTargetState);\n    });\n    Pin.init(discussionToolsContainer, false, (toggleElement, response) => {\n        const newTargetState = response.pinned ? 0 : 1;\n        return toggleElement.data('targetstate', newTargetState);\n    });\n    Subscribe.init(discussionToolsContainer, false, (toggleElement, response) => {\n        const newTargetState = response.userstate.subscribed ? 0 : 1;\n        toggleElement.data('targetstate', newTargetState);\n    });\n};\n"],"file":"discussion_nested_v2.min.js"}