define ("mod_forum/discussion",["jquery","core/custom_interaction_events","mod_forum/selectors","core/pubsub","mod_forum/forum_events","core/str","core/notification"],function($,CustomEvents,Selectors,PubSub,ForumEvents,String,Notification){var focusPreviousPost=function(currentPost){var prevPost=currentPost.prev(Selectors.post.post);if(prevPost.length){var replyPost=prevPost.find(Selectors.post.post).last();if(replyPost.length){replyPost.focus()}else{prevPost.focus()}}else{currentPost.parents(Selectors.post.post).first().focus()}},focusNextPost=function(currentPost){var replyPost=currentPost.find(Selectors.post.post).first();if(replyPost.length){replyPost.focus()}else{var siblingPost=currentPost.next(Selectors.post.post);if(siblingPost.length){siblingPost.focus()}else{for(var parentPosts=currentPost.parents(Selectors.post.post).toArray(),i=0,ancestorSiblingPost;i<parentPosts.length;i++){ancestorSiblingPost=$(parentPosts[i]).next(Selectors.post.post);if(ancestorSiblingPost.length){ancestorSiblingPost.focus();break}}}}},isElementInInPageReplySection=function(element){var inPageReply=$(element).closest(Selectors.post.inpageReplyContent);return inPageReply.length?!0:!1},initAccessibilityKeyboardNav=function(root){var posts=root.find(Selectors.post.post);posts.each(function(index,post){var actions=$(post).find(Selectors.post.action),firstAction=actions.first();actions.attr("tabindex","-1");firstAction.attr("tabindex",0)});CustomEvents.define(root,[CustomEvents.events.up,CustomEvents.events.down,CustomEvents.events.next,CustomEvents.events.previous,CustomEvents.events.home,CustomEvents.events.end]);root.on(CustomEvents.events.up,function(e,data){var activeElement=document.activeElement;if(isElementInInPageReplySection(activeElement)){return}var focusPost=$(activeElement).closest(Selectors.post.post);if(focusPost.length){focusPreviousPost(focusPost)}else{root.find(Selectors.post.post).first().focus()}data.originalEvent.preventDefault()});root.on(CustomEvents.events.down,function(e,data){var activeElement=document.activeElement;if(isElementInInPageReplySection(activeElement)){return}var focusPost=$(activeElement).closest(Selectors.post.post);if(focusPost.length){focusNextPost(focusPost)}else{root.find(Selectors.post.post).first().focus()}data.originalEvent.preventDefault()});root.on(CustomEvents.events.home,function(e,data){if(isElementInInPageReplySection(document.activeElement)){return}root.find(Selectors.post.post).first().focus();data.originalEvent.preventDefault()});root.on(CustomEvents.events.end,function(e,data){if(isElementInInPageReplySection(document.activeElement)){return}root.find(Selectors.post.post).last().focus();data.originalEvent.preventDefault()});root.on(CustomEvents.events.next,Selectors.post.action,function(e,data){var currentAction=$(e.target),container=currentAction.closest(Selectors.post.actionsContainer),actions=container.find(Selectors.post.action),nextAction=currentAction.next(Selectors.post.action);actions.attr("tabindex","-1");if(!nextAction.length){nextAction=actions.first()}nextAction.attr("tabindex",0);nextAction.focus();data.originalEvent.preventDefault()});root.on(CustomEvents.events.previous,Selectors.post.action,function(e,data){var currentAction=$(e.target),container=currentAction.closest(Selectors.post.actionsContainer),actions=container.find(Selectors.post.action),nextAction=currentAction.prev(Selectors.post.action);actions.attr("tabindex","-1");if(!nextAction.length){nextAction=actions.last()}nextAction.attr("tabindex",0);nextAction.focus();data.originalEvent.preventDefault()});root.on(CustomEvents.events.home,Selectors.post.action,function(e,data){var currentAction=$(e.target),container=currentAction.closest(Selectors.post.actionsContainer),actions=container.find(Selectors.post.action),firstAction=actions.first();actions.attr("tabindex","-1");firstAction.attr("tabindex",0);firstAction.focus();e.stopPropagation();data.originalEvent.preventDefault()});root.on(CustomEvents.events.end,Selectors.post.action,function(e,data){var currentAction=$(e.target),container=currentAction.closest(Selectors.post.actionsContainer),actions=container.find(Selectors.post.action),lastAction=actions.last();actions.attr("tabindex","-1");lastAction.attr("tabindex",0);lastAction.focus();e.stopPropagation();data.originalEvent.preventDefault()});PubSub.subscribe(ForumEvents.SUBSCRIPTION_TOGGLED,function(data){var subscribed=data.subscriptionState,updateMessage=subscribed?"discussionsubscribed":"discussionunsubscribed";String.get_string(updateMessage,"forum").then(function(s){return Notification.addNotification({message:s,type:"info"})}).catch(Notification.exception)})};return{init:function(root){initAccessibilityKeyboardNav(root)}}});
//# sourceMappingURL=discussion.min.js.map
