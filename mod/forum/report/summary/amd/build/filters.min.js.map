{"version":3,"sources":["../src/filters.js"],"names":["init","root","jqRoot","document","ready","hide","removeClass","generateWithFilters","event","getparams","currentLink","forms","filtersform","action","newLink","preventDefault","currentSplit","split","currentstring","newparamsarray","paramsstring","paramkeys","paramvalues","forEach","param","splitparam","push","paramstring","newparam","existingkey","indexOf","name","key","substr","submit","on","target","search","selectperpage","onsubmit","getparam","elements","perpage","value","downloadForm","getElementById","querySelector","downloadType","getParams","prevAction","submitWithFilter","containerelement","FormChangeChecker","unWatchForm","addClass","updateCalendarPosition","referenceid","referenceElement","popperContent","Selectors","filters","date","calendar","style","removeProperty","Popper","placement","closeOpenFilters","openFilterButton","openFilter","classList","add","setAttribute","remove","CustomEvents","events","activate","group","selectall","deselected","querySelectorAll","checkbox","checked","clear","selected","trigger","popover","closeListener","e","id","closest","keyCode","KeyCodes","enter","space","removeEventListener","escCloseListener","addEventListener","escape","save","popcheckboxes","popcheckbox","saveid","getAttribute","exportlink","link","exportbutton","exportlinkform","dataset","url","focus","filtersForm","datesPopover","fromEnabled","toEnabled","args","data","Ajax","call","methodname","done","result","fromTimestamp","toTimestamp","timestamps","timestamp","warningdiv","calendariconfrom","calendariconto"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module responsible for handling forum summary report filters.\n *\n * @module     forumreport_summary/filters\n * @copyright  2019 Michael Hawkins <michaelh@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Popper from 'core/popper';\nimport CustomEvents from 'core/custom_interaction_events';\nimport Selectors from 'forumreport_summary/selectors';\nimport Ajax from 'core/ajax';\nimport KeyCodes from 'core/key_codes';\nimport * as FormChangeChecker from 'core_form/changechecker';\n\nexport const init = (root) => {\n    let jqRoot = $(root);\n\n    // Hide loading spinner and show report once page is ready.\n    // This ensures filters can be applied when sorting by columns.\n    $(document).ready(function() {\n        $('.loading-icon').hide();\n        $('#summaryreport').removeClass('hidden');\n    });\n\n    // Generic filter handlers.\n\n    // Called to override click event to trigger a proper generate request with filtering.\n    const generateWithFilters = (event, getparams) => {\n        let currentLink = document.forms.filtersform.action,\n            newLink;\n\n        if (event) {\n            event.preventDefault();\n\n           let currentSplit = currentLink.split('?'),\n               currentstring = currentSplit[1],\n               newparamsarray = getparams.split('&'),\n               paramsstring = '',\n               paramkeys = [],\n               paramvalues = [];\n\n            // Separate out the existing action GET param string.\n            currentstring.split('&').forEach(function(param) {\n                let splitparam = param.split('=');\n                paramkeys.push(splitparam[0]);\n                paramvalues.push(splitparam[1]);\n            });\n\n            newparamsarray.forEach(function(paramstring) {\n                let newparam = paramstring.split('='),\n                    existingkey = paramkeys.indexOf(newparam[0]);\n\n                // Overwrite value if existing, otherwise add new param.\n                if (existingkey > -1) {\n                    paramvalues[existingkey] = newparam[1];\n                } else {\n                    paramkeys.push(newparam[0]);\n                    paramvalues.push(newparam[1]);\n                }\n            });\n\n            // Build URL.\n            paramkeys.forEach(function(name, key) {\n                paramsstring += `&${name}=${paramvalues[key]}`;\n            });\n\n            newLink = currentSplit[0] + '?' + paramsstring.substr(1);\n        } else {\n            newLink = currentLink;\n        }\n\n        document.forms.filtersform.action = newLink;\n        document.forms.filtersform.submit();\n    };\n\n    // Override 'reset table preferences' so it generates with filters.\n    $('.resettable').on(\"click\", \"a\", function(event) {\n        generateWithFilters(event, event.target.search.substr(1));\n    });\n\n    // Override table heading sort links so they generate with filters.\n    $('thead').on(\"click\", \"a\", function(event) {\n        generateWithFilters(event, event.target.search.substr(1));\n    });\n\n    // Override pagination page links so they generate with filters.\n    $('.pagination').on(\"click\", \"a\", function(event) {\n        generateWithFilters(event, event.target.search.substr(1));\n    });\n\n    // Override rows per page submission so it generates with filters.\n    if (document.forms.selectperpage) {\n        document.forms.selectperpage.onsubmit = (event) => {\n            let getparam = 'perpage=' + document.forms.selectperpage.elements.perpage.value;\n            generateWithFilters(event, getparam);\n        };\n    }\n\n    // Override download link so the file is generated with filters.\n    const downloadForm = document.getElementById('summaryreport').querySelector('form.dataformatselector');\n    if (downloadForm) {\n        downloadForm.onsubmit = (event) => {\n            const downloadType = downloadForm.querySelector('#downloadtype_download').value;\n            const getParams = `download=${downloadType}`;\n            const prevAction = document.forms.filtersform.action;\n\n            generateWithFilters(event, getParams);\n\n            // Revert action, so re-submitting the form via filter does not trigger a further download.\n            document.forms.filtersform.action = prevAction;\n        };\n    }\n\n    // Submit report via filter\n    const submitWithFilter = (containerelement) => {\n        // Disable the dates filter mform checker to prevent any changes triggering a warning to the user.\n        FormChangeChecker.unWatchForm(document.forms.filtersform);\n\n        // Close the container (eg popover).\n        $(containerelement).addClass('hidden');\n\n        // Submit the filter values and re-generate report.\n        generateWithFilters(false);\n    };\n\n    // Use popper to override date mform calendar position.\n    const updateCalendarPosition = (referenceid) => {\n        let referenceElement = document.querySelector(referenceid),\n            popperContent = document.querySelector(Selectors.filters.date.calendar);\n\n        popperContent.style.removeProperty(\"z-index\");\n        new Popper(referenceElement, popperContent, {placement: 'bottom'});\n    };\n\n    // Close the relevant filter.\n    const closeOpenFilters = (openFilterButton, openFilter) => {\n        openFilter.classList.add('hidden');\n        openFilter.setAttribute('data-openfilter', 'false');\n\n        openFilterButton.classList.add('btn-primary');\n        openFilterButton.classList.remove('btn-outline-primary');\n        openFilterButton.setAttribute('aria-expanded', false);\n    };\n\n    // Groups filter specific handlers.\n\n    // Event handler for clicking select all groups.\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.group.selectall, function() {\n        let deselected = root.querySelectorAll(Selectors.filters.group.checkbox + ':not(:checked)');\n        deselected.forEach(function(checkbox) {\n            checkbox.checked = true;\n        });\n    });\n\n    // Event handler for clearing filter by clicking option.\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.group.clear, function() {\n        // Clear checkboxes.\n        let selected = root.querySelectorAll(Selectors.filters.group.checkbox + ':checked');\n        selected.forEach(function(checkbox) {\n            checkbox.checked = false;\n        });\n    });\n\n    // Event handler for showing groups filter popover.\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.group.trigger, function() {\n        // Create popover.\n        let referenceElement = root.querySelector(Selectors.filters.group.trigger),\n            popperContent = root.querySelector(Selectors.filters.group.popover);\n\n        new Popper(referenceElement, popperContent, {placement: 'bottom'});\n\n        // Show popover.\n        popperContent.classList.remove('hidden');\n        popperContent.setAttribute('data-openfilter', 'true');\n\n        // Change to outlined button.\n        referenceElement.classList.add('btn-outline-primary');\n        referenceElement.classList.remove('btn-primary');\n\n        // Let screen readers know that it's now expanded.\n        referenceElement.setAttribute('aria-expanded', true);\n\n        // Add listeners to handle closing filter.\n        const closeListener = e => {\n            if (e.target.id !== referenceElement.id && popperContent !== e.target.closest('[data-openfilter=\"true\"]') &&\n                    (typeof e.keyCode === 'undefined' || e.keyCode === KeyCodes.enter || e.keyCode === KeyCodes.space)) {\n                closeOpenFilters(referenceElement, popperContent);\n                document.removeEventListener('click', closeListener);\n                document.removeEventListener('keyup', closeListener);\n                document.removeEventListener('keyup', escCloseListener);\n            }\n        };\n\n        document.addEventListener('click', closeListener);\n        document.addEventListener('keyup', closeListener);\n\n        const escCloseListener = e => {\n            if (e.keyCode === KeyCodes.escape) {\n                closeOpenFilters(referenceElement, popperContent);\n                document.removeEventListener('keyup', escCloseListener);\n                document.removeEventListener('click', closeListener);\n            }\n        };\n\n        document.addEventListener('keyup', escCloseListener);\n    });\n\n    // Event handler to click save groups filter.\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.group.save, function() {\n        // Copy the saved values into the form before submitting.\n        let popcheckboxes = root.querySelectorAll(Selectors.filters.group.checkbox);\n\n        popcheckboxes.forEach(function(popcheckbox) {\n            let filtersform = document.forms.filtersform,\n                saveid = popcheckbox.getAttribute('data-saveid');\n\n            filtersform.querySelector(`#${saveid}`).checked = popcheckbox.checked;\n        });\n\n        submitWithFilter('#filter-groups-popover');\n    });\n\n    // Listeners for export buttons.\n    // These allow fetching of the relevant export URL, before submitting the request with\n    // any POST data that is common to all of the export links. This allows filters to be\n    // applied that contain potentially a lot of data (eg discussion IDs for groups filtering).\n    document.querySelectorAll(Selectors.filters.exportlink.link).forEach(function(exportbutton) {\n        exportbutton.addEventListener('click', function(event) {\n            document.forms.exportlinkform.action = event.target.dataset.url;\n            document.forms.exportlinkform.submit();\n        });\n    });\n\n    // Dates filter specific handlers.\n\n   // Event handler for showing dates filter popover.\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.date.trigger, function() {\n\n        // Create popover.\n        let referenceElement = root.querySelector(Selectors.filters.date.trigger),\n            popperContent = root.querySelector(Selectors.filters.date.popover);\n\n        new Popper(referenceElement, popperContent, {placement: 'bottom'});\n\n        // Show popover and move focus.\n        popperContent.classList.remove('hidden');\n        popperContent.setAttribute('data-openfilter', 'true');\n        popperContent.querySelector('[name=\"filterdatefrompopover[enabled]\"]').focus();\n\n        // Change to outlined button.\n        referenceElement.classList.add('btn-outline-primary');\n        referenceElement.classList.remove('btn-primary');\n\n        // Let screen readers know that it's now expanded.\n        referenceElement.setAttribute('aria-expanded', true);\n\n        // Add listener to handle closing filter.\n        const closeListener = e => {\n            if (e.target.id !== referenceElement.id && popperContent !== e.target.closest('[data-openfilter=\"true\"]') &&\n                    (typeof e.keyCode === 'undefined' || e.keyCode === KeyCodes.enter || e.keyCode === KeyCodes.space)) {\n                closeOpenFilters(referenceElement, popperContent);\n                document.removeEventListener('click', closeListener);\n                document.removeEventListener('keyup', closeListener);\n                document.removeEventListener('keyup', escCloseListener);\n            }\n        };\n\n        document.addEventListener('click', closeListener);\n        document.addEventListener('keyup', closeListener);\n\n        const escCloseListener = e => {\n            if (e.keyCode === KeyCodes.escape) {\n                closeOpenFilters(referenceElement, popperContent);\n                document.removeEventListener('keyup', escCloseListener);\n                document.removeEventListener('click', closeListener);\n            }\n        };\n\n        document.addEventListener('keyup', escCloseListener);\n    });\n\n    // Event handler to save dates filter.\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.date.save, function() {\n        // Populate the hidden form inputs to submit the data.\n        let filtersForm = document.forms.filtersform;\n        const datesPopover = root.querySelector(Selectors.filters.date.popover);\n        const fromEnabled = datesPopover.querySelector('[name=\"filterdatefrompopover[enabled]\"]').checked ? 1 : 0;\n        const toEnabled = datesPopover.querySelector('[name=\"filterdatetopopover[enabled]\"]').checked ? 1 : 0;\n\n        if (!fromEnabled && !toEnabled) {\n            // Update the elements in the filter form.\n            filtersForm.elements['datefrom[timestamp]'].value = 0;\n            filtersForm.elements['datefrom[enabled]'].value = fromEnabled;\n            filtersForm.elements['dateto[timestamp]'].value = 0;\n            filtersForm.elements['dateto[enabled]'].value = toEnabled;\n\n            // Submit the filter values and re-generate report.\n            submitWithFilter('#filter-dates-popover');\n        } else {\n            let args = {data: []};\n\n            if (fromEnabled) {\n                args.data.push({\n                    'key': 'from',\n                    'year': datesPopover.querySelector('[name=\"filterdatefrompopover[year]\"]').value,\n                    'month': datesPopover.querySelector('[name=\"filterdatefrompopover[month]\"]').value,\n                    'day': datesPopover.querySelector('[name=\"filterdatefrompopover[day]\"]').value,\n                    'hour': 0,\n                    'minute': 0\n                });\n            }\n\n            if (toEnabled) {\n                args.data.push({\n                    'key': 'to',\n                    'year': datesPopover.querySelector('[name=\"filterdatetopopover[year]\"]').value,\n                    'month': datesPopover.querySelector('[name=\"filterdatetopopover[month]\"]').value,\n                    'day': datesPopover.querySelector('[name=\"filterdatetopopover[day]\"]').value,\n                    'hour': 23,\n                    'minute': 59\n                });\n            }\n\n            const request = {\n                methodname: 'core_calendar_get_timestamps',\n                args: args\n            };\n\n            Ajax.call([request])[0].done(function(result) {\n                let fromTimestamp = 0,\n                    toTimestamp = 0;\n\n                result.timestamps.forEach(function(data) {\n                    if (data.key === 'from') {\n                        fromTimestamp = data.timestamp;\n                    } else if (data.key === 'to') {\n                        toTimestamp = data.timestamp;\n                    }\n                });\n\n                // Display an error if the from date is later than the do date.\n                if (toTimestamp > 0 && fromTimestamp > toTimestamp) {\n                    const warningdiv = document.getElementById('dates-filter-warning');\n                    warningdiv.classList.remove('hidden');\n                    warningdiv.classList.add('d-block');\n                } else {\n                    filtersForm.elements['datefrom[timestamp]'].value = fromTimestamp;\n                    filtersForm.elements['datefrom[enabled]'].value = fromEnabled;\n                    filtersForm.elements['dateto[timestamp]'].value = toTimestamp;\n                    filtersForm.elements['dateto[enabled]'].value = toEnabled;\n\n                    // Submit the filter values and re-generate report.\n                    submitWithFilter('#filter-dates-popover');\n                }\n            });\n        }\n    });\n\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.date.calendariconfrom, function() {\n        updateCalendarPosition(Selectors.filters.date.calendariconfrom);\n    });\n\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.date.calendariconto, function() {\n        updateCalendarPosition(Selectors.filters.date.calendariconto);\n    });\n};\n"],"file":"filters.min.js"}