define ("mod_assign/grading_navigation_user_info",["jquery","core/notification","core/ajax","core/templates"],function($,notification,ajax,templates){var UserInfo=function(selector){this._regionSelector=selector;this._region=$(selector);this._userCache={};$(document).on("user-changed",this._refreshUserInfo.bind(this))};UserInfo.prototype._regionSelector=null;UserInfo.prototype._userCache=null;UserInfo.prototype._region=null;UserInfo.prototype._lastUserId=0;UserInfo.prototype._getAssignmentId=function(){return this._region.attr("data-assignmentid")};UserInfo.prototype._refreshUserInfo=function(event,userid){var promise=$.Deferred();this._region.attr("data-userid",userid);if(this._lastUserId==userid){return}this._lastUserId=userid;templates.render("mod_assign/loading",{}).done(function(html,js){this._region.fadeOut("fast",function(){templates.replaceNodeContents(this._region,html,js);this._region.fadeIn("fast")}.bind(this));if(0>userid){templates.render("mod_assign/grading_navigation_no_users",{}).done(function(html,js){if(userid==this._lastUserId){this._region.fadeOut("fast",function(){templates.replaceNodeContents(this._region,html,js);this._region.fadeIn("fast")}.bind(this))}}.bind(this)).fail(notification.exception);return}if("undefined"!=typeof this._userCache[userid]){promise.resolve(this._userCache[userid])}else{var assignmentId=this._getAssignmentId(),requests=ajax.call([{methodname:"mod_assign_get_participant",args:{userid:userid,assignid:assignmentId,embeduser:!0}}]);requests[0].done(function(participant){if(!participant.hasOwnProperty("id")){promise.reject("No users")}else{this._userCache[userid]=participant;promise.resolve(this._userCache[userid])}}.bind(this)).fail(notification.exception)}promise.done(function(context){var identityfields=$("[data-showuseridentity]").data("showuseridentity").split(","),identity=[];context.courseid=$("[data-region=\"grading-navigation-panel\"]").attr("data-courseid");if(context.user){$.each(identityfields,function(i,k){if("undefined"!=typeof context.user[k]&&""!==context.user[k]){context.hasidentity=!0;identity.push(context.user[k])}});context.identity=identity.join(", ");if(context.user.profileimageurl){context.profileimageurl=context.user.profileimageurl}}templates.render("mod_assign/grading_navigation_user_summary",context).done(function(html,js){if(userid==this._lastUserId){this._region.fadeOut("fast",function(){templates.replaceNodeContents(this._region,html,js);this._region.fadeIn("fast")}.bind(this))}}.bind(this)).fail(notification.exception)}.bind(this)).fail(function(){templates.render("mod_assign/grading_navigation_no_users",{}).done(function(html,js){this._region.fadeOut("fast",function(){templates.replaceNodeContents(this._region,html,js);this._region.fadeIn("fast")}.bind(this))}.bind(this)).fail(notification.exception)}.bind(this))}.bind(this)).fail(notification.exception)};return UserInfo});
//# sourceMappingURL=grading_navigation_user_info.min.js.map
