define ("mod_bigbluebuttonbn/modform",["exports","core/str","core/notification","core/templates"],function(_exports,_str,_notification,_templates){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.init=void 0;_notification=_interopRequireDefault(_notification);_templates=_interopRequireDefault(_templates);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}var ELEMENT_SELECTOR={instanceTypeSelection:function instanceTypeSelection(){return document.querySelector("select#id_type")},instanceTypeProfiles:function instanceTypeProfiles(){return document.querySelector("[data-profile-types]")},participantData:function participantData(){return document.querySelector("[data-participant-data]")},participantList:function participantList(){return document.getElementsByName("participants")[0]},participantTable:function participantTable(){return document.getElementById("participant_list_table")},participantSelectionType:function participantSelectionType(){return document.getElementsByName("bigbluebuttonbn_participant_selection_type")[0]},participantSelection:function participantSelection(){return document.getElementsByName("bigbluebuttonbn_participant_selection")[0]},participantAddButton:function participantAddButton(){return document.getElementsByName("bigbluebuttonbn_participant_selection_add")[0]}};_exports.init=function init(info){var selectedType=ELEMENT_SELECTOR.instanceTypeSelection(),instanceTypeProfiles=JSON.parse(ELEMENT_SELECTOR.instanceTypeProfiles().dataset.profileTypes),profileType=info.instanceTypeDefault;if(null!==selectedType&&-1!==selectedType.selectedIndex){profileType=selectedType.options[selectedType.selectedIndex].value}var isFeatureEnabled=function(profileType,feature){var features=instanceTypeProfiles[profileType].features;return-1!==features.indexOf(feature)};applyInstanceTypeProfile(profileType,isFeatureEnabled);selectedType.addEventListener("change",function(e){applyInstanceTypeProfile(e.target.value,isFeatureEnabled)});ELEMENT_SELECTOR.participantSelectionType().addEventListener("change",function(e){var currentTypeSelect=e.target;updateSelectionFromType(currentTypeSelect)});ELEMENT_SELECTOR.participantAddButton().addEventListener("click",function(e){e.stopPropagation();e.preventDefault();participantAddFromCurrentSelection()});participantListInit()};var applyInstanceTypeProfile=function(profileType,isFeatureEnabled){var showAll=isFeatureEnabled(profileType,"all"),showFieldset=function(id,show){var node=document.querySelector("#"+id);if(!node){return}if(show){node.style.display="block";return}node.style.display="none"},showInput=function(id,show){var node=document.querySelector("#"+id);if(!node){return}var ancestor=node.closest("div").closest("div");if(show){ancestor.style.display="block";return}ancestor.style.display="none"},showFormGroup=function(id,show){var node=document.querySelector("#fgroup_id_"+id);if(!node){return}if(show){node.classList.remove("hidden");return}node.classList.add("hidden")};showFieldset("id_room",showAll||isFeatureEnabled(profileType,"showroom"));showInput("id_record",showAll||isFeatureEnabled(profileType,"showroom"));showFieldset("id_recordings",showAll||isFeatureEnabled(profileType,"showrecordings"));showInput("id_recordings_imported",showAll||isFeatureEnabled(profileType,"showrecordings"));showFieldset("id_preuploadpresentation",showAll||isFeatureEnabled(profileType,"preuploadpresentation"));showFieldset("id_permissions",showAll||isFeatureEnabled(profileType,"permissions"));showFieldset("id_schedule",showAll||isFeatureEnabled(profileType,"schedule"));showFieldset("id_modstandardelshdr",showAll||isFeatureEnabled(profileType,"modstandardelshdr"));showFieldset("id_availabilityconditionsheader",showAll||isFeatureEnabled(profileType,"availabilityconditionsheader"));showFieldset("id_tagshdr",showAll||isFeatureEnabled(profileType,"tagshdr"));showFieldset("id_competenciessection",showAll||isFeatureEnabled(profileType,"competenciessection"));showFormGroup("completionattendancegroup",showAll||isFeatureEnabled(profileType,"completionattendance"));showFormGroup("completionengagementgroup",showAll||isFeatureEnabled(profileType,"completionengagement"))},participantListInit=function(){var participantData=JSON.parse(ELEMENT_SELECTOR.participantData().dataset.participantData),participantList=getParticipantList();participantList.forEach(function(participant){var selectionTypeValue=participant.selectiontype,selectionValue=participant.selectionid,selectionRole=participant.role;if("all"===participant.selectiontype||"undefined"!=typeof participantData[participant.selectiontype].children[participant.selectionid]){participantAddToForm(selectionTypeValue,selectionValue,selectionRole,!0).then()}})},participantAddToForm=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(selectionTypeValue,selectionValue,selectedRole,canRemove){var participantData,sviewer,smoderator,roles,listTable,templateContext,_yield$Templates$rend,html,js,newNode,removeNode;return regeneratorRuntime.wrap(function(_context){while(1){switch(_context.prev=_context.next){case 0:participantData=JSON.parse(ELEMENT_SELECTOR.participantData().dataset.participantData);_context.next=3;return(0,_str.get_string)("mod_form_field_participant_bbb_role_viewer","mod_bigbluebuttonbn");case 3:sviewer=_context.sent;_context.next=6;return(0,_str.get_string)("mod_form_field_participant_bbb_role_moderator","mod_bigbluebuttonbn");case 6:smoderator=_context.sent;roles={viewer:{id:"viewer",label:sviewer},moderator:{id:"moderator",label:smoderator}};roles[selectedRole].isselected=!0;_context.prev=9;listTable=document.querySelector("#participant_list_table tbody");templateContext={selectiontypevalue:selectionTypeValue,selectionvalue:selectionValue,participanttype:participantData[selectionTypeValue].name,participantvalue:"all"!==selectionTypeValue?participantData[selectionTypeValue].children[selectionValue].name:null,roles:Object.values(roles),canRemove:canRemove};_context.next=14;return _templates.default.renderForPromise("mod_bigbluebuttonbn/participant_form_add",templateContext);case 14:_yield$Templates$rend=_context.sent;html=_yield$Templates$rend.html;js=_yield$Templates$rend.js;newNode=_templates.default.appendNodeContents(listTable,html,js)[0];newNode.querySelector(".participant-select").addEventListener("change",function(){participantListRoleUpdate(selectionTypeValue,selectionValue)});removeNode=newNode.querySelector(".remove-button");if(removeNode){removeNode.addEventListener("click",function(){participantRemove(selectionTypeValue,selectionValue)})}_context.next=26;break;case 23:_context.prev=23;_context.t0=_context["catch"](9);_notification.default.exception(_context.t0);case 26:case"end":return _context.stop();}}},_callee,null,[[9,23]])}));return function(){return _ref.apply(this,arguments)}}(),participantListUpdate=function(list){var participantList=ELEMENT_SELECTOR.participantList();participantList.value=JSON.stringify(list)},getParticipantList=function(){var participantListValue=ELEMENT_SELECTOR.participantList().value;if(participantListValue){return JSON.parse(participantListValue)}return[]},participantRemove=function(selectionTypeValue,selectionValue){for(var pList=getParticipantList(),id="participant_list_tr_"+selectionTypeValue+"-"+selectionValue,participantListTable=ELEMENT_SELECTOR.participantTable(),selectionid=""===selectionValue?null:selectionValue,i=0;i<pList.length;i++){if(pList[i].selectiontype===selectionTypeValue&&pList[i].selectionid===selectionid){pList.splice(i,1)}}for(var _i=0;_i<participantListTable.rows.length;_i++){if(participantListTable.rows[_i].id===id){participantListTable.deleteRow(_i)}}participantListUpdate(pList)},participantListRoleUpdate=function(type,id){for(var participantListRoleSelection=document.querySelector("#participant_list_tr_".concat(type,"-").concat(id," .participant-select")),pList=getParticipantList(),i=0;i<pList.length;i++){if(pList[i].selectiontype===type&&pList[i].selectionid===id){pList[i].role=participantListRoleSelection.value}}participantListUpdate(pList)},participantAddFromCurrentSelection=function(){for(var selectionType=ELEMENT_SELECTOR.participantSelectionType(),selection=ELEMENT_SELECTOR.participantSelection(),pList=getParticipantList(),i=0;i<pList.length;i++){if(pList[i].selectiontype===selectionType.value&&pList[i].selectionid===selection.value){return}}pList.push({selectiontype:selectionType.value,selectionid:selection.value,role:"viewer"});participantAddToForm(selectionType.value,selection.value,"viewer",!0).then();participantListUpdate(pList)},updateSelectionFromType=function(currentTypeSelect){var createNewOption=function(selectItem,label,value){var option=document.createElement("option");option.text=label;option.value=value;selectItem.add(option)},participantData=JSON.parse(ELEMENT_SELECTOR.participantData().dataset.participantData),participantSelect=ELEMENT_SELECTOR.participantSelection();while(participantSelect.firstChild){participantSelect.removeChild(participantSelect.firstChild)}if(-1!==currentTypeSelect.selectedIndex){var options=Object.values(participantData[currentTypeSelect.value].children);options.forEach(function(option){createNewOption(participantSelect,option.name,option.id)});if("all"===currentTypeSelect.value){createNewOption(participantSelect,"---------------","all");participantSelect.disabled=!0}else{participantSelect.disabled=!1}}}});
//# sourceMappingURL=modform.min.js.map
