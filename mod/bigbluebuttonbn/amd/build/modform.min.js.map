{"version":3,"sources":["../src/modform.js"],"names":["ELEMENT_SELECTOR","instanceTypeSelection","document","querySelector","instanceTypeProfiles","participantData","participantList","getElementsByName","participantTable","getElementById","participantSelectionType","participantSelection","participantAddButton","init","info","selectedType","JSON","parse","dataset","profileTypes","profileType","instanceTypeDefault","selectedIndex","options","value","isFeatureEnabled","feature","features","indexOf","applyInstanceTypeProfile","addEventListener","e","target","currentTypeSelect","updateSelectionFromType","stopPropagation","preventDefault","participantAddFromCurrentSelection","participantListInit","showAll","showFieldset","id","show","node","style","display","showInput","ancestor","closest","showFormGroup","classList","remove","add","getParticipantList","forEach","participant","selectionTypeValue","selectiontype","selectionValue","selectionid","selectionRole","role","children","participantAddToForm","then","selectedRole","canRemove","sviewer","smoderator","roles","viewer","label","moderator","isselected","listTable","templateContext","name","Object","values","Templates","renderForPromise","html","js","newNode","appendNodeContents","participantListRoleUpdate","removeNode","participantRemove","Notification","exception","participantListUpdate","list","stringify","participantListValue","pList","participantListTable","i","length","splice","rows","deleteRow","type","participantListRoleSelection","selectionType","selection","push","createNewOption","selectItem","option","createElement","text","participantSelect","firstChild","removeChild","disabled"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JS for the mod_form page on mod_bigbluebuttonbn plugin.\n *\n * @module      mod_bigbluebuttonbn/mod_form\n * @copyright   2021 Blindside Networks Inc\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {get_string as getString} from 'core/str';\nimport Notification from 'core/notification';\nimport Templates from \"core/templates\";\n\n/**\n * Get all selectors in one place.\n *\n */\nconst ELEMENT_SELECTOR = {\n    instanceTypeSelection: () => document.querySelector('select#id_type'),\n    instanceTypeProfiles: () => document.querySelector('[data-profile-types]'),\n    participantData: () => document.querySelector('[data-participant-data]'),\n    participantList: () => document.getElementsByName('participants')[0],\n    participantTable: () => document.getElementById('participant_list_table'),\n    participantSelectionType: () => document.getElementsByName('bigbluebuttonbn_participant_selection_type')[0],\n    participantSelection: () => document.getElementsByName('bigbluebuttonbn_participant_selection')[0],\n    participantAddButton: () => document.getElementsByName('bigbluebuttonbn_participant_selection_add')[0],\n};\n/**\n * Initialise the moodle form code.\n *\n * This will help hide or show items depending on the selection of the instance type.\n *\n * @method init\n * @param {object} info\n */\nexport const init = (info) => {\n    const selectedType = ELEMENT_SELECTOR.instanceTypeSelection();\n    const instanceTypeProfiles = JSON.parse(ELEMENT_SELECTOR.instanceTypeProfiles().dataset.profileTypes);\n\n    let profileType = info.instanceTypeDefault;\n    if (selectedType !== null && selectedType.selectedIndex !== -1) {\n        profileType = selectedType.options[selectedType.selectedIndex].value;\n    }\n\n    const isFeatureEnabled = (profileType, feature) => {\n        const features = instanceTypeProfiles[profileType].features;\n        return (features.indexOf(feature) !== -1);\n    };\n    applyInstanceTypeProfile(profileType, isFeatureEnabled);\n\n    // Change form visible fields depending on the selection.\n    selectedType.addEventListener('change', (e) => {\n        applyInstanceTypeProfile(e.target.value, isFeatureEnabled);\n    });\n\n    ELEMENT_SELECTOR.participantSelectionType().addEventListener('change', (e) => {\n        const currentTypeSelect = e.target;\n        updateSelectionFromType(currentTypeSelect);\n    });\n\n    ELEMENT_SELECTOR.participantAddButton().addEventListener('click', (e) => {\n        e.stopPropagation();\n        e.preventDefault();\n        participantAddFromCurrentSelection();\n    });\n\n    participantListInit();\n};\n\n/**\n * Show or hide form element depending on the selected profile\n *\n * @param {string} profileType\n * @param {function} isFeatureEnabled\n */\nconst applyInstanceTypeProfile = (profileType, isFeatureEnabled) => {\n    let showAll = isFeatureEnabled(profileType, 'all');\n    const showFieldset = (id, show) => {\n        // Show room settings validation.\n        const node = document.querySelector('#' + id);\n        if (!node) {\n            return;\n        }\n        if (show) {\n            node.style.display = 'block';\n            return;\n        }\n        node.style.display = 'none';\n    };\n    const showInput = (id, show) => {\n        // Show room settings validation.\n        const node = document.querySelector('#' + id);\n        if (!node) {\n            return;\n        }\n        var ancestor = node.closest('div').closest('div');\n        if (show) {\n            ancestor.style.display = 'block';\n            return;\n        }\n        ancestor.style.display = 'none';\n    };\n    const showFormGroup = (id, show) => {\n        // Show room settings validation.\n        const node = document.querySelector('#fgroup_id_' + id);\n        if (!node) {\n            return;\n        }\n        if (show) {\n            node.classList.remove('hidden');\n            return;\n        }\n        node.classList.add('hidden');\n    };\n    // Show room settings validation.\n    showFieldset('id_room', showAll ||\n        isFeatureEnabled(profileType, 'showroom'));\n    showInput('id_record', showAll ||\n        isFeatureEnabled(profileType, 'showroom'));\n    // Show recordings settings validation.\n    showFieldset('id_recordings', showAll ||\n        isFeatureEnabled(profileType, 'showrecordings'));\n    // Show recordings imported settings validation.\n    showInput('id_recordings_imported', showAll ||\n        isFeatureEnabled(profileType, 'showrecordings'));\n    // Preuploadpresentation feature validation.\n    showFieldset('id_preuploadpresentation', showAll ||\n        isFeatureEnabled(profileType, 'preuploadpresentation'));\n    // Participants feature validation.\n    showFieldset('id_permissions', showAll ||\n        isFeatureEnabled(profileType, 'permissions'));\n    // Schedule feature validation.\n    showFieldset('id_schedule', showAll ||\n        isFeatureEnabled(profileType, 'schedule'));\n    // Common module settings validation.\n    showFieldset('id_modstandardelshdr', showAll ||\n        isFeatureEnabled(profileType, 'modstandardelshdr'));\n    // Restrict access validation.\n    showFieldset('id_availabilityconditionsheader', showAll ||\n        isFeatureEnabled(profileType, 'availabilityconditionsheader'));\n    // Tags validation.\n    showFieldset('id_tagshdr', showAll || isFeatureEnabled(profileType, 'tagshdr'));\n    // Competencies validation.\n    showFieldset('id_competenciessection', showAll ||\n        isFeatureEnabled(profileType, 'competenciessection'));\n    // Completion validation.\n    showFormGroup('completionattendancegroup', showAll ||\n        isFeatureEnabled(profileType, 'completionattendance'));\n    // Completion validation.\n    showFormGroup('completionengagementgroup', showAll ||\n        isFeatureEnabled(profileType, 'completionengagement'));\n};\n\n/**\n * Init the participant list\n */\nconst participantListInit = () => {\n    const participantData = JSON.parse(ELEMENT_SELECTOR.participantData().dataset.participantData);\n    const participantList = getParticipantList();\n    participantList.forEach(participant => {\n        const selectionTypeValue = participant.selectiontype;\n        const selectionValue = participant.selectionid;\n        const selectionRole = participant.role;\n        if (participant.selectiontype === 'all' ||\n            typeof participantData[participant.selectiontype].children[participant.selectionid] !== 'undefined') {\n            // Add it to the form, but don't add the delete button if it is the first item.\n            participantAddToForm(selectionTypeValue, selectionValue, selectionRole, true).then();\n        }\n    });\n};\n\n/**\n * Add rows to the participant list depending on the current selection.\n *\n * @param {string} selectionTypeValue\n * @param {string} selectionValue\n * @param {string} selectedRole\n * @param {boolean} canRemove\n * @returns {Promise<void>}\n */\nconst participantAddToForm = async(selectionTypeValue, selectionValue, selectedRole, canRemove) => {\n    const participantData = JSON.parse(ELEMENT_SELECTOR.participantData().dataset.participantData);\n    const sviewer = await getString('mod_form_field_participant_bbb_role_viewer', 'mod_bigbluebuttonbn');\n    const smoderator = await getString('mod_form_field_participant_bbb_role_moderator', 'mod_bigbluebuttonbn');\n    let roles = {\n        viewer: {'id': 'viewer', label: sviewer},\n        moderator: {'id': 'moderator', label: smoderator}\n    };\n    roles[selectedRole].isselected = true;\n    try {\n        const listTable = document.querySelector('#participant_list_table tbody');\n        const templateContext = {\n            'selectiontypevalue': selectionTypeValue,\n            'selectionvalue': selectionValue,\n            'participanttype': participantData[selectionTypeValue].name,\n            'participantvalue':\n                (selectionTypeValue !== 'all') ?\n                    participantData[selectionTypeValue].children[selectionValue].name : null,\n            'roles': Object.values(roles),\n            'canRemove': canRemove\n        };\n        const {html, js} = await Templates.renderForPromise('mod_bigbluebuttonbn/participant_form_add', templateContext);\n        const newNode = Templates.appendNodeContents(listTable, html, js)[0];\n        newNode.querySelector('.participant-select').addEventListener('change', () => {\n            participantListRoleUpdate(selectionTypeValue, selectionValue);\n        });\n        // Now add the callbacks: participantListRoleUpdate() and participantRemove().\n        const removeNode = newNode.querySelector('.remove-button');\n        if (removeNode) {\n            removeNode\n                .addEventListener('click', () => {\n                    participantRemove(selectionTypeValue, selectionValue);\n                });\n        }\n\n    } catch (e) {\n        Notification.exception(e);\n    }\n};\n/*\n\n */\n\n/**\n * Update the related form element with the list value.\n *\n * @param {object} list\n */\nconst participantListUpdate = (list) => {\n    const participantList = ELEMENT_SELECTOR.participantList();\n    participantList.value = JSON.stringify(list);\n};\n\n/**\n *\n * @returns {any}\n */\nconst getParticipantList = () => {\n    const participantListValue = ELEMENT_SELECTOR.participantList().value;\n    if (participantListValue) {\n        return JSON.parse(participantListValue);\n    }\n    return [];\n};\n\n/**\n * Remove participant both in the table/form and in the form element.\n *\n * @param {string} selectionTypeValue\n * @param {string} selectionValue\n */\nconst participantRemove = (selectionTypeValue, selectionValue) => {\n    const pList = getParticipantList();\n    const id = 'participant_list_tr_' + selectionTypeValue + '-' + selectionValue;\n    const participantListTable = ELEMENT_SELECTOR.participantTable();\n    const selectionid = (selectionValue === '' ? null : selectionValue);\n    for (let i = 0; i < pList.length; i++) {\n        if (pList[i].selectiontype === selectionTypeValue &&\n            pList[i].selectionid === selectionid) {\n            pList.splice(i, 1);\n        }\n    }\n    // Remove from the form.\n    for (let i = 0; i < participantListTable.rows.length; i++) {\n        if (participantListTable.rows[i].id === id) {\n            participantListTable.deleteRow(i);\n        }\n    }\n    // Update value in the form.\n    participantListUpdate(pList);\n};\n\n/**\n * Role update\n *\n * @param {string} type\n * @param {string} id\n */\nconst participantListRoleUpdate = (type, id) => {\n    // Update in memory.\n    const participantListRoleSelection = document.querySelector(`#participant_list_tr_${type}-${id} .participant-select`);\n    const pList = getParticipantList();\n\n    for (var i = 0; i < pList.length; i++) {\n        if (pList[i].selectiontype === type && pList[i].selectionid === id) {\n            pList[i].role = participantListRoleSelection.value;\n        }\n    }\n    // Update in the form.\n    participantListUpdate(pList);\n};\n\n/**\n * Add participant from the currently selected options\n */\nconst participantAddFromCurrentSelection = () => {\n    let selectionType = ELEMENT_SELECTOR.participantSelectionType();\n    let selection = ELEMENT_SELECTOR.participantSelection();\n    const pList = getParticipantList();\n    // Lookup to see if it has been added already.\n    for (var i = 0; i < pList.length; i++) {\n        if (pList[i].selectiontype === selectionType.value &&\n            pList[i].selectionid === selection.value) {\n            return;\n        }\n    }\n    pList.push({\n        \"selectiontype\": selectionType.value,\n        \"selectionid\": selection.value,\n        \"role\": \"viewer\"\n    });\n    // Add it to the form.\n    participantAddToForm(selectionType.value, selection.value, 'viewer', true).then();\n    // Update in the form.\n    participantListUpdate(pList);\n};\n\n/**\n * Update selectable options when changing types\n *\n * @param {HTMLNode} currentTypeSelect\n */\nconst updateSelectionFromType = (currentTypeSelect) => {\n    const createNewOption = (selectItem, label, value) => {\n        const option = document.createElement('option');\n        option.text = label;\n        option.value = value;\n\n        selectItem.add(option);\n    };\n\n    const participantData = JSON.parse(ELEMENT_SELECTOR.participantData().dataset.participantData);\n    // Clear all selection items.\n    const participantSelect = ELEMENT_SELECTOR.participantSelection();\n    while (participantSelect.firstChild) {\n        participantSelect.removeChild(participantSelect.firstChild);\n    }\n    // Add options depending on the selection.\n    if (currentTypeSelect.selectedIndex !== -1) {\n        const options = Object.values(participantData[currentTypeSelect.value].children);\n        options.forEach(option => {\n            createNewOption(participantSelect, option.name, option.id);\n        });\n\n        if (currentTypeSelect.value === 'all') {\n            createNewOption(participantSelect, '---------------', 'all');\n            participantSelect.disabled = true;\n        } else {\n            participantSelect.disabled = false;\n        }\n    }\n};\n"],"file":"modform.min.js"}