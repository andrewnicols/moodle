define ("mod_bigbluebuttonbn/roomupdater",["exports","core/templates","core/notification","./repository"],function(_exports,_templates,_notification,_repository){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.updateRoom=_exports.stop=_exports.start=void 0;_templates=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_templates);var updateCount=0,updateFactor=1,timerReference=null,timerRunning=!1,resetValues=function(){updateCount=0;updateFactor=1};_exports.start=function start(){timerRunning=!0;timerReference=setTimeout(function(){return poll()},1000)};var stop=function(){timerRunning=!1;if(timerReference){clearInterval(timerReference);timerReference=null}resetValues()};_exports.stop=stop;var poll=function(){if(!timerRunning){return}if(0==updateCount%updateFactor){updateRoom(!0).then(function(){if(updateFactor>=10){updateFactor=1}else{updateFactor++}}).catch().then(function(){timerReference=setTimeout(function(){return poll()},1000)}).catch()}},updateRoom=function(){var updatecache=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!1,bbbRoomViewElement=document.getElementById("bbb-room-view"),bbbId=bbbRoomViewElement.dataset.bbbId,groupId=bbbRoomViewElement.dataset.groupId;return(0,_repository.getMeetingInfo)(bbbId,groupId,updatecache).then(function(data){data.haspresentations=!1;if(data.presentations&&data.presentations.length){data.haspresentations=!0}return _templates.default.renderForPromise("mod_bigbluebuttonbn/room_view",data)}).then(function(_ref){var html=_ref.html,js=_ref.js;return _templates.default.replaceNodeContents(bbbRoomViewElement,html,js)}).catch(_notification.exception)};_exports.updateRoom=updateRoom});
//# sourceMappingURL=roomupdater.min.js.map
