define ("mod_quiz/random_question_form_preview",["jquery","core/ajax","core/str","core/notification","core/templates","core/paged_content_factory"],function($,Ajax,Str,Notification,Templates,PagedContentFactory){var TEMPLATE_NAME="mod_quiz/random_question_form_preview_question_list",SELECTORS={LOADING_ICON_CONTAINER:"[data-region=\"overlay-icon-container\"]",QUESTION_COUNT_CONTAINER:"[data-region=\"question-count-container\"]",QUESTION_LIST_CONTAINER:"[data-region=\"question-list-container\"]"},showLoadingIcon=function(root){root.find(SELECTORS.LOADING_ICON_CONTAINER).removeClass("hidden")},hideLoadingIcon=function(root){root.find(SELECTORS.LOADING_ICON_CONTAINER).addClass("hidden")},renderQuestionCount=function(root,questionCount){Str.get_string("questionsmatchingfilter","mod_quiz",questionCount).then(function(string){root.find(SELECTORS.QUESTION_COUNT_CONTAINER).html(string)}).fail(Notification.exception)},requestQuestions=function(categoryId,includeSubcategories,tagIds,contextId,limit,offset){return Ajax.call([{methodname:"core_question_get_random_question_summaries",args:{categoryid:categoryId,includesubcategories:includeSubcategories,tagids:tagIds,contextid:contextId,limit:limit,offset:offset}}])[0]},renderQuestionsAsPagedContent=function(categoryId,includeSubcategories,tagIds,contextId,totalQuestionCount,firstPageQuestions){return PagedContentFactory.createFromAjax(totalQuestionCount,5,function(pagesData){return pagesData.map(function(pageData){var limit=pageData.limit,offset=pageData.offset;if(0==offset){return Templates.render(TEMPLATE_NAME,{questions:firstPageQuestions})}else{return requestQuestions(categoryId,includeSubcategories,tagIds,contextId,limit,offset).then(function(response){var questions=response.questions;return Templates.render(TEMPLATE_NAME,{questions:questions})}).fail(Notification.exception)}})})};return{reload:function reload(root,categoryId,includeSubcategories,tagIds,contextId){showLoadingIcon(root);return requestQuestions(categoryId,includeSubcategories,tagIds,contextId,5,0).then(function(response){var totalCount=response.totalcount;renderQuestionCount(root,totalCount);return response}).then(function(response){var totalQuestionCount=response.totalcount,questions=response.questions;if(questions.length){return renderQuestionsAsPagedContent(categoryId,includeSubcategories,tagIds,contextId,totalQuestionCount,questions)}else{return $.Deferred().resolve("","")}}).then(function(html,js){var container=root.find(SELECTORS.QUESTION_LIST_CONTAINER);Templates.replaceNodeContents(container,html,js)}).always(function(){hideLoadingIcon(root)}).fail(Notification.exception)},showLoadingIcon:showLoadingIcon,hideLoadingIcon:hideLoadingIcon}});
//# sourceMappingURL=random_question_form_preview.min.js.map
