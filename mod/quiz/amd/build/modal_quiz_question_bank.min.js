define ("mod_quiz/modal_quiz_question_bank",["jquery","core/notification","core/modal","core/modal_events","core/modal_registry","core/fragment","core_form/changechecker"],function($,Notification,Modal,ModalEvents,ModalRegistry,Fragment,FormChangeChecker){var registered=!1,SELECTORS={ADD_TO_QUIZ_CONTAINER:"td.addtoquizaction",ANCHOR:"a[href]",PREVIEW_CONTAINER:"td.previewaction",SEARCH_OPTIONS:"#advancedsearch",DISPLAY_OPTIONS:"#displayoptions",ADD_QUESTIONS_FORM:"form[action=\"edit.php\"]"},ModalQuizQuestionBank=function(root){Modal.call(this,root);this.contextId=null;this.addOnPageId=null};ModalQuizQuestionBank.TYPE="mod_quiz-quiz-question-bank";ModalQuizQuestionBank.prototype=Object.create(Modal.prototype);ModalQuizQuestionBank.prototype.constructor=ModalQuizQuestionBank;ModalQuizQuestionBank.prototype.setContextId=function(id){this.contextId=id};ModalQuizQuestionBank.prototype.getContextId=function(){return this.contextId};ModalQuizQuestionBank.prototype.setAddOnPageId=function(id){this.addOnPageId=id};ModalQuizQuestionBank.prototype.getAddOnPageId=function(){return this.addOnPageId};ModalQuizQuestionBank.prototype.show=function(){this.reloadBodyContent(window.location.search);return Modal.prototype.show.call(this)};ModalQuizQuestionBank.prototype.reloadBodyContent=function(queryString){var promise=Fragment.loadFragment("mod_quiz","quiz_question_bank",this.getContextId(),{querystring:queryString}).fail(Notification.exception);this.setBody(promise)};ModalQuizQuestionBank.prototype.handleAddToQuizEvent=function(e,anchorElement){var href=anchorElement.attr("href")+"&addonpage="+this.getAddOnPageId();anchorElement.attr("href",href)};ModalQuizQuestionBank.prototype.handlePreviewContainerEvent=function(e,anchorElement){window.openpopup(e,{url:anchorElement.attr("href"),name:"questionpreview",options:["height=600","width=800","top=0","left=0","menubar=0","location=0","scrollbars","resizable","toolbar","status","directories=0","fullscreen=0","dependent"].join(",")})};ModalQuizQuestionBank.prototype.handleDisplayOptionFormEvent=function(e){e.stopPropagation();e.preventDefault();var form=$(e.target).closest(SELECTORS.DISPLAY_OPTIONS),queryString="?"+form.serialize();this.reloadBodyContent(queryString)};ModalQuizQuestionBank.prototype.registerDisplayOptionListeners=function(){this.getModal().on("change",SELECTORS.DISPLAY_OPTIONS,function(e){var modifiedElement=$(e.target);if(modifiedElement.attr("aria-autocomplete")){return}this.handleDisplayOptionFormEvent(e)}.bind(this));this.getModal().on("submit",SELECTORS.DISPLAY_OPTIONS,function(e){this.handleDisplayOptionFormEvent(e)}.bind(this))};ModalQuizQuestionBank.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this);this.registerDisplayOptionListeners();this.getModal().on("submit",SELECTORS.ADD_QUESTIONS_FORM,function(e){var formElement=$(e.currentTarget);$("<input />").attr("type","hidden").attr("name","addonpage").attr("value",this.getAddOnPageId()).appendTo(formElement)}.bind(this));this.getModal().on("click",SELECTORS.ANCHOR,function(e){var anchorElement=$(e.currentTarget);if(anchorElement.closest(SELECTORS.ADD_TO_QUIZ_CONTAINER).length){this.handleAddToQuizEvent(e,anchorElement);return}if(anchorElement.closest(SELECTORS.PREVIEW_CONTAINER).length){this.handlePreviewContainerEvent(e,anchorElement);return}if(anchorElement.closest(SELECTORS.SEARCH_OPTIONS).length){return}e.preventDefault();this.reloadBodyContent(anchorElement.prop("search"))}.bind(this));this.getRoot().on(ModalEvents.bodyRendered,function(){FormChangeChecker.disableAllChecks()})};if(!registered){ModalRegistry.register(ModalQuizQuestionBank.TYPE,ModalQuizQuestionBank,"core/modal");registered=!0}return ModalQuizQuestionBank});
//# sourceMappingURL=modal_quiz_question_bank.min.js.map
