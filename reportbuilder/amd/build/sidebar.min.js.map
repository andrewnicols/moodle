{"version":3,"sources":["../src/sidebar.js"],"names":["CLASSES","EXPANDED","COLLAPSED","SHOW","HIDE","sidebarCardFilter","event","sidebarMenu","pendingPromise","Pending","sidebarCards","querySelectorAll","reportSelectors","regions","sidebarCard","sidebarItems","searchTerm","target","value","toLowerCase","forEach","item","itemName","dataset","name","includes","classList","replace","card","length","remove","expandCard","add","resolve","cardButton","querySelector","contains","setAttribute","cardContent","init","selectorId","document","sidebarSearch","actions","addEventListener","setTimeout"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Report builder sidebar component\n *\n * @module      core_reportbuilder/sidebar\n * @copyright   2021 Paul Holden <paulh@moodle.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Pending from 'core/pending';\nimport {debounce} from 'core/utils';\nimport * as reportSelectors from 'core_reportbuilder/local/selectors';\n\nconst DEBOUNCE_TIMER = 250;\n\nconst CLASSES = {\n    EXPANDED: 'show',\n    COLLAPSED: 'collapsed',\n    SHOW: 'd-flex',\n    HIDE: 'd-none',\n};\n\n/**\n * Initialise module\n *\n * @param {Event} event\n * @param {Element} sidebarMenu\n */\nconst sidebarCardFilter = (event, sidebarMenu) => {\n    const pendingPromise = new Pending('core_reportbuilder/sidebar:cardFilter');\n\n    const sidebarCards = sidebarMenu.querySelectorAll(reportSelectors.regions.sidebarCard);\n    const sidebarItems = sidebarMenu.querySelectorAll('.list-group-item');\n    const searchTerm = event.target.value.toLowerCase();\n\n    // Toggle items according to match against search term.\n    sidebarItems.forEach(item => {\n        let itemName = item.dataset.name.toLowerCase();\n        if (itemName.includes(searchTerm)) {\n            item.classList.replace(CLASSES.HIDE, CLASSES.SHOW);\n        } else {\n            item.classList.replace(CLASSES.SHOW, CLASSES.HIDE);\n        }\n    });\n\n    // Toggle cards according to whether they have any visible items.\n    sidebarCards.forEach(card => {\n        if (card.querySelectorAll(`.${CLASSES.SHOW}`).length > 0) {\n            card.classList.remove(CLASSES.HIDE);\n            expandCard(card);\n        } else {\n            card.classList.add(CLASSES.HIDE);\n        }\n    });\n\n    pendingPromise.resolve();\n};\n\n/**\n * Show a collapsed card.\n * This function simulates the behaviour of JQuery show method on a collapsible element.\n *\n * @param {Element} card\n */\nconst expandCard = (card) => {\n    let cardButton = card.querySelector('[data-toggle=\"collapse\"]');\n    if (cardButton.classList.contains(CLASSES.COLLAPSED)) {\n        cardButton.classList.remove(CLASSES.COLLAPSED);\n        cardButton.setAttribute('aria-expanded', \"true\");\n        let cardContent = card.querySelector(cardButton.dataset.target);\n        cardContent.classList.add(CLASSES.EXPANDED);\n    }\n};\n\n/**\n * Initialise module\n *\n * @param {string} selectorId\n */\nexport const init = (selectorId) => {\n    const sidebarMenu = document.querySelector(selectorId + reportSelectors.regions.sidebarMenu);\n    const sidebarSearch = sidebarMenu.querySelector(reportSelectors.actions.sidebarSearch);\n\n    // Debounce the event listener to allow the user to finish typing.\n    sidebarSearch.addEventListener('keyup', event => {\n        const pendingPromise = new Pending('core_reportbuilder/sidebar:keyup');\n\n        debounce(sidebarCardFilter, DEBOUNCE_TIMER)(event, sidebarMenu);\n        setTimeout(() => {\n            pendingPromise.resolve();\n        }, DEBOUNCE_TIMER);\n    });\n};\n"],"file":"sidebar.min.js"}