function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define ("core_reportbuilder/audience",["exports","core/templates","core/notification","core/pending","core/prefetch","core/str","core_form/dynamicform","core/toast","core_reportbuilder/local/repository/audiences","core_reportbuilder/local/selectors","core/fragment","core_form/changechecker"],function(_exports,_templates,_notification,_pending,_prefetch,_str,_dynamicform,_toast,_audiences,reportSelectors,_fragment,_changechecker){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.init=void 0;_templates=_interopRequireDefault(_templates);_notification=_interopRequireDefault(_notification);_pending=_interopRequireDefault(_pending);_dynamicform=_interopRequireDefault(_dynamicform);reportSelectors=_interopRequireWildcard(reportSelectors);function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj}if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj){return{default:obj}}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if("default"!=key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj.default=obj;if(cache){cache.set(obj,newObj)}return newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var reportId=0,contextId=0,addAudienceCard=function(className,title){var pendingPromise=new _pending.default("core_reportbuilder/audience:add"),audiencesContainer=document.querySelector(reportSelectors.regions.audiencesContainer),audienceCardLength=audiencesContainer.querySelectorAll(reportSelectors.regions.audienceCard).length,params={classname:className,reportid:reportId,showormessage:0<audienceCardLength,title:title};(0,_fragment.loadFragment)("core_reportbuilder","audience_form",contextId,params).then(function(html,js){var audienceCard=_templates.default.appendNodeContents(audiencesContainer,html,js)[0],audienceEmptyMessage=audiencesContainer.querySelector(reportSelectors.regions.audienceEmptyMessage),audienceForm=initAudienceCardForm(audienceCard);(0,_changechecker.markFormAsDirty)(audienceForm.getFormNode());audienceEmptyMessage.classList.add("hidden");return(0,_str.get_string)("audienceadded","core_reportbuilder",title)}).then(_toast.add).then(function(){return pendingPromise.resolve()}).catch(_notification.default.exception)},editAudienceCard=function(audienceCard){var pendingPromise=new _pending.default("core_reportbuilder/audience:edit"),audienceForm=initAudienceCardForm(audienceCard),audienceFormData={reportid:reportId,id:audienceCard.dataset.instanceid,classname:audienceCard.dataset.classname};audienceForm.load(audienceFormData).then(function(){var audienceFormContainer=audienceCard.querySelector(reportSelectors.regions.audienceFormContainer),audienceDescription=audienceCard.querySelector(reportSelectors.regions.audienceDescription),audienceEdit=audienceCard.querySelector(reportSelectors.actions.audienceEdit);audienceFormContainer.classList.remove("hidden");audienceDescription.classList.add("hidden");audienceEdit.disabled=!0;return pendingPromise.resolve()}).catch(_notification.default.exception)},initAudienceCardForm=function(audienceCard){var audienceFormContainer=audienceCard.querySelector(reportSelectors.regions.audienceFormContainer),audienceForm=new _dynamicform.default(audienceFormContainer,"\\core_reportbuilder\\form\\audience");audienceForm.addEventListener(audienceForm.events.FORM_SUBMITTED,function(data){var audienceDescription=audienceCard.querySelector(reportSelectors.regions.audienceDescription);audienceCard.dataset.instanceid=data.detail.instanceid;audienceDescription.innerHTML=data.detail.description;closeAudienceCardForm(audienceCard);return(0,_str.get_string)("audiencesaved","core_reportbuilder").then(_toast.add)});audienceForm.addEventListener(audienceForm.events.FORM_CANCELLED,function(){if(0<audienceCard.dataset.instanceid){closeAudienceCardForm(audienceCard)}else{removeAudienceCard(audienceCard)}});return audienceForm},deleteAudienceCard=function(audienceDelete){var audienceCard=audienceDelete.closest(reportSelectors.regions.audienceCard),audienceTitle=audienceCard.dataset.title;_notification.default.saveCancelPromise((0,_str.get_string)("deleteaudience","core_reportbuilder",audienceTitle),(0,_str.get_string)("deleteaudienceconfirm","core_reportbuilder",audienceTitle),(0,_str.get_string)("delete","core"),{triggerElement:audienceDelete}).then(function(){var pendingPromise=new _pending.default("core_reportbuilder/audience:delete");return(0,_audiences.deleteAudience)(reportId,audienceCard.dataset.instanceid).then(function(){return(0,_toast.add)((0,_str.get_string)("audiencedeleted","core_reportbuilder",audienceTitle))}).then(function(){removeAudienceCard(audienceCard);return pendingPromise.resolve()}).catch(_notification.default.exception)}).catch(function(){})},closeAudienceCardForm=function(audienceCard){var audienceFormContainer=audienceCard.querySelector(reportSelectors.regions.audienceFormContainer),NewAudienceFormContainer=audienceFormContainer.cloneNode(!1);audienceCard.querySelector(reportSelectors.regions.audienceForm).replaceChild(NewAudienceFormContainer,audienceFormContainer);audienceCard.querySelector(reportSelectors.regions.audienceDescription).classList.remove("hidden");audienceCard.querySelector(reportSelectors.actions.audienceEdit).disabled=!1;audienceCard.querySelector(reportSelectors.actions.audienceDelete).disabled=!1},removeAudienceCard=function(audienceCard){audienceCard.remove();var audiencesContainer=document.querySelector(reportSelectors.regions.audiencesContainer),audienceCards=audiencesContainer.querySelectorAll(reportSelectors.regions.audienceCard);if(0===audienceCards.length){var audienceEmptyMessage=document.querySelector(reportSelectors.regions.audienceEmptyMessage);audienceEmptyMessage.classList.remove("hidden")}else{var audienceFirstCardSeparator=audienceCards[0].querySelector(".audience-separator");null===audienceFirstCardSeparator||void 0===audienceFirstCardSeparator?void 0:audienceFirstCardSeparator.remove()}},initialized=!1,init=function(id,contextid){(0,_prefetch.prefetchStrings)("core_reportbuilder",["audienceadded","audiencedeleted","audiencesaved","deleteaudience","deleteaudienceconfirm"]);(0,_prefetch.prefetchStrings)("core",["delete"]);reportId=id;contextId=contextid;if(initialized){return}document.addEventListener("click",function(event){var audienceAdd=event.target.closest(reportSelectors.actions.audienceAdd);if(audienceAdd){event.preventDefault();addAudienceCard(audienceAdd.dataset.uniqueIdentifier,audienceAdd.dataset.name)}var audienceEdit=event.target.closest(reportSelectors.actions.audienceEdit);if(audienceEdit){var audienceEditCard=audienceEdit.closest(reportSelectors.regions.audienceCard);event.preventDefault();editAudienceCard(audienceEditCard)}var audienceDelete=event.target.closest(reportSelectors.actions.audienceDelete);if(audienceDelete){event.preventDefault();deleteAudienceCard(audienceDelete)}});initialized=!0};_exports.init=init});
//# sourceMappingURL=audience.min.js.map
