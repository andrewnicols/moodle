define ("media_videojs/loader",["exports","core/ajax","core/config","core_filters/events","core/localstorage","core/notification","jquery"],function(_exports,_ajax,_config,_events,_localstorage,_notification,_jquery){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.setUp=void 0;_ajax=_interopRequireDefault(_ajax);_config=_interopRequireDefault(_config);_localstorage=_interopRequireDefault(_localstorage);_notification=_interopRequireDefault(_notification);_jquery=_interopRequireDefault(_jquery);var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor)n=o.constructor.name;if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(null==len||len>arr.length)len=arr.length;for(var i=0,arr2=Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _arr=[],_n=!0,_d=!1,_s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=!0){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=!0;_e=err}finally{try{if(!_n&&null!=_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}var firstLoad,language,langStringCache;_exports.setUp=function setUp(lang){language=lang;firstLoad=!0;notifyVideoJS({detail:{nodes:document.body}});document.addEventListener(_events.eventTypes.filterContentUpdated,notifyVideoJS)};var notifyVideoJS=function(e){var nodes=(0,_jquery.default)(e.detail.nodes),selector=".mediaplugin_videojs",langStrings=getLanguageJson();nodes.find(selector).addBack(selector).find("audio, video").each(function(index,element){var id=(0,_jquery.default)(element).attr("id"),config=(0,_jquery.default)(element).data("setup-lazy"),modulePromises=["function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise(function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["media_videojs/video-lazy"],resolve,reject)}):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require(("media_videojs/video-lazy"))):Promise.resolve(_systemImportTransformerGlobalIdentifier["media_videojs/video-lazy"])];if(config.techOrder&&-1!==config.techOrder.indexOf("youtube")){modulePromises.push("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise(function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["media_videojs/Youtube-lazy"],resolve,reject)}):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require(("media_videojs/Youtube-lazy"))):Promise.resolve(_systemImportTransformerGlobalIdentifier["media_videojs/Youtube-lazy"]))}if(config.techOrder&&-1!==config.techOrder.indexOf("OgvJS")){config.ogvjs={worker:!0,wasm:!0,base:_config.default.wwwroot+"/media/player/videojs/ogvloader.php/"+_config.default.jsrev+"/"};modulePromises.push("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise(function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["media_videojs/videojs-ogvjs-lazy"],resolve,reject)}):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require(("media_videojs/videojs-ogvjs-lazy"))):Promise.resolve(_systemImportTransformerGlobalIdentifier["media_videojs/videojs-ogvjs-lazy"]))}Promise.all([langStrings].concat(modulePromises)).then(function(_ref){var _ref2=_slicedToArray(_ref,2),langJson=_ref2[0],videojs=_ref2[1];if(firstLoad){videojs.options.playbackRates=[.5,.75,1,1.25,1.5,1.75,2];videojs.options.userActions={hotkeys:!0};videojs.addLanguage(language,langJson);firstLoad=!1}videojs(id,config)}).catch(_notification.default.exception)})},getLanguageJson=function(){if(langStringCache){return Promise.resolve(langStringCache)}var cacheKey="media_videojs/".concat(language),rawCacheContent=_localstorage.default.get(cacheKey);if(rawCacheContent){var cacheContent=JSON.parse(rawCacheContent);langStringCache=cacheContent;return Promise.resolve(langStringCache)}var request={methodname:"media_videojs_get_language",args:{lang:language}};return _ajax.default.call([request])[0].then(function(langStringData){_localstorage.default.set(cacheKey,langStringData);return langStringData}).then(function(result){return JSON.parse(result)}).then(function(langStrings){langStringCache=langStrings;return langStrings})}});
//# sourceMappingURL=loader.min.js.map
