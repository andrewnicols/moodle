function _typeof2(obj){"@babel/helpers - typeof";return _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof2(obj)}(function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof2(exports))&&"undefined"!=typeof module?module.exports=factory(require("global/window"),require("global/document")):"function"==typeof define&&define.amd?define ("media_videojs/video-lazy",["./window","./document"],factory):(global=global||self,global.videojs=factory(global.window,global.document))})(this,function(window$3,document){"use strict";window$3=window$3&&Object.prototype.hasOwnProperty.call(window$3,"default")?window$3["default"]:window$3;document=document&&Object.prototype.hasOwnProperty.call(document,"default")?document["default"]:document;var history=[],LogByTypeFactory=function(name,log){return function(type,level,args){var lvl=log.levels[level],lvlRegExp=new RegExp("^("+lvl+")$");if("log"!==type){args.unshift(type.toUpperCase()+":")}args.unshift(name+":");if(history){history.push([].concat(args));var splice=history.length-1e3;history.splice(0,0<splice?splice:0)}if(!window$3.console){return}var fn=window$3.console[type];if(!fn&&"debug"===type){fn=window$3.console.info||window$3.console.log}if(!fn||!lvl||!lvlRegExp.test(type)){return}fn[Array.isArray(args)?"apply":"call"](window$3.console,args)}};function createLogger(name){var level="info",logByType,log=function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}logByType("log",level,args)};logByType=LogByTypeFactory(name,log);log.createLogger=function(subname){return createLogger(name+": "+subname)};log.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:level};log.level=function(lvl){if("string"==typeof lvl){if(!log.levels.hasOwnProperty(lvl)){throw new Error("\""+lvl+"\" in not a valid log level")}level=lvl}return level};log.history=function(){return history?[].concat(history):[]};log.history.filter=function(fname){return(history||[]).filter(function(historyItem){return new RegExp(".*"+fname+".*").test(historyItem[0])})};log.history.clear=function(){if(history){history.length=0}};log.history.disable=function(){if(null!==history){history.length=0;history=null}};log.history.enable=function(){if(null===history){history=[]}};log.error=function(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}return logByType("error",level,args)};log.warn=function(){for(var _len3=arguments.length,args=Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3]}return logByType("warn",level,args)};log.debug=function(){for(var _len4=arguments.length,args=Array(_len4),_key4=0;_key4<_len4;_key4++){args[_key4]=arguments[_key4]}return logByType("debug",level,args)};return log}var log=createLogger("VIDEOJS"),createLogger$1=log.createLogger;function createCommonjsModule(fn,module){return module={exports:{}},fn(module,module.exports),module.exports}var _extends_1=createCommonjsModule(function(module){function _extends(){module.exports=_extends=Object.assign||function(target){for(var i=1,source;i<arguments.length;i++){source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}module.exports=_extends}),toString=Object.prototype.toString,keys=function(object){return isObject(object)?Object.keys(object):[]};function each(object,fn){keys(object).forEach(function(key){return fn(object[key],key)})}function reduce(object,fn,initial){if(void 0===initial){initial=0}return keys(object).reduce(function(accum,key){return fn(accum,object[key],key)},initial)}function assign(target){for(var _len=arguments.length,sources=Array(1<_len?_len-1:0),_key=1;_key<_len;_key++){sources[_key-1]=arguments[_key]}if(Object.assign){return _extends_1.apply(void 0,[target].concat(sources))}sources.forEach(function(source){if(!source){return}each(source,function(value,key){target[key]=value})});return target}function isObject(value){return!!value&&"object"===_typeof2(value)}function isPlain(value){return isObject(value)&&"[object Object]"===toString.call(value)&&value.constructor===Object}function computedStyle(el,prop){if(!el||!prop){return""}if("function"==typeof window$3.getComputedStyle){var computedStyleValue=window$3.getComputedStyle(el);return computedStyleValue?computedStyleValue.getPropertyValue(prop)||computedStyleValue[prop]:""}return""}function isNonBlankString(str){return"string"==typeof str&&!!str.trim()}function throwIfWhitespace(str){if(0<=str.indexOf(" ")){throw new Error("class has illegal whitespace characters")}}function classRegExp(className){return new RegExp("(^|\\s)"+className+"($|\\s)")}function isReal(){return document===window$3.document}function isEl(value){return isObject(value)&&1===value.nodeType}function isInFrame(){try{return window$3.parent!==window$3.self}catch(x){return!0}}function createQuerier(method){return function(selector,context){if(!isNonBlankString(selector)){return document[method](null)}if(isNonBlankString(context)){context=document.querySelector(context)}var ctx=isEl(context)?context:document;return ctx[method]&&ctx[method](selector)}}function createEl(tagName,properties,attributes,content){if(void 0===tagName){tagName="div"}if(void 0===properties){properties={}}if(void 0===attributes){attributes={}}var el=document.createElement(tagName);Object.getOwnPropertyNames(properties).forEach(function(propName){var val=properties[propName];if(-1!==propName.indexOf("aria-")||"role"===propName||"type"===propName){log.warn("Setting attributes in the second argument of createEl()\nhas been deprecated. Use the third argument instead.\n"+("createEl(type, properties, attributes). Attempting to set "+propName+" to "+val+"."));el.setAttribute(propName,val)}else if("textContent"===propName){textContent(el,val)}else if(el[propName]!==val){el[propName]=val}});Object.getOwnPropertyNames(attributes).forEach(function(attrName){el.setAttribute(attrName,attributes[attrName])});if(content){appendContent(el,content)}return el}function textContent(el,text){if("undefined"==typeof el.textContent){el.innerText=text}else{el.textContent=text}return el}function prependTo(child,parent){if(parent.firstChild){parent.insertBefore(child,parent.firstChild)}else{parent.appendChild(child)}}function hasClass(element,classToCheck){throwIfWhitespace(classToCheck);if(element.classList){return element.classList.contains(classToCheck)}return classRegExp(classToCheck).test(element.className)}function addClass(element,classToAdd){if(element.classList){element.classList.add(classToAdd)}else if(!hasClass(element,classToAdd)){element.className=(element.className+" "+classToAdd).trim()}return element}function removeClass(element,classToRemove){if(element.classList){element.classList.remove(classToRemove)}else{throwIfWhitespace(classToRemove);element.className=element.className.split(/\s+/).filter(function(c){return c!==classToRemove}).join(" ")}return element}function toggleClass(element,classToToggle,predicate){var has=hasClass(element,classToToggle);if("function"==typeof predicate){predicate=predicate(element,classToToggle)}if("boolean"!=typeof predicate){predicate=!has}if(predicate===has){return}if(predicate){addClass(element,classToToggle)}else{removeClass(element,classToToggle)}return element}function setAttributes(el,attributes){Object.getOwnPropertyNames(attributes).forEach(function(attrName){var attrValue=attributes[attrName];if(null===attrValue||"undefined"==typeof attrValue||!1===attrValue){el.removeAttribute(attrName)}else{el.setAttribute(attrName,!0===attrValue?"":attrValue)}})}function getAttributes(tag){var obj={};if(tag&&tag.attributes&&0<tag.attributes.length){for(var attrs=tag.attributes,i=attrs.length-1;0<=i;i--){var attrName=attrs[i].name,attrVal=attrs[i].value;if("boolean"==typeof tag[attrName]||-1!==",autoplay,controls,playsinline,loop,muted,default,defaultMuted,".indexOf(","+attrName+",")){attrVal=null!==attrVal?!0:!1}obj[attrName]=attrVal}}return obj}function getAttribute(el,attribute){return el.getAttribute(attribute)}function setAttribute(el,attribute,value){el.setAttribute(attribute,value)}function removeAttribute(el,attribute){el.removeAttribute(attribute)}function blockTextSelection(){document.body.focus();document.onselectstart=function(){return!1}}function unblockTextSelection(){document.onselectstart=function(){return!0}}function getBoundingClientRect(el){if(el&&el.getBoundingClientRect&&el.parentNode){var rect=el.getBoundingClientRect(),result={};["bottom","height","left","right","top","width"].forEach(function(k){if(rect[k]!==void 0){result[k]=rect[k]}});if(!result.height){result.height=parseFloat(computedStyle(el,"height"))}if(!result.width){result.width=parseFloat(computedStyle(el,"width"))}return result}}function findPosition(el){if(!el||el&&!el.offsetParent){return{left:0,top:0,width:0,height:0}}var width=el.offsetWidth,height=el.offsetHeight,left=0,top=0;do{left+=el.offsetLeft;top+=el.offsetTop;el=el.offsetParent}while(el);return{left:left,top:top,width:width,height:height}}function getPointerPosition(el,event){var position={},boxTarget=findPosition(event.target),box=findPosition(el),boxW=box.width,boxH=box.height,offsetY=event.offsetY-(box.top-boxTarget.top),offsetX=event.offsetX-(box.left-boxTarget.left);if(event.changedTouches){offsetX=event.changedTouches[0].pageX-box.left;offsetY=event.changedTouches[0].pageY+box.top}position.y=1-Math.max(0,Math.min(1,offsetY/boxH));position.x=Math.max(0,Math.min(1,offsetX/boxW));return position}function isTextNode(value){return isObject(value)&&3===value.nodeType}function emptyEl(el){while(el.firstChild){el.removeChild(el.firstChild)}return el}function normalizeContent(content){if("function"==typeof content){content=content()}return(Array.isArray(content)?content:[content]).map(function(value){if("function"==typeof value){value=value()}if(isEl(value)||isTextNode(value)){return value}if("string"==typeof value&&/\S/.test(value)){return document.createTextNode(value)}}).filter(function(value){return value})}function appendContent(el,content){normalizeContent(content).forEach(function(node){return el.appendChild(node)});return el}function insertContent(el,content){return appendContent(emptyEl(el),content)}function isSingleLeftClick(event){if(event.button===void 0&&event.buttons===void 0){return!0}if(0===event.button&&event.buttons===void 0){return!0}if("mouseup"===event.type&&0===event.button&&0===event.buttons){return!0}if(0!==event.button||1!==event.buttons){return!1}return!0}var $=createQuerier("querySelector"),$$=createQuerier("querySelectorAll"),Dom=Object.freeze({__proto__:null,isReal:isReal,isEl:isEl,isInFrame:isInFrame,createEl:createEl,textContent:textContent,prependTo:prependTo,hasClass:hasClass,addClass:addClass,removeClass:removeClass,toggleClass:toggleClass,setAttributes:setAttributes,getAttributes:getAttributes,getAttribute:getAttribute,setAttribute:setAttribute,removeAttribute:removeAttribute,blockTextSelection:blockTextSelection,unblockTextSelection:unblockTextSelection,getBoundingClientRect:getBoundingClientRect,findPosition:findPosition,getPointerPosition:getPointerPosition,isTextNode:isTextNode,emptyEl:emptyEl,normalizeContent:normalizeContent,appendContent:appendContent,insertContent:insertContent,isSingleLeftClick:isSingleLeftClick,$:$,$$:$$}),_windowLoaded=!1,videojs,autoSetup=function(){if(!isReal()||!1===videojs.options.autoSetup){return}var vids=Array.prototype.slice.call(document.getElementsByTagName("video")),audios=Array.prototype.slice.call(document.getElementsByTagName("audio")),divs=Array.prototype.slice.call(document.getElementsByTagName("video-js")),mediaEls=vids.concat(audios,divs);if(mediaEls&&0<mediaEls.length){for(var i=0,e=mediaEls.length,mediaEl;i<e;i++){mediaEl=mediaEls[i];if(mediaEl&&mediaEl.getAttribute){if(mediaEl.player===void 0){var options=mediaEl.getAttribute("data-setup");if(null!==options){videojs(mediaEl)}}}else{autoSetupTimeout(1);break}}}else if(!_windowLoaded){autoSetupTimeout(1)}};function autoSetupTimeout(wait,vjs){if(vjs){videojs=vjs}window$3.setTimeout(autoSetup,wait)}function setWindowLoaded(){_windowLoaded=!0;window$3.removeEventListener("load",setWindowLoaded)}if(isReal()){if("complete"===document.readyState){setWindowLoaded()}else{window$3.addEventListener("load",setWindowLoaded)}}var createStyleElement=function(className){var style=document.createElement("style");style.className=className;return style},setTextContent=function(el,content){if(el.styleSheet){el.styleSheet.cssText=content}else{el.textContent=content}},_guid=3;function newGUID(){return _guid++}var FakeWeakMap;if(!window$3.WeakMap){FakeWeakMap=function(){function FakeWeakMap(){this.vdata="vdata"+Math.floor(window$3.performance&&window$3.performance.now()||Date.now());this.data={}}var _proto=FakeWeakMap.prototype;_proto.set=function(key,value){var access=key[this.vdata]||newGUID();if(!key[this.vdata]){key[this.vdata]=access}this.data[access]=value;return this};_proto.get=function(key){var access=key[this.vdata];if(access){return this.data[access]}log("We have no data for this element",key)};_proto.has=function(key){var access=key[this.vdata];return access in this.data};_proto["delete"]=function(key){var access=key[this.vdata];if(access){delete this.data[access];delete key[this.vdata]}};return FakeWeakMap}()}var DomData=window$3.WeakMap?new WeakMap:new FakeWeakMap;function _cleanUpEvents(elem,type){if(!DomData.has(elem)){return}var data=DomData.get(elem);if(0===data.handlers[type].length){delete data.handlers[type];if(elem.removeEventListener){elem.removeEventListener(type,data.dispatcher,!1)}else if(elem.detachEvent){elem.detachEvent("on"+type,data.dispatcher)}}if(0>=Object.getOwnPropertyNames(data.handlers).length){delete data.handlers;delete data.dispatcher;delete data.disabled}if(0===Object.getOwnPropertyNames(data).length){DomData["delete"](elem)}}function _handleMultipleEvents(fn,elem,types,callback){types.forEach(function(type){fn(elem,type,callback)})}function fixEvent(event){if(event.fixed_){return event}function returnTrue(){return!0}function returnFalse(){return!1}if(!event||!event.isPropagationStopped){var old=event||window$3.event;event={};for(var key in old){if("layerX"!=key&&"layerY"!==key&&"keyLocation"!==key&&"webkitMovementX"!==key&&"webkitMovementY"!==key){if(!("returnValue"===key&&old.preventDefault)){event[key]=old[key]}}}if(!event.target){event.target=event.srcElement||document}if(!event.relatedTarget){event.relatedTarget=event.fromElement===event.target?event.toElement:event.fromElement}event.preventDefault=function(){if(old.preventDefault){old.preventDefault()}event.returnValue=!1;old.returnValue=!1;event.defaultPrevented=!0};event.defaultPrevented=!1;event.stopPropagation=function(){if(old.stopPropagation){old.stopPropagation()}event.cancelBubble=!0;old.cancelBubble=!0;event.isPropagationStopped=returnTrue};event.isPropagationStopped=returnFalse;event.stopImmediatePropagation=function(){if(old.stopImmediatePropagation){old.stopImmediatePropagation()}event.isImmediatePropagationStopped=returnTrue;event.stopPropagation()};event.isImmediatePropagationStopped=returnFalse;if(null!==event.clientX&&event.clientX!==void 0){var doc=document.documentElement,body=document.body;event.pageX=event.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=event.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}event.which=event.charCode||event.keyCode;if(null!==event.button&&event.button!==void 0){event.button=1&event.button?0:4&event.button?1:2&event.button?2:0}}event.fixed_=!0;return event}var _supportsPassive,supportsPassive=function(){if("boolean"!=typeof _supportsPassive){_supportsPassive=!1;try{var opts=Object.defineProperty({},"passive",{get:function(){_supportsPassive=!0}});window$3.addEventListener("test",null,opts);window$3.removeEventListener("test",null,opts)}catch(e){}}return _supportsPassive},passiveEvents=["touchstart","touchmove"];function on(elem,type,fn){if(Array.isArray(type)){return _handleMultipleEvents(on,elem,type,fn)}if(!DomData.has(elem)){DomData.set(elem,{})}var data=DomData.get(elem);if(!data.handlers){data.handlers={}}if(!data.handlers[type]){data.handlers[type]=[]}if(!fn.guid){fn.guid=newGUID()}data.handlers[type].push(fn);if(!data.dispatcher){data.disabled=!1;data.dispatcher=function(event,hash){if(data.disabled){return}event=fixEvent(event);var handlers=data.handlers[event.type];if(handlers){for(var handlersCopy=handlers.slice(0),m=0,n=handlersCopy.length;m<n;m++){if(event.isImmediatePropagationStopped()){break}else{try{handlersCopy[m].call(elem,event,hash)}catch(e){log.error(e)}}}}}}if(1===data.handlers[type].length){if(elem.addEventListener){var options=!1;if(supportsPassive()&&-1<passiveEvents.indexOf(type)){options={passive:!0}}elem.addEventListener(type,data.dispatcher,options)}else if(elem.attachEvent){elem.attachEvent("on"+type,data.dispatcher)}}}function off(elem,type,fn){if(!DomData.has(elem)){return}var data=DomData.get(elem);if(!data.handlers){return}if(Array.isArray(type)){return _handleMultipleEvents(off,elem,type,fn)}var removeType=function(el,t){data.handlers[t]=[];_cleanUpEvents(el,t)};if(type===void 0){for(var t in data.handlers){if(Object.prototype.hasOwnProperty.call(data.handlers||{},t)){removeType(elem,t)}}return}var handlers=data.handlers[type];if(!handlers){return}if(!fn){removeType(elem,type);return}if(fn.guid){for(var n=0;n<handlers.length;n++){if(handlers[n].guid===fn.guid){handlers.splice(n--,1)}}}_cleanUpEvents(elem,type)}function trigger(elem,event,hash){var elemData=DomData.has(elem)?DomData.get(elem):{},parent=elem.parentNode||elem.ownerDocument;if("string"==typeof event){event={type:event,target:elem}}else if(!event.target){event.target=elem}event=fixEvent(event);if(elemData.dispatcher){elemData.dispatcher.call(elem,event,hash)}if(parent&&!event.isPropagationStopped()&&!0===event.bubbles){trigger.call(null,parent,event,hash)}else if(!parent&&!event.defaultPrevented&&event.target&&event.target[event.type]){if(!DomData.has(event.target)){DomData.set(event.target,{})}var targetData=DomData.get(event.target);if(event.target[event.type]){targetData.disabled=!0;if("function"==typeof event.target[event.type]){event.target[event.type]()}targetData.disabled=!1}}return!event.defaultPrevented}function one(elem,type,fn){if(Array.isArray(type)){return _handleMultipleEvents(one,elem,type,fn)}var func=function func(){off(elem,type,func);fn.apply(this,arguments)};func.guid=fn.guid=fn.guid||newGUID();on(elem,type,func)}function any(elem,type,fn){var func=function func(){off(elem,type,func);fn.apply(this,arguments)};func.guid=fn.guid=fn.guid||newGUID();on(elem,type,func)}var Events=Object.freeze({__proto__:null,fixEvent:fixEvent,on:on,off:off,trigger:trigger,one:one,any:any}),UPDATE_REFRESH_INTERVAL=30,bind=function(context,fn,uid){if(!fn.guid){fn.guid=newGUID()}var bound=fn.bind(context);bound.guid=uid?uid+"_"+fn.guid:fn.guid;return bound},throttle=function(fn,wait){var last=window$3.performance.now(),throttled=function(){var now=window$3.performance.now();if(now-last>=wait){fn.apply(void 0,arguments);last=now}};return throttled},debounce=function(func,wait,immediate,context){if(void 0===context){context=window$3}var timeout,cancel=function(){context.clearTimeout(timeout);timeout=null},debounced=function(){var self=this,args=arguments,_later=function(){timeout=null;_later=null;if(!immediate){func.apply(self,args)}};if(!timeout&&immediate){func.apply(self,args)}context.clearTimeout(timeout);timeout=context.setTimeout(_later,wait)};debounced.cancel=cancel;return debounced},EventTarget=function(){};EventTarget.prototype.allowedEvents_={};EventTarget.prototype.on=function(type,fn){var ael=this.addEventListener;this.addEventListener=function(){};on(this,type,fn);this.addEventListener=ael};EventTarget.prototype.addEventListener=EventTarget.prototype.on;EventTarget.prototype.off=function(type,fn){off(this,type,fn)};EventTarget.prototype.removeEventListener=EventTarget.prototype.off;EventTarget.prototype.one=function(type,fn){var ael=this.addEventListener;this.addEventListener=function(){};one(this,type,fn);this.addEventListener=ael};EventTarget.prototype.any=function(type,fn){var ael=this.addEventListener;this.addEventListener=function(){};any(this,type,fn);this.addEventListener=ael};EventTarget.prototype.trigger=function(event){var type=event.type||event;if("string"==typeof event){event={type:type}}event=fixEvent(event);if(this.allowedEvents_[type]&&this["on"+type]){this["on"+type](event)}trigger(this,event)};EventTarget.prototype.dispatchEvent=EventTarget.prototype.trigger;var EVENT_MAP;EventTarget.prototype.queueTrigger=function(event){var _this=this;if(!EVENT_MAP){EVENT_MAP=new Map}var type=event.type||event,map=EVENT_MAP.get(this);if(!map){map=new Map;EVENT_MAP.set(this,map)}var oldTimeout=map.get(type);map["delete"](type);window$3.clearTimeout(oldTimeout);var timeout=window$3.setTimeout(function(){if(0===map.size){map=null;EVENT_MAP["delete"](_this)}_this.trigger(event)},0);map.set(type,timeout)};var isEvented=function(object){return object instanceof EventTarget||!!object.eventBusEl_&&["on","one","off","trigger"].every(function(k){return"function"==typeof object[k]})},addEventedCallback=function(target,callback){if(isEvented(target)){callback()}else{if(!target.eventedCallbacks){target.eventedCallbacks=[]}target.eventedCallbacks.push(callback)}},isValidEventType=function(type){return"string"==typeof type&&/\S/.test(type)||Array.isArray(type)&&!!type.length},validateTarget=function(target){if(!target.nodeName&&!isEvented(target)){throw new Error("Invalid target; must be a DOM node or evented object.")}},validateEventType=function(type){if(!isValidEventType(type)){throw new Error("Invalid event type; must be a non-empty string or array.")}},validateListener=function(listener){if("function"!=typeof listener){throw new Error("Invalid listener; must be a function.")}},normalizeListenArgs=function(self,args){var isTargetingSelf=3>args.length||args[0]===self||args[0]===self.eventBusEl_,target,type,listener;if(isTargetingSelf){target=self.eventBusEl_;if(3<=args.length){args.shift()}type=args[0];listener=args[1]}else{target=args[0];type=args[1];listener=args[2]}validateTarget(target);validateEventType(type);validateListener(listener);listener=bind(self,listener);return{isTargetingSelf:isTargetingSelf,target:target,type:type,listener:listener}},listen=function(target,method,type,listener){validateTarget(target);if(target.nodeName){Events[method](target,type,listener)}else{target[method](type,listener)}},EventedMixin={on:function(){for(var _this=this,_len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}var _normalizeListenArgs=normalizeListenArgs(this,args),isTargetingSelf=_normalizeListenArgs.isTargetingSelf,target=_normalizeListenArgs.target,type=_normalizeListenArgs.type,listener=_normalizeListenArgs.listener;listen(target,"on",type,listener);if(!isTargetingSelf){var removeListenerOnDispose=function(){return _this.off(target,type,listener)};removeListenerOnDispose.guid=listener.guid;var removeRemoverOnTargetDispose=function(){return _this.off("dispose",removeListenerOnDispose)};removeRemoverOnTargetDispose.guid=listener.guid;listen(this,"on","dispose",removeListenerOnDispose);listen(target,"on","dispose",removeRemoverOnTargetDispose)}},one:function(){for(var _this2=this,_len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}var _normalizeListenArgs2=normalizeListenArgs(this,args),isTargetingSelf=_normalizeListenArgs2.isTargetingSelf,target=_normalizeListenArgs2.target,type=_normalizeListenArgs2.type,listener=_normalizeListenArgs2.listener;if(isTargetingSelf){listen(target,"one",type,listener)}else{var wrapper=function wrapper(){_this2.off(target,type,wrapper);for(var _len3=arguments.length,largs=Array(_len3),_key3=0;_key3<_len3;_key3++){largs[_key3]=arguments[_key3]}listener.apply(null,largs)};wrapper.guid=listener.guid;listen(target,"one",type,wrapper)}},any:function(){for(var _this3=this,_len4=arguments.length,args=Array(_len4),_key4=0;_key4<_len4;_key4++){args[_key4]=arguments[_key4]}var _normalizeListenArgs3=normalizeListenArgs(this,args),isTargetingSelf=_normalizeListenArgs3.isTargetingSelf,target=_normalizeListenArgs3.target,type=_normalizeListenArgs3.type,listener=_normalizeListenArgs3.listener;if(isTargetingSelf){listen(target,"any",type,listener)}else{var wrapper=function wrapper(){_this3.off(target,type,wrapper);for(var _len5=arguments.length,largs=Array(_len5),_key5=0;_key5<_len5;_key5++){largs[_key5]=arguments[_key5]}listener.apply(null,largs)};wrapper.guid=listener.guid;listen(target,"any",type,wrapper)}},off:function(targetOrType,typeOrListener,listener){if(!targetOrType||isValidEventType(targetOrType)){off(this.eventBusEl_,targetOrType,typeOrListener)}else{var target=targetOrType,type=typeOrListener;validateTarget(target);validateEventType(type);validateListener(listener);listener=bind(this,listener);this.off("dispose",listener);if(target.nodeName){off(target,type,listener);off(target,"dispose",listener)}else if(isEvented(target)){target.off(type,listener);target.off("dispose",listener)}}},trigger:function(event,hash){return trigger(this.eventBusEl_,event,hash)}};function evented(target,options){if(void 0===options){options={}}var _options=options,eventBusKey=_options.eventBusKey;if(eventBusKey){if(!target[eventBusKey].nodeName){throw new Error("The eventBusKey \""+eventBusKey+"\" does not refer to an element.")}target.eventBusEl_=target[eventBusKey]}else{target.eventBusEl_=createEl("span",{className:"vjs-event-bus"})}assign(target,EventedMixin);if(target.eventedCallbacks){target.eventedCallbacks.forEach(function(callback){callback()})}target.on("dispose",function(){target.off();window$3.setTimeout(function(){target.eventBusEl_=null},0)});return target}var StatefulMixin={state:{},setState:function(stateUpdates){var _this=this;if("function"==typeof stateUpdates){stateUpdates=stateUpdates()}var changes;each(stateUpdates,function(value,key){if(_this.state[key]!==value){changes=changes||{};changes[key]={from:_this.state[key],to:value}}_this.state[key]=value});if(changes&&isEvented(this)){this.trigger({changes:changes,type:"statechanged"})}return changes}};function stateful(target,defaultState){assign(target,StatefulMixin);target.state=assign({},target.state,defaultState);if("function"==typeof target.handleStateChanged&&isEvented(target)){target.on("statechanged",target.handleStateChanged)}return target}var toLowerCase=function(string){if("string"!=typeof string){return string}return string.replace(/./,function(w){return w.toLowerCase()})},toTitleCase=function(string){if("string"!=typeof string){return string}return string.replace(/./,function(w){return w.toUpperCase()})},titleCaseEquals=function(str1,str2){return toTitleCase(str1)===toTitleCase(str2)};function mergeOptions(){for(var result={},_len=arguments.length,sources=Array(_len),_key=0;_key<_len;_key++){sources[_key]=arguments[_key]}sources.forEach(function(source){if(!source){return}each(source,function(value,key){if(!isPlain(value)){result[key]=value;return}if(!isPlain(result[key])){result[key]={}}result[key]=mergeOptions(result[key],value)})});return result}var MapSham=function(){function MapSham(){this.map_={}}var _proto=MapSham.prototype;_proto.has=function(key){return key in this.map_};_proto["delete"]=function(key){var has=this.has(key);delete this.map_[key];return has};_proto.set=function(key,value){this.set_[key]=value;return this};_proto.forEach=function(callback,thisArg){for(var key in this.map_){callback.call(thisArg,this.map_[key],key,this)}};return MapSham}(),Map$1=window$3.Map?window$3.Map:MapSham,SetSham=function(){function SetSham(){this.set_={}}var _proto=SetSham.prototype;_proto.has=function(key){return key in this.set_};_proto["delete"]=function(key){var has=this.has(key);delete this.set_[key];return has};_proto.add=function(key){this.set_[key]=1;return this};_proto.forEach=function(callback,thisArg){for(var key in this.set_){callback.call(thisArg,key,key,this)}};return SetSham}(),Set=window$3.Set?window$3.Set:SetSham,Component=function(){function Component(player,options,ready){if(!player&&this.play){this.player_=player=this}else{this.player_=player}this.isDisposed_=!1;this.parentComponent_=null;this.options_=mergeOptions({},this.options_);options=this.options_=mergeOptions(this.options_,options);this.id_=options.id||options.el&&options.el.id;if(!this.id_){var id=player&&player.id&&player.id()||"no_player";this.id_=id+"_component_"+newGUID()}this.name_=options.name||null;if(options.el){this.el_=options.el}else if(!1!==options.createEl){this.el_=this.createEl()}if(!1!==options.evented){evented(this,{eventBusKey:this.el_?"el_":null})}stateful(this,this.constructor.defaultState);this.children_=[];this.childIndex_={};this.childNameIndex_={};this.setTimeoutIds_=new Set;this.setIntervalIds_=new Set;this.rafIds_=new Set;this.namedRafs_=new Map$1;this.clearingTimersOnDispose_=!1;if(!1!==options.initChildren){this.initChildren()}this.ready(ready);if(!1!==options.reportTouchActivity){this.enableTouchActivity()}}var _proto=Component.prototype;_proto.dispose=function(){if(this.isDisposed_){return}this.trigger({type:"dispose",bubbles:!1});this.isDisposed_=!0;if(this.children_){for(var i=this.children_.length-1;0<=i;i--){if(this.children_[i].dispose){this.children_[i].dispose()}}}this.children_=null;this.childIndex_=null;this.childNameIndex_=null;this.parentComponent_=null;if(this.el_){if(this.el_.parentNode){this.el_.parentNode.removeChild(this.el_)}if(DomData.has(this.el_)){DomData["delete"](this.el_)}this.el_=null}this.player_=null};_proto.isDisposed=function(){return!!this.isDisposed_};_proto.player=function(){return this.player_};_proto.options=function(obj){if(!obj){return this.options_}this.options_=mergeOptions(this.options_,obj);return this.options_};_proto.el=function(){return this.el_};_proto.createEl=function(tagName,properties,attributes){return createEl(tagName,properties,attributes)};_proto.localize=function(string,tokens,defaultValue){if(void 0===defaultValue){defaultValue=string}var code=this.player_.language&&this.player_.language(),languages=this.player_.languages&&this.player_.languages(),language=languages&&languages[code],primaryCode=code&&code.split("-")[0],primaryLang=languages&&languages[primaryCode],localizedString=defaultValue;if(language&&language[string]){localizedString=language[string]}else if(primaryLang&&primaryLang[string]){localizedString=primaryLang[string]}if(tokens){localizedString=localizedString.replace(/\{(\d+)\}/g,function(match,index){var value=tokens[index-1],ret=value;if("undefined"==typeof value){ret=match}return ret})}return localizedString};_proto.contentEl=function(){return this.contentEl_||this.el_};_proto.id=function(){return this.id_};_proto.name=function(){return this.name_};_proto.children=function(){return this.children_};_proto.getChildById=function(id){return this.childIndex_[id]};_proto.getChild=function(name){if(!name){return}return this.childNameIndex_[name]};_proto.getDescendant=function(){for(var _len=arguments.length,names=Array(_len),_key=0;_key<_len;_key++){names[_key]=arguments[_key]}names=names.reduce(function(acc,n){return acc.concat(n)},[]);for(var currentChild=this,i=0;i<names.length;i++){currentChild=currentChild.getChild(names[i]);if(!currentChild||!currentChild.getChild){return}}return currentChild};_proto.addChild=function(child,options,index){if(void 0===options){options={}}if(void 0===index){index=this.children_.length}var component,componentName;if("string"==typeof child){componentName=toTitleCase(child);var componentClassName=options.componentClass||componentName;options.name=componentName;var ComponentClass=Component.getComponent(componentClassName);if(!ComponentClass){throw new Error("Component "+componentClassName+" does not exist")}if("function"!=typeof ComponentClass){return null}component=new ComponentClass(this.player_||this,options)}else{component=child}if(component.parentComponent_){component.parentComponent_.removeChild(component)}this.children_.splice(index,0,component);component.parentComponent_=this;if("function"==typeof component.id){this.childIndex_[component.id()]=component}componentName=componentName||component.name&&toTitleCase(component.name());if(componentName){this.childNameIndex_[componentName]=component;this.childNameIndex_[toLowerCase(componentName)]=component}if("function"==typeof component.el&&component.el()){var refNode=null;if(this.children_[index+1]){if(this.children_[index+1].el_){refNode=this.children_[index+1].el_}else if(isEl(this.children_[index+1])){refNode=this.children_[index+1]}}this.contentEl().insertBefore(component.el(),refNode)}return component};_proto.removeChild=function(component){if("string"==typeof component){component=this.getChild(component)}if(!component||!this.children_){return}for(var childFound=!1,i=this.children_.length-1;0<=i;i--){if(this.children_[i]===component){childFound=!0;this.children_.splice(i,1);break}}if(!childFound){return}component.parentComponent_=null;this.childIndex_[component.id()]=null;this.childNameIndex_[toTitleCase(component.name())]=null;this.childNameIndex_[toLowerCase(component.name())]=null;var compEl=component.el();if(compEl&&compEl.parentNode===this.contentEl()){this.contentEl().removeChild(component.el())}};_proto.initChildren=function(){var _this=this,children=this.options_.children;if(children){var parentOptions=this.options_,handleAdd=function(child){var name=child.name,opts=child.opts;if(parentOptions[name]!==void 0){opts=parentOptions[name]}if(!1===opts){return}if(!0===opts){opts={}}opts.playerOptions=_this.options_.playerOptions;var newChild=_this.addChild(name,opts);if(newChild){_this[name]=newChild}},workingChildren,Tech=Component.getComponent("Tech");if(Array.isArray(children)){workingChildren=children}else{workingChildren=Object.keys(children)}workingChildren.concat(Object.keys(this.options_).filter(function(child){return!workingChildren.some(function(wchild){if("string"==typeof wchild){return child===wchild}return child===wchild.name})})).map(function(child){var name,opts;if("string"==typeof child){name=child;opts=children[name]||_this.options_[name]||{}}else{name=child.name;opts=child}return{name:name,opts:opts}}).filter(function(child){var c=Component.getComponent(child.opts.componentClass||toTitleCase(child.name));return c&&!Tech.isTech(c)}).forEach(handleAdd)}};_proto.buildCSSClass=function(){return""};_proto.ready=function(fn,sync){if(void 0===sync){sync=!1}if(!fn){return}if(!this.isReady_){this.readyQueue_=this.readyQueue_||[];this.readyQueue_.push(fn);return}if(sync){fn.call(this)}else{this.setTimeout(fn,1)}};_proto.triggerReady=function(){this.isReady_=!0;this.setTimeout(function(){var readyQueue=this.readyQueue_;this.readyQueue_=[];if(readyQueue&&0<readyQueue.length){readyQueue.forEach(function(fn){fn.call(this)},this)}this.trigger("ready")},1)};_proto.$=function(selector,context){return $(selector,context||this.contentEl())};_proto.$$=function(selector,context){return $$(selector,context||this.contentEl())};_proto.hasClass=function(classToCheck){return hasClass(this.el_,classToCheck)};_proto.addClass=function(classToAdd){addClass(this.el_,classToAdd)};_proto.removeClass=function(classToRemove){removeClass(this.el_,classToRemove)};_proto.toggleClass=function(classToToggle,predicate){toggleClass(this.el_,classToToggle,predicate)};_proto.show=function(){this.removeClass("vjs-hidden")};_proto.hide=function(){this.addClass("vjs-hidden")};_proto.lockShowing=function(){this.addClass("vjs-lock-showing")};_proto.unlockShowing=function(){this.removeClass("vjs-lock-showing")};_proto.getAttribute=function(attribute){return getAttribute(this.el_,attribute)};_proto.setAttribute=function(attribute,value){setAttribute(this.el_,attribute,value)};_proto.removeAttribute=function(attribute){removeAttribute(this.el_,attribute)};_proto.width=function(num,skipListeners){return this.dimension("width",num,skipListeners)};_proto.height=function(num,skipListeners){return this.dimension("height",num,skipListeners)};_proto.dimensions=function(width,height){this.width(width,!0);this.height(height)};_proto.dimension=function(widthOrHeight,num,skipListeners){if(num!==void 0){if(null===num||num!==num){num=0}if(-1!==(""+num).indexOf("%")||-1!==(""+num).indexOf("px")){this.el_.style[widthOrHeight]=num}else if("auto"===num){this.el_.style[widthOrHeight]=""}else{this.el_.style[widthOrHeight]=num+"px"}if(!skipListeners){this.trigger("componentresize")}return}if(!this.el_){return 0}var val=this.el_.style[widthOrHeight],pxIndex=val.indexOf("px");if(-1!==pxIndex){return parseInt(val.slice(0,pxIndex),10)}return parseInt(this.el_["offset"+toTitleCase(widthOrHeight)],10)};_proto.currentDimension=function(widthOrHeight){var computedWidthOrHeight=0;if("width"!==widthOrHeight&&"height"!==widthOrHeight){throw new Error("currentDimension only accepts width or height value")}computedWidthOrHeight=computedStyle(this.el_,widthOrHeight);computedWidthOrHeight=parseFloat(computedWidthOrHeight);if(0===computedWidthOrHeight||isNaN(computedWidthOrHeight)){var rule="offset"+toTitleCase(widthOrHeight);computedWidthOrHeight=this.el_[rule]}return computedWidthOrHeight};_proto.currentDimensions=function(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}};_proto.currentWidth=function(){return this.currentDimension("width")};_proto.currentHeight=function(){return this.currentDimension("height")};_proto.focus=function(){this.el_.focus()};_proto.blur=function(){this.el_.blur()};_proto.handleKeyDown=function(event){if(this.player_){event.stopPropagation();this.player_.handleKeyDown(event)}};_proto.handleKeyPress=function(event){this.handleKeyDown(event)};_proto.emitTapEvents=function(){var touchStart=0,firstTouch=null,couldBeTap;this.on("touchstart",function(event){if(1===event.touches.length){firstTouch={pageX:event.touches[0].pageX,pageY:event.touches[0].pageY};touchStart=window$3.performance.now();couldBeTap=!0}});this.on("touchmove",function(event){if(1<event.touches.length){couldBeTap=!1}else if(firstTouch){var xdiff=event.touches[0].pageX-firstTouch.pageX,ydiff=event.touches[0].pageY-firstTouch.pageY,touchDistance=Math.sqrt(xdiff*xdiff+ydiff*ydiff);if(touchDistance>10){couldBeTap=!1}}});var noTap=function(){couldBeTap=!1};this.on("touchleave",noTap);this.on("touchcancel",noTap);this.on("touchend",function(event){firstTouch=null;if(!0===couldBeTap){var touchTime=window$3.performance.now()-touchStart;if(touchTime<200){event.preventDefault();this.trigger("tap")}}})};_proto.enableTouchActivity=function(){if(!this.player()||!this.player().reportUserActivity){return}var report=bind(this.player(),this.player().reportUserActivity),touchHolding;this.on("touchstart",function(){report();this.clearInterval(touchHolding);touchHolding=this.setInterval(report,250)});var touchEnd=function(){report();this.clearInterval(touchHolding)};this.on("touchmove",report);this.on("touchend",touchEnd);this.on("touchcancel",touchEnd)};_proto.setTimeout=function(fn,timeout){var _this2=this,timeoutId;fn=bind(this,fn);this.clearTimersOnDispose_();timeoutId=window$3.setTimeout(function(){if(_this2.setTimeoutIds_.has(timeoutId)){_this2.setTimeoutIds_["delete"](timeoutId)}fn()},timeout);this.setTimeoutIds_.add(timeoutId);return timeoutId};_proto.clearTimeout=function(timeoutId){if(this.setTimeoutIds_.has(timeoutId)){this.setTimeoutIds_["delete"](timeoutId);window$3.clearTimeout(timeoutId)}return timeoutId};_proto.setInterval=function(fn,interval){fn=bind(this,fn);this.clearTimersOnDispose_();var intervalId=window$3.setInterval(fn,interval);this.setIntervalIds_.add(intervalId);return intervalId};_proto.clearInterval=function(intervalId){if(this.setIntervalIds_.has(intervalId)){this.setIntervalIds_["delete"](intervalId);window$3.clearInterval(intervalId)}return intervalId};_proto.requestAnimationFrame=function(fn){var _this3=this;if(!this.supportsRaf_){return this.setTimeout(fn,1e3/60)}this.clearTimersOnDispose_();var id;fn=bind(this,fn);id=window$3.requestAnimationFrame(function(){if(_this3.rafIds_.has(id)){_this3.rafIds_["delete"](id)}fn()});this.rafIds_.add(id);return id};_proto.requestNamedAnimationFrame=function(name,fn){var _this4=this;if(this.namedRafs_.has(name)){return}this.clearTimersOnDispose_();fn=bind(this,fn);var id=this.requestAnimationFrame(function(){fn();if(_this4.namedRafs_.has(name)){_this4.namedRafs_["delete"](name)}});this.namedRafs_.set(name,id);return name};_proto.cancelNamedAnimationFrame=function(name){if(!this.namedRafs_.has(name)){return}this.cancelAnimationFrame(this.namedRafs_.get(name));this.namedRafs_["delete"](name)};_proto.cancelAnimationFrame=function(id){if(!this.supportsRaf_){return this.clearTimeout(id)}if(this.rafIds_.has(id)){this.rafIds_["delete"](id);window$3.cancelAnimationFrame(id)}return id};_proto.clearTimersOnDispose_=function(){var _this5=this;if(this.clearingTimersOnDispose_){return}this.clearingTimersOnDispose_=!0;this.one("dispose",function(){[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(function(_ref){var idName=_ref[0],cancelName=_ref[1];_this5[idName].forEach(function(val,key){return _this5[cancelName](key)})});_this5.clearingTimersOnDispose_=!1})};Component.registerComponent=function(name,ComponentToRegister){if("string"!=typeof name||!name){throw new Error("Illegal component name, \""+name+"\"; must be a non-empty string.")}var Tech=Component.getComponent("Tech"),isTech=Tech&&Tech.isTech(ComponentToRegister),isComp=Component===ComponentToRegister||Component.prototype.isPrototypeOf(ComponentToRegister.prototype);if(isTech||!isComp){var reason;if(isTech){reason="techs must be registered using Tech.registerTech()"}else{reason="must be a Component subclass"}throw new Error("Illegal component, \""+name+"\"; "+reason+".")}name=toTitleCase(name);if(!Component.components_){Component.components_={}}var Player=Component.getComponent("Player");if("Player"===name&&Player&&Player.players){var players=Player.players,playerNames=Object.keys(players);if(players&&0<playerNames.length&&playerNames.map(function(pname){return players[pname]}).every(Boolean)){throw new Error("Can not register Player component after player has been created.")}}Component.components_[name]=ComponentToRegister;Component.components_[toLowerCase(name)]=ComponentToRegister;return ComponentToRegister};Component.getComponent=function(name){if(!name||!Component.components_){return}return Component.components_[name]};return Component}();Component.prototype.supportsRaf_="function"==typeof window$3.requestAnimationFrame&&"function"==typeof window$3.cancelAnimationFrame;Component.registerComponent("Component",Component);var assertThisInitialized=function(self){if(void 0===self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self},_typeof_1=createCommonjsModule(function(module){function _typeof(obj){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){module.exports=_typeof=function(obj){return typeof obj}}else{module.exports=_typeof=function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}module.exports=_typeof}),getPrototypeOf=createCommonjsModule(function(module){function _getPrototypeOf(o){module.exports=_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}module.exports=_getPrototypeOf});var inheritsLoose=function(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;subClass.__proto__=superClass},USER_AGENT=window$3.navigator&&window$3.navigator.userAgent||"",webkitVersionMap=/AppleWebKit\/([\d.]+)/i.exec(USER_AGENT),appleWebkitVersion=webkitVersionMap?parseFloat(webkitVersionMap.pop()):null,IS_IPOD=/iPod/i.test(USER_AGENT),IOS_VERSION=function(){var match=USER_AGENT.match(/OS (\d+)_/i);if(match&&match[1]){return match[1]}return null}(),IS_ANDROID=/Android/i.test(USER_AGENT),ANDROID_VERSION=function(){var match=USER_AGENT.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!match){return null}var major=match[1]&&parseFloat(match[1]),minor=match[2]&&parseFloat(match[2]);if(major&&minor){return parseFloat(match[1]+"."+match[2])}else if(major){return major}return null}(),IS_NATIVE_ANDROID=IS_ANDROID&&5>ANDROID_VERSION&&537>appleWebkitVersion,IS_FIREFOX=/Firefox/i.test(USER_AGENT),IS_EDGE=/Edg/i.test(USER_AGENT),IS_CHROME=!IS_EDGE&&(/Chrome/i.test(USER_AGENT)||/CriOS/i.test(USER_AGENT)),CHROME_VERSION=function(){var match=USER_AGENT.match(/(Chrome|CriOS)\/(\d+)/);if(match&&match[2]){return parseFloat(match[2])}return null}(),IE_VERSION=function(){var result=/MSIE\s(\d+)\.\d/.exec(USER_AGENT),version=result&&parseFloat(result[1]);return"7.10.0"}(),IS_SAFARI=/Safari/i.test(USER_AGENT)&&!IS_CHROME&&!IS_ANDROID&&!IS_EDGE,IS_WINDOWS=/Windows/i.test(USER_AGENT),TOUCH_ENABLED=isReal()&&("ontouchstart"in window$3||window$3.navigator.maxTouchPoints||window$3.DocumentTouch&&window$3.document instanceof window$3.DocumentTouch),IS_IPAD=/iPad/i.test(USER_AGENT)||IS_SAFARI&&TOUCH_ENABLED&&!/iPhone/i.test(USER_AGENT),IS_IPHONE=/iPhone/i.test(USER_AGENT)&&!IS_IPAD,IS_IOS=IS_IPHONE||IS_IPAD||IS_IPOD,IS_ANY_SAFARI=(IS_SAFARI||IS_IOS)&&!IS_CHROME,browser=Object.freeze({__proto__:null,IS_IPOD:IS_IPOD,IOS_VERSION:IOS_VERSION,IS_ANDROID:IS_ANDROID,ANDROID_VERSION:ANDROID_VERSION,IS_NATIVE_ANDROID:IS_NATIVE_ANDROID,IS_FIREFOX:IS_FIREFOX,IS_EDGE:IS_EDGE,IS_CHROME:IS_CHROME,CHROME_VERSION:CHROME_VERSION,IE_VERSION:IE_VERSION,IS_SAFARI:IS_SAFARI,IS_WINDOWS:IS_WINDOWS,TOUCH_ENABLED:TOUCH_ENABLED,IS_IPAD:IS_IPAD,IS_IPHONE:IS_IPHONE,IS_IOS:IS_IOS,IS_ANY_SAFARI:IS_ANY_SAFARI});function rangeCheck(fnName,index,maxIndex){if("number"!=typeof index||0>index||index>maxIndex){throw new Error("Failed to execute '"+fnName+"' on 'TimeRanges': The index provided ("+index+") is non-numeric or out of bounds (0-"+maxIndex+").")}}function getRange(fnName,valueIndex,ranges,rangeIndex){rangeCheck(fnName,rangeIndex,ranges.length-1);return ranges[rangeIndex][valueIndex]}function createTimeRangesObj(ranges){if(ranges===void 0||0===ranges.length){return{length:0,start:function(){throw new Error("This TimeRanges object is empty")},end:function(){throw new Error("This TimeRanges object is empty")}}}return{length:ranges.length,start:getRange.bind(null,"start",0,ranges),end:getRange.bind(null,"end",1,ranges)}}function createTimeRanges(start,end){if(Array.isArray(start)){return createTimeRangesObj(start)}else if(start===void 0||end===void 0){return createTimeRangesObj()}return createTimeRangesObj([[start,end]])}function bufferedPercent(buffered,duration){var bufferedDuration=0,start,end;if(!duration){return 0}if(!buffered||!buffered.length){buffered=createTimeRanges(0,0)}for(var i=0;i<buffered.length;i++){start=buffered.start(i);end=buffered.end(i);if(end>duration){end=duration}bufferedDuration+=end-start}return bufferedDuration/duration}for(var FullscreenApi={prefixed:!0},apiMap=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"]],specApi=apiMap[0],browserApi,i=0;i<apiMap.length;i++){if(apiMap[i][1]in document){browserApi=apiMap[i];break}}if(browserApi){for(var _i=0;_i<browserApi.length;_i++){FullscreenApi[specApi[_i]]=browserApi[_i]}FullscreenApi.prefixed=browserApi[0]!==specApi[0]}function MediaError(value){if(value instanceof MediaError){return value}if("number"==typeof value){this.code=value}else if("string"==typeof value){this.message=value}else if(isObject(value)){if("number"==typeof value.code){this.code=value.code}assign(this,value)}if(!this.message){this.message=MediaError.defaultMessages[this.code]||""}}MediaError.prototype.code=0;MediaError.prototype.message="";MediaError.prototype.status=null;MediaError.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"];MediaError.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(var errNum=0;errNum<MediaError.errorTypes.length;errNum++){MediaError[MediaError.errorTypes[errNum]]=errNum;MediaError.prototype[MediaError.errorTypes[errNum]]=errNum}function isPromise(value){return value!==void 0&&null!==value&&"function"==typeof value.then}function silencePromise(value){if(isPromise(value)){value.then(null,function(){})}}var trackToJson_=function(track){var ret=["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce(function(acc,prop){if(track[prop]){acc[prop]=track[prop]}return acc},{cues:track.cues&&Array.prototype.map.call(track.cues,function(cue){return{startTime:cue.startTime,endTime:cue.endTime,text:cue.text,id:cue.id}})});return ret},textTrackConverter={textTracksToJson:function(tech){var trackEls=tech.$$("track"),trackObjs=Array.prototype.map.call(trackEls,function(t){return t.track}),tracks=Array.prototype.map.call(trackEls,function(trackEl){var json=trackToJson_(trackEl.track);if(trackEl.src){json.src=trackEl.src}return json});return tracks.concat(Array.prototype.filter.call(tech.textTracks(),function(track){return-1===trackObjs.indexOf(track)}).map(trackToJson_))},jsonToTextTracks:function(json,tech){json.forEach(function(track){var addedTrack=tech.addRemoteTextTrack(track).track;if(!track.src&&track.cues){track.cues.forEach(function(cue){return addedTrack.addCue(cue)})}});return tech.textTracks()},trackToJson_:trackToJson_},keycode=createCommonjsModule(function(module,exports){function keyCode(searchInput){if(searchInput&&"object"===_typeof2(searchInput)){var hasKeyCode=searchInput.which||searchInput.keyCode||searchInput.charCode;if(hasKeyCode)searchInput=hasKeyCode}if("number"==typeof searchInput)return names[searchInput];var search=searchInput+"",foundNamedKey=codes[search.toLowerCase()];if(foundNamedKey)return foundNamedKey;var foundNamedKey=aliases[search.toLowerCase()];if(foundNamedKey)return foundNamedKey;if(1===search.length)return search.charCodeAt(0)}keyCode.isEventKey=function(event,nameOrCode){if(event&&"object"===_typeof2(event)){var keyCode=event.which||event.keyCode||event.charCode;if(null===keyCode||keyCode===void 0){return!1}if("string"==typeof nameOrCode){var foundNamedKey=codes[nameOrCode.toLowerCase()];if(foundNamedKey){return foundNamedKey===keyCode}var foundNamedKey=aliases[nameOrCode.toLowerCase()];if(foundNamedKey){return foundNamedKey===keyCode}}else if("number"==typeof nameOrCode){return nameOrCode===keyCode}return!1}};exports=module.exports=keyCode;var codes=exports.code=exports.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},aliases=exports.aliases={windows:91,"":16,"":18,"":17,"":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};for(i=97;123>i;i++){codes[String.fromCharCode(i)]=i-32}for(var i=48;58>i;i++){codes[i-48]=i}for(i=1;13>i;i++){codes["f"+i]=i+111}for(i=0;10>i;i++){codes["numpad "+i]=i+96}var names=exports.names=exports.title={};for(i in codes){names[codes[i]]=i}for(var alias in aliases){codes[alias]=aliases[alias]}}),keycode_1=keycode.code,keycode_2=keycode.codes,keycode_3=keycode.aliases,keycode_4=keycode.names,keycode_5=keycode.title,MODAL_CLASS_NAME="vjs-modal-dialog",ModalDialog=function(_Component){inheritsLoose(ModalDialog,_Component);function ModalDialog(player,options){var _this=_Component.call(this,player,options)||this;_this.opened_=_this.hasBeenOpened_=_this.hasBeenFilled_=!1;_this.closeable(!_this.options_.uncloseable);_this.content(_this.options_.content);_this.contentEl_=createEl("div",{className:MODAL_CLASS_NAME+"-content"},{role:"document"});_this.descEl_=createEl("p",{className:MODAL_CLASS_NAME+"-description vjs-control-text",id:_this.el().getAttribute("aria-describedby")});textContent(_this.descEl_,_this.description());_this.el_.appendChild(_this.descEl_);_this.el_.appendChild(_this.contentEl_);return _this}var _proto=ModalDialog.prototype;_proto.createEl=function(){return _Component.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":this.id()+"_description","aria-hidden":"true","aria-label":this.label(),role:"dialog"})};_proto.dispose=function(){this.contentEl_=null;this.descEl_=null;this.previouslyActiveEl_=null;_Component.prototype.dispose.call(this)};_proto.buildCSSClass=function(){return MODAL_CLASS_NAME+" vjs-hidden "+_Component.prototype.buildCSSClass.call(this)};_proto.label=function(){return this.localize(this.options_.label||"Modal Window")};_proto.description=function(){var desc=this.options_.description||this.localize("This is a modal window.");if(this.closeable()){desc+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")}return desc};_proto.open=function(){if(!this.opened_){var player=this.player();this.trigger("beforemodalopen");this.opened_=!0;if(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_){this.fill()}this.wasPlaying_=!player.paused();if(this.options_.pauseOnOpen&&this.wasPlaying_){player.pause()}this.on("keydown",this.handleKeyDown);this.hadControls_=player.controls();player.controls(!1);this.show();this.conditionalFocus_();this.el().setAttribute("aria-hidden","false");this.trigger("modalopen");this.hasBeenOpened_=!0}};_proto.opened=function(value){if("boolean"==typeof value){this[value?"open":"close"]()}return this.opened_};_proto.close=function(){if(!this.opened_){return}var player=this.player();this.trigger("beforemodalclose");this.opened_=!1;if(this.wasPlaying_&&this.options_.pauseOnOpen){player.play()}this.off("keydown",this.handleKeyDown);if(this.hadControls_){player.controls(!0)}this.hide();this.el().setAttribute("aria-hidden","true");this.trigger("modalclose");this.conditionalBlur_();if(this.options_.temporary){this.dispose()}};_proto.closeable=function closeable(value){if("boolean"==typeof value){var closeable=this.closeable_=!!value,close=this.getChild("closeButton");if(closeable&&!close){var temp=this.contentEl_;this.contentEl_=this.el_;close=this.addChild("closeButton",{controlText:"Close Modal Dialog"});this.contentEl_=temp;this.on(close,"close",this.close)}if(!closeable&&close){this.off(close,"close",this.close);this.removeChild(close);close.dispose()}}return this.closeable_};_proto.fill=function(){this.fillWith(this.content())};_proto.fillWith=function(content){var contentEl=this.contentEl(),parentEl=contentEl.parentNode,nextSiblingEl=contentEl.nextSibling;this.trigger("beforemodalfill");this.hasBeenFilled_=!0;parentEl.removeChild(contentEl);this.empty();insertContent(contentEl,content);this.trigger("modalfill");if(nextSiblingEl){parentEl.insertBefore(contentEl,nextSiblingEl)}else{parentEl.appendChild(contentEl)}var closeButton=this.getChild("closeButton");if(closeButton){parentEl.appendChild(closeButton.el_)}};_proto.empty=function(){this.trigger("beforemodalempty");emptyEl(this.contentEl());this.trigger("modalempty")};_proto.content=function(value){if("undefined"!=typeof value){this.content_=value}return this.content_};_proto.conditionalFocus_=function(){var activeEl=document.activeElement,playerEl=this.player_.el_;this.previouslyActiveEl_=null;if(playerEl.contains(activeEl)||playerEl===activeEl){this.previouslyActiveEl_=activeEl;this.focus()}};_proto.conditionalBlur_=function(){if(this.previouslyActiveEl_){this.previouslyActiveEl_.focus();this.previouslyActiveEl_=null}};_proto.handleKeyDown=function(event){event.stopPropagation();if(keycode.isEventKey(event,"Escape")&&this.closeable()){event.preventDefault();this.close();return}if(!keycode.isEventKey(event,"Tab")){return}for(var focusableEls=this.focusableEls_(),activeEl=this.el_.querySelector(":focus"),focusIndex,i=0;i<focusableEls.length;i++){if(activeEl===focusableEls[i]){focusIndex=i;break}}if(document.activeElement===this.el_){focusIndex=0}if(event.shiftKey&&0===focusIndex){focusableEls[focusableEls.length-1].focus();event.preventDefault()}else if(!event.shiftKey&&focusIndex===focusableEls.length-1){focusableEls[0].focus();event.preventDefault()}};_proto.focusableEls_=function(){var allChildren=this.el_.querySelectorAll("*");return Array.prototype.filter.call(allChildren,function(child){return(child instanceof window$3.HTMLAnchorElement||child instanceof window$3.HTMLAreaElement)&&child.hasAttribute("href")||(child instanceof window$3.HTMLInputElement||child instanceof window$3.HTMLSelectElement||child instanceof window$3.HTMLTextAreaElement||child instanceof window$3.HTMLButtonElement)&&!child.hasAttribute("disabled")||child instanceof window$3.HTMLIFrameElement||child instanceof window$3.HTMLObjectElement||child instanceof window$3.HTMLEmbedElement||child.hasAttribute("tabindex")&&-1!==child.getAttribute("tabindex")||child.hasAttribute("contenteditable")})};return ModalDialog}(Component);ModalDialog.prototype.options_={pauseOnOpen:!0,temporary:!0};Component.registerComponent("ModalDialog",ModalDialog);var TrackList=function(_EventTarget){inheritsLoose(TrackList,_EventTarget);function TrackList(tracks){var _this;if(void 0===tracks){tracks=[]}_this=_EventTarget.call(this)||this;_this.tracks_=[];Object.defineProperty(assertThisInitialized(_this),"length",{get:function(){return this.tracks_.length}});for(var i=0;i<tracks.length;i++){_this.addTrack(tracks[i])}return _this}var _proto=TrackList.prototype;_proto.addTrack=function(track){var index=this.tracks_.length;if(!(""+index in this)){Object.defineProperty(this,index,{get:function(){return this.tracks_[index]}})}if(-1===this.tracks_.indexOf(track)){this.tracks_.push(track);this.trigger({track:track,type:"addtrack",target:this})}};_proto.removeTrack=function(rtrack){for(var track,i=0,l=this.length;i<l;i++){if(this[i]===rtrack){track=this[i];if(track.off){track.off()}this.tracks_.splice(i,1);break}}if(!track){return}this.trigger({track:track,type:"removetrack",target:this})};_proto.getTrackById=function(id){for(var result=null,i=0,l=this.length,track;i<l;i++){track=this[i];if(track.id===id){result=track;break}}return result};return TrackList}(EventTarget);TrackList.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack"};for(var event in TrackList.prototype.allowedEvents_){TrackList.prototype["on"+event]=null}var disableOthers=function(list,track){for(var i=0;i<list.length;i++){if(!Object.keys(list[i]).length||track.id===list[i].id){continue}list[i].enabled=!1}},AudioTrackList=function(_TrackList){inheritsLoose(AudioTrackList,_TrackList);function AudioTrackList(tracks){var _this;if(void 0===tracks){tracks=[]}for(var i=tracks.length-1;0<=i;i--){if(tracks[i].enabled){disableOthers(tracks,tracks[i]);break}}_this=_TrackList.call(this,tracks)||this;_this.changing_=!1;return _this}var _proto=AudioTrackList.prototype;_proto.addTrack=function(track){var _this2=this;if(track.enabled){disableOthers(this,track)}_TrackList.prototype.addTrack.call(this,track);if(!track.addEventListener){return}track.enabledChange_=function(){if(_this2.changing_){return}_this2.changing_=!0;disableOthers(_this2,track);_this2.changing_=!1;_this2.trigger("change")};track.addEventListener("enabledchange",track.enabledChange_)};_proto.removeTrack=function(rtrack){_TrackList.prototype.removeTrack.call(this,rtrack);if(rtrack.removeEventListener&&rtrack.enabledChange_){rtrack.removeEventListener("enabledchange",rtrack.enabledChange_);rtrack.enabledChange_=null}};return AudioTrackList}(TrackList),disableOthers$1=function(list,track){for(var i=0;i<list.length;i++){if(!Object.keys(list[i]).length||track.id===list[i].id){continue}list[i].selected=!1}},VideoTrackList=function(_TrackList){inheritsLoose(VideoTrackList,_TrackList);function VideoTrackList(tracks){var _this;if(void 0===tracks){tracks=[]}for(var i=tracks.length-1;0<=i;i--){if(tracks[i].selected){disableOthers$1(tracks,tracks[i]);break}}_this=_TrackList.call(this,tracks)||this;_this.changing_=!1;Object.defineProperty(assertThisInitialized(_this),"selectedIndex",{get:function(){for(var _i=0;_i<this.length;_i++){if(this[_i].selected){return _i}}return-1},set:function(){}});return _this}var _proto=VideoTrackList.prototype;_proto.addTrack=function(track){var _this2=this;if(track.selected){disableOthers$1(this,track)}_TrackList.prototype.addTrack.call(this,track);if(!track.addEventListener){return}track.selectedChange_=function(){if(_this2.changing_){return}_this2.changing_=!0;disableOthers$1(_this2,track);_this2.changing_=!1;_this2.trigger("change")};track.addEventListener("selectedchange",track.selectedChange_)};_proto.removeTrack=function(rtrack){_TrackList.prototype.removeTrack.call(this,rtrack);if(rtrack.removeEventListener&&rtrack.selectedChange_){rtrack.removeEventListener("selectedchange",rtrack.selectedChange_);rtrack.selectedChange_=null}};return VideoTrackList}(TrackList),TextTrackList=function(_TrackList){inheritsLoose(TextTrackList,_TrackList);function TextTrackList(){return _TrackList.apply(this,arguments)||this}var _proto=TextTrackList.prototype;_proto.addTrack=function(track){var _this=this;_TrackList.prototype.addTrack.call(this,track);if(!this.queueChange_){this.queueChange_=function(){return _this.queueTrigger("change")}}if(!this.triggerSelectedlanguagechange){this.triggerSelectedlanguagechange_=function(){return _this.trigger("selectedlanguagechange")}}track.addEventListener("modechange",this.queueChange_);if(-1===["metadata","chapters"].indexOf(track.kind)){track.addEventListener("modechange",this.triggerSelectedlanguagechange_)}};_proto.removeTrack=function(rtrack){_TrackList.prototype.removeTrack.call(this,rtrack);if(rtrack.removeEventListener){if(this.queueChange_){rtrack.removeEventListener("modechange",this.queueChange_)}if(this.selectedlanguagechange_){rtrack.removeEventListener("modechange",this.triggerSelectedlanguagechange_)}}};return TextTrackList}(TrackList),HtmlTrackElementList=function(){function HtmlTrackElementList(trackElements){if(void 0===trackElements){trackElements=[]}this.trackElements_=[];Object.defineProperty(this,"length",{get:function(){return this.trackElements_.length}});for(var i=0,length=trackElements.length;i<length;i++){this.addTrackElement_(trackElements[i])}}var _proto=HtmlTrackElementList.prototype;_proto.addTrackElement_=function(trackElement){var index=this.trackElements_.length;if(!(""+index in this)){Object.defineProperty(this,index,{get:function(){return this.trackElements_[index]}})}if(-1===this.trackElements_.indexOf(trackElement)){this.trackElements_.push(trackElement)}};_proto.getTrackElementByTrack_=function(track){for(var trackElement_,i=0,length=this.trackElements_.length;i<length;i++){if(track===this.trackElements_[i].track){trackElement_=this.trackElements_[i];break}}return trackElement_};_proto.removeTrackElement_=function(trackElement){for(var i=0,length=this.trackElements_.length;i<length;i++){if(trackElement===this.trackElements_[i]){if(this.trackElements_[i].track&&"function"==typeof this.trackElements_[i].track.off){this.trackElements_[i].track.off()}if("function"==typeof this.trackElements_[i].off){this.trackElements_[i].off()}this.trackElements_.splice(i,1);break}}};return HtmlTrackElementList}(),TextTrackCueList=function(){function TextTrackCueList(cues){TextTrackCueList.prototype.setCues_.call(this,cues);Object.defineProperty(this,"length",{get:function(){return this.length_}})}var _proto=TextTrackCueList.prototype;_proto.setCues_=function(cues){var oldLength=this.length||0,i=0,l=cues.length;this.cues_=cues;this.length_=cues.length;var defineProp=function(index){if(!(""+index in this)){Object.defineProperty(this,""+index,{get:function(){return this.cues_[index]}})}};if(oldLength<l){i=oldLength;for(;i<l;i++){defineProp.call(this,i)}}};_proto.getCueById=function(id){for(var result=null,i=0,l=this.length,cue;i<l;i++){cue=this[i];if(cue.id===id){result=cue;break}}return result};return TextTrackCueList}(),VideoTrackKind={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},AudioTrackKind={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},TextTrackKind={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},TextTrackMode={disabled:"disabled",hidden:"hidden",showing:"showing"},Track=function(_EventTarget){inheritsLoose(Track,_EventTarget);function Track(options){var _this;if(void 0===options){options={}}_this=_EventTarget.call(this)||this;var trackProps={id:options.id||"vjs_track_"+newGUID(),kind:options.kind||"",label:options.label||"",language:options.language||""},_loop=function(key){Object.defineProperty(assertThisInitialized(_this),key,{get:function(){return trackProps[key]},set:function(){}})};for(var key in trackProps){_loop(key)}return _this}return Track}(EventTarget),parseUrl=function(url){var props=["protocol","hostname","port","pathname","search","hash","host"],a=document.createElement("a");a.href=url;var addToBody=""===a.host&&"file:"!==a.protocol,div;if(addToBody){div=document.createElement("div");div.innerHTML="<a href=\""+url+"\"></a>";a=div.firstChild;div.setAttribute("style","display:none; position:absolute;");document.body.appendChild(div)}for(var details={},i=0;i<props.length;i++){details[props[i]]=a[props[i]]}if("http:"===details.protocol){details.host=details.host.replace(/:80$/,"")}if("https:"===details.protocol){details.host=details.host.replace(/:443$/,"")}if(!details.protocol){details.protocol=window$3.location.protocol}if(addToBody){document.body.removeChild(div)}return details},getAbsoluteURL=function(url){if(!url.match(/^https?:\/\//)){var div=document.createElement("div");div.innerHTML="<a href=\""+url+"\">x</a>";url=div.firstChild.href}return url},getFileExtension=function(path){if("string"==typeof path){var pathParts=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/.exec(path);if(pathParts){return pathParts.pop().toLowerCase()}}return""},isCrossOrigin=function(url,winLoc){if(void 0===winLoc){winLoc=window$3.location}var urlInfo=parseUrl(url),srcProtocol=":"===urlInfo.protocol?winLoc.protocol:urlInfo.protocol,crossOrigin=srcProtocol+urlInfo.host!==winLoc.protocol+winLoc.host;return crossOrigin},Url=Object.freeze({__proto__:null,parseUrl:parseUrl,getAbsoluteURL:getAbsoluteURL,getFileExtension:getFileExtension,isCrossOrigin:isCrossOrigin}),toString$1=Object.prototype.toString;var parseHeaders=function(headers){var result={};if(!headers){return result}headers.trim().split("\n").forEach(function(row){var index=row.indexOf(":"),key=row.slice(0,index).trim().toLowerCase(),value=row.slice(index+1).trim();if("undefined"==typeof result[key]){result[key]=value}else if(Array.isArray(result[key])){result[key].push(value)}else{result[key]=[result[key],value]}});return result},xhr=createXHR;createXHR.XMLHttpRequest=window$3.XMLHttpRequest||function(){};createXHR.XDomainRequest="withCredentials"in new createXHR.XMLHttpRequest?createXHR.XMLHttpRequest:window$3.XDomainRequest;forEachArray(["get","put","post","patch","head","delete"],function(method){createXHR["delete"===method?"del":method]=function(uri,options,callback){options=initParams(uri,options,callback);options.method=method.toUpperCase();return _createXHR(options)}});function forEachArray(array,iterator){for(var i=0;i<array.length;i++){iterator(array[i])}}function isEmpty(obj){for(var i in obj){if(obj.hasOwnProperty(i))return!1}return!0}function initParams(uri,options,callback){var params=uri;if(isFunction(options)){callback=options;if("string"==typeof uri){params={uri:uri}}}else{params=_extends_1({},options,{uri:uri})}params.callback=callback;return params}function createXHR(uri,options,callback){options=initParams(uri,options,callback);return _createXHR(options)}function _createXHR(options){if("undefined"==typeof options.callback){throw new Error("callback argument missing")}var called=!1,callback=function(err,response,body){if(!called){called=!0;options.callback(err,response,body)}};function readystatechange(){if(4===xhr.readyState){setTimeout(loadFunc,0)}}function getBody(){var body;if(xhr.response){body=xhr.response}else{body=xhr.responseText||getXml(xhr)}if(isJson){try{body=JSON.parse(body)}catch(e){}}return body}function errorFunc(evt){clearTimeout(timeoutTimer);if(!(evt instanceof Error)){evt=new Error(""+(evt||"Unknown XMLHttpRequest Error"))}evt.statusCode=0;return callback(evt,failureResponse)}function loadFunc(){if(aborted)return;var status;clearTimeout(timeoutTimer);if(options.useXDR&&xhr.status===void 0){status=200}else{status=1223===xhr.status?204:xhr.status}var response=failureResponse,err=null;if(0!==status){response={body:getBody(),statusCode:status,method:method,headers:{},url:uri,rawRequest:xhr};if(xhr.getAllResponseHeaders){response.headers=parseHeaders(xhr.getAllResponseHeaders())}}else{err=new Error("Internal XMLHttpRequest Error")}return callback(err,response,response.body)}var xhr=options.xhr||null;if(!xhr){if(options.cors||options.useXDR){xhr=new createXHR.XDomainRequest}else{xhr=new createXHR.XMLHttpRequest}}var key,aborted,uri=xhr.url=options.uri||options.url,method=xhr.method=options.method||"GET",body=options.body||options.data,headers=xhr.headers=options.headers||{},sync=!!options.sync,isJson=!1,timeoutTimer,failureResponse={body:void 0,headers:{},statusCode:0,method:method,url:uri,rawRequest:xhr};if("json"in options&&!1!==options.json){isJson=!0;headers.accept||headers.Accept||(headers.Accept="application/json");if("GET"!==method&&"HEAD"!==method){headers["content-type"]||headers["Content-Type"]||(headers["Content-Type"]="application/json");body=JSON.stringify(!0===options.json?body:options.json)}}xhr.onreadystatechange=readystatechange;xhr.onload=loadFunc;xhr.onerror=errorFunc;xhr.onprogress=function(){};xhr.onabort=function(){aborted=!0};xhr.ontimeout=errorFunc;xhr.open(method,uri,!sync,options.username,options.password);if(!sync){xhr.withCredentials=!!options.withCredentials}if(!sync&&0<options.timeout){timeoutTimer=setTimeout(function(){if(aborted)return;aborted=!0;xhr.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT";errorFunc(e)},options.timeout)}if(xhr.setRequestHeader){for(key in headers){if(headers.hasOwnProperty(key)){xhr.setRequestHeader(key,headers[key])}}}else if(options.headers&&!isEmpty(options.headers)){throw new Error("Headers cannot be set on an XDomainRequest object")}if("responseType"in options){xhr.responseType=options.responseType}if("beforeSend"in options&&"function"==typeof options.beforeSend){options.beforeSend(xhr)}xhr.send(body||null);return xhr}function getXml(xhr){try{if("document"===xhr.responseType){return xhr.responseXML}var firefoxBugTakenEffect=xhr.responseXML&&"parsererror"===xhr.responseXML.documentElement.nodeName;if(""===xhr.responseType&&!firefoxBugTakenEffect){return xhr.responseXML}}catch(e){}return null}xhr["default"]=createXHR;var parseCues=function(srcContent,track){var parser=new window$3.WebVTT.Parser(window$3,window$3.vttjs,window$3.WebVTT.StringDecoder()),errors=[];parser.oncue=function(cue){track.addCue(cue)};parser.onparsingerror=function(error){errors.push(error)};parser.onflush=function(){track.trigger({type:"loadeddata",target:track})};parser.parse(srcContent);if(0<errors.length){if(window$3.console&&window$3.console.groupCollapsed){window$3.console.groupCollapsed("Text Track parsing errors for "+track.src)}errors.forEach(function(error){return log.error(error)});if(window$3.console&&window$3.console.groupEnd){window$3.console.groupEnd()}}parser.flush()},loadTrack=function(src,track){var opts={uri:src},crossOrigin=isCrossOrigin(src);if(crossOrigin){opts.cors=crossOrigin}var withCredentials="use-credentials"===track.tech_.crossOrigin();if(withCredentials){opts.withCredentials=withCredentials}xhr(opts,bind(this,function(err,response,responseBody){if(err){return log.error(err,response)}track.loaded_=!0;if("function"!=typeof window$3.WebVTT){if(track.tech_){track.tech_.any(["vttjsloaded","vttjserror"],function(event){if("vttjserror"===event.type){log.error("vttjs failed to load, stopping trying to process "+track.src);return}return parseCues(responseBody,track)})}}else{parseCues(responseBody,track)}}))},TextTrack=function(_Track){inheritsLoose(TextTrack,_Track);function TextTrack(options){var _this;if(void 0===options){options={}}if(!options.tech){throw new Error("A tech was not provided.")}var settings=mergeOptions(options,{kind:TextTrackKind[options.kind]||"subtitles",language:options.language||options.srclang||""}),mode=TextTrackMode[settings.mode]||"disabled",default_=settings["default"];if("metadata"===settings.kind||"chapters"===settings.kind){mode="hidden"}_this=_Track.call(this,settings)||this;_this.tech_=settings.tech;_this.cues_=[];_this.activeCues_=[];_this.preload_=!1!==_this.tech_.preloadTextTracks;var cues=new TextTrackCueList(_this.cues_),activeCues=new TextTrackCueList(_this.activeCues_),changed=!1,timeupdateHandler=bind(assertThisInitialized(_this),function(){this.activeCues=this.activeCues;if(changed){this.trigger("cuechange");changed=!1}});if("disabled"!==mode){_this.tech_.ready(function(){_this.tech_.on("timeupdate",timeupdateHandler)},!0)}Object.defineProperties(assertThisInitialized(_this),{default:{get:function(){return default_},set:function(){}},mode:{get:function(){return mode},set:function(newMode){var _this2=this;if(!TextTrackMode[newMode]){return}mode=newMode;if(!this.preload_&&"disabled"!==mode&&0===this.cues.length){loadTrack(this.src,this)}if("disabled"!==mode){this.tech_.ready(function(){_this2.tech_.on("timeupdate",timeupdateHandler)},!0)}else{this.tech_.off("timeupdate",timeupdateHandler)}this.trigger("modechange")}},cues:{get:function(){if(!this.loaded_){return null}return cues},set:function(){}},activeCues:{get:function(){if(!this.loaded_){return null}if(0===this.cues.length){return activeCues}for(var ct=this.tech_.currentTime(),active=[],i=0,l=this.cues.length,cue;i<l;i++){cue=this.cues[i];if(cue.startTime<=ct&&cue.endTime>=ct){active.push(cue)}else if(cue.startTime===cue.endTime&&cue.startTime<=ct&&cue.startTime+.5>=ct){active.push(cue)}}changed=!1;if(active.length!==this.activeCues_.length){changed=!0}else{for(var _i=0;_i<active.length;_i++){if(-1===this.activeCues_.indexOf(active[_i])){changed=!0}}}this.activeCues_=active;activeCues.setCues_(this.activeCues_);return activeCues},set:function(){}}});if(settings.src){_this.src=settings.src;if(!_this.preload_){_this.loaded_=!0}if(_this.preload_||default_||"subtitles"!==settings.kind&&"captions"!==settings.kind){loadTrack(_this.src,assertThisInitialized(_this))}}else{_this.loaded_=!0}return _this}var _proto=TextTrack.prototype;_proto.addCue=function(originalCue){var cue=originalCue;if(window$3.vttjs&&!(originalCue instanceof window$3.vttjs.VTTCue)){cue=new window$3.vttjs.VTTCue(originalCue.startTime,originalCue.endTime,originalCue.text);for(var prop in originalCue){if(!(prop in cue)){cue[prop]=originalCue[prop]}}cue.id=originalCue.id;cue.originalCue_=originalCue}for(var tracks=this.tech_.textTracks(),i=0;i<tracks.length;i++){if(tracks[i]!==this){tracks[i].removeCue(cue)}}this.cues_.push(cue);this.cues.setCues_(this.cues_)};_proto.removeCue=function(_removeCue){var i=this.cues_.length;while(i--){var cue=this.cues_[i];if(cue===_removeCue||cue.originalCue_&&cue.originalCue_===_removeCue){this.cues_.splice(i,1);this.cues.setCues_(this.cues_);break}}};return TextTrack}(Track);TextTrack.prototype.allowedEvents_={cuechange:"cuechange"};var AudioTrack=function(_Track){inheritsLoose(AudioTrack,_Track);function AudioTrack(options){var _this;if(void 0===options){options={}}var settings=mergeOptions(options,{kind:AudioTrackKind[options.kind]||""});_this=_Track.call(this,settings)||this;var enabled=!1;Object.defineProperty(assertThisInitialized(_this),"enabled",{get:function(){return enabled},set:function(newEnabled){if("boolean"!=typeof newEnabled||newEnabled===enabled){return}enabled=newEnabled;this.trigger("enabledchange")}});if(settings.enabled){_this.enabled=settings.enabled}_this.loaded_=!0;return _this}return AudioTrack}(Track),VideoTrack=function(_Track){inheritsLoose(VideoTrack,_Track);function VideoTrack(options){var _this;if(void 0===options){options={}}var settings=mergeOptions(options,{kind:VideoTrackKind[options.kind]||""});_this=_Track.call(this,settings)||this;var selected=!1;Object.defineProperty(assertThisInitialized(_this),"selected",{get:function(){return selected},set:function(newSelected){if("boolean"!=typeof newSelected||newSelected===selected){return}selected=newSelected;this.trigger("selectedchange")}});if(settings.selected){_this.selected=settings.selected}return _this}return VideoTrack}(Track),NONE=0,LOADED=2,HTMLTrackElement=function(_EventTarget){inheritsLoose(HTMLTrackElement,_EventTarget);function HTMLTrackElement(options){var _this;if(void 0===options){options={}}_this=_EventTarget.call(this)||this;var readyState,track=new TextTrack(options);_this.kind=track.kind;_this.src=track.src;_this.srclang=track.language;_this.label=track.label;_this["default"]=track["default"];Object.defineProperties(assertThisInitialized(_this),{readyState:{get:function(){return readyState}},track:{get:function(){return track}}});readyState=NONE;track.addEventListener("loadeddata",function(){readyState=LOADED;_this.trigger({type:"load",target:assertThisInitialized(_this)})});return _this}return HTMLTrackElement}(EventTarget);HTMLTrackElement.prototype.allowedEvents_={load:"load"};HTMLTrackElement.NONE=NONE;HTMLTrackElement.LOADING=1;HTMLTrackElement.LOADED=LOADED;HTMLTrackElement.ERROR=3;var NORMAL={audio:{ListClass:AudioTrackList,TrackClass:AudioTrack,capitalName:"Audio"},video:{ListClass:VideoTrackList,TrackClass:VideoTrack,capitalName:"Video"},text:{ListClass:TextTrackList,TrackClass:TextTrack,capitalName:"Text"}};Object.keys(NORMAL).forEach(function(type){NORMAL[type].getterName=type+"Tracks";NORMAL[type].privateName=type+"Tracks_"});var REMOTE={remoteText:{ListClass:TextTrackList,TrackClass:TextTrack,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:HtmlTrackElementList,TrackClass:HTMLTrackElement,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},ALL=_extends_1({},NORMAL,REMOTE);REMOTE.names=Object.keys(REMOTE);NORMAL.names=Object.keys(NORMAL);ALL.names=[].concat(REMOTE.names).concat(NORMAL.names);var _objCreate=Object.create||function(){function F(){}return function(o){if(1!==arguments.length){throw new Error("Object.create shim only accepts one parameter.")}F.prototype=o;return new F}}();function ParsingError(errorData,message){this.name="ParsingError";this.code=errorData.code;this.message=message||errorData.message}ParsingError.prototype=_objCreate(Error.prototype);ParsingError.prototype.constructor=ParsingError;ParsingError.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}};function parseTimeStamp(input){function computeSeconds(h,m,s,f){return 3600*(0|h)+60*(0|m)+(0|s)+(0|f)/1e3}var m=input.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);if(!m){return null}if(m[3]){return computeSeconds(m[1],m[2],m[3].replace(":",""),m[4])}else if(59<m[1]){return computeSeconds(m[1],m[2],0,m[4])}else{return computeSeconds(0,m[1],m[2],m[4])}}function Settings(){this.values=_objCreate(null)}Settings.prototype={set:function(k,v){if(!this.get(k)&&""!==v){this.values[k]=v}},get:function(k,dflt,defaultKey){if(defaultKey){return this.has(k)?this.values[k]:dflt[defaultKey]}return this.has(k)?this.values[k]:dflt},has:function(k){return k in this.values},alt:function(k,v,a){for(var n=0;n<a.length;++n){if(v===a[n]){this.set(k,v);break}}},integer:function(k,v){if(/^-?\d+$/.test(v)){this.set(k,parseInt(v,10))}},percent:function(k,v){var m;if(m=v.match(/^([\d]{1,3})(\.[\d]*)?%$/)){v=parseFloat(v);if(0<=v&&100>=v){this.set(k,v);return!0}}return!1}};function parseOptions(input,callback,keyValueDelim,groupDelim){var groups=groupDelim?input.split(groupDelim):[input];for(var i in groups){if("string"!=typeof groups[i]){continue}var kv=groups[i].split(keyValueDelim);if(2!==kv.length){continue}var k=kv[0],v=kv[1];callback(k,v)}}function parseCue(input,cue,regionList){var oInput=input;function consumeTimeStamp(){var ts=parseTimeStamp(input);if(null===ts){throw new ParsingError(ParsingError.Errors.BadTimeStamp,"Malformed timestamp: "+oInput)}input=input.replace(/^[^\sa-zA-Z-]+/,"");return ts}function consumeCueSettings(input,cue){var settings=new Settings;parseOptions(input,function(k,v){switch(k){case"region":for(var i=regionList.length-1;0<=i;i--){if(regionList[i].id===v){settings.set(k,regionList[i].region);break}}break;case"vertical":settings.alt(k,v,["rl","lr"]);break;case"line":var vals=v.split(","),vals0=vals[0];settings.integer(k,vals0);settings.percent(k,vals0)?settings.set("snapToLines",!1):null;settings.alt(k,vals0,["auto"]);if(2===vals.length){settings.alt("lineAlign",vals[1],["start","center","end"])}break;case"position":vals=v.split(",");settings.percent(k,vals[0]);if(2===vals.length){settings.alt("positionAlign",vals[1],["start","center","end"])}break;case"size":settings.percent(k,v);break;case"align":settings.alt(k,v,["start","center","end","left","right"]);break;}},/:/,/\s/);cue.region=settings.get("region",null);cue.vertical=settings.get("vertical","");try{cue.line=settings.get("line","auto")}catch(e){}cue.lineAlign=settings.get("lineAlign","start");cue.snapToLines=settings.get("snapToLines",!0);cue.size=settings.get("size",100);try{cue.align=settings.get("align","center")}catch(e){cue.align=settings.get("align","middle")}try{cue.position=settings.get("position","auto")}catch(e){cue.position=settings.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},cue.align)}cue.positionAlign=settings.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},cue.align)}function skipWhitespace(){input=input.replace(/^\s+/,"")}skipWhitespace();cue.startTime=consumeTimeStamp();skipWhitespace();if("-->"!==input.substr(0,3)){throw new ParsingError(ParsingError.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '-->'): "+oInput)}input=input.substr(3);skipWhitespace();cue.endTime=consumeTimeStamp();skipWhitespace();consumeCueSettings(input,cue)}var TEXTAREA_ELEMENT=document.createElement("textarea"),TAG_NAME={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},DEFAULT_COLOR_CLASS={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},TAG_ANNOTATION={v:"title",lang:"lang"},NEEDS_PARENT={rt:"ruby"};function parseContent(window,input){function nextToken(){if(!input){return null}function consume(result){input=input.substr(result.length);return result}var m=input.match(/^([^<]*)(<[^>]*>?)?/);return consume(m[1]?m[1]:m[2])}function unescape(s){TEXTAREA_ELEMENT.innerHTML=s;s=TEXTAREA_ELEMENT.textContent;TEXTAREA_ELEMENT.textContent="";return s}function shouldAdd(current,element){return!NEEDS_PARENT[element.localName]||NEEDS_PARENT[element.localName]===current.localName}function createElement(type,annotation){var tagName=TAG_NAME[type];if(!tagName){return null}var element=window.document.createElement(tagName),name=TAG_ANNOTATION[type];if(name&&annotation){element[name]=annotation.trim()}return element}var rootDiv=window.document.createElement("div"),current=rootDiv,t,tagStack=[];while(null!==(t=nextToken())){if("<"===t[0]){if("/"===t[1]){if(tagStack.length&&tagStack[tagStack.length-1]===t.substr(2).replace(">","")){tagStack.pop();current=current.parentNode}continue}var ts=parseTimeStamp(t.substr(1,t.length-2)),node;if(ts){node=window.document.createProcessingInstruction("timestamp",ts);current.appendChild(node);continue}var m=t.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!m){continue}node=createElement(m[1],m[3]);if(!node){continue}if(!shouldAdd(current,node)){continue}if(m[2]){var classes=m[2].split(".");classes.forEach(function(cl){var bgColor=/^bg_/.test(cl),colorName=bgColor?cl.slice(3):cl;if(DEFAULT_COLOR_CLASS.hasOwnProperty(colorName)){var propName=bgColor?"background-color":"color",propValue=DEFAULT_COLOR_CLASS[colorName];node.style[propName]=propValue}});node.className=classes.join(" ")}tagStack.push(m[1]);current.appendChild(node);current=node;continue}current.appendChild(window.document.createTextNode(unescape(t)))}return rootDiv}var strongRTLRanges=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function isStrongRTLChar(charCode){for(var i=0,currentRange;i<strongRTLRanges.length;i++){currentRange=strongRTLRanges[i];if(charCode>=currentRange[0]&&charCode<=currentRange[1]){return!0}}return!1}function determineBidi(cueDiv){var nodeStack=[],text="",charCode;if(!cueDiv||!cueDiv.childNodes){return"ltr"}function pushNodes(nodeStack,node){for(var i=node.childNodes.length-1;0<=i;i--){nodeStack.push(node.childNodes[i])}}function nextTextNode(nodeStack){if(!nodeStack||!nodeStack.length){return null}var node=nodeStack.pop(),text=node.textContent||node.innerText;if(text){var m=text.match(/^.*(\n|\r)/);if(m){nodeStack.length=0;return m[0]}return text}if("ruby"===node.tagName){return nextTextNode(nodeStack)}if(node.childNodes){pushNodes(nodeStack,node);return nextTextNode(nodeStack)}}pushNodes(nodeStack,cueDiv);while(text=nextTextNode(nodeStack)){for(var i=0;i<text.length;i++){charCode=text.charCodeAt(i);if(isStrongRTLChar(charCode)){return"rtl"}}}return"ltr"}function computeLinePos(cue){if("number"==typeof cue.line&&(cue.snapToLines||0<=cue.line&&100>=cue.line)){return cue.line}if(!cue.track||!cue.track.textTrackList||!cue.track.textTrackList.mediaElement){return-1}for(var track=cue.track,trackList=track.textTrackList,count=0,i=0;i<trackList.length&&trackList[i]!==track;i++){if("showing"===trackList[i].mode){count++}}return-1*++count}function StyleBox(){}StyleBox.prototype.applyStyles=function(styles,div){div=div||this.div;for(var prop in styles){if(styles.hasOwnProperty(prop)){div.style[prop]=styles[prop]}}};StyleBox.prototype.formatStyle=function(val,unit){return 0===val?0:val+unit};function CueStyleBox(window,cue,styleOptions){StyleBox.call(this);this.cue=cue;this.cueDiv=parseContent(window,cue.text);var styles={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:""===cue.vertical?"horizontal-tb":"lr"===cue.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(styles,this.cueDiv);this.div=window.document.createElement("div");styles={direction:determineBidi(this.cueDiv),writingMode:""===cue.vertical?"horizontal-tb":"lr"===cue.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:"middle"===cue.align?"center":cue.align,font:styleOptions.font,whiteSpace:"pre-line",position:"absolute"};this.applyStyles(styles);this.div.appendChild(this.cueDiv);var textPos=0;switch(cue.positionAlign){case"start":textPos=cue.position;break;case"center":textPos=cue.position-cue.size/2;break;case"end":textPos=cue.position-cue.size;break;}if(""===cue.vertical){this.applyStyles({left:this.formatStyle(textPos,"%"),width:this.formatStyle(cue.size,"%")})}else{this.applyStyles({top:this.formatStyle(textPos,"%"),height:this.formatStyle(cue.size,"%")})}this.move=function(box){this.applyStyles({top:this.formatStyle(box.top,"px"),bottom:this.formatStyle(box.bottom,"px"),left:this.formatStyle(box.left,"px"),right:this.formatStyle(box.right,"px"),height:this.formatStyle(box.height,"px"),width:this.formatStyle(box.width,"px")})}}CueStyleBox.prototype=_objCreate(StyleBox.prototype);CueStyleBox.prototype.constructor=CueStyleBox;function BoxPosition(obj){var lh,height,width,top;if(obj.div){height=obj.div.offsetHeight;width=obj.div.offsetWidth;top=obj.div.offsetTop;var rects=(rects=obj.div.childNodes)&&(rects=rects[0])&&rects.getClientRects&&rects.getClientRects();obj=obj.div.getBoundingClientRect();lh=rects?Math.max(rects[0]&&rects[0].height||0,obj.height/rects.length):0}this.left=obj.left;this.right=obj.right;this.top=obj.top||top;this.height=obj.height||height;this.bottom=obj.bottom||top+(obj.height||height);this.width=obj.width||width;this.lineHeight=lh!==void 0?lh:obj.lineHeight}BoxPosition.prototype.move=function(axis,toMove){toMove=toMove!==void 0?toMove:this.lineHeight;switch(axis){case"+x":this.left+=toMove;this.right+=toMove;break;case"-x":this.left-=toMove;this.right-=toMove;break;case"+y":this.top+=toMove;this.bottom+=toMove;break;case"-y":this.top-=toMove;this.bottom-=toMove;break;}};BoxPosition.prototype.overlaps=function(b2){return this.left<b2.right&&this.right>b2.left&&this.top<b2.bottom&&this.bottom>b2.top};BoxPosition.prototype.overlapsAny=function(boxes){for(var i=0;i<boxes.length;i++){if(this.overlaps(boxes[i])){return!0}}return!1};BoxPosition.prototype.within=function(container){return this.top>=container.top&&this.bottom<=container.bottom&&this.left>=container.left&&this.right<=container.right};BoxPosition.prototype.overlapsOppositeAxis=function(container,axis){switch(axis){case"+x":return this.left<container.left;case"-x":return this.right>container.right;case"+y":return this.top<container.top;case"-y":return this.bottom>container.bottom;}};BoxPosition.prototype.intersectPercentage=function(b2){var x=Math.max(0,Math.min(this.right,b2.right)-Math.max(this.left,b2.left)),y=Math.max(0,Math.min(this.bottom,b2.bottom)-Math.max(this.top,b2.top));return x*y/(this.height*this.width)};BoxPosition.prototype.toCSSCompatValues=function(reference){return{top:this.top-reference.top,bottom:reference.bottom-this.bottom,left:this.left-reference.left,right:reference.right-this.right,height:this.height,width:this.width}};BoxPosition.getSimpleBoxPosition=function(obj){var height=obj.div?obj.div.offsetHeight:obj.tagName?obj.offsetHeight:0,width=obj.div?obj.div.offsetWidth:obj.tagName?obj.offsetWidth:0,top=obj.div?obj.div.offsetTop:obj.tagName?obj.offsetTop:0;obj=obj.div?obj.div.getBoundingClientRect():obj.tagName?obj.getBoundingClientRect():obj;var ret={left:obj.left,right:obj.right,top:obj.top||top,height:obj.height||height,bottom:obj.bottom||top+(obj.height||height),width:obj.width||width};return ret};function moveBoxToLinePosition(window,styleBox,containerBox,boxPositions){function findBestPosition(b,axis){for(var bestPosition,specifiedPosition=new BoxPosition(b),percentage=1,i=0;i<axis.length;i++){while(b.overlapsOppositeAxis(containerBox,axis[i])||b.within(containerBox)&&b.overlapsAny(boxPositions)){b.move(axis[i])}if(b.within(containerBox)){return b}var p=b.intersectPercentage(containerBox);if(percentage>p){bestPosition=new BoxPosition(b);percentage=p}b=new BoxPosition(specifiedPosition)}return bestPosition||specifiedPosition}var boxPosition=new BoxPosition(styleBox),cue=styleBox.cue,linePos=computeLinePos(cue),axis=[];if(cue.snapToLines){var size;switch(cue.vertical){case"":axis=["+y","-y"];size="height";break;case"rl":axis=["+x","-x"];size="width";break;case"lr":axis=["-x","+x"];size="width";break;}var step=boxPosition.lineHeight,position=step*Math.round(linePos),maxPosition=containerBox[size]+step,initialAxis=axis[0];if(Math.abs(position)>maxPosition){position=0>position?-1:1;position*=Math.ceil(maxPosition/step)*step}if(0>linePos){position+=""===cue.vertical?containerBox.height:containerBox.width;axis=axis.reverse()}boxPosition.move(initialAxis,position)}else{var calculatedPercentage=100*(boxPosition.lineHeight/containerBox.height);switch(cue.lineAlign){case"center":linePos-=calculatedPercentage/2;break;case"end":linePos-=calculatedPercentage;break;}switch(cue.vertical){case"":styleBox.applyStyles({top:styleBox.formatStyle(linePos,"%")});break;case"rl":styleBox.applyStyles({left:styleBox.formatStyle(linePos,"%")});break;case"lr":styleBox.applyStyles({right:styleBox.formatStyle(linePos,"%")});break;}axis=["+y","-x","+x","-y"];boxPosition=new BoxPosition(styleBox)}var bestPosition=findBestPosition(boxPosition,axis);styleBox.move(bestPosition.toCSSCompatValues(containerBox))}function WebVTT$1(){}WebVTT$1.StringDecoder=function(){return{decode:function(data){if(!data){return""}if("string"!=typeof data){throw new Error("Error - expected string data.")}return decodeURIComponent(encodeURIComponent(data))}}};WebVTT$1.convertCueToDOMTree=function(window,cuetext){if(!window||!cuetext){return null}return parseContent(window,cuetext)};WebVTT$1.processCues=function(window,cues,overlay){if(!window||!cues||!overlay){return null}while(overlay.firstChild){overlay.removeChild(overlay.firstChild)}var paddedOverlay=window.document.createElement("div");paddedOverlay.style.position="absolute";paddedOverlay.style.left="0";paddedOverlay.style.right="0";paddedOverlay.style.top="0";paddedOverlay.style.bottom="0";paddedOverlay.style.margin="1.5%";overlay.appendChild(paddedOverlay);function shouldCompute(cues){for(var i=0;i<cues.length;i++){if(cues[i].hasBeenReset||!cues[i].displayState){return!0}}return!1}if(!shouldCompute(cues)){for(var i=0;i<cues.length;i++){paddedOverlay.appendChild(cues[i].displayState)}return}var boxPositions=[],containerBox=BoxPosition.getSimpleBoxPosition(paddedOverlay),fontSize=Math.round(100*(containerBox.height*.05))/100,styleOptions={font:fontSize+"px "+"sans-serif"};(function(){for(var styleBox,cue,i=0;i<cues.length;i++){cue=cues[i];styleBox=new CueStyleBox(window,cue,styleOptions);paddedOverlay.appendChild(styleBox.div);moveBoxToLinePosition(window,styleBox,containerBox,boxPositions);cue.displayState=styleBox.div;boxPositions.push(BoxPosition.getSimpleBoxPosition(styleBox))}})()};WebVTT$1.Parser=function(window,vttjs,decoder){if(!decoder){decoder=vttjs;vttjs={}}if(!vttjs){vttjs={}}this.window=window;this.vttjs=vttjs;this.state="INITIAL";this.buffer="";this.decoder=decoder||new TextDecoder("utf8");this.regionList=[]};WebVTT$1.Parser.prototype={reportOrThrowError:function(e){if(e instanceof ParsingError){this.onparsingerror&&this.onparsingerror(e)}else{throw e}},parse:function(data){var self=this;if(data){self.buffer+=self.decoder.decode(data,{stream:!0})}function collectNextLine(){var buffer=self.buffer,pos=0;while(pos<buffer.length&&"\r"!==buffer[pos]&&"\n"!==buffer[pos]){++pos}var line=buffer.substr(0,pos);if("\r"===buffer[pos]){++pos}if("\n"===buffer[pos]){++pos}self.buffer=buffer.substr(pos);return line}function parseRegion(input){var settings=new Settings;parseOptions(input,function(k,v){switch(k){case"id":settings.set(k,v);break;case"width":settings.percent(k,v);break;case"lines":settings.integer(k,v);break;case"regionanchor":case"viewportanchor":var xy=v.split(",");if(2!==xy.length){break}var anchor=new Settings;anchor.percent("x",xy[0]);anchor.percent("y",xy[1]);if(!anchor.has("x")||!anchor.has("y")){break}settings.set(k+"X",anchor.get("x"));settings.set(k+"Y",anchor.get("y"));break;case"scroll":settings.alt(k,v,["up"]);break;}},/=/,/\s/);if(settings.has("id")){var region=new(self.vttjs.VTTRegion||self.window.VTTRegion);region.width=settings.get("width",100);region.lines=settings.get("lines",3);region.regionAnchorX=settings.get("regionanchorX",0);region.regionAnchorY=settings.get("regionanchorY",100);region.viewportAnchorX=settings.get("viewportanchorX",0);region.viewportAnchorY=settings.get("viewportanchorY",100);region.scroll=settings.get("scroll","");self.onregion&&self.onregion(region);self.regionList.push({id:settings.get("id"),region:region})}}function parseTimestampMap(input){var settings=new Settings;parseOptions(input,function(k,v){switch(k){case"MPEGT":settings.integer(k+"S",v);break;case"LOCA":settings.set(k+"L",parseTimeStamp(v));break;}},/[^\d]:/,/,/);self.ontimestampmap&&self.ontimestampmap({MPEGTS:settings.get("MPEGTS"),LOCAL:settings.get("LOCAL")})}function parseHeader(input){if(input.match(/X-TIMESTAMP-MAP/)){parseOptions(input,function(k,v){switch(k){case"X-TIMESTAMP-MAP":parseTimestampMap(v);break;}},/=/)}else{parseOptions(input,function(k,v){switch(k){case"Region":parseRegion(v);break;}},/:/)}}try{var line;if("INITIAL"===self.state){if(!/\r\n|\n/.test(self.buffer)){return this}line=collectNextLine();var m=line.match(/^WEBVTT([ \t].*)?$/);if(!m||!m[0]){throw new ParsingError(ParsingError.Errors.BadSignature)}self.state="HEADER"}var alreadyCollectedLine=!1;while(self.buffer){if(!/\r\n|\n/.test(self.buffer)){return this}if(!alreadyCollectedLine){line=collectNextLine()}else{alreadyCollectedLine=!1}switch(self.state){case"HEADER":if(/:/.test(line)){parseHeader(line)}else if(!line){self.state="ID"}continue;case"NOTE":if(!line){self.state="ID"}continue;case"ID":if(/^NOTE($|[ \t])/.test(line)){self.state="NOTE";break}if(!line){continue}self.cue=new(self.vttjs.VTTCue||self.window.VTTCue)(0,0,"");try{self.cue.align="center"}catch(e){self.cue.align="middle"}self.state="CUE";if(-1===line.indexOf("-->")){self.cue.id=line;continue}case"CUE":try{parseCue(line,self.cue,self.regionList)}catch(e){self.reportOrThrowError(e);self.cue=null;self.state="BADCUE";continue}self.state="CUETEXT";continue;case"CUETEXT":var hasSubstring=-1!==line.indexOf("-->");if(!line||hasSubstring&&(alreadyCollectedLine=!0)){self.oncue&&self.oncue(self.cue);self.cue=null;self.state="ID";continue}if(self.cue.text){self.cue.text+="\n"}self.cue.text+=line.replace(/\u2028/g,"\n").replace(/u2029/g,"\n");continue;case"BADCUE":if(!line){self.state="ID"}continue;}}}catch(e){self.reportOrThrowError(e);if("CUETEXT"===self.state&&self.cue&&self.oncue){self.oncue(self.cue)}self.cue=null;self.state="INITIAL"===self.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var self=this;try{self.buffer+=self.decoder.decode();if(self.cue||"HEADER"===self.state){self.buffer+="\n\n";self.parse()}if("INITIAL"===self.state){throw new ParsingError(ParsingError.Errors.BadSignature)}}catch(e){self.reportOrThrowError(e)}self.onflush&&self.onflush();return this}};var directionSetting={"":1,lr:1,rl:1},alignSetting={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function findDirectionSetting(value){if("string"!=typeof value){return!1}var dir=directionSetting[value.toLowerCase()];return dir?value.toLowerCase():!1}function findAlignSetting(value){if("string"!=typeof value){return!1}var align=alignSetting[value.toLowerCase()];return align?value.toLowerCase():!1}function VTTCue(startTime,endTime,text){this.hasBeenReset=!1;var _id="",_pauseOnExit=!1,_startTime=startTime,_endTime=endTime,_text=text,_region=null,_vertical="",_snapToLines=!0,_line="auto",_lineAlign="start",_position="auto",_positionAlign="auto",_size=100,_align="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return _id},set:function(value){_id=""+value}},pauseOnExit:{enumerable:!0,get:function(){return _pauseOnExit},set:function(value){_pauseOnExit=!!value}},startTime:{enumerable:!0,get:function(){return _startTime},set:function(value){if("number"!=typeof value){throw new TypeError("Start time must be set to a number.")}_startTime=value;this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return _endTime},set:function(value){if("number"!=typeof value){throw new TypeError("End time must be set to a number.")}_endTime=value;this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return _text},set:function(value){_text=""+value;this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return _region},set:function(value){_region=value;this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return _vertical},set:function(value){var setting=findDirectionSetting(value);if(!1===setting){throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.")}_vertical=setting;this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return _snapToLines},set:function(value){_snapToLines=!!value;this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return _line},set:function(value){if("number"!=typeof value&&value!=="auto"){throw new SyntaxError("Line: an invalid number or illegal string was specified.")}_line=value;this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return _lineAlign},set:function(value){var setting=findAlignSetting(value);if(!setting){console.warn("lineAlign: an invalid or illegal string was specified.")}else{_lineAlign=setting;this.hasBeenReset=!0}}},position:{enumerable:!0,get:function(){return _position},set:function(value){if(0>value||100<value){throw new Error("Position must be between 0 and 100.")}_position=value;this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return _positionAlign},set:function(value){var setting=findAlignSetting(value);if(!setting){console.warn("positionAlign: an invalid or illegal string was specified.")}else{_positionAlign=setting;this.hasBeenReset=!0}}},size:{enumerable:!0,get:function(){return _size},set:function(value){if(0>value||100<value){throw new Error("Size must be between 0 and 100.")}_size=value;this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return _align},set:function(value){var setting=findAlignSetting(value);if(!setting){throw new SyntaxError("align: an invalid or illegal alignment string was specified.")}_align=setting;this.hasBeenReset=!0}}});this.displayState=void 0}VTTCue.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)};var scrollSetting={"":!0,up:!0};function findScrollSetting(value){if("string"!=typeof value){return!1}var scroll=scrollSetting[value.toLowerCase()];return scroll?value.toLowerCase():!1}function isValidPercentValue(value){return"number"==typeof value&&0<=value&&100>=value}var vttregion=function(){var _width=100,_lines=3,_regionAnchorX=0,_regionAnchorY=100,_viewportAnchorX=0,_viewportAnchorY=100,_scroll="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return _width},set:function(value){if(!isValidPercentValue(value)){throw new Error("Width must be between 0 and 100.")}_width=value}},lines:{enumerable:!0,get:function(){return _lines},set:function(value){if("number"!=typeof value){throw new TypeError("Lines must be set to a number.")}_lines=value}},regionAnchorY:{enumerable:!0,get:function(){return _regionAnchorY},set:function(value){if(!isValidPercentValue(value)){throw new Error("RegionAnchorX must be between 0 and 100.")}_regionAnchorY=value}},regionAnchorX:{enumerable:!0,get:function(){return _regionAnchorX},set:function(value){if(!isValidPercentValue(value)){throw new Error("RegionAnchorY must be between 0 and 100.")}_regionAnchorX=value}},viewportAnchorY:{enumerable:!0,get:function(){return _viewportAnchorY},set:function(value){if(!isValidPercentValue(value)){throw new Error("ViewportAnchorY must be between 0 and 100.")}_viewportAnchorY=value}},viewportAnchorX:{enumerable:!0,get:function(){return _viewportAnchorX},set:function(value){if(!isValidPercentValue(value)){throw new Error("ViewportAnchorX must be between 0 and 100.")}_viewportAnchorX=value}},scroll:{enumerable:!0,get:function(){return _scroll},set:function(value){var setting=findScrollSetting(value);if(!1===setting){console.warn("Scroll: an invalid or illegal string was specified.")}else{_scroll=setting}}}})},browserIndex=createCommonjsModule(function(module){var vttjs=module.exports={WebVTT:WebVTT$1,VTTCue:VTTCue,VTTRegion:vttregion};window$3.vttjs=vttjs;window$3.WebVTT=vttjs.WebVTT;var cueShim=vttjs.VTTCue,regionShim=vttjs.VTTRegion,nativeVTTCue=window$3.VTTCue,nativeVTTRegion=window$3.VTTRegion;vttjs.shim=function(){window$3.VTTCue=cueShim;window$3.VTTRegion=regionShim};vttjs.restore=function(){window$3.VTTCue=nativeVTTCue;window$3.VTTRegion=nativeVTTRegion};if(!window$3.VTTCue){vttjs.shim()}}),browserIndex_1=browserIndex.WebVTT,browserIndex_2=browserIndex.VTTCue,browserIndex_3=browserIndex.VTTRegion;function createTrackHelper(self,kind,label,language,options){if(void 0===options){options={}}var tracks=self.textTracks();options.kind=kind;if(label){options.label=label}if(language){options.language=language}options.tech=self;var track=new ALL.text.TrackClass(options);tracks.addTrack(track);return track}var Tech=function(_Component){inheritsLoose(Tech,_Component);function Tech(options,ready){var _this;if(void 0===options){options={}}if(void 0===ready){ready=function(){}}options.reportTouchActivity=!1;_this=_Component.call(this,null,options,ready)||this;_this.hasStarted_=!1;_this.on("playing",function(){this.hasStarted_=!0});_this.on("loadstart",function(){this.hasStarted_=!1});ALL.names.forEach(function(name){var props=ALL[name];if(options&&options[props.getterName]){_this[props.privateName]=options[props.getterName]}});if(!_this.featuresProgressEvents){_this.manualProgressOn()}if(!_this.featuresTimeupdateEvents){_this.manualTimeUpdatesOn()}["Text","Audio","Video"].forEach(function(track){if(!1===options["native"+track+"Tracks"]){_this["featuresNative"+track+"Tracks"]=!1}});if(!1===options.nativeCaptions||!1===options.nativeTextTracks){_this.featuresNativeTextTracks=!1}else if(!0===options.nativeCaptions||!0===options.nativeTextTracks){_this.featuresNativeTextTracks=!0}if(!_this.featuresNativeTextTracks){_this.emulateTextTracks()}_this.preloadTextTracks=!1!==options.preloadTextTracks;_this.autoRemoteTextTracks_=new ALL.text.ListClass;_this.initTrackListeners();if(!options.nativeControlsForTouch){_this.emitTapEvents()}if(_this.constructor){_this.name_=_this.constructor.name||"Unknown Tech"}return _this}var _proto=Tech.prototype;_proto.triggerSourceset=function(src){var _this2=this;if(!this.isReady_){this.one("ready",function(){return _this2.setTimeout(function(){return _this2.triggerSourceset(src)},1)})}this.trigger({src:src,type:"sourceset"})};_proto.manualProgressOn=function(){this.on("durationchange",this.onDurationChange);this.manualProgress=!0;this.one("ready",this.trackProgress)};_proto.manualProgressOff=function(){this.manualProgress=!1;this.stopTrackingProgress();this.off("durationchange",this.onDurationChange)};_proto.trackProgress=function(){this.stopTrackingProgress();this.progressInterval=this.setInterval(bind(this,function(){var numBufferedPercent=this.bufferedPercent();if(this.bufferedPercent_!==numBufferedPercent){this.trigger("progress")}this.bufferedPercent_=numBufferedPercent;if(1===numBufferedPercent){this.stopTrackingProgress()}}),500)};_proto.onDurationChange=function(){this.duration_=this.duration()};_proto.buffered=function(){return createTimeRanges(0,0)};_proto.bufferedPercent=function(){return bufferedPercent(this.buffered(),this.duration_)};_proto.stopTrackingProgress=function(){this.clearInterval(this.progressInterval)};_proto.manualTimeUpdatesOn=function(){this.manualTimeUpdates=!0;this.on("play",this.trackCurrentTime);this.on("pause",this.stopTrackingCurrentTime)};_proto.manualTimeUpdatesOff=function(){this.manualTimeUpdates=!1;this.stopTrackingCurrentTime();this.off("play",this.trackCurrentTime);this.off("pause",this.stopTrackingCurrentTime)};_proto.trackCurrentTime=function(){if(this.currentTimeInterval){this.stopTrackingCurrentTime()}this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)};_proto.stopTrackingCurrentTime=function(){this.clearInterval(this.currentTimeInterval);this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})};_proto.dispose=function(){this.clearTracks(NORMAL.names);if(this.manualProgress){this.manualProgressOff()}if(this.manualTimeUpdates){this.manualTimeUpdatesOff()}_Component.prototype.dispose.call(this)};_proto.clearTracks=function(types){var _this3=this;types=[].concat(types);types.forEach(function(type){var list=_this3[type+"Tracks"]()||[],i=list.length;while(i--){var track=list[i];if("text"===type){_this3.removeRemoteTextTrack(track)}list.removeTrack(track)}})};_proto.cleanupAutoTextTracks=function(){var list=this.autoRemoteTextTracks_||[],i=list.length;while(i--){var track=list[i];this.removeRemoteTextTrack(track)}};_proto.reset=function(){};_proto.crossOrigin=function(){};_proto.setCrossOrigin=function(){};_proto.error=function(err){if(err!==void 0){this.error_=new MediaError(err);this.trigger("error")}return this.error_};_proto.played=function(){if(this.hasStarted_){return createTimeRanges(0,0)}return createTimeRanges()};_proto.setScrubbing=function(){};_proto.setCurrentTime=function(){if(this.manualTimeUpdates){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}};_proto.initTrackListeners=function(){var _this4=this;NORMAL.names.forEach(function(name){var props=NORMAL[name],trackListChanges=function(){_this4.trigger(name+"trackchange")},tracks=_this4[props.getterName]();tracks.addEventListener("removetrack",trackListChanges);tracks.addEventListener("addtrack",trackListChanges);_this4.on("dispose",function(){tracks.removeEventListener("removetrack",trackListChanges);tracks.removeEventListener("addtrack",trackListChanges)})})};_proto.addWebVttScript_=function(){var _this5=this;if(window$3.WebVTT){return}if(document.body.contains(this.el())){if(!this.options_["vtt.js"]&&isPlain(browserIndex)&&0<Object.keys(browserIndex).length){this.trigger("vttjsloaded");return}var script=document.createElement("script");script.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js";script.onload=function(){_this5.trigger("vttjsloaded")};script.onerror=function(){_this5.trigger("vttjserror")};this.on("dispose",function(){script.onload=null;script.onerror=null});window$3.WebVTT=!0;this.el().parentNode.appendChild(script)}else{this.ready(this.addWebVttScript_)}};_proto.emulateTextTracks=function(){var _this6=this,tracks=this.textTracks(),remoteTracks=this.remoteTextTracks(),handleAddTrack=function(e){return tracks.addTrack(e.track)},handleRemoveTrack=function(e){return tracks.removeTrack(e.track)};remoteTracks.on("addtrack",handleAddTrack);remoteTracks.on("removetrack",handleRemoveTrack);this.addWebVttScript_();var updateDisplay=function(){return _this6.trigger("texttrackchange")},textTracksChanges=function(){updateDisplay();for(var i=0,track;i<tracks.length;i++){track=tracks[i];track.removeEventListener("cuechange",updateDisplay);if("showing"===track.mode){track.addEventListener("cuechange",updateDisplay)}}};textTracksChanges();tracks.addEventListener("change",textTracksChanges);tracks.addEventListener("addtrack",textTracksChanges);tracks.addEventListener("removetrack",textTracksChanges);this.on("dispose",function(){remoteTracks.off("addtrack",handleAddTrack);remoteTracks.off("removetrack",handleRemoveTrack);tracks.removeEventListener("change",textTracksChanges);tracks.removeEventListener("addtrack",textTracksChanges);tracks.removeEventListener("removetrack",textTracksChanges);for(var i=0,track;i<tracks.length;i++){track=tracks[i];track.removeEventListener("cuechange",updateDisplay)}})};_proto.addTextTrack=function(kind,label,language){if(!kind){throw new Error("TextTrack kind is required but was not provided")}return createTrackHelper(this,kind,label,language)};_proto.createRemoteTextTrack=function(options){var track=mergeOptions(options,{tech:this});return new REMOTE.remoteTextEl.TrackClass(track)};_proto.addRemoteTextTrack=function(options,manualCleanup){var _this7=this;if(void 0===options){options={}}var htmlTrackElement=this.createRemoteTextTrack(options);if(!0!==manualCleanup&&!1!==manualCleanup){log.warn("Calling addRemoteTextTrack without explicitly setting the \"manualCleanup\" parameter to `true` is deprecated and default to `false` in future version of video.js");manualCleanup=!0}this.remoteTextTrackEls().addTrackElement_(htmlTrackElement);this.remoteTextTracks().addTrack(htmlTrackElement.track);if(!0!==manualCleanup){this.ready(function(){return _this7.autoRemoteTextTracks_.addTrack(htmlTrackElement.track)})}return htmlTrackElement};_proto.removeRemoteTextTrack=function(track){var trackElement=this.remoteTextTrackEls().getTrackElementByTrack_(track);this.remoteTextTrackEls().removeTrackElement_(trackElement);this.remoteTextTracks().removeTrack(track);this.autoRemoteTextTracks_.removeTrack(track)};_proto.getVideoPlaybackQuality=function(){return{}};_proto.requestPictureInPicture=function(){var PromiseClass=this.options_.Promise||window$3.Promise;if(PromiseClass){return PromiseClass.reject()}};_proto.disablePictureInPicture=function(){return!0};_proto.setDisablePictureInPicture=function(){};_proto.setPoster=function(){};_proto.playsinline=function(){};_proto.setPlaysinline=function(){};_proto.overrideNativeAudioTracks=function(){};_proto.overrideNativeVideoTracks=function(){};_proto.canPlayType=function(){return""};Tech.canPlayType=function(){return""};Tech.canPlaySource=function(srcObj){return Tech.canPlayType(srcObj.type)};Tech.isTech=function(component){return component.prototype instanceof Tech||component instanceof Tech||component===Tech};Tech.registerTech=function(name,tech){if(!Tech.techs_){Tech.techs_={}}if(!Tech.isTech(tech)){throw new Error("Tech "+name+" must be a Tech")}if(!Tech.canPlayType){throw new Error("Techs must have a static canPlayType method on them")}if(!Tech.canPlaySource){throw new Error("Techs must have a static canPlaySource method on them")}name=toTitleCase(name);Tech.techs_[name]=tech;Tech.techs_[toLowerCase(name)]=tech;if("Tech"!==name){Tech.defaultTechOrder_.push(name)}return tech};Tech.getTech=function(name){if(!name){return}if(Tech.techs_&&Tech.techs_[name]){return Tech.techs_[name]}name=toTitleCase(name);if(window$3&&window$3.videojs&&window$3.videojs[name]){log.warn("The "+name+" tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)");return window$3.videojs[name]}};return Tech}(Component);ALL.names.forEach(function(name){var props=ALL[name];Tech.prototype[props.getterName]=function(){this[props.privateName]=this[props.privateName]||new props.ListClass;return this[props.privateName]}});Tech.prototype.featuresVolumeControl=!0;Tech.prototype.featuresMuteControl=!0;Tech.prototype.featuresFullscreenResize=!1;Tech.prototype.featuresPlaybackRate=!1;Tech.prototype.featuresProgressEvents=!1;Tech.prototype.featuresSourceset=!1;Tech.prototype.featuresTimeupdateEvents=!1;Tech.prototype.featuresNativeTextTracks=!1;Tech.withSourceHandlers=function(_Tech){_Tech.registerSourceHandler=function(handler,index){var handlers=_Tech.sourceHandlers;if(!handlers){handlers=_Tech.sourceHandlers=[]}if(index===void 0){index=handlers.length}handlers.splice(index,0,handler)};_Tech.canPlayType=function(type){for(var handlers=_Tech.sourceHandlers||[],can,i=0;i<handlers.length;i++){can=handlers[i].canPlayType(type);if(can){return can}}return""};_Tech.selectSourceHandler=function(source,options){for(var handlers=_Tech.sourceHandlers||[],can,i=0;i<handlers.length;i++){can=handlers[i].canHandleSource(source,options);if(can){return handlers[i]}}return null};_Tech.canPlaySource=function(srcObj,options){var sh=_Tech.selectSourceHandler(srcObj,options);if(sh){return sh.canHandleSource(srcObj,options)}return""};["seekable","seeking","duration"].forEach(function(fnName){var originalFn=this[fnName];if("function"!=typeof originalFn){return}this[fnName]=function(){if(this.sourceHandler_&&this.sourceHandler_[fnName]){return this.sourceHandler_[fnName].apply(this.sourceHandler_,arguments)}return originalFn.apply(this,arguments)}},_Tech.prototype);_Tech.prototype.setSource=function(source){var sh=_Tech.selectSourceHandler(source,this.options_);if(!sh){if(_Tech.nativeSourceHandler){sh=_Tech.nativeSourceHandler}else{log.error("No source handler found for the current source.")}}this.disposeSourceHandler();this.off("dispose",this.disposeSourceHandler);if(sh!==_Tech.nativeSourceHandler){this.currentSource_=source}this.sourceHandler_=sh.handleSource(source,this,this.options_);this.one("dispose",this.disposeSourceHandler)};_Tech.prototype.disposeSourceHandler=function(){if(this.currentSource_){this.clearTracks(["audio","video"]);this.currentSource_=null}this.cleanupAutoTextTracks();if(this.sourceHandler_){if(this.sourceHandler_.dispose){this.sourceHandler_.dispose()}this.sourceHandler_=null}}};Component.registerComponent("Tech",Tech);Tech.registerTech("Tech",Tech);Tech.defaultTechOrder_=[];var middlewares={},middlewareInstances={},TERMINATOR={};function setSource(player,src,next){player.setTimeout(function(){return setSourceHelper(src,middlewares[src.type],next,player)},1)}function setTech(middleware,tech){middleware.forEach(function(mw){return mw.setTech&&mw.setTech(tech)})}function get(middleware,tech,method){return middleware.reduceRight(middlewareIterator(method),tech[method]())}function set(middleware,tech,method,arg){return tech[method](middleware.reduce(middlewareIterator(method),arg))}function mediate(middleware,tech,method,arg){if(void 0===arg){arg=null}var callMethod="call"+toTitleCase(method),middlewareValue=middleware.reduce(middlewareIterator(callMethod),arg),terminated=middlewareValue===TERMINATOR,returnValue=terminated?null:tech[method](middlewareValue);executeRight(middleware,method,returnValue,terminated);return returnValue}var allowedGetters={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1},allowedSetters={setCurrentTime:1,setMuted:1,setVolume:1},allowedMediators={play:1,pause:1};function middlewareIterator(method){return function(value,mw){if(value===TERMINATOR){return TERMINATOR}if(mw[method]){return mw[method](value)}return value}}function executeRight(mws,method,value,terminated){for(var i=mws.length-1,mw;0<=i;i--){mw=mws[i];if(mw[method]){mw[method](terminated,value)}}}function clearCacheForPlayer(player){middlewareInstances[player.id()]=null}function getOrCreateFactory(player,mwFactory){var mws=middlewareInstances[player.id()],mw=null;if(mws===void 0||null===mws){mw=mwFactory(player);middlewareInstances[player.id()]=[[mwFactory,mw]];return mw}for(var i=0;i<mws.length;i++){var _mws$i=mws[i],mwf=_mws$i[0],mwi=_mws$i[1];if(mwf!==mwFactory){continue}mw=mwi}if(null===mw){mw=mwFactory(player);mws.push([mwFactory,mw])}return mw}function setSourceHelper(src,middleware,next,player,acc,lastRun){if(void 0===src){src={}}if(void 0===middleware){middleware=[]}if(void 0===acc){acc=[]}if(void 0===lastRun){lastRun=!1}var _middleware=middleware,mwFactory=_middleware[0],mwrest=_middleware.slice(1);if("string"==typeof mwFactory){setSourceHelper(src,middlewares[mwFactory],next,player,acc,lastRun)}else if(mwFactory){var mw=getOrCreateFactory(player,mwFactory);if(!mw.setSource){acc.push(mw);return setSourceHelper(src,mwrest,next,player,acc,lastRun)}mw.setSource(assign({},src),function(err,_src){if(err){return setSourceHelper(src,mwrest,next,player,acc,lastRun)}acc.push(mw);setSourceHelper(_src,src.type===_src.type?mwrest:middlewares[_src.type],next,player,acc,lastRun)})}else if(mwrest.length){setSourceHelper(src,mwrest,next,player,acc,lastRun)}else if(lastRun){next(src,acc)}else{setSourceHelper(src,middlewares["*"],next,player,acc,!0)}}var MimetypesKind={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},getMimetype=function(src){if(void 0===src){src=""}var ext=getFileExtension(src),mimetype=MimetypesKind[ext.toLowerCase()];return mimetype||""},findMimetype=function(player,src){if(!src){return""}if(player.cache_.source.src===src&&player.cache_.source.type){return player.cache_.source.type}var matchingSources=player.cache_.sources.filter(function(s){return s.src===src});if(matchingSources.length){return matchingSources[0].type}for(var sources=player.$$("source"),i=0,s;i<sources.length;i++){s=sources[i];if(s.type&&s.src&&s.src===src){return s.type}}return getMimetype(src)},filterSource=function filterSource(src){if(Array.isArray(src)){var newsrc=[];src.forEach(function(srcobj){srcobj=filterSource(srcobj);if(Array.isArray(srcobj)){newsrc=newsrc.concat(srcobj)}else if(isObject(srcobj)){newsrc.push(srcobj)}});src=newsrc}else if("string"==typeof src&&src.trim()){src=[fixSource({src:src})]}else if(isObject(src)&&"string"==typeof src.src&&src.src&&src.src.trim()){src=[fixSource(src)]}else{src=[]}return src};function fixSource(src){if(!src.type){var mimetype=getMimetype(src.src);if(mimetype){src.type=mimetype}}return src}var MediaLoader=function(_Component){inheritsLoose(MediaLoader,_Component);function MediaLoader(player,options,ready){var _this,options_=mergeOptions({createEl:!1},options);_this=_Component.call(this,player,options_,ready)||this;if(!options.playerOptions.sources||0===options.playerOptions.sources.length){for(var i=0,j=options.playerOptions.techOrder;i<j.length;i++){var techName=toTitleCase(j[i]),tech=Tech.getTech(techName);if(!techName){tech=Component.getComponent(techName)}if(tech&&tech.isSupported()){player.loadTech_(techName);break}}}else{player.src(options.playerOptions.sources)}return _this}return MediaLoader}(Component);Component.registerComponent("MediaLoader",MediaLoader);var ClickableComponent=function(_Component){inheritsLoose(ClickableComponent,_Component);function ClickableComponent(player,options){var _this=_Component.call(this,player,options)||this;_this.emitTapEvents();_this.enable();return _this}var _proto=ClickableComponent.prototype;_proto.createEl=function(tag,props,attributes){if(void 0===tag){tag="div"}if(void 0===props){props={}}if(void 0===attributes){attributes={}}props=assign({innerHTML:"<span aria-hidden=\"true\" class=\"vjs-icon-placeholder\"></span>",className:this.buildCSSClass(),tabIndex:0},props);if("button"===tag){log.error("Creating a ClickableComponent with an HTML element of "+tag+" is not supported; use a Button instead.")}attributes=assign({role:"button"},attributes);this.tabIndex_=props.tabIndex;var el=_Component.prototype.createEl.call(this,tag,props,attributes);this.createControlTextEl(el);return el};_proto.dispose=function(){this.controlTextEl_=null;_Component.prototype.dispose.call(this)};_proto.createControlTextEl=function(el){this.controlTextEl_=createEl("span",{className:"vjs-control-text"},{"aria-live":"polite"});if(el){el.appendChild(this.controlTextEl_)}this.controlText(this.controlText_,el);return this.controlTextEl_};_proto.controlText=function(text,el){if(void 0===el){el=this.el()}if(text===void 0){return this.controlText_||"Need Text"}var localizedText=this.localize(text);this.controlText_=text;textContent(this.controlTextEl_,localizedText);if(!this.nonIconControl){el.setAttribute("title",localizedText)}};_proto.buildCSSClass=function(){return"vjs-control vjs-button "+_Component.prototype.buildCSSClass.call(this)};_proto.enable=function(){if(!this.enabled_){this.enabled_=!0;this.removeClass("vjs-disabled");this.el_.setAttribute("aria-disabled","false");if("undefined"!=typeof this.tabIndex_){this.el_.setAttribute("tabIndex",this.tabIndex_)}this.on(["tap","click"],this.handleClick);this.on("keydown",this.handleKeyDown)}};_proto.disable=function(){this.enabled_=!1;this.addClass("vjs-disabled");this.el_.setAttribute("aria-disabled","true");if("undefined"!=typeof this.tabIndex_){this.el_.removeAttribute("tabIndex")}this.off("mouseover",this.handleMouseOver);this.off("mouseout",this.handleMouseOut);this.off(["tap","click"],this.handleClick);this.off("keydown",this.handleKeyDown)};_proto.handleClick=function(){if(this.options_.clickHandler){this.options_.clickHandler.call(this,arguments)}};_proto.handleKeyDown=function(event){if(keycode.isEventKey(event,"Space")||keycode.isEventKey(event,"Enter")){event.preventDefault();event.stopPropagation();this.trigger("click")}else{_Component.prototype.handleKeyDown.call(this,event)}};return ClickableComponent}(Component);Component.registerComponent("ClickableComponent",ClickableComponent);var PosterImage=function(_ClickableComponent){inheritsLoose(PosterImage,_ClickableComponent);function PosterImage(player,options){var _this=_ClickableComponent.call(this,player,options)||this;_this.update();player.on("posterchange",bind(assertThisInitialized(_this),_this.update));return _this}var _proto=PosterImage.prototype;_proto.dispose=function(){this.player().off("posterchange",this.update);_ClickableComponent.prototype.dispose.call(this)};_proto.createEl=function(){var el=createEl("div",{className:"vjs-poster",tabIndex:-1});return el};_proto.update=function(){var url=this.player().poster();this.setSrc(url);if(url){this.show()}else{this.hide()}};_proto.setSrc=function(url){var backgroundImage="";if(url){backgroundImage="url(\""+url+"\")"}this.el_.style.backgroundImage=backgroundImage};_proto.handleClick=function(){if(!this.player_.controls()){return}var sourceIsEncrypted=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&0<this.player_.eme.sessions.length;if(this.player_.tech(!0)&&!((IE_VERSION||IS_EDGE)&&sourceIsEncrypted)){this.player_.tech(!0).focus()}if(this.player_.paused()){silencePromise(this.player_.play())}else{this.player_.pause()}};return PosterImage}(ClickableComponent);Component.registerComponent("PosterImage",PosterImage);var lightGray="#ccc",fontMap={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:"\"Andale Mono\", \"Lucida Console\", monospace",monospaceSerif:"\"Courier New\", monospace",proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:"\"Comic Sans MS\", Impact, fantasy",script:"\"Monotype Corsiva\", cursive",smallcaps:"\"Andale Mono\", \"Lucida Console\", monospace, sans-serif"};function constructColor(color,opacity){var hex;if(4===color.length){hex=color[1]+color[1]+color[2]+color[2]+color[3]+color[3]}else if(7===color.length){hex=color.slice(1)}else{throw new Error("Invalid color code provided, "+color+"; must be formatted as e.g. #f0e or #f604e2.")}return"rgba("+parseInt(hex.slice(0,2),16)+","+parseInt(hex.slice(2,4),16)+","+parseInt(hex.slice(4,6),16)+","+opacity+")"}function tryUpdateStyle(el,style,rule){try{el.style[style]=rule}catch(e){}}var TextTrackDisplay=function(_Component){inheritsLoose(TextTrackDisplay,_Component);function TextTrackDisplay(player,options,ready){var _this=_Component.call(this,player,options,ready)||this;var updateDisplayHandler=bind(assertThisInitialized(_this),_this.updateDisplay);player.on("loadstart",bind(assertThisInitialized(_this),_this.toggleDisplay));player.on("texttrackchange",updateDisplayHandler);player.on("loadedmetadata",bind(assertThisInitialized(_this),_this.preselectTrack));player.ready(bind(assertThisInitialized(_this),function(){if(player.tech_&&player.tech_.featuresNativeTextTracks){this.hide();return}player.on("fullscreenchange",updateDisplayHandler);player.on("playerresize",updateDisplayHandler);window$3.addEventListener("orientationchange",updateDisplayHandler);player.on("dispose",function(){return window$3.removeEventListener("orientationchange",updateDisplayHandler)});for(var tracks=this.options_.playerOptions.tracks||[],i=0;i<tracks.length;i++){this.player_.addRemoteTextTrack(tracks[i],!0)}this.preselectTrack()}));return _this}var _proto=TextTrackDisplay.prototype;_proto.preselectTrack=function(){for(var modes={captions:1,subtitles:1},trackList=this.player_.textTracks(),userPref=this.player_.cache_.selectedLanguage,firstDesc,firstCaptions,preferredTrack,i=0,track;i<trackList.length;i++){track=trackList[i];if(userPref&&userPref.enabled&&userPref.language&&userPref.language===track.language&&track.kind in modes){if(track.kind===userPref.kind){preferredTrack=track}else if(!preferredTrack){preferredTrack=track}}else if(userPref&&!userPref.enabled){preferredTrack=null;firstDesc=null;firstCaptions=null}else if(track["default"]){if("descriptions"===track.kind&&!firstDesc){firstDesc=track}else if(track.kind in modes&&!firstCaptions){firstCaptions=track}}}if(preferredTrack){preferredTrack.mode="showing"}else if(firstCaptions){firstCaptions.mode="showing"}else if(firstDesc){firstDesc.mode="showing"}};_proto.toggleDisplay=function(){if(this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks){this.hide()}else{this.show()}};_proto.createEl=function(){return _Component.prototype.createEl.call(this,"div",{className:"vjs-text-track-display"},{"aria-live":"off","aria-atomic":"true"})};_proto.clearDisplay=function(){if("function"==typeof window$3.WebVTT){window$3.WebVTT.processCues(window$3,[],this.el_)}};_proto.updateDisplay=function(){var tracks=this.player_.textTracks(),allowMultipleShowingTracks=this.options_.allowMultipleShowingTracks;this.clearDisplay();if(allowMultipleShowingTracks){for(var showingTracks=[],_i=0,track;_i<tracks.length;++_i){track=tracks[_i];if("showing"!==track.mode){continue}showingTracks.push(track)}this.updateForTrack(showingTracks);return}var descriptionsTrack=null,captionsSubtitlesTrack=null,i=tracks.length;while(i--){var _track=tracks[i];if("showing"===_track.mode){if("descriptions"===_track.kind){descriptionsTrack=_track}else{captionsSubtitlesTrack=_track}}}if(captionsSubtitlesTrack){if("off"!==this.getAttribute("aria-live")){this.setAttribute("aria-live","off")}this.updateForTrack(captionsSubtitlesTrack)}else if(descriptionsTrack){if("assertive"!==this.getAttribute("aria-live")){this.setAttribute("aria-live","assertive")}this.updateForTrack(descriptionsTrack)}};_proto.updateDisplayState=function(track){var overrides=this.player_.textTrackSettings.getValues(),cues=track.activeCues,i=cues.length;while(i--){var cue=cues[i];if(!cue){continue}var cueDiv=cue.displayState;if(overrides.color){cueDiv.firstChild.style.color=overrides.color}if(overrides.textOpacity){tryUpdateStyle(cueDiv.firstChild,"color",constructColor(overrides.color||"#fff",overrides.textOpacity))}if(overrides.backgroundColor){cueDiv.firstChild.style.backgroundColor=overrides.backgroundColor}if(overrides.backgroundOpacity){tryUpdateStyle(cueDiv.firstChild,"backgroundColor",constructColor(overrides.backgroundColor||"#000",overrides.backgroundOpacity))}if(overrides.windowColor){if(overrides.windowOpacity){tryUpdateStyle(cueDiv,"backgroundColor",constructColor(overrides.windowColor,overrides.windowOpacity))}else{cueDiv.style.backgroundColor=overrides.windowColor}}if(overrides.edgeStyle){if("dropshadow"===overrides.edgeStyle){cueDiv.firstChild.style.textShadow="2px 2px 3px #222, 2px 2px 4px #222, 2px 2px 5px #222"}else if("raised"===overrides.edgeStyle){cueDiv.firstChild.style.textShadow="1px 1px #222, 2px 2px #222, 3px 3px #222"}else if("depressed"===overrides.edgeStyle){cueDiv.firstChild.style.textShadow="1px 1px "+lightGray+", 0 1px "+lightGray+", -1px -1px "+"#222"+", 0 -1px "+"#222"}else if("uniform"===overrides.edgeStyle){cueDiv.firstChild.style.textShadow="0 0 4px #222, 0 0 4px #222, 0 0 4px #222, 0 0 4px #222"}}if(overrides.fontPercent&&1!==overrides.fontPercent){var fontSize=window$3.parseFloat(cueDiv.style.fontSize);cueDiv.style.fontSize=fontSize*overrides.fontPercent+"px";cueDiv.style.height="auto";cueDiv.style.top="auto"}if(overrides.fontFamily&&"default"!==overrides.fontFamily){if("small-caps"===overrides.fontFamily){cueDiv.firstChild.style.fontVariant="small-caps"}else{cueDiv.firstChild.style.fontFamily=fontMap[overrides.fontFamily]}}}};_proto.updateForTrack=function(tracks){if(!Array.isArray(tracks)){tracks=[tracks]}if("function"!=typeof window$3.WebVTT||tracks.every(function(track){return!track.activeCues})){return}for(var cues=[],i=0,track;i<tracks.length;++i){track=tracks[i];for(var j=0;j<track.activeCues.length;++j){cues.push(track.activeCues[j])}}window$3.WebVTT.processCues(window$3,cues,this.el_);for(var _i2=0,_track2;_i2<tracks.length;++_i2){_track2=tracks[_i2];for(var _j=0,cueEl;_j<_track2.activeCues.length;++_j){cueEl=_track2.activeCues[_j].displayState;addClass(cueEl,"vjs-text-track-cue");addClass(cueEl,"vjs-text-track-cue-"+(_track2.language?_track2.language:_i2))}if(this.player_.textTrackSettings){this.updateDisplayState(_track2)}}};return TextTrackDisplay}(Component);Component.registerComponent("TextTrackDisplay",TextTrackDisplay);var LoadingSpinner=function(_Component){inheritsLoose(LoadingSpinner,_Component);function LoadingSpinner(){return _Component.apply(this,arguments)||this}var _proto=LoadingSpinner.prototype;_proto.createEl=function(){var isAudio=this.player_.isAudio(),playerType=this.localize(isAudio?"Audio Player":"Video Player"),controlText=createEl("span",{className:"vjs-control-text",innerHTML:this.localize("{1} is loading.",[playerType])}),el=_Component.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",dir:"ltr"});el.appendChild(controlText);return el};return LoadingSpinner}(Component);Component.registerComponent("LoadingSpinner",LoadingSpinner);var Button=function(_ClickableComponent){inheritsLoose(Button,_ClickableComponent);function Button(){return _ClickableComponent.apply(this,arguments)||this}var _proto=Button.prototype;_proto.createEl=function(tag,props,attributes){if(void 0===props){props={}}if(void 0===attributes){attributes={}}tag="button";props=assign({innerHTML:"<span aria-hidden=\"true\" class=\"vjs-icon-placeholder\"></span>",className:this.buildCSSClass()},props);attributes=assign({type:"button"},attributes);var el=Component.prototype.createEl.call(this,tag,props,attributes);this.createControlTextEl(el);return el};_proto.addChild=function(child,options){if(void 0===options){options={}}var className=this.constructor.name;log.warn("Adding an actionable (user controllable) child to a Button ("+className+") is not supported; use a ClickableComponent instead.");return Component.prototype.addChild.call(this,child,options)};_proto.enable=function(){_ClickableComponent.prototype.enable.call(this);this.el_.removeAttribute("disabled")};_proto.disable=function(){_ClickableComponent.prototype.disable.call(this);this.el_.setAttribute("disabled","disabled")};_proto.handleKeyDown=function(event){if(keycode.isEventKey(event,"Space")||keycode.isEventKey(event,"Enter")){event.stopPropagation();return}_ClickableComponent.prototype.handleKeyDown.call(this,event)};return Button}(ClickableComponent);Component.registerComponent("Button",Button);var BigPlayButton=function(_Button){inheritsLoose(BigPlayButton,_Button);function BigPlayButton(player,options){var _this=_Button.call(this,player,options)||this;_this.mouseused_=!1;_this.on("mousedown",_this.handleMouseDown);return _this}var _proto=BigPlayButton.prototype;_proto.buildCSSClass=function(){return"vjs-big-play-button"};_proto.handleClick=function(event){var playPromise=this.player_.play();if(this.mouseused_&&event.clientX&&event.clientY){var sourceIsEncrypted=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&0<this.player_.eme.sessions.length;silencePromise(playPromise);if(this.player_.tech(!0)&&!((IE_VERSION||IS_EDGE)&&sourceIsEncrypted)){this.player_.tech(!0).focus()}return}var cb=this.player_.getChild("controlBar"),playToggle=cb&&cb.getChild("playToggle");if(!playToggle){this.player_.tech(!0).focus();return}var playFocus=function(){return playToggle.focus()};if(isPromise(playPromise)){playPromise.then(playFocus,function(){})}else{this.setTimeout(playFocus,1)}};_proto.handleKeyDown=function(event){this.mouseused_=!1;_Button.prototype.handleKeyDown.call(this,event)};_proto.handleMouseDown=function(){this.mouseused_=!0};return BigPlayButton}(Button);BigPlayButton.prototype.controlText_="Play Video";Component.registerComponent("BigPlayButton",BigPlayButton);var CloseButton=function(_Button){inheritsLoose(CloseButton,_Button);function CloseButton(player,options){var _this=_Button.call(this,player,options)||this;_this.controlText(options&&options.controlText||_this.localize("Close"));return _this}var _proto=CloseButton.prototype;_proto.buildCSSClass=function(){return"vjs-close-button "+_Button.prototype.buildCSSClass.call(this)};_proto.handleClick=function(){this.trigger({type:"close",bubbles:!1})};_proto.handleKeyDown=function(event){if(keycode.isEventKey(event,"Esc")){event.preventDefault();event.stopPropagation();this.trigger("click")}else{_Button.prototype.handleKeyDown.call(this,event)}};return CloseButton}(Button);Component.registerComponent("CloseButton",CloseButton);var PlayToggle=function(_Button){inheritsLoose(PlayToggle,_Button);function PlayToggle(player,options){var _this;if(void 0===options){options={}}_this=_Button.call(this,player,options)||this;options.replay=options.replay===void 0||options.replay;_this.on(player,"play",_this.handlePlay);_this.on(player,"pause",_this.handlePause);if(options.replay){_this.on(player,"ended",_this.handleEnded)}return _this}var _proto=PlayToggle.prototype;_proto.buildCSSClass=function(){return"vjs-play-control "+_Button.prototype.buildCSSClass.call(this)};_proto.handleClick=function(){if(this.player_.paused()){this.player_.play()}else{this.player_.pause()}};_proto.handleSeeked=function(event){this.removeClass("vjs-ended");if(this.player_.paused()){this.handlePause(event)}else{this.handlePlay(event)}};_proto.handlePlay=function(){this.removeClass("vjs-ended");this.removeClass("vjs-paused");this.addClass("vjs-playing");this.controlText("Pause")};_proto.handlePause=function(){this.removeClass("vjs-playing");this.addClass("vjs-paused");this.controlText("Play")};_proto.handleEnded=function(){this.removeClass("vjs-playing");this.addClass("vjs-ended");this.controlText("Replay");this.one(this.player_,"seeked",this.handleSeeked)};return PlayToggle}(Button);PlayToggle.prototype.controlText_="Play";Component.registerComponent("PlayToggle",PlayToggle);var defaultImplementation=function(seconds,guide){seconds=0>seconds?0:seconds;var s=Math.floor(seconds%60),m=Math.floor(seconds/60%60),h=Math.floor(seconds/3600),gm=Math.floor(guide/60%60),gh=Math.floor(guide/3600);if(isNaN(seconds)||seconds===1/0){h=m=s="-"}h=0<h||0<gh?h+":":"";m=((h||10<=gm)&&10>m?"0"+m:m)+":";s=10>s?"0"+s:s;return h+m+s},implementation=defaultImplementation;function formatTime(seconds,guide){if(void 0===guide){guide=seconds}return implementation(seconds,guide)}var TimeDisplay=function(_Component){inheritsLoose(TimeDisplay,_Component);function TimeDisplay(player,options){var _this=_Component.call(this,player,options)||this;_this.on(player,["timeupdate","ended"],_this.updateContent);_this.updateTextNode_();return _this}var _proto=TimeDisplay.prototype;_proto.createEl=function(){var className=this.buildCSSClass(),el=_Component.prototype.createEl.call(this,"div",{className:className+" vjs-time-control vjs-control",innerHTML:"<span class=\"vjs-control-text\" role=\"presentation\">"+this.localize(this.labelText_)+"\xA0</span>"});this.contentEl_=createEl("span",{className:className+"-display"},{"aria-live":"off",role:"presentation"});el.appendChild(this.contentEl_);return el};_proto.dispose=function(){this.contentEl_=null;this.textNode_=null;_Component.prototype.dispose.call(this)};_proto.updateTextNode_=function(time){var _this2=this;if(void 0===time){time=0}time=formatTime(time);if(this.formattedTime_===time){return}this.formattedTime_=time;this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",function(){if(!_this2.contentEl_){return}var oldNode=_this2.textNode_;_this2.textNode_=document.createTextNode(_this2.formattedTime_);if(!_this2.textNode_){return}if(oldNode){_this2.contentEl_.replaceChild(_this2.textNode_,oldNode)}else{_this2.contentEl_.appendChild(_this2.textNode_)}})};_proto.updateContent=function(){};return TimeDisplay}(Component);TimeDisplay.prototype.labelText_="Time";TimeDisplay.prototype.controlText_="Time";Component.registerComponent("TimeDisplay",TimeDisplay);var CurrentTimeDisplay=function(_TimeDisplay){inheritsLoose(CurrentTimeDisplay,_TimeDisplay);function CurrentTimeDisplay(){return _TimeDisplay.apply(this,arguments)||this}var _proto=CurrentTimeDisplay.prototype;_proto.buildCSSClass=function(){return"vjs-current-time"};_proto.updateContent=function(){var time;if(this.player_.ended()){time=this.player_.duration()}else{time=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()}this.updateTextNode_(time)};return CurrentTimeDisplay}(TimeDisplay);CurrentTimeDisplay.prototype.labelText_="Current Time";CurrentTimeDisplay.prototype.controlText_="Current Time";Component.registerComponent("CurrentTimeDisplay",CurrentTimeDisplay);var DurationDisplay=function(_TimeDisplay){inheritsLoose(DurationDisplay,_TimeDisplay);function DurationDisplay(player,options){var _this=_TimeDisplay.call(this,player,options)||this;_this.on(player,"durationchange",_this.updateContent);_this.on(player,"loadstart",_this.updateContent);_this.on(player,"loadedmetadata",_this.updateContent);return _this}var _proto=DurationDisplay.prototype;_proto.buildCSSClass=function(){return"vjs-duration"};_proto.updateContent=function(){var duration=this.player_.duration();this.updateTextNode_(duration)};return DurationDisplay}(TimeDisplay);DurationDisplay.prototype.labelText_="Duration";DurationDisplay.prototype.controlText_="Duration";Component.registerComponent("DurationDisplay",DurationDisplay);var TimeDivider=function(_Component){inheritsLoose(TimeDivider,_Component);function TimeDivider(){return _Component.apply(this,arguments)||this}var _proto=TimeDivider.prototype;_proto.createEl=function(){return _Component.prototype.createEl.call(this,"div",{className:"vjs-time-control vjs-time-divider",innerHTML:"<div><span>/</span></div>"},{"aria-hidden":!0})};return TimeDivider}(Component);Component.registerComponent("TimeDivider",TimeDivider);var RemainingTimeDisplay=function(_TimeDisplay){inheritsLoose(RemainingTimeDisplay,_TimeDisplay);function RemainingTimeDisplay(player,options){var _this=_TimeDisplay.call(this,player,options)||this;_this.on(player,"durationchange",_this.updateContent);return _this}var _proto=RemainingTimeDisplay.prototype;_proto.buildCSSClass=function(){return"vjs-remaining-time"};_proto.createEl=function(){var el=_TimeDisplay.prototype.createEl.call(this);el.insertBefore(createEl("span",{},{"aria-hidden":!0},"-"),this.contentEl_);return el};_proto.updateContent=function(){if("number"!=typeof this.player_.duration()){return}var time;if(this.player_.ended()){time=0}else if(this.player_.remainingTimeDisplay){time=this.player_.remainingTimeDisplay()}else{time=this.player_.remainingTime()}this.updateTextNode_(time)};return RemainingTimeDisplay}(TimeDisplay);RemainingTimeDisplay.prototype.labelText_="Remaining Time";RemainingTimeDisplay.prototype.controlText_="Remaining Time";Component.registerComponent("RemainingTimeDisplay",RemainingTimeDisplay);var LiveDisplay=function(_Component){inheritsLoose(LiveDisplay,_Component);function LiveDisplay(player,options){var _this=_Component.call(this,player,options)||this;_this.updateShowing();_this.on(_this.player(),"durationchange",_this.updateShowing);return _this}var _proto=LiveDisplay.prototype;_proto.createEl=function(){var el=_Component.prototype.createEl.call(this,"div",{className:"vjs-live-control vjs-control"});this.contentEl_=createEl("div",{className:"vjs-live-display",innerHTML:"<span class=\"vjs-control-text\">"+this.localize("Stream Type")+"\xA0</span>"+this.localize("LIVE")},{"aria-live":"off"});el.appendChild(this.contentEl_);return el};_proto.dispose=function(){this.contentEl_=null;_Component.prototype.dispose.call(this)};_proto.updateShowing=function(){if(this.player().duration()===1/0){this.show()}else{this.hide()}};return LiveDisplay}(Component);Component.registerComponent("LiveDisplay",LiveDisplay);var SeekToLive=function(_Button){inheritsLoose(SeekToLive,_Button);function SeekToLive(player,options){var _this=_Button.call(this,player,options)||this;_this.updateLiveEdgeStatus();if(_this.player_.liveTracker){_this.on(_this.player_.liveTracker,"liveedgechange",_this.updateLiveEdgeStatus)}return _this}var _proto=SeekToLive.prototype;_proto.createEl=function(){var el=_Button.prototype.createEl.call(this,"button",{className:"vjs-seek-to-live-control vjs-control"});this.textEl_=createEl("span",{className:"vjs-seek-to-live-text",innerHTML:this.localize("LIVE")},{"aria-hidden":"true"});el.appendChild(this.textEl_);return el};_proto.updateLiveEdgeStatus=function(){if(!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()){this.setAttribute("aria-disabled",!0);this.addClass("vjs-at-live-edge");this.controlText("Seek to live, currently playing live")}else{this.setAttribute("aria-disabled",!1);this.removeClass("vjs-at-live-edge");this.controlText("Seek to live, currently behind live")}};_proto.handleClick=function(){this.player_.liveTracker.seekToLiveEdge()};_proto.dispose=function(){if(this.player_.liveTracker){this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatus)}this.textEl_=null;_Button.prototype.dispose.call(this)};return SeekToLive}(Button);SeekToLive.prototype.controlText_="Seek to live, currently playing live";Component.registerComponent("SeekToLive",SeekToLive);var clamp=function(number,min,max){number=+number;return Math.min(max,Math.max(min,isNaN(number)?min:number))},Slider=function(_Component){inheritsLoose(Slider,_Component);function Slider(player,options){var _this=_Component.call(this,player,options)||this;_this.bar=_this.getChild(_this.options_.barName);_this.vertical(!!_this.options_.vertical);_this.enable();return _this}var _proto=Slider.prototype;_proto.enabled=function(){return this.enabled_};_proto.enable=function(){if(this.enabled()){return}this.on("mousedown",this.handleMouseDown);this.on("touchstart",this.handleMouseDown);this.on("keydown",this.handleKeyDown);this.on("click",this.handleClick);this.on(this.player_,"controlsvisible",this.update);if(this.playerEvent){this.on(this.player_,this.playerEvent,this.update)}this.removeClass("disabled");this.setAttribute("tabindex",0);this.enabled_=!0};_proto.disable=function(){if(!this.enabled()){return}var doc=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown);this.off("touchstart",this.handleMouseDown);this.off("keydown",this.handleKeyDown);this.off("click",this.handleClick);this.off(this.player_,"controlsvisible",this.update);this.off(doc,"mousemove",this.handleMouseMove);this.off(doc,"mouseup",this.handleMouseUp);this.off(doc,"touchmove",this.handleMouseMove);this.off(doc,"touchend",this.handleMouseUp);this.removeAttribute("tabindex");this.addClass("disabled");if(this.playerEvent){this.off(this.player_,this.playerEvent,this.update)}this.enabled_=!1};_proto.createEl=function(type,props,attributes){if(void 0===props){props={}}if(void 0===attributes){attributes={}}props.className=props.className+" vjs-slider";props=assign({tabIndex:0},props);attributes=assign({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},attributes);return _Component.prototype.createEl.call(this,type,props,attributes)};_proto.handleMouseDown=function(event){var doc=this.bar.el_.ownerDocument;if("mousedown"===event.type){event.preventDefault()}if("touchstart"===event.type&&!IS_CHROME){event.preventDefault()}blockTextSelection();this.addClass("vjs-sliding");this.trigger("slideractive");this.on(doc,"mousemove",this.handleMouseMove);this.on(doc,"mouseup",this.handleMouseUp);this.on(doc,"touchmove",this.handleMouseMove);this.on(doc,"touchend",this.handleMouseUp);this.handleMouseMove(event)};_proto.handleMouseMove=function(){};_proto.handleMouseUp=function(){var doc=this.bar.el_.ownerDocument;unblockTextSelection();this.removeClass("vjs-sliding");this.trigger("sliderinactive");this.off(doc,"mousemove",this.handleMouseMove);this.off(doc,"mouseup",this.handleMouseUp);this.off(doc,"touchmove",this.handleMouseMove);this.off(doc,"touchend",this.handleMouseUp);this.update()};_proto.update=function(){var _this2=this;if(!this.el_||!this.bar){return}var progress=this.getProgress();if(progress===this.progress_){return progress}this.progress_=progress;this.requestNamedAnimationFrame("Slider#update",function(){var sizeKey=_this2.vertical()?"height":"width";_this2.bar.el().style[sizeKey]=(100*progress).toFixed(2)+"%"});return progress};_proto.getProgress=function(){return+clamp(this.getPercent(),0,1).toFixed(4)};_proto.calculateDistance=function(event){var position=getPointerPosition(this.el_,event);if(this.vertical()){return position.y}return position.x};_proto.handleKeyDown=function(event){if(keycode.isEventKey(event,"Left")||keycode.isEventKey(event,"Down")){event.preventDefault();event.stopPropagation();this.stepBack()}else if(keycode.isEventKey(event,"Right")||keycode.isEventKey(event,"Up")){event.preventDefault();event.stopPropagation();this.stepForward()}else{_Component.prototype.handleKeyDown.call(this,event)}};_proto.handleClick=function(event){event.stopPropagation();event.preventDefault()};_proto.vertical=function(bool){if(bool===void 0){return this.vertical_||!1}this.vertical_=!!bool;if(this.vertical_){this.addClass("vjs-slider-vertical")}else{this.addClass("vjs-slider-horizontal")}};return Slider}(Component);Component.registerComponent("Slider",Slider);var percentify=function(time,end){return clamp(100*(time/end),0,100).toFixed(2)+"%"},LoadProgressBar=function(_Component){inheritsLoose(LoadProgressBar,_Component);function LoadProgressBar(player,options){var _this=_Component.call(this,player,options)||this;_this.partEls_=[];_this.on(player,"progress",_this.update);return _this}var _proto=LoadProgressBar.prototype;_proto.createEl=function(){var el=_Component.prototype.createEl.call(this,"div",{className:"vjs-load-progress"}),wrapper=createEl("span",{className:"vjs-control-text"}),loadedText=createEl("span",{textContent:this.localize("Loaded")}),separator=document.createTextNode(": ");this.percentageEl_=createEl("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"});el.appendChild(wrapper);wrapper.appendChild(loadedText);wrapper.appendChild(separator);wrapper.appendChild(this.percentageEl_);return el};_proto.dispose=function(){this.partEls_=null;this.percentageEl_=null;_Component.prototype.dispose.call(this)};_proto.update=function(){var _this2=this;this.requestNamedAnimationFrame("LoadProgressBar#update",function(){var liveTracker=_this2.player_.liveTracker,buffered=_this2.player_.buffered(),duration=liveTracker&&liveTracker.isLive()?liveTracker.seekableEnd():_this2.player_.duration(),bufferedEnd=_this2.player_.bufferedEnd(),children=_this2.partEls_,percent=percentify(bufferedEnd,duration);if(_this2.percent_!==percent){_this2.el_.style.width=percent;textContent(_this2.percentageEl_,percent);_this2.percent_=percent}for(var i=0;i<buffered.length;i++){var start=buffered.start(i),end=buffered.end(i),part=children[i];if(!part){part=_this2.el_.appendChild(createEl());children[i]=part}if(part.dataset.start===start&&part.dataset.end===end){continue}part.dataset.start=start;part.dataset.end=end;part.style.left=percentify(start,bufferedEnd);part.style.width=percentify(end-start,bufferedEnd)}for(var _i=children.length;_i>buffered.length;_i--){_this2.el_.removeChild(children[_i-1])}children.length=buffered.length})};return LoadProgressBar}(Component);Component.registerComponent("LoadProgressBar",LoadProgressBar);var TimeTooltip=function(_Component){inheritsLoose(TimeTooltip,_Component);function TimeTooltip(player,options){var _this=_Component.call(this,player,options)||this;_this.update=throttle(bind(assertThisInitialized(_this),_this.update),UPDATE_REFRESH_INTERVAL);return _this}var _proto=TimeTooltip.prototype;_proto.createEl=function(){return _Component.prototype.createEl.call(this,"div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})};_proto.update=function(seekBarRect,seekBarPoint,content){var tooltipRect=findPosition(this.el_),playerRect=getBoundingClientRect(this.player_.el()),seekBarPointPx=seekBarRect.width*seekBarPoint;if(!playerRect||!tooltipRect){return}var spaceLeftOfPoint=seekBarRect.left-playerRect.left+seekBarPointPx,spaceRightOfPoint=seekBarRect.width-seekBarPointPx+(playerRect.right-seekBarRect.right),pullTooltipBy=tooltipRect.width/2;if(spaceLeftOfPoint<pullTooltipBy){pullTooltipBy+=pullTooltipBy-spaceLeftOfPoint}else if(spaceRightOfPoint<pullTooltipBy){pullTooltipBy=spaceRightOfPoint}if(0>pullTooltipBy){pullTooltipBy=0}else if(pullTooltipBy>tooltipRect.width){pullTooltipBy=tooltipRect.width}this.el_.style.right="-"+pullTooltipBy+"px";this.write(content)};_proto.write=function(content){textContent(this.el_,content)};_proto.updateTime=function(seekBarRect,seekBarPoint,time,cb){var _this2=this;this.requestNamedAnimationFrame("TimeTooltip#updateTime",function(){var content,duration=_this2.player_.duration();if(_this2.player_.liveTracker&&_this2.player_.liveTracker.isLive()){var liveWindow=_this2.player_.liveTracker.liveWindow(),secondsBehind=liveWindow-seekBarPoint*liveWindow;content=(1>secondsBehind?"":"-")+formatTime(secondsBehind,liveWindow)}else{content=formatTime(time,duration)}_this2.update(seekBarRect,seekBarPoint,content);if(cb){cb()}})};return TimeTooltip}(Component);Component.registerComponent("TimeTooltip",TimeTooltip);var PlayProgressBar=function(_Component){inheritsLoose(PlayProgressBar,_Component);function PlayProgressBar(player,options){var _this=_Component.call(this,player,options)||this;_this.update=throttle(bind(assertThisInitialized(_this),_this.update),UPDATE_REFRESH_INTERVAL);return _this}var _proto=PlayProgressBar.prototype;_proto.createEl=function(){return _Component.prototype.createEl.call(this,"div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})};_proto.update=function(seekBarRect,seekBarPoint){var timeTooltip=this.getChild("timeTooltip");if(!timeTooltip){return}var time=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();timeTooltip.updateTime(seekBarRect,seekBarPoint,time)};return PlayProgressBar}(Component);PlayProgressBar.prototype.options_={children:[]};if(!IS_IOS&&!IS_ANDROID){PlayProgressBar.prototype.options_.children.push("timeTooltip")}Component.registerComponent("PlayProgressBar",PlayProgressBar);var MouseTimeDisplay=function(_Component){inheritsLoose(MouseTimeDisplay,_Component);function MouseTimeDisplay(player,options){var _this=_Component.call(this,player,options)||this;_this.update=throttle(bind(assertThisInitialized(_this),_this.update),UPDATE_REFRESH_INTERVAL);return _this}var _proto=MouseTimeDisplay.prototype;_proto.createEl=function(){return _Component.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})};_proto.update=function(seekBarRect,seekBarPoint){var _this2=this,time=seekBarPoint*this.player_.duration();this.getChild("timeTooltip").updateTime(seekBarRect,seekBarPoint,time,function(){_this2.el_.style.left=seekBarRect.width*seekBarPoint+"px"})};return MouseTimeDisplay}(Component);MouseTimeDisplay.prototype.options_={children:["timeTooltip"]};Component.registerComponent("MouseTimeDisplay",MouseTimeDisplay);var PAGE_KEY_MULTIPLIER=12,SeekBar=function(_Slider){inheritsLoose(SeekBar,_Slider);function SeekBar(player,options){var _this=_Slider.call(this,player,options)||this;_this.setEventHandlers_();return _this}var _proto=SeekBar.prototype;_proto.setEventHandlers_=function(){this.update_=bind(this,this.update);this.update=throttle(this.update_,UPDATE_REFRESH_INTERVAL);this.on(this.player_,["ended","durationchange","timeupdate"],this.update);if(this.player_.liveTracker){this.on(this.player_.liveTracker,"liveedgechange",this.update)}this.updateInterval=null;this.on(this.player_,["playing"],this.enableInterval_);this.on(this.player_,["ended","pause","waiting"],this.disableInterval_);if("hidden"in document&&"visibilityState"in document){this.on(document,"visibilitychange",this.toggleVisibility_)}};_proto.toggleVisibility_=function(e){if(document.hidden){this.disableInterval_(e)}else{this.enableInterval_();this.update()}};_proto.enableInterval_=function(){if(this.updateInterval){return}this.updateInterval=this.setInterval(this.update,UPDATE_REFRESH_INTERVAL)};_proto.disableInterval_=function(e){if(this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&"ended"!==e.type){return}if(!this.updateInterval){return}this.clearInterval(this.updateInterval);this.updateInterval=null};_proto.createEl=function(){return _Slider.prototype.createEl.call(this,"div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})};_proto.update=function(){var _this2=this,percent=_Slider.prototype.update.call(this);this.requestNamedAnimationFrame("SeekBar#update",function(){var currentTime=_this2.player_.ended()?_this2.player_.duration():_this2.getCurrentTime_(),liveTracker=_this2.player_.liveTracker,duration=_this2.player_.duration();if(liveTracker&&liveTracker.isLive()){duration=_this2.player_.liveTracker.liveCurrentTime()}if(_this2.percent_!==percent){_this2.el_.setAttribute("aria-valuenow",(100*percent).toFixed(2));_this2.percent_=percent}if(_this2.currentTime_!==currentTime||_this2.duration_!==duration){_this2.el_.setAttribute("aria-valuetext",_this2.localize("progress bar timing: currentTime={1} duration={2}",[formatTime(currentTime,duration),formatTime(duration,duration)],"{1} of {2}"));_this2.currentTime_=currentTime;_this2.duration_=duration}if(_this2.bar){_this2.bar.update(getBoundingClientRect(_this2.el()),_this2.getProgress())}});return percent};_proto.getCurrentTime_=function(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()};_proto.getPercent=function(){var currentTime=this.getCurrentTime_(),percent,liveTracker=this.player_.liveTracker;if(liveTracker&&liveTracker.isLive()){percent=(currentTime-liveTracker.seekableStart())/liveTracker.liveWindow();if(liveTracker.atLiveEdge()){percent=1}}else{percent=currentTime/this.player_.duration()}return percent};_proto.handleMouseDown=function(event){if(!isSingleLeftClick(event)){return}event.stopPropagation();this.player_.scrubbing(!0);this.videoWasPlaying=!this.player_.paused();this.player_.pause();_Slider.prototype.handleMouseDown.call(this,event)};_proto.handleMouseMove=function(event){if(!isSingleLeftClick(event)){return}var newTime,distance=this.calculateDistance(event),liveTracker=this.player_.liveTracker;if(!liveTracker||!liveTracker.isLive()){newTime=distance*this.player_.duration();if(newTime===this.player_.duration()){newTime=newTime-.1}}else{if(.99<=distance){liveTracker.seekToLiveEdge();return}var seekableStart=liveTracker.seekableStart(),seekableEnd=liveTracker.liveCurrentTime();newTime=seekableStart+distance*liveTracker.liveWindow();if(newTime>=seekableEnd){newTime=seekableEnd}if(newTime<=seekableStart){newTime=seekableStart+.1}if(newTime===1/0){return}}this.player_.currentTime(newTime)};_proto.enable=function(){_Slider.prototype.enable.call(this);var mouseTimeDisplay=this.getChild("mouseTimeDisplay");if(!mouseTimeDisplay){return}mouseTimeDisplay.show()};_proto.disable=function(){_Slider.prototype.disable.call(this);var mouseTimeDisplay=this.getChild("mouseTimeDisplay");if(!mouseTimeDisplay){return}mouseTimeDisplay.hide()};_proto.handleMouseUp=function(event){_Slider.prototype.handleMouseUp.call(this,event);if(event){event.stopPropagation()}this.player_.scrubbing(!1);this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0});if(this.videoWasPlaying){silencePromise(this.player_.play())}else{this.update_()}};_proto.stepForward=function(){this.player_.currentTime(this.player_.currentTime()+5)};_proto.stepBack=function(){this.player_.currentTime(this.player_.currentTime()-5)};_proto.handleAction=function(){if(this.player_.paused()){this.player_.play()}else{this.player_.pause()}};_proto.handleKeyDown=function(event){if(keycode.isEventKey(event,"Space")||keycode.isEventKey(event,"Enter")){event.preventDefault();event.stopPropagation();this.handleAction(event)}else if(keycode.isEventKey(event,"Home")){event.preventDefault();event.stopPropagation();this.player_.currentTime(0)}else if(keycode.isEventKey(event,"End")){event.preventDefault();event.stopPropagation();this.player_.currentTime(this.player_.duration())}else if(/^[0-9]$/.test(keycode(event))){event.preventDefault();event.stopPropagation();var gotoFraction=10*(keycode.codes[keycode(event)]-keycode.codes[0])/100;this.player_.currentTime(this.player_.duration()*gotoFraction)}else if(keycode.isEventKey(event,"PgDn")){event.preventDefault();event.stopPropagation();this.player_.currentTime(this.player_.currentTime()-5*PAGE_KEY_MULTIPLIER)}else if(keycode.isEventKey(event,"PgUp")){event.preventDefault();event.stopPropagation();this.player_.currentTime(this.player_.currentTime()+5*PAGE_KEY_MULTIPLIER)}else{_Slider.prototype.handleKeyDown.call(this,event)}};_proto.dispose=function(){this.disableInterval_();this.off(this.player_,["ended","durationchange","timeupdate"],this.update);if(this.player_.liveTracker){this.on(this.player_.liveTracker,"liveedgechange",this.update)}this.off(this.player_,["playing"],this.enableInterval_);this.off(this.player_,["ended","pause","waiting"],this.disableInterval_);if("hidden"in document&&"visibilityState"in document){this.off(document,"visibilitychange",this.toggleVisibility_)}_Slider.prototype.dispose.call(this)};return SeekBar}(Slider);SeekBar.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"};if(!IS_IOS&&!IS_ANDROID){SeekBar.prototype.options_.children.splice(1,0,"mouseTimeDisplay")}Component.registerComponent("SeekBar",SeekBar);var ProgressControl=function(_Component){inheritsLoose(ProgressControl,_Component);function ProgressControl(player,options){var _this=_Component.call(this,player,options)||this;_this.handleMouseMove=throttle(bind(assertThisInitialized(_this),_this.handleMouseMove),UPDATE_REFRESH_INTERVAL);_this.throttledHandleMouseSeek=throttle(bind(assertThisInitialized(_this),_this.handleMouseSeek),UPDATE_REFRESH_INTERVAL);_this.enable();return _this}var _proto=ProgressControl.prototype;_proto.createEl=function(){return _Component.prototype.createEl.call(this,"div",{className:"vjs-progress-control vjs-control"})};_proto.handleMouseMove=function(event){var seekBar=this.getChild("seekBar");if(!seekBar){return}var playProgressBar=seekBar.getChild("playProgressBar"),mouseTimeDisplay=seekBar.getChild("mouseTimeDisplay");if(!playProgressBar&&!mouseTimeDisplay){return}var seekBarEl=seekBar.el(),seekBarRect=findPosition(seekBarEl),seekBarPoint=getPointerPosition(seekBarEl,event).x;seekBarPoint=clamp(seekBarPoint,0,1);if(mouseTimeDisplay){mouseTimeDisplay.update(seekBarRect,seekBarPoint)}if(playProgressBar){playProgressBar.update(seekBarRect,seekBar.getProgress())}};_proto.handleMouseSeek=function(event){var seekBar=this.getChild("seekBar");if(seekBar){seekBar.handleMouseMove(event)}};_proto.enabled=function(){return this.enabled_};_proto.disable=function(){this.children().forEach(function(child){return child.disable&&child.disable()});if(!this.enabled()){return}this.off(["mousedown","touchstart"],this.handleMouseDown);this.off(this.el_,"mousemove",this.handleMouseMove);this.handleMouseUp();this.addClass("disabled");this.enabled_=!1};_proto.enable=function(){this.children().forEach(function(child){return child.enable&&child.enable()});if(this.enabled()){return}this.on(["mousedown","touchstart"],this.handleMouseDown);this.on(this.el_,"mousemove",this.handleMouseMove);this.removeClass("disabled");this.enabled_=!0};_proto.handleMouseDown=function(event){var doc=this.el_.ownerDocument,seekBar=this.getChild("seekBar");if(seekBar){seekBar.handleMouseDown(event)}this.on(doc,"mousemove",this.throttledHandleMouseSeek);this.on(doc,"touchmove",this.throttledHandleMouseSeek);this.on(doc,"mouseup",this.handleMouseUp);this.on(doc,"touchend",this.handleMouseUp)};_proto.handleMouseUp=function(event){var doc=this.el_.ownerDocument,seekBar=this.getChild("seekBar");if(seekBar){seekBar.handleMouseUp(event)}this.off(doc,"mousemove",this.throttledHandleMouseSeek);this.off(doc,"touchmove",this.throttledHandleMouseSeek);this.off(doc,"mouseup",this.handleMouseUp);this.off(doc,"touchend",this.handleMouseUp)};return ProgressControl}(Component);ProgressControl.prototype.options_={children:["seekBar"]};Component.registerComponent("ProgressControl",ProgressControl);var PictureInPictureToggle=function(_Button){inheritsLoose(PictureInPictureToggle,_Button);function PictureInPictureToggle(player,options){var _this=_Button.call(this,player,options)||this;_this.on(player,["enterpictureinpicture","leavepictureinpicture"],_this.handlePictureInPictureChange);_this.on(player,["disablepictureinpicturechanged","loadedmetadata"],_this.handlePictureInPictureEnabledChange);_this.disable();return _this}var _proto=PictureInPictureToggle.prototype;_proto.buildCSSClass=function(){return"vjs-picture-in-picture-control "+_Button.prototype.buildCSSClass.call(this)};_proto.handlePictureInPictureEnabledChange=function(){if(document.pictureInPictureEnabled&&!1===this.player_.disablePictureInPicture()){this.enable()}else{this.disable()}};_proto.handlePictureInPictureChange=function(){if(this.player_.isInPictureInPicture()){this.controlText("Exit Picture-in-Picture")}else{this.controlText("Picture-in-Picture")}this.handlePictureInPictureEnabledChange()};_proto.handleClick=function(){if(!this.player_.isInPictureInPicture()){this.player_.requestPictureInPicture()}else{this.player_.exitPictureInPicture()}};return PictureInPictureToggle}(Button);PictureInPictureToggle.prototype.controlText_="Picture-in-Picture";Component.registerComponent("PictureInPictureToggle",PictureInPictureToggle);var FullscreenToggle=function(_Button){inheritsLoose(FullscreenToggle,_Button);function FullscreenToggle(player,options){var _this=_Button.call(this,player,options)||this;_this.on(player,"fullscreenchange",_this.handleFullscreenChange);if(!1===document[player.fsApi_.fullscreenEnabled]){_this.disable()}return _this}var _proto=FullscreenToggle.prototype;_proto.buildCSSClass=function(){return"vjs-fullscreen-control "+_Button.prototype.buildCSSClass.call(this)};_proto.handleFullscreenChange=function(){if(this.player_.isFullscreen()){this.controlText("Non-Fullscreen")}else{this.controlText("Fullscreen")}};_proto.handleClick=function(){if(!this.player_.isFullscreen()){this.player_.requestFullscreen()}else{this.player_.exitFullscreen()}};return FullscreenToggle}(Button);FullscreenToggle.prototype.controlText_="Fullscreen";Component.registerComponent("FullscreenToggle",FullscreenToggle);var checkVolumeSupport=function(self,player){if(player.tech_&&!player.tech_.featuresVolumeControl){self.addClass("vjs-hidden")}self.on(player,"loadstart",function(){if(!player.tech_.featuresVolumeControl){self.addClass("vjs-hidden")}else{self.removeClass("vjs-hidden")}})},VolumeLevel=function(_Component){inheritsLoose(VolumeLevel,_Component);function VolumeLevel(){return _Component.apply(this,arguments)||this}var _proto=VolumeLevel.prototype;_proto.createEl=function(){return _Component.prototype.createEl.call(this,"div",{className:"vjs-volume-level",innerHTML:"<span class=\"vjs-control-text\"></span>"})};return VolumeLevel}(Component);Component.registerComponent("VolumeLevel",VolumeLevel);var VolumeBar=function(_Slider){inheritsLoose(VolumeBar,_Slider);function VolumeBar(player,options){var _this=_Slider.call(this,player,options)||this;_this.on("slideractive",_this.updateLastVolume_);_this.on(player,"volumechange",_this.updateARIAAttributes);player.ready(function(){return _this.updateARIAAttributes()});return _this}var _proto=VolumeBar.prototype;_proto.createEl=function(){return _Slider.prototype.createEl.call(this,"div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})};_proto.handleMouseDown=function(event){if(!isSingleLeftClick(event)){return}_Slider.prototype.handleMouseDown.call(this,event)};_proto.handleMouseMove=function(event){if(!isSingleLeftClick(event)){return}this.checkMuted();this.player_.volume(this.calculateDistance(event))};_proto.checkMuted=function(){if(this.player_.muted()){this.player_.muted(!1)}};_proto.getPercent=function(){if(this.player_.muted()){return 0}return this.player_.volume()};_proto.stepForward=function(){this.checkMuted();this.player_.volume(this.player_.volume()+.1)};_proto.stepBack=function(){this.checkMuted();this.player_.volume(this.player_.volume()-.1)};_proto.updateARIAAttributes=function(){var ariaValue=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",ariaValue);this.el_.setAttribute("aria-valuetext",ariaValue+"%")};_proto.volumeAsPercentage_=function(){return Math.round(100*this.player_.volume())};_proto.updateLastVolume_=function(){var _this2=this,volumeBeforeDrag=this.player_.volume();this.one("sliderinactive",function(){if(0===_this2.player_.volume()){_this2.player_.lastVolume_(volumeBeforeDrag)}})};return VolumeBar}(Slider);VolumeBar.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"};VolumeBar.prototype.playerEvent="volumechange";Component.registerComponent("VolumeBar",VolumeBar);var VolumeControl=function(_Component){inheritsLoose(VolumeControl,_Component);function VolumeControl(player,options){var _this;if(void 0===options){options={}}options.vertical=options.vertical||!1;if("undefined"==typeof options.volumeBar||isPlain(options.volumeBar)){options.volumeBar=options.volumeBar||{};options.volumeBar.vertical=options.vertical}_this=_Component.call(this,player,options)||this;checkVolumeSupport(assertThisInitialized(_this),player);_this.throttledHandleMouseMove=throttle(bind(assertThisInitialized(_this),_this.handleMouseMove),UPDATE_REFRESH_INTERVAL);_this.on("mousedown",_this.handleMouseDown);_this.on("touchstart",_this.handleMouseDown);_this.on(_this.volumeBar,["focus","slideractive"],function(){_this.volumeBar.addClass("vjs-slider-active");_this.addClass("vjs-slider-active");_this.trigger("slideractive")});_this.on(_this.volumeBar,["blur","sliderinactive"],function(){_this.volumeBar.removeClass("vjs-slider-active");_this.removeClass("vjs-slider-active");_this.trigger("sliderinactive")});return _this}var _proto=VolumeControl.prototype;_proto.createEl=function(){var orientationClass="vjs-volume-horizontal";if(this.options_.vertical){orientationClass="vjs-volume-vertical"}return _Component.prototype.createEl.call(this,"div",{className:"vjs-volume-control vjs-control "+orientationClass})};_proto.handleMouseDown=function(){var doc=this.el_.ownerDocument;this.on(doc,"mousemove",this.throttledHandleMouseMove);this.on(doc,"touchmove",this.throttledHandleMouseMove);this.on(doc,"mouseup",this.handleMouseUp);this.on(doc,"touchend",this.handleMouseUp)};_proto.handleMouseUp=function(){var doc=this.el_.ownerDocument;this.off(doc,"mousemove",this.throttledHandleMouseMove);this.off(doc,"touchmove",this.throttledHandleMouseMove);this.off(doc,"mouseup",this.handleMouseUp);this.off(doc,"touchend",this.handleMouseUp)};_proto.handleMouseMove=function(event){this.volumeBar.handleMouseMove(event)};return VolumeControl}(Component);VolumeControl.prototype.options_={children:["volumeBar"]};Component.registerComponent("VolumeControl",VolumeControl);var checkMuteSupport=function(self,player){if(player.tech_&&!player.tech_.featuresMuteControl){self.addClass("vjs-hidden")}self.on(player,"loadstart",function(){if(!player.tech_.featuresMuteControl){self.addClass("vjs-hidden")}else{self.removeClass("vjs-hidden")}})},MuteToggle=function(_Button){inheritsLoose(MuteToggle,_Button);function MuteToggle(player,options){var _this=_Button.call(this,player,options)||this;checkMuteSupport(assertThisInitialized(_this),player);_this.on(player,["loadstart","volumechange"],_this.update);return _this}var _proto=MuteToggle.prototype;_proto.buildCSSClass=function(){return"vjs-mute-control "+_Button.prototype.buildCSSClass.call(this)};_proto.handleClick=function(){var vol=this.player_.volume(),lastVolume=this.player_.lastVolume_();if(0===vol){var volumeToSet=.1>lastVolume?.1:lastVolume;this.player_.volume(volumeToSet);this.player_.muted(!1)}else{this.player_.muted(this.player_.muted()?!1:!0)}};_proto.update=function(){this.updateIcon_();this.updateControlText_()};_proto.updateIcon_=function(){var vol=this.player_.volume(),level=3;if(IS_IOS&&this.player_.tech_&&this.player_.tech_.el_){this.player_.muted(this.player_.tech_.el_.muted)}if(0===vol||this.player_.muted()){level=0}else if(.33>vol){level=1}else if(.67>vol){level=2}for(var i=0;4>i;i++){removeClass(this.el_,"vjs-vol-"+i)}addClass(this.el_,"vjs-vol-"+level)};_proto.updateControlText_=function(){var soundOff=this.player_.muted()||0===this.player_.volume(),text=soundOff?"Unmute":"Mute";if(this.controlText()!==text){this.controlText(text)}};return MuteToggle}(Button);MuteToggle.prototype.controlText_="Mute";Component.registerComponent("MuteToggle",MuteToggle);var VolumePanel=function(_Component){inheritsLoose(VolumePanel,_Component);function VolumePanel(player,options){var _this;if(void 0===options){options={}}if("undefined"!=typeof options.inline){options.inline=options.inline}else{options.inline=!0}if("undefined"==typeof options.volumeControl||isPlain(options.volumeControl)){options.volumeControl=options.volumeControl||{};options.volumeControl.vertical=!options.inline}_this=_Component.call(this,player,options)||this;_this.on(player,["loadstart"],_this.volumePanelState_);_this.on(_this.muteToggle,"keyup",_this.handleKeyPress);_this.on(_this.volumeControl,"keyup",_this.handleVolumeControlKeyUp);_this.on("keydown",_this.handleKeyPress);_this.on("mouseover",_this.handleMouseOver);_this.on("mouseout",_this.handleMouseOut);_this.on(_this.volumeControl,["slideractive"],_this.sliderActive_);_this.on(_this.volumeControl,["sliderinactive"],_this.sliderInactive_);return _this}var _proto=VolumePanel.prototype;_proto.sliderActive_=function(){this.addClass("vjs-slider-active")};_proto.sliderInactive_=function(){this.removeClass("vjs-slider-active")};_proto.volumePanelState_=function(){if(this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")){this.addClass("vjs-hidden")}if(this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")){this.addClass("vjs-mute-toggle-only")}};_proto.createEl=function(){var orientationClass="vjs-volume-panel-horizontal";if(!this.options_.inline){orientationClass="vjs-volume-panel-vertical"}return _Component.prototype.createEl.call(this,"div",{className:"vjs-volume-panel vjs-control "+orientationClass})};_proto.dispose=function(){this.handleMouseOut();_Component.prototype.dispose.call(this)};_proto.handleVolumeControlKeyUp=function(event){if(keycode.isEventKey(event,"Esc")){this.muteToggle.focus()}};_proto.handleMouseOver=function(){this.addClass("vjs-hover");on(document,"keyup",bind(this,this.handleKeyPress))};_proto.handleMouseOut=function(){this.removeClass("vjs-hover");off(document,"keyup",bind(this,this.handleKeyPress))};_proto.handleKeyPress=function(event){if(keycode.isEventKey(event,"Esc")){this.handleMouseOut()}};return VolumePanel}(Component);VolumePanel.prototype.options_={children:["muteToggle","volumeControl"]};Component.registerComponent("VolumePanel",VolumePanel);var Menu=function(_Component){inheritsLoose(Menu,_Component);function Menu(player,options){var _this=_Component.call(this,player,options)||this;if(options){_this.menuButton_=options.menuButton}_this.focusedChild_=-1;_this.on("keydown",_this.handleKeyDown);_this.boundHandleBlur_=bind(assertThisInitialized(_this),_this.handleBlur);_this.boundHandleTapClick_=bind(assertThisInitialized(_this),_this.handleTapClick);return _this}var _proto=Menu.prototype;_proto.addEventListenerForItem=function(component){if(!(component instanceof Component)){return}this.on(component,"blur",this.boundHandleBlur_);this.on(component,["tap","click"],this.boundHandleTapClick_)};_proto.removeEventListenerForItem=function(component){if(!(component instanceof Component)){return}this.off(component,"blur",this.boundHandleBlur_);this.off(component,["tap","click"],this.boundHandleTapClick_)};_proto.removeChild=function(component){if("string"==typeof component){component=this.getChild(component)}this.removeEventListenerForItem(component);_Component.prototype.removeChild.call(this,component)};_proto.addItem=function(component){var childComponent=this.addChild(component);if(childComponent){this.addEventListenerForItem(childComponent)}};_proto.createEl=function(){var contentElType=this.options_.contentElType||"ul";this.contentEl_=createEl(contentElType,{className:"vjs-menu-content"});this.contentEl_.setAttribute("role","menu");var el=_Component.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"vjs-menu"});el.appendChild(this.contentEl_);on(el,"click",function(event){event.preventDefault();event.stopImmediatePropagation()});return el};_proto.dispose=function(){this.contentEl_=null;this.boundHandleBlur_=null;this.boundHandleTapClick_=null;_Component.prototype.dispose.call(this)};_proto.handleBlur=function(event){var relatedTarget=event.relatedTarget||document.activeElement;if(!this.children().some(function(element){return element.el()===relatedTarget})){var btn=this.menuButton_;if(btn&&btn.buttonPressed_&&relatedTarget!==btn.el().firstChild){btn.unpressButton()}}};_proto.handleTapClick=function(event){if(this.menuButton_){this.menuButton_.unpressButton();var childComponents=this.children();if(!Array.isArray(childComponents)){return}var foundComponent=childComponents.filter(function(component){return component.el()===event.target})[0];if(!foundComponent){return}if("CaptionSettingsMenuItem"!==foundComponent.name()){this.menuButton_.focus()}}};_proto.handleKeyDown=function(event){if(keycode.isEventKey(event,"Left")||keycode.isEventKey(event,"Down")){event.preventDefault();event.stopPropagation();this.stepForward()}else if(keycode.isEventKey(event,"Right")||keycode.isEventKey(event,"Up")){event.preventDefault();event.stopPropagation();this.stepBack()}};_proto.stepForward=function(){var stepChild=0;if(this.focusedChild_!==void 0){stepChild=this.focusedChild_+1}this.focus(stepChild)};_proto.stepBack=function(){var stepChild=0;if(this.focusedChild_!==void 0){stepChild=this.focusedChild_-1}this.focus(stepChild)};_proto.focus=function(item){if(void 0===item){item=0}var children=this.children().slice(),haveTitle=children.length&&children[0].className&&/vjs-menu-title/.test(children[0].className);if(haveTitle){children.shift()}if(0<children.length){if(0>item){item=0}else if(item>=children.length){item=children.length-1}this.focusedChild_=item;children[item].el_.focus()}};return Menu}(Component);Component.registerComponent("Menu",Menu);var MenuButton=function(_Component){inheritsLoose(MenuButton,_Component);function MenuButton(player,options){var _this;if(void 0===options){options={}}_this=_Component.call(this,player,options)||this;_this.menuButton_=new Button(player,options);_this.menuButton_.controlText(_this.controlText_);_this.menuButton_.el_.setAttribute("aria-haspopup","true");var buttonClass=Button.prototype.buildCSSClass();_this.menuButton_.el_.className=_this.buildCSSClass()+" "+buttonClass;_this.menuButton_.removeClass("vjs-control");_this.addChild(_this.menuButton_);_this.update();_this.enabled_=!0;_this.on(_this.menuButton_,"tap",_this.handleClick);_this.on(_this.menuButton_,"click",_this.handleClick);_this.on(_this.menuButton_,"keydown",_this.handleKeyDown);_this.on(_this.menuButton_,"mouseenter",function(){_this.addClass("vjs-hover");_this.menu.show();on(document,"keyup",bind(assertThisInitialized(_this),_this.handleMenuKeyUp))});_this.on("mouseleave",_this.handleMouseLeave);_this.on("keydown",_this.handleSubmenuKeyDown);return _this}var _proto=MenuButton.prototype;_proto.update=function(){var menu=this.createMenu();if(this.menu){this.menu.dispose();this.removeChild(this.menu)}this.menu=menu;this.addChild(menu);this.buttonPressed_=!1;this.menuButton_.el_.setAttribute("aria-expanded","false");if(this.items&&this.items.length<=this.hideThreshold_){this.hide()}else{this.show()}};_proto.createMenu=function(){var menu=new Menu(this.player_,{menuButton:this});this.hideThreshold_=0;if(this.options_.title){var titleEl=createEl("li",{className:"vjs-menu-title",innerHTML:toTitleCase(this.options_.title),tabIndex:-1});this.hideThreshold_+=1;var titleComponent=new Component(this.player_,{el:titleEl});menu.addItem(titleComponent)}this.items=this.createItems();if(this.items){for(var i=0;i<this.items.length;i++){menu.addItem(this.items[i])}}return menu};_proto.createItems=function(){};_proto.createEl=function(){return _Component.prototype.createEl.call(this,"div",{className:this.buildWrapperCSSClass()},{})};_proto.buildWrapperCSSClass=function(){var menuButtonClass="vjs-menu-button";if(!0===this.options_.inline){menuButtonClass+="-inline"}else{menuButtonClass+="-popup"}var buttonClass=Button.prototype.buildCSSClass();return"vjs-menu-button "+menuButtonClass+" "+buttonClass+" "+_Component.prototype.buildCSSClass.call(this)};_proto.buildCSSClass=function(){var menuButtonClass="vjs-menu-button";if(!0===this.options_.inline){menuButtonClass+="-inline"}else{menuButtonClass+="-popup"}return"vjs-menu-button "+menuButtonClass+" "+_Component.prototype.buildCSSClass.call(this)};_proto.controlText=function(text,el){if(void 0===el){el=this.menuButton_.el()}return this.menuButton_.controlText(text,el)};_proto.dispose=function(){this.handleMouseLeave();_Component.prototype.dispose.call(this)};_proto.handleClick=function(){if(this.buttonPressed_){this.unpressButton()}else{this.pressButton()}};_proto.handleMouseLeave=function(){this.removeClass("vjs-hover");off(document,"keyup",bind(this,this.handleMenuKeyUp))};_proto.focus=function(){this.menuButton_.focus()};_proto.blur=function(){this.menuButton_.blur()};_proto.handleKeyDown=function(event){if(keycode.isEventKey(event,"Esc")||keycode.isEventKey(event,"Tab")){if(this.buttonPressed_){this.unpressButton()}if(!keycode.isEventKey(event,"Tab")){event.preventDefault();this.menuButton_.focus()}}else if(keycode.isEventKey(event,"Up")||keycode.isEventKey(event,"Down")){if(!this.buttonPressed_){event.preventDefault();this.pressButton()}}};_proto.handleMenuKeyUp=function(event){if(keycode.isEventKey(event,"Esc")||keycode.isEventKey(event,"Tab")){this.removeClass("vjs-hover")}};_proto.handleSubmenuKeyPress=function(event){this.handleSubmenuKeyDown(event)};_proto.handleSubmenuKeyDown=function(event){if(keycode.isEventKey(event,"Esc")||keycode.isEventKey(event,"Tab")){if(this.buttonPressed_){this.unpressButton()}if(!keycode.isEventKey(event,"Tab")){event.preventDefault();this.menuButton_.focus()}}};_proto.pressButton=function(){if(this.enabled_){this.buttonPressed_=!0;this.menu.show();this.menu.lockShowing();this.menuButton_.el_.setAttribute("aria-expanded","true");if(IS_IOS&&isInFrame()){return}this.menu.focus()}};_proto.unpressButton=function(){if(this.enabled_){this.buttonPressed_=!1;this.menu.unlockShowing();this.menu.hide();this.menuButton_.el_.setAttribute("aria-expanded","false")}};_proto.disable=function(){this.unpressButton();this.enabled_=!1;this.addClass("vjs-disabled");this.menuButton_.disable()};_proto.enable=function(){this.enabled_=!0;this.removeClass("vjs-disabled");this.menuButton_.enable()};return MenuButton}(Component);Component.registerComponent("MenuButton",MenuButton);var TrackButton=function(_MenuButton){inheritsLoose(TrackButton,_MenuButton);function TrackButton(player,options){var _this,tracks=options.tracks;_this=_MenuButton.call(this,player,options)||this;if(1>=_this.items.length){_this.hide()}if(!tracks){return assertThisInitialized(_this)}var updateHandler=bind(assertThisInitialized(_this),_this.update);tracks.addEventListener("removetrack",updateHandler);tracks.addEventListener("addtrack",updateHandler);_this.player_.on("ready",updateHandler);_this.player_.on("dispose",function(){tracks.removeEventListener("removetrack",updateHandler);tracks.removeEventListener("addtrack",updateHandler)});return _this}return TrackButton}(MenuButton);Component.registerComponent("TrackButton",TrackButton);var MenuKeys=["Tab","Esc","Up","Down","Right","Left"],MenuItem=function(_ClickableComponent){inheritsLoose(MenuItem,_ClickableComponent);function MenuItem(player,options){var _this=_ClickableComponent.call(this,player,options)||this;_this.selectable=options.selectable;_this.isSelected_=options.selected||!1;_this.multiSelectable=options.multiSelectable;_this.selected(_this.isSelected_);if(_this.selectable){if(_this.multiSelectable){_this.el_.setAttribute("role","menuitemcheckbox")}else{_this.el_.setAttribute("role","menuitemradio")}}else{_this.el_.setAttribute("role","menuitem")}return _this}var _proto=MenuItem.prototype;_proto.createEl=function(type,props,attrs){this.nonIconControl=!0;return _ClickableComponent.prototype.createEl.call(this,"li",assign({className:"vjs-menu-item",innerHTML:"<span class=\"vjs-menu-item-text\">"+this.localize(this.options_.label)+"</span>",tabIndex:-1},props),attrs)};_proto.handleKeyDown=function(event){if(!MenuKeys.some(function(key){return keycode.isEventKey(event,key)})){_ClickableComponent.prototype.handleKeyDown.call(this,event)}};_proto.handleClick=function(){this.selected(!0)};_proto.selected=function(_selected){if(this.selectable){if(_selected){this.addClass("vjs-selected");this.el_.setAttribute("aria-checked","true");this.controlText(", selected");this.isSelected_=!0}else{this.removeClass("vjs-selected");this.el_.setAttribute("aria-checked","false");this.controlText("");this.isSelected_=!1}}};return MenuItem}(ClickableComponent);Component.registerComponent("MenuItem",MenuItem);var TextTrackMenuItem=function(_MenuItem){inheritsLoose(TextTrackMenuItem,_MenuItem);function TextTrackMenuItem(player,options){var _this,track=options.track,tracks=player.textTracks();options.label=track.label||track.language||"Unknown";options.selected="showing"===track.mode;_this=_MenuItem.call(this,player,options)||this;_this.track=track;_this.kinds=(options.kinds||[options.kind||_this.track.kind]).filter(Boolean);var changeHandler=function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_this.handleTracksChange.apply(assertThisInitialized(_this),args)},selectedLanguageChangeHandler=function(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}_this.handleSelectedLanguageChange.apply(assertThisInitialized(_this),args)};player.on(["loadstart","texttrackchange"],changeHandler);tracks.addEventListener("change",changeHandler);tracks.addEventListener("selectedlanguagechange",selectedLanguageChangeHandler);_this.on("dispose",function(){player.off(["loadstart","texttrackchange"],changeHandler);tracks.removeEventListener("change",changeHandler);tracks.removeEventListener("selectedlanguagechange",selectedLanguageChangeHandler)});if(tracks.onchange===void 0){var event;_this.on(["tap","click"],function(){if("object"!==_typeof2(window$3.Event)){try{event=new window$3.Event("change")}catch(err){}}if(!event){event=document.createEvent("Event");event.initEvent("change",!0,!0)}tracks.dispatchEvent(event)})}_this.handleTracksChange();return _this}var _proto=TextTrackMenuItem.prototype;_proto.handleClick=function(event){var referenceTrack=this.track,tracks=this.player_.textTracks();_MenuItem.prototype.handleClick.call(this,event);if(!tracks){return}for(var i=0,track;i<tracks.length;i++){track=tracks[i];if(-1===this.kinds.indexOf(track.kind)){continue}if(track===referenceTrack){if("showing"!==track.mode){track.mode="showing"}}else if("disabled"!==track.mode){track.mode="disabled"}}};_proto.handleTracksChange=function(){var shouldBeSelected="showing"===this.track.mode;if(shouldBeSelected!==this.isSelected_){this.selected(shouldBeSelected)}};_proto.handleSelectedLanguageChange=function(){if("showing"===this.track.mode){var selectedLanguage=this.player_.cache_.selectedLanguage;if(selectedLanguage&&selectedLanguage.enabled&&selectedLanguage.language===this.track.language&&selectedLanguage.kind!==this.track.kind){return}this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}};_proto.dispose=function(){this.track=null;_MenuItem.prototype.dispose.call(this)};return TextTrackMenuItem}(MenuItem);Component.registerComponent("TextTrackMenuItem",TextTrackMenuItem);var OffTextTrackMenuItem=function(_TextTrackMenuItem){inheritsLoose(OffTextTrackMenuItem,_TextTrackMenuItem);function OffTextTrackMenuItem(player,options){options.track={player:player,kind:options.kind,kinds:options.kinds,default:!1,mode:"disabled"};if(!options.kinds){options.kinds=[options.kind]}if(options.label){options.track.label=options.label}else{options.track.label=options.kinds.join(" and ")+" off"}options.selectable=!0;options.multiSelectable=!1;return _TextTrackMenuItem.call(this,player,options)||this}var _proto=OffTextTrackMenuItem.prototype;_proto.handleTracksChange=function(){for(var tracks=this.player().textTracks(),shouldBeSelected=!0,i=0,l=tracks.length,track;i<l;i++){track=tracks[i];if(-1<this.options_.kinds.indexOf(track.kind)&&"showing"===track.mode){shouldBeSelected=!1;break}}if(shouldBeSelected!==this.isSelected_){this.selected(shouldBeSelected)}};_proto.handleSelectedLanguageChange=function(){for(var tracks=this.player().textTracks(),allHidden=!0,i=0,l=tracks.length,track;i<l;i++){track=tracks[i];if(-1<["captions","descriptions","subtitles"].indexOf(track.kind)&&"showing"===track.mode){allHidden=!1;break}}if(allHidden){this.player_.cache_.selectedLanguage={enabled:!1}}};return OffTextTrackMenuItem}(TextTrackMenuItem);Component.registerComponent("OffTextTrackMenuItem",OffTextTrackMenuItem);var TextTrackButton=function(_TrackButton){inheritsLoose(TextTrackButton,_TrackButton);function TextTrackButton(player,options){if(void 0===options){options={}}options.tracks=player.textTracks();return _TrackButton.call(this,player,options)||this}var _proto=TextTrackButton.prototype;_proto.createItems=function(items,TrackMenuItem){if(void 0===items){items=[]}if(void 0===TrackMenuItem){TrackMenuItem=TextTrackMenuItem}var label;if(this.label_){label=this.label_+" off"}items.push(new OffTextTrackMenuItem(this.player_,{kinds:this.kinds_,kind:this.kind_,label:label}));this.hideThreshold_+=1;var tracks=this.player_.textTracks();if(!Array.isArray(this.kinds_)){this.kinds_=[this.kind_]}for(var i=0,track;i<tracks.length;i++){track=tracks[i];if(-1<this.kinds_.indexOf(track.kind)){var item=new TrackMenuItem(this.player_,{track:track,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});item.addClass("vjs-"+track.kind+"-menu-item");items.push(item)}}return items};return TextTrackButton}(TrackButton);Component.registerComponent("TextTrackButton",TextTrackButton);var ChaptersTrackMenuItem=function(_MenuItem){inheritsLoose(ChaptersTrackMenuItem,_MenuItem);function ChaptersTrackMenuItem(player,options){var _this,track=options.track,cue=options.cue,currentTime=player.currentTime();options.selectable=!0;options.multiSelectable=!1;options.label=cue.text;options.selected=cue.startTime<=currentTime&&currentTime<cue.endTime;_this=_MenuItem.call(this,player,options)||this;_this.track=track;_this.cue=cue;track.addEventListener("cuechange",bind(assertThisInitialized(_this),_this.update));return _this}var _proto=ChaptersTrackMenuItem.prototype;_proto.handleClick=function(){_MenuItem.prototype.handleClick.call(this);this.player_.currentTime(this.cue.startTime);this.update(this.cue.startTime)};_proto.update=function(){var cue=this.cue,currentTime=this.player_.currentTime();this.selected(cue.startTime<=currentTime&&currentTime<cue.endTime)};return ChaptersTrackMenuItem}(MenuItem);Component.registerComponent("ChaptersTrackMenuItem",ChaptersTrackMenuItem);var ChaptersButton=function(_TextTrackButton){inheritsLoose(ChaptersButton,_TextTrackButton);function ChaptersButton(player,options,ready){return _TextTrackButton.call(this,player,options,ready)||this}var _proto=ChaptersButton.prototype;_proto.buildCSSClass=function(){return"vjs-chapters-button "+_TextTrackButton.prototype.buildCSSClass.call(this)};_proto.buildWrapperCSSClass=function(){return"vjs-chapters-button "+_TextTrackButton.prototype.buildWrapperCSSClass.call(this)};_proto.update=function(event){if(!this.track_||event&&("addtrack"===event.type||"removetrack"===event.type)){this.setTrack(this.findChaptersTrack())}_TextTrackButton.prototype.update.call(this)};_proto.setTrack=function(track){if(this.track_===track){return}if(!this.updateHandler_){this.updateHandler_=this.update.bind(this)}if(this.track_){var remoteTextTrackEl=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);if(remoteTextTrackEl){remoteTextTrackEl.removeEventListener("load",this.updateHandler_)}this.track_=null}this.track_=track;if(this.track_){this.track_.mode="hidden";var _remoteTextTrackEl=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);if(_remoteTextTrackEl){_remoteTextTrackEl.addEventListener("load",this.updateHandler_)}}};_proto.findChaptersTrack=function(){for(var tracks=this.player_.textTracks()||[],i=tracks.length-1,track;0<=i;i--){track=tracks[i];if(track.kind===this.kind_){return track}}};_proto.getMenuCaption=function(){if(this.track_&&this.track_.label){return this.track_.label}return this.localize(toTitleCase(this.kind_))};_proto.createMenu=function(){this.options_.title=this.getMenuCaption();return _TextTrackButton.prototype.createMenu.call(this)};_proto.createItems=function(){var items=[];if(!this.track_){return items}var cues=this.track_.cues;if(!cues){return items}for(var i=0,l=cues.length;i<l;i++){var cue=cues[i],mi=new ChaptersTrackMenuItem(this.player_,{track:this.track_,cue:cue});items.push(mi)}return items};return ChaptersButton}(TextTrackButton);ChaptersButton.prototype.kind_="chapters";ChaptersButton.prototype.controlText_="Chapters";Component.registerComponent("ChaptersButton",ChaptersButton);var DescriptionsButton=function(_TextTrackButton){inheritsLoose(DescriptionsButton,_TextTrackButton);function DescriptionsButton(player,options,ready){var _this=_TextTrackButton.call(this,player,options,ready)||this;var tracks=player.textTracks(),changeHandler=bind(assertThisInitialized(_this),_this.handleTracksChange);tracks.addEventListener("change",changeHandler);_this.on("dispose",function(){tracks.removeEventListener("change",changeHandler)});return _this}var _proto=DescriptionsButton.prototype;_proto.handleTracksChange=function(){for(var tracks=this.player().textTracks(),disabled=!1,i=0,l=tracks.length,track;i<l;i++){track=tracks[i];if(track.kind!==this.kind_&&"showing"===track.mode){disabled=!0;break}}if(disabled){this.disable()}else{this.enable()}};_proto.buildCSSClass=function(){return"vjs-descriptions-button "+_TextTrackButton.prototype.buildCSSClass.call(this)};_proto.buildWrapperCSSClass=function(){return"vjs-descriptions-button "+_TextTrackButton.prototype.buildWrapperCSSClass.call(this)};return DescriptionsButton}(TextTrackButton);DescriptionsButton.prototype.kind_="descriptions";DescriptionsButton.prototype.controlText_="Descriptions";Component.registerComponent("DescriptionsButton",DescriptionsButton);var SubtitlesButton=function(_TextTrackButton){inheritsLoose(SubtitlesButton,_TextTrackButton);function SubtitlesButton(player,options,ready){return _TextTrackButton.call(this,player,options,ready)||this}var _proto=SubtitlesButton.prototype;_proto.buildCSSClass=function(){return"vjs-subtitles-button "+_TextTrackButton.prototype.buildCSSClass.call(this)};_proto.buildWrapperCSSClass=function(){return"vjs-subtitles-button "+_TextTrackButton.prototype.buildWrapperCSSClass.call(this)};return SubtitlesButton}(TextTrackButton);SubtitlesButton.prototype.kind_="subtitles";SubtitlesButton.prototype.controlText_="Subtitles";Component.registerComponent("SubtitlesButton",SubtitlesButton);var CaptionSettingsMenuItem=function(_TextTrackMenuItem){inheritsLoose(CaptionSettingsMenuItem,_TextTrackMenuItem);function CaptionSettingsMenuItem(player,options){var _this;options.track={player:player,kind:options.kind,label:options.kind+" settings",selectable:!1,default:!1,mode:"disabled"};options.selectable=!1;options.name="CaptionSettingsMenuItem";_this=_TextTrackMenuItem.call(this,player,options)||this;_this.addClass("vjs-texttrack-settings");_this.controlText(", opens "+options.kind+" settings dialog");return _this}var _proto=CaptionSettingsMenuItem.prototype;_proto.handleClick=function(){this.player().getChild("textTrackSettings").open()};return CaptionSettingsMenuItem}(TextTrackMenuItem);Component.registerComponent("CaptionSettingsMenuItem",CaptionSettingsMenuItem);var CaptionsButton=function(_TextTrackButton){inheritsLoose(CaptionsButton,_TextTrackButton);function CaptionsButton(player,options,ready){return _TextTrackButton.call(this,player,options,ready)||this}var _proto=CaptionsButton.prototype;_proto.buildCSSClass=function(){return"vjs-captions-button "+_TextTrackButton.prototype.buildCSSClass.call(this)};_proto.buildWrapperCSSClass=function(){return"vjs-captions-button "+_TextTrackButton.prototype.buildWrapperCSSClass.call(this)};_proto.createItems=function(){var items=[];if(!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")){items.push(new CaptionSettingsMenuItem(this.player_,{kind:this.kind_}));this.hideThreshold_+=1}return _TextTrackButton.prototype.createItems.call(this,items)};return CaptionsButton}(TextTrackButton);CaptionsButton.prototype.kind_="captions";CaptionsButton.prototype.controlText_="Captions";Component.registerComponent("CaptionsButton",CaptionsButton);var SubsCapsMenuItem=function(_TextTrackMenuItem){inheritsLoose(SubsCapsMenuItem,_TextTrackMenuItem);function SubsCapsMenuItem(){return _TextTrackMenuItem.apply(this,arguments)||this}var _proto=SubsCapsMenuItem.prototype;_proto.createEl=function(type,props,attrs){var innerHTML="<span class=\"vjs-menu-item-text\">"+this.localize(this.options_.label);if("captions"===this.options_.track.kind){innerHTML+="\n        <span aria-hidden=\"true\" class=\"vjs-icon-placeholder\"></span>\n        <span class=\"vjs-control-text\"> "+this.localize("Captions")+"</span>\n      "}innerHTML+="</span>";var el=_TextTrackMenuItem.prototype.createEl.call(this,type,assign({innerHTML:innerHTML},props),attrs);return el};return SubsCapsMenuItem}(TextTrackMenuItem);Component.registerComponent("SubsCapsMenuItem",SubsCapsMenuItem);var SubsCapsButton=function(_TextTrackButton){inheritsLoose(SubsCapsButton,_TextTrackButton);function SubsCapsButton(player,options){var _this;if(void 0===options){options={}}_this=_TextTrackButton.call(this,player,options)||this;_this.label_="subtitles";if(-1<["en","en-us","en-ca","fr-ca"].indexOf(_this.player_.language_)){_this.label_="captions"}_this.menuButton_.controlText(toTitleCase(_this.label_));return _this}var _proto=SubsCapsButton.prototype;_proto.buildCSSClass=function(){return"vjs-subs-caps-button "+_TextTrackButton.prototype.buildCSSClass.call(this)};_proto.buildWrapperCSSClass=function(){return"vjs-subs-caps-button "+_TextTrackButton.prototype.buildWrapperCSSClass.call(this)};_proto.createItems=function(){var items=[];if(!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")){items.push(new CaptionSettingsMenuItem(this.player_,{kind:this.label_}));this.hideThreshold_+=1}items=_TextTrackButton.prototype.createItems.call(this,items,SubsCapsMenuItem);return items};return SubsCapsButton}(TextTrackButton);SubsCapsButton.prototype.kinds_=["captions","subtitles"];SubsCapsButton.prototype.controlText_="Subtitles";Component.registerComponent("SubsCapsButton",SubsCapsButton);var AudioTrackMenuItem=function(_MenuItem){inheritsLoose(AudioTrackMenuItem,_MenuItem);function AudioTrackMenuItem(player,options){var _this,track=options.track,tracks=player.audioTracks();options.label=track.label||track.language||"Unknown";options.selected=track.enabled;_this=_MenuItem.call(this,player,options)||this;_this.track=track;_this.addClass("vjs-"+track.kind+"-menu-item");var changeHandler=function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_this.handleTracksChange.apply(assertThisInitialized(_this),args)};tracks.addEventListener("change",changeHandler);_this.on("dispose",function(){tracks.removeEventListener("change",changeHandler)});return _this}var _proto=AudioTrackMenuItem.prototype;_proto.createEl=function(type,props,attrs){var innerHTML="<span class=\"vjs-menu-item-text\">"+this.localize(this.options_.label);if("main-desc"===this.options_.track.kind){innerHTML+="\n        <span aria-hidden=\"true\" class=\"vjs-icon-placeholder\"></span>\n        <span class=\"vjs-control-text\"> "+this.localize("Descriptions")+"</span>\n      "}innerHTML+="</span>";var el=_MenuItem.prototype.createEl.call(this,type,assign({innerHTML:innerHTML},props),attrs);return el};_proto.handleClick=function(event){var tracks=this.player_.audioTracks();_MenuItem.prototype.handleClick.call(this,event);for(var i=0,track;i<tracks.length;i++){track=tracks[i];track.enabled=track===this.track}};_proto.handleTracksChange=function(){this.selected(this.track.enabled)};return AudioTrackMenuItem}(MenuItem);Component.registerComponent("AudioTrackMenuItem",AudioTrackMenuItem);var AudioTrackButton=function(_TrackButton){inheritsLoose(AudioTrackButton,_TrackButton);function AudioTrackButton(player,options){if(void 0===options){options={}}options.tracks=player.audioTracks();return _TrackButton.call(this,player,options)||this}var _proto=AudioTrackButton.prototype;_proto.buildCSSClass=function(){return"vjs-audio-button "+_TrackButton.prototype.buildCSSClass.call(this)};_proto.buildWrapperCSSClass=function(){return"vjs-audio-button "+_TrackButton.prototype.buildWrapperCSSClass.call(this)};_proto.createItems=function(items){if(void 0===items){items=[]}this.hideThreshold_=1;for(var tracks=this.player_.audioTracks(),i=0,track;i<tracks.length;i++){track=tracks[i];items.push(new AudioTrackMenuItem(this.player_,{track:track,selectable:!0,multiSelectable:!1}))}return items};return AudioTrackButton}(TrackButton);AudioTrackButton.prototype.controlText_="Audio Track";Component.registerComponent("AudioTrackButton",AudioTrackButton);var PlaybackRateMenuItem=function(_MenuItem){inheritsLoose(PlaybackRateMenuItem,_MenuItem);function PlaybackRateMenuItem(player,options){var _this,label=options.rate,rate=parseFloat(label,10);options.label=label;options.selected=1===rate;options.selectable=!0;options.multiSelectable=!1;_this=_MenuItem.call(this,player,options)||this;_this.label=label;_this.rate=rate;_this.on(player,"ratechange",_this.update);return _this}var _proto=PlaybackRateMenuItem.prototype;_proto.handleClick=function(){_MenuItem.prototype.handleClick.call(this);this.player().playbackRate(this.rate)};_proto.update=function(){this.selected(this.player().playbackRate()===this.rate)};return PlaybackRateMenuItem}(MenuItem);PlaybackRateMenuItem.prototype.contentElType="button";Component.registerComponent("PlaybackRateMenuItem",PlaybackRateMenuItem);var PlaybackRateMenuButton=function(_MenuButton){inheritsLoose(PlaybackRateMenuButton,_MenuButton);function PlaybackRateMenuButton(player,options){var _this=_MenuButton.call(this,player,options)||this;_this.updateVisibility();_this.updateLabel();_this.on(player,"loadstart",_this.updateVisibility);_this.on(player,"ratechange",_this.updateLabel);return _this}var _proto=PlaybackRateMenuButton.prototype;_proto.createEl=function(){var el=_MenuButton.prototype.createEl.call(this);this.labelEl_=createEl("div",{className:"vjs-playback-rate-value",innerHTML:"1x"});el.appendChild(this.labelEl_);return el};_proto.dispose=function(){this.labelEl_=null;_MenuButton.prototype.dispose.call(this)};_proto.buildCSSClass=function(){return"vjs-playback-rate "+_MenuButton.prototype.buildCSSClass.call(this)};_proto.buildWrapperCSSClass=function(){return"vjs-playback-rate "+_MenuButton.prototype.buildWrapperCSSClass.call(this)};_proto.createMenu=function(){var menu=new Menu(this.player()),rates=this.playbackRates();if(rates){for(var i=rates.length-1;0<=i;i--){menu.addChild(new PlaybackRateMenuItem(this.player(),{rate:rates[i]+"x"}))}}return menu};_proto.updateARIAAttributes=function(){this.el().setAttribute("aria-valuenow",this.player().playbackRate())};_proto.handleClick=function(){for(var currentRate=this.player().playbackRate(),rates=this.playbackRates(),newRate=rates[0],i=0;i<rates.length;i++){if(rates[i]>currentRate){newRate=rates[i];break}}this.player().playbackRate(newRate)};_proto.playbackRates=function(){return this.options_.playbackRates||this.options_.playerOptions&&this.options_.playerOptions.playbackRates};_proto.playbackRateSupported=function(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&0<this.playbackRates().length};_proto.updateVisibility=function(){if(this.playbackRateSupported()){this.removeClass("vjs-hidden")}else{this.addClass("vjs-hidden")}};_proto.updateLabel=function(){if(this.playbackRateSupported()){this.labelEl_.innerHTML=this.player().playbackRate()+"x"}};return PlaybackRateMenuButton}(MenuButton);PlaybackRateMenuButton.prototype.controlText_="Playback Rate";Component.registerComponent("PlaybackRateMenuButton",PlaybackRateMenuButton);var Spacer=function(_Component){inheritsLoose(Spacer,_Component);function Spacer(){return _Component.apply(this,arguments)||this}var _proto=Spacer.prototype;_proto.buildCSSClass=function(){return"vjs-spacer "+_Component.prototype.buildCSSClass.call(this)};_proto.createEl=function(){return _Component.prototype.createEl.call(this,"div",{className:this.buildCSSClass()})};return Spacer}(Component);Component.registerComponent("Spacer",Spacer);var CustomControlSpacer=function(_Spacer){inheritsLoose(CustomControlSpacer,_Spacer);function CustomControlSpacer(){return _Spacer.apply(this,arguments)||this}var _proto=CustomControlSpacer.prototype;_proto.buildCSSClass=function(){return"vjs-custom-control-spacer "+_Spacer.prototype.buildCSSClass.call(this)};_proto.createEl=function(){var el=_Spacer.prototype.createEl.call(this,{className:this.buildCSSClass()});el.innerHTML="\xA0";return el};return CustomControlSpacer}(Spacer);Component.registerComponent("CustomControlSpacer",CustomControlSpacer);var ControlBar=function(_Component){inheritsLoose(ControlBar,_Component);function ControlBar(){return _Component.apply(this,arguments)||this}var _proto=ControlBar.prototype;_proto.createEl=function(){return _Component.prototype.createEl.call(this,"div",{className:"vjs-control-bar",dir:"ltr"})};return ControlBar}(Component);ControlBar.prototype.options_={children:["playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","fullscreenToggle"]};if("exitPictureInPicture"in document){ControlBar.prototype.options_.children.splice(ControlBar.prototype.options_.children.length-1,0,"pictureInPictureToggle")}Component.registerComponent("ControlBar",ControlBar);var ErrorDisplay=function(_ModalDialog){inheritsLoose(ErrorDisplay,_ModalDialog);function ErrorDisplay(player,options){var _this=_ModalDialog.call(this,player,options)||this;_this.on(player,"error",_this.open);return _this}var _proto=ErrorDisplay.prototype;_proto.buildCSSClass=function(){return"vjs-error-display "+_ModalDialog.prototype.buildCSSClass.call(this)};_proto.content=function(){var error=this.player().error();return error?this.localize(error.message):""};return ErrorDisplay}(ModalDialog);ErrorDisplay.prototype.options_=_extends_1({},ModalDialog.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0});Component.registerComponent("ErrorDisplay",ErrorDisplay);var COLOR_BLACK=["#000","Black"],COLOR_BLUE=["#00F","Blue"],COLOR_CYAN=["#0FF","Cyan"],COLOR_GREEN=["#0F0","Green"],COLOR_MAGENTA=["#F0F","Magenta"],COLOR_RED=["#F00","Red"],COLOR_WHITE=["#FFF","White"],COLOR_YELLOW=["#FF0","Yellow"],OPACITY_OPAQUE=["1","Opaque"],OPACITY_SEMI=["0.5","Semi-Transparent"],OPACITY_TRANS=["0","Transparent"],selectConfigs={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[COLOR_BLACK,COLOR_WHITE,COLOR_RED,COLOR_GREEN,COLOR_BLUE,COLOR_YELLOW,COLOR_MAGENTA,COLOR_CYAN]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Transparency",options:[OPACITY_OPAQUE,OPACITY_SEMI,OPACITY_TRANS]},color:{selector:".vjs-fg-color > select",id:"captions-foreground-color-%s",label:"Color",options:[COLOR_WHITE,COLOR_BLACK,COLOR_RED,COLOR_GREEN,COLOR_BLUE,COLOR_YELLOW,COLOR_MAGENTA,COLOR_CYAN]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Dropshadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:function(v){return"1.00"===v?null:+v}},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Transparency",options:[OPACITY_OPAQUE,OPACITY_SEMI]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Transparency",options:[OPACITY_TRANS,OPACITY_SEMI,OPACITY_OPAQUE]}};selectConfigs.windowColor.options=selectConfigs.backgroundColor.options;function parseOptionValue(value,parser){if(parser){value=parser(value)}if(value&&"none"!==value){return value}}function getSelectedOptionValue(el,parser){var value=el.options[el.options.selectedIndex].value;return parseOptionValue(value,parser)}function setSelectedOption(el,value,parser){if(!value){return}for(var i=0;i<el.options.length;i++){if(parseOptionValue(el.options[i].value,parser)===value){el.selectedIndex=i;break}}}var TextTrackSettings=function(_ModalDialog){inheritsLoose(TextTrackSettings,_ModalDialog);function TextTrackSettings(player,options){var _this;options.temporary=!1;_this=_ModalDialog.call(this,player,options)||this;_this.updateDisplay=bind(assertThisInitialized(_this),_this.updateDisplay);_this.fill();_this.hasBeenOpened_=_this.hasBeenFilled_=!0;_this.endDialog=createEl("p",{className:"vjs-control-text",textContent:_this.localize("End of dialog window.")});_this.el().appendChild(_this.endDialog);_this.setDefaults();if(options.persistTextTrackSettings===void 0){_this.options_.persistTextTrackSettings=_this.options_.playerOptions.persistTextTrackSettings}_this.on(_this.$(".vjs-done-button"),"click",function(){_this.saveSettings();_this.close()});_this.on(_this.$(".vjs-default-button"),"click",function(){_this.setDefaults();_this.updateDisplay()});each(selectConfigs,function(config){_this.on(_this.$(config.selector),"change",_this.updateDisplay)});if(_this.options_.persistTextTrackSettings){_this.restoreSettings()}return _this}var _proto=TextTrackSettings.prototype;_proto.dispose=function(){this.endDialog=null;_ModalDialog.prototype.dispose.call(this)};_proto.createElSelect_=function(key,legendId,type){var _this2=this;if(void 0===legendId){legendId=""}if(void 0===type){type="label"}var config=selectConfigs[key],id=config.id.replace("%s",this.id_),selectLabelledbyIds=[legendId,id].join(" ").trim();return["<"+type+" id=\""+id+"\" class=\""+("label"===type?"vjs-label":"")+"\">",this.localize(config.label),"</"+type+">","<select aria-labelledby=\""+selectLabelledbyIds+"\">"].concat(config.options.map(function(o){var optionId=id+"-"+o[1].replace(/\W+/g,"");return["<option id=\""+optionId+"\" value=\""+o[0]+"\" ","aria-labelledby=\""+selectLabelledbyIds+" "+optionId+"\">",_this2.localize(o[1]),"</option>"].join("")})).concat("</select>").join("")};_proto.createElFgColor_=function(){var legendId="captions-text-legend-"+this.id_;return["<fieldset class=\"vjs-fg-color vjs-track-setting\">","<legend id=\""+legendId+"\">",this.localize("Text"),"</legend>",this.createElSelect_("color",legendId),"<span class=\"vjs-text-opacity vjs-opacity\">",this.createElSelect_("textOpacity",legendId),"</span>","</fieldset>"].join("")};_proto.createElBgColor_=function(){var legendId="captions-background-"+this.id_;return["<fieldset class=\"vjs-bg-color vjs-track-setting\">","<legend id=\""+legendId+"\">",this.localize("Background"),"</legend>",this.createElSelect_("backgroundColor",legendId),"<span class=\"vjs-bg-opacity vjs-opacity\">",this.createElSelect_("backgroundOpacity",legendId),"</span>","</fieldset>"].join("")};_proto.createElWinColor_=function(){var legendId="captions-window-"+this.id_;return["<fieldset class=\"vjs-window-color vjs-track-setting\">","<legend id=\""+legendId+"\">",this.localize("Window"),"</legend>",this.createElSelect_("windowColor",legendId),"<span class=\"vjs-window-opacity vjs-opacity\">",this.createElSelect_("windowOpacity",legendId),"</span>","</fieldset>"].join("")};_proto.createElColors_=function(){return createEl("div",{className:"vjs-track-settings-colors",innerHTML:[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()].join("")})};_proto.createElFont_=function(){return createEl("div",{className:"vjs-track-settings-font",innerHTML:["<fieldset class=\"vjs-font-percent vjs-track-setting\">",this.createElSelect_("fontPercent","","legend"),"</fieldset>","<fieldset class=\"vjs-edge-style vjs-track-setting\">",this.createElSelect_("edgeStyle","","legend"),"</fieldset>","<fieldset class=\"vjs-font-family vjs-track-setting\">",this.createElSelect_("fontFamily","","legend"),"</fieldset>"].join("")})};_proto.createElControls_=function(){var defaultsDescription=this.localize("restore all settings to the default values");return createEl("div",{className:"vjs-track-settings-controls",innerHTML:["<button type=\"button\" class=\"vjs-default-button\" title=\""+defaultsDescription+"\">",this.localize("Reset"),"<span class=\"vjs-control-text\"> "+defaultsDescription+"</span>","</button>","<button type=\"button\" class=\"vjs-done-button\">"+this.localize("Done")+"</button>"].join("")})};_proto.content=function(){return[this.createElColors_(),this.createElFont_(),this.createElControls_()]};_proto.label=function(){return this.localize("Caption Settings Dialog")};_proto.description=function(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")};_proto.buildCSSClass=function(){return _ModalDialog.prototype.buildCSSClass.call(this)+" vjs-text-track-settings"};_proto.getValues=function(){var _this3=this;return reduce(selectConfigs,function(accum,config,key){var value=getSelectedOptionValue(_this3.$(config.selector),config.parser);if(value!==void 0){accum[key]=value}return accum},{})};_proto.setValues=function(values){var _this4=this;each(selectConfigs,function(config,key){setSelectedOption(_this4.$(config.selector),values[key],config.parser)})};_proto.setDefaults=function(){var _this5=this;each(selectConfigs,function(config){var index=config.hasOwnProperty("default")?config["default"]:0;_this5.$(config.selector).selectedIndex=index})};_proto.restoreSettings=function(){var values;try{values=JSON.parse(window$3.localStorage.getItem("vjs-text-track-settings"))}catch(err){log.warn(err)}if(values){this.setValues(values)}};_proto.saveSettings=function(){if(!this.options_.persistTextTrackSettings){return}var values=this.getValues();try{if(Object.keys(values).length){window$3.localStorage.setItem("vjs-text-track-settings",JSON.stringify(values))}else{window$3.localStorage.removeItem("vjs-text-track-settings")}}catch(err){log.warn(err)}};_proto.updateDisplay=function(){var ttDisplay=this.player_.getChild("textTrackDisplay");if(ttDisplay){ttDisplay.updateDisplay()}};_proto.conditionalBlur_=function(){this.previouslyActiveEl_=null;var cb=this.player_.controlBar,subsCapsBtn=cb&&cb.subsCapsButton,ccBtn=cb&&cb.captionsButton;if(subsCapsBtn){subsCapsBtn.focus()}else if(ccBtn){ccBtn.focus()}};return TextTrackSettings}(ModalDialog);Component.registerComponent("TextTrackSettings",TextTrackSettings);var ResizeManager=function(_Component){inheritsLoose(ResizeManager,_Component);function ResizeManager(player,options){var _this,RESIZE_OBSERVER_AVAILABLE=options.ResizeObserver||window$3.ResizeObserver;if(null===options.ResizeObserver){RESIZE_OBSERVER_AVAILABLE=!1}var options_=mergeOptions({createEl:!RESIZE_OBSERVER_AVAILABLE,reportTouchActivity:!1},options);_this=_Component.call(this,player,options_)||this;_this.ResizeObserver=options.ResizeObserver||window$3.ResizeObserver;_this.loadListener_=null;_this.resizeObserver_=null;_this.debouncedHandler_=debounce(function(){_this.resizeHandler()},100,!1,assertThisInitialized(_this));if(RESIZE_OBSERVER_AVAILABLE){_this.resizeObserver_=new _this.ResizeObserver(_this.debouncedHandler_);_this.resizeObserver_.observe(player.el())}else{_this.loadListener_=function(){if(!_this.el_||!_this.el_.contentWindow){return}var debouncedHandler_=_this.debouncedHandler_,unloadListener_=_this.unloadListener_=function(){off(this,"resize",debouncedHandler_);off(this,"unload",unloadListener_);unloadListener_=null};on(_this.el_.contentWindow,"unload",unloadListener_);on(_this.el_.contentWindow,"resize",debouncedHandler_)};_this.one("load",_this.loadListener_)}return _this}var _proto=ResizeManager.prototype;_proto.createEl=function(){return _Component.prototype.createEl.call(this,"iframe",{className:"vjs-resize-manager",tabIndex:-1},{"aria-hidden":"true"})};_proto.resizeHandler=function(){if(!this.player_||!this.player_.trigger){return}this.player_.trigger("playerresize")};_proto.dispose=function(){if(this.debouncedHandler_){this.debouncedHandler_.cancel()}if(this.resizeObserver_){if(this.player_.el()){this.resizeObserver_.unobserve(this.player_.el())}this.resizeObserver_.disconnect()}if(this.loadListener_){this.off("load",this.loadListener_)}if(this.el_&&this.el_.contentWindow&&this.unloadListener_){this.unloadListener_.call(this.el_.contentWindow)}this.ResizeObserver=null;this.resizeObserver=null;this.debouncedHandler_=null;this.loadListener_=null;_Component.prototype.dispose.call(this)};return ResizeManager}(Component);Component.registerComponent("ResizeManager",ResizeManager);var defaults={trackingThreshold:30,liveTolerance:15},LiveTracker=function(_Component){inheritsLoose(LiveTracker,_Component);function LiveTracker(player,options){var _this,options_=mergeOptions(defaults,options,{createEl:!1});_this=_Component.call(this,player,options_)||this;_this.reset_();_this.on(_this.player_,"durationchange",_this.handleDurationchange);if(IE_VERSION&&"hidden"in document&&"visibilityState"in document){_this.on(document,"visibilitychange",_this.handleVisibilityChange)}return _this}var _proto=LiveTracker.prototype;_proto.handleVisibilityChange=function(){if(this.player_.duration()!==1/0){return}if(document.hidden){this.stopTracking()}else{this.startTracking()}};_proto.trackLive_=function(){var seekable=this.player_.seekable();if(!seekable||!seekable.length){return}var newTime=+window$3.performance.now().toFixed(4),deltaTime=-1===this.lastTime_?0:(newTime-this.lastTime_)/1e3;this.lastTime_=newTime;this.pastSeekEnd_=this.pastSeekEnd()+deltaTime;var liveCurrentTime=this.liveCurrentTime(),currentTime=this.player_.currentTime(),isBehind=this.player_.paused()||this.seekedBehindLive_||Math.abs(liveCurrentTime-currentTime)>this.options_.liveTolerance;if(!this.timeupdateSeen_||liveCurrentTime===1/0){isBehind=!1}if(isBehind!==this.behindLiveEdge_){this.behindLiveEdge_=isBehind;this.trigger("liveedgechange")}};_proto.handleDurationchange=function(){if(this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold){if(this.player_.options_.liveui){this.player_.addClass("vjs-liveui")}this.startTracking()}else{this.player_.removeClass("vjs-liveui");this.stopTracking()}};_proto.startTracking=function(){if(this.isTracking()){return}if(!this.timeupdateSeen_){this.timeupdateSeen_=this.player_.hasStarted()}this.trackingInterval_=this.setInterval(this.trackLive_,UPDATE_REFRESH_INTERVAL);this.trackLive_();this.on(this.player_,["play","pause"],this.trackLive_);if(!this.timeupdateSeen_){this.one(this.player_,"play",this.handlePlay);this.one(this.player_,"timeupdate",this.handleFirstTimeupdate)}else{this.on(this.player_,"seeked",this.handleSeeked)}};_proto.handleFirstTimeupdate=function(){this.timeupdateSeen_=!0;this.on(this.player_,"seeked",this.handleSeeked)};_proto.handleSeeked=function(){var timeDiff=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.skipNextSeeked_?!1:2<timeDiff;this.skipNextSeeked_=!1;this.trackLive_()};_proto.handlePlay=function(){this.one(this.player_,"timeupdate",this.seekToLiveEdge)};_proto.reset_=function(){this.lastTime_=-1;this.pastSeekEnd_=0;this.lastSeekEnd_=-1;this.behindLiveEdge_=!0;this.timeupdateSeen_=!1;this.seekedBehindLive_=!1;this.skipNextSeeked_=!1;this.clearInterval(this.trackingInterval_);this.trackingInterval_=null;this.off(this.player_,["play","pause"],this.trackLive_);this.off(this.player_,"seeked",this.handleSeeked);this.off(this.player_,"play",this.handlePlay);this.off(this.player_,"timeupdate",this.handleFirstTimeupdate);this.off(this.player_,"timeupdate",this.seekToLiveEdge)};_proto.stopTracking=function(){if(!this.isTracking()){return}this.reset_();this.trigger("liveedgechange")};_proto.seekableEnd=function(){var seekable=this.player_.seekable(),seekableEnds=[],i=seekable?seekable.length:0;while(i--){seekableEnds.push(seekable.end(i))}return seekableEnds.length?seekableEnds.sort()[seekableEnds.length-1]:1/0};_proto.seekableStart=function(){var seekable=this.player_.seekable(),seekableStarts=[],i=seekable?seekable.length:0;while(i--){seekableStarts.push(seekable.start(i))}return seekableStarts.length?seekableStarts.sort()[0]:0};_proto.liveWindow=function(){var liveCurrentTime=this.liveCurrentTime();if(liveCurrentTime===1/0){return 1/0}return liveCurrentTime-this.seekableStart()};_proto.isLive=function(){return this.isTracking()};_proto.atLiveEdge=function(){return!this.behindLiveEdge()};_proto.liveCurrentTime=function(){return this.pastSeekEnd()+this.seekableEnd()};_proto.pastSeekEnd=function(){var seekableEnd=this.seekableEnd();if(-1!==this.lastSeekEnd_&&seekableEnd!==this.lastSeekEnd_){this.pastSeekEnd_=0}this.lastSeekEnd_=seekableEnd;return this.pastSeekEnd_};_proto.behindLiveEdge=function(){return this.behindLiveEdge_};_proto.isTracking=function(){return"number"==typeof this.trackingInterval_};_proto.seekToLiveEdge=function(){this.seekedBehindLive_=!1;if(this.atLiveEdge()){return}this.skipNextSeeked_=!0;this.player_.currentTime(this.liveCurrentTime())};_proto.dispose=function(){this.off(document,"visibilitychange",this.handleVisibilityChange);this.stopTracking();_Component.prototype.dispose.call(this)};return LiveTracker}(Component);Component.registerComponent("LiveTracker",LiveTracker);var sourcesetLoad=function(tech){var el=tech.el();if(el.hasAttribute("src")){tech.triggerSourceset(el.src);return!0}var sources=tech.$$("source"),srcUrls=[],src="";if(!sources.length){return!1}for(var i=0,url;i<sources.length;i++){url=sources[i].src;if(url&&-1===srcUrls.indexOf(url)){srcUrls.push(url)}}if(!srcUrls.length){return!1}if(1===srcUrls.length){src=srcUrls[0]}tech.triggerSourceset(src);return!0},innerHTMLDescriptorPolyfill=Object.defineProperty({},"innerHTML",{get:function(){return this.cloneNode(!0).innerHTML},set:function(v){var dummy=document.createElement(this.nodeName.toLowerCase());dummy.innerHTML=v;var docFrag=document.createDocumentFragment();while(dummy.childNodes.length){docFrag.appendChild(dummy.childNodes[0])}this.innerText="";window$3.Element.prototype.appendChild.call(this,docFrag);return this.innerHTML}}),getDescriptor=function(priority,prop){for(var descriptor={},i=0;i<priority.length;i++){descriptor=Object.getOwnPropertyDescriptor(priority[i],prop);if(descriptor&&descriptor.set&&descriptor.get){break}}descriptor.enumerable=!0;descriptor.configurable=!0;return descriptor},getInnerHTMLDescriptor=function(tech){return getDescriptor([tech.el(),window$3.HTMLMediaElement.prototype,window$3.Element.prototype,innerHTMLDescriptorPolyfill],"innerHTML")},firstSourceWatch=function(tech){var el=tech.el();if(el.resetSourceWatch_){return}var old={},innerDescriptor=getInnerHTMLDescriptor(tech),appendWrapper=function(appendFn){return function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}var retval=appendFn.apply(el,args);sourcesetLoad(tech);return retval}};["append","appendChild","insertAdjacentHTML"].forEach(function(k){if(!el[k]){return}old[k]=el[k];el[k]=appendWrapper(old[k])});Object.defineProperty(el,"innerHTML",mergeOptions(innerDescriptor,{set:appendWrapper(innerDescriptor.set)}));el.resetSourceWatch_=function(){el.resetSourceWatch_=null;Object.keys(old).forEach(function(k){el[k]=old[k]});Object.defineProperty(el,"innerHTML",innerDescriptor)};tech.one("sourceset",el.resetSourceWatch_)},srcDescriptorPolyfill=Object.defineProperty({},"src",{get:function(){if(this.hasAttribute("src")){return getAbsoluteURL(window$3.Element.prototype.getAttribute.call(this,"src"))}return""},set:function(v){window$3.Element.prototype.setAttribute.call(this,"src",v);return v}}),getSrcDescriptor=function(tech){return getDescriptor([tech.el(),window$3.HTMLMediaElement.prototype,srcDescriptorPolyfill],"src")},setupSourceset=function(tech){if(!tech.featuresSourceset){return}var el=tech.el();if(el.resetSourceset_){return}var srcDescriptor=getSrcDescriptor(tech),oldSetAttribute=el.setAttribute,oldLoad=el.load;Object.defineProperty(el,"src",mergeOptions(srcDescriptor,{set:function(v){var retval=srcDescriptor.set.call(el,v);tech.triggerSourceset(el.src);return retval}}));el.setAttribute=function(n,v){var retval=oldSetAttribute.call(el,n,v);if(/src/i.test(n)){tech.triggerSourceset(el.src)}return retval};el.load=function(){var retval=oldLoad.call(el);if(!sourcesetLoad(tech)){tech.triggerSourceset("");firstSourceWatch(tech)}return retval};if(el.currentSrc){tech.triggerSourceset(el.currentSrc)}else if(!sourcesetLoad(tech)){firstSourceWatch(tech)}el.resetSourceset_=function(){el.resetSourceset_=null;el.load=oldLoad;el.setAttribute=oldSetAttribute;Object.defineProperty(el,"src",srcDescriptor);if(el.resetSourceWatch_){el.resetSourceWatch_()}}},defineLazyProperty=function(obj,key,getValue,setter){if(void 0===setter){setter=!0}var set=function(value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,writable:!0})},options={configurable:!0,enumerable:!0,get:function(){var value=getValue();set(value);return value}};if(setter){options.set=set}return Object.defineProperty(obj,key,options)},Html5=function(_Tech){inheritsLoose(Html5,_Tech);function Html5(options,ready){var _this=_Tech.call(this,options,ready)||this;var source=options.source,crossoriginTracks=!1;if(source&&(_this.el_.currentSrc!==source.src||options.tag&&3===options.tag.initNetworkState_)){_this.setSource(source)}else{_this.handleLateInit_(_this.el_)}if(options.enableSourceset){_this.setupSourcesetHandling_()}if(_this.el_.hasChildNodes()){var nodes=_this.el_.childNodes,nodesLength=nodes.length,removeNodes=[];while(nodesLength--){var node=nodes[nodesLength],nodeName=node.nodeName.toLowerCase();if("track"===nodeName){if(!_this.featuresNativeTextTracks){removeNodes.push(node)}else{_this.remoteTextTrackEls().addTrackElement_(node);_this.remoteTextTracks().addTrack(node.track);_this.textTracks().addTrack(node.track);if(!crossoriginTracks&&!_this.el_.hasAttribute("crossorigin")&&isCrossOrigin(node.src)){crossoriginTracks=!0}}}}for(var i=0;i<removeNodes.length;i++){_this.el_.removeChild(removeNodes[i])}}_this.proxyNativeTracks_();if(_this.featuresNativeTextTracks&&crossoriginTracks){log.warn("Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\nThis may prevent text tracks from loading.")}_this.restoreMetadataTracksInIOSNativePlayer_();if((TOUCH_ENABLED||IS_IPHONE||IS_NATIVE_ANDROID)&&!0===options.nativeControlsForTouch){_this.setControls(!0)}_this.proxyWebkitFullscreen_();_this.triggerReady();return _this}var _proto=Html5.prototype;_proto.dispose=function(){if(this.el_&&this.el_.resetSourceset_){this.el_.resetSourceset_()}Html5.disposeMediaElement(this.el_);this.options_=null;_Tech.prototype.dispose.call(this)};_proto.setupSourcesetHandling_=function(){setupSourceset(this)};_proto.restoreMetadataTracksInIOSNativePlayer_=function(){var textTracks=this.textTracks(),metadataTracksPreFullscreenState,takeMetadataTrackSnapshot=function(){metadataTracksPreFullscreenState=[];for(var i=0,track;i<textTracks.length;i++){track=textTracks[i];if("metadata"===track.kind){metadataTracksPreFullscreenState.push({track:track,storedMode:track.mode})}}};takeMetadataTrackSnapshot();textTracks.addEventListener("change",takeMetadataTrackSnapshot);this.on("dispose",function(){return textTracks.removeEventListener("change",takeMetadataTrackSnapshot)});var restoreTrackMode=function restoreTrackMode(){for(var i=0,storedTrack;i<metadataTracksPreFullscreenState.length;i++){storedTrack=metadataTracksPreFullscreenState[i];if("disabled"===storedTrack.track.mode&&storedTrack.track.mode!==storedTrack.storedMode){storedTrack.track.mode=storedTrack.storedMode}}textTracks.removeEventListener("change",restoreTrackMode)};this.on("webkitbeginfullscreen",function(){textTracks.removeEventListener("change",takeMetadataTrackSnapshot);textTracks.removeEventListener("change",restoreTrackMode);textTracks.addEventListener("change",restoreTrackMode)});this.on("webkitendfullscreen",function(){textTracks.removeEventListener("change",takeMetadataTrackSnapshot);textTracks.addEventListener("change",takeMetadataTrackSnapshot);textTracks.removeEventListener("change",restoreTrackMode)})};_proto.overrideNative_=function(type,override){var _this2=this;if(override!==this["featuresNative"+type+"Tracks"]){return}var lowerCaseType=type.toLowerCase();if(this[lowerCaseType+"TracksListeners_"]){Object.keys(this[lowerCaseType+"TracksListeners_"]).forEach(function(eventName){var elTracks=_this2.el()[lowerCaseType+"Tracks"];elTracks.removeEventListener(eventName,_this2[lowerCaseType+"TracksListeners_"][eventName])})}this["featuresNative"+type+"Tracks"]=!override;this[lowerCaseType+"TracksListeners_"]=null;this.proxyNativeTracksForType_(lowerCaseType)};_proto.overrideNativeAudioTracks=function(override){this.overrideNative_("Audio",override)};_proto.overrideNativeVideoTracks=function(override){this.overrideNative_("Video",override)};_proto.proxyNativeTracksForType_=function(name){var _this3=this,props=NORMAL[name],elTracks=this.el()[props.getterName],techTracks=this[props.getterName]();if(!this["featuresNative"+props.capitalName+"Tracks"]||!elTracks||!elTracks.addEventListener){return}var listeners={change:function(){var event={type:"change",target:techTracks,currentTarget:techTracks,srcElement:techTracks};techTracks.trigger(event);if("text"===name){_this3[REMOTE.remoteText.getterName]().trigger(event)}},addtrack:function(e){techTracks.addTrack(e.track)},removetrack:function(e){techTracks.removeTrack(e.track)}},removeOldTracks=function(){for(var removeTracks=[],i=0,found;i<techTracks.length;i++){found=!1;for(var j=0;j<elTracks.length;j++){if(elTracks[j]===techTracks[i]){found=!0;break}}if(!found){removeTracks.push(techTracks[i])}}while(removeTracks.length){techTracks.removeTrack(removeTracks.shift())}};this[props.getterName+"Listeners_"]=listeners;Object.keys(listeners).forEach(function(eventName){var listener=listeners[eventName];elTracks.addEventListener(eventName,listener);_this3.on("dispose",function(){return elTracks.removeEventListener(eventName,listener)})});this.on("loadstart",removeOldTracks);this.on("dispose",function(){return _this3.off("loadstart",removeOldTracks)})};_proto.proxyNativeTracks_=function(){var _this4=this;NORMAL.names.forEach(function(name){_this4.proxyNativeTracksForType_(name)})};_proto.createEl=function(){var el=this.options_.tag;if(!el||!(this.options_.playerElIngest||this.movingMediaElementInDOM)){if(el){var clone=el.cloneNode(!0);if(el.parentNode){el.parentNode.insertBefore(clone,el)}Html5.disposeMediaElement(el);el=clone}else{el=document.createElement("video");var tagAttributes=this.options_.tag&&getAttributes(this.options_.tag),attributes=mergeOptions({},tagAttributes);if(!TOUCH_ENABLED||!0!==this.options_.nativeControlsForTouch){delete attributes.controls}setAttributes(el,assign(attributes,{id:this.options_.techId,class:"vjs-tech"}))}el.playerId=this.options_.playerId}if("undefined"!=typeof this.options_.preload){setAttribute(el,"preload",this.options_.preload)}if(this.options_.disablePictureInPicture!==void 0){el.disablePictureInPicture=this.options_.disablePictureInPicture}for(var settingsAttrs=["loop","muted","playsinline","autoplay"],i=0;i<settingsAttrs.length;i++){var attr=settingsAttrs[i],value=this.options_[attr];if("undefined"!=typeof value){if(value){setAttribute(el,attr,attr)}else{removeAttribute(el,attr)}el[attr]=value}}return el};_proto.handleLateInit_=function(el){if(0===el.networkState||3===el.networkState){return}if(0===el.readyState){var loadstartFired=!1,setLoadstartFired=function(){loadstartFired=!0};this.on("loadstart",setLoadstartFired);var triggerLoadstart=function(){if(!loadstartFired){this.trigger("loadstart")}};this.on("loadedmetadata",triggerLoadstart);this.ready(function(){this.off("loadstart",setLoadstartFired);this.off("loadedmetadata",triggerLoadstart);if(!loadstartFired){this.trigger("loadstart")}});return}var eventsToTrigger=["loadstart","loadedmetadata"];if(2<=el.readyState){eventsToTrigger.push("loadeddata")}if(3<=el.readyState){eventsToTrigger.push("canplay")}if(4<=el.readyState){eventsToTrigger.push("canplaythrough")}this.ready(function(){eventsToTrigger.forEach(function(type){this.trigger(type)},this)})};_proto.setScrubbing=function(isScrubbing){this.isScrubbing_=isScrubbing};_proto.setCurrentTime=function(seconds){try{if(this.isScrubbing_&&this.el_.fastSeek&&IS_ANY_SAFARI){this.el_.fastSeek(seconds)}else{this.el_.currentTime=seconds}}catch(e){log(e,"Video is not ready. (Video.js)")}};_proto.duration=function(){var _this5=this;if(this.el_.duration===1/0&&IS_ANDROID&&IS_CHROME&&0===this.el_.currentTime){var checkProgress=function checkProgress(){if(0<_this5.el_.currentTime){if(_this5.el_.duration===1/0){_this5.trigger("durationchange")}_this5.off("timeupdate",checkProgress)}};this.on("timeupdate",checkProgress);return NaN}return this.el_.duration||NaN};_proto.width=function(){return this.el_.offsetWidth};_proto.height=function(){return this.el_.offsetHeight};_proto.proxyWebkitFullscreen_=function(){var _this6=this;if(!("webkitDisplayingFullscreen"in this.el_)){return}var endFn=function(){this.trigger("fullscreenchange",{isFullscreen:!1})},beginFn=function(){if("webkitPresentationMode"in this.el_&&"picture-in-picture"!==this.el_.webkitPresentationMode){this.one("webkitendfullscreen",endFn);this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0})}};this.on("webkitbeginfullscreen",beginFn);this.on("dispose",function(){_this6.off("webkitbeginfullscreen",beginFn);_this6.off("webkitendfullscreen",endFn)})};_proto.supportsFullScreen=function(){if("function"==typeof this.el_.webkitEnterFullScreen){var userAgent=window$3.navigator&&window$3.navigator.userAgent||"";if(/Android/.test(userAgent)||!/Chrome|Mac OS X 10.5/.test(userAgent)){return!0}}return!1};_proto.enterFullScreen=function(){var video=this.el_;if(video.paused&&video.networkState<=video.HAVE_METADATA){silencePromise(this.el_.play());this.setTimeout(function(){video.pause();try{video.webkitEnterFullScreen()}catch(e){this.trigger("fullscreenerror",e)}},0)}else{try{video.webkitEnterFullScreen()}catch(e){this.trigger("fullscreenerror",e)}}};_proto.exitFullScreen=function(){if(!this.el_.webkitDisplayingFullscreen){this.trigger("fullscreenerror",new Error("The video is not fullscreen"));return}this.el_.webkitExitFullScreen()};_proto.requestPictureInPicture=function(){return this.el_.requestPictureInPicture()};_proto.src=function(_src){if(_src===void 0){return this.el_.src}this.setSrc(_src)};_proto.reset=function(){Html5.resetMediaElement(this.el_)};_proto.currentSrc=function(){if(this.currentSource_){return this.currentSource_.src}return this.el_.currentSrc};_proto.setControls=function(val){this.el_.controls=!!val};_proto.addTextTrack=function(kind,label,language){if(!this.featuresNativeTextTracks){return _Tech.prototype.addTextTrack.call(this,kind,label,language)}return this.el_.addTextTrack(kind,label,language)};_proto.createRemoteTextTrack=function(options){if(!this.featuresNativeTextTracks){return _Tech.prototype.createRemoteTextTrack.call(this,options)}var htmlTrackElement=document.createElement("track");if(options.kind){htmlTrackElement.kind=options.kind}if(options.label){htmlTrackElement.label=options.label}if(options.language||options.srclang){htmlTrackElement.srclang=options.language||options.srclang}if(options["default"]){htmlTrackElement["default"]=options["default"]}if(options.id){htmlTrackElement.id=options.id}if(options.src){htmlTrackElement.src=options.src}return htmlTrackElement};_proto.addRemoteTextTrack=function(options,manualCleanup){var htmlTrackElement=_Tech.prototype.addRemoteTextTrack.call(this,options,manualCleanup);if(this.featuresNativeTextTracks){this.el().appendChild(htmlTrackElement)}return htmlTrackElement};_proto.removeRemoteTextTrack=function(track){_Tech.prototype.removeRemoteTextTrack.call(this,track);if(this.featuresNativeTextTracks){var tracks=this.$$("track"),i=tracks.length;while(i--){if(track===tracks[i]||track===tracks[i].track){this.el().removeChild(tracks[i])}}}};_proto.getVideoPlaybackQuality=function(){if("function"==typeof this.el().getVideoPlaybackQuality){return this.el().getVideoPlaybackQuality()}var videoPlaybackQuality={};if("undefined"!=typeof this.el().webkitDroppedFrameCount&&"undefined"!=typeof this.el().webkitDecodedFrameCount){videoPlaybackQuality.droppedVideoFrames=this.el().webkitDroppedFrameCount;videoPlaybackQuality.totalVideoFrames=this.el().webkitDecodedFrameCount}if(window$3.performance&&"function"==typeof window$3.performance.now){videoPlaybackQuality.creationTime=window$3.performance.now()}else if(window$3.performance&&window$3.performance.timing&&"number"==typeof window$3.performance.timing.navigationStart){videoPlaybackQuality.creationTime=window$3.Date.now()-window$3.performance.timing.navigationStart}return videoPlaybackQuality};return Html5}(Tech);defineLazyProperty(Html5,"TEST_VID",function(){if(!isReal()){return}var video=document.createElement("video"),track=document.createElement("track");track.kind="captions";track.srclang="en";track.label="English";video.appendChild(track);return video});Html5.isSupported=function(){try{Html5.TEST_VID.volume=.5}catch(e){return!1}return!!(Html5.TEST_VID&&Html5.TEST_VID.canPlayType)};Html5.canPlayType=function(type){return Html5.TEST_VID.canPlayType(type)};Html5.canPlaySource=function(srcObj){return Html5.canPlayType(srcObj.type)};Html5.canControlVolume=function(){try{var volume=Html5.TEST_VID.volume;Html5.TEST_VID.volume=volume/2+.1;return volume!==Html5.TEST_VID.volume}catch(e){return!1}};Html5.canMuteVolume=function(){try{var muted=Html5.TEST_VID.muted;Html5.TEST_VID.muted=!muted;if(Html5.TEST_VID.muted){setAttribute(Html5.TEST_VID,"muted","muted")}else{removeAttribute(Html5.TEST_VID,"muted","muted")}return muted!==Html5.TEST_VID.muted}catch(e){return!1}};Html5.canControlPlaybackRate=function(){if(IS_ANDROID&&IS_CHROME&&58>CHROME_VERSION){return!1}try{var playbackRate=Html5.TEST_VID.playbackRate;Html5.TEST_VID.playbackRate=playbackRate/2+.1;return playbackRate!==Html5.TEST_VID.playbackRate}catch(e){return!1}};Html5.canOverrideAttributes=function(){try{var noop=function(){};Object.defineProperty(document.createElement("video"),"src",{get:noop,set:noop});Object.defineProperty(document.createElement("audio"),"src",{get:noop,set:noop});Object.defineProperty(document.createElement("video"),"innerHTML",{get:noop,set:noop});Object.defineProperty(document.createElement("audio"),"innerHTML",{get:noop,set:noop})}catch(e){return!1}return!0};Html5.supportsNativeTextTracks=function(){return IS_ANY_SAFARI||IS_IOS&&IS_CHROME};Html5.supportsNativeVideoTracks=function(){return!!(Html5.TEST_VID&&Html5.TEST_VID.videoTracks)};Html5.supportsNativeAudioTracks=function(){return!!(Html5.TEST_VID&&Html5.TEST_VID.audioTracks)};Html5.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"];[["featuresVolumeControl","canControlVolume"],["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function(_ref){var key=_ref[0],fn=_ref[1];defineLazyProperty(Html5.prototype,key,function(){return Html5[fn]()},!0)});Html5.prototype.movingMediaElementInDOM=!IS_IOS;Html5.prototype.featuresFullscreenResize=!0;Html5.prototype.featuresProgressEvents=!0;Html5.prototype.featuresTimeupdateEvents=!0;var canPlayType;Html5.patchCanPlayType=function(){if(4<=ANDROID_VERSION&&!IS_FIREFOX&&!IS_CHROME){canPlayType=Html5.TEST_VID&&Html5.TEST_VID.constructor.prototype.canPlayType;Html5.TEST_VID.constructor.prototype.canPlayType=function(type){if(type&&/^application\/(?:x-|vnd\.apple\.)mpegurl/i.test(type)){return"maybe"}return canPlayType.call(this,type)}}};Html5.unpatchCanPlayType=function(){var r=Html5.TEST_VID.constructor.prototype.canPlayType;if(canPlayType){Html5.TEST_VID.constructor.prototype.canPlayType=canPlayType}return r};Html5.patchCanPlayType();Html5.disposeMediaElement=function(el){if(!el){return}if(el.parentNode){el.parentNode.removeChild(el)}while(el.hasChildNodes()){el.removeChild(el.firstChild)}el.removeAttribute("src");if("function"==typeof el.load){(function(){try{el.load()}catch(e){}})()}};Html5.resetMediaElement=function(el){if(!el){return}var sources=el.querySelectorAll("source"),i=sources.length;while(i--){el.removeChild(sources[i])}el.removeAttribute("src");if("function"==typeof el.load){(function(){try{el.load()}catch(e){}})()}};["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(prop){Html5.prototype[prop]=function(){return this.el_[prop]||this.el_.hasAttribute(prop)}});["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(prop){Html5.prototype["set"+toTitleCase(prop)]=function(v){this.el_[prop]=v;if(v){this.el_.setAttribute(prop,prop)}else{this.el_.removeAttribute(prop)}}});["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(prop){Html5.prototype[prop]=function(){return this.el_[prop]}});["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(prop){Html5.prototype["set"+toTitleCase(prop)]=function(v){this.el_[prop]=v}});["pause","load","play"].forEach(function(prop){Html5.prototype[prop]=function(){return this.el_[prop]()}});Tech.withSourceHandlers(Html5);Html5.nativeSourceHandler={};Html5.nativeSourceHandler.canPlayType=function(type){try{return Html5.TEST_VID.canPlayType(type)}catch(e){return""}};Html5.nativeSourceHandler.canHandleSource=function(source){if(source.type){return Html5.nativeSourceHandler.canPlayType(source.type)}else if(source.src){var ext=getFileExtension(source.src);return Html5.nativeSourceHandler.canPlayType("video/"+ext)}return""};Html5.nativeSourceHandler.handleSource=function(source,tech){tech.setSrc(source.src)};Html5.nativeSourceHandler.dispose=function(){};Html5.registerSourceHandler(Html5.nativeSourceHandler);Tech.registerTech("Html5",Html5);var TECH_EVENTS_RETRIGGER=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],TECH_EVENTS_QUEUE={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},BREAKPOINT_ORDER=["tiny","xsmall","small","medium","large","xlarge","huge"],BREAKPOINT_CLASSES={};BREAKPOINT_ORDER.forEach(function(k){var v="x"===k.charAt(0)?"x-"+k.substring(1):k;BREAKPOINT_CLASSES[k]="vjs-layout-"+v});var DEFAULT_BREAKPOINTS={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0},Player=function(_Component){inheritsLoose(Player,_Component);function Player(tag,options,ready){var _this;tag.id=tag.id||options.id||"vjs_video_"+newGUID();options=assign(Player.getTagSettings(tag),options);options.initChildren=!1;options.createEl=!1;options.evented=!1;options.reportTouchActivity=!1;if(!options.language){if("function"==typeof tag.closest){var closest=tag.closest("[lang]");if(closest&&closest.getAttribute){options.language=closest.getAttribute("lang")}}else{var element=tag;while(element&&1===element.nodeType){if(getAttributes(element).hasOwnProperty("lang")){options.language=element.getAttribute("lang");break}element=element.parentNode}}}_this=_Component.call(this,null,options,ready)||this;_this.boundDocumentFullscreenChange_=bind(assertThisInitialized(_this),_this.documentFullscreenChange_);_this.boundFullWindowOnEscKey_=bind(assertThisInitialized(_this),_this.fullWindowOnEscKey);_this.isFullscreen_=!1;_this.log=createLogger$1(_this.id_);_this.fsApi_=FullscreenApi;_this.isPosterFromTech_=!1;_this.queuedCallbacks_=[];_this.isReady_=!1;_this.hasStarted_=!1;_this.userActive_=!1;_this.debugEnabled_=!1;if(!_this.options_||!_this.options_.techOrder||!_this.options_.techOrder.length){throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?")}_this.tag=tag;_this.tagAttributes=tag&&getAttributes(tag);_this.language(_this.options_.language);if(options.languages){var languagesToLower={};Object.getOwnPropertyNames(options.languages).forEach(function(name){languagesToLower[name.toLowerCase()]=options.languages[name]});_this.languages_=languagesToLower}else{_this.languages_=Player.prototype.options_.languages}_this.resetCache_();_this.poster_=options.poster||"";_this.controls_=!!options.controls;tag.controls=!1;tag.removeAttribute("controls");_this.changingSrc_=!1;_this.playCallbacks_=[];_this.playTerminatedQueue_=[];if(tag.hasAttribute("autoplay")){_this.autoplay(!0)}else{_this.autoplay(_this.options_.autoplay)}if(options.plugins){Object.keys(options.plugins).forEach(function(name){if("function"!=typeof _this[name]){throw new Error("plugin \""+name+"\" does not exist")}})}_this.scrubbing_=!1;_this.el_=_this.createEl();evented(assertThisInitialized(_this),{eventBusKey:"el_"});if(_this.fsApi_.requestFullscreen){on(document,_this.fsApi_.fullscreenchange,_this.boundDocumentFullscreenChange_);_this.on(_this.fsApi_.fullscreenchange,_this.boundDocumentFullscreenChange_)}if(_this.fluid_){_this.on("playerreset",_this.updateStyleEl_)}var playerOptionsCopy=mergeOptions(_this.options_);if(options.plugins){Object.keys(options.plugins).forEach(function(name){_this[name](options.plugins[name])})}if(options.debug){_this.debug(!0)}_this.options_.playerOptions=playerOptionsCopy;_this.middleware_=[];_this.initChildren();_this.isAudio("audio"===tag.nodeName.toLowerCase());if(_this.controls()){_this.addClass("vjs-controls-enabled")}else{_this.addClass("vjs-controls-disabled")}_this.el_.setAttribute("role","region");if(_this.isAudio()){_this.el_.setAttribute("aria-label",_this.localize("Audio Player"))}else{_this.el_.setAttribute("aria-label",_this.localize("Video Player"))}if(_this.isAudio()){_this.addClass("vjs-audio")}if(_this.flexNotSupported_()){_this.addClass("vjs-no-flex")}if(TOUCH_ENABLED){_this.addClass("vjs-touch-enabled")}if(!IS_IOS){_this.addClass("vjs-workinghover")}Player.players[_this.id_]=assertThisInitialized(_this);var majorVersion="7.10.0".split(".")[0];_this.addClass("vjs-v"+majorVersion);_this.userActive(!0);_this.reportUserActivity();_this.one("play",_this.listenForUserActivity_);_this.on("stageclick",_this.handleStageClick_);_this.on("keydown",_this.handleKeyDown);_this.breakpoints(_this.options_.breakpoints);_this.responsive(_this.options_.responsive);return _this}var _proto=Player.prototype;_proto.dispose=function(){var _this2=this;this.trigger("dispose");this.off("dispose");off(document,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_);off(document,"keydown",this.boundFullWindowOnEscKey_);if(this.styleEl_&&this.styleEl_.parentNode){this.styleEl_.parentNode.removeChild(this.styleEl_);this.styleEl_=null}Player.players[this.id_]=null;if(this.tag&&this.tag.player){this.tag.player=null}if(this.el_&&this.el_.player){this.el_.player=null}if(this.tech_){this.tech_.dispose();this.isPosterFromTech_=!1;this.poster_=""}if(this.playerElIngest_){this.playerElIngest_=null}if(this.tag){this.tag=null}clearCacheForPlayer(this);ALL.names.forEach(function(name){var props=ALL[name],list=_this2[props.getterName]();if(list&&list.off){list.off()}});_Component.prototype.dispose.call(this)};_proto.createEl=function(){var tag=this.tag,el,playerElIngest=this.playerElIngest_=tag.parentNode&&tag.parentNode.hasAttribute&&tag.parentNode.hasAttribute("data-vjs-player"),divEmbed="video-js"===this.tag.tagName.toLowerCase();if(playerElIngest){el=this.el_=tag.parentNode}else if(!divEmbed){el=this.el_=_Component.prototype.createEl.call(this,"div")}var attrs=getAttributes(tag);if(divEmbed){el=this.el_=tag;tag=this.tag=document.createElement("video");while(el.children.length){tag.appendChild(el.firstChild)}if(!hasClass(el,"video-js")){addClass(el,"video-js")}el.appendChild(tag);playerElIngest=this.playerElIngest_=el;Object.keys(el).forEach(function(k){try{tag[k]=el[k]}catch(e){}})}tag.setAttribute("tabindex","-1");attrs.tabindex="-1";if(IE_VERSION||IS_CHROME&&IS_WINDOWS){tag.setAttribute("role","application");attrs.role="application"}tag.removeAttribute("width");tag.removeAttribute("height");if("width"in attrs){delete attrs.width}if("height"in attrs){delete attrs.height}Object.getOwnPropertyNames(attrs).forEach(function(attr){if(!(divEmbed&&"class"===attr)){el.setAttribute(attr,attrs[attr])}if(divEmbed){tag.setAttribute(attr,attrs[attr])}});tag.playerId=tag.id;tag.id+="_html5_api";tag.className="vjs-tech";tag.player=el.player=this;this.addClass("vjs-paused");if(!0!==window$3.VIDEOJS_NO_DYNAMIC_STYLE){this.styleEl_=createStyleElement("vjs-styles-dimensions");var defaultsStyleEl=$(".vjs-styles-defaults"),head=$("head");head.insertBefore(this.styleEl_,defaultsStyleEl?defaultsStyleEl.nextSibling:head.firstChild)}this.fill_=!1;this.fluid_=!1;this.width(this.options_.width);this.height(this.options_.height);this.fill(this.options_.fill);this.fluid(this.options_.fluid);this.aspectRatio(this.options_.aspectRatio);this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);for(var links=tag.getElementsByTagName("a"),i=0,linkEl;i<links.length;i++){linkEl=links.item(i);addClass(linkEl,"vjs-hidden");linkEl.setAttribute("hidden","hidden")}tag.initNetworkState_=tag.networkState;if(tag.parentNode&&!playerElIngest){tag.parentNode.insertBefore(el,tag)}prependTo(tag,el);this.children_.unshift(tag);this.el_.setAttribute("lang",this.language_);this.el_=el;return el};_proto.crossOrigin=function(value){if(!value){return this.techGet_("crossOrigin")}if("anonymous"!==value&&"use-credentials"!==value){log.warn("crossOrigin must be \"anonymous\" or \"use-credentials\", given \""+value+"\"");return}this.techCall_("setCrossOrigin",value)};_proto.width=function(value){return this.dimension("width",value)};_proto.height=function(value){return this.dimension("height",value)};_proto.dimension=function(_dimension,value){var privDimension=_dimension+"_";if(value===void 0){return this[privDimension]||0}if(""===value||"auto"===value){this[privDimension]=void 0;this.updateStyleEl_();return}var parsedVal=parseFloat(value);if(isNaN(parsedVal)){log.error("Improper value \""+value+"\" supplied for for "+_dimension);return}this[privDimension]=parsedVal;this.updateStyleEl_()};_proto.fluid=function(bool){if(bool===void 0){return!!this.fluid_}this.fluid_=!!bool;if(isEvented(this)){this.off("playerreset",this.updateStyleEl_)}if(bool){this.addClass("vjs-fluid");this.fill(!1);addEventedCallback(function(){this.on("playerreset",this.updateStyleEl_)})}else{this.removeClass("vjs-fluid")}this.updateStyleEl_()};_proto.fill=function(bool){if(bool===void 0){return!!this.fill_}this.fill_=!!bool;if(bool){this.addClass("vjs-fill");this.fluid(!1)}else{this.removeClass("vjs-fill")}};_proto.aspectRatio=function(ratio){if(ratio===void 0){return this.aspectRatio_}if(!/^\d+\:\d+$/.test(ratio)){throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.")}this.aspectRatio_=ratio;this.fluid(!0);this.updateStyleEl_()};_proto.updateStyleEl_=function(){if(!0===window$3.VIDEOJS_NO_DYNAMIC_STYLE){var _width="number"==typeof this.width_?this.width_:this.options_.width,_height="number"==typeof this.height_?this.height_:this.options_.height,techEl=this.tech_&&this.tech_.el();if(techEl){if(0<=_width){techEl.width=_width}if(0<=_height){techEl.height=_height}}return}var width,height,aspectRatio,idClass;if(this.aspectRatio_!==void 0&&"auto"!==this.aspectRatio_){aspectRatio=this.aspectRatio_}else if(0<this.videoWidth()){aspectRatio=this.videoWidth()+":"+this.videoHeight()}else{aspectRatio="16:9"}var ratioParts=aspectRatio.split(":"),ratioMultiplier=ratioParts[1]/ratioParts[0];if(this.width_!==void 0){width=this.width_}else if(this.height_!==void 0){width=this.height_/ratioMultiplier}else{width=this.videoWidth()||300}if(this.height_!==void 0){height=this.height_}else{height=width*ratioMultiplier}if(/^[^a-zA-Z]/.test(this.id())){idClass="dimensions-"+this.id()}else{idClass=this.id()+"-dimensions"}this.addClass(idClass);setTextContent(this.styleEl_,"\n      ."+idClass+" {\n        width: "+width+"px;\n        height: "+height+"px;\n      }\n\n      ."+idClass+".vjs-fluid {\n        padding-top: "+100*ratioMultiplier+"%;\n      }\n    ")};_proto.loadTech_=function(techName,source){var _this3=this;if(this.tech_){this.unloadTech_()}var titleTechName=toTitleCase(techName),camelTechName=techName.charAt(0).toLowerCase()+techName.slice(1);if("Html5"!==titleTechName&&this.tag){Tech.getTech("Html5").disposeMediaElement(this.tag);this.tag.player=null;this.tag=null}this.techName_=titleTechName;this.isReady_=!1;var autoplay="string"==typeof this.autoplay()?!1:this.autoplay(),techOptions={source:source,autoplay:autoplay,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:this.id()+"_"+camelTechName+"_api",playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset,Promise:this.options_.Promise};ALL.names.forEach(function(name){var props=ALL[name];techOptions[props.getterName]=_this3[props.privateName]});assign(techOptions,this.options_[titleTechName]);assign(techOptions,this.options_[camelTechName]);assign(techOptions,this.options_[techName.toLowerCase()]);if(this.tag){techOptions.tag=this.tag}if(source&&source.src===this.cache_.src&&0<this.cache_.currentTime){techOptions.startTime=this.cache_.currentTime}var TechClass=Tech.getTech(techName);if(!TechClass){throw new Error("No Tech named '"+titleTechName+"' exists! '"+titleTechName+"' should be registered using videojs.registerTech()'")}this.tech_=new TechClass(techOptions);this.tech_.ready(bind(this,this.handleTechReady_),!0);textTrackConverter.jsonToTextTracks(this.textTracksJson_||[],this.tech_);TECH_EVENTS_RETRIGGER.forEach(function(event){_this3.on(_this3.tech_,event,_this3["handleTech"+toTitleCase(event)+"_"])});Object.keys(TECH_EVENTS_QUEUE).forEach(function(event){_this3.on(_this3.tech_,event,function(eventObj){if(0===_this3.tech_.playbackRate()&&_this3.tech_.seeking()){_this3.queuedCallbacks_.push({callback:_this3["handleTech"+TECH_EVENTS_QUEUE[event]+"_"].bind(_this3),event:eventObj});return}_this3["handleTech"+TECH_EVENTS_QUEUE[event]+"_"](eventObj)})});this.on(this.tech_,"loadstart",this.handleTechLoadStart_);this.on(this.tech_,"sourceset",this.handleTechSourceset_);this.on(this.tech_,"waiting",this.handleTechWaiting_);this.on(this.tech_,"ended",this.handleTechEnded_);this.on(this.tech_,"seeking",this.handleTechSeeking_);this.on(this.tech_,"play",this.handleTechPlay_);this.on(this.tech_,"firstplay",this.handleTechFirstPlay_);this.on(this.tech_,"pause",this.handleTechPause_);this.on(this.tech_,"durationchange",this.handleTechDurationChange_);this.on(this.tech_,"fullscreenchange",this.handleTechFullscreenChange_);this.on(this.tech_,"fullscreenerror",this.handleTechFullscreenError_);this.on(this.tech_,"enterpictureinpicture",this.handleTechEnterPictureInPicture_);this.on(this.tech_,"leavepictureinpicture",this.handleTechLeavePictureInPicture_);this.on(this.tech_,"error",this.handleTechError_);this.on(this.tech_,"loadedmetadata",this.updateStyleEl_);this.on(this.tech_,"posterchange",this.handleTechPosterChange_);this.on(this.tech_,"textdata",this.handleTechTextData_);this.on(this.tech_,"ratechange",this.handleTechRateChange_);this.usingNativeControls(this.techGet_("controls"));if(this.controls()&&!this.usingNativeControls()){this.addTechControlsListeners_()}if(this.tech_.el().parentNode!==this.el()&&("Html5"!==titleTechName||!this.tag)){prependTo(this.tech_.el(),this.el())}if(this.tag){this.tag.player=null;this.tag=null}};_proto.unloadTech_=function(){var _this4=this;ALL.names.forEach(function(name){var props=ALL[name];_this4[props.privateName]=_this4[props.getterName]()});this.textTracksJson_=textTrackConverter.textTracksToJson(this.tech_);this.isReady_=!1;this.tech_.dispose();this.tech_=!1;if(this.isPosterFromTech_){this.poster_="";this.trigger("posterchange")}this.isPosterFromTech_=!1};_proto.tech=function(safety){if(safety===void 0){log.warn("Using the tech directly can be dangerous. I hope you know what you're doing.\nSee https://github.com/videojs/video.js/issues/2617 for more info.\n")}return this.tech_};_proto.addTechControlsListeners_=function(){this.removeTechControlsListeners_();this.on(this.tech_,"mouseup",this.handleTechClick_);this.on(this.tech_,"dblclick",this.handleTechDoubleClick_);this.on(this.tech_,"touchstart",this.handleTechTouchStart_);this.on(this.tech_,"touchmove",this.handleTechTouchMove_);this.on(this.tech_,"touchend",this.handleTechTouchEnd_);this.on(this.tech_,"tap",this.handleTechTap_)};_proto.removeTechControlsListeners_=function(){this.off(this.tech_,"tap",this.handleTechTap_);this.off(this.tech_,"touchstart",this.handleTechTouchStart_);this.off(this.tech_,"touchmove",this.handleTechTouchMove_);this.off(this.tech_,"touchend",this.handleTechTouchEnd_);this.off(this.tech_,"mouseup",this.handleTechClick_);this.off(this.tech_,"dblclick",this.handleTechDoubleClick_)};_proto.handleTechReady_=function(){this.triggerReady();if(this.cache_.volume){this.techCall_("setVolume",this.cache_.volume)}this.handleTechPosterChange_();this.handleTechDurationChange_()};_proto.handleTechLoadStart_=function(){this.removeClass("vjs-ended");this.removeClass("vjs-seeking");this.error(null);this.handleTechDurationChange_();if(!this.paused()){this.trigger("loadstart");this.trigger("firstplay")}else{this.hasStarted(!1);this.trigger("loadstart")}this.manualAutoplay_(this.autoplay())};_proto.manualAutoplay_=function(type){var _this5=this;if(!this.tech_||"string"!=typeof type){return}var muted=function(){var previouslyMuted=_this5.muted();_this5.muted(!0);var restoreMuted=function(){_this5.muted(previouslyMuted)};_this5.playTerminatedQueue_.push(restoreMuted);var mutedPromise=_this5.play();if(!isPromise(mutedPromise)){return}return mutedPromise["catch"](restoreMuted)},promise;if("any"===type&&!0!==this.muted()){promise=this.play();if(isPromise(promise)){promise=promise["catch"](muted)}}else if("muted"===type&&!0!==this.muted()){promise=muted()}else{promise=this.play()}if(!isPromise(promise)){return}return promise.then(function(){_this5.trigger({type:"autoplay-success",autoplay:type})})["catch"](function(){_this5.trigger({type:"autoplay-failure",autoplay:type})})};_proto.updateSourceCaches_=function(srcObj){if(void 0===srcObj){srcObj=""}var src=srcObj,type="";if("string"!=typeof src){src=srcObj.src;type=srcObj.type}this.cache_.source=this.cache_.source||{};this.cache_.sources=this.cache_.sources||[];if(src&&!type){type=findMimetype(this,src)}this.cache_.source=mergeOptions({},srcObj,{src:src,type:type});for(var matchingSources=this.cache_.sources.filter(function(s){return s.src&&s.src===src}),sourceElSources=[],sourceEls=this.$$("source"),matchingSourceEls=[],i=0,sourceObj;i<sourceEls.length;i++){sourceObj=getAttributes(sourceEls[i]);sourceElSources.push(sourceObj);if(sourceObj.src&&sourceObj.src===src){matchingSourceEls.push(sourceObj.src)}}if(matchingSourceEls.length&&!matchingSources.length){this.cache_.sources=sourceElSources}else if(!matchingSources.length){this.cache_.sources=[this.cache_.source]}this.cache_.src=src};_proto.handleTechSourceset_=function(event){var _this6=this;if(!this.changingSrc_){var updateSourceCaches=function(src){return _this6.updateSourceCaches_(src)},playerSrc=this.currentSource().src,eventSrc=event.src;if(playerSrc&&!/^blob:/.test(playerSrc)&&/^blob:/.test(eventSrc)){if(!this.lastSource_||this.lastSource_.tech!==eventSrc&&this.lastSource_.player!==playerSrc){updateSourceCaches=function(){}}}updateSourceCaches(eventSrc);if(!event.src){this.tech_.any(["sourceset","loadstart"],function(e){if("sourceset"===e.type){return}var techSrc=_this6.techGet("currentSrc");_this6.lastSource_.tech=techSrc;_this6.updateSourceCaches_(techSrc)})}}this.lastSource_={player:this.currentSource().src,tech:event.src};this.trigger({src:event.src,type:"sourceset"})};_proto.hasStarted=function(request){if(request===void 0){return this.hasStarted_}if(request===this.hasStarted_){return}this.hasStarted_=request;if(this.hasStarted_){this.addClass("vjs-has-started");this.trigger("firstplay")}else{this.removeClass("vjs-has-started")}};_proto.handleTechPlay_=function(){this.removeClass("vjs-ended");this.removeClass("vjs-paused");this.addClass("vjs-playing");this.hasStarted(!0);this.trigger("play")};_proto.handleTechRateChange_=function(){if(0<this.tech_.playbackRate()&&0===this.cache_.lastPlaybackRate){this.queuedCallbacks_.forEach(function(queued){return queued.callback(queued.event)});this.queuedCallbacks_=[]}this.cache_.lastPlaybackRate=this.tech_.playbackRate();this.trigger("ratechange")};_proto.handleTechWaiting_=function(){var _this7=this;this.addClass("vjs-waiting");this.trigger("waiting");var timeWhenWaiting=this.currentTime();this.on("timeupdate",function timeUpdateListener(){if(timeWhenWaiting!==_this7.currentTime()){_this7.removeClass("vjs-waiting");_this7.off("timeupdate",timeUpdateListener)}})};_proto.handleTechCanPlay_=function(){this.removeClass("vjs-waiting");this.trigger("canplay")};_proto.handleTechCanPlayThrough_=function(){this.removeClass("vjs-waiting");this.trigger("canplaythrough")};_proto.handleTechPlaying_=function(){this.removeClass("vjs-waiting");this.trigger("playing")};_proto.handleTechSeeking_=function(){this.addClass("vjs-seeking");this.trigger("seeking")};_proto.handleTechSeeked_=function(){this.removeClass("vjs-seeking");this.removeClass("vjs-ended");this.trigger("seeked")};_proto.handleTechFirstPlay_=function(){if(this.options_.starttime){log.warn("Passing the `starttime` option to the player will be deprecated in 6.0");this.currentTime(this.options_.starttime)}this.addClass("vjs-has-started");this.trigger("firstplay")};_proto.handleTechPause_=function(){this.removeClass("vjs-playing");this.addClass("vjs-paused");this.trigger("pause")};_proto.handleTechEnded_=function(){this.addClass("vjs-ended");if(this.options_.loop){this.currentTime(0);this.play()}else if(!this.paused()){this.pause()}this.trigger("ended")};_proto.handleTechDurationChange_=function(){this.duration(this.techGet_("duration"))};_proto.handleTechClick_=function(event){if(!isSingleLeftClick(event)){return}if(!this.controls_){return}if(this.paused()){silencePromise(this.play())}else{this.pause()}};_proto.handleTechDoubleClick_=function(event){if(!this.controls_){return}var inAllowedEls=Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),function(el){return el.contains(event.target)});if(!inAllowedEls){if(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.doubleClick===void 0||!1!==this.options_.userActions.doubleClick){if(this.options_!==void 0&&this.options_.userActions!==void 0&&"function"==typeof this.options_.userActions.doubleClick){this.options_.userActions.doubleClick.call(this,event)}else if(this.isFullscreen()){this.exitFullscreen()}else{this.requestFullscreen()}}}};_proto.handleTechTap_=function(){this.userActive(!this.userActive())};_proto.handleTechTouchStart_=function(){this.userWasActive=this.userActive()};_proto.handleTechTouchMove_=function(){if(this.userWasActive){this.reportUserActivity()}};_proto.handleTechTouchEnd_=function(event){event.preventDefault()};_proto.handleStageClick_=function(){this.reportUserActivity()};_proto.toggleFullscreenClass_=function(){if(this.isFullscreen()){this.addClass("vjs-fullscreen")}else{this.removeClass("vjs-fullscreen")}};_proto.documentFullscreenChange_=function(e){var targetPlayer=e.target.player;if(targetPlayer&&targetPlayer!==this){return}var el=this.el(),isFs=document[this.fsApi_.fullscreenElement]===el;if(!isFs&&el.matches){isFs=el.matches(":"+this.fsApi_.fullscreen)}else if(!isFs&&el.msMatchesSelector){isFs=el.msMatchesSelector(":"+this.fsApi_.fullscreen)}this.isFullscreen(isFs)};_proto.handleTechFullscreenChange_=function(event,data){if(data){if(data.nativeIOSFullscreen){this.toggleClass("vjs-ios-native-fs")}this.isFullscreen(data.isFullscreen)}};_proto.handleTechFullscreenError_=function(event,err){this.trigger("fullscreenerror",err)};_proto.togglePictureInPictureClass_=function(){if(this.isInPictureInPicture()){this.addClass("vjs-picture-in-picture")}else{this.removeClass("vjs-picture-in-picture")}};_proto.handleTechEnterPictureInPicture_=function(){this.isInPictureInPicture(!0)};_proto.handleTechLeavePictureInPicture_=function(){this.isInPictureInPicture(!1)};_proto.handleTechError_=function(){var error=this.tech_.error();this.error(error)};_proto.handleTechTextData_=function(){var data=null;if(1<arguments.length){data=arguments[1]}this.trigger("textdata",data)};_proto.getCache=function(){return this.cache_};_proto.resetCache_=function(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],volume:1}};_proto.techCall_=function(method,arg){this.ready(function(){if(method in allowedSetters){return set(this.middleware_,this.tech_,method,arg)}else if(method in allowedMediators){return mediate(this.middleware_,this.tech_,method,arg)}try{if(this.tech_){this.tech_[method](arg)}}catch(e){log(e);throw e}},!0)};_proto.techGet_=function(method){if(!this.tech_||!this.tech_.isReady_){return}if(method in allowedGetters){return get(this.middleware_,this.tech_,method)}else if(method in allowedMediators){return mediate(this.middleware_,this.tech_,method)}try{return this.tech_[method]()}catch(e){if(this.tech_[method]===void 0){log("Video.js: "+method+" method not defined for "+this.techName_+" playback technology.",e);throw e}if("TypeError"===e.name){log("Video.js: "+method+" unavailable on "+this.techName_+" playback technology element.",e);this.tech_.isReady_=!1;throw e}log(e);throw e}};_proto.play=function(){var _this8=this,PromiseClass=this.options_.Promise||window$3.Promise;if(PromiseClass){return new PromiseClass(function(resolve){_this8.play_(resolve)})}return this.play_()};_proto.play_=function(callback){var _this9=this;if(void 0===callback){callback=silencePromise}this.playCallbacks_.push(callback);var isSrcReady=!!(!this.changingSrc_&&(this.src()||this.currentSrc()));if(this.waitToPlay_){this.off(["ready","loadstart"],this.waitToPlay_);this.waitToPlay_=null}if(!this.isReady_||!isSrcReady){this.waitToPlay_=function(){_this9.play_()};this.one(["ready","loadstart"],this.waitToPlay_);if(!isSrcReady&&(IS_ANY_SAFARI||IS_IOS)){this.load()}return}var val=this.techGet_("play");if(null===val){this.runPlayTerminatedQueue_()}else{this.runPlayCallbacks_(val)}};_proto.runPlayTerminatedQueue_=function(){var queue=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[];queue.forEach(function(q){q()})};_proto.runPlayCallbacks_=function(val){var callbacks=this.playCallbacks_.slice(0);this.playCallbacks_=[];this.playTerminatedQueue_=[];callbacks.forEach(function(cb){cb(val)})};_proto.pause=function(){this.techCall_("pause")};_proto.paused=function(){return!1===this.techGet_("paused")?!1:!0};_proto.played=function(){return this.techGet_("played")||createTimeRanges(0,0)};_proto.scrubbing=function(isScrubbing){if("undefined"==typeof isScrubbing){return this.scrubbing_}this.scrubbing_=!!isScrubbing;this.techCall_("setScrubbing",this.scrubbing_);if(isScrubbing){this.addClass("vjs-scrubbing")}else{this.removeClass("vjs-scrubbing")}};_proto.currentTime=function(seconds){if("undefined"!=typeof seconds){if(0>seconds){seconds=0}if(!this.isReady_||this.changingSrc_||!this.tech_||!this.tech_.isReady_){this.cache_.initTime=seconds;this.off("canplay",this.applyInitTime_);this.one("canplay",this.applyInitTime_);return}this.techCall_("setCurrentTime",seconds);this.cache_.initTime=0;return}this.cache_.currentTime=this.techGet_("currentTime")||0;return this.cache_.currentTime};_proto.applyInitTime_=function(){this.currentTime(this.cache_.initTime)};_proto.duration=function(seconds){if(seconds===void 0){return this.cache_.duration!==void 0?this.cache_.duration:NaN}seconds=parseFloat(seconds);if(0>seconds){seconds=1/0}if(seconds!==this.cache_.duration){this.cache_.duration=seconds;if(seconds===1/0){this.addClass("vjs-live")}else{this.removeClass("vjs-live")}if(!isNaN(seconds)){this.trigger("durationchange")}}};_proto.remainingTime=function(){return this.duration()-this.currentTime()};_proto.remainingTimeDisplay=function(){return Math.floor(this.duration())-Math.floor(this.currentTime())};_proto.buffered=function buffered(){var buffered=this.techGet_("buffered");if(!buffered||!buffered.length){buffered=createTimeRanges(0,0)}return buffered};_proto.bufferedPercent=function(){return bufferedPercent(this.buffered(),this.duration())};_proto.bufferedEnd=function(){var buffered=this.buffered(),duration=this.duration(),end=buffered.end(buffered.length-1);if(end>duration){end=duration}return end};_proto.volume=function(percentAsDecimal){var vol;if(percentAsDecimal!==void 0){vol=Math.max(0,Math.min(1,parseFloat(percentAsDecimal)));this.cache_.volume=vol;this.techCall_("setVolume",vol);if(0<vol){this.lastVolume_(vol)}return}vol=parseFloat(this.techGet_("volume"));return isNaN(vol)?1:vol};_proto.muted=function(_muted){if(_muted!==void 0){this.techCall_("setMuted",_muted);return}return this.techGet_("muted")||!1};_proto.defaultMuted=function(_defaultMuted){if(_defaultMuted!==void 0){return this.techCall_("setDefaultMuted",_defaultMuted)}return this.techGet_("defaultMuted")||!1};_proto.lastVolume_=function(percentAsDecimal){if(percentAsDecimal!==void 0&&0!==percentAsDecimal){this.cache_.lastVolume=percentAsDecimal;return}return this.cache_.lastVolume};_proto.supportsFullScreen=function(){return this.techGet_("supportsFullScreen")||!1};_proto.isFullscreen=function(isFS){if(isFS!==void 0){var oldValue=this.isFullscreen_;this.isFullscreen_=!!isFS;if(this.isFullscreen_!==oldValue&&this.fsApi_.prefixed){this.trigger("fullscreenchange")}this.toggleFullscreenClass_();return}return this.isFullscreen_};_proto.requestFullscreen=function(fullscreenOptions){var PromiseClass=this.options_.Promise||window$3.Promise;if(PromiseClass){var self=this;return new PromiseClass(function(resolve,reject){function offHandler(){self.off("fullscreenerror",errorHandler);self.off("fullscreenchange",changeHandler)}function changeHandler(){offHandler();resolve()}function errorHandler(e,err){offHandler();reject(err)}self.one("fullscreenchange",changeHandler);self.one("fullscreenerror",errorHandler);var promise=self.requestFullscreenHelper_(fullscreenOptions);if(promise){promise.then(offHandler,offHandler);return promise}})}return this.requestFullscreenHelper_()};_proto.requestFullscreenHelper_=function(fullscreenOptions){var _this10=this,fsOptions;if(!this.fsApi_.prefixed){fsOptions=this.options_.fullscreen&&this.options_.fullscreen.options||{};if(fullscreenOptions!==void 0){fsOptions=fullscreenOptions}}if(this.fsApi_.requestFullscreen){var promise=this.el_[this.fsApi_.requestFullscreen](fsOptions);if(promise){promise.then(function(){return _this10.isFullscreen(!0)},function(){return _this10.isFullscreen(!1)})}return promise}else if(this.tech_.supportsFullScreen()){this.techCall_("enterFullScreen")}else{this.enterFullWindow()}};_proto.exitFullscreen=function(){var PromiseClass=this.options_.Promise||window$3.Promise;if(PromiseClass){var self=this;return new PromiseClass(function(resolve,reject){function offHandler(){self.off("fullscreenerror",errorHandler);self.off("fullscreenchange",changeHandler)}function changeHandler(){offHandler();resolve()}function errorHandler(e,err){offHandler();reject(err)}self.one("fullscreenchange",changeHandler);self.one("fullscreenerror",errorHandler);var promise=self.exitFullscreenHelper_();if(promise){promise.then(offHandler,offHandler);return promise}})}return this.exitFullscreenHelper_()};_proto.exitFullscreenHelper_=function(){var _this11=this;if(this.fsApi_.requestFullscreen){var promise=document[this.fsApi_.exitFullscreen]();if(promise){promise.then(function(){return _this11.isFullscreen(!1)})}return promise}else if(this.tech_.supportsFullScreen()){this.techCall_("exitFullScreen")}else{this.exitFullWindow()}};_proto.enterFullWindow=function(){this.isFullscreen(!0);this.isFullWindow=!0;this.docOrigOverflow=document.documentElement.style.overflow;on(document,"keydown",this.boundFullWindowOnEscKey_);document.documentElement.style.overflow="hidden";addClass(document.body,"vjs-full-window");this.trigger("enterFullWindow")};_proto.fullWindowOnEscKey=function(event){if(keycode.isEventKey(event,"Esc")){if(!0===this.isFullscreen()){this.exitFullscreen()}else{this.exitFullWindow()}}};_proto.exitFullWindow=function(){this.isFullscreen(!1);this.isFullWindow=!1;off(document,"keydown",this.boundFullWindowOnEscKey_);document.documentElement.style.overflow=this.docOrigOverflow;removeClass(document.body,"vjs-full-window");this.trigger("exitFullWindow")};_proto.disablePictureInPicture=function(value){if(value===void 0){return this.techGet_("disablePictureInPicture")}this.techCall_("setDisablePictureInPicture",value);this.options_.disablePictureInPicture=value;this.trigger("disablepictureinpicturechanged")};_proto.isInPictureInPicture=function(isPiP){if(isPiP!==void 0){this.isInPictureInPicture_=!!isPiP;this.togglePictureInPictureClass_();return}return!!this.isInPictureInPicture_};_proto.requestPictureInPicture=function(){if("pictureInPictureEnabled"in document&&!1===this.disablePictureInPicture()){return this.techGet_("requestPictureInPicture")}};_proto.exitPictureInPicture=function(){if("pictureInPictureEnabled"in document){return document.exitPictureInPicture()}};_proto.handleKeyDown=function(event){var userActions=this.options_.userActions;if(!userActions||!userActions.hotkeys){return}if(function(el){var tagName=el.tagName.toLowerCase();if(el.isContentEditable){return!0}if("input"===tagName){return-1===["button","checkbox","hidden","radio","reset","submit"].indexOf(el.type)}return-1!==["textarea"].indexOf(tagName)}(this.el_.ownerDocument.activeElement)){return}if("function"==typeof userActions.hotkeys){userActions.hotkeys.call(this,event)}else{this.handleHotkeys(event)}};_proto.handleHotkeys=function(event){var hotkeys=this.options_.userActions?this.options_.userActions.hotkeys:{},_hotkeys$fullscreenKe=hotkeys.fullscreenKey,fullscreenKey=void 0===_hotkeys$fullscreenKe?function(keydownEvent){return keycode.isEventKey(keydownEvent,"f")}:_hotkeys$fullscreenKe,_hotkeys$muteKey=hotkeys.muteKey,muteKey=void 0===_hotkeys$muteKey?function(keydownEvent){return keycode.isEventKey(keydownEvent,"m")}:_hotkeys$muteKey,_hotkeys$playPauseKey=hotkeys.playPauseKey,playPauseKey=void 0===_hotkeys$playPauseKey?function(keydownEvent){return keycode.isEventKey(keydownEvent,"k")||keycode.isEventKey(keydownEvent,"Space")}:_hotkeys$playPauseKey;if(fullscreenKey.call(this,event)){event.preventDefault();event.stopPropagation();var FSToggle=Component.getComponent("FullscreenToggle");if(!1!==document[this.fsApi_.fullscreenEnabled]){FSToggle.prototype.handleClick.call(this,event)}}else if(muteKey.call(this,event)){event.preventDefault();event.stopPropagation();var MuteToggle=Component.getComponent("MuteToggle");MuteToggle.prototype.handleClick.call(this,event)}else if(playPauseKey.call(this,event)){event.preventDefault();event.stopPropagation();var PlayToggle=Component.getComponent("PlayToggle");PlayToggle.prototype.handleClick.call(this,event)}};_proto.canPlayType=function(type){for(var can,i=0,j=this.options_.techOrder;i<j.length;i++){var techName=j[i],tech=Tech.getTech(techName);if(!tech){tech=Component.getComponent(techName)}if(!tech){log.error("The \""+techName+"\" tech is undefined. Skipped browser support check for that tech.");continue}if(tech.isSupported()){can=tech.canPlayType(type);if(can){return can}}}return""};_proto.selectSource=function(sources){var _this12=this,techs=this.options_.techOrder.map(function(techName){return[techName,Tech.getTech(techName)]}).filter(function(_ref){var techName=_ref[0],tech=_ref[1];if(tech){return tech.isSupported()}log.error("The \""+techName+"\" tech is undefined. Skipped browser support check for that tech.");return!1}),findFirstPassingTechSourcePair=function(outerArray,innerArray,tester){var found;outerArray.some(function(outerChoice){return innerArray.some(function(innerChoice){found=tester(outerChoice,innerChoice);if(found){return!0}})});return found},foundSourceAndTech,flip=function(fn){return function(a,b){return fn(b,a)}},finder=function(_ref2,source){var techName=_ref2[0],tech=_ref2[1];if(tech.canPlaySource(source,_this12.options_[techName.toLowerCase()])){return{source:source,tech:techName}}};if(this.options_.sourceOrder){foundSourceAndTech=findFirstPassingTechSourcePair(sources,techs,flip(finder))}else{foundSourceAndTech=findFirstPassingTechSourcePair(techs,sources,finder)}return foundSourceAndTech||!1};_proto.src=function(source){var _this13=this;if("undefined"==typeof source){return this.cache_.src||""}var sources=filterSource(source);if(!sources.length){this.setTimeout(function(){this.error({code:4,message:this.localize(this.options_.notSupportedMessage)})},0);return}this.changingSrc_=!0;this.cache_.sources=sources;this.updateSourceCaches_(sources[0]);setSource(this,sources[0],function(middlewareSource,mws){_this13.middleware_=mws;_this13.cache_.sources=sources;_this13.updateSourceCaches_(middlewareSource);var err=_this13.src_(middlewareSource);if(err){if(1<sources.length){return _this13.src(sources.slice(1))}_this13.changingSrc_=!1;_this13.setTimeout(function(){this.error({code:4,message:this.localize(this.options_.notSupportedMessage)})},0);_this13.triggerReady();return}setTech(mws,_this13.tech_)})};_proto.src_=function(source){var _this14=this,sourceTech=this.selectSource([source]);if(!sourceTech){return!0}if(!titleCaseEquals(sourceTech.tech,this.techName_)){this.changingSrc_=!0;this.loadTech_(sourceTech.tech,sourceTech.source);this.tech_.ready(function(){_this14.changingSrc_=!1});return!1}this.ready(function(){if(this.tech_.constructor.prototype.hasOwnProperty("setSource")){this.techCall_("setSource",source)}else{this.techCall_("src",source.src)}this.changingSrc_=!1},!0);return!1};_proto.load=function(){this.techCall_("load")};_proto.reset=function(){var _this15=this,PromiseClass=this.options_.Promise||window$3.Promise;if(this.paused()||!PromiseClass){this.doReset_()}else{var playPromise=this.play();silencePromise(playPromise.then(function(){return _this15.doReset_()}))}};_proto.doReset_=function(){if(this.tech_){this.tech_.clearTracks("text")}this.resetCache_();this.poster("");this.loadTech_(this.options_.techOrder[0],null);this.techCall_("reset");this.resetControlBarUI_();if(isEvented(this)){this.trigger("playerreset")}};_proto.resetControlBarUI_=function(){this.resetProgressBar_();this.resetPlaybackRate_();this.resetVolumeBar_()};_proto.resetProgressBar_=function(){this.currentTime(0);var _this$controlBar=this.controlBar,durationDisplay=_this$controlBar.durationDisplay,remainingTimeDisplay=_this$controlBar.remainingTimeDisplay;if(durationDisplay){durationDisplay.updateContent()}if(remainingTimeDisplay){remainingTimeDisplay.updateContent()}};_proto.resetPlaybackRate_=function(){this.playbackRate(this.defaultPlaybackRate());this.handleTechRateChange_()};_proto.resetVolumeBar_=function(){this.volume(1);this.trigger("volumechange")};_proto.currentSources=function(){var source=this.currentSource(),sources=[];if(0!==Object.keys(source).length){sources.push(source)}return this.cache_.sources||sources};_proto.currentSource=function(){return this.cache_.source||{}};_proto.currentSrc=function(){return this.currentSource()&&this.currentSource().src||""};_proto.currentType=function(){return this.currentSource()&&this.currentSource().type||""};_proto.preload=function(value){if(value!==void 0){this.techCall_("setPreload",value);this.options_.preload=value;return}return this.techGet_("preload")};_proto.autoplay=function(value){if(value===void 0){return this.options_.autoplay||!1}var techAutoplay;if("string"==typeof value&&/(any|play|muted)/.test(value)){this.options_.autoplay=value;this.manualAutoplay_(value);techAutoplay=!1}else if(!value){this.options_.autoplay=!1}else{this.options_.autoplay=!0}techAutoplay="undefined"==typeof techAutoplay?this.options_.autoplay:techAutoplay;if(this.tech_){this.techCall_("setAutoplay",techAutoplay)}};_proto.playsinline=function(value){if(value!==void 0){this.techCall_("setPlaysinline",value);this.options_.playsinline=value;return this}return this.techGet_("playsinline")};_proto.loop=function(value){if(value!==void 0){this.techCall_("setLoop",value);this.options_.loop=value;return}return this.techGet_("loop")};_proto.poster=function(src){if(src===void 0){return this.poster_}if(!src){src=""}if(src===this.poster_){return}this.poster_=src;this.techCall_("setPoster",src);this.isPosterFromTech_=!1;this.trigger("posterchange")};_proto.handleTechPosterChange_=function(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){var newPoster=this.tech_.poster()||"";if(newPoster!==this.poster_){this.poster_=newPoster;this.isPosterFromTech_=!0;this.trigger("posterchange")}}};_proto.controls=function(bool){if(bool===void 0){return!!this.controls_}bool=!!bool;if(this.controls_===bool){return}this.controls_=bool;if(this.usingNativeControls()){this.techCall_("setControls",bool)}if(this.controls_){this.removeClass("vjs-controls-disabled");this.addClass("vjs-controls-enabled");this.trigger("controlsenabled");if(!this.usingNativeControls()){this.addTechControlsListeners_()}}else{this.removeClass("vjs-controls-enabled");this.addClass("vjs-controls-disabled");this.trigger("controlsdisabled");if(!this.usingNativeControls()){this.removeTechControlsListeners_()}}};_proto.usingNativeControls=function(bool){if(bool===void 0){return!!this.usingNativeControls_}bool=!!bool;if(this.usingNativeControls_===bool){return}this.usingNativeControls_=bool;if(this.usingNativeControls_){this.addClass("vjs-using-native-controls");this.trigger("usingnativecontrols")}else{this.removeClass("vjs-using-native-controls");this.trigger("usingcustomcontrols")}};_proto.error=function(err){if(err===void 0){return this.error_||null}if(this.options_.suppressNotSupportedError&&err&&4===err.code){var triggerSuppressedError=function(){this.error(err)};this.options_.suppressNotSupportedError=!1;this.any(["click","touchstart"],triggerSuppressedError);this.one("loadstart",function(){this.off(["click","touchstart"],triggerSuppressedError)});return}if(null===err){this.error_=err;this.removeClass("vjs-error");if(this.errorDisplay){this.errorDisplay.close()}return}this.error_=new MediaError(err);this.addClass("vjs-error");log.error("(CODE:"+this.error_.code+" "+MediaError.errorTypes[this.error_.code]+")",this.error_.message,this.error_);this.trigger("error")};_proto.reportUserActivity=function(){this.userActivity_=!0};_proto.userActive=function(bool){if(bool===void 0){return this.userActive_}bool=!!bool;if(bool===this.userActive_){return}this.userActive_=bool;if(this.userActive_){this.userActivity_=!0;this.removeClass("vjs-user-inactive");this.addClass("vjs-user-active");this.trigger("useractive");return}if(this.tech_){this.tech_.one("mousemove",function(e){e.stopPropagation();e.preventDefault()})}this.userActivity_=!1;this.removeClass("vjs-user-active");this.addClass("vjs-user-inactive");this.trigger("userinactive")};_proto.listenForUserActivity_=function(){var mouseInProgress,lastMoveX,lastMoveY,handleActivity=bind(this,this.reportUserActivity),handleMouseMove=function(e){if(e.screenX!==lastMoveX||e.screenY!==lastMoveY){lastMoveX=e.screenX;lastMoveY=e.screenY;handleActivity()}},handleMouseDown=function(){handleActivity();this.clearInterval(mouseInProgress);mouseInProgress=this.setInterval(handleActivity,250)},handleMouseUpAndMouseLeave=function(){handleActivity();this.clearInterval(mouseInProgress)};this.on("mousedown",handleMouseDown);this.on("mousemove",handleMouseMove);this.on("mouseup",handleMouseUpAndMouseLeave);this.on("mouseleave",handleMouseUpAndMouseLeave);var controlBar=this.getChild("controlBar");if(controlBar&&!IS_IOS&&!IS_ANDROID){controlBar.on("mouseenter",function(){this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout;this.player().options_.inactivityTimeout=0});controlBar.on("mouseleave",function(){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})}this.on("keydown",handleActivity);this.on("keyup",handleActivity);var inactivityTimeout;this.setInterval(function(){if(!this.userActivity_){return}this.userActivity_=!1;this.userActive(!0);this.clearTimeout(inactivityTimeout);var timeout=this.options_.inactivityTimeout;if(0>=timeout){return}inactivityTimeout=this.setTimeout(function(){if(!this.userActivity_){this.userActive(!1)}},timeout)},250)};_proto.playbackRate=function(rate){if(rate!==void 0){this.techCall_("setPlaybackRate",rate);return}if(this.tech_&&this.tech_.featuresPlaybackRate){return this.cache_.lastPlaybackRate||this.techGet_("playbackRate")}return 1};_proto.defaultPlaybackRate=function(rate){if(rate!==void 0){return this.techCall_("setDefaultPlaybackRate",rate)}if(this.tech_&&this.tech_.featuresPlaybackRate){return this.techGet_("defaultPlaybackRate")}return 1};_proto.isAudio=function(bool){if(bool!==void 0){this.isAudio_=!!bool;return}return!!this.isAudio_};_proto.addTextTrack=function(kind,label,language){if(this.tech_){return this.tech_.addTextTrack(kind,label,language)}};_proto.addRemoteTextTrack=function(options,manualCleanup){if(this.tech_){return this.tech_.addRemoteTextTrack(options,manualCleanup)}};_proto.removeRemoteTextTrack=function(obj){if(void 0===obj){obj={}}var _obj=obj,track=_obj.track;if(!track){track=obj}if(this.tech_){return this.tech_.removeRemoteTextTrack(track)}};_proto.getVideoPlaybackQuality=function(){return this.techGet_("getVideoPlaybackQuality")};_proto.videoWidth=function(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0};_proto.videoHeight=function(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0};_proto.language=function(code){if(code===void 0){return this.language_}this.language_=(code+"").toLowerCase()};_proto.languages=function(){return mergeOptions(Player.prototype.options_.languages,this.languages_)};_proto.toJSON=function(){var options=mergeOptions(this.options_),tracks=options.tracks;options.tracks=[];for(var i=0,track;i<tracks.length;i++){track=tracks[i];track=mergeOptions(track);track.player=void 0;options.tracks[i]=track}return options};_proto.createModal=function(content,options){var _this16=this;options=options||{};options.content=content||"";var modal=new ModalDialog(this,options);this.addChild(modal);modal.on("dispose",function(){_this16.removeChild(modal)});modal.open();return modal};_proto.updateCurrentBreakpoint_=function(){if(!this.responsive()){return}for(var currentBreakpoint=this.currentBreakpoint(),currentWidth=this.currentWidth(),i=0;i<BREAKPOINT_ORDER.length;i++){var candidateBreakpoint=BREAKPOINT_ORDER[i],maxWidth=this.breakpoints_[candidateBreakpoint];if(currentWidth<=maxWidth){if(currentBreakpoint===candidateBreakpoint){return}if(currentBreakpoint){this.removeClass(BREAKPOINT_CLASSES[currentBreakpoint])}this.addClass(BREAKPOINT_CLASSES[candidateBreakpoint]);this.breakpoint_=candidateBreakpoint;break}}};_proto.removeCurrentBreakpoint_=function(){var className=this.currentBreakpointClass();this.breakpoint_="";if(className){this.removeClass(className)}};_proto.breakpoints=function(_breakpoints){if(_breakpoints===void 0){return assign(this.breakpoints_)}this.breakpoint_="";this.breakpoints_=assign({},DEFAULT_BREAKPOINTS,_breakpoints);this.updateCurrentBreakpoint_();return assign(this.breakpoints_)};_proto.responsive=function(value){if(value===void 0){return this.responsive_}value=!!value;var current=this.responsive_;if(value===current){return}this.responsive_=value;if(value){this.on("playerresize",this.updateCurrentBreakpoint_);this.updateCurrentBreakpoint_()}else{this.off("playerresize",this.updateCurrentBreakpoint_);this.removeCurrentBreakpoint_()}return value};_proto.currentBreakpoint=function(){return this.breakpoint_};_proto.currentBreakpointClass=function(){return BREAKPOINT_CLASSES[this.breakpoint_]||""};_proto.loadMedia=function(media,ready){var _this17=this;if(!media||"object"!==_typeof2(media)){return}this.reset();this.cache_.media=mergeOptions(media);var _this$cache_$media=this.cache_.media,artwork=_this$cache_$media.artwork,poster=_this$cache_$media.poster,src=_this$cache_$media.src,textTracks=_this$cache_$media.textTracks;if(!artwork&&poster){this.cache_.media.artwork=[{src:poster,type:getMimetype(poster)}]}if(src){this.src(src)}if(poster){this.poster(poster)}if(Array.isArray(textTracks)){textTracks.forEach(function(tt){return _this17.addRemoteTextTrack(tt,!1)})}this.ready(ready)};_proto.getMedia=function(){if(!this.cache_.media){var poster=this.poster(),src=this.currentSources(),textTracks=Array.prototype.map.call(this.remoteTextTracks(),function(tt){return{kind:tt.kind,label:tt.label,language:tt.language,src:tt.src}}),media={src:src,textTracks:textTracks};if(poster){media.poster=poster;media.artwork=[{src:media.poster,type:getMimetype(media.poster)}]}return media}return mergeOptions(this.cache_.media)};Player.getTagSettings=function(tag){var baseOptions={sources:[],tracks:[]},tagOptions=getAttributes(tag),dataSetup=tagOptions["data-setup"];if(hasClass(tag,"vjs-fill")){tagOptions.fill=!0}if(hasClass(tag,"vjs-fluid")){tagOptions.fluid=!0}if(null!==dataSetup){var _safeParseTuple=SafeParseTuple(dataSetup||"{}"),err=_safeParseTuple[0],data=_safeParseTuple[1];if(err){log.error(err)}assign(tagOptions,data)}assign(baseOptions,tagOptions);if(tag.hasChildNodes()){for(var children=tag.childNodes,i=0,j=children.length;i<j;i++){var child=children[i],childName=child.nodeName.toLowerCase();if("source"===childName){baseOptions.sources.push(getAttributes(child))}else if("track"===childName){baseOptions.tracks.push(getAttributes(child))}}}return baseOptions};_proto.flexNotSupported_=function(){var elem=document.createElement("i");return!("flexBasis"in elem.style||"webkitFlexBasis"in elem.style||"mozFlexBasis"in elem.style||"msFlexBasis"in elem.style||"msFlexOrder"in elem.style)};_proto.debug=function(enabled){if(enabled===void 0){return this.debugEnabled_}if(enabled){this.trigger("debugon");this.previousLogLevel_=this.log.level;this.log.level("debug");this.debugEnabled_=!0}else{this.trigger("debugoff");this.log.level(this.previousLogLevel_);this.previousLogLevel_=void 0;this.debugEnabled_=!1}};return Player}(Component);ALL.names.forEach(function(name){var props=ALL[name];Player.prototype[props.getterName]=function(){if(this.tech_){return this.tech_[props.getterName]()}this[props.privateName]=this[props.privateName]||new props.ListClass;return this[props.privateName]}});Player.prototype.crossorigin=Player.prototype.crossOrigin;Player.players={};var navigator=window$3.navigator;Player.prototype.options_={techOrder:Tech.defaultTechOrder_,html5:{},flash:{},inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:navigator&&(navigator.languages&&navigator.languages[0]||navigator.userLanguage||navigator.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1};["ended","seeking","seekable","networkState","readyState"].forEach(function(fn){Player.prototype[fn]=function(){return this.techGet_(fn)}});TECH_EVENTS_RETRIGGER.forEach(function(event){Player.prototype["handleTech"+toTitleCase(event)+"_"]=function(){return this.trigger(event)}});Component.registerComponent("Player",Player);var setPrototypeOf=createCommonjsModule(function(module){function _setPrototypeOf(o,p){module.exports=_setPrototypeOf=Object.setPrototypeOf||function(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}module.exports=_setPrototypeOf});var isNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return!0}catch(e){return!1}},construct=createCommonjsModule(function(module){function _construct(){if(isNativeReflectConstruct()){module.exports=_construct=Reflect.construct}else{module.exports=_construct=function(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a),instance=new Constructor;if(Class)setPrototypeOf(instance,Class.prototype);return instance}}return _construct.apply(null,arguments)}module.exports=_construct}),BASE_PLUGIN_NAME="plugin",PLUGIN_CACHE_KEY="activePlugins_",pluginStorage={},pluginExists=function(name){return pluginStorage.hasOwnProperty(name)},getPlugin=function(name){return pluginExists(name)?pluginStorage[name]:void 0},markPluginAsActive=function(player,name){player[PLUGIN_CACHE_KEY]=player[PLUGIN_CACHE_KEY]||{};player[PLUGIN_CACHE_KEY][name]=!0},triggerSetupEvent=function(player,hash,before){var eventName=(before?"before":"")+"pluginsetup";player.trigger(eventName,hash);player.trigger(eventName+":"+hash.name,hash)},createBasicPlugin=function(name,plugin){var basicPluginWrapper=function(){triggerSetupEvent(this,{name:name,plugin:plugin,instance:null},!0);var instance=plugin.apply(this,arguments);markPluginAsActive(this,name);triggerSetupEvent(this,{name:name,plugin:plugin,instance:instance});return instance};Object.keys(plugin).forEach(function(prop){basicPluginWrapper[prop]=plugin[prop]});return basicPluginWrapper},createPluginFactory=function(name,PluginSubClass){PluginSubClass.prototype.name=name;return function(){triggerSetupEvent(this,{name:name,plugin:PluginSubClass,instance:null},!0);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}var instance=construct(PluginSubClass,[this].concat(args));this[name]=function(){return instance};triggerSetupEvent(this,instance.getEventHash());return instance}},Plugin=function(){function Plugin(player){if(this.constructor===Plugin){throw new Error("Plugin must be sub-classed; not directly instantiated.")}this.player=player;if(!this.log){this.log=this.player.log.createLogger(this.name)}evented(this);delete this.trigger;stateful(this,this.constructor.defaultState);markPluginAsActive(player,this.name);this.dispose=bind(this,this.dispose);player.on("dispose",this.dispose)}var _proto=Plugin.prototype;_proto.version=function(){return this.constructor.VERSION};_proto.getEventHash=function(hash){if(void 0===hash){hash={}}hash.name=this.name;hash.plugin=this.constructor;hash.instance=this;return hash};_proto.trigger=function(event,hash){if(void 0===hash){hash={}}return trigger(this.eventBusEl_,event,this.getEventHash(hash))};_proto.handleStateChanged=function(){};_proto.dispose=function(){var name=this.name,player=this.player;this.trigger("dispose");this.off();player.off("dispose",this.dispose);player[PLUGIN_CACHE_KEY][name]=!1;this.player=this.state=null;player[name]=createPluginFactory(name,pluginStorage[name])};Plugin.isBasic=function(plugin){var p="string"==typeof plugin?getPlugin(plugin):plugin;return"function"==typeof p&&!Plugin.prototype.isPrototypeOf(p.prototype)};Plugin.registerPlugin=function(name,plugin){if("string"!=typeof name){throw new Error("Illegal plugin name, \""+name+"\", must be a string, was "+_typeof2(name)+".")}if(pluginExists(name)){log.warn("A plugin named \""+name+"\" already exists. You may want to avoid re-registering plugins!")}else if(Player.prototype.hasOwnProperty(name)){throw new Error("Illegal plugin name, \""+name+"\", cannot share a name with an existing player method!")}if("function"!=typeof plugin){throw new Error("Illegal plugin for \""+name+"\", must be a function, was "+_typeof2(plugin)+".")}pluginStorage[name]=plugin;if(name!==BASE_PLUGIN_NAME){if(Plugin.isBasic(plugin)){Player.prototype[name]=createBasicPlugin(name,plugin)}else{Player.prototype[name]=createPluginFactory(name,plugin)}}return plugin};Plugin.deregisterPlugin=function(name){if(name===BASE_PLUGIN_NAME){throw new Error("Cannot de-register base plugin.")}if(pluginExists(name)){delete pluginStorage[name];delete Player.prototype[name]}};Plugin.getPlugins=function(names){if(void 0===names){names=Object.keys(pluginStorage)}var result;names.forEach(function(name){var plugin=getPlugin(name);if(plugin){result=result||{};result[name]=plugin}});return result};Plugin.getPluginVersion=function(name){var plugin=getPlugin(name);return plugin&&plugin.VERSION||""};return Plugin}();Plugin.getPlugin=getPlugin;Plugin.BASE_PLUGIN_NAME=BASE_PLUGIN_NAME;Plugin.registerPlugin(BASE_PLUGIN_NAME,Plugin);Player.prototype.usingPlugin=function(name){return!!this[PLUGIN_CACHE_KEY]&&!0===this[PLUGIN_CACHE_KEY][name]};Player.prototype.hasPlugin=function(name){return!!pluginExists(name)};var inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}});if(superClass)setPrototypeOf(subClass,superClass)},extend=function(superClass,subClassMethods){if(void 0===subClassMethods){subClassMethods={}}var subClass=function(){superClass.apply(this,arguments)},methods={};if("object"===_typeof2(subClassMethods)){if(subClassMethods.constructor!==Object.prototype.constructor){subClass=subClassMethods.constructor}methods=subClassMethods}else if("function"==typeof subClassMethods){subClass=subClassMethods}inherits(subClass,superClass);if(superClass){subClass.super_=superClass}for(var name in methods){if(methods.hasOwnProperty(name)){subClass.prototype[name]=methods[name]}}return subClass},normalizeId=function(id){return 0===id.indexOf("#")?id.slice(1):id};function videojs$1(id,options,ready){var player=videojs$1.getPlayer(id);if(player){if(options){log.warn("Player \""+id+"\" is already initialised. Options will not be applied.")}if(ready){player.ready(ready)}return player}var el="string"==typeof id?$("#"+normalizeId(id)):id;if(!isEl(el)){throw new TypeError("The element or ID supplied is not valid. (videojs)")}if(!el.ownerDocument.defaultView||!el.ownerDocument.body.contains(el)){log.warn("The element supplied is not included in the DOM")}options=options||{};videojs$1.hooks("beforesetup").forEach(function(hookFunction){var opts=hookFunction(el,mergeOptions(options));if(!isObject(opts)||Array.isArray(opts)){log.error("please return an object in beforesetup hooks");return}options=mergeOptions(options,opts)});var PlayerComponent=Component.getComponent("Player");player=new PlayerComponent(el,options,ready);videojs$1.hooks("setup").forEach(function(hookFunction){return hookFunction(player)});return player}videojs$1.hooks_={};videojs$1.hooks=function(type,fn){videojs$1.hooks_[type]=videojs$1.hooks_[type]||[];if(fn){videojs$1.hooks_[type]=videojs$1.hooks_[type].concat(fn)}return videojs$1.hooks_[type]};videojs$1.hook=function(type,fn){videojs$1.hooks(type,fn)};videojs$1.hookOnce=function(type,fn){videojs$1.hooks(type,[].concat(fn).map(function(original){return function wrapper(){videojs$1.removeHook(type,wrapper);return original.apply(void 0,arguments)}}))};videojs$1.removeHook=function(type,fn){var index=videojs$1.hooks(type).indexOf(fn);if(-1>=index){return!1}videojs$1.hooks_[type]=videojs$1.hooks_[type].slice();videojs$1.hooks_[type].splice(index,1);return!0};if(!0!==window$3.VIDEOJS_NO_DYNAMIC_STYLE&&isReal()){var style=$(".vjs-styles-defaults");if(!style){style=createStyleElement("vjs-styles-defaults");var head=$("head");if(head){head.insertBefore(style,head.firstChild)}setTextContent(style,"\n      .video-js {\n        width: 300px;\n        height: 150px;\n      }\n\n      .vjs-fluid {\n        padding-top: 56.25%\n      }\n    ")}}autoSetupTimeout(1,videojs$1);videojs$1.VERSION="7.10.0";videojs$1.options=Player.prototype.options_;videojs$1.getPlayers=function(){return Player.players};videojs$1.getPlayer=function(id){var players=Player.players,tag;if("string"==typeof id){var nId=normalizeId(id),player=players[nId];if(player){return player}tag=$("#"+nId)}else{tag=id}if(isEl(tag)){var _tag=tag,_player=_tag.player,playerId=_tag.playerId;if(_player||players[playerId]){return _player||players[playerId]}}};videojs$1.getAllPlayers=function(){return Object.keys(Player.players).map(function(k){return Player.players[k]}).filter(Boolean)};videojs$1.players=Player.players;videojs$1.getComponent=Component.getComponent;videojs$1.registerComponent=function(name,comp){if(Tech.isTech(comp)){log.warn("The "+name+" tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)")}Component.registerComponent.call(Component,name,comp)};videojs$1.getTech=Tech.getTech;videojs$1.registerTech=Tech.registerTech;videojs$1.use=function(type,middleware){middlewares[type]=middlewares[type]||[];middlewares[type].push(middleware)};Object.defineProperty(videojs$1,"middleware",{value:{},writeable:!1,enumerable:!0});Object.defineProperty(videojs$1.middleware,"TERMINATOR",{value:TERMINATOR,writeable:!1,enumerable:!0});videojs$1.browser=browser;videojs$1.TOUCH_ENABLED=TOUCH_ENABLED;videojs$1.extend=extend;videojs$1.mergeOptions=mergeOptions;videojs$1.bind=bind;videojs$1.registerPlugin=Plugin.registerPlugin;videojs$1.deregisterPlugin=Plugin.deregisterPlugin;videojs$1.plugin=function(name,plugin){log.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead");return Plugin.registerPlugin(name,plugin)};videojs$1.getPlugins=Plugin.getPlugins;videojs$1.getPlugin=Plugin.getPlugin;videojs$1.getPluginVersion=Plugin.getPluginVersion;videojs$1.addLanguage=function(code,data){var _mergeOptions;code=(""+code).toLowerCase();videojs$1.options.languages=mergeOptions(videojs$1.options.languages,(_mergeOptions={},_mergeOptions[code]=data,_mergeOptions));return videojs$1.options.languages[code]};videojs$1.log=log;videojs$1.createLogger=createLogger$1;videojs$1.createTimeRange=videojs$1.createTimeRanges=createTimeRanges;videojs$1.formatTime=formatTime;videojs$1.setFormatTime=function(customImplementation){implementation=customImplementation};videojs$1.resetFormatTime=function(){implementation=defaultImplementation};videojs$1.parseUrl=parseUrl;videojs$1.isCrossOrigin=isCrossOrigin;videojs$1.EventTarget=EventTarget;videojs$1.on=on;videojs$1.one=one;videojs$1.off=off;videojs$1.trigger=trigger;videojs$1.xhr=xhr;videojs$1.TextTrack=TextTrack;videojs$1.AudioTrack=AudioTrack;videojs$1.VideoTrack=VideoTrack;["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(function(k){videojs$1[k]=function(){log.warn("videojs."+k+"() is deprecated; use videojs.dom."+k+"() instead");return Dom[k].apply(null,arguments)}});videojs$1.computedStyle=computedStyle;videojs$1.dom=Dom;videojs$1.url=Url;videojs$1.defineLazyProperty=defineLazyProperty;var urlToolkit=createCommonjsModule(function(module){(function(){var URLToolkit={buildAbsoluteURL:function(baseURL,relativeURL,opts){opts=opts||{};baseURL=baseURL.trim();relativeURL=relativeURL.trim();if(!relativeURL){if(!opts.alwaysNormalize){return baseURL}var basePartsForNormalise=URLToolkit.parseURL(baseURL);if(!basePartsForNormalise){throw new Error("Error trying to parse base URL.")}basePartsForNormalise.path=URLToolkit.normalizePath(basePartsForNormalise.path);return URLToolkit.buildURLFromParts(basePartsForNormalise)}var relativeParts=URLToolkit.parseURL(relativeURL);if(!relativeParts){throw new Error("Error trying to parse relative URL.")}if(relativeParts.scheme){if(!opts.alwaysNormalize){return relativeURL}relativeParts.path=URLToolkit.normalizePath(relativeParts.path);return URLToolkit.buildURLFromParts(relativeParts)}var baseParts=URLToolkit.parseURL(baseURL);if(!baseParts){throw new Error("Error trying to parse base URL.")}if(!baseParts.netLoc&&baseParts.path&&"/"!==baseParts.path[0]){var pathParts=/^([^\/?#]*)(.*)$/.exec(baseParts.path);baseParts.netLoc=pathParts[1];baseParts.path=pathParts[2]}if(baseParts.netLoc&&!baseParts.path){baseParts.path="/"}var builtParts={scheme:baseParts.scheme,netLoc:relativeParts.netLoc,path:null,params:relativeParts.params,query:relativeParts.query,fragment:relativeParts.fragment};if(!relativeParts.netLoc){builtParts.netLoc=baseParts.netLoc;if("/"!==relativeParts.path[0]){if(!relativeParts.path){builtParts.path=baseParts.path;if(!relativeParts.params){builtParts.params=baseParts.params;if(!relativeParts.query){builtParts.query=baseParts.query}}}else{var baseURLPath=baseParts.path,newPath=baseURLPath.substring(0,baseURLPath.lastIndexOf("/")+1)+relativeParts.path;builtParts.path=URLToolkit.normalizePath(newPath)}}}if(null===builtParts.path){builtParts.path=opts.alwaysNormalize?URLToolkit.normalizePath(relativeParts.path):relativeParts.path}return URLToolkit.buildURLFromParts(builtParts)},parseURL:function(url){var parts=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/.exec(url);if(!parts){return null}return{scheme:parts[1]||"",netLoc:parts[2]||"",path:parts[3]||"",params:parts[4]||"",query:parts[5]||"",fragment:parts[6]||""}},normalizePath:function(path){path=path.split("").reverse().join("").replace(/(?:\/|^)\.(?=\/)/g,"");while(path.length!==(path=path.replace(/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,"")).length){}return path.split("").reverse().join("")},buildURLFromParts:function(parts){return parts.scheme+parts.netLoc+parts.path+parts.params+parts.query+parts.fragment}};module.exports=URLToolkit})()});function _extends(){_extends=Object.assign||function(target){for(var i=1,source;i<arguments.length;i++){source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function _inheritsLoose$1(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;subClass.__proto__=superClass}function _assertThisInitialized$1(self){if(void 0===self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}var Stream=function(){function Stream(){this.listeners={}}var _proto=Stream.prototype;_proto.on=function(type,listener){if(!this.listeners[type]){this.listeners[type]=[]}this.listeners[type].push(listener)};_proto.off=function(type,listener){if(!this.listeners[type]){return!1}var index=this.listeners[type].indexOf(listener);this.listeners[type].splice(index,1);return-1<index};_proto.trigger=function(type){var callbacks=this.listeners[type],i,length,args;if(!callbacks){return}if(2===arguments.length){length=callbacks.length;for(i=0;i<length;++i){callbacks[i].call(this,arguments[1])}}else{args=Array.prototype.slice.call(arguments,1);length=callbacks.length;for(i=0;i<length;++i){callbacks[i].apply(this,args)}}};_proto.dispose=function(){this.listeners={}};_proto.pipe=function(destination){this.on("data",function(data){destination.push(data)})};return Stream}(),LineStream=function(_Stream){_inheritsLoose$1(LineStream,_Stream);function LineStream(){var _this=_Stream.call(this)||this;_this.buffer="";return _this}var _proto=LineStream.prototype;_proto.push=function(data){var nextNewline;this.buffer+=data;nextNewline=this.buffer.indexOf("\n");for(;-1<nextNewline;nextNewline=this.buffer.indexOf("\n")){this.trigger("data",this.buffer.substring(0,nextNewline));this.buffer=this.buffer.substring(nextNewline+1)}};return LineStream}(Stream),attributeSeparator=function(){return new RegExp("(?:^|,)("+("(?:[^=]*)=(?:"+"\"[^\"]*\"|[^,]*"+")")+")")},parseAttributes=function(attributes){var attrs=attributes.split(attributeSeparator()),result={},i=attrs.length,attr;while(i--){if(""===attrs[i]){continue}attr=/([^=]*)=(.*)/.exec(attrs[i]).slice(1);attr[0]=attr[0].replace(/^\s+|\s+$/g,"");attr[1]=attr[1].replace(/^\s+|\s+$/g,"");attr[1]=attr[1].replace(/^['"](.*)['"]$/g,"$1");result[attr[0]]=attr[1]}return result},ParseStream=function(_Stream){_inheritsLoose$1(ParseStream,_Stream);function ParseStream(){var _this=_Stream.call(this)||this;_this.customParsers=[];_this.tagMappers=[];return _this}var _proto=ParseStream.prototype;_proto.push=function(line){var _this2=this,match,event;line=line.trim();if(0===line.length){return}if("#"!==line[0]){this.trigger("data",{type:"uri",uri:line});return}var newLines=this.tagMappers.reduce(function(acc,mapper){var mappedLine=mapper(line);if(mappedLine===line){return acc}return acc.concat([mappedLine])},[line]);newLines.forEach(function(newLine){for(var i=0;i<_this2.customParsers.length;i++){if(_this2.customParsers[i].call(_this2,newLine)){return}}if(0!==newLine.indexOf("#EXT")){_this2.trigger("data",{type:"comment",text:newLine.slice(1)});return}newLine=newLine.replace("\r","");match=/^#EXTM3U/.exec(newLine);if(match){_this2.trigger("data",{type:"tag",tagType:"m3u"});return}match=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(newLine);if(match){event={type:"tag",tagType:"inf"};if(match[1]){event.duration=parseFloat(match[1])}if(match[2]){event.title=match[2]}_this2.trigger("data",event);return}match=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(newLine);if(match){event={type:"tag",tagType:"targetduration"};if(match[1]){event.duration=parseInt(match[1],10)}_this2.trigger("data",event);return}match=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(newLine);if(match){event={type:"tag",tagType:"totalduration"};if(match[1]){event.duration=parseInt(match[1],10)}_this2.trigger("data",event);return}match=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(newLine);if(match){event={type:"tag",tagType:"version"};if(match[1]){event.version=parseInt(match[1],10)}_this2.trigger("data",event);return}match=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(newLine);if(match){event={type:"tag",tagType:"media-sequence"};if(match[1]){event.number=parseInt(match[1],10)}_this2.trigger("data",event);return}match=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(newLine);if(match){event={type:"tag",tagType:"discontinuity-sequence"};if(match[1]){event.number=parseInt(match[1],10)}_this2.trigger("data",event);return}match=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(newLine);if(match){event={type:"tag",tagType:"playlist-type"};if(match[1]){event.playlistType=match[1]}_this2.trigger("data",event);return}match=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(newLine);if(match){event={type:"tag",tagType:"byterange"};if(match[1]){event.length=parseInt(match[1],10)}if(match[2]){event.offset=parseInt(match[2],10)}_this2.trigger("data",event);return}match=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(newLine);if(match){event={type:"tag",tagType:"allow-cache"};if(match[1]){event.allowed=!/NO/.test(match[1])}_this2.trigger("data",event);return}match=/^#EXT-X-MAP:?(.*)$/.exec(newLine);if(match){event={type:"tag",tagType:"map"};if(match[1]){var attributes=parseAttributes(match[1]);if(attributes.URI){event.uri=attributes.URI}if(attributes.BYTERANGE){var _attributes$BYTERANGE=attributes.BYTERANGE.split("@"),length=_attributes$BYTERANGE[0],offset=_attributes$BYTERANGE[1];event.byterange={};if(length){event.byterange.length=parseInt(length,10)}if(offset){event.byterange.offset=parseInt(offset,10)}}}_this2.trigger("data",event);return}match=/^#EXT-X-STREAM-INF:?(.*)$/.exec(newLine);if(match){event={type:"tag",tagType:"stream-inf"};if(match[1]){event.attributes=parseAttributes(match[1]);if(event.attributes.RESOLUTION){var split=event.attributes.RESOLUTION.split("x"),resolution={};if(split[0]){resolution.width=parseInt(split[0],10)}if(split[1]){resolution.height=parseInt(split[1],10)}event.attributes.RESOLUTION=resolution}if(event.attributes.BANDWIDTH){event.attributes.BANDWIDTH=parseInt(event.attributes.BANDWIDTH,10)}if(event.attributes["PROGRAM-ID"]){event.attributes["PROGRAM-ID"]=parseInt(event.attributes["PROGRAM-ID"],10)}}_this2.trigger("data",event);return}match=/^#EXT-X-MEDIA:?(.*)$/.exec(newLine);if(match){event={type:"tag",tagType:"media"};if(match[1]){event.attributes=parseAttributes(match[1])}_this2.trigger("data",event);return}match=/^#EXT-X-ENDLIST/.exec(newLine);if(match){_this2.trigger("data",{type:"tag",tagType:"endlist"});return}match=/^#EXT-X-DISCONTINUITY/.exec(newLine);if(match){_this2.trigger("data",{type:"tag",tagType:"discontinuity"});return}match=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(newLine);if(match){event={type:"tag",tagType:"program-date-time"};if(match[1]){event.dateTimeString=match[1];event.dateTimeObject=new Date(match[1])}_this2.trigger("data",event);return}match=/^#EXT-X-KEY:?(.*)$/.exec(newLine);if(match){event={type:"tag",tagType:"key"};if(match[1]){event.attributes=parseAttributes(match[1]);if(event.attributes.IV){if("0x"===event.attributes.IV.substring(0,2).toLowerCase()){event.attributes.IV=event.attributes.IV.substring(2)}event.attributes.IV=event.attributes.IV.match(/.{8}/g);event.attributes.IV[0]=parseInt(event.attributes.IV[0],16);event.attributes.IV[1]=parseInt(event.attributes.IV[1],16);event.attributes.IV[2]=parseInt(event.attributes.IV[2],16);event.attributes.IV[3]=parseInt(event.attributes.IV[3],16);event.attributes.IV=new Uint32Array(event.attributes.IV)}}_this2.trigger("data",event);return}match=/^#EXT-X-START:?(.*)$/.exec(newLine);if(match){event={type:"tag",tagType:"start"};if(match[1]){event.attributes=parseAttributes(match[1]);event.attributes["TIME-OFFSET"]=parseFloat(event.attributes["TIME-OFFSET"]);event.attributes.PRECISE=/YES/.test(event.attributes.PRECISE)}_this2.trigger("data",event);return}match=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(newLine);if(match){event={type:"tag",tagType:"cue-out-cont"};if(match[1]){event.data=match[1]}else{event.data=""}_this2.trigger("data",event);return}match=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(newLine);if(match){event={type:"tag",tagType:"cue-out"};if(match[1]){event.data=match[1]}else{event.data=""}_this2.trigger("data",event);return}match=/^#EXT-X-CUE-IN:?(.*)?$/.exec(newLine);if(match){event={type:"tag",tagType:"cue-in"};if(match[1]){event.data=match[1]}else{event.data=""}_this2.trigger("data",event);return}_this2.trigger("data",{type:"tag",data:newLine.slice(4)})})};_proto.addParser=function(_ref){var _this3=this,expression=_ref.expression,customType=_ref.customType,dataParser=_ref.dataParser,segment=_ref.segment;if("function"!=typeof dataParser){dataParser=function(line){return line}}this.customParsers.push(function(line){var match=expression.exec(line);if(match){_this3.trigger("data",{type:"custom",data:dataParser(line),customType:customType,segment:segment});return!0}})};_proto.addTagMapper=function(_ref2){var expression=_ref2.expression,map=_ref2.map;this.tagMappers.push(function(line){if(expression.test(line)){return map(line)}return line})};return ParseStream}(Stream);function decodeB64ToUint8Array(b64Text){for(var decodedString=window$3.atob(b64Text||""),array=new Uint8Array(decodedString.length),i=0;i<decodedString.length;i++){array[i]=decodedString.charCodeAt(i)}return array}var Parser=function(_Stream){_inheritsLoose$1(Parser,_Stream);function Parser(){var _this=_Stream.call(this)||this;_this.lineStream=new LineStream;_this.parseStream=new ParseStream;_this.lineStream.pipe(_this.parseStream);var self=_assertThisInitialized$1(_this),uris=[],currentUri={},currentMap,_key,noop=function(){},defaultMediaGroups={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},currentTimeline=0;_this.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};_this.parseStream.on("data",function(entry){var mediaGroup,rendition;({tag:function(){(({"allow-cache":function(){this.manifest.allowCache=entry.allowed;if(!("allowed"in entry)){this.trigger("info",{message:"defaulting allowCache to YES"});this.manifest.allowCache=!0}},byterange:function byterange(){var byterange={};if("length"in entry){currentUri.byterange=byterange;byterange.length=entry.length;if(!("offset"in entry)){this.trigger("info",{message:"defaulting offset to zero"});entry.offset=0}}if("offset"in entry){currentUri.byterange=byterange;byterange.offset=entry.offset}},endlist:function(){this.manifest.endList=!0},inf:function(){if(!("mediaSequence"in this.manifest)){this.manifest.mediaSequence=0;this.trigger("info",{message:"defaulting media sequence to zero"})}if(!("discontinuitySequence"in this.manifest)){this.manifest.discontinuitySequence=0;this.trigger("info",{message:"defaulting discontinuity sequence to zero"})}if(0<entry.duration){currentUri.duration=entry.duration}if(0===entry.duration){currentUri.duration=.01;this.trigger("info",{message:"updating zero segment duration to a small value"})}this.manifest.segments=uris},key:function(){if(!entry.attributes){this.trigger("warn",{message:"ignoring key declaration without attribute list"});return}if("NONE"===entry.attributes.METHOD){_key=null;return}if(!entry.attributes.URI){this.trigger("warn",{message:"ignoring key declaration without URI"});return}if(entry.attributes.KEYFORMAT==="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"){if(-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(entry.attributes.METHOD)){this.trigger("warn",{message:"invalid key method provided for Widevine"});return}if("SAMPLE-AES-CENC"===entry.attributes.METHOD){this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"})}if("data:text/plain;base64,"!==entry.attributes.URI.substring(0,23)){this.trigger("warn",{message:"invalid key URI provided for Widevine"});return}if(!(entry.attributes.KEYID&&"0x"===entry.attributes.KEYID.substring(0,2))){this.trigger("warn",{message:"invalid key ID provided for Widevine"});return}this.manifest.contentProtection={"com.widevine.alpha":{attributes:{schemeIdUri:entry.attributes.KEYFORMAT,keyId:entry.attributes.KEYID.substring(2)},pssh:decodeB64ToUint8Array(entry.attributes.URI.split(",")[1])}};return}if(!entry.attributes.METHOD){this.trigger("warn",{message:"defaulting key method to AES-128"})}_key={method:entry.attributes.METHOD||"AES-128",uri:entry.attributes.URI};if("undefined"!=typeof entry.attributes.IV){_key.iv=entry.attributes.IV}},"media-sequence":function(){if(!isFinite(entry.number)){this.trigger("warn",{message:"ignoring invalid media sequence: "+entry.number});return}this.manifest.mediaSequence=entry.number},"discontinuity-sequence":function(){if(!isFinite(entry.number)){this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+entry.number});return}this.manifest.discontinuitySequence=entry.number;currentTimeline=entry.number},"playlist-type":function(){if(!/VOD|EVENT/.test(entry.playlistType)){this.trigger("warn",{message:"ignoring unknown playlist type: "+entry.playlist});return}this.manifest.playlistType=entry.playlistType},map:function(){currentMap={};if(entry.uri){currentMap.uri=entry.uri}if(entry.byterange){currentMap.byterange=entry.byterange}},"stream-inf":function(){this.manifest.playlists=uris;this.manifest.mediaGroups=this.manifest.mediaGroups||defaultMediaGroups;if(!entry.attributes){this.trigger("warn",{message:"ignoring empty stream-inf attributes"});return}if(!currentUri.attributes){currentUri.attributes={}}_extends(currentUri.attributes,entry.attributes)},media:function(){this.manifest.mediaGroups=this.manifest.mediaGroups||defaultMediaGroups;if(!(entry.attributes&&entry.attributes.TYPE&&entry.attributes["GROUP-ID"]&&entry.attributes.NAME)){this.trigger("warn",{message:"ignoring incomplete or missing media group"});return}var mediaGroupType=this.manifest.mediaGroups[entry.attributes.TYPE];mediaGroupType[entry.attributes["GROUP-ID"]]=mediaGroupType[entry.attributes["GROUP-ID"]]||{};mediaGroup=mediaGroupType[entry.attributes["GROUP-ID"]];rendition={default:/yes/i.test(entry.attributes.DEFAULT)};if(rendition["default"]){rendition.autoselect=!0}else{rendition.autoselect=/yes/i.test(entry.attributes.AUTOSELECT)}if(entry.attributes.LANGUAGE){rendition.language=entry.attributes.LANGUAGE}if(entry.attributes.URI){rendition.uri=entry.attributes.URI}if(entry.attributes["INSTREAM-ID"]){rendition.instreamId=entry.attributes["INSTREAM-ID"]}if(entry.attributes.CHARACTERISTICS){rendition.characteristics=entry.attributes.CHARACTERISTICS}if(entry.attributes.FORCED){rendition.forced=/yes/i.test(entry.attributes.FORCED)}mediaGroup[entry.attributes.NAME]=rendition},discontinuity:function(){currentTimeline+=1;currentUri.discontinuity=!0;this.manifest.discontinuityStarts.push(uris.length)},"program-date-time":function(){if("undefined"==typeof this.manifest.dateTimeString){this.manifest.dateTimeString=entry.dateTimeString;this.manifest.dateTimeObject=entry.dateTimeObject}currentUri.dateTimeString=entry.dateTimeString;currentUri.dateTimeObject=entry.dateTimeObject},targetduration:function(){if(!isFinite(entry.duration)||0>entry.duration){this.trigger("warn",{message:"ignoring invalid target duration: "+entry.duration});return}this.manifest.targetDuration=entry.duration},totalduration:function(){if(!isFinite(entry.duration)||0>entry.duration){this.trigger("warn",{message:"ignoring invalid total duration: "+entry.duration});return}this.manifest.totalDuration=entry.duration},start:function(){if(!entry.attributes||isNaN(entry.attributes["TIME-OFFSET"])){this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"});return}this.manifest.start={timeOffset:entry.attributes["TIME-OFFSET"],precise:entry.attributes.PRECISE}},"cue-out":function(){currentUri.cueOut=entry.data},"cue-out-cont":function(){currentUri.cueOutCont=entry.data},"cue-in":function(){currentUri.cueIn=entry.data}})[entry.tagType]||noop).call(self)},uri:function(){currentUri.uri=entry.uri;uris.push(currentUri);if(this.manifest.targetDuration&&!("duration"in currentUri)){this.trigger("warn",{message:"defaulting segment duration to the target duration"});currentUri.duration=this.manifest.targetDuration}if(_key){currentUri.key=_key}currentUri.timeline=currentTimeline;if(currentMap){currentUri.map=currentMap}currentUri={}},comment:function(){},custom:function(){if(entry.segment){currentUri.custom=currentUri.custom||{};currentUri.custom[entry.customType]=entry.data}else{this.manifest.custom=this.manifest.custom||{};this.manifest.custom[entry.customType]=entry.data}}})[entry.type].call(self)});return _this}var _proto=Parser.prototype;_proto.push=function(chunk){this.lineStream.push(chunk)};_proto.end=function(){this.lineStream.push("\n")};_proto.addParser=function(options){this.parseStream.addParser(options)};_proto.addTagMapper=function(options){this.parseStream.addTagMapper(options)};return Parser}(Stream);function _interopDefault(ex){return ex&&"object"===_typeof2(ex)&&"default"in ex?ex["default"]:ex}var URLToolkit=_interopDefault(urlToolkit),window$1=_interopDefault(window$3),resolveUrl_1=function(baseUrl,relativeUrl){if(/^[a-z]+:/i.test(relativeUrl)){return relativeUrl}if(!/\/\//i.test(baseUrl)){baseUrl=URLToolkit.buildAbsoluteURL(window$1.location&&window$1.location.href||"",baseUrl)}return URLToolkit.buildAbsoluteURL(baseUrl,relativeUrl)};function _interopDefault$1(ex){return ex&&"object"===_typeof2(ex)&&"default"in ex?ex["default"]:ex}var window$2=_interopDefault$1(window$3),atob=function(s){return window$2.atob?window$2.atob(s):Buffer.from(s,"base64").toString("binary")};function decodeB64ToUint8Array$1(b64Text){for(var decodedString=atob(b64Text),array=new Uint8Array(decodedString.length),i=0;i<decodedString.length;i++){array[i]=decodedString.charCodeAt(i)}return array}var nameStartChar=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,nameChar=new RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),tagNamePattern=new RegExp("^"+nameStartChar.source+nameChar.source+"*(?::"+nameStartChar.source+nameChar.source+"*)?$"),S_TAG=0,S_ATTR=1,S_ATTR_SPACE=2,S_EQ=3,S_ATTR_NOQUOT_VALUE=4,S_ATTR_END=5,S_TAG_SPACE=6,S_TAG_CLOSE=7;function XMLReader(){}XMLReader.prototype={parse:function(source,defaultNSMap,entityMap){var domBuilder=this.domBuilder;domBuilder.startDocument();_copy(defaultNSMap,defaultNSMap={});_parse(source,defaultNSMap,entityMap,domBuilder,this.errorHandler);domBuilder.endDocument()}};function _parse(source,defaultNSMapCopy,entityMap,domBuilder,errorHandler){function fixedFromCharCode(code){if(65535<code){code-=65536;var surrogate1=55296+(code>>10),surrogate2=56320+(1023&code);return String.fromCharCode(surrogate1,surrogate2)}else{return String.fromCharCode(code)}}function entityReplacer(a){var k=a.slice(1,-1);if(k in entityMap){return entityMap[k]}else if("#"===k.charAt(0)){return fixedFromCharCode(parseInt(k.substr(1).replace("x","0x")))}else{errorHandler.error("entity not found:"+a);return a}}function appendText(end){if(end>start){var xt=source.substring(start,end).replace(/&#?\w+;/g,entityReplacer);locator&&position(start);domBuilder.characters(xt,0,end-start);start=end}}function position(p,m){while(p>=lineEnd&&(m=linePattern.exec(source))){lineStart=m.index;lineEnd=lineStart+m[0].length;locator.lineNumber++}locator.columnNumber=p-lineStart+1}var lineStart=0,lineEnd=0,linePattern=/.*(?:\r\n?|\n)|.*$/g,locator=domBuilder.locator,parseStack=[{currentNSMap:defaultNSMapCopy}],closeMap={},start=0;while(!0){try{var tagStart=source.indexOf("<",start);if(0>tagStart){if(!source.substr(start).match(/^\s*$/)){var doc=domBuilder.doc,text=doc.createTextNode(source.substr(start));doc.appendChild(text);domBuilder.currentElement=text}return}if(tagStart>start){appendText(tagStart)}switch(source.charAt(tagStart+1)){case"/":var end=source.indexOf(">",tagStart+3),tagName=source.substring(tagStart+2,end),config=parseStack.pop();if(0>end){tagName=source.substring(tagStart+2).replace(/[\s<].*/,"");errorHandler.error("end tag name: "+tagName+" is not complete:"+config.tagName);end=tagStart+1+tagName.length}else if(tagName.match(/\s</)){tagName=tagName.replace(/[\s<].*/,"");errorHandler.error("end tag name: "+tagName+" maybe not complete");end=tagStart+1+tagName.length}var localNSMap=config.localNSMap,endMatch=config.tagName==tagName,endIgnoreCaseMach=endMatch||config.tagName&&config.tagName.toLowerCase()==tagName.toLowerCase();if(endIgnoreCaseMach){domBuilder.endElement(config.uri,config.localName,tagName);if(localNSMap){for(var prefix in localNSMap){domBuilder.endPrefixMapping(prefix)}}if(!endMatch){errorHandler.fatalError("end tag name: "+tagName+" is not match the current start tagName:"+config.tagName)}}else{parseStack.push(config)}end++;break;case"?":locator&&position(tagStart);end=parseInstruction(source,tagStart,domBuilder);break;case"!":locator&&position(tagStart);end=parseDCC(source,tagStart,domBuilder,errorHandler);break;default:locator&&position(tagStart);var el=new ElementAttributes,currentNSMap=parseStack[parseStack.length-1].currentNSMap,end=parseElementStartPart(source,tagStart,el,currentNSMap,entityReplacer,errorHandler),len=el.length;if(!el.closed&&fixSelfClosed(source,end,el.tagName,closeMap)){el.closed=!0;if(!entityMap.nbsp){errorHandler.warning("unclosed xml attribute")}}if(locator&&len){for(var locator2=copyLocator(locator,{}),i=0,a;i<len;i++){a=el[i];position(a.offset);a.locator=copyLocator(locator,{})}domBuilder.locator=locator2;if(appendElement(el,domBuilder,currentNSMap)){parseStack.push(el)}domBuilder.locator=locator}else{if(appendElement(el,domBuilder,currentNSMap)){parseStack.push(el)}}if("http://www.w3.org/1999/xhtml"===el.uri&&!el.closed){end=parseHtmlSpecialContent(source,end,el.tagName,entityReplacer,domBuilder)}else{end++}}}catch(e){errorHandler.error("element parse error: "+e);end=-1}if(end>start){start=end}else{appendText(Math.max(tagStart,start)+1)}}}function copyLocator(f,t){t.lineNumber=f.lineNumber;t.columnNumber=f.columnNumber;return t}function parseElementStartPart(source,start,el,currentNSMap,entityReplacer,errorHandler){var attrName,value,p=++start,s=S_TAG;while(!0){var c=source.charAt(p);switch(c){case"=":if(s===S_ATTR){attrName=source.slice(start,p);s=S_EQ}else if(s===S_ATTR_SPACE){s=S_EQ}else{throw new Error("attribute equal must after attrName")}break;case"'":case"\"":if(s===S_EQ||s===S_ATTR){if(s===S_ATTR){errorHandler.warning("attribute value must after \"=\"");attrName=source.slice(start,p)}start=p+1;p=source.indexOf(c,start);if(0<p){value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer);el.add(attrName,value,start-1);s=S_ATTR_END}else{throw new Error("attribute value no end '"+c+"' match")}}else if(s==S_ATTR_NOQUOT_VALUE){value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer);el.add(attrName,value,start);errorHandler.warning("attribute \""+attrName+"\" missed start quot("+c+")!!");start=p+1;s=S_ATTR_END}else{throw new Error("attribute value must after \"=\"")}break;case"/":switch(s){case S_TAG:el.setTagName(source.slice(start,p));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:s=S_TAG_CLOSE;el.closed=!0;case S_ATTR_NOQUOT_VALUE:case S_ATTR:case S_ATTR_SPACE:break;default:throw new Error("attribute invalid close char('/')");}break;case"":errorHandler.error("unexpected end of input");if(s==S_TAG){el.setTagName(source.slice(start,p))}return p;case">":switch(s){case S_TAG:el.setTagName(source.slice(start,p));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:break;case S_ATTR_NOQUOT_VALUE:case S_ATTR:value=source.slice(start,p);if("/"===value.slice(-1)){el.closed=!0;value=value.slice(0,-1)}case S_ATTR_SPACE:if(s===S_ATTR_SPACE){value=attrName}if(s==S_ATTR_NOQUOT_VALUE){errorHandler.warning("attribute \""+value+"\" missed quot(\")!!");el.add(attrName,value.replace(/&#?\w+;/g,entityReplacer),start)}else{if("http://www.w3.org/1999/xhtml"!==currentNSMap[""]||!value.match(/^(?:disabled|checked|selected)$/i)){errorHandler.warning("attribute \""+value+"\" missed value!! \""+value+"\" instead!!")}el.add(value,value,start)}break;case S_EQ:throw new Error("attribute value missed!!");}return p;case"\x80":c=" ";default:if(" ">=c){switch(s){case S_TAG:el.setTagName(source.slice(start,p));s=S_TAG_SPACE;break;case S_ATTR:attrName=source.slice(start,p);s=S_ATTR_SPACE;break;case S_ATTR_NOQUOT_VALUE:var value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer);errorHandler.warning("attribute \""+value+"\" missed quot(\")!!");el.add(attrName,value,start);case S_ATTR_END:s=S_TAG_SPACE;break;}}else{switch(s){case S_ATTR_SPACE:el.tagName;if("http://www.w3.org/1999/xhtml"!==currentNSMap[""]||!attrName.match(/^(?:disabled|checked|selected)$/i)){errorHandler.warning("attribute \""+attrName+"\" missed value!! \""+attrName+"\" instead2!!")}el.add(attrName,attrName,start);start=p;s=S_ATTR;break;case S_ATTR_END:errorHandler.warning("attribute space is required\""+attrName+"\"!!");case S_TAG_SPACE:s=S_ATTR;start=p;break;case S_EQ:s=S_ATTR_NOQUOT_VALUE;start=p;break;case S_TAG_CLOSE:throw new Error("elements closed character '/' and '>' must be connected to");}}}p++}}function appendElement(el,domBuilder,currentNSMap){var tagName=el.tagName,localNSMap=null,i=el.length;while(i--){var a=el[i],qName=a.qName,value=a.value,nsp=qName.indexOf(":");if(0<nsp){var prefix=a.prefix=qName.slice(0,nsp),localName=qName.slice(nsp+1),nsPrefix="xmlns"===prefix&&localName}else{localName=qName;prefix=null;nsPrefix="xmlns"===qName&&""}a.localName=localName;if(!1!==nsPrefix){if(null==localNSMap){localNSMap={};_copy(currentNSMap,currentNSMap={})}currentNSMap[nsPrefix]=localNSMap[nsPrefix]=value;a.uri="http://www.w3.org/2000/xmlns/";domBuilder.startPrefixMapping(nsPrefix,value)}}var i=el.length;while(i--){a=el[i];var prefix=a.prefix;if(prefix){if("xml"===prefix){a.uri="http://www.w3.org/XML/1998/namespace"}if("xmlns"!==prefix){a.uri=currentNSMap[prefix||""]}}}var nsp=tagName.indexOf(":");if(0<nsp){prefix=el.prefix=tagName.slice(0,nsp);localName=el.localName=tagName.slice(nsp+1)}else{prefix=null;localName=el.localName=tagName}var ns=el.uri=currentNSMap[prefix||""];domBuilder.startElement(ns,localName,tagName,el);if(el.closed){domBuilder.endElement(ns,localName,tagName);if(localNSMap){for(prefix in localNSMap){domBuilder.endPrefixMapping(prefix)}}}else{el.currentNSMap=currentNSMap;el.localNSMap=localNSMap;return!0}}function parseHtmlSpecialContent(source,elStartEnd,tagName,entityReplacer,domBuilder){if(/^(?:script|textarea)$/i.test(tagName)){var elEndStart=source.indexOf("</"+tagName+">",elStartEnd),text=source.substring(elStartEnd+1,elEndStart);if(/[&<]/.test(text)){if(/^script$/i.test(tagName)){domBuilder.characters(text,0,text.length);return elEndStart}text=text.replace(/&#?\w+;/g,entityReplacer);domBuilder.characters(text,0,text.length);return elEndStart}}return elStartEnd+1}function fixSelfClosed(source,elStartEnd,tagName,closeMap){var pos=closeMap[tagName];if(null==pos){pos=source.lastIndexOf("</"+tagName+">");if(pos<elStartEnd){pos=source.lastIndexOf("</"+tagName)}closeMap[tagName]=pos}return pos<elStartEnd}function _copy(source,target){for(var n in source){target[n]=source[n]}}function parseDCC(source,start,domBuilder,errorHandler){var next=source.charAt(start+2);switch(next){case"-":if("-"===source.charAt(start+3)){var end=source.indexOf("-->",start+4);if(end>start){domBuilder.comment(source,start+4,end-start-4);return end+3}else{errorHandler.error("Unclosed comment");return-1}}else{return-1}default:if("CDATA["==source.substr(start+3,6)){var end=source.indexOf("]]>",start+9);domBuilder.startCDATA();domBuilder.characters(source,start+9,end-start-9);domBuilder.endCDATA();return end+3}var matchs=split(source,start),len=matchs.length;if(1<len&&/!doctype/i.test(matchs[0][0])){var name=matchs[1][0],pubid=3<len&&/^public$/i.test(matchs[2][0])&&matchs[3][0],sysid=4<len&&matchs[4][0],lastMatch=matchs[len-1];domBuilder.startDTD(name,pubid&&pubid.replace(/^(['"])(.*?)\1$/,"$2"),sysid&&sysid.replace(/^(['"])(.*?)\1$/,"$2"));domBuilder.endDTD();return lastMatch.index+lastMatch[0].length}}return-1}function parseInstruction(source,start,domBuilder){var end=source.indexOf("?>",start);if(end){var match=source.substring(start,end).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(match){match[0].length;domBuilder.processingInstruction(match[1],match[2]);return end+2}else{return-1}}return-1}function ElementAttributes(){}ElementAttributes.prototype={setTagName:function(tagName){if(!tagNamePattern.test(tagName)){throw new Error("invalid tagName:"+tagName)}this.tagName=tagName},add:function(qName,value,offset){if(!tagNamePattern.test(qName)){throw new Error("invalid attribute:"+qName)}this[this.length++]={qName:qName,value:value,offset:offset}},length:0,getLocalName:function(i){return this[i].localName},getLocator:function(i){return this[i].locator},getQName:function(i){return this[i].qName},getURI:function(i){return this[i].uri},getValue:function(i){return this[i].value}};function _set_proto_(thiz,parent){thiz.__proto__=parent;return thiz}if(!(_set_proto_({},_set_proto_.prototype)instanceof _set_proto_)){_set_proto_=function(thiz,parent){function p(){}p.prototype=parent;p=new p;for(parent in thiz){p[parent]=thiz[parent]}return p}}function split(source,start){var match,buf=[],reg=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;reg.lastIndex=start;reg.exec(source);while(match=reg.exec(source)){buf.push(match);if(match[1])return buf}}var sax={XMLReader:XMLReader};function copy(src,dest){for(var p in src){dest[p]=src[p]}}function _extends$1(Class,Super){var pt=Class.prototype;if(Object.create){var ppt=Object.create(Super.prototype);pt.__proto__=ppt}if(!(pt instanceof Super)){var t=function(){};t.prototype=Super.prototype;t=new t;copy(pt,t);Class.prototype=pt=t}if(pt.constructor!=Class){if("function"!=typeof Class){console.error("unknow Class:"+Class)}pt.constructor=Class}}var NodeType={},ELEMENT_NODE=NodeType.ELEMENT_NODE=1,ATTRIBUTE_NODE=NodeType.ATTRIBUTE_NODE=2,TEXT_NODE=NodeType.TEXT_NODE=3,CDATA_SECTION_NODE=NodeType.CDATA_SECTION_NODE=4,ENTITY_REFERENCE_NODE=NodeType.ENTITY_REFERENCE_NODE=5,ENTITY_NODE=NodeType.ENTITY_NODE=6,PROCESSING_INSTRUCTION_NODE=NodeType.PROCESSING_INSTRUCTION_NODE=7,COMMENT_NODE=NodeType.COMMENT_NODE=8,DOCUMENT_NODE=NodeType.DOCUMENT_NODE=9,DOCUMENT_TYPE_NODE=NodeType.DOCUMENT_TYPE_NODE=10,DOCUMENT_FRAGMENT_NODE=NodeType.DOCUMENT_FRAGMENT_NODE=11,NOTATION_NODE=NodeType.NOTATION_NODE=12,ExceptionCode={},ExceptionMessage={},INDEX_SIZE_ERR=ExceptionCode.INDEX_SIZE_ERR=(ExceptionMessage[1]="Index size error",1),DOMSTRING_SIZE_ERR=ExceptionCode.DOMSTRING_SIZE_ERR=(ExceptionMessage[2]="DOMString size error",2),HIERARCHY_REQUEST_ERR=ExceptionCode.HIERARCHY_REQUEST_ERR=(ExceptionMessage[3]="Hierarchy request error",3),WRONG_DOCUMENT_ERR=ExceptionCode.WRONG_DOCUMENT_ERR=(ExceptionMessage[4]="Wrong document",4),INVALID_CHARACTER_ERR=ExceptionCode.INVALID_CHARACTER_ERR=(ExceptionMessage[5]="Invalid character",5),NO_DATA_ALLOWED_ERR=ExceptionCode.NO_DATA_ALLOWED_ERR=(ExceptionMessage[6]="No data allowed",6),NO_MODIFICATION_ALLOWED_ERR=ExceptionCode.NO_MODIFICATION_ALLOWED_ERR=(ExceptionMessage[7]="No modification allowed",7),NOT_FOUND_ERR=ExceptionCode.NOT_FOUND_ERR=(ExceptionMessage[8]="Not found",8),NOT_SUPPORTED_ERR=ExceptionCode.NOT_SUPPORTED_ERR=(ExceptionMessage[9]="Not supported",9),INUSE_ATTRIBUTE_ERR=ExceptionCode.INUSE_ATTRIBUTE_ERR=(ExceptionMessage[10]="Attribute in use",10),INVALID_STATE_ERR=ExceptionCode.INVALID_STATE_ERR=(ExceptionMessage[11]="Invalid state",11),SYNTAX_ERR=ExceptionCode.SYNTAX_ERR=(ExceptionMessage[12]="Syntax error",12),INVALID_MODIFICATION_ERR=ExceptionCode.INVALID_MODIFICATION_ERR=(ExceptionMessage[13]="Invalid modification",13),NAMESPACE_ERR=ExceptionCode.NAMESPACE_ERR=(ExceptionMessage[14]="Invalid namespace",14),INVALID_ACCESS_ERR=ExceptionCode.INVALID_ACCESS_ERR=(ExceptionMessage[15]="Invalid access",15);function DOMException(code,message){if(message instanceof Error){var error=message}else{error=this;Error.call(this,ExceptionMessage[code]);this.message=ExceptionMessage[code];if(Error.captureStackTrace)Error.captureStackTrace(this,DOMException)}error.code=code;if(message)this.message=this.message+": "+message;return error}DOMException.prototype=Error.prototype;copy(ExceptionCode,DOMException);function NodeList(){}NodeList.prototype={length:0,item:function(index){return this[index]||null},toString:function(isHTML,nodeFilter){for(var buf=[],i=0;i<this.length;i++){serializeToString(this[i],buf,isHTML,nodeFilter)}return buf.join("")}};function LiveNodeList(node,refresh){this._node=node;this._refresh=refresh;_updateLiveList(this)}function _updateLiveList(list){var inc=list._node._inc||list._node.ownerDocument._inc;if(list._inc!=inc){var ls=list._refresh(list._node);__set__(list,"length",ls.length);copy(ls,list);list._inc=inc}}LiveNodeList.prototype.item=function(i){_updateLiveList(this);return this[i]};_extends$1(LiveNodeList,NodeList);function NamedNodeMap(){}function _findNodeIndex(list,node){var i=list.length;while(i--){if(list[i]===node){return i}}}function _addNamedNode(el,list,newAttr,oldAttr){if(oldAttr){list[_findNodeIndex(list,oldAttr)]=newAttr}else{list[list.length++]=newAttr}if(el){newAttr.ownerElement=el;var doc=el.ownerDocument;if(doc){oldAttr&&_onRemoveAttribute(doc,el,oldAttr);_onAddAttribute(doc,el,newAttr)}}}function _removeNamedNode(el,list,attr){var i=_findNodeIndex(list,attr);if(0<=i){var lastIndex=list.length-1;while(i<lastIndex){list[i]=list[++i]}list.length=lastIndex;if(el){var doc=el.ownerDocument;if(doc){_onRemoveAttribute(doc,el,attr);attr.ownerElement=null}}}else{throw DOMException(NOT_FOUND_ERR,new Error(el.tagName+"@"+attr))}}NamedNodeMap.prototype={length:0,item:NodeList.prototype.item,getNamedItem:function(key){var i=this.length;while(i--){var attr=this[i];if(attr.nodeName==key){return attr}}},setNamedItem:function(attr){var el=attr.ownerElement;if(el&&el!=this._ownerElement){throw new DOMException(INUSE_ATTRIBUTE_ERR)}var oldAttr=this.getNamedItem(attr.nodeName);_addNamedNode(this._ownerElement,this,attr,oldAttr);return oldAttr},setNamedItemNS:function(attr){var el=attr.ownerElement,oldAttr;if(el&&el!=this._ownerElement){throw new DOMException(INUSE_ATTRIBUTE_ERR)}oldAttr=this.getNamedItemNS(attr.namespaceURI,attr.localName);_addNamedNode(this._ownerElement,this,attr,oldAttr);return oldAttr},removeNamedItem:function(key){var attr=this.getNamedItem(key);_removeNamedNode(this._ownerElement,this,attr);return attr},removeNamedItemNS:function(namespaceURI,localName){var attr=this.getNamedItemNS(namespaceURI,localName);_removeNamedNode(this._ownerElement,this,attr);return attr},getNamedItemNS:function(namespaceURI,localName){var i=this.length;while(i--){var node=this[i];if(node.localName==localName&&node.namespaceURI==namespaceURI){return node}}return null}};function DOMImplementation(features){this._features={};if(features){for(var feature in features){this._features=features[feature]}}}DOMImplementation.prototype={hasFeature:function(feature,version){var versions=this._features[feature.toLowerCase()];if(versions&&(!version||version in versions)){return!0}else{return!1}},createDocument:function(namespaceURI,qualifiedName,doctype){var doc=new Document;doc.implementation=this;doc.childNodes=new NodeList;doc.doctype=doctype;if(doctype){doc.appendChild(doctype)}if(qualifiedName){var root=doc.createElementNS(namespaceURI,qualifiedName);doc.appendChild(root)}return doc},createDocumentType:function(qualifiedName,publicId,systemId){var node=new DocumentType;node.name=qualifiedName;node.nodeName=qualifiedName;node.publicId=publicId;node.systemId=systemId;return node}};function Node(){}Node.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(newChild,refChild){return _insertBefore(this,newChild,refChild)},replaceChild:function(newChild,oldChild){this.insertBefore(newChild,oldChild);if(oldChild){this.removeChild(oldChild)}},removeChild:function(oldChild){return _removeChild(this,oldChild)},appendChild:function(newChild){return this.insertBefore(newChild,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(deep){return _cloneNode(this.ownerDocument||this,this,deep)},normalize:function(){var child=this.firstChild;while(child){var next=child.nextSibling;if(next&&next.nodeType==TEXT_NODE&&child.nodeType==TEXT_NODE){this.removeChild(next);child.appendData(next.data)}else{child.normalize();child=next}}},isSupported:function(feature,version){return this.ownerDocument.implementation.hasFeature(feature,version)},hasAttributes:function(){return 0<this.attributes.length},lookupPrefix:function(namespaceURI){var el=this;while(el){var map=el._nsMap;if(map){for(var n in map){if(map[n]==namespaceURI){return n}}}el=el.nodeType==ATTRIBUTE_NODE?el.ownerDocument:el.parentNode}return null},lookupNamespaceURI:function(prefix){var el=this;while(el){var map=el._nsMap;if(map){if(prefix in map){return map[prefix]}}el=el.nodeType==ATTRIBUTE_NODE?el.ownerDocument:el.parentNode}return null},isDefaultNamespace:function(namespaceURI){var prefix=this.lookupPrefix(namespaceURI);return null==prefix}};function _xmlEncoder(c){return"<"==c&&"&lt;"||">"==c&&"&gt;"||"&"==c&&"&amp;"||"\""==c&&"&quot;"||"&#"+c.charCodeAt()+";"}copy(NodeType,Node);copy(NodeType,Node.prototype);function _visitNode(node,callback){if(callback(node)){return!0}if(node=node.firstChild){do{if(_visitNode(node,callback)){return!0}}while(node=node.nextSibling)}}function Document(){}function _onAddAttribute(doc,el,newAttr){doc&&doc._inc++;var ns=newAttr.namespaceURI;if("http://www.w3.org/2000/xmlns/"==ns){el._nsMap[newAttr.prefix?newAttr.localName:""]=newAttr.value}}function _onRemoveAttribute(doc,el,newAttr){doc&&doc._inc++;var ns=newAttr.namespaceURI;if("http://www.w3.org/2000/xmlns/"==ns){delete el._nsMap[newAttr.prefix?newAttr.localName:""]}}function _onUpdateChild(doc,el,newChild){if(doc&&doc._inc){doc._inc++;var cs=el.childNodes;if(newChild){cs[cs.length++]=newChild}else{var child=el.firstChild,i=0;while(child){cs[i++]=child;child=child.nextSibling}cs.length=i}}}function _removeChild(parentNode,child){var previous=child.previousSibling,next=child.nextSibling;if(previous){previous.nextSibling=next}else{parentNode.firstChild=next}if(next){next.previousSibling=previous}else{parentNode.lastChild=previous}_onUpdateChild(parentNode.ownerDocument,parentNode);return child}function _insertBefore(parentNode,newChild,nextChild){var cp=newChild.parentNode;if(cp){cp.removeChild(newChild)}if(newChild.nodeType===DOCUMENT_FRAGMENT_NODE){var newFirst=newChild.firstChild;if(null==newFirst){return newChild}var newLast=newChild.lastChild}else{newFirst=newLast=newChild}var pre=nextChild?nextChild.previousSibling:parentNode.lastChild;newFirst.previousSibling=pre;newLast.nextSibling=nextChild;if(pre){pre.nextSibling=newFirst}else{parentNode.firstChild=newFirst}if(null==nextChild){parentNode.lastChild=newLast}else{nextChild.previousSibling=newLast}do{newFirst.parentNode=parentNode}while(newFirst!==newLast&&(newFirst=newFirst.nextSibling));_onUpdateChild(parentNode.ownerDocument||parentNode,parentNode);if(newChild.nodeType==DOCUMENT_FRAGMENT_NODE){newChild.firstChild=newChild.lastChild=null}return newChild}function _appendSingleChild(parentNode,newChild){var cp=newChild.parentNode;if(cp){var pre=parentNode.lastChild;cp.removeChild(newChild);var pre=parentNode.lastChild}var pre=parentNode.lastChild;newChild.parentNode=parentNode;newChild.previousSibling=pre;newChild.nextSibling=null;if(pre){pre.nextSibling=newChild}else{parentNode.firstChild=newChild}parentNode.lastChild=newChild;_onUpdateChild(parentNode.ownerDocument,parentNode,newChild);return newChild}Document.prototype={nodeName:"#document",nodeType:DOCUMENT_NODE,doctype:null,documentElement:null,_inc:1,insertBefore:function(newChild,refChild){if(newChild.nodeType==DOCUMENT_FRAGMENT_NODE){var child=newChild.firstChild;while(child){var next=child.nextSibling;this.insertBefore(child,refChild);child=next}return newChild}if(null==this.documentElement&&newChild.nodeType==ELEMENT_NODE){this.documentElement=newChild}return _insertBefore(this,newChild,refChild),newChild.ownerDocument=this,newChild},removeChild:function(oldChild){if(this.documentElement==oldChild){this.documentElement=null}return _removeChild(this,oldChild)},importNode:function(importedNode,deep){return _importNode(this,importedNode,deep)},getElementById:function(id){var rtv=null;_visitNode(this.documentElement,function(node){if(node.nodeType==ELEMENT_NODE){if(node.getAttribute("id")==id){rtv=node;return!0}}});return rtv},createElement:function(tagName){var node=new Element;node.ownerDocument=this;node.nodeName=tagName;node.tagName=tagName;node.childNodes=new NodeList;var attrs=node.attributes=new NamedNodeMap;attrs._ownerElement=node;return node},createDocumentFragment:function(){var node=new DocumentFragment;node.ownerDocument=this;node.childNodes=new NodeList;return node},createTextNode:function(data){var node=new Text;node.ownerDocument=this;node.appendData(data);return node},createComment:function(data){var node=new Comment;node.ownerDocument=this;node.appendData(data);return node},createCDATASection:function(data){var node=new CDATASection;node.ownerDocument=this;node.appendData(data);return node},createProcessingInstruction:function(target,data){var node=new ProcessingInstruction;node.ownerDocument=this;node.tagName=node.target=target;node.nodeValue=node.data=data;return node},createAttribute:function(name){var node=new Attr;node.ownerDocument=this;node.name=name;node.nodeName=name;node.localName=name;node.specified=!0;return node},createEntityReference:function(name){var node=new EntityReference;node.ownerDocument=this;node.nodeName=name;return node},createElementNS:function(namespaceURI,qualifiedName){var node=new Element,pl=qualifiedName.split(":"),attrs=node.attributes=new NamedNodeMap;node.childNodes=new NodeList;node.ownerDocument=this;node.nodeName=qualifiedName;node.tagName=qualifiedName;node.namespaceURI=namespaceURI;if(2==pl.length){node.prefix=pl[0];node.localName=pl[1]}else{node.localName=qualifiedName}attrs._ownerElement=node;return node},createAttributeNS:function(namespaceURI,qualifiedName){var node=new Attr,pl=qualifiedName.split(":");node.ownerDocument=this;node.nodeName=qualifiedName;node.name=qualifiedName;node.namespaceURI=namespaceURI;node.specified=!0;if(2==pl.length){node.prefix=pl[0];node.localName=pl[1]}else{node.localName=qualifiedName}return node}};_extends$1(Document,Node);function Element(){this._nsMap={}}Element.prototype={nodeType:ELEMENT_NODE,hasAttribute:function(name){return null!=this.getAttributeNode(name)},getAttribute:function(name){var attr=this.getAttributeNode(name);return attr&&attr.value||""},getAttributeNode:function(name){return this.attributes.getNamedItem(name)},setAttribute:function(name,value){var attr=this.ownerDocument.createAttribute(name);attr.value=attr.nodeValue=""+value;this.setAttributeNode(attr)},removeAttribute:function(name){var attr=this.getAttributeNode(name);attr&&this.removeAttributeNode(attr)},appendChild:function(newChild){if(newChild.nodeType===DOCUMENT_FRAGMENT_NODE){return this.insertBefore(newChild,null)}else{return _appendSingleChild(this,newChild)}},setAttributeNode:function(newAttr){return this.attributes.setNamedItem(newAttr)},setAttributeNodeNS:function(newAttr){return this.attributes.setNamedItemNS(newAttr)},removeAttributeNode:function(oldAttr){return this.attributes.removeNamedItem(oldAttr.nodeName)},removeAttributeNS:function(namespaceURI,localName){var old=this.getAttributeNodeNS(namespaceURI,localName);old&&this.removeAttributeNode(old)},hasAttributeNS:function(namespaceURI,localName){return null!=this.getAttributeNodeNS(namespaceURI,localName)},getAttributeNS:function(namespaceURI,localName){var attr=this.getAttributeNodeNS(namespaceURI,localName);return attr&&attr.value||""},setAttributeNS:function(namespaceURI,qualifiedName,value){var attr=this.ownerDocument.createAttributeNS(namespaceURI,qualifiedName);attr.value=attr.nodeValue=""+value;this.setAttributeNode(attr)},getAttributeNodeNS:function(namespaceURI,localName){return this.attributes.getNamedItemNS(namespaceURI,localName)},getElementsByTagName:function(tagName){return new LiveNodeList(this,function(base){var ls=[];_visitNode(base,function(node){if(node!==base&&node.nodeType==ELEMENT_NODE&&("*"===tagName||node.tagName==tagName)){ls.push(node)}});return ls})},getElementsByTagNameNS:function(namespaceURI,localName){return new LiveNodeList(this,function(base){var ls=[];_visitNode(base,function(node){if(node!==base&&node.nodeType===ELEMENT_NODE&&("*"===namespaceURI||node.namespaceURI===namespaceURI)&&("*"===localName||node.localName==localName)){ls.push(node)}});return ls})}};Document.prototype.getElementsByTagName=Element.prototype.getElementsByTagName;Document.prototype.getElementsByTagNameNS=Element.prototype.getElementsByTagNameNS;_extends$1(Element,Node);function Attr(){}Attr.prototype.nodeType=ATTRIBUTE_NODE;_extends$1(Attr,Node);function CharacterData(){}CharacterData.prototype={data:"",substringData:function(offset,count){return this.data.substring(offset,offset+count)},appendData:function(text){text=this.data+text;this.nodeValue=this.data=text;this.length=text.length},insertData:function(offset,text){this.replaceData(offset,0,text)},appendChild:function(){throw new Error(ExceptionMessage[HIERARCHY_REQUEST_ERR])},deleteData:function(offset,count){this.replaceData(offset,count,"")},replaceData:function(offset,count,text){var start=this.data.substring(0,offset),end=this.data.substring(offset+count);text=start+text+end;this.nodeValue=this.data=text;this.length=text.length}};_extends$1(CharacterData,Node);function Text(){}Text.prototype={nodeName:"#text",nodeType:TEXT_NODE,splitText:function(offset){var text=this.data,newText=text.substring(offset);text=text.substring(0,offset);this.data=this.nodeValue=text;this.length=text.length;var newNode=this.ownerDocument.createTextNode(newText);if(this.parentNode){this.parentNode.insertBefore(newNode,this.nextSibling)}return newNode}};_extends$1(Text,CharacterData);function Comment(){}Comment.prototype={nodeName:"#comment",nodeType:COMMENT_NODE};_extends$1(Comment,CharacterData);function CDATASection(){}CDATASection.prototype={nodeName:"#cdata-section",nodeType:CDATA_SECTION_NODE};_extends$1(CDATASection,CharacterData);function DocumentType(){}DocumentType.prototype.nodeType=DOCUMENT_TYPE_NODE;_extends$1(DocumentType,Node);function Notation(){}Notation.prototype.nodeType=NOTATION_NODE;_extends$1(Notation,Node);function Entity(){}Entity.prototype.nodeType=ENTITY_NODE;_extends$1(Entity,Node);function EntityReference(){}EntityReference.prototype.nodeType=ENTITY_REFERENCE_NODE;_extends$1(EntityReference,Node);function DocumentFragment(){}DocumentFragment.prototype.nodeName="#document-fragment";DocumentFragment.prototype.nodeType=DOCUMENT_FRAGMENT_NODE;_extends$1(DocumentFragment,Node);function ProcessingInstruction(){}ProcessingInstruction.prototype.nodeType=PROCESSING_INSTRUCTION_NODE;_extends$1(ProcessingInstruction,Node);function XMLSerializer(){}XMLSerializer.prototype.serializeToString=function(node,isHtml,nodeFilter){return nodeSerializeToString.call(node,isHtml,nodeFilter)};Node.prototype.toString=nodeSerializeToString;function nodeSerializeToString(isHtml,nodeFilter){var buf=[],refNode=9==this.nodeType?this.documentElement:this,prefix=refNode.prefix,uri=refNode.namespaceURI;if(uri&&null==prefix){var prefix=refNode.lookupPrefix(uri);if(null==prefix){var visibleNamespaces=[{namespace:uri,prefix:null}]}}serializeToString(this,buf,isHtml,nodeFilter,visibleNamespaces);return buf.join("")}function needNamespaceDefine(node,isHTML,visibleNamespaces){var prefix=node.prefix||"",uri=node.namespaceURI;if(!prefix&&!uri){return!1}if("xml"===prefix&&"http://www.w3.org/XML/1998/namespace"===uri||"http://www.w3.org/2000/xmlns/"==uri){return!1}var i=visibleNamespaces.length;while(i--){var ns=visibleNamespaces[i];if(ns.prefix==prefix){return ns.namespace!=uri}}return!0}function serializeToString(node,buf,isHTML,nodeFilter,visibleNamespaces){if(nodeFilter){node=nodeFilter(node);if(node){if("string"==typeof node){buf.push(node);return}}else{return}}switch(node.nodeType){case ELEMENT_NODE:if(!visibleNamespaces)visibleNamespaces=[];var startVisibleNamespaces=visibleNamespaces.length,attrs=node.attributes,len=attrs.length,child=node.firstChild,nodeName=node.tagName;isHTML="http://www.w3.org/1999/xhtml"===node.namespaceURI||isHTML;buf.push("<",nodeName);for(var i=0,attr;i<len;i++){attr=attrs.item(i);if("xmlns"==attr.prefix){visibleNamespaces.push({prefix:attr.localName,namespace:attr.value})}else if("xmlns"==attr.nodeName){visibleNamespaces.push({prefix:"",namespace:attr.value})}}for(var i=0,attr;i<len;i++){attr=attrs.item(i);if(needNamespaceDefine(attr,isHTML,visibleNamespaces)){var prefix=attr.prefix||"",uri=attr.namespaceURI,ns=prefix?" xmlns:"+prefix:" xmlns";buf.push(ns,"=\"",uri,"\"");visibleNamespaces.push({prefix:prefix,namespace:uri})}serializeToString(attr,buf,isHTML,nodeFilter,visibleNamespaces)}if(needNamespaceDefine(node,isHTML,visibleNamespaces)){var prefix=node.prefix||"",uri=node.namespaceURI,ns=prefix?" xmlns:"+prefix:" xmlns";buf.push(ns,"=\"",uri,"\"");visibleNamespaces.push({prefix:prefix,namespace:uri})}if(child||isHTML&&!/^(?:meta|link|img|br|hr|input)$/i.test(nodeName)){buf.push(">");if(isHTML&&/^script$/i.test(nodeName)){while(child){if(child.data){buf.push(child.data)}else{serializeToString(child,buf,isHTML,nodeFilter,visibleNamespaces)}child=child.nextSibling}}else{while(child){serializeToString(child,buf,isHTML,nodeFilter,visibleNamespaces);child=child.nextSibling}}buf.push("</",nodeName,">")}else{buf.push("/>")}return;case DOCUMENT_NODE:case DOCUMENT_FRAGMENT_NODE:var child=node.firstChild;while(child){serializeToString(child,buf,isHTML,nodeFilter,visibleNamespaces);child=child.nextSibling}return;case ATTRIBUTE_NODE:return buf.push(" ",node.name,"=\"",node.value.replace(/[<&"]/g,_xmlEncoder),"\"");case TEXT_NODE:return buf.push(node.data.replace(/[<&]/g,_xmlEncoder));case CDATA_SECTION_NODE:return buf.push("<![CDATA[",node.data,"]]>");case COMMENT_NODE:return buf.push("<!--",node.data,"-->");case DOCUMENT_TYPE_NODE:var pubid=node.publicId,sysid=node.systemId;buf.push("<!DOCTYPE ",node.name);if(pubid){buf.push(" PUBLIC \"",pubid);if(sysid&&"."!=sysid){buf.push("\" \"",sysid)}buf.push("\">")}else if(sysid&&"."!=sysid){buf.push(" SYSTEM \"",sysid,"\">")}else{var sub=node.internalSubset;if(sub){buf.push(" [",sub,"]")}buf.push(">")}return;case PROCESSING_INSTRUCTION_NODE:return buf.push("<?",node.target," ",node.data,"?>");case ENTITY_REFERENCE_NODE:return buf.push("&",node.nodeName,";");default:buf.push("??",node.nodeName);}}function _importNode(doc,node,deep){var node2;switch(node.nodeType){case ELEMENT_NODE:node2=node.cloneNode(!1);node2.ownerDocument=doc;case DOCUMENT_FRAGMENT_NODE:break;case ATTRIBUTE_NODE:deep=!0;break;}if(!node2){node2=node.cloneNode(!1)}node2.ownerDocument=doc;node2.parentNode=null;if(deep){var child=node.firstChild;while(child){node2.appendChild(_importNode(doc,child,deep));child=child.nextSibling}}return node2}function _cloneNode(doc,node,deep){var node2=new node.constructor;for(var n in node){var v=node[n];if("object"!=_typeof2(v)){if(v!=node2[n]){node2[n]=v}}}if(node.childNodes){node2.childNodes=new NodeList}node2.ownerDocument=doc;switch(node2.nodeType){case ELEMENT_NODE:var attrs=node.attributes,attrs2=node2.attributes=new NamedNodeMap,len=attrs.length;attrs2._ownerElement=node2;for(var i=0;i<len;i++){node2.setAttributeNode(_cloneNode(doc,attrs.item(i),!0))}break;case ATTRIBUTE_NODE:deep=!0;}if(deep){var child=node.firstChild;while(child){node2.appendChild(_cloneNode(doc,child,deep));child=child.nextSibling}}return node2}function __set__(object,key,value){object[key]=value}try{if(Object.defineProperty){var getTextContent=function getTextContent(node){switch(node.nodeType){case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:var buf=[];node=node.firstChild;while(node){if(7!==node.nodeType&&8!==node.nodeType){buf.push(getTextContent(node))}node=node.nextSibling}return buf.join("");default:return node.nodeValue;}};Object.defineProperty(LiveNodeList.prototype,"length",{get:function(){_updateLiveList(this);return this.$$length}});Object.defineProperty(Node.prototype,"textContent",{get:function(){return getTextContent(this)},set:function(data){switch(this.nodeType){case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:while(this.firstChild){this.removeChild(this.firstChild)}if(data||data+""){this.appendChild(this.ownerDocument.createTextNode(data))}break;default:this.data=data;this.value=data;this.nodeValue=data;}}});__set__=function(object,key,value){object["$$"+key]=value}}}catch(e){}var dom={DOMImplementation:DOMImplementation,XMLSerializer:XMLSerializer},domParser=createCommonjsModule(function(module,exports){function DOMParser(options){this.options=options||{locator:{}}}DOMParser.prototype.parseFromString=function(source,mimeType){var options=this.options,sax=new XMLReader,domBuilder=options.domBuilder||new DOMHandler,errorHandler=options.errorHandler,locator=options.locator,defaultNSMap=options.xmlns||{},entityMap={lt:"<",gt:">",amp:"&",quot:"\"",apos:"'"};if(locator){domBuilder.setDocumentLocator(locator)}sax.errorHandler=buildErrorHandler(errorHandler,domBuilder,locator);sax.domBuilder=options.domBuilder||domBuilder;if(/\/x?html?$/.test(mimeType)){entityMap.nbsp="\xA0";entityMap.copy="\xA9";defaultNSMap[""]="http://www.w3.org/1999/xhtml"}defaultNSMap.xml=defaultNSMap.xml||"http://www.w3.org/XML/1998/namespace";if(source){sax.parse(source,defaultNSMap,entityMap)}else{sax.errorHandler.error("invalid doc source")}return domBuilder.doc};function buildErrorHandler(errorImpl,domBuilder,locator){if(!errorImpl){if(domBuilder instanceof DOMHandler){return domBuilder}errorImpl=domBuilder}var errorHandler={},isCallback=errorImpl instanceof Function;locator=locator||{};function build(key){var fn=errorImpl[key];if(!fn&&isCallback){fn=2==errorImpl.length?function(msg){errorImpl(key,msg)}:errorImpl}errorHandler[key]=fn&&function(msg){fn("[xmldom "+key+"]\t"+msg+_locator(locator))}||function(){}}build("warning");build("error");build("fatalError");return errorHandler}function DOMHandler(){this.cdata=!1}function position(locator,node){node.lineNumber=locator.lineNumber;node.columnNumber=locator.columnNumber}DOMHandler.prototype={startDocument:function(){this.doc=new DOMImplementation().createDocument(null,null,null);if(this.locator){this.doc.documentURI=this.locator.systemId}},startElement:function(namespaceURI,localName,qName,attrs){var doc=this.doc,el=doc.createElementNS(namespaceURI,qName||localName),len=attrs.length;appendElement(this,el);this.currentElement=el;this.locator&&position(this.locator,el);for(var i=0;i<len;i++){var namespaceURI=attrs.getURI(i),value=attrs.getValue(i),qName=attrs.getQName(i),attr=doc.createAttributeNS(namespaceURI,qName);this.locator&&position(attrs.getLocator(i),attr);attr.value=attr.nodeValue=value;el.setAttributeNode(attr)}},endElement:function(){var current=this.currentElement,tagName=current.tagName;this.currentElement=current.parentNode},startPrefixMapping:function(){},endPrefixMapping:function(){},processingInstruction:function(target,data){var ins=this.doc.createProcessingInstruction(target,data);this.locator&&position(this.locator,ins);appendElement(this,ins)},ignorableWhitespace:function(){},characters:function(chars){chars=_toString.apply(this,arguments);if(chars){if(this.cdata){var charNode=this.doc.createCDATASection(chars)}else{var charNode=this.doc.createTextNode(chars)}if(this.currentElement){this.currentElement.appendChild(charNode)}else if(/^\s*$/.test(chars)){this.doc.appendChild(charNode)}this.locator&&position(this.locator,charNode)}},skippedEntity:function(){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(locator){if(this.locator=locator){locator.lineNumber=0}},comment:function(chars){chars=_toString.apply(this,arguments);var comm=this.doc.createComment(chars);this.locator&&position(this.locator,comm);appendElement(this,comm)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(name,publicId,systemId){var impl=this.doc.implementation;if(impl&&impl.createDocumentType){var dt=impl.createDocumentType(name,publicId,systemId);this.locator&&position(this.locator,dt);appendElement(this,dt)}},warning:function(error){console.warn("[xmldom warning]\t"+error,_locator(this.locator))},error:function(_error){console.error("[xmldom error]\t"+_error,_locator(this.locator))},fatalError:function(error){console.error("[xmldom fatalError]\t"+error,_locator(this.locator));throw error}};function _locator(l){if(l){return"\n@"+(l.systemId||"")+"#[line:"+l.lineNumber+",col:"+l.columnNumber+"]"}}function _toString(chars,start,length){if("string"==typeof chars){return chars.substr(start,length)}else{if(chars.length>=start+length||start){return new java.lang.String(chars,start,length)+""}return chars}}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(key){DOMHandler.prototype[key]=function(){return null}});function appendElement(hander,node){if(!hander.currentElement){hander.doc.appendChild(node)}else{hander.currentElement.appendChild(node)}}var XMLReader=sax.XMLReader,DOMImplementation=exports.DOMImplementation=dom.DOMImplementation;exports.XMLSerializer=dom.XMLSerializer;exports.DOMParser=DOMParser}),domParser_1=domParser.DOMImplementation,domParser_2=domParser.XMLSerializer,domParser_3=domParser.DOMParser,isObject$1=function(obj){return!!obj&&"object"===_typeof2(obj)},merge=function merge(){for(var _len=arguments.length,objects=Array(_len),_key=0;_key<_len;_key++){objects[_key]=arguments[_key]}return objects.reduce(function(result,source){Object.keys(source).forEach(function(key){if(Array.isArray(result[key])&&Array.isArray(source[key])){result[key]=result[key].concat(source[key])}else if(isObject$1(result[key])&&isObject$1(source[key])){result[key]=merge(result[key],source[key])}else{result[key]=source[key]}});return result},{})},values=function(o){return Object.keys(o).map(function(k){return o[k]})},range=function(start,end){for(var result=[],i=start;i<end;i++){result.push(i)}return result},flatten=function(lists){return lists.reduce(function(x,y){return x.concat(y)},[])},from=function(list){if(!list.length){return[]}for(var result=[],i=0;i<list.length;i++){result.push(list[i])}return result},findIndexes=function(l,key){return l.reduce(function(a,e,i){if(e[key]){a.push(i)}return a},[])},errors={INVALID_NUMBER_OF_PERIOD:"INVALID_NUMBER_OF_PERIOD",DASH_EMPTY_MANIFEST:"DASH_EMPTY_MANIFEST",DASH_INVALID_XML:"DASH_INVALID_XML",NO_BASE_URL:"NO_BASE_URL",MISSING_SEGMENT_INFORMATION:"MISSING_SEGMENT_INFORMATION",SEGMENT_TIME_UNSPECIFIED:"SEGMENT_TIME_UNSPECIFIED",UNSUPPORTED_UTC_TIMING_SCHEME:"UNSUPPORTED_UTC_TIMING_SCHEME"},urlTypeToSegment=function(_ref){var _ref$baseUrl=_ref.baseUrl,baseUrl=void 0===_ref$baseUrl?"":_ref$baseUrl,_ref$source=_ref.source,source=void 0===_ref$source?"":_ref$source,_ref$range=_ref.range,range=void 0===_ref$range?"":_ref$range,_ref$indexRange=_ref.indexRange,indexRange=void 0===_ref$indexRange?"":_ref$indexRange,segment={uri:source,resolvedUri:resolveUrl_1(baseUrl||"",source)};if(range||indexRange){var rangeStr=range?range:indexRange,ranges=rangeStr.split("-"),startRange=parseInt(ranges[0],10),endRange=parseInt(ranges[1],10);segment.byterange={length:endRange-startRange+1,offset:startRange}}return segment},byteRangeToString=function(byterange){var endRange=byterange.offset+byterange.length-1;return byterange.offset+"-"+endRange},segmentRange={static:function(attributes){var duration=attributes.duration,_attributes$timescale=attributes.timescale,timescale=void 0===_attributes$timescale?1:_attributes$timescale,sourceDuration=attributes.sourceDuration;return{start:0,end:Math.ceil(sourceDuration/(duration/timescale))}},dynamic:function(attributes){var NOW=attributes.NOW,clientOffset=attributes.clientOffset,availabilityStartTime=attributes.availabilityStartTime,_attributes$timescale2=attributes.timescale,timescale=void 0===_attributes$timescale2?1:_attributes$timescale2,duration=attributes.duration,_attributes$start=attributes.start,start=void 0===_attributes$start?0:_attributes$start,_attributes$minimumUp=attributes.minimumUpdatePeriod,minimumUpdatePeriod=void 0===_attributes$minimumUp?0:_attributes$minimumUp,_attributes$timeShift=attributes.timeShiftBufferDepth,timeShiftBufferDepth=void 0===_attributes$timeShift?1/0:_attributes$timeShift,now=(NOW+clientOffset)/1e3,periodStartWC=availabilityStartTime+start,segmentCount=Math.ceil((now+minimumUpdatePeriod-periodStartWC)*timescale/duration),availableStart=Math.floor((now-periodStartWC-timeShiftBufferDepth)*timescale/duration),availableEnd=Math.floor((now-periodStartWC)*timescale/duration);return{start:Math.max(0,availableStart),end:Math.min(segmentCount,availableEnd)}}},toSegments=function(attributes){return function(number,index){var duration=attributes.duration,_attributes$timescale3=attributes.timescale,timescale=void 0===_attributes$timescale3?1:_attributes$timescale3,periodIndex=attributes.periodIndex,_attributes$startNumb=attributes.startNumber,startNumber=void 0===_attributes$startNumb?1:_attributes$startNumb;return{number:startNumber+number,duration:duration/timescale,timeline:periodIndex,time:index*duration}}},parseByDuration=function(attributes){var _attributes$type=attributes.type,type=void 0===_attributes$type?"static":_attributes$type,duration=attributes.duration,_attributes$timescale4=attributes.timescale,timescale=void 0===_attributes$timescale4?1:_attributes$timescale4,sourceDuration=attributes.sourceDuration,_segmentRange$type=segmentRange[type](attributes),start=_segmentRange$type.start,end=_segmentRange$type.end,segments=range(start,end).map(toSegments(attributes));if("static"===type){var index=segments.length-1;segments[index].duration=sourceDuration-duration/timescale*index}return segments},segmentsFromBase=function(attributes){var baseUrl=attributes.baseUrl,_attributes$initializ=attributes.initialization,initialization=void 0===_attributes$initializ?{}:_attributes$initializ,sourceDuration=attributes.sourceDuration,_attributes$timescale=attributes.timescale,timescale=void 0===_attributes$timescale?1:_attributes$timescale,_attributes$indexRang=attributes.indexRange,indexRange=void 0===_attributes$indexRang?"":_attributes$indexRang,duration=attributes.duration;if(!baseUrl){throw new Error(errors.NO_BASE_URL)}var initSegment=urlTypeToSegment({baseUrl:baseUrl,source:initialization.sourceURL,range:initialization.range}),segment=urlTypeToSegment({baseUrl:baseUrl,source:baseUrl,indexRange:indexRange});segment.map=initSegment;if(duration){var segmentTimeInfo=parseByDuration(attributes);if(segmentTimeInfo.length){segment.duration=segmentTimeInfo[0].duration;segment.timeline=segmentTimeInfo[0].timeline}}else if(sourceDuration){segment.duration=sourceDuration/timescale;segment.timeline=0}segment.number=0;return[segment]},addSegmentsToPlaylist=function(playlist,sidx,baseUrl){for(var initSegment=playlist.sidx.map?playlist.sidx.map:null,sourceDuration=playlist.sidx.duration,timeline=playlist.timeline||0,sidxByteRange=playlist.sidx.byterange,sidxEnd=sidxByteRange.offset+sidxByteRange.length,timescale=sidx.timescale,mediaReferences=sidx.references.filter(function(r){return 1!==r.referenceType}),segments=[],startIndex=sidxEnd+sidx.firstOffset,i=0;i<mediaReferences.length;i++){var reference=sidx.references[i],size=reference.referencedSize,duration=reference.subsegmentDuration,endIndex=startIndex+size-1,indexRange=startIndex+"-"+endIndex,segment=segmentsFromBase({baseUrl:baseUrl,timescale:timescale,timeline:timeline,periodIndex:timeline,duration:duration,sourceDuration:sourceDuration,indexRange:indexRange})[0];if(initSegment){segment.map=initSegment}segments.push(segment);startIndex+=size}playlist.segments=segments;return playlist},mergeDiscontiguousPlaylists=function(playlists){var mergedPlaylists=values(playlists.reduce(function(acc,playlist){var name=playlist.attributes.id+(playlist.attributes.lang||"");if(acc[name]){var _acc$name$segments;if(playlist.segments[0]){playlist.segments[0].discontinuity=!0}(_acc$name$segments=acc[name].segments).push.apply(_acc$name$segments,playlist.segments);if(playlist.attributes.contentProtection){acc[name].attributes.contentProtection=playlist.attributes.contentProtection}}else{acc[name]=playlist}return acc},{}));return mergedPlaylists.map(function(playlist){playlist.discontinuityStarts=findIndexes(playlist.segments,"discontinuity");return playlist})},addSegmentInfoFromSidx=function(playlists,sidxMapping){if(void 0===sidxMapping){sidxMapping={}}if(!Object.keys(sidxMapping).length){return playlists}for(var i in playlists){var playlist=playlists[i];if(!playlist.sidx){continue}var sidxKey=playlist.sidx.uri+"-"+byteRangeToString(playlist.sidx.byterange),sidxMatch=sidxMapping[sidxKey]&&sidxMapping[sidxKey].sidx;if(playlist.sidx&&sidxMatch){addSegmentsToPlaylist(playlist,sidxMatch,playlist.sidx.resolvedUri)}}return playlists},formatAudioPlaylist=function(_ref){var _attributes,attributes=_ref.attributes,segments=_ref.segments,sidx=_ref.sidx,playlist={attributes:(_attributes={NAME:attributes.id,BANDWIDTH:attributes.bandwidth,CODECS:attributes.codecs},_attributes["PROGRAM-ID"]=1,_attributes),uri:"",endList:"static"===(attributes.type||"static"),timeline:attributes.periodIndex,resolvedUri:"",targetDuration:attributes.duration,segments:segments,mediaSequence:segments.length?segments[0].number:1};if(attributes.contentProtection){playlist.contentProtection=attributes.contentProtection}if(sidx){playlist.sidx=sidx}return playlist},formatVttPlaylist=function(_ref2){var _attributes2,attributes=_ref2.attributes,segments=_ref2.segments;if("undefined"==typeof segments){segments=[{uri:attributes.baseUrl,timeline:attributes.periodIndex,resolvedUri:attributes.baseUrl||"",duration:attributes.sourceDuration,number:0}];attributes.duration=attributes.sourceDuration}return{attributes:(_attributes2={NAME:attributes.id,BANDWIDTH:attributes.bandwidth},_attributes2["PROGRAM-ID"]=1,_attributes2),uri:"",endList:"static"===(attributes.type||"static"),timeline:attributes.periodIndex,resolvedUri:attributes.baseUrl||"",targetDuration:attributes.duration,segments:segments,mediaSequence:segments.length?segments[0].number:1}},organizeAudioPlaylists=function(playlists,sidxMapping){if(void 0===sidxMapping){sidxMapping={}}var mainPlaylist,formattedPlaylists=playlists.reduce(function(a,playlist){var role=playlist.attributes.role&&playlist.attributes.role.value||"",language=playlist.attributes.lang||"",label="main";if(language){var roleLabel=role?" ("+role+")":"";label=""+playlist.attributes.lang+roleLabel}if(a[label]&&a[label].playlists[0].attributes.BANDWIDTH>playlist.attributes.bandwidth){return a}a[label]={language:language,autoselect:!0,default:"main"===role,playlists:addSegmentInfoFromSidx([formatAudioPlaylist(playlist)],sidxMapping),uri:""};if("undefined"==typeof mainPlaylist&&"main"===role){mainPlaylist=playlist;mainPlaylist["default"]=!0}return a},{});if(!mainPlaylist){var firstLabel=Object.keys(formattedPlaylists)[0];formattedPlaylists[firstLabel]["default"]=!0}return formattedPlaylists},organizeVttPlaylists=function(playlists,sidxMapping){if(void 0===sidxMapping){sidxMapping={}}return playlists.reduce(function(a,playlist){var label=playlist.attributes.lang||"text";if(a[label]){return a}a[label]={language:label,default:!1,autoselect:!1,playlists:addSegmentInfoFromSidx([formatVttPlaylist(playlist)],sidxMapping),uri:""};return a},{})},formatVideoPlaylist=function(_ref3){var _attributes3,attributes=_ref3.attributes,segments=_ref3.segments,sidx=_ref3.sidx,playlist={attributes:(_attributes3={NAME:attributes.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:attributes.width,height:attributes.height},CODECS:attributes.codecs,BANDWIDTH:attributes.bandwidth},_attributes3["PROGRAM-ID"]=1,_attributes3),uri:"",endList:"static"===(attributes.type||"static"),timeline:attributes.periodIndex,resolvedUri:"",targetDuration:attributes.duration,segments:segments,mediaSequence:segments.length?segments[0].number:1};if(attributes.contentProtection){playlist.contentProtection=attributes.contentProtection}if(sidx){playlist.sidx=sidx}return playlist},toM3u8=function(dashPlaylists,sidxMapping){var _mediaGroups;if(void 0===sidxMapping){sidxMapping={}}if(!dashPlaylists.length){return{}}var _dashPlaylists$0$attr=dashPlaylists[0].attributes,duration=_dashPlaylists$0$attr.sourceDuration,_dashPlaylists$0$attr2=_dashPlaylists$0$attr.type,type=void 0===_dashPlaylists$0$attr2?"static":_dashPlaylists$0$attr2,suggestedPresentationDelay=_dashPlaylists$0$attr.suggestedPresentationDelay,_dashPlaylists$0$attr3=_dashPlaylists$0$attr.minimumUpdatePeriod,minimumUpdatePeriod=void 0===_dashPlaylists$0$attr3?0:_dashPlaylists$0$attr3,videoPlaylists=mergeDiscontiguousPlaylists(dashPlaylists.filter(function(_ref4){var attributes=_ref4.attributes;return"video/mp4"===attributes.mimeType||"video"===attributes.contentType})).map(formatVideoPlaylist),audioPlaylists=mergeDiscontiguousPlaylists(dashPlaylists.filter(function(_ref5){var attributes=_ref5.attributes;return"audio/mp4"===attributes.mimeType||"audio"===attributes.contentType})),vttPlaylists=dashPlaylists.filter(function(_ref6){var attributes=_ref6.attributes;return"text/vtt"===attributes.mimeType||"text"===attributes.contentType}),master={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:(_mediaGroups={AUDIO:{},VIDEO:{}},_mediaGroups["CLOSED-CAPTIONS"]={},_mediaGroups.SUBTITLES={},_mediaGroups),uri:"",duration:duration,playlists:addSegmentInfoFromSidx(videoPlaylists,sidxMapping),minimumUpdatePeriod:1e3*minimumUpdatePeriod};if("dynamic"===type){master.suggestedPresentationDelay=suggestedPresentationDelay}if(audioPlaylists.length){master.mediaGroups.AUDIO.audio=organizeAudioPlaylists(audioPlaylists,sidxMapping)}if(vttPlaylists.length){master.mediaGroups.SUBTITLES.subs=organizeVttPlaylists(vttPlaylists,sidxMapping)}return master},getLiveRValue=function(attributes,time,duration){var NOW=attributes.NOW,clientOffset=attributes.clientOffset,availabilityStartTime=attributes.availabilityStartTime,_attributes$timescale=attributes.timescale,timescale=void 0===_attributes$timescale?1:_attributes$timescale,_attributes$start=attributes.start,start=void 0===_attributes$start?0:_attributes$start,_attributes$minimumUp=attributes.minimumUpdatePeriod,minimumUpdatePeriod=void 0===_attributes$minimumUp?0:_attributes$minimumUp;return Math.ceil((((NOW+clientOffset)/1e3+minimumUpdatePeriod-(availabilityStartTime+start))*timescale-time)/duration)},parseByTimeline=function(attributes,segmentTimeline){for(var _attributes$type=attributes.type,type=void 0===_attributes$type?"static":_attributes$type,_attributes$minimumUp2=attributes.minimumUpdatePeriod,minimumUpdatePeriod=void 0===_attributes$minimumUp2?0:_attributes$minimumUp2,_attributes$media=attributes.media,media=void 0===_attributes$media?"":_attributes$media,sourceDuration=attributes.sourceDuration,_attributes$timescale2=attributes.timescale,timescale=void 0===_attributes$timescale2?1:_attributes$timescale2,_attributes$startNumb=attributes.startNumber,startNumber=void 0===_attributes$startNumb?1:_attributes$startNumb,timeline=attributes.periodIndex,segments=[],time=-1,sIndex=0;sIndex<segmentTimeline.length;sIndex++){var S=segmentTimeline[sIndex],duration=S.d,repeat=S.r||0,segmentTime=S.t||0;if(0>time){time=segmentTime}if(segmentTime&&segmentTime>time){time=segmentTime}var count=void 0;if(0>repeat){var nextS=sIndex+1;if(nextS===segmentTimeline.length){if("dynamic"===type&&0<minimumUpdatePeriod&&0<media.indexOf("$Number$")){count=getLiveRValue(attributes,time,duration)}else{count=(sourceDuration*timescale-time)/duration}}else{count=(segmentTimeline[nextS].t-time)/duration}}else{count=repeat+1}var end=startNumber+segments.length+count,number=startNumber+segments.length;while(number<end){segments.push({number:number,duration:duration/timescale,time:time,timeline:timeline});time+=duration;number++}}return segments},identifierReplacement=function(values){return function(match,identifier,format,width){if("$$"===match){return"$"}if("undefined"==typeof values[identifier]){return match}var value=""+values[identifier];if("RepresentationID"===identifier){return value}if(!format){width=1}else{width=parseInt(width,10)}if(value.length>=width){return value}return""+Array(width-value.length+1).join("0")+value}},constructTemplateUrl=function(url,values){return url.replace(/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,identifierReplacement(values))},parseTemplateInfo=function(attributes,segmentTimeline){if(!attributes.duration&&!segmentTimeline){return[{number:attributes.startNumber||1,duration:attributes.sourceDuration,time:0,timeline:attributes.periodIndex}]}if(attributes.duration){return parseByDuration(attributes)}return parseByTimeline(attributes,segmentTimeline)},segmentsFromTemplate=function(attributes,segmentTimeline){var templateValues={RepresentationID:attributes.id,Bandwidth:attributes.bandwidth||0},_attributes$initializ=attributes.initialization,initialization=void 0===_attributes$initializ?{sourceURL:"",range:""}:_attributes$initializ,mapSegment=urlTypeToSegment({baseUrl:attributes.baseUrl,source:constructTemplateUrl(initialization.sourceURL,templateValues),range:initialization.range}),segments=parseTemplateInfo(attributes,segmentTimeline);return segments.map(function(segment){templateValues.Number=segment.number;templateValues.Time=segment.time;var uri=constructTemplateUrl(attributes.media||"",templateValues);return{uri:uri,timeline:segment.timeline,duration:segment.duration,resolvedUri:resolveUrl_1(attributes.baseUrl||"",uri),map:mapSegment,number:segment.number}})},SegmentURLToSegmentObject=function(attributes,segmentUrl){var baseUrl=attributes.baseUrl,_attributes$initializ=attributes.initialization,initialization=void 0===_attributes$initializ?{}:_attributes$initializ,initSegment=urlTypeToSegment({baseUrl:baseUrl,source:initialization.sourceURL,range:initialization.range}),segment=urlTypeToSegment({baseUrl:baseUrl,source:segmentUrl.media,range:segmentUrl.mediaRange});segment.map=initSegment;return segment},segmentsFromList=function(attributes,segmentTimeline){var duration=attributes.duration,_attributes$segmentUr=attributes.segmentUrls,segmentUrls=void 0===_attributes$segmentUr?[]:_attributes$segmentUr;if(!duration&&!segmentTimeline||duration&&segmentTimeline){throw new Error(errors.SEGMENT_TIME_UNSPECIFIED)}var segmentUrlMap=segmentUrls.map(function(segmentUrlObject){return SegmentURLToSegmentObject(attributes,segmentUrlObject)}),segmentTimeInfo;if(duration){segmentTimeInfo=parseByDuration(attributes)}if(segmentTimeline){segmentTimeInfo=parseByTimeline(attributes,segmentTimeline)}var segments=segmentTimeInfo.map(function(segmentTime,index){if(segmentUrlMap[index]){var segment=segmentUrlMap[index];segment.timeline=segmentTime.timeline;segment.duration=segmentTime.duration;segment.number=segmentTime.number;return segment}}).filter(function(segment){return segment});return segments},generateSegments=function(_ref){var attributes=_ref.attributes,segmentInfo=_ref.segmentInfo,segmentAttributes,segmentsFn;if(segmentInfo.template){segmentsFn=segmentsFromTemplate;segmentAttributes=merge(attributes,segmentInfo.template)}else if(segmentInfo.base){segmentsFn=segmentsFromBase;segmentAttributes=merge(attributes,segmentInfo.base)}else if(segmentInfo.list){segmentsFn=segmentsFromList;segmentAttributes=merge(attributes,segmentInfo.list)}var segmentsInfo={attributes:attributes};if(!segmentsFn){return segmentsInfo}var segments=segmentsFn(segmentAttributes,segmentInfo.timeline);if(segmentAttributes.duration){var _segmentAttributes=segmentAttributes,duration=_segmentAttributes.duration,_segmentAttributes$ti=_segmentAttributes.timescale,timescale=void 0===_segmentAttributes$ti?1:_segmentAttributes$ti;segmentAttributes.duration=duration/timescale}else if(segments.length){segmentAttributes.duration=segments.reduce(function(max,segment){return Math.max(max,Math.ceil(segment.duration))},0)}else{segmentAttributes.duration=0}segmentsInfo.attributes=segmentAttributes;segmentsInfo.segments=segments;if(segmentInfo.base&&segmentAttributes.indexRange){segmentsInfo.sidx=segments[0];segmentsInfo.segments=[]}return segmentsInfo},toPlaylists=function(representations){return representations.map(generateSegments)},findChildren=function(element,name){return from(element.childNodes).filter(function(_ref){var tagName=_ref.tagName;return tagName===name})},getContent=function(element){return element.textContent.trim()},parseDuration=function(str){var match=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(str);if(!match){return 0}var _match$slice=match.slice(1),year=_match$slice[0],month=_match$slice[1],day=_match$slice[2],hour=_match$slice[3],minute=_match$slice[4],second=_match$slice[5];return parseFloat(year||0)*31536000+parseFloat(month||0)*2592000+parseFloat(day||0)*86400+parseFloat(hour||0)*3600+parseFloat(minute||0)*60+parseFloat(second||0)},parseDate=function(str){if(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(str)){str+="Z"}return Date.parse(str)},parsers={mediaPresentationDuration:function(value){return parseDuration(value)},availabilityStartTime:function(value){return parseDate(value)/1e3},minimumUpdatePeriod:function(value){return parseDuration(value)},suggestedPresentationDelay:function(value){return parseDuration(value)},type:function(value){return value},timeShiftBufferDepth:function(value){return parseDuration(value)},start:function(value){return parseDuration(value)},width:function(value){return parseInt(value,10)},height:function(value){return parseInt(value,10)},bandwidth:function(value){return parseInt(value,10)},startNumber:function(value){return parseInt(value,10)},timescale:function(value){return parseInt(value,10)},duration:function(value){var parsedValue=parseInt(value,10);if(isNaN(parsedValue)){return parseDuration(value)}return parsedValue},d:function(value){return parseInt(value,10)},t:function(value){return parseInt(value,10)},r:function(value){return parseInt(value,10)},DEFAULT:function(value){return value}},parseAttributes$1=function(el){if(!(el&&el.attributes)){return{}}return from(el.attributes).reduce(function(a,e){var parseFn=parsers[e.name]||parsers.DEFAULT;a[e.name]=parseFn(e.value);return a},{})},keySystemsMap={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},buildBaseUrls=function(referenceUrls,baseUrlElements){if(!baseUrlElements.length){return referenceUrls}return flatten(referenceUrls.map(function(reference){return baseUrlElements.map(function(baseUrlElement){return resolveUrl_1(reference,getContent(baseUrlElement))})}))},getSegmentInformation=function(adaptationSet){var segmentTemplate=findChildren(adaptationSet,"SegmentTemplate")[0],segmentList=findChildren(adaptationSet,"SegmentList")[0],segmentUrls=segmentList&&findChildren(segmentList,"SegmentURL").map(function(s){return merge({tag:"SegmentURL"},parseAttributes$1(s))}),segmentBase=findChildren(adaptationSet,"SegmentBase")[0],segmentTimelineParentNode=segmentList||segmentTemplate,segmentTimeline=segmentTimelineParentNode&&findChildren(segmentTimelineParentNode,"SegmentTimeline")[0],segmentInitializationParentNode=segmentList||segmentBase||segmentTemplate,segmentInitialization=segmentInitializationParentNode&&findChildren(segmentInitializationParentNode,"Initialization")[0],template=segmentTemplate&&parseAttributes$1(segmentTemplate);if(template&&segmentInitialization){template.initialization=segmentInitialization&&parseAttributes$1(segmentInitialization)}else if(template&&template.initialization){template.initialization={sourceURL:template.initialization}}var segmentInfo={template:template,timeline:segmentTimeline&&findChildren(segmentTimeline,"S").map(function(s){return parseAttributes$1(s)}),list:segmentList&&merge(parseAttributes$1(segmentList),{segmentUrls:segmentUrls,initialization:parseAttributes$1(segmentInitialization)}),base:segmentBase&&merge(parseAttributes$1(segmentBase),{initialization:parseAttributes$1(segmentInitialization)})};Object.keys(segmentInfo).forEach(function(key){if(!segmentInfo[key]){delete segmentInfo[key]}});return segmentInfo},inheritBaseUrls=function(adaptationSetAttributes,adaptationSetBaseUrls,adaptationSetSegmentInfo){return function(representation){var repBaseUrlElements=findChildren(representation,"BaseURL"),repBaseUrls=buildBaseUrls(adaptationSetBaseUrls,repBaseUrlElements),attributes=merge(adaptationSetAttributes,parseAttributes$1(representation)),representationSegmentInfo=getSegmentInformation(representation);return repBaseUrls.map(function(baseUrl){return{segmentInfo:merge(adaptationSetSegmentInfo,representationSegmentInfo),attributes:merge(attributes,{baseUrl:baseUrl})}})}},generateKeySystemInformation=function(contentProtectionNodes){return contentProtectionNodes.reduce(function(acc,node){var attributes=parseAttributes$1(node),keySystem=keySystemsMap[attributes.schemeIdUri];if(keySystem){acc[keySystem]={attributes:attributes};var psshNode=findChildren(node,"cenc:pssh")[0];if(psshNode){var pssh=getContent(psshNode),psshBuffer=pssh&&decodeB64ToUint8Array$1(pssh);acc[keySystem].pssh=psshBuffer}}return acc},{})},toRepresentations=function(periodAttributes,periodBaseUrls,periodSegmentInfo){return function(adaptationSet){var adaptationSetAttributes=parseAttributes$1(adaptationSet),adaptationSetBaseUrls=buildBaseUrls(periodBaseUrls,findChildren(adaptationSet,"BaseURL")),role=findChildren(adaptationSet,"Role")[0],roleAttributes={role:parseAttributes$1(role)},attrs=merge(periodAttributes,adaptationSetAttributes,roleAttributes),contentProtection=generateKeySystemInformation(findChildren(adaptationSet,"ContentProtection"));if(Object.keys(contentProtection).length){attrs=merge(attrs,{contentProtection:contentProtection})}var segmentInfo=getSegmentInformation(adaptationSet),representations=findChildren(adaptationSet,"Representation"),adaptationSetSegmentInfo=merge(periodSegmentInfo,segmentInfo);return flatten(representations.map(inheritBaseUrls(attrs,adaptationSetBaseUrls,adaptationSetSegmentInfo)))}},toAdaptationSets=function(mpdAttributes,mpdBaseUrls){return function(period,index){var periodBaseUrls=buildBaseUrls(mpdBaseUrls,findChildren(period,"BaseURL")),periodAtt=parseAttributes$1(period),parsedPeriodId=parseInt(periodAtt.id,10),periodIndex=window$3.isNaN(parsedPeriodId)?index:parsedPeriodId,periodAttributes=merge(mpdAttributes,{periodIndex:periodIndex}),adaptationSets=findChildren(period,"AdaptationSet"),periodSegmentInfo=getSegmentInformation(period);return flatten(adaptationSets.map(toRepresentations(periodAttributes,periodBaseUrls,periodSegmentInfo)))}},inheritAttributes=function(mpd,options){if(void 0===options){options={}}var _options=options,_options$manifestUri=_options.manifestUri,manifestUri=void 0===_options$manifestUri?"":_options$manifestUri,_options$NOW=_options.NOW,NOW=void 0===_options$NOW?Date.now():_options$NOW,_options$clientOffset=_options.clientOffset,clientOffset=void 0===_options$clientOffset?0:_options$clientOffset,periods=findChildren(mpd,"Period");if(!periods.length){throw new Error(errors.INVALID_NUMBER_OF_PERIOD)}var mpdAttributes=parseAttributes$1(mpd),mpdBaseUrls=buildBaseUrls([manifestUri],findChildren(mpd,"BaseURL"));mpdAttributes.sourceDuration=mpdAttributes.mediaPresentationDuration||0;mpdAttributes.NOW=NOW;mpdAttributes.clientOffset=clientOffset;return flatten(periods.map(toAdaptationSets(mpdAttributes,mpdBaseUrls)))},stringToMpdXml=function(manifestString){if(""===manifestString){throw new Error(errors.DASH_EMPTY_MANIFEST)}var parser=new domParser_3,xml=parser.parseFromString(manifestString,"application/xml"),mpd=xml&&"MPD"===xml.documentElement.tagName?xml.documentElement:null;if(!mpd||mpd&&0<mpd.getElementsByTagName("parsererror").length){throw new Error(errors.DASH_INVALID_XML)}return mpd},parseUTCTimingScheme=function(mpd){var UTCTimingNode=findChildren(mpd,"UTCTiming")[0];if(!UTCTimingNode){return null}var attributes=parseAttributes$1(UTCTimingNode);switch(attributes.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":attributes.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":attributes.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":attributes.method="DIRECT";attributes.value=Date.parse(attributes.value);break;case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":default:throw new Error(errors.UNSUPPORTED_UTC_TIMING_SCHEME);}return attributes},parse=function(manifestString,options){if(void 0===options){options={}}return toM3u8(toPlaylists(inheritAttributes(stringToMpdXml(manifestString),options)),options.sidxMapping)},parseUTCTiming=function(manifestString){return parseUTCTimingScheme(stringToMpdXml(manifestString))},bin={toUnsigned:function(value){return value>>>0},toHexString:function(value){return("00"+value.toString(16)).slice(-2)}},inspectMp4,_textifyMp,toUnsigned$1=bin.toUnsigned,parseMp4Date=function(seconds){return new Date(1e3*seconds-20828448e5)},parseSampleFlags=function(flags){return{isLeading:(12&flags[0])>>>2,dependsOn:3&flags[0],isDependedOn:(192&flags[1])>>>6,hasRedundancy:(48&flags[1])>>>4,paddingValue:(14&flags[1])>>>1,isNonSyncSample:1&flags[1],degradationPriority:flags[2]<<8|flags[3]}},parseType=function(buffer){var result="";result+=String.fromCharCode(buffer[0]);result+=String.fromCharCode(buffer[1]);result+=String.fromCharCode(buffer[2]);result+=String.fromCharCode(buffer[3]);return result},findBox=function findBox(data,path){var results=[],i,size,type,end,subresults;if(!path.length){return null}for(i=0;i<data.byteLength;){size=toUnsigned$1(data[i]<<24|data[i+1]<<16|data[i+2]<<8|data[i+3]);type=parseType(data.subarray(i+4,i+8));end=1<size?i+size:data.byteLength;if(type===path[0]){if(1===path.length){results.push(data.subarray(i+8,end))}else{subresults=findBox(data.subarray(i+8,end),path.slice(1));if(subresults.length){results=results.concat(subresults)}}}i=end}return results},nalParse=function(avcStream){var avcView=new DataView(avcStream.buffer,avcStream.byteOffset,avcStream.byteLength),result=[],i,length;for(i=0;i+4<avcStream.length;i+=length){length=avcView.getUint32(i);i+=4;if(0>=length){result.push("<span style='color:red;'>MALFORMED DATA</span>");continue}switch(31&avcStream[i]){case 1:result.push("slice_layer_without_partitioning_rbsp");break;case 5:result.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:result.push("sei_rbsp");break;case 7:result.push("seq_parameter_set_rbsp");break;case 8:result.push("pic_parameter_set_rbsp");break;case 9:result.push("access_unit_delimiter_rbsp");break;default:result.push(31&"UNKNOWN NAL - "+avcStream[i]);break;}}return result},parse$1={avc1:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength);return{dataReferenceIndex:view.getUint16(6),width:view.getUint16(24),height:view.getUint16(26),horizresolution:view.getUint16(28)+view.getUint16(30)/16,vertresolution:view.getUint16(32)+view.getUint16(34)/16,frameCount:view.getUint16(40),depth:view.getUint16(74),config:inspectMp4(data.subarray(78,data.byteLength))}},avcC:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength),result={configurationVersion:data[0],avcProfileIndication:data[1],profileCompatibility:data[2],avcLevelIndication:data[3],lengthSizeMinusOne:3&data[4],sps:[],pps:[]},numOfSequenceParameterSets=31&data[5],numOfPictureParameterSets,nalSize,offset,i;offset=6;for(i=0;i<numOfSequenceParameterSets;i++){nalSize=view.getUint16(offset);offset+=2;result.sps.push(new Uint8Array(data.subarray(offset,offset+nalSize)));offset+=nalSize}numOfPictureParameterSets=data[offset];offset++;for(i=0;i<numOfPictureParameterSets;i++){nalSize=view.getUint16(offset);offset+=2;result.pps.push(new Uint8Array(data.subarray(offset,offset+nalSize)));offset+=nalSize}return result},btrt:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength);return{bufferSizeDB:view.getUint32(0),maxBitrate:view.getUint32(4),avgBitrate:view.getUint32(8)}},esds:function(data){return{version:data[0],flags:new Uint8Array(data.subarray(1,4)),esId:data[6]<<8|data[7],streamPriority:31&data[8],decoderConfig:{objectProfileIndication:data[11],streamType:63&data[12]>>>2,bufferSize:data[13]<<16|data[14]<<8|data[15],maxBitrate:data[16]<<24|data[17]<<16|data[18]<<8|data[19],avgBitrate:data[20]<<24|data[21]<<16|data[22]<<8|data[23],decoderConfigDescriptor:{tag:data[24],length:data[25],audioObjectType:31&data[26]>>>3,samplingFrequencyIndex:(7&data[26])<<1|1&data[27]>>>7,channelConfiguration:15&data[27]>>>3}}}},ftyp:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength),result={majorBrand:parseType(data.subarray(0,4)),minorVersion:view.getUint32(4),compatibleBrands:[]},i=8;while(i<data.byteLength){result.compatibleBrands.push(parseType(data.subarray(i,i+4)));i+=4}return result},dinf:function(data){return{boxes:inspectMp4(data)}},dref:function(data){return{version:data[0],flags:new Uint8Array(data.subarray(1,4)),dataReferences:inspectMp4(data.subarray(8))}},hdlr:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength),result={version:view.getUint8(0),flags:new Uint8Array(data.subarray(1,4)),handlerType:parseType(data.subarray(8,12)),name:""},i=8;for(i=24;i<data.byteLength;i++){if(0===data[i]){i++;break}result.name+=String.fromCharCode(data[i])}result.name=decodeURIComponent(escape(result.name));return result},mdat:function(data){return{byteLength:data.byteLength,nals:nalParse(data)}},mdhd:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength),i=4,language,result={version:view.getUint8(0),flags:new Uint8Array(data.subarray(1,4)),language:""};if(1===result.version){i+=4;result.creationTime=parseMp4Date(view.getUint32(i));i+=8;result.modificationTime=parseMp4Date(view.getUint32(i));i+=4;result.timescale=view.getUint32(i);i+=8;result.duration=view.getUint32(i)}else{result.creationTime=parseMp4Date(view.getUint32(i));i+=4;result.modificationTime=parseMp4Date(view.getUint32(i));i+=4;result.timescale=view.getUint32(i);i+=4;result.duration=view.getUint32(i)}i+=4;language=view.getUint16(i);result.language+=String.fromCharCode((language>>10)+96);result.language+=String.fromCharCode(((992&language)>>5)+96);result.language+=String.fromCharCode((31&language)+96);return result},mdia:function(data){return{boxes:inspectMp4(data)}},mfhd:function(data){return{version:data[0],flags:new Uint8Array(data.subarray(1,4)),sequenceNumber:data[4]<<24|data[5]<<16|data[6]<<8|data[7]}},minf:function(data){return{boxes:inspectMp4(data)}},mp4a:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength),result={dataReferenceIndex:view.getUint16(6),channelcount:view.getUint16(16),samplesize:view.getUint16(18),samplerate:view.getUint16(24)+view.getUint16(26)/65536};if(28<data.byteLength){result.streamDescriptor=inspectMp4(data.subarray(28))[0]}return result},moof:function(data){return{boxes:inspectMp4(data)}},moov:function(data){return{boxes:inspectMp4(data)}},mvex:function(data){return{boxes:inspectMp4(data)}},mvhd:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength),i=4,result={version:view.getUint8(0),flags:new Uint8Array(data.subarray(1,4))};if(1===result.version){i+=4;result.creationTime=parseMp4Date(view.getUint32(i));i+=8;result.modificationTime=parseMp4Date(view.getUint32(i));i+=4;result.timescale=view.getUint32(i);i+=8;result.duration=view.getUint32(i)}else{result.creationTime=parseMp4Date(view.getUint32(i));i+=4;result.modificationTime=parseMp4Date(view.getUint32(i));i+=4;result.timescale=view.getUint32(i);i+=4;result.duration=view.getUint32(i)}i+=4;result.rate=view.getUint16(i)+view.getUint16(i+2)/16;i+=4;result.volume=view.getUint8(i)+view.getUint8(i+1)/8;i+=2;i+=2;i+=8;result.matrix=new Uint32Array(data.subarray(i,i+36));i+=36;i+=24;result.nextTrackId=view.getUint32(i);return result},pdin:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength);return{version:view.getUint8(0),flags:new Uint8Array(data.subarray(1,4)),rate:view.getUint32(4),initialDelay:view.getUint32(8)}},sdtp:function(data){var result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),samples:[]},i;for(i=4;i<data.byteLength;i++){result.samples.push({dependsOn:(48&data[i])>>4,isDependedOn:(12&data[i])>>2,hasRedundancy:3&data[i]})}return result},sidx:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength),result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),references:[],referenceId:view.getUint32(4),timescale:view.getUint32(8),earliestPresentationTime:view.getUint32(12),firstOffset:view.getUint32(16)},referenceCount=view.getUint16(22),i;for(i=24;referenceCount;i+=12,referenceCount--){result.references.push({referenceType:(128&data[i])>>>7,referencedSize:2147483647&view.getUint32(i),subsegmentDuration:view.getUint32(i+4),startsWithSap:!!(128&data[i+8]),sapType:(112&data[i+8])>>>4,sapDeltaTime:268435455&view.getUint32(i+8)})}return result},smhd:function(data){return{version:data[0],flags:new Uint8Array(data.subarray(1,4)),balance:data[4]+data[5]/256}},stbl:function(data){return{boxes:inspectMp4(data)}},stco:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength),result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),chunkOffsets:[]},entryCount=view.getUint32(4),i;for(i=8;entryCount;i+=4,entryCount--){result.chunkOffsets.push(view.getUint32(i))}return result},stsc:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength),entryCount=view.getUint32(4),result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),sampleToChunks:[]},i;for(i=8;entryCount;i+=12,entryCount--){result.sampleToChunks.push({firstChunk:view.getUint32(i),samplesPerChunk:view.getUint32(i+4),sampleDescriptionIndex:view.getUint32(i+8)})}return result},stsd:function(data){return{version:data[0],flags:new Uint8Array(data.subarray(1,4)),sampleDescriptions:inspectMp4(data.subarray(8))}},stsz:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength),result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),sampleSize:view.getUint32(4),entries:[]},i;for(i=12;i<data.byteLength;i+=4){result.entries.push(view.getUint32(i))}return result},stts:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength),result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),timeToSamples:[]},entryCount=view.getUint32(4),i;for(i=8;entryCount;i+=8,entryCount--){result.timeToSamples.push({sampleCount:view.getUint32(i),sampleDelta:view.getUint32(i+4)})}return result},styp:function(data){return parse$1.ftyp(data)},tfdt:function(data){var result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),baseMediaDecodeTime:toUnsigned$1(data[4]<<24|data[5]<<16|data[6]<<8|data[7])};if(1===result.version){result.baseMediaDecodeTime*=Math.pow(2,32);result.baseMediaDecodeTime+=toUnsigned$1(data[8]<<24|data[9]<<16|data[10]<<8|data[11])}return result},tfhd:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength),result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),trackId:view.getUint32(4)},baseDataOffsetPresent=1&result.flags[2],sampleDescriptionIndexPresent=2&result.flags[2],defaultSampleDurationPresent=8&result.flags[2],defaultSampleSizePresent=16&result.flags[2],defaultSampleFlagsPresent=32&result.flags[2],durationIsEmpty=65536&result.flags[0],defaultBaseIsMoof=131072&result.flags[0],i;i=8;if(baseDataOffsetPresent){i+=4;result.baseDataOffset=view.getUint32(12);i+=4}if(sampleDescriptionIndexPresent){result.sampleDescriptionIndex=view.getUint32(i);i+=4}if(defaultSampleDurationPresent){result.defaultSampleDuration=view.getUint32(i);i+=4}if(defaultSampleSizePresent){result.defaultSampleSize=view.getUint32(i);i+=4}if(defaultSampleFlagsPresent){result.defaultSampleFlags=view.getUint32(i)}if(durationIsEmpty){result.durationIsEmpty=!0}if(!baseDataOffsetPresent&&defaultBaseIsMoof){result.baseDataOffsetIsMoof=!0}return result},tkhd:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength),i=4,result={version:view.getUint8(0),flags:new Uint8Array(data.subarray(1,4))};if(1===result.version){i+=4;result.creationTime=parseMp4Date(view.getUint32(i));i+=8;result.modificationTime=parseMp4Date(view.getUint32(i));i+=4;result.trackId=view.getUint32(i);i+=4;i+=8;result.duration=view.getUint32(i)}else{result.creationTime=parseMp4Date(view.getUint32(i));i+=4;result.modificationTime=parseMp4Date(view.getUint32(i));i+=4;result.trackId=view.getUint32(i);i+=4;i+=4;result.duration=view.getUint32(i)}i+=4;i+=8;result.layer=view.getUint16(i);i+=2;result.alternateGroup=view.getUint16(i);i+=2;result.volume=view.getUint8(i)+view.getUint8(i+1)/8;i+=2;i+=2;result.matrix=new Uint32Array(data.subarray(i,i+36));i+=36;result.width=view.getUint16(i)+view.getUint16(i+2)/65536;i+=4;result.height=view.getUint16(i)+view.getUint16(i+2)/65536;return result},traf:function(data){return{boxes:inspectMp4(data)}},trak:function(data){return{boxes:inspectMp4(data)}},trex:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength);return{version:data[0],flags:new Uint8Array(data.subarray(1,4)),trackId:view.getUint32(4),defaultSampleDescriptionIndex:view.getUint32(8),defaultSampleDuration:view.getUint32(12),defaultSampleSize:view.getUint32(16),sampleDependsOn:3&data[20],sampleIsDependedOn:(192&data[21])>>6,sampleHasRedundancy:(48&data[21])>>4,samplePaddingValue:(14&data[21])>>1,sampleIsDifferenceSample:!!(1&data[21]),sampleDegradationPriority:view.getUint16(22)}},trun:function(data){var result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),samples:[]},view=new DataView(data.buffer,data.byteOffset,data.byteLength),dataOffsetPresent=1&result.flags[2],firstSampleFlagsPresent=4&result.flags[2],sampleDurationPresent=1&result.flags[1],sampleSizePresent=2&result.flags[1],sampleFlagsPresent=4&result.flags[1],sampleCompositionTimeOffsetPresent=8&result.flags[1],sampleCount=view.getUint32(4),offset=8,sample;if(dataOffsetPresent){result.dataOffset=view.getInt32(offset);offset+=4}if(firstSampleFlagsPresent&&sampleCount){sample={flags:parseSampleFlags(data.subarray(offset,offset+4))};offset+=4;if(sampleDurationPresent){sample.duration=view.getUint32(offset);offset+=4}if(sampleSizePresent){sample.size=view.getUint32(offset);offset+=4}if(sampleCompositionTimeOffsetPresent){sample.compositionTimeOffset=view.getUint32(offset);offset+=4}result.samples.push(sample);sampleCount--}while(sampleCount--){sample={};if(sampleDurationPresent){sample.duration=view.getUint32(offset);offset+=4}if(sampleSizePresent){sample.size=view.getUint32(offset);offset+=4}if(sampleFlagsPresent){sample.flags=parseSampleFlags(data.subarray(offset,offset+4));offset+=4}if(sampleCompositionTimeOffsetPresent){sample.compositionTimeOffset=view.getUint32(offset);offset+=4}result.samples.push(sample)}return result},"url ":function(data){return{version:data[0],flags:new Uint8Array(data.subarray(1,4))}},vmhd:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength);return{version:data[0],flags:new Uint8Array(data.subarray(1,4)),graphicsmode:view.getUint16(4),opcolor:new Uint16Array([view.getUint16(6),view.getUint16(8),view.getUint16(10)])}}};inspectMp4=function(data){for(var i=0,result=[],view,size,type,end,box,ab=new ArrayBuffer(data.length),v=new Uint8Array(ab),z=0;z<data.length;++z){v[z]=data[z]}view=new DataView(ab);while(i<data.byteLength){size=view.getUint32(i);type=parseType(data.subarray(i+4,i+8));end=1<size?i+size:data.byteLength;box=(parse$1[type]||function(data){return{data:data}})(data.subarray(i+8,end));box.size=size;box.type=type;result.push(box);i=end}return result};_textifyMp=function(inspectedMp4,depth){var indent;depth=depth||0;indent=Array(2*depth+1).join(" ");return inspectedMp4.map(function(box){return indent+box.type+"\n"+Object.keys(box).filter(function(key){return"type"!==key&&"boxes"!==key}).map(function(key){var prefix=indent+"  "+key+": ",value=box[key];if(value instanceof Uint8Array||value instanceof Uint32Array){var bytes=Array.prototype.slice.call(new Uint8Array(value.buffer,value.byteOffset,value.byteLength)).map(function(_byte){return" "+("00"+_byte.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);if(!bytes){return prefix+"<>"}if(1===bytes.length){return prefix+"<"+bytes.join("").slice(1)+">"}return prefix+"<\n"+bytes.map(function(line){return indent+"  "+line}).join("\n")+"\n"+indent+"  >"}return prefix+JSON.stringify(value,null,2).split("\n").map(function(line,index){if(0===index){return line}return indent+"  "+line}).join("\n")}).join("\n")+(box.boxes?"\n"+_textifyMp(box.boxes,depth+1):"")}).join("\n")};var mp4Inspector={inspect:inspectMp4,textify:_textifyMp,parseType:parseType,findBox:findBox,parseTraf:parse$1.traf,parseTfdt:parse$1.tfdt,parseHdlr:parse$1.hdlr,parseTfhd:parse$1.tfhd,parseTrun:parse$1.trun,parseSidx:parse$1.sidx},toUnsigned$2=bin.toUnsigned,toHexString$1=bin.toHexString,timescale,startTime,compositionStartTime,getVideoTrackIds,getTracks;timescale=function(init){var traks=mp4Inspector.findBox(init,["moov","trak"]);return traks.reduce(function(result,trak){var tkhd,version,index,id,mdhd;tkhd=mp4Inspector.findBox(trak,["tkhd"])[0];if(!tkhd){return null}version=tkhd[0];index=0===version?12:20;id=toUnsigned$2(tkhd[index]<<24|tkhd[index+1]<<16|tkhd[index+2]<<8|tkhd[index+3]);mdhd=mp4Inspector.findBox(trak,["mdia","mdhd"])[0];if(!mdhd){return null}version=mdhd[0];index=0===version?12:20;result[id]=toUnsigned$2(mdhd[index]<<24|mdhd[index+1]<<16|mdhd[index+2]<<8|mdhd[index+3]);return result},{})};startTime=function(timescale,fragment){var trafs,baseTimes,result;trafs=mp4Inspector.findBox(fragment,["moof","traf"]);baseTimes=[].concat.apply([],trafs.map(function(traf){return mp4Inspector.findBox(traf,["tfhd"]).map(function(tfhd){var id,scale,baseTime;id=toUnsigned$2(tfhd[4]<<24|tfhd[5]<<16|tfhd[6]<<8|tfhd[7]);scale=timescale[id]||9e4;baseTime=mp4Inspector.findBox(traf,["tfdt"]).map(function(tfdt){var version,result;version=tfdt[0];result=toUnsigned$2(tfdt[4]<<24|tfdt[5]<<16|tfdt[6]<<8|tfdt[7]);if(1===version){result*=Math.pow(2,32);result+=toUnsigned$2(tfdt[8]<<24|tfdt[9]<<16|tfdt[10]<<8|tfdt[11])}return result})[0];baseTime=baseTime||1/0;return baseTime/scale})}));result=Math.min.apply(null,baseTimes);return isFinite(result)?result:0};compositionStartTime=function(timescales,fragment){var trafBoxes=mp4Inspector.findBox(fragment,["moof","traf"]),baseMediaDecodeTime=0,compositionTimeOffset=0,trackId;if(trafBoxes&&trafBoxes.length){for(var parsedTraf=mp4Inspector.parseTraf(trafBoxes[0]),i=0;i<parsedTraf.boxes.length;i++){if("tfhd"===parsedTraf.boxes[i].type){trackId=parsedTraf.boxes[i].trackId}else if("tfdt"===parsedTraf.boxes[i].type){baseMediaDecodeTime=parsedTraf.boxes[i].baseMediaDecodeTime}else if("trun"===parsedTraf.boxes[i].type&&parsedTraf.boxes[i].samples.length){compositionTimeOffset=parsedTraf.boxes[i].samples[0].compositionTimeOffset||0}}}var timescale=timescales[trackId]||9e4;return(baseMediaDecodeTime+compositionTimeOffset)/timescale};getVideoTrackIds=function(init){var traks=mp4Inspector.findBox(init,["moov","trak"]),videoTrackIds=[];traks.forEach(function(trak){var hdlrs=mp4Inspector.findBox(trak,["mdia","hdlr"]),tkhds=mp4Inspector.findBox(trak,["tkhd"]);hdlrs.forEach(function(hdlr,index){var handlerType=mp4Inspector.parseType(hdlr.subarray(8,12)),tkhd=tkhds[index],view,trackId;if("vide"===handlerType){view=new DataView(tkhd.buffer,tkhd.byteOffset,tkhd.byteLength);view.getUint8(0);trackId=view.getUint32(20);videoTrackIds.push(trackId)}})});return videoTrackIds};getTracks=function(init){var traks=mp4Inspector.findBox(init,["moov","trak"]),tracks=[];traks.forEach(function(trak){var track={},tkhd=mp4Inspector.findBox(trak,["tkhd"])[0],view;if(tkhd){view=new DataView(tkhd.buffer,tkhd.byteOffset,tkhd.byteLength);view.getUint8(0);track.id=view.getUint32(20)}var hdlr=mp4Inspector.findBox(trak,["mdia","hdlr"])[0];if(hdlr){var type=mp4Inspector.parseType(hdlr.subarray(8,12));if("vide"===type){track.type="video"}else if("soun"===type){track.type="audio"}else{track.type=type}}var stsd=mp4Inspector.findBox(trak,["mdia","minf","stbl","stsd"])[0];if(stsd){var sampleDescriptions=stsd.subarray(8);track.codec=mp4Inspector.parseType(sampleDescriptions.subarray(4,8));var codecBox=mp4Inspector.findBox(sampleDescriptions,[track.codec])[0],codecConfig,codecConfigType;if(codecBox){if(/^[a-z]vc[1-9]$/i.test(track.codec)){codecConfig=codecBox.subarray(78);codecConfigType=mp4Inspector.parseType(codecConfig.subarray(4,8));if("avcC"===codecConfigType&&11<codecConfig.length){track.codec+=".";track.codec+=toHexString$1(codecConfig[9]);track.codec+=toHexString$1(codecConfig[10]);track.codec+=toHexString$1(codecConfig[11])}else{track.codec="avc1.4d400d"}}else if(/^mp4[a,v]$/i.test(track.codec)){codecConfig=codecBox.subarray(28);codecConfigType=mp4Inspector.parseType(codecConfig.subarray(4,8));if("esds"===codecConfigType&&20<codecConfig.length&&0!==codecConfig[19]){track.codec+="."+toHexString$1(codecConfig[19]);track.codec+="."+toHexString$1(63&codecConfig[20]>>>2).replace(/^0/,"")}else{track.codec="mp4a.40.2"}}}}var mdhd=mp4Inspector.findBox(trak,["mdia","mdhd"])[0];if(mdhd&&tkhd){20;track.timescale=toUnsigned$2(mdhd[20]<<24|mdhd[21]<<16|mdhd[22]<<8|mdhd[23])}tracks.push(track)});return tracks};var probe={findBox:mp4Inspector.findBox,parseType:mp4Inspector.parseType,timescale:timescale,startTime:startTime,compositionStartTime:compositionStartTime,videoTrackIds:getVideoTrackIds,tracks:getTracks},USER_DATA_REGISTERED_ITU_T_T35=4,parseSei=function(bytes){var i=0,result={payloadType:-1,payloadSize:0},payloadType=0,payloadSize=0;while(i<bytes.byteLength){if(bytes[i]===128){break}while(255===bytes[i]){payloadType+=255;i++}payloadType+=bytes[i++];while(255===bytes[i]){payloadSize+=255;i++}payloadSize+=bytes[i++];if(!result.payload&&payloadType===USER_DATA_REGISTERED_ITU_T_T35){var userIdentifier=String.fromCharCode(bytes[i+3],bytes[i+4],bytes[i+5],bytes[i+6]);if("GA94"===userIdentifier){result.payloadType=payloadType;result.payloadSize=payloadSize;result.payload=bytes.subarray(i,i+payloadSize);break}else{result.payload=void 0}}i+=payloadSize;payloadType=0;payloadSize=0}return result},parseCaptionPackets=function(pts,userData){var results=[],i,count,offset,data;if(!(64&userData[0])){return results}count=31&userData[0];for(i=0;i<count;i++){offset=3*i;data={type:3&userData[offset+2],pts:pts};if(4&userData[offset+2]){data.ccData=userData[offset+3]<<8|userData[offset+4];results.push(data)}}return results},discardEmulationPreventionBytes=function(data){var length=data.byteLength,emulationPreventionBytesPositions=[],i=1,newLength,newData;while(i<length-2){if(0===data[i]&&0===data[i+1]&&3===data[i+2]){emulationPreventionBytesPositions.push(i+2);i+=2}else{i++}}if(0===emulationPreventionBytesPositions.length){return data}newLength=length-emulationPreventionBytesPositions.length;newData=new Uint8Array(newLength);var sourceIndex=0;for(i=0;i<newLength;sourceIndex++,i++){if(sourceIndex===emulationPreventionBytesPositions[0]){sourceIndex++;emulationPreventionBytesPositions.shift()}newData[i]=data[sourceIndex]}return newData},captionPacketParser={parseSei:parseSei,parseUserData:function(sei){if(181!==sei.payload[0]){return null}if(49!=(sei.payload[1]<<8|sei.payload[2])){return null}if("GA94"!==String.fromCharCode(sei.payload[3],sei.payload[4],sei.payload[5],sei.payload[6])){return null}if(3!==sei.payload[7]){return null}return sei.payload.subarray(8,sei.payload.length-1)},parseCaptionPackets:parseCaptionPackets,discardEmulationPreventionBytes:discardEmulationPreventionBytes,USER_DATA_REGISTERED_ITU_T_T35:USER_DATA_REGISTERED_ITU_T_T35},Stream$1=function(){this.init=function(){var listeners={};this.on=function(type,listener){if(!listeners[type]){listeners[type]=[]}listeners[type]=listeners[type].concat(listener)};this.off=function(type,listener){var index;if(!listeners[type]){return!1}index=listeners[type].indexOf(listener);listeners[type]=listeners[type].slice();listeners[type].splice(index,1);return-1<index};this.trigger=function(type){var callbacks,i,length,args;callbacks=listeners[type];if(!callbacks){return}if(2===arguments.length){length=callbacks.length;for(i=0;i<length;++i){callbacks[i].call(this,arguments[1])}}else{args=[];i=arguments.length;for(i=1;i<arguments.length;++i){args.push(arguments[i])}length=callbacks.length;for(i=0;i<length;++i){callbacks[i].apply(this,args)}}};this.dispose=function(){listeners={}}}};Stream$1.prototype.pipe=function(destination){this.on("data",function(data){destination.push(data)});this.on("done",function(flushSource){destination.flush(flushSource)});this.on("partialdone",function(flushSource){destination.partialFlush(flushSource)});this.on("endedtimeline",function(flushSource){destination.endTimeline(flushSource)});this.on("reset",function(flushSource){destination.reset(flushSource)});return destination};Stream$1.prototype.push=function(data){this.trigger("data",data)};Stream$1.prototype.flush=function(flushSource){this.trigger("done",flushSource)};Stream$1.prototype.partialFlush=function(flushSource){this.trigger("partialdone",flushSource)};Stream$1.prototype.endTimeline=function(flushSource){this.trigger("endedtimeline",flushSource)};Stream$1.prototype.reset=function(flushSource){this.trigger("reset",flushSource)};var stream=Stream$1,CaptionStream=function CaptionStream(){CaptionStream.prototype.init.call(this);this.captionPackets_=[];this.ccStreams_=[new Cea608Stream(0,0),new Cea608Stream(0,1),new Cea608Stream(1,0),new Cea608Stream(1,1)];this.reset();this.ccStreams_.forEach(function(cc){cc.on("data",this.trigger.bind(this,"data"));cc.on("partialdone",this.trigger.bind(this,"partialdone"));cc.on("done",this.trigger.bind(this,"done"))},this)};CaptionStream.prototype=new stream;CaptionStream.prototype.push=function(event){var sei,userData,newCaptionPackets;if("sei_rbsp"!==event.nalUnitType){return}sei=captionPacketParser.parseSei(event.escapedRBSP);if(sei.payloadType!==captionPacketParser.USER_DATA_REGISTERED_ITU_T_T35){return}userData=captionPacketParser.parseUserData(sei);if(!userData){return}if(event.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}else if(event.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.numSameDts_--;if(!this.numSameDts_){this.ignoreNextEqualDts_=!1}return}newCaptionPackets=captionPacketParser.parseCaptionPackets(event.pts,userData);this.captionPackets_=this.captionPackets_.concat(newCaptionPackets);if(this.latestDts_!==event.dts){this.numSameDts_=0}this.numSameDts_++;this.latestDts_=event.dts};CaptionStream.prototype.flushCCStreams=function(flushType){this.ccStreams_.forEach(function(cc){return"flush"===flushType?cc.flush():cc.partialFlush()},this)};CaptionStream.prototype.flushStream=function(flushType){if(!this.captionPackets_.length){this.flushCCStreams(flushType);return}this.captionPackets_.forEach(function(elem,idx){elem.presortIndex=idx});this.captionPackets_.sort(function(a,b){if(a.pts===b.pts){return a.presortIndex-b.presortIndex}return a.pts-b.pts});this.captionPackets_.forEach(function(packet){if(2>packet.type){this.dispatchCea608Packet(packet)}},this);this.captionPackets_.length=0;this.flushCCStreams(flushType)};CaptionStream.prototype.flush=function(){return this.flushStream("flush")};CaptionStream.prototype.partialFlush=function(){return this.flushStream("partialFlush")};CaptionStream.prototype.reset=function(){this.latestDts_=null;this.ignoreNextEqualDts_=!1;this.numSameDts_=0;this.activeCea608Channel_=[null,null];this.ccStreams_.forEach(function(ccStream){ccStream.reset()})};CaptionStream.prototype.dispatchCea608Packet=function(packet){if(this.setsTextOrXDSActive(packet)){this.activeCea608Channel_[packet.type]=null}else if(this.setsChannel1Active(packet)){this.activeCea608Channel_[packet.type]=0}else if(this.setsChannel2Active(packet)){this.activeCea608Channel_[packet.type]=1}if(null===this.activeCea608Channel_[packet.type]){return}this.ccStreams_[(packet.type<<1)+this.activeCea608Channel_[packet.type]].push(packet)};CaptionStream.prototype.setsChannel1Active=function(packet){return 4096==(30720&packet.ccData)};CaptionStream.prototype.setsChannel2Active=function(packet){return 6144==(30720&packet.ccData)};CaptionStream.prototype.setsTextOrXDSActive=function(packet){return 256==(28928&packet.ccData)||4138==(30974&packet.ccData)||6186==(30974&packet.ccData)};var CHARACTER_TRANSLATION={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},getCharFromCode=function(code){if(null===code){return""}code=CHARACTER_TRANSLATION[code]||code;return String.fromCharCode(code)},BOTTOM_ROW=14,ROWS=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],createDisplayBuffer=function(){var result=[],i=BOTTOM_ROW+1;while(i--){result.push("")}return result},Cea608Stream=function Cea608Stream(field,dataChannel){Cea608Stream.prototype.init.call(this);this.field_=field||0;this.dataChannel_=dataChannel||0;this.name_="CC"+((this.field_<<1|this.dataChannel_)+1);this.setConstants();this.reset();this.push=function(packet){var data,swap,char0,char1,text;data=32639&packet.ccData;if(data===this.lastControlCode_){this.lastControlCode_=null;return}if(4096==(61440&data)){this.lastControlCode_=data}else if(data!==this.PADDING_){this.lastControlCode_=null}char0=data>>>8;char1=255&data;if(data===this.PADDING_){}else if(data===this.RESUME_CAPTION_LOADING_){this.mode_="popOn"}else if(data===this.END_OF_CAPTION_){this.mode_="popOn";this.clearFormatting(packet.pts);this.flushDisplayed(packet.pts);swap=this.displayed_;this.displayed_=this.nonDisplayed_;this.nonDisplayed_=swap;this.startPts_=packet.pts}else if(data===this.ROLL_UP_2_ROWS_){this.rollUpRows_=2;this.setRollUp(packet.pts)}else if(data===this.ROLL_UP_3_ROWS_){this.rollUpRows_=3;this.setRollUp(packet.pts)}else if(data===this.ROLL_UP_4_ROWS_){this.rollUpRows_=4;this.setRollUp(packet.pts)}else if(data===this.CARRIAGE_RETURN_){this.clearFormatting(packet.pts);this.flushDisplayed(packet.pts);this.shiftRowsUp_();this.startPts_=packet.pts}else if(data===this.BACKSPACE_){if("popOn"===this.mode_){this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1)}else{this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1)}}else if(data===this.ERASE_DISPLAYED_MEMORY_){this.flushDisplayed(packet.pts);this.displayed_=createDisplayBuffer()}else if(data===this.ERASE_NON_DISPLAYED_MEMORY_){this.nonDisplayed_=createDisplayBuffer()}else if(data===this.RESUME_DIRECT_CAPTIONING_){if("paintOn"!==this.mode_){this.flushDisplayed(packet.pts);this.displayed_=createDisplayBuffer()}this.mode_="paintOn";this.startPts_=packet.pts}else if(this.isSpecialCharacter(char0,char1)){char0=(3&char0)<<8;text=getCharFromCode(char0|char1);this[this.mode_](packet.pts,text);this.column_++}else if(this.isExtCharacter(char0,char1)){if("popOn"===this.mode_){this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1)}else{this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1)}char0=(3&char0)<<8;text=getCharFromCode(char0|char1);this[this.mode_](packet.pts,text);this.column_++}else if(this.isMidRowCode(char0,char1)){this.clearFormatting(packet.pts);this[this.mode_](packet.pts," ");this.column_++;if(14==(14&char1)){this.addFormatting(packet.pts,["i"])}if(1==(1&char1)){this.addFormatting(packet.pts,["u"])}}else if(this.isOffsetControlCode(char0,char1)){this.column_+=3&char1}else if(this.isPAC(char0,char1)){var row=ROWS.indexOf(7968&data);if("rollUp"===this.mode_){if(0>row-this.rollUpRows_+1){row=this.rollUpRows_-1}this.setRollUp(packet.pts,row)}if(row!==this.row_){this.clearFormatting(packet.pts);this.row_=row}if(1&char1&&-1===this.formatting_.indexOf("u")){this.addFormatting(packet.pts,["u"])}if(16==(16&data)){this.column_=4*((14&data)>>1)}if(this.isColorPAC(char1)){if(14==(14&char1)){this.addFormatting(packet.pts,["i"])}}}else if(this.isNormalChar(char0)){if(0===char1){char1=null}text=getCharFromCode(char0);text+=getCharFromCode(char1);this[this.mode_](packet.pts,text);this.column_+=text.length}}};Cea608Stream.prototype=new stream;Cea608Stream.prototype.flushDisplayed=function(pts){var content=this.displayed_.map(function(row){try{return row.trim()}catch(e){console.error("Skipping malformed caption.");return""}}).join("\n").replace(/^\n+|\n+$/g,"");if(content.length){this.trigger("data",{startPts:this.startPts_,endPts:pts,text:content,stream:this.name_})}};Cea608Stream.prototype.reset=function(){this.mode_="popOn";this.topRow_=0;this.startPts_=0;this.displayed_=createDisplayBuffer();this.nonDisplayed_=createDisplayBuffer();this.lastControlCode_=null;this.column_=0;this.row_=BOTTOM_ROW;this.rollUpRows_=2;this.formatting_=[]};Cea608Stream.prototype.setConstants=function(){if(0===this.dataChannel_){this.BASE_=16;this.EXT_=17;this.CONTROL_=(20|this.field_)<<8;this.OFFSET_=23}else if(1===this.dataChannel_){this.BASE_=24;this.EXT_=25;this.CONTROL_=(28|this.field_)<<8;this.OFFSET_=31}this.PADDING_=0;this.RESUME_CAPTION_LOADING_=32|this.CONTROL_;this.END_OF_CAPTION_=47|this.CONTROL_;this.ROLL_UP_2_ROWS_=37|this.CONTROL_;this.ROLL_UP_3_ROWS_=38|this.CONTROL_;this.ROLL_UP_4_ROWS_=39|this.CONTROL_;this.CARRIAGE_RETURN_=45|this.CONTROL_;this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_;this.BACKSPACE_=33|this.CONTROL_;this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_;this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_};Cea608Stream.prototype.isSpecialCharacter=function(char0,char1){return char0===this.EXT_&&48<=char1&&63>=char1};Cea608Stream.prototype.isExtCharacter=function(char0,char1){return(char0===this.EXT_+1||char0===this.EXT_+2)&&32<=char1&&63>=char1};Cea608Stream.prototype.isMidRowCode=function(char0,char1){return char0===this.EXT_&&32<=char1&&47>=char1};Cea608Stream.prototype.isOffsetControlCode=function(char0,char1){return char0===this.OFFSET_&&33<=char1&&35>=char1};Cea608Stream.prototype.isPAC=function(char0,char1){return char0>=this.BASE_&&char0<this.BASE_+8&&64<=char1&&127>=char1};Cea608Stream.prototype.isColorPAC=function(char1){return 64<=char1&&79>=char1||96<=char1&&127>=char1};Cea608Stream.prototype.isNormalChar=function(_char){return 32<=_char&&127>=_char};Cea608Stream.prototype.setRollUp=function(pts,newBaseRow){if("rollUp"!==this.mode_){this.row_=BOTTOM_ROW;this.mode_="rollUp";this.flushDisplayed(pts);this.nonDisplayed_=createDisplayBuffer();this.displayed_=createDisplayBuffer()}if(newBaseRow!==void 0&&newBaseRow!==this.row_){for(var i=0;i<this.rollUpRows_;i++){this.displayed_[newBaseRow-i]=this.displayed_[this.row_-i];this.displayed_[this.row_-i]=""}}if(newBaseRow===void 0){newBaseRow=this.row_}this.topRow_=newBaseRow-this.rollUpRows_+1};Cea608Stream.prototype.addFormatting=function(pts,format){this.formatting_=this.formatting_.concat(format);var text=format.reduce(function(text,format){return text+"<"+format+">"},"");this[this.mode_](pts,text)};Cea608Stream.prototype.clearFormatting=function(pts){if(!this.formatting_.length){return}var text=this.formatting_.reverse().reduce(function(text,format){return text+"</"+format+">"},"");this.formatting_=[];this[this.mode_](pts,text)};Cea608Stream.prototype.popOn=function(pts,text){var baseRow=this.nonDisplayed_[this.row_];baseRow+=text;this.nonDisplayed_[this.row_]=baseRow};Cea608Stream.prototype.rollUp=function(pts,text){var baseRow=this.displayed_[this.row_];baseRow+=text;this.displayed_[this.row_]=baseRow};Cea608Stream.prototype.shiftRowsUp_=function(){var i;for(i=0;i<this.topRow_;i++){this.displayed_[i]=""}for(i=this.row_+1;i<BOTTOM_ROW+1;i++){this.displayed_[i]=""}for(i=this.topRow_;i<this.row_;i++){this.displayed_[i]=this.displayed_[i+1]}this.displayed_[this.row_]=""};Cea608Stream.prototype.paintOn=function(pts,text){var baseRow=this.displayed_[this.row_];baseRow+=text;this.displayed_[this.row_]=baseRow};var discardEmulationPreventionBytes$1=captionPacketParser.discardEmulationPreventionBytes,CaptionStream$1={CaptionStream:CaptionStream,Cea608Stream:Cea608Stream}.CaptionStream,mapToSample=function(offset,samples){for(var approximateOffset=offset,i=0,sample;i<samples.length;i++){sample=samples[i];if(approximateOffset<sample.size){return sample}approximateOffset-=sample.size}return null},findSeiNals=function(avcStream,samples,trackId){var avcView=new DataView(avcStream.buffer,avcStream.byteOffset,avcStream.byteLength),result=[],seiNal,i,length,lastMatchedSample;for(i=0;i+4<avcStream.length;i+=length){length=avcView.getUint32(i);i+=4;if(0>=length){continue}switch(31&avcStream[i]){case 6:var data=avcStream.subarray(i+1,i+1+length),matchingSample=mapToSample(i,samples);seiNal={nalUnitType:"sei_rbsp",size:length,data:data,escapedRBSP:discardEmulationPreventionBytes$1(data),trackId:trackId};if(matchingSample){seiNal.pts=matchingSample.pts;seiNal.dts=matchingSample.dts;lastMatchedSample=matchingSample}else if(lastMatchedSample){seiNal.pts=lastMatchedSample.pts;seiNal.dts=lastMatchedSample.dts}else{console.log("We've encountered a nal unit without data. See mux.js#233.");break}result.push(seiNal);break;}}return result},parseSamples=function(truns,baseMediaDecodeTime,tfhd){var currentDts=baseMediaDecodeTime,defaultSampleDuration=tfhd.defaultSampleDuration||0,defaultSampleSize=tfhd.defaultSampleSize||0,trackId=tfhd.trackId,allSamples=[];truns.forEach(function(trun){var trackRun=mp4Inspector.parseTrun(trun),samples=trackRun.samples;samples.forEach(function(sample){if(sample.duration===void 0){sample.duration=defaultSampleDuration}if(sample.size===void 0){sample.size=defaultSampleSize}sample.trackId=trackId;sample.dts=currentDts;if(sample.compositionTimeOffset===void 0){sample.compositionTimeOffset=0}sample.pts=currentDts+sample.compositionTimeOffset;currentDts+=sample.duration});allSamples=allSamples.concat(samples)});return allSamples},parseCaptionNals=function(segment,videoTrackId){var trafs=probe.findBox(segment,["moof","traf"]),mdats=probe.findBox(segment,["mdat"]),captionNals={},mdatTrafPairs=[];mdats.forEach(function(mdat,index){var matchingTraf=trafs[index];mdatTrafPairs.push({mdat:mdat,traf:matchingTraf})});mdatTrafPairs.forEach(function(pair){var mdat=pair.mdat,traf=pair.traf,tfhd=probe.findBox(traf,["tfhd"]),headerInfo=mp4Inspector.parseTfhd(tfhd[0]),trackId=headerInfo.trackId,tfdt=probe.findBox(traf,["tfdt"]),baseMediaDecodeTime=0<tfdt.length?mp4Inspector.parseTfdt(tfdt[0]).baseMediaDecodeTime:0,truns=probe.findBox(traf,["trun"]),samples,seiNals;if(videoTrackId===trackId&&0<truns.length){samples=parseSamples(truns,baseMediaDecodeTime,headerInfo);seiNals=findSeiNals(mdat,samples,trackId);if(!captionNals[trackId]){captionNals[trackId]=[]}captionNals[trackId]=captionNals[trackId].concat(seiNals)}});return captionNals},parseEmbeddedCaptions=function(segment,trackId,timescale){var seiNals;if(null===trackId){return null}seiNals=parseCaptionNals(segment,trackId);return{seiNals:seiNals[trackId],timescale:timescale}},captionParser=function(){var isInitialized=!1,captionStream,segmentCache,trackId,timescale,parsedCaptions,parsingPartial;this.isInitialized=function(){return isInitialized};this.init=function(options){captionStream=new CaptionStream$1;isInitialized=!0;parsingPartial=options?options.isPartial:!1;captionStream.on("data",function(event){event.startTime=event.startPts/timescale;event.endTime=event.endPts/timescale;parsedCaptions.captions.push(event);parsedCaptions.captionStreams[event.stream]=!0})};this.isNewInit=function(videoTrackIds,timescales){if(videoTrackIds&&0===videoTrackIds.length||timescales&&"object"===_typeof2(timescales)&&0===Object.keys(timescales).length){return!1}return trackId!==videoTrackIds[0]||timescale!==timescales[trackId]};this.parse=function(segment,videoTrackIds,timescales){var parsedData;if(!this.isInitialized()){return null}else if(!videoTrackIds||!timescales){return null}else if(this.isNewInit(videoTrackIds,timescales)){trackId=videoTrackIds[0];timescale=timescales[trackId]}else if(null===trackId||!timescale){segmentCache.push(segment);return null}while(0<segmentCache.length){var cachedSegment=segmentCache.shift();this.parse(cachedSegment,videoTrackIds,timescales)}parsedData=parseEmbeddedCaptions(segment,trackId,timescale);if(null===parsedData||!parsedData.seiNals){return null}this.pushNals(parsedData.seiNals);this.flushStream();return parsedCaptions};this.pushNals=function(nals){if(!this.isInitialized()||!nals||0===nals.length){return null}nals.forEach(function(nal){captionStream.push(nal)})};this.flushStream=function(){if(!this.isInitialized()){return null}if(!parsingPartial){captionStream.flush()}else{captionStream.partialFlush()}};this.clearParsedCaptions=function(){parsedCaptions.captions=[];parsedCaptions.captionStreams={}};this.resetCaptionStream=function(){if(!this.isInitialized()){return null}captionStream.reset()};this.clearAllCaptions=function(){this.clearParsedCaptions();this.resetCaptionStream()};this.reset=function(){segmentCache=[];trackId=null;timescale=null;if(!parsedCaptions){parsedCaptions={captions:[],captionStreams:{}}}else{this.clearParsedCaptions()}this.resetCaptionStream()};this.reset()},streamTypes={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},TYPE_SHARED="shared",handleRollover=function(value,reference){var direction=1;if(value>reference){direction=-1}while(Math.abs(reference-value)>4294967296){value+=direction*8589934592}return value},TimestampRolloverStream=function TimestampRolloverStream(type){var lastDTS,referenceDTS;TimestampRolloverStream.prototype.init.call(this);this.type_=type||TYPE_SHARED;this.push=function(data){if(this.type_!==TYPE_SHARED&&data.type!==this.type_){return}if(referenceDTS===void 0){referenceDTS=data.dts}data.dts=handleRollover(data.dts,referenceDTS);data.pts=handleRollover(data.pts,referenceDTS);lastDTS=data.dts;this.trigger("data",data)};this.flush=function(){referenceDTS=lastDTS;this.trigger("done")};this.endTimeline=function(){this.flush();this.trigger("endedtimeline")};this.discontinuity=function(){referenceDTS=void 0;lastDTS=void 0};this.reset=function(){this.discontinuity();this.trigger("reset")}};TimestampRolloverStream.prototype=new stream;var parsePid=function(packet){var pid=31&packet[1];pid<<=8;pid|=packet[2];return pid},parsePayloadUnitStartIndicator=function(packet){return!!(64&packet[1])},parseAdaptionField=function(packet){var offset=0;if(1<(48&packet[3])>>>4){offset+=packet[4]+1}return offset},parsePmt=function(packet){var programMapTable={},pusi=parsePayloadUnitStartIndicator(packet),payloadOffset=4+parseAdaptionField(packet);if(pusi){payloadOffset+=packet[payloadOffset]+1}if(!(1&packet[payloadOffset+5])){return}var sectionLength,tableEnd,programInfoLength;sectionLength=(15&packet[payloadOffset+1])<<8|packet[payloadOffset+2];tableEnd=3+sectionLength-4;programInfoLength=(15&packet[payloadOffset+10])<<8|packet[payloadOffset+11];var offset=12+programInfoLength;while(offset<tableEnd){var i=payloadOffset+offset;programMapTable[(31&packet[i+1])<<8|packet[i+2]]=packet[i];offset+=((15&packet[i+3])<<8|packet[i+4])+5}return programMapTable},parseNalUnitType=function(type){switch(type){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null;}},ADTS_SAMPLING_FREQUENCIES=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],parseSyncSafeInteger=function(data){return data[0]<<21|data[1]<<14|data[2]<<7|data[3]},percentEncode=function(bytes,start,end){var i,result="";for(i=start;i<end;i++){result+="%"+("00"+bytes[i].toString(16)).slice(-2)}return result},parseIso88591=function(bytes,start,end){return unescape(percentEncode(bytes,start,end))},parseSampleRate=function(packet){var i=0;while(i+5<packet.length){if(255!==packet[i]||240!=(246&packet[i+1])){i++;continue}return ADTS_SAMPLING_FREQUENCIES[(60&packet[i+2])>>>2]}return null},parseAacTimestamp=function(packet){var frameStart,frameSize,frame,frameHeader;frameStart=10;if(64&packet[5]){frameStart+=4;frameStart+=parseSyncSafeInteger(packet.subarray(10,14))}do{frameSize=parseSyncSafeInteger(packet.subarray(frameStart+4,frameStart+8));if(1>frameSize){return null}frameHeader=String.fromCharCode(packet[frameStart],packet[frameStart+1],packet[frameStart+2],packet[frameStart+3]);if("PRIV"===frameHeader){frame=packet.subarray(frameStart+10,frameStart+frameSize+10);for(var i=0;i<frame.byteLength;i++){if(0===frame[i]){var owner=parseIso88591(frame,0,i);if("com.apple.streaming.transportStreamTimestamp"===owner){var d=frame.subarray(i+1),size=(1&d[3])<<30|d[4]<<22|d[5]<<14|d[6]<<6|d[7]>>>2;size*=4;size+=3&d[7];return size}break}}}frameStart+=10;frameStart+=frameSize}while(frameStart<packet.byteLength);return null},ONE_SECOND_IN_TS=9e4,secondsToVideoTs,secondsToAudioTs,videoTsToSeconds,audioTsToSeconds,audioTsToVideoTs,videoTsToAudioTs,metadataTsToSeconds;secondsToVideoTs=function(seconds){return seconds*ONE_SECOND_IN_TS};secondsToAudioTs=function(seconds,sampleRate){return seconds*sampleRate};videoTsToSeconds=function(timestamp){return timestamp/ONE_SECOND_IN_TS};audioTsToSeconds=function(timestamp,sampleRate){return timestamp/sampleRate};audioTsToVideoTs=function(timestamp,sampleRate){return secondsToVideoTs(audioTsToSeconds(timestamp,sampleRate))};videoTsToAudioTs=function(timestamp,sampleRate){return secondsToAudioTs(videoTsToSeconds(timestamp),sampleRate)};metadataTsToSeconds=function(timestamp,timelineStartPts,keepOriginalTimestamps){return videoTsToSeconds(keepOriginalTimestamps?timestamp:timestamp-timelineStartPts)};var clock={ONE_SECOND_IN_TS:ONE_SECOND_IN_TS,secondsToVideoTs:secondsToVideoTs,secondsToAudioTs:secondsToAudioTs,videoTsToSeconds:videoTsToSeconds,audioTsToSeconds:audioTsToSeconds,audioTsToVideoTs:audioTsToVideoTs,videoTsToAudioTs:videoTsToAudioTs,metadataTsToSeconds:metadataTsToSeconds},handleRollover$1={TimestampRolloverStream:TimestampRolloverStream,handleRollover:handleRollover}.handleRollover,probe$2={};probe$2.ts={parseType:function(packet,pmtPid){var pid=parsePid(packet);if(0===pid){return"pat"}else if(pid===pmtPid){return"pmt"}else if(pmtPid){return"pes"}return null},parsePat:function(packet){var pusi=parsePayloadUnitStartIndicator(packet),offset=4+parseAdaptionField(packet);if(pusi){offset+=packet[offset]+1}return(31&packet[offset+10])<<8|packet[offset+11]},parsePmt:parsePmt,parsePayloadUnitStartIndicator:parsePayloadUnitStartIndicator,parsePesType:function(packet,programMapTable){var pid=parsePid(packet),type=programMapTable[pid];switch(type){case streamTypes.H264_STREAM_TYPE:return"video";case streamTypes.ADTS_STREAM_TYPE:return"audio";case streamTypes.METADATA_STREAM_TYPE:return"timed-metadata";default:return null;}},parsePesTime:function(packet){var pusi=parsePayloadUnitStartIndicator(packet);if(!pusi){return null}var offset=4+parseAdaptionField(packet);if(offset>=packet.byteLength){return null}var pes=null,ptsDtsFlags;ptsDtsFlags=packet[offset+7];if(192&ptsDtsFlags){pes={};pes.pts=(14&packet[offset+9])<<27|(255&packet[offset+10])<<20|(254&packet[offset+11])<<12|(255&packet[offset+12])<<5|(254&packet[offset+13])>>>3;pes.pts*=4;pes.pts+=(6&packet[offset+13])>>>1;pes.dts=pes.pts;if(64&ptsDtsFlags){pes.dts=(14&packet[offset+14])<<27|(255&packet[offset+15])<<20|(254&packet[offset+16])<<12|(255&packet[offset+17])<<5|(254&packet[offset+18])>>>3;pes.dts*=4;pes.dts+=(6&packet[offset+18])>>>1}}return pes},videoPacketContainsKeyFrame:function(packet){var offset=4+parseAdaptionField(packet),frameBuffer=packet.subarray(offset),frameI=0,frameSyncPoint=0,foundKeyFrame=!1,nalType;for(;frameSyncPoint<frameBuffer.byteLength-3;frameSyncPoint++){if(1===frameBuffer[frameSyncPoint+2]){frameI=frameSyncPoint+5;break}}while(frameI<frameBuffer.byteLength){switch(frameBuffer[frameI]){case 0:if(0!==frameBuffer[frameI-1]){frameI+=2;break}else if(0!==frameBuffer[frameI-2]){frameI++;break}if(frameSyncPoint+3!==frameI-2){nalType=parseNalUnitType(31&frameBuffer[frameSyncPoint+3]);if("slice_layer_without_partitioning_rbsp_idr"===nalType){foundKeyFrame=!0}}do{frameI++}while(1!==frameBuffer[frameI]&&frameI<frameBuffer.length);frameSyncPoint=frameI-2;frameI+=3;break;case 1:if(0!==frameBuffer[frameI-1]||0!==frameBuffer[frameI-2]){frameI+=3;break}nalType=parseNalUnitType(31&frameBuffer[frameSyncPoint+3]);if("slice_layer_without_partitioning_rbsp_idr"===nalType){foundKeyFrame=!0}frameSyncPoint=frameI-2;frameI+=3;break;default:frameI+=3;break;}}frameBuffer=frameBuffer.subarray(frameSyncPoint);frameI-=frameSyncPoint;frameSyncPoint=0;if(frameBuffer&&3<frameBuffer.byteLength){nalType=parseNalUnitType(31&frameBuffer[frameSyncPoint+3]);if("slice_layer_without_partitioning_rbsp_idr"===nalType){foundKeyFrame=!0}}return foundKeyFrame}};probe$2.aac={isLikelyAacData:function(data){if(data[0]===73&&data[1]===68&&data[2]===51){return!0}return!1},parseId3TagSize:function(header,byteIndex){var returnSize=header[byteIndex+6]<<21|header[byteIndex+7]<<14|header[byteIndex+8]<<7|header[byteIndex+9],flags=header[byteIndex+5];if((16&flags)>>4){return returnSize+20}return returnSize+10},parseAdtsSize:function(header,byteIndex){var lowThree=(224&header[byteIndex+5])>>5,middle=header[byteIndex+4]<<3,highTwo=header[byteIndex+3]&6144;return highTwo|middle|lowThree},parseType:function(header,byteIndex){if(header[byteIndex]===73&&header[byteIndex+1]===68&&header[byteIndex+2]===51){return"timed-metadata"}else if(header[byteIndex]&!0&&240==(240&header[byteIndex+1])){return"audio"}return null},parseSampleRate:parseSampleRate,parseAacTimestamp:parseAacTimestamp};var ONE_SECOND_IN_TS$1=clock.ONE_SECOND_IN_TS,MP2T_PACKET_LENGTH=188,SYNC_BYTE=71,parsePsi_=function(bytes,pmt){var startIndex=0,endIndex=MP2T_PACKET_LENGTH,packet,type;while(endIndex<bytes.byteLength){if(bytes[startIndex]===SYNC_BYTE&&bytes[endIndex]===SYNC_BYTE){packet=bytes.subarray(startIndex,endIndex);type=probe$2.ts.parseType(packet,pmt.pid);switch(type){case"pat":if(!pmt.pid){pmt.pid=probe$2.ts.parsePat(packet)}break;case"pmt":if(!pmt.table){pmt.table=probe$2.ts.parsePmt(packet)}break;}if(pmt.pid&&pmt.table){return}startIndex+=MP2T_PACKET_LENGTH;endIndex+=MP2T_PACKET_LENGTH;continue}startIndex++;endIndex++}},parseAudioPes_=function(bytes,pmt,result){var startIndex=0,endIndex=MP2T_PACKET_LENGTH,packet,type,pesType,pusi,parsed,endLoop=!1;while(endIndex<=bytes.byteLength){if(bytes[startIndex]===SYNC_BYTE&&(bytes[endIndex]===SYNC_BYTE||endIndex===bytes.byteLength)){packet=bytes.subarray(startIndex,endIndex);type=probe$2.ts.parseType(packet,pmt.pid);switch(type){case"pes":pesType=probe$2.ts.parsePesType(packet,pmt.table);pusi=probe$2.ts.parsePayloadUnitStartIndicator(packet);if("audio"===pesType&&pusi){parsed=probe$2.ts.parsePesTime(packet);if(parsed){parsed.type="audio";result.audio.push(parsed);endLoop=!0}}break;}if(endLoop){break}startIndex+=MP2T_PACKET_LENGTH;endIndex+=MP2T_PACKET_LENGTH;continue}startIndex++;endIndex++}endIndex=bytes.byteLength;startIndex=endIndex-MP2T_PACKET_LENGTH;endLoop=!1;while(0<=startIndex){if(bytes[startIndex]===SYNC_BYTE&&(bytes[endIndex]===SYNC_BYTE||endIndex===bytes.byteLength)){packet=bytes.subarray(startIndex,endIndex);type=probe$2.ts.parseType(packet,pmt.pid);switch(type){case"pes":pesType=probe$2.ts.parsePesType(packet,pmt.table);pusi=probe$2.ts.parsePayloadUnitStartIndicator(packet);if("audio"===pesType&&pusi){parsed=probe$2.ts.parsePesTime(packet);if(parsed){parsed.type="audio";result.audio.push(parsed);endLoop=!0}}break;}if(endLoop){break}startIndex-=MP2T_PACKET_LENGTH;endIndex-=MP2T_PACKET_LENGTH;continue}startIndex--;endIndex--}},parseVideoPes_=function(bytes,pmt,result){var startIndex=0,endIndex=MP2T_PACKET_LENGTH,packet,type,pesType,pusi,parsed,frame,i,pes,endLoop=!1,currentFrame={data:[],size:0};while(endIndex<bytes.byteLength){if(bytes[startIndex]===SYNC_BYTE&&bytes[endIndex]===SYNC_BYTE){packet=bytes.subarray(startIndex,endIndex);type=probe$2.ts.parseType(packet,pmt.pid);switch(type){case"pes":pesType=probe$2.ts.parsePesType(packet,pmt.table);pusi=probe$2.ts.parsePayloadUnitStartIndicator(packet);if("video"===pesType){if(pusi&&!endLoop){parsed=probe$2.ts.parsePesTime(packet);if(parsed){parsed.type="video";result.video.push(parsed);endLoop=!0}}if(!result.firstKeyFrame){if(pusi){if(0!==currentFrame.size){frame=new Uint8Array(currentFrame.size);i=0;while(currentFrame.data.length){pes=currentFrame.data.shift();frame.set(pes,i);i+=pes.byteLength}if(probe$2.ts.videoPacketContainsKeyFrame(frame)){var firstKeyFrame=probe$2.ts.parsePesTime(frame);if(firstKeyFrame){result.firstKeyFrame=firstKeyFrame;result.firstKeyFrame.type="video"}else{console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}}currentFrame.size=0}}currentFrame.data.push(packet);currentFrame.size+=packet.byteLength}}break;}if(endLoop&&result.firstKeyFrame){break}startIndex+=MP2T_PACKET_LENGTH;endIndex+=MP2T_PACKET_LENGTH;continue}startIndex++;endIndex++}endIndex=bytes.byteLength;startIndex=endIndex-MP2T_PACKET_LENGTH;endLoop=!1;while(0<=startIndex){if(bytes[startIndex]===SYNC_BYTE&&bytes[endIndex]===SYNC_BYTE){packet=bytes.subarray(startIndex,endIndex);type=probe$2.ts.parseType(packet,pmt.pid);switch(type){case"pes":pesType=probe$2.ts.parsePesType(packet,pmt.table);pusi=probe$2.ts.parsePayloadUnitStartIndicator(packet);if("video"===pesType&&pusi){parsed=probe$2.ts.parsePesTime(packet);if(parsed){parsed.type="video";result.video.push(parsed);endLoop=!0}}break;}if(endLoop){break}startIndex-=MP2T_PACKET_LENGTH;endIndex-=MP2T_PACKET_LENGTH;continue}startIndex--;endIndex--}},adjustTimestamp_=function(segmentInfo,baseTimestamp){if(segmentInfo.audio&&segmentInfo.audio.length){var audioBaseTimestamp=baseTimestamp;if("undefined"==typeof audioBaseTimestamp){audioBaseTimestamp=segmentInfo.audio[0].dts}segmentInfo.audio.forEach(function(info){info.dts=handleRollover$1(info.dts,audioBaseTimestamp);info.pts=handleRollover$1(info.pts,audioBaseTimestamp);info.dtsTime=info.dts/ONE_SECOND_IN_TS$1;info.ptsTime=info.pts/ONE_SECOND_IN_TS$1})}if(segmentInfo.video&&segmentInfo.video.length){var videoBaseTimestamp=baseTimestamp;if("undefined"==typeof videoBaseTimestamp){videoBaseTimestamp=segmentInfo.video[0].dts}segmentInfo.video.forEach(function(info){info.dts=handleRollover$1(info.dts,videoBaseTimestamp);info.pts=handleRollover$1(info.pts,videoBaseTimestamp);info.dtsTime=info.dts/ONE_SECOND_IN_TS$1;info.ptsTime=info.pts/ONE_SECOND_IN_TS$1});if(segmentInfo.firstKeyFrame){var frame=segmentInfo.firstKeyFrame;frame.dts=handleRollover$1(frame.dts,videoBaseTimestamp);frame.pts=handleRollover$1(frame.pts,videoBaseTimestamp);frame.dtsTime=frame.dts/ONE_SECOND_IN_TS$1;frame.ptsTime=frame.dts/ONE_SECOND_IN_TS$1}}},inspectAac_=function(bytes){var endLoop=!1,audioCount=0,sampleRate=null,timestamp=null,frameSize=0,byteIndex=0,packet;while(3<=bytes.length-byteIndex){var type=probe$2.aac.parseType(bytes,byteIndex);switch(type){case"timed-metadata":if(10>bytes.length-byteIndex){endLoop=!0;break}frameSize=probe$2.aac.parseId3TagSize(bytes,byteIndex);if(frameSize>bytes.length){endLoop=!0;break}if(null===timestamp){packet=bytes.subarray(byteIndex,byteIndex+frameSize);timestamp=probe$2.aac.parseAacTimestamp(packet)}byteIndex+=frameSize;break;case"audio":if(7>bytes.length-byteIndex){endLoop=!0;break}frameSize=probe$2.aac.parseAdtsSize(bytes,byteIndex);if(frameSize>bytes.length){endLoop=!0;break}if(null===sampleRate){packet=bytes.subarray(byteIndex,byteIndex+frameSize);sampleRate=probe$2.aac.parseSampleRate(packet)}audioCount++;byteIndex+=frameSize;break;default:byteIndex++;break;}if(endLoop){return null}}if(null===sampleRate||null===timestamp){return null}var audioTimescale=ONE_SECOND_IN_TS$1/sampleRate,result={audio:[{type:"audio",dts:timestamp,pts:timestamp},{type:"audio",dts:timestamp+1024*audioCount*audioTimescale,pts:timestamp+1024*audioCount*audioTimescale}]};return result},inspectTs_=function(bytes){var pmt={pid:null,table:null},result={};parsePsi_(bytes,pmt);for(var pid in pmt.table){if(pmt.table.hasOwnProperty(pid)){var type=pmt.table[pid];switch(type){case streamTypes.H264_STREAM_TYPE:result.video=[];parseVideoPes_(bytes,pmt,result);if(0===result.video.length){delete result.video}break;case streamTypes.ADTS_STREAM_TYPE:result.audio=[];parseAudioPes_(bytes,pmt,result);if(0===result.audio.length){delete result.audio}break;}}}return result};function _defineProperties(target,props){for(var i=0,descriptor;i<props.length;i++){descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value"in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}var createClass=function(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor},Stream$2=function(){function Stream(){this.listeners={}}var _proto=Stream.prototype;_proto.on=function(type,listener){if(!this.listeners[type]){this.listeners[type]=[]}this.listeners[type].push(listener)};_proto.off=function(type,listener){if(!this.listeners[type]){return!1}var index=this.listeners[type].indexOf(listener);this.listeners[type]=this.listeners[type].slice(0);this.listeners[type].splice(index,1);return-1<index};_proto.trigger=function(type){var callbacks=this.listeners[type];if(!callbacks){return}if(2===arguments.length){for(var length=callbacks.length,i=0;i<length;++i){callbacks[i].call(this,arguments[1])}}else{for(var args=Array.prototype.slice.call(arguments,1),_length=callbacks.length,_i=0;_i<_length;++_i){callbacks[_i].apply(this,args)}}};_proto.dispose=function(){this.listeners={}};_proto.pipe=function(destination){this.on("data",function(data){destination.push(data)})};return Stream}(),stream$1=Stream$2;function unpad(padded){return padded.subarray(0,padded.byteLength-padded[padded.byteLength-1])}var precompute=function(){var tables=[[[],[],[],[],[]],[[],[],[],[],[]]],encTable=tables[0],decTable=tables[1],sbox=encTable[4],sboxInv=decTable[4],i,x,xInv,d=[],th=[],x2,x4,x8,s,tEnc,tDec;for(i=0;256>i;i++){th[(d[i]=i<<1^283*(i>>7))^i]=i}for(x=xInv=0;!sbox[x];x^=x2||1,xInv=th[xInv]||1){s=xInv^xInv<<1^xInv<<2^xInv<<3^xInv<<4;s=99^(s>>8^255&s);sbox[x]=s;sboxInv[s]=x;x8=d[x4=d[x2=d[x]]];tDec=16843009*x8^65537*x4^257*x2^16843008*x;tEnc=257*d[s]^16843008*s;for(i=0;4>i;i++){encTable[i][x]=tEnc=tEnc<<24^tEnc>>>8;decTable[i][s]=tDec=tDec<<24^tDec>>>8}}for(i=0;5>i;i++){encTable[i]=encTable[i].slice(0);decTable[i]=decTable[i].slice(0)}return tables},aesTables=null,AES=function(){function AES(key){if(!aesTables){aesTables=precompute()}this._tables=[[aesTables[0][0].slice(),aesTables[0][1].slice(),aesTables[0][2].slice(),aesTables[0][3].slice(),aesTables[0][4].slice()],[aesTables[1][0].slice(),aesTables[1][1].slice(),aesTables[1][2].slice(),aesTables[1][3].slice(),aesTables[1][4].slice()]];var i,j,tmp,sbox=this._tables[0][4],decTable=this._tables[1],keyLen=key.length,rcon=1;if(4!==keyLen&&6!==keyLen&&8!==keyLen){throw new Error("Invalid aes key size")}var encKey=key.slice(0),decKey=[];this._key=[encKey,decKey];for(i=keyLen;i<4*keyLen+28;i++){tmp=encKey[i-1];if(0==i%keyLen||8===keyLen&&4==i%keyLen){tmp=sbox[tmp>>>24]<<24^sbox[255&tmp>>16]<<16^sbox[255&tmp>>8]<<8^sbox[255&tmp];if(0==i%keyLen){tmp=tmp<<8^tmp>>>24^rcon<<24;rcon=rcon<<1^283*(rcon>>7)}}encKey[i]=encKey[i-keyLen]^tmp}for(j=0;i;j++,i--){tmp=encKey[3&j?i:i-4];if(4>=i||4>j){decKey[j]=tmp}else{decKey[j]=decTable[0][sbox[tmp>>>24]]^decTable[1][sbox[255&tmp>>16]]^decTable[2][sbox[255&tmp>>8]]^decTable[3][sbox[255&tmp]]}}}var _proto=AES.prototype;_proto.decrypt=function(encrypted0,encrypted1,encrypted2,encrypted3,out,offset){var key=this._key[1],a=encrypted0^key[0],b=encrypted3^key[1],c=encrypted2^key[2],d=encrypted1^key[3],a2,b2,c2,nInnerRounds=key.length/4-2,i,kIndex=4,table=this._tables[1],table0=table[0],table1=table[1],table2=table[2],table3=table[3],sbox=table[4];for(i=0;i<nInnerRounds;i++){a2=table0[a>>>24]^table1[255&b>>16]^table2[255&c>>8]^table3[255&d]^key[kIndex];b2=table0[b>>>24]^table1[255&c>>16]^table2[255&d>>8]^table3[255&a]^key[kIndex+1];c2=table0[c>>>24]^table1[255&d>>16]^table2[255&a>>8]^table3[255&b]^key[kIndex+2];d=table0[d>>>24]^table1[255&a>>16]^table2[255&b>>8]^table3[255&c]^key[kIndex+3];kIndex+=4;a=a2;b=b2;c=c2}for(i=0;4>i;i++){out[(3&-i)+offset]=sbox[a>>>24]<<24^sbox[255&b>>16]<<16^sbox[255&c>>8]<<8^sbox[255&d]^key[kIndex++];a2=a;a=b;b=c;c=d;d=a2}};return AES}(),AsyncStream=function(_Stream){inheritsLoose(AsyncStream,_Stream);function AsyncStream(){var _this=_Stream.call(this,stream$1)||this;_this.jobs=[];_this.delay=1;_this.timeout_=null;return _this}var _proto=AsyncStream.prototype;_proto.processJob_=function(){this.jobs.shift()();if(this.jobs.length){this.timeout_=setTimeout(this.processJob_.bind(this),this.delay)}else{this.timeout_=null}};_proto.push=function(job){this.jobs.push(job);if(!this.timeout_){this.timeout_=setTimeout(this.processJob_.bind(this),this.delay)}};return AsyncStream}(stream$1),ntoh=function(word){return word<<24|(65280&word)<<8|(16711680&word)>>8|word>>>24},decrypt=function(encrypted,key,initVector){var encrypted32=new Int32Array(encrypted.buffer,encrypted.byteOffset,encrypted.byteLength>>2),decipher=new AES(Array.prototype.slice.call(key)),decrypted=new Uint8Array(encrypted.byteLength),decrypted32=new Int32Array(decrypted.buffer),init0,init1,init2,init3,encrypted0,encrypted1,encrypted2,encrypted3,wordIx;init0=initVector[0];init1=initVector[1];init2=initVector[2];init3=initVector[3];for(wordIx=0;wordIx<encrypted32.length;wordIx+=4){encrypted0=ntoh(encrypted32[wordIx]);encrypted1=ntoh(encrypted32[wordIx+1]);encrypted2=ntoh(encrypted32[wordIx+2]);encrypted3=ntoh(encrypted32[wordIx+3]);decipher.decrypt(encrypted0,encrypted1,encrypted2,encrypted3,decrypted32,wordIx);decrypted32[wordIx]=ntoh(decrypted32[wordIx]^init0);decrypted32[wordIx+1]=ntoh(decrypted32[wordIx+1]^init1);decrypted32[wordIx+2]=ntoh(decrypted32[wordIx+2]^init2);decrypted32[wordIx+3]=ntoh(decrypted32[wordIx+3]^init3);init0=encrypted0;init1=encrypted1;init2=encrypted2;init3=encrypted3}return decrypted},Decrypter=function(){function Decrypter(encrypted,key,initVector,done){var step=Decrypter.STEP,encrypted32=new Int32Array(encrypted.buffer),decrypted=new Uint8Array(encrypted.byteLength),i=0;this.asyncStream_=new AsyncStream;this.asyncStream_.push(this.decryptChunk_(encrypted32.subarray(i,i+step),key,initVector,decrypted));for(i=step;i<encrypted32.length;i+=step){initVector=new Uint32Array([ntoh(encrypted32[i-4]),ntoh(encrypted32[i-3]),ntoh(encrypted32[i-2]),ntoh(encrypted32[i-1])]);this.asyncStream_.push(this.decryptChunk_(encrypted32.subarray(i,i+step),key,initVector,decrypted))}this.asyncStream_.push(function(){done(null,unpad(decrypted))})}var _proto=Decrypter.prototype;_proto.decryptChunk_=function(encrypted,key,initVector,decrypted){return function(){var bytes=decrypt(encrypted,key,initVector);decrypted.set(bytes,encrypted.byteOffset)}};createClass(Decrypter,null,[{key:"STEP",get:function(){return 32e3}}]);return Decrypter}(),resolveUrl$1=function(baseURL,relativeURL){if(/^[a-z]+:/i.test(relativeURL)){return relativeURL}if(!/\/\//i.test(baseURL)){baseURL=urlToolkit.buildAbsoluteURL(window$3.location.href,baseURL)}return urlToolkit.buildAbsoluteURL(baseURL,relativeURL)},resolveManifestRedirect=function(handleManifestRedirect,url,req){if(handleManifestRedirect&&req.responseURL&&url!==req.responseURL){return req.responseURL}return url},classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}},createClass$1=function(){function defineProperties(target,props){for(var i=0,descriptor;i<props.length;i++){descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value"in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}(),get$1=function get(object,property,receiver){if(null===object)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===void 0){var parent=Object.getPrototypeOf(object);if(null===parent){}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===void 0){return}return getter.call(receiver)}},inherits$1=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass){throw new TypeError("Super expression must either be null or a function, not "+_typeof2(superClass))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass},possibleConstructorReturn=function(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&("object"===_typeof2(call)||"function"==typeof call)?call:self},slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=!0){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=!0;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}(),mergeOptions$1=videojs$1.mergeOptions,EventTarget$1=videojs$1.EventTarget,log$1=videojs$1.log,forEachMediaGroup=function(master,callback){["AUDIO","SUBTITLES"].forEach(function(mediaType){for(var groupKey in master.mediaGroups[mediaType]){for(var labelKey in master.mediaGroups[mediaType][groupKey]){var mediaProperties=master.mediaGroups[mediaType][groupKey][labelKey];callback(mediaProperties,mediaType,groupKey,labelKey)}}})},updateSegments=function(original,update,offset){var result=update.slice();offset=offset||0;for(var length=Math.min(original.length,update.length+offset),i=offset;i<length;i++){result[i-offset]=mergeOptions$1(original[i],result[i-offset])}return result},resolveSegmentUris=function(segment,baseUri){if(!segment.resolvedUri){segment.resolvedUri=resolveUrl$1(baseUri,segment.uri)}if(segment.key&&!segment.key.resolvedUri){segment.key.resolvedUri=resolveUrl$1(baseUri,segment.key.uri)}if(segment.map&&!segment.map.resolvedUri){segment.map.resolvedUri=resolveUrl$1(baseUri,segment.map.uri)}},updateMaster=function(master,media){var result=mergeOptions$1(master,{}),playlist=result.playlists[media.id];if(!playlist){return null}if(playlist.segments&&media.segments&&playlist.segments.length===media.segments.length&&playlist.endList===media.endList&&playlist.mediaSequence===media.mediaSequence){return null}var mergedPlaylist=mergeOptions$1(playlist,media);if(playlist.segments){mergedPlaylist.segments=updateSegments(playlist.segments,media.segments,media.mediaSequence-playlist.mediaSequence)}mergedPlaylist.segments.forEach(function(segment){resolveSegmentUris(segment,mergedPlaylist.resolvedUri)});for(var i=0;i<result.playlists.length;i++){if(result.playlists[i].id===media.id){result.playlists[i]=mergedPlaylist}}result.playlists[media.id]=mergedPlaylist;result.playlists[media.uri]=mergedPlaylist;return result},createPlaylistID=function(index,uri){return index+"-"+uri},setupMediaPlaylists=function(master){var i=master.playlists.length;while(i--){var playlist=master.playlists[i];playlist.resolvedUri=resolveUrl$1(master.uri,playlist.uri);playlist.id=createPlaylistID(i,playlist.uri);master.playlists[playlist.id]=playlist;master.playlists[playlist.uri]=playlist;if(!playlist.attributes){playlist.attributes={};log$1.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}}},resolveMediaGroupUris=function(master){forEachMediaGroup(master,function(properties){if(properties.uri){properties.resolvedUri=resolveUrl$1(master.uri,properties.uri)}})},refreshDelay=function(media,update){var lastSegment=media.segments[media.segments.length-1],delay=void 0;if(update&&lastSegment&&lastSegment.duration){delay=1e3*lastSegment.duration}else{delay=500*(media.targetDuration||10)}return delay},PlaylistLoader=function(_EventTarget){inherits$1(PlaylistLoader,_EventTarget);function PlaylistLoader(srcUrl,hls){var options=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};classCallCheck(this,PlaylistLoader);var _this=possibleConstructorReturn(this,(PlaylistLoader.__proto__||Object.getPrototypeOf(PlaylistLoader)).call(this)),_options$withCredenti=options.withCredentials,withCredentials=_options$withCredenti===void 0?!1:_options$withCredenti,_options$handleManife=options.handleManifestRedirects,handleManifestRedirects=_options$handleManife===void 0?!1:_options$handleManife;_this.srcUrl=srcUrl;_this.hls_=hls;_this.withCredentials=withCredentials;_this.handleManifestRedirects=handleManifestRedirects;var hlsOptions=hls.options_;_this.customTagParsers=hlsOptions&&hlsOptions.customTagParsers||[];_this.customTagMappers=hlsOptions&&hlsOptions.customTagMappers||[];if(!_this.srcUrl){throw new Error("A non-empty playlist URL is required")}_this.state="HAVE_NOTHING";_this.on("mediaupdatetimeout",function(){if("HAVE_METADATA"!==_this.state){return}_this.state="HAVE_CURRENT_METADATA";_this.request=_this.hls_.xhr({uri:resolveUrl$1(_this.master.uri,_this.media().uri),withCredentials:_this.withCredentials},function(error){if(!_this.request){return}if(error){return _this.playlistRequestError(_this.request,_this.media(),"HAVE_METADATA")}_this.haveMetadata(_this.request,_this.media().uri,_this.media().id)})});return _this}createClass$1(PlaylistLoader,[{key:"playlistRequestError",value:function(xhr,playlist,startingState){var uri=playlist.uri,id=playlist.id;this.request=null;if(startingState){this.state=startingState}this.error={playlist:this.master.playlists[id],status:xhr.status,message:"HLS playlist request error at URL: "+uri+".",responseText:xhr.responseText,code:500<=xhr.status?4:2};this.trigger("error")}},{key:"haveMetadata",value:function(xhr,url,id){var _this2=this;this.request=null;this.state="HAVE_METADATA";var parser=new Parser;this.customTagParsers.forEach(function(customParser){return parser.addParser(customParser)});this.customTagMappers.forEach(function(mapper){return parser.addTagMapper(mapper)});parser.push(xhr.responseText);parser.end();parser.manifest.uri=url;parser.manifest.id=id;parser.manifest.attributes=parser.manifest.attributes||{};var update=updateMaster(this.master,parser.manifest);this.targetDuration=parser.manifest.targetDuration;if(update){this.master=update;this.media_=this.master.playlists[id]}else{this.trigger("playlistunchanged")}if(!this.media().endList){window$3.clearTimeout(this.mediaUpdateTimeout);this.mediaUpdateTimeout=window$3.setTimeout(function(){_this2.trigger("mediaupdatetimeout")},refreshDelay(this.media(),!!update))}this.trigger("loadedplaylist")}},{key:"dispose",value:function(){this.trigger("dispose");this.stopRequest();window$3.clearTimeout(this.mediaUpdateTimeout);window$3.clearTimeout(this.finalRenditionTimeout);this.off()}},{key:"stopRequest",value:function(){if(this.request){var oldRequest=this.request;this.request=null;oldRequest.onreadystatechange=null;oldRequest.abort()}}},{key:"media",value:function(playlist,isFinalRendition){var _this3=this;if(!playlist){return this.media_}if("HAVE_NOTHING"===this.state){throw new Error("Cannot switch media playlist from "+this.state)}if("string"==typeof playlist){if(!this.master.playlists[playlist]){throw new Error("Unknown playlist URI: "+playlist)}playlist=this.master.playlists[playlist]}window$3.clearTimeout(this.finalRenditionTimeout);if(isFinalRendition){var delay=1e3*(playlist.targetDuration/2)||5000;this.finalRenditionTimeout=window$3.setTimeout(this.media.bind(this,playlist,!1),delay);return}var startingState=this.state,mediaChange=!this.media_||playlist.id!==this.media_.id;if(this.master.playlists[playlist.id].endList){if(this.request){this.request.onreadystatechange=null;this.request.abort();this.request=null}this.state="HAVE_METADATA";this.media_=playlist;if(mediaChange){this.trigger("mediachanging");this.trigger("mediachange")}return}if(!mediaChange){return}this.state="SWITCHING_MEDIA";if(this.request){if(playlist.resolvedUri===this.request.url){return}this.request.onreadystatechange=null;this.request.abort();this.request=null}if(this.media_){this.trigger("mediachanging")}this.request=this.hls_.xhr({uri:playlist.resolvedUri,withCredentials:this.withCredentials},function(error,req){if(!_this3.request){return}playlist.resolvedUri=resolveManifestRedirect(_this3.handleManifestRedirects,playlist.resolvedUri,req);if(error){return _this3.playlistRequestError(_this3.request,playlist,startingState)}_this3.haveMetadata(req,playlist.uri,playlist.id);if("HAVE_MASTER"===startingState){_this3.trigger("loadedmetadata")}else{_this3.trigger("mediachange")}})}},{key:"pause",value:function(){this.stopRequest();window$3.clearTimeout(this.mediaUpdateTimeout);if("HAVE_NOTHING"===this.state){this.started=!1}if("SWITCHING_MEDIA"===this.state){if(this.media_){this.state="HAVE_METADATA"}else{this.state="HAVE_MASTER"}}else if("HAVE_CURRENT_METADATA"===this.state){this.state="HAVE_METADATA"}}},{key:"load",value:function(isFinalRendition){var _this4=this;window$3.clearTimeout(this.mediaUpdateTimeout);var media=this.media();if(isFinalRendition){var delay=media?1e3*(media.targetDuration/2):5000;this.mediaUpdateTimeout=window$3.setTimeout(function(){return _this4.load()},delay);return}if(!this.started){this.start();return}if(media&&!media.endList){this.trigger("mediaupdatetimeout")}else{this.trigger("loadedplaylist")}}},{key:"start",value:function(){var _this5=this;this.started=!0;this.request=this.hls_.xhr({uri:this.srcUrl,withCredentials:this.withCredentials},function(error,req){if(!_this5.request){return}_this5.request=null;if(error){_this5.error={status:req.status,message:"HLS playlist request error at URL: "+_this5.srcUrl+".",responseText:req.responseText,code:2};if("HAVE_NOTHING"===_this5.state){_this5.started=!1}return _this5.trigger("error")}var parser=new Parser;_this5.customTagParsers.forEach(function(customParser){return parser.addParser(customParser)});_this5.customTagMappers.forEach(function(mapper){return parser.addTagMapper(mapper)});parser.push(req.responseText);parser.end();_this5.state="HAVE_MASTER";_this5.srcUrl=resolveManifestRedirect(_this5.handleManifestRedirects,_this5.srcUrl,req);parser.manifest.uri=_this5.srcUrl;if(parser.manifest.playlists){_this5.master=parser.manifest;setupMediaPlaylists(_this5.master);resolveMediaGroupUris(_this5.master);_this5.trigger("loadedplaylist");if(!_this5.request){_this5.media(parser.manifest.playlists[0])}return}var id=createPlaylistID(0,_this5.srcUrl);_this5.master={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:window$3.location.href,playlists:[{uri:_this5.srcUrl,id:id,resolvedUri:_this5.srcUrl,attributes:{}}]};_this5.master.playlists[id]=_this5.master.playlists[0];_this5.master.playlists[_this5.srcUrl]=_this5.master.playlists[0];_this5.haveMetadata(req,_this5.srcUrl,id);return _this5.trigger("loadedmetadata")})}}]);return PlaylistLoader}(EventTarget$1),createTimeRange=videojs$1.createTimeRange,backwardDuration=function(playlist,endSequence){var result=0,i=endSequence-playlist.mediaSequence,segment=playlist.segments[i];if(segment){if("undefined"!=typeof segment.start){return{result:segment.start,precise:!0}}if("undefined"!=typeof segment.end){return{result:segment.end-segment.duration,precise:!0}}}while(i--){segment=playlist.segments[i];if("undefined"!=typeof segment.end){return{result:result+segment.end,precise:!0}}result+=segment.duration;if("undefined"!=typeof segment.start){return{result:result+segment.start,precise:!0}}}return{result:result,precise:!1}},forwardDuration=function(playlist,endSequence){var result=0,segment=void 0,i=endSequence-playlist.mediaSequence;for(;i<playlist.segments.length;i++){segment=playlist.segments[i];if("undefined"!=typeof segment.start){return{result:segment.start-result,precise:!0}}result+=segment.duration;if("undefined"!=typeof segment.end){return{result:segment.end-result,precise:!0}}}return{result:-1,precise:!1}},intervalDuration=function(playlist,endSequence,expired){var backward=void 0,forward=void 0;if("undefined"==typeof endSequence){endSequence=playlist.mediaSequence+playlist.segments.length}if(endSequence<playlist.mediaSequence){return 0}backward=backwardDuration(playlist,endSequence);if(backward.precise){return backward.result}forward=forwardDuration(playlist,endSequence);if(forward.precise){return forward.result}return backward.result+expired},duration=function(playlist,endSequence,expired){if(!playlist){return 0}if("number"!=typeof expired){expired=0}if("undefined"==typeof endSequence){if(playlist.totalDuration){return playlist.totalDuration}if(!playlist.endList){return window$3.Infinity}}return intervalDuration(playlist,endSequence,expired)},sumDurations=function(playlist,startIndex,endIndex){var durations=0;if(startIndex>endIndex){var _ref=[endIndex,startIndex];startIndex=_ref[0];endIndex=_ref[1]}if(0>startIndex){for(var i=startIndex;i<Math.min(0,endIndex);i++){durations+=playlist.targetDuration}startIndex=0}for(var _i=startIndex;_i<endIndex;_i++){durations+=playlist.segments[_i].duration}return durations},safeLiveIndex=function(playlist,liveEdgePadding){if(!playlist.segments.length){return 0}var i=playlist.segments.length,lastSegmentDuration=playlist.segments[i-1].duration||playlist.targetDuration,safeDistance="number"==typeof liveEdgePadding?liveEdgePadding:lastSegmentDuration+2*playlist.targetDuration;if(0===safeDistance){return i}var distanceFromEnd=0;while(i--){distanceFromEnd+=playlist.segments[i].duration;if(distanceFromEnd>=safeDistance){break}}return Math.max(0,i)},playlistEnd=function(playlist,expired,useSafeLiveEnd,liveEdgePadding){if(!playlist||!playlist.segments){return null}if(playlist.endList){return duration(playlist)}if(null===expired){return null}expired=expired||0;var endSequence=useSafeLiveEnd?safeLiveIndex(playlist,liveEdgePadding):playlist.segments.length;return intervalDuration(playlist,playlist.mediaSequence+endSequence,expired)},isWholeNumber=function(num){return 0==num-Math.floor(num)},roundSignificantDigit=function(increment,num){if(isWholeNumber(num)){return num+.1*increment}for(var numDecimalDigits=num.toString().split(".")[1].length,i=1;i<=numDecimalDigits;i++){var scale=Math.pow(10,i),temp=num*scale;if(isWholeNumber(temp)||i===numDecimalDigits){return(temp+increment)/scale}}},ceilLeastSignificantDigit=roundSignificantDigit.bind(null,1),floorLeastSignificantDigit=roundSignificantDigit.bind(null,-1),getMediaInfoForTime=function(playlist,currentTime,startIndex,startTime){var i=void 0,segment=void 0,numSegments=playlist.segments.length,time=currentTime-startTime;if(0>time){if(0<startIndex){for(i=startIndex-1;0<=i;i--){segment=playlist.segments[i];time+=floorLeastSignificantDigit(segment.duration);if(0<time){return{mediaIndex:i,startTime:startTime-sumDurations(playlist,startIndex,i)}}}}return{mediaIndex:0,startTime:currentTime}}if(0>startIndex){for(i=startIndex;0>i;i++){time-=playlist.targetDuration;if(0>time){return{mediaIndex:0,startTime:currentTime}}}startIndex=0}for(i=startIndex;i<numSegments;i++){segment=playlist.segments[i];time-=ceilLeastSignificantDigit(segment.duration);if(0>time){return{mediaIndex:i,startTime:startTime+sumDurations(playlist,startIndex,i)}}}return{mediaIndex:numSegments-1,startTime:currentTime}},isBlacklisted=function(playlist){return playlist.excludeUntil&&playlist.excludeUntil>Date.now()},isIncompatible=function(playlist){return playlist.excludeUntil&&playlist.excludeUntil===1/0},isEnabled=function(playlist){var blacklisted=isBlacklisted(playlist);return!playlist.disabled&&!blacklisted},isAes=function(media){for(var i=0;i<media.segments.length;i++){if(media.segments[i].key){return!0}}return!1},isFmp4=function(media){for(var i=0;i<media.segments.length;i++){if(media.segments[i].map){return!0}}return!1},hasAttribute=function(attr,playlist){return playlist.attributes&&playlist.attributes[attr]},isLowestEnabledRendition=function(master,media){if(1===master.playlists.length){return!0}var currentBandwidth=media.attributes.BANDWIDTH||Number.MAX_VALUE;return 0===master.playlists.filter(function(playlist){if(!isEnabled(playlist)){return!1}return(playlist.attributes.BANDWIDTH||0)<currentBandwidth}).length},Playlist={duration:duration,seekable:function(playlist,expired,liveEdgePadding){var seekableEnd=playlistEnd(playlist,expired,!0,liveEdgePadding);if(null===seekableEnd){return createTimeRange()}return createTimeRange(expired||0,seekableEnd)},safeLiveIndex:safeLiveIndex,getMediaInfoForTime:getMediaInfoForTime,isEnabled:isEnabled,isDisabled:function(playlist){return playlist.disabled},isBlacklisted:isBlacklisted,isIncompatible:isIncompatible,playlistEnd:playlistEnd,isAes:isAes,isFmp4:isFmp4,hasAttribute:hasAttribute,estimateSegmentRequestTime:function(segmentDuration,bandwidth,playlist){var bytesReceived=3<arguments.length&&arguments[3]!==void 0?arguments[3]:0;if(!hasAttribute("BANDWIDTH",playlist)){return NaN}var size=segmentDuration*playlist.attributes.BANDWIDTH;return(size-8*bytesReceived)/bandwidth},isLowestEnabledRendition:isLowestEnabledRendition},videojsXHR=videojs$1.xhr,mergeOptions$1$1=videojs$1.mergeOptions,xhrFactory=function(){return function XhrFunction(options,callback){options=mergeOptions$1$1({timeout:45e3},options);var beforeRequest=XhrFunction.beforeRequest||videojs$1.Hls.xhr.beforeRequest;if(beforeRequest&&"function"==typeof beforeRequest){var newOptions=beforeRequest(options);if(newOptions){options=newOptions}}var request=videojsXHR(options,function(error,response){var reqResponse=request.response;if(!error&&reqResponse){request.responseTime=Date.now();request.roundTripTime=request.responseTime-request.requestTime;request.bytesReceived=reqResponse.byteLength||reqResponse.length;if(!request.bandwidth){request.bandwidth=Math.floor(1e3*(8*(request.bytesReceived/request.roundTripTime)))}}if(response.headers){request.responseHeaders=response.headers}if(error&&"ETIMEDOUT"===error.code){request.timedout=!0}if(!error&&!request.aborted&&200!==response.statusCode&&206!==response.statusCode&&0!==response.statusCode){error=new Error("XHR Failed with a response of: "+(request&&(reqResponse||request.responseText)))}callback(error,request)}),originalAbort=request.abort;request.abort=function(){request.aborted=!0;return originalAbort.apply(request,arguments)};request.uri=options.uri;request.requestTime=Date.now();return request}},byterangeStr=function(byterange){var byterangeStart=void 0,byterangeEnd=void 0;byterangeEnd=byterange.offset+byterange.length-1;byterangeStart=byterange.offset;return"bytes="+byterangeStart+"-"+byterangeEnd},segmentXhrHeaders=function(segment){var headers={};if(segment.byterange){headers.Range=byterangeStr(segment.byterange)}return headers},textRange=function(range,i){return range.start(i)+"-"+range.end(i)},formatHexString=function(e,i){var value=e.toString(16);return"00".substring(0,2-value.length)+value+(i%2?" ":"")},formatAsciiString=function(e){if(32<=e&&126>e){return String.fromCharCode(e)}return"."},createTransferableMessage=function(message){var transferable={};Object.keys(message).forEach(function(key){var value=message[key];if(ArrayBuffer.isView(value)){transferable[key]={bytes:value.buffer,byteOffset:value.byteOffset,byteLength:value.byteLength}}else{transferable[key]=value}});return transferable},initSegmentId=function(initSegment){var byterange=initSegment.byterange||{length:1/0,offset:0};return[byterange.length,byterange.offset,initSegment.resolvedUri].join(",")},segmentKeyId=function(key){return key.resolvedUri},hexDump=function(data){for(var bytes=Array.prototype.slice.call(data),step=16,result="",hex=void 0,ascii=void 0,j=0;j<bytes.length/step;j++){hex=bytes.slice(j*step,j*step+step).map(formatHexString).join("");ascii=bytes.slice(j*step,j*step+step).map(formatAsciiString).join("");result+=hex+" "+ascii+"\n"}return result},textRanges=function(ranges){var result="",i=void 0;for(i=0;i<ranges.length;i++){result+=textRange(ranges,i)+" "}return result},utils$1=Object.freeze({createTransferableMessage:createTransferableMessage,initSegmentId:initSegmentId,segmentKeyId:segmentKeyId,hexDump:hexDump,tagDump:function(_ref){var bytes=_ref.bytes;return hexDump(bytes)},textRanges:textRanges}),SEGMENT_END_FUDGE_PERCENT=.25,playerTimeToProgramTime=function(playerTime,segment){if(!segment.dateTimeObject){return null}var transmuxerPrependedSeconds=segment.videoTimingInfo.transmuxerPrependedSeconds,transmuxedStart=segment.videoTimingInfo.transmuxedPresentationStart;return new Date(segment.dateTimeObject.getTime()+1e3*(playerTime-(transmuxedStart+transmuxerPrependedSeconds)))},originalSegmentVideoDuration=function(videoTimingInfo){return videoTimingInfo.transmuxedPresentationEnd-videoTimingInfo.transmuxedPresentationStart-videoTimingInfo.transmuxerPrependedSeconds},findSegmentForProgramTime=function(programTime,playlist){var dateTimeObject;try{dateTimeObject=new Date(programTime)}catch(e){return null}if(!playlist||!playlist.segments||0===playlist.segments.length){return null}var segment=playlist.segments[0];if(dateTimeObject<segment.dateTimeObject){return null}for(var i=0;i<playlist.segments.length-1;i++){segment=playlist.segments[i];var nextSegmentStart=playlist.segments[i+1].dateTimeObject;if(dateTimeObject<nextSegmentStart){break}}var lastSegment=playlist.segments[playlist.segments.length-1],lastSegmentStart=lastSegment.dateTimeObject,lastSegmentDuration=lastSegment.videoTimingInfo?originalSegmentVideoDuration(lastSegment.videoTimingInfo):lastSegment.duration+lastSegment.duration*SEGMENT_END_FUDGE_PERCENT,lastSegmentEnd=new Date(lastSegmentStart.getTime()+1e3*lastSegmentDuration);if(dateTimeObject>lastSegmentEnd){return null}if(dateTimeObject>lastSegmentStart){segment=lastSegment}return{segment:segment,estimatedStart:segment.videoTimingInfo?segment.videoTimingInfo.transmuxedPresentationStart:Playlist.duration(playlist,playlist.mediaSequence+playlist.segments.indexOf(segment)),type:segment.videoTimingInfo?"accurate":"estimate"}},findSegmentForPlayerTime=function(time,playlist){if(!playlist||!playlist.segments||0===playlist.segments.length){return null}for(var segmentEnd=0,segment=void 0,i=0;i<playlist.segments.length;i++){segment=playlist.segments[i];segmentEnd=segment.videoTimingInfo?segment.videoTimingInfo.transmuxedPresentationEnd:segmentEnd+segment.duration;if(time<=segmentEnd){break}}var lastSegment=playlist.segments[playlist.segments.length-1];if(lastSegment.videoTimingInfo&&lastSegment.videoTimingInfo.transmuxedPresentationEnd<time){return null}if(time>segmentEnd){if(time>segmentEnd+lastSegment.duration*SEGMENT_END_FUDGE_PERCENT){return null}segment=lastSegment}return{segment:segment,estimatedStart:segment.videoTimingInfo?segment.videoTimingInfo.transmuxedPresentationStart:segmentEnd-segment.duration,type:segment.videoTimingInfo?"accurate":"estimate"}},getOffsetFromTimestamp=function(comparisonTimeStamp,programTime){var segmentDateTime=void 0,programDateTime=void 0;try{segmentDateTime=new Date(comparisonTimeStamp);programDateTime=new Date(programTime)}catch(e){}var segmentTimeEpoch=segmentDateTime.getTime(),programTimeEpoch=programDateTime.getTime();return(programTimeEpoch-segmentTimeEpoch)/1e3},verifyProgramDateTimeTags=function(playlist){if(!playlist.segments||0===playlist.segments.length){return!1}for(var i=0,segment;i<playlist.segments.length;i++){segment=playlist.segments[i];if(!segment.dateTimeObject){return!1}}return!0},getProgramTime=function(_ref){var playlist=_ref.playlist,_ref$time=_ref.time,time=_ref$time===void 0?void 0:_ref$time,callback=_ref.callback;if(!callback){throw new Error("getProgramTime: callback must be provided")}if(!playlist||time===void 0){return callback({message:"getProgramTime: playlist and time must be provided"})}var matchedSegment=findSegmentForPlayerTime(time,playlist);if(!matchedSegment){return callback({message:"valid programTime was not found"})}if("estimate"===matchedSegment.type){return callback({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:matchedSegment.estimatedStart})}var programTimeObject={mediaSeconds:time},programTime=playerTimeToProgramTime(time,matchedSegment.segment);if(programTime){programTimeObject.programDateTime=programTime.toISOString()}return callback(null,programTimeObject)},seekToProgramTime=function seekToProgramTime(_ref2){var programTime=_ref2.programTime,playlist=_ref2.playlist,_ref2$retryCount=_ref2.retryCount,retryCount=_ref2$retryCount===void 0?2:_ref2$retryCount,seekTo=_ref2.seekTo,_ref2$pauseAfterSeek=_ref2.pauseAfterSeek,pauseAfterSeek=_ref2$pauseAfterSeek===void 0?!0:_ref2$pauseAfterSeek,tech=_ref2.tech,callback=_ref2.callback;if(!callback){throw new Error("seekToProgramTime: callback must be provided")}if("undefined"==typeof programTime||!playlist||!seekTo){return callback({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"})}if(!playlist.endList&&!tech.hasStarted_){return callback({message:"player must be playing a live stream to start buffering"})}if(!verifyProgramDateTimeTags(playlist)){return callback({message:"programDateTime tags must be provided in the manifest "+playlist.resolvedUri})}var matchedSegment=findSegmentForProgramTime(programTime,playlist);if(!matchedSegment){return callback({message:programTime+" was not found in the stream"})}var segment=matchedSegment.segment,mediaOffset=getOffsetFromTimestamp(segment.dateTimeObject,programTime);if("estimate"===matchedSegment.type){if(0===retryCount){return callback({message:programTime+" is not buffered yet. Try again"})}seekTo(matchedSegment.estimatedStart+mediaOffset);tech.one("seeked",function(){seekToProgramTime({programTime:programTime,playlist:playlist,retryCount:retryCount-1,seekTo:seekTo,pauseAfterSeek:pauseAfterSeek,tech:tech,callback:callback})});return}var seekToTime=segment.start+mediaOffset;tech.one("seeked",function(){return callback(null,tech.currentTime())});if(pauseAfterSeek){tech.pause()}seekTo(seekToTime)},TIME_FUDGE_FACTOR=1/30,SAFE_TIME_DELTA=3*TIME_FUDGE_FACTOR,filterRanges=function(timeRanges,predicate){var results=[],i=void 0;if(timeRanges&&timeRanges.length){for(i=0;i<timeRanges.length;i++){if(predicate(timeRanges.start(i),timeRanges.end(i))){results.push([timeRanges.start(i),timeRanges.end(i)])}}}return videojs$1.createTimeRanges(results)},findRange=function(buffered,time){return filterRanges(buffered,function(start,end){return start-SAFE_TIME_DELTA<=time&&end+SAFE_TIME_DELTA>=time})},findNextRange=function(timeRanges,time){return filterRanges(timeRanges,function(start){return start-TIME_FUDGE_FACTOR>=time})},findGaps=function(buffered){if(2>buffered.length){return videojs$1.createTimeRanges()}for(var ranges=[],i=1;i<buffered.length;i++){var start=buffered.end(i-1),end=buffered.start(i);ranges.push([start,end])}return videojs$1.createTimeRanges(ranges)},printableRange=function(range){var strArr=[];if(!range||!range.length){return""}for(var i=0;i<range.length;i++){strArr.push(range.start(i)+" => "+range.end(i))}return strArr.join(", ")},timeUntilRebuffer=function(buffered,currentTime){var playbackRate=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,bufferedEnd=buffered.length?buffered.end(buffered.length-1):0;return(bufferedEnd-currentTime)/playbackRate},timeRangesToArray=function(timeRanges){for(var timeRangesList=[],i=0;i<timeRanges.length;i++){timeRangesList.push({start:timeRanges.start(i),end:timeRanges.end(i)})}return timeRangesList},createTextTracksIfNecessary=function(sourceBuffer,mediaSource,segment){var player=mediaSource.player_;if(segment.captions&&segment.captions.length){if(!sourceBuffer.inbandTextTracks_){sourceBuffer.inbandTextTracks_={}}for(var trackId in segment.captionStreams){if(!sourceBuffer.inbandTextTracks_[trackId]){player.tech_.trigger({type:"usage",name:"hls-608"});var track=player.textTracks().getTrackById(trackId);if(track){sourceBuffer.inbandTextTracks_[trackId]=track}else{sourceBuffer.inbandTextTracks_[trackId]=player.addRemoteTextTrack({kind:"captions",id:trackId,label:trackId},!1).track}}}}if(segment.metadata&&segment.metadata.length&&!sourceBuffer.metadataTrack_){sourceBuffer.metadataTrack_=player.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track;sourceBuffer.metadataTrack_.inBandMetadataTrackDispatchType=segment.metadata.dispatchType}},removeCuesFromTrack=function(start,end,track){var i=void 0,cue=void 0;if(!track){return}if(!track.cues){return}i=track.cues.length;while(i--){cue=track.cues[i];if(cue.startTime<=end&&cue.endTime>=start){track.removeCue(cue)}}},deprecateOldCue=function(cue){Object.defineProperties(cue.frame,{id:{get:function(){videojs$1.log.warn("cue.frame.id is deprecated. Use cue.value.key instead.");return cue.value.key}},value:{get:function(){videojs$1.log.warn("cue.frame.value is deprecated. Use cue.value.data instead.");return cue.value.data}},privateData:{get:function(){videojs$1.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead.");return cue.value.data}}})},durationOfVideo=function(duration){var dur;if(isNaN(duration)||Math.abs(duration)===1/0){dur=Number.MAX_VALUE}else{dur=duration}return dur},addTextTrackData=function(sourceHandler,captionArray,metadataArray){var Cue=window$3.WebKitDataCue||window$3.VTTCue;if(captionArray){captionArray.forEach(function(caption){var track=caption.stream;this.inbandTextTracks_[track].addCue(new Cue(caption.startTime+this.timestampOffset,caption.endTime+this.timestampOffset,caption.text))},sourceHandler)}if(metadataArray){var videoDuration=durationOfVideo(sourceHandler.mediaSource_.duration);metadataArray.forEach(function(metadata){var time=metadata.cueTime+this.timestampOffset;if("number"!=typeof time||window$3.isNaN(time)||0>time||!(time<1/0)){return}metadata.frames.forEach(function(frame){var cue=new Cue(time,time,frame.value||frame.url||frame.data||"");cue.frame=frame;cue.value=frame;deprecateOldCue(cue);this.metadataTrack_.addCue(cue)},this)},sourceHandler);if(sourceHandler.metadataTrack_&&sourceHandler.metadataTrack_.cues&&sourceHandler.metadataTrack_.cues.length){for(var cues=sourceHandler.metadataTrack_.cues,cuesArray=[],i=0;i<cues.length;i++){if(cues[i]){cuesArray.push(cues[i])}}var cuesGroupedByStartTime=cuesArray.reduce(function(obj,cue){var timeSlot=obj[cue.startTime]||[];timeSlot.push(cue);obj[cue.startTime]=timeSlot;return obj},{}),sortedStartTimes=Object.keys(cuesGroupedByStartTime).sort(function(a,b){return+a-+b});sortedStartTimes.forEach(function(startTime,idx){var cueGroup=cuesGroupedByStartTime[startTime],nextTime=+sortedStartTimes[idx+1]||videoDuration;cueGroup.forEach(function(cue){cue.endTime=nextTime})})}}},win="undefined"!=typeof window?window:{},TARGET="undefined"==typeof Symbol?"__target":Symbol(),BlobBuilder=win.BlobBuilder||win.WebKitBlobBuilder||win.MozBlobBuilder||win.MSBlobBuilder,URL=win.URL||win.webkitURL||URL&&URL.msURL,Worker=win.Worker;function shimWorker(filename,fn){return function(forceFallback){var o=this;if(!fn){return new Worker(filename)}else if(Worker&&!forceFallback){var source=fn.toString().replace(/^function.+?{/,"").slice(0,-1),objURL=createSourceObject(source);this[TARGET]=new Worker(objURL);wrapTerminate(this[TARGET],objURL);return this[TARGET]}else{var selfShim={postMessage:function(m){if(o.onmessage){setTimeout(function(){o.onmessage({data:m,target:selfShim})})}}};fn.call(selfShim);this.postMessage=function(m){setTimeout(function(){selfShim.onmessage({data:m,target:o})})};this.isThisThread=!0}}}if(Worker){var testWorker,objURL=createSourceObject("self.onmessage = function () {}"),testArray=new Uint8Array(1);try{testWorker=new Worker(objURL);testWorker.postMessage(testArray,[testArray.buffer])}catch(e){Worker=null}finally{URL.revokeObjectURL(objURL);if(testWorker){testWorker.terminate()}}}function createSourceObject(str){try{return URL.createObjectURL(new Blob([str],{type:"application/javascript"}))}catch(e){var blob=new BlobBuilder;blob.append(str);return URL.createObjectURL(blob.getBlob(type))}}function wrapTerminate(worker,objURL){if(!worker||!objURL)return;var term=worker.terminate;worker.objURL=objURL;worker.terminate=function(){if(worker.objURL)URL.revokeObjectURL(worker.objURL);term.call(worker)}}var TransmuxWorker=new shimWorker("./transmuxer-worker.worker.js",function(){var self=this,transmuxerWorker=function(){var Stream=function(){this.init=function(){var listeners={};this.on=function(type,listener){if(!listeners[type]){listeners[type]=[]}listeners[type]=listeners[type].concat(listener)};this.off=function(type,listener){var index;if(!listeners[type]){return!1}index=listeners[type].indexOf(listener);listeners[type]=listeners[type].slice();listeners[type].splice(index,1);return-1<index};this.trigger=function(type){var callbacks,i,length,args;callbacks=listeners[type];if(!callbacks){return}if(2===arguments.length){length=callbacks.length;for(i=0;i<length;++i){callbacks[i].call(this,arguments[1])}}else{args=[];i=arguments.length;for(i=1;i<arguments.length;++i){args.push(arguments[i])}length=callbacks.length;for(i=0;i<length;++i){callbacks[i].apply(this,args)}}};this.dispose=function(){listeners={}}}};Stream.prototype.pipe=function(destination){this.on("data",function(data){destination.push(data)});this.on("done",function(flushSource){destination.flush(flushSource)});this.on("partialdone",function(flushSource){destination.partialFlush(flushSource)});this.on("endedtimeline",function(flushSource){destination.endTimeline(flushSource)});this.on("reset",function(flushSource){destination.reset(flushSource)});return destination};Stream.prototype.push=function(data){this.trigger("data",data)};Stream.prototype.flush=function(flushSource){this.trigger("done",flushSource)};Stream.prototype.partialFlush=function(flushSource){this.trigger("partialdone",flushSource)};Stream.prototype.endTimeline=function(flushSource){this.trigger("endedtimeline",flushSource)};Stream.prototype.reset=function(flushSource){this.trigger("reset",flushSource)};var stream=Stream,UINT32_MAX=Math.pow(2,32)-1,box,dinf,esds,ftyp,mdat,mfhd,minf,moof,moov,mvex,mvhd,trak,tkhd,mdia,mdhd,hdlr,sdtp,stbl,stsd,traf,trex,trun,types,MAJOR_BRAND,MINOR_VERSION,AVC1_BRAND,VIDEO_HDLR,AUDIO_HDLR,HDLR_TYPES,VMHD,SMHD,DREF,STCO,STSC,STSZ,STTS;(function(){types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]};if("undefined"==typeof Uint8Array){return}for(var i in types){if(types.hasOwnProperty(i)){types[i]=[i.charCodeAt(0),i.charCodeAt(1),i.charCodeAt(2),i.charCodeAt(3)]}}MAJOR_BRAND=new Uint8Array([105,115,111,109]);AVC1_BRAND=new Uint8Array([97,118,99,49]);MINOR_VERSION=new Uint8Array([0,0,0,1]);VIDEO_HDLR=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);AUDIO_HDLR=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);HDLR_TYPES={video:VIDEO_HDLR,audio:AUDIO_HDLR};DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);SMHD=new Uint8Array([0,0,0,0,0,0,0,0]);STCO=new Uint8Array([0,0,0,0,0,0,0,0]);STSC=STCO;STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);STTS=STCO;VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])})();box=function(type){var payload=[],size=0,i,result,view;for(i=1;i<arguments.length;i++){payload.push(arguments[i])}i=payload.length;while(i--){size+=payload[i].byteLength}result=new Uint8Array(size+8);view=new DataView(result.buffer,result.byteOffset,result.byteLength);view.setUint32(0,result.byteLength);result.set(type,4);for(i=0,size=8;i<payload.length;i++){result.set(payload[i],size);size+=payload[i].byteLength}return result};dinf=function(){return box(types.dinf,box(types.dref,DREF))};esds=function(track){return box(types.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,track.audioobjecttype<<3|track.samplingfrequencyindex>>>1,track.samplingfrequencyindex<<7|track.channelcount<<3,6,1,2]))};ftyp=function(){return box(types.ftyp,MAJOR_BRAND,MINOR_VERSION,MAJOR_BRAND,AVC1_BRAND)};hdlr=function(type){return box(types.hdlr,HDLR_TYPES[type])};mdat=function(data){return box(types.mdat,data)};mdhd=function(track){var result=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,255&track.duration>>>24,255&track.duration>>>16,255&track.duration>>>8,255&track.duration,85,196,0,0]);if(track.samplerate){result[12]=255&track.samplerate>>>24;result[13]=255&track.samplerate>>>16;result[14]=255&track.samplerate>>>8;result[15]=255&track.samplerate}return box(types.mdhd,result)};mdia=function(track){return box(types.mdia,mdhd(track),hdlr(track.type),minf(track))};mfhd=function(sequenceNumber){return box(types.mfhd,new Uint8Array([0,0,0,0,(4278190080&sequenceNumber)>>24,(16711680&sequenceNumber)>>16,(65280&sequenceNumber)>>8,255&sequenceNumber]))};minf=function(track){return box(types.minf,"video"===track.type?box(types.vmhd,VMHD):box(types.smhd,SMHD),dinf(),stbl(track))};moof=function(sequenceNumber,tracks){var trackFragments=[],i=tracks.length;while(i--){trackFragments[i]=traf(tracks[i])}return box.apply(null,[types.moof,mfhd(sequenceNumber)].concat(trackFragments))};moov=function(tracks){var i=tracks.length,boxes=[];while(i--){boxes[i]=trak(tracks[i])}return box.apply(null,[types.moov,mvhd(4294967295)].concat(boxes).concat(mvex(tracks)))};mvex=function(tracks){var i=tracks.length,boxes=[];while(i--){boxes[i]=trex(tracks[i])}return box.apply(null,[types.mvex].concat(boxes))};mvhd=function(duration){var bytes=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&duration)>>24,(16711680&duration)>>16,(65280&duration)>>8,255&duration,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return box(types.mvhd,bytes)};sdtp=function(track){var samples=track.samples||[],bytes=new Uint8Array(4+samples.length),flags,i;for(i=0;i<samples.length;i++){flags=samples[i].flags;bytes[i+4]=flags.dependsOn<<4|flags.isDependedOn<<2|flags.hasRedundancy}return box(types.sdtp,bytes)};stbl=function(track){return box(types.stbl,stsd(track),box(types.stts,STTS),box(types.stsc,STSC),box(types.stsz,STSZ),box(types.stco,STCO))};(function(){var videoSample,audioSample;stsd=function(track){return box(types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===track.type?videoSample(track):audioSample(track))};videoSample=function(track){var sps=track.sps||[],pps=track.pps||[],sequenceParameterSets=[],pictureParameterSets=[],i,avc1Box;for(i=0;i<sps.length;i++){sequenceParameterSets.push((65280&sps[i].byteLength)>>>8);sequenceParameterSets.push(255&sps[i].byteLength);sequenceParameterSets=sequenceParameterSets.concat(Array.prototype.slice.call(sps[i]))}for(i=0;i<pps.length;i++){pictureParameterSets.push((65280&pps[i].byteLength)>>>8);pictureParameterSets.push(255&pps[i].byteLength);pictureParameterSets=pictureParameterSets.concat(Array.prototype.slice.call(pps[i]))}avc1Box=[types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&track.width)>>8,255&track.width,(65280&track.height)>>8,255&track.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),box(types.avcC,new Uint8Array([1,track.profileIdc,track.profileCompatibility,track.levelIdc,255].concat([sps.length],sequenceParameterSets,[pps.length],pictureParameterSets))),box(types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))];if(track.sarRatio){var hSpacing=track.sarRatio[0],vSpacing=track.sarRatio[1];avc1Box.push(box(types.pasp,new Uint8Array([(4278190080&hSpacing)>>24,(16711680&hSpacing)>>16,(65280&hSpacing)>>8,255&hSpacing,(4278190080&vSpacing)>>24,(16711680&vSpacing)>>16,(65280&vSpacing)>>8,255&vSpacing])))}return box.apply(null,avc1Box)};audioSample=function(track){return box(types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&track.channelcount)>>8,255&track.channelcount,(65280&track.samplesize)>>8,255&track.samplesize,0,0,0,0,(65280&track.samplerate)>>8,255&track.samplerate,0,0]),esds(track))}})();tkhd=function(track){var result=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&track.id)>>24,(16711680&track.id)>>16,(65280&track.id)>>8,255&track.id,0,0,0,0,(4278190080&track.duration)>>24,(16711680&track.duration)>>16,(65280&track.duration)>>8,255&track.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&track.width)>>8,255&track.width,0,0,(65280&track.height)>>8,255&track.height,0,0]);return box(types.tkhd,result)};traf=function(track){var trackFragmentHeader,trackFragmentDecodeTime,trackFragmentRun,sampleDependencyTable,dataOffset,upperWordBaseMediaDecodeTime,lowerWordBaseMediaDecodeTime;trackFragmentHeader=box(types.tfhd,new Uint8Array([0,0,0,58,(4278190080&track.id)>>24,(16711680&track.id)>>16,(65280&track.id)>>8,255&track.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0]));upperWordBaseMediaDecodeTime=Math.floor(track.baseMediaDecodeTime/(UINT32_MAX+1));lowerWordBaseMediaDecodeTime=Math.floor(track.baseMediaDecodeTime%(UINT32_MAX+1));trackFragmentDecodeTime=box(types.tfdt,new Uint8Array([1,0,0,0,255&upperWordBaseMediaDecodeTime>>>24,255&upperWordBaseMediaDecodeTime>>>16,255&upperWordBaseMediaDecodeTime>>>8,255&upperWordBaseMediaDecodeTime,255&lowerWordBaseMediaDecodeTime>>>24,255&lowerWordBaseMediaDecodeTime>>>16,255&lowerWordBaseMediaDecodeTime>>>8,255&lowerWordBaseMediaDecodeTime]));dataOffset=92;if("audio"===track.type){trackFragmentRun=trun(track,dataOffset);return box(types.traf,trackFragmentHeader,trackFragmentDecodeTime,trackFragmentRun)}sampleDependencyTable=sdtp(track);trackFragmentRun=trun(track,sampleDependencyTable.length+dataOffset);return box(types.traf,trackFragmentHeader,trackFragmentDecodeTime,trackFragmentRun,sampleDependencyTable)};trak=function(track){track.duration=track.duration||4294967295;return box(types.trak,tkhd(track),mdia(track))};trex=function(track){var result=new Uint8Array([0,0,0,0,(4278190080&track.id)>>24,(16711680&track.id)>>16,(65280&track.id)>>8,255&track.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);if("video"!==track.type){result[result.length-1]=0}return box(types.trex,result)};(function(){var audioTrun,videoTrun,trunHeader;trunHeader=function(samples,offset){var durationPresent=0,sizePresent=0,flagsPresent=0,compositionTimeOffset=0;if(samples.length){if(samples[0].duration!==void 0){durationPresent=1}if(samples[0].size!==void 0){sizePresent=2}if(samples[0].flags!==void 0){flagsPresent=4}if(samples[0].compositionTimeOffset!==void 0){compositionTimeOffset=8}}return[0,0,durationPresent|sizePresent|flagsPresent|compositionTimeOffset,1,(4278190080&samples.length)>>>24,(16711680&samples.length)>>>16,(65280&samples.length)>>>8,255&samples.length,(4278190080&offset)>>>24,(16711680&offset)>>>16,(65280&offset)>>>8,255&offset]};videoTrun=function(track,offset){var bytesOffest,bytes,header,samples,sample,i;samples=track.samples||[];offset+=20+16*samples.length;header=trunHeader(samples,offset);bytes=new Uint8Array(header.length+16*samples.length);bytes.set(header);bytesOffest=header.length;for(i=0;i<samples.length;i++){sample=samples[i];bytes[bytesOffest++]=(4278190080&sample.duration)>>>24;bytes[bytesOffest++]=(16711680&sample.duration)>>>16;bytes[bytesOffest++]=(65280&sample.duration)>>>8;bytes[bytesOffest++]=255&sample.duration;bytes[bytesOffest++]=(4278190080&sample.size)>>>24;bytes[bytesOffest++]=(16711680&sample.size)>>>16;bytes[bytesOffest++]=(65280&sample.size)>>>8;bytes[bytesOffest++]=255&sample.size;bytes[bytesOffest++]=sample.flags.isLeading<<2|sample.flags.dependsOn;bytes[bytesOffest++]=sample.flags.isDependedOn<<6|sample.flags.hasRedundancy<<4|sample.flags.paddingValue<<1|sample.flags.isNonSyncSample;bytes[bytesOffest++]=sample.flags.degradationPriority&61440;bytes[bytesOffest++]=15&sample.flags.degradationPriority;bytes[bytesOffest++]=(4278190080&sample.compositionTimeOffset)>>>24;bytes[bytesOffest++]=(16711680&sample.compositionTimeOffset)>>>16;bytes[bytesOffest++]=(65280&sample.compositionTimeOffset)>>>8;bytes[bytesOffest++]=255&sample.compositionTimeOffset}return box(types.trun,bytes)};audioTrun=function(track,offset){var bytes,bytesOffest,header,samples,sample,i;samples=track.samples||[];offset+=20+8*samples.length;header=trunHeader(samples,offset);bytes=new Uint8Array(header.length+8*samples.length);bytes.set(header);bytesOffest=header.length;for(i=0;i<samples.length;i++){sample=samples[i];bytes[bytesOffest++]=(4278190080&sample.duration)>>>24;bytes[bytesOffest++]=(16711680&sample.duration)>>>16;bytes[bytesOffest++]=(65280&sample.duration)>>>8;bytes[bytesOffest++]=255&sample.duration;bytes[bytesOffest++]=(4278190080&sample.size)>>>24;bytes[bytesOffest++]=(16711680&sample.size)>>>16;bytes[bytesOffest++]=(65280&sample.size)>>>8;bytes[bytesOffest++]=255&sample.size}return box(types.trun,bytes)};trun=function(track,offset){if("audio"===track.type){return audioTrun(track,offset)}return videoTrun(track,offset)}})();var mp4Generator={ftyp:ftyp,mdat:mdat,moof:moof,moov:moov,initSegment:function(tracks){var fileType=ftyp(),movie=moov(tracks),result;result=new Uint8Array(fileType.byteLength+movie.byteLength);result.set(fileType);result.set(movie,fileType.byteLength);return result}},createDefaultSample=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},sampleForFrame=function(frame,dataOffset){var sample=createDefaultSample();sample.dataOffset=dataOffset;sample.compositionTimeOffset=frame.pts-frame.dts;sample.duration=frame.duration;sample.size=4*frame.length;sample.size+=frame.byteLength;if(frame.keyFrame){sample.flags.dependsOn=2;sample.flags.isNonSyncSample=0}return sample},frameUtils={groupNalsIntoFrames:function(nalUnits){var i,currentNal,currentFrame=[],frames=[];frames.byteLength=0;frames.nalCount=0;frames.duration=0;currentFrame.byteLength=0;for(i=0;i<nalUnits.length;i++){currentNal=nalUnits[i];if("access_unit_delimiter_rbsp"===currentNal.nalUnitType){if(currentFrame.length){currentFrame.duration=currentNal.dts-currentFrame.dts;frames.byteLength+=currentFrame.byteLength;frames.nalCount+=currentFrame.length;frames.duration+=currentFrame.duration;frames.push(currentFrame)}currentFrame=[currentNal];currentFrame.byteLength=currentNal.data.byteLength;currentFrame.pts=currentNal.pts;currentFrame.dts=currentNal.dts}else{if("slice_layer_without_partitioning_rbsp_idr"===currentNal.nalUnitType){currentFrame.keyFrame=!0}currentFrame.duration=currentNal.dts-currentFrame.dts;currentFrame.byteLength+=currentNal.data.byteLength;currentFrame.push(currentNal)}}if(frames.length&&(!currentFrame.duration||0>=currentFrame.duration)){currentFrame.duration=frames[frames.length-1].duration}frames.byteLength+=currentFrame.byteLength;frames.nalCount+=currentFrame.length;frames.duration+=currentFrame.duration;frames.push(currentFrame);return frames},groupFramesIntoGops:function(frames){var i,currentFrame,currentGop=[],gops=[];currentGop.byteLength=0;currentGop.nalCount=0;currentGop.duration=0;currentGop.pts=frames[0].pts;currentGop.dts=frames[0].dts;gops.byteLength=0;gops.nalCount=0;gops.duration=0;gops.pts=frames[0].pts;gops.dts=frames[0].dts;for(i=0;i<frames.length;i++){currentFrame=frames[i];if(currentFrame.keyFrame){if(currentGop.length){gops.push(currentGop);gops.byteLength+=currentGop.byteLength;gops.nalCount+=currentGop.nalCount;gops.duration+=currentGop.duration}currentGop=[currentFrame];currentGop.nalCount=currentFrame.length;currentGop.byteLength=currentFrame.byteLength;currentGop.pts=currentFrame.pts;currentGop.dts=currentFrame.dts;currentGop.duration=currentFrame.duration}else{currentGop.duration+=currentFrame.duration;currentGop.nalCount+=currentFrame.length;currentGop.byteLength+=currentFrame.byteLength;currentGop.push(currentFrame)}}if(gops.length&&0>=currentGop.duration){currentGop.duration=gops[gops.length-1].duration}gops.byteLength+=currentGop.byteLength;gops.nalCount+=currentGop.nalCount;gops.duration+=currentGop.duration;gops.push(currentGop);return gops},extendFirstKeyFrame:function(gops){var currentGop;if(!gops[0][0].keyFrame&&1<gops.length){currentGop=gops.shift();gops.byteLength-=currentGop.byteLength;gops.nalCount-=currentGop.nalCount;gops[0][0].dts=currentGop.dts;gops[0][0].pts=currentGop.pts;gops[0][0].duration+=currentGop.duration}return gops},generateSampleTable:function(gops,baseDataOffset){var h,i,sample,currentGop,currentFrame,dataOffset=baseDataOffset||0,samples=[];for(h=0;h<gops.length;h++){currentGop=gops[h];for(i=0;i<currentGop.length;i++){currentFrame=currentGop[i];sample=sampleForFrame(currentFrame,dataOffset);dataOffset+=sample.size;samples.push(sample)}}return samples},concatenateNalData:function(gops){var h,i,j,currentGop,currentFrame,currentNal,dataOffset=0,nalsByteLength=gops.byteLength,numberOfNals=gops.nalCount,data=new Uint8Array(nalsByteLength+4*numberOfNals),view=new DataView(data.buffer);for(h=0;h<gops.length;h++){currentGop=gops[h];for(i=0;i<currentGop.length;i++){currentFrame=currentGop[i];for(j=0;j<currentFrame.length;j++){currentNal=currentFrame[j];view.setUint32(dataOffset,currentNal.data.byteLength);dataOffset+=4;data.set(currentNal.data,dataOffset);dataOffset+=currentNal.data.byteLength}}}return data},generateSampleTableForFrame:function(frame,baseDataOffset){var sample,samples=[];sample=sampleForFrame(frame,baseDataOffset||0);samples.push(sample);return samples},concatenateNalDataForFrame:function(frame){var i,currentNal,dataOffset=0,nalsByteLength=frame.byteLength,numberOfNals=frame.length,data=new Uint8Array(nalsByteLength+4*numberOfNals),view=new DataView(data.buffer);for(i=0;i<frame.length;i++){currentNal=frame[i];view.setUint32(dataOffset,currentNal.data.byteLength);dataOffset+=4;data.set(currentNal.data,dataOffset);dataOffset+=currentNal.data.byteLength}return data}},highPrefix=[33,16,5,32,164,27],lowPrefix=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],zeroFill=function(count){var a=[];while(count--){a.push(0)}return a},makeTable=function(metaTable){return Object.keys(metaTable).reduce(function(obj,key){obj[key]=new Uint8Array(metaTable[key].reduce(function(arr,part){return arr.concat(part)},[]));return obj},{})},silence,silence_1=function(){if(!silence){var coneOfSilence={96e3:[highPrefix,[227,64],zeroFill(154),[56]],88200:[highPrefix,[231],zeroFill(170),[56]],64e3:[highPrefix,[248,192],zeroFill(240),[56]],48e3:[highPrefix,[255,192],zeroFill(268),[55,148,128],zeroFill(54),[112]],44100:[highPrefix,[255,192],zeroFill(268),[55,163,128],zeroFill(84),[112]],32e3:[highPrefix,[255,192],zeroFill(268),[55,234],zeroFill(226),[112]],24e3:[highPrefix,[255,192],zeroFill(268),[55,255,128],zeroFill(268),[111,112],zeroFill(126),[224]],16e3:[highPrefix,[255,192],zeroFill(268),[55,255,128],zeroFill(268),[111,255],zeroFill(269),[223,108],zeroFill(195),[1,192]],12e3:[lowPrefix,zeroFill(268),[3,127,248],zeroFill(268),[6,255,240],zeroFill(268),[13,255,224],zeroFill(268),[27,253,128],zeroFill(259),[56]],11025:[lowPrefix,zeroFill(268),[3,127,248],zeroFill(268),[6,255,240],zeroFill(268),[13,255,224],zeroFill(268),[27,255,192],zeroFill(268),[55,175,128],zeroFill(108),[112]],8e3:[lowPrefix,zeroFill(268),[3,121,16],zeroFill(47),[7]]};silence=makeTable(coneOfSilence)}return silence},ONE_SECOND_IN_TS=9e4,secondsToVideoTs,secondsToAudioTs,videoTsToSeconds,audioTsToSeconds,audioTsToVideoTs,videoTsToAudioTs,metadataTsToSeconds;secondsToVideoTs=function(seconds){return seconds*ONE_SECOND_IN_TS};secondsToAudioTs=function(seconds,sampleRate){return seconds*sampleRate};videoTsToSeconds=function(timestamp){return timestamp/ONE_SECOND_IN_TS};audioTsToSeconds=function(timestamp,sampleRate){return timestamp/sampleRate};audioTsToVideoTs=function(timestamp,sampleRate){return secondsToVideoTs(audioTsToSeconds(timestamp,sampleRate))};videoTsToAudioTs=function(timestamp,sampleRate){return secondsToAudioTs(videoTsToSeconds(timestamp),sampleRate)};metadataTsToSeconds=function(timestamp,timelineStartPts,keepOriginalTimestamps){return videoTsToSeconds(keepOriginalTimestamps?timestamp:timestamp-timelineStartPts)};var clock={ONE_SECOND_IN_TS:ONE_SECOND_IN_TS,secondsToVideoTs:secondsToVideoTs,secondsToAudioTs:secondsToAudioTs,videoTsToSeconds:videoTsToSeconds,audioTsToSeconds:audioTsToSeconds,audioTsToVideoTs:audioTsToVideoTs,videoTsToAudioTs:videoTsToAudioTs,metadataTsToSeconds:metadataTsToSeconds},sumFrameByteLengths=function(array){var i,currentObj,sum=0;for(i=0;i<array.length;i++){currentObj=array[i];sum+=currentObj.data.byteLength}return sum},audioFrameUtils={prefixWithSilence:function(track,frames,audioAppendStartTs,videoBaseMediaDecodeTime){var baseMediaDecodeTimeTs,frameDuration=0,audioGapDuration=0,audioFillFrameCount=0,audioFillDuration=0,silentFrame,i,firstFrame;if(!frames.length){return}baseMediaDecodeTimeTs=clock.audioTsToVideoTs(track.baseMediaDecodeTime,track.samplerate);frameDuration=Math.ceil(clock.ONE_SECOND_IN_TS/(track.samplerate/1024));if(audioAppendStartTs&&videoBaseMediaDecodeTime){audioGapDuration=baseMediaDecodeTimeTs-Math.max(audioAppendStartTs,videoBaseMediaDecodeTime);audioFillFrameCount=Math.floor(audioGapDuration/frameDuration);audioFillDuration=audioFillFrameCount*frameDuration}if(1>audioFillFrameCount||audioFillDuration>clock.ONE_SECOND_IN_TS/2){return}silentFrame=silence_1()[track.samplerate];if(!silentFrame){silentFrame=frames[0].data}for(i=0;i<audioFillFrameCount;i++){firstFrame=frames[0];frames.splice(0,0,{data:silentFrame,dts:firstFrame.dts-frameDuration,pts:firstFrame.pts-frameDuration})}track.baseMediaDecodeTime-=Math.floor(clock.videoTsToAudioTs(audioFillDuration,track.samplerate))},trimAdtsFramesByEarliestDts:function(adtsFrames,track,earliestAllowedDts){if(track.minSegmentDts>=earliestAllowedDts){return adtsFrames}track.minSegmentDts=1/0;return adtsFrames.filter(function(currentFrame){if(currentFrame.dts>=earliestAllowedDts){track.minSegmentDts=Math.min(track.minSegmentDts,currentFrame.dts);track.minSegmentPts=track.minSegmentDts;return!0}return!1})},generateSampleTable:function(frames){var i,currentFrame,samples=[];for(i=0;i<frames.length;i++){currentFrame=frames[i];samples.push({size:currentFrame.data.byteLength,duration:1024})}return samples},concatenateFrameData:function(frames){var i,currentFrame,dataOffset=0,data=new Uint8Array(sumFrameByteLengths(frames));for(i=0;i<frames.length;i++){currentFrame=frames[i];data.set(currentFrame.data,dataOffset);dataOffset+=currentFrame.data.byteLength}return data}},ONE_SECOND_IN_TS$1=clock.ONE_SECOND_IN_TS,trackDecodeInfo={clearDtsInfo:function(track){delete track.minSegmentDts;delete track.maxSegmentDts;delete track.minSegmentPts;delete track.maxSegmentPts},calculateTrackBaseMediaDecodeTime:function(track,keepOriginalTimestamps){var baseMediaDecodeTime,scale,minSegmentDts=track.minSegmentDts;if(!keepOriginalTimestamps){minSegmentDts-=track.timelineStartInfo.dts}baseMediaDecodeTime=track.timelineStartInfo.baseMediaDecodeTime;baseMediaDecodeTime+=minSegmentDts;baseMediaDecodeTime=Math.max(0,baseMediaDecodeTime);if("audio"===track.type){scale=track.samplerate/ONE_SECOND_IN_TS$1;baseMediaDecodeTime*=scale;baseMediaDecodeTime=Math.floor(baseMediaDecodeTime)}return baseMediaDecodeTime},collectDtsInfo:function(track,data){if("number"==typeof data.pts){if(track.timelineStartInfo.pts===void 0){track.timelineStartInfo.pts=data.pts}if(track.minSegmentPts===void 0){track.minSegmentPts=data.pts}else{track.minSegmentPts=Math.min(track.minSegmentPts,data.pts)}if(track.maxSegmentPts===void 0){track.maxSegmentPts=data.pts}else{track.maxSegmentPts=Math.max(track.maxSegmentPts,data.pts)}}if("number"==typeof data.dts){if(track.timelineStartInfo.dts===void 0){track.timelineStartInfo.dts=data.dts}if(track.minSegmentDts===void 0){track.minSegmentDts=data.dts}else{track.minSegmentDts=Math.min(track.minSegmentDts,data.dts)}if(track.maxSegmentDts===void 0){track.maxSegmentDts=data.dts}else{track.maxSegmentDts=Math.max(track.maxSegmentDts,data.dts)}}}},USER_DATA_REGISTERED_ITU_T_T35=4,captionPacketParser={parseSei:function(bytes){var i=0,result={payloadType:-1,payloadSize:0},payloadType=0,payloadSize=0;while(i<bytes.byteLength){if(bytes[i]===128){break}while(255===bytes[i]){payloadType+=255;i++}payloadType+=bytes[i++];while(255===bytes[i]){payloadSize+=255;i++}payloadSize+=bytes[i++];if(!result.payload&&payloadType===USER_DATA_REGISTERED_ITU_T_T35){result.payloadType=payloadType;result.payloadSize=payloadSize;result.payload=bytes.subarray(i,i+payloadSize);break}i+=payloadSize;payloadType=0;payloadSize=0}return result},parseUserData:function(sei){if(181!==sei.payload[0]){return null}if(49!=(sei.payload[1]<<8|sei.payload[2])){return null}if("GA94"!==String.fromCharCode(sei.payload[3],sei.payload[4],sei.payload[5],sei.payload[6])){return null}if(3!==sei.payload[7]){return null}return sei.payload.subarray(8,sei.payload.length-1)},parseCaptionPackets:function(pts,userData){var results=[],i,count,offset,data;if(!(64&userData[0])){return results}count=31&userData[0];for(i=0;i<count;i++){offset=3*i;data={type:3&userData[offset+2],pts:pts};if(4&userData[offset+2]){data.ccData=userData[offset+3]<<8|userData[offset+4];results.push(data)}}return results},discardEmulationPreventionBytes:function(data){var length=data.byteLength,emulationPreventionBytesPositions=[],i=1,newLength,newData;while(i<length-2){if(0===data[i]&&0===data[i+1]&&3===data[i+2]){emulationPreventionBytesPositions.push(i+2);i+=2}else{i++}}if(0===emulationPreventionBytesPositions.length){return data}newLength=length-emulationPreventionBytesPositions.length;newData=new Uint8Array(newLength);var sourceIndex=0;for(i=0;i<newLength;sourceIndex++,i++){if(sourceIndex===emulationPreventionBytesPositions[0]){sourceIndex++;emulationPreventionBytesPositions.shift()}newData[i]=data[sourceIndex]}return newData},USER_DATA_REGISTERED_ITU_T_T35:USER_DATA_REGISTERED_ITU_T_T35},CaptionStream=function CaptionStream(){CaptionStream.prototype.init.call(this);this.captionPackets_=[];this.ccStreams_=[new Cea608Stream(0,0),new Cea608Stream(0,1),new Cea608Stream(1,0),new Cea608Stream(1,1)];this.reset();this.ccStreams_.forEach(function(cc){cc.on("data",this.trigger.bind(this,"data"));cc.on("partialdone",this.trigger.bind(this,"partialdone"));cc.on("done",this.trigger.bind(this,"done"))},this)};CaptionStream.prototype=new stream;CaptionStream.prototype.push=function(event){var sei,userData,newCaptionPackets;if("sei_rbsp"!==event.nalUnitType){return}sei=captionPacketParser.parseSei(event.escapedRBSP);if(sei.payloadType!==captionPacketParser.USER_DATA_REGISTERED_ITU_T_T35){return}userData=captionPacketParser.parseUserData(sei);if(!userData){return}if(event.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}else if(event.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.numSameDts_--;if(!this.numSameDts_){this.ignoreNextEqualDts_=!1}return}newCaptionPackets=captionPacketParser.parseCaptionPackets(event.pts,userData);this.captionPackets_=this.captionPackets_.concat(newCaptionPackets);if(this.latestDts_!==event.dts){this.numSameDts_=0}this.numSameDts_++;this.latestDts_=event.dts};CaptionStream.prototype.flushCCStreams=function(flushType){this.ccStreams_.forEach(function(cc){return"flush"===flushType?cc.flush():cc.partialFlush()},this)};CaptionStream.prototype.flushStream=function(flushType){if(!this.captionPackets_.length){this.flushCCStreams(flushType);return}this.captionPackets_.forEach(function(elem,idx){elem.presortIndex=idx});this.captionPackets_.sort(function(a,b){if(a.pts===b.pts){return a.presortIndex-b.presortIndex}return a.pts-b.pts});this.captionPackets_.forEach(function(packet){if(2>packet.type){this.dispatchCea608Packet(packet)}},this);this.captionPackets_.length=0;this.flushCCStreams(flushType)};CaptionStream.prototype.flush=function(){return this.flushStream("flush")};CaptionStream.prototype.partialFlush=function(){return this.flushStream("partialFlush")};CaptionStream.prototype.reset=function(){this.latestDts_=null;this.ignoreNextEqualDts_=!1;this.numSameDts_=0;this.activeCea608Channel_=[null,null];this.ccStreams_.forEach(function(ccStream){ccStream.reset()})};CaptionStream.prototype.dispatchCea608Packet=function(packet){if(this.setsTextOrXDSActive(packet)){this.activeCea608Channel_[packet.type]=null}else if(this.setsChannel1Active(packet)){this.activeCea608Channel_[packet.type]=0}else if(this.setsChannel2Active(packet)){this.activeCea608Channel_[packet.type]=1}if(null===this.activeCea608Channel_[packet.type]){return}this.ccStreams_[(packet.type<<1)+this.activeCea608Channel_[packet.type]].push(packet)};CaptionStream.prototype.setsChannel1Active=function(packet){return 4096==(30720&packet.ccData)};CaptionStream.prototype.setsChannel2Active=function(packet){return 6144==(30720&packet.ccData)};CaptionStream.prototype.setsTextOrXDSActive=function(packet){return 256==(28928&packet.ccData)||4138==(30974&packet.ccData)||6186==(30974&packet.ccData)};var CHARACTER_TRANSLATION={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},getCharFromCode=function(code){if(null===code){return""}code=CHARACTER_TRANSLATION[code]||code;return String.fromCharCode(code)},BOTTOM_ROW=14,ROWS=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],createDisplayBuffer=function(){var result=[],i=BOTTOM_ROW+1;while(i--){result.push("")}return result},Cea608Stream=function Cea608Stream(field,dataChannel){Cea608Stream.prototype.init.call(this);this.field_=field||0;this.dataChannel_=dataChannel||0;this.name_="CC"+((this.field_<<1|this.dataChannel_)+1);this.setConstants();this.reset();this.push=function(packet){var data,swap,char0,char1,text;data=32639&packet.ccData;if(data===this.lastControlCode_){this.lastControlCode_=null;return}if(4096==(61440&data)){this.lastControlCode_=data}else if(data!==this.PADDING_){this.lastControlCode_=null}char0=data>>>8;char1=255&data;if(data===this.PADDING_){}else if(data===this.RESUME_CAPTION_LOADING_){this.mode_="popOn"}else if(data===this.END_OF_CAPTION_){this.mode_="popOn";this.clearFormatting(packet.pts);this.flushDisplayed(packet.pts);swap=this.displayed_;this.displayed_=this.nonDisplayed_;this.nonDisplayed_=swap;this.startPts_=packet.pts}else if(data===this.ROLL_UP_2_ROWS_){this.rollUpRows_=2;this.setRollUp(packet.pts)}else if(data===this.ROLL_UP_3_ROWS_){this.rollUpRows_=3;this.setRollUp(packet.pts)}else if(data===this.ROLL_UP_4_ROWS_){this.rollUpRows_=4;this.setRollUp(packet.pts)}else if(data===this.CARRIAGE_RETURN_){this.clearFormatting(packet.pts);this.flushDisplayed(packet.pts);this.shiftRowsUp_();this.startPts_=packet.pts}else if(data===this.BACKSPACE_){if("popOn"===this.mode_){this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1)}else{this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1)}}else if(data===this.ERASE_DISPLAYED_MEMORY_){this.flushDisplayed(packet.pts);this.displayed_=createDisplayBuffer()}else if(data===this.ERASE_NON_DISPLAYED_MEMORY_){this.nonDisplayed_=createDisplayBuffer()}else if(data===this.RESUME_DIRECT_CAPTIONING_){if("paintOn"!==this.mode_){this.flushDisplayed(packet.pts);this.displayed_=createDisplayBuffer()}this.mode_="paintOn";this.startPts_=packet.pts}else if(this.isSpecialCharacter(char0,char1)){char0=(3&char0)<<8;text=getCharFromCode(char0|char1);this[this.mode_](packet.pts,text);this.column_++}else if(this.isExtCharacter(char0,char1)){if("popOn"===this.mode_){this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1)}else{this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1)}char0=(3&char0)<<8;text=getCharFromCode(char0|char1);this[this.mode_](packet.pts,text);this.column_++}else if(this.isMidRowCode(char0,char1)){this.clearFormatting(packet.pts);this[this.mode_](packet.pts," ");this.column_++;if(14==(14&char1)){this.addFormatting(packet.pts,["i"])}if(1==(1&char1)){this.addFormatting(packet.pts,["u"])}}else if(this.isOffsetControlCode(char0,char1)){this.column_+=3&char1}else if(this.isPAC(char0,char1)){var row=ROWS.indexOf(7968&data);if("rollUp"===this.mode_){if(0>row-this.rollUpRows_+1){row=this.rollUpRows_-1}this.setRollUp(packet.pts,row)}if(row!==this.row_){this.clearFormatting(packet.pts);this.row_=row}if(1&char1&&-1===this.formatting_.indexOf("u")){this.addFormatting(packet.pts,["u"])}if(16==(16&data)){this.column_=4*((14&data)>>1)}if(this.isColorPAC(char1)){if(14==(14&char1)){this.addFormatting(packet.pts,["i"])}}}else if(this.isNormalChar(char0)){if(0===char1){char1=null}text=getCharFromCode(char0);text+=getCharFromCode(char1);this[this.mode_](packet.pts,text);this.column_+=text.length}}};Cea608Stream.prototype=new stream;Cea608Stream.prototype.flushDisplayed=function(pts){var content=this.displayed_.map(function(row){try{return row.trim()}catch(e){console.error("Skipping malformed caption.");return""}}).join("\n").replace(/^\n+|\n+$/g,"");if(content.length){this.trigger("data",{startPts:this.startPts_,endPts:pts,text:content,stream:this.name_})}};Cea608Stream.prototype.reset=function(){this.mode_="popOn";this.topRow_=0;this.startPts_=0;this.displayed_=createDisplayBuffer();this.nonDisplayed_=createDisplayBuffer();this.lastControlCode_=null;this.column_=0;this.row_=BOTTOM_ROW;this.rollUpRows_=2;this.formatting_=[]};Cea608Stream.prototype.setConstants=function(){if(0===this.dataChannel_){this.BASE_=16;this.EXT_=17;this.CONTROL_=(20|this.field_)<<8;this.OFFSET_=23}else if(1===this.dataChannel_){this.BASE_=24;this.EXT_=25;this.CONTROL_=(28|this.field_)<<8;this.OFFSET_=31}this.PADDING_=0;this.RESUME_CAPTION_LOADING_=32|this.CONTROL_;this.END_OF_CAPTION_=47|this.CONTROL_;this.ROLL_UP_2_ROWS_=37|this.CONTROL_;this.ROLL_UP_3_ROWS_=38|this.CONTROL_;this.ROLL_UP_4_ROWS_=39|this.CONTROL_;this.CARRIAGE_RETURN_=45|this.CONTROL_;this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_;this.BACKSPACE_=33|this.CONTROL_;this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_;this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_};Cea608Stream.prototype.isSpecialCharacter=function(char0,char1){return char0===this.EXT_&&48<=char1&&63>=char1};Cea608Stream.prototype.isExtCharacter=function(char0,char1){return(char0===this.EXT_+1||char0===this.EXT_+2)&&32<=char1&&63>=char1};Cea608Stream.prototype.isMidRowCode=function(char0,char1){return char0===this.EXT_&&32<=char1&&47>=char1};Cea608Stream.prototype.isOffsetControlCode=function(char0,char1){return char0===this.OFFSET_&&33<=char1&&35>=char1};Cea608Stream.prototype.isPAC=function(char0,char1){return char0>=this.BASE_&&char0<this.BASE_+8&&64<=char1&&127>=char1};Cea608Stream.prototype.isColorPAC=function(char1){return 64<=char1&&79>=char1||96<=char1&&127>=char1};Cea608Stream.prototype.isNormalChar=function(_char){return 32<=_char&&127>=_char};Cea608Stream.prototype.setRollUp=function(pts,newBaseRow){if("rollUp"!==this.mode_){this.row_=BOTTOM_ROW;this.mode_="rollUp";this.flushDisplayed(pts);this.nonDisplayed_=createDisplayBuffer();this.displayed_=createDisplayBuffer()}if(newBaseRow!==void 0&&newBaseRow!==this.row_){for(var i=0;i<this.rollUpRows_;i++){this.displayed_[newBaseRow-i]=this.displayed_[this.row_-i];this.displayed_[this.row_-i]=""}}if(newBaseRow===void 0){newBaseRow=this.row_}this.topRow_=newBaseRow-this.rollUpRows_+1};Cea608Stream.prototype.addFormatting=function(pts,format){this.formatting_=this.formatting_.concat(format);var text=format.reduce(function(text,format){return text+"<"+format+">"},"");this[this.mode_](pts,text)};Cea608Stream.prototype.clearFormatting=function(pts){if(!this.formatting_.length){return}var text=this.formatting_.reverse().reduce(function(text,format){return text+"</"+format+">"},"");this.formatting_=[];this[this.mode_](pts,text)};Cea608Stream.prototype.popOn=function(pts,text){var baseRow=this.nonDisplayed_[this.row_];baseRow+=text;this.nonDisplayed_[this.row_]=baseRow};Cea608Stream.prototype.rollUp=function(pts,text){var baseRow=this.displayed_[this.row_];baseRow+=text;this.displayed_[this.row_]=baseRow};Cea608Stream.prototype.shiftRowsUp_=function(){var i;for(i=0;i<this.topRow_;i++){this.displayed_[i]=""}for(i=this.row_+1;i<BOTTOM_ROW+1;i++){this.displayed_[i]=""}for(i=this.topRow_;i<this.row_;i++){this.displayed_[i]=this.displayed_[i+1]}this.displayed_[this.row_]=""};Cea608Stream.prototype.paintOn=function(pts,text){var baseRow=this.displayed_[this.row_];baseRow+=text;this.displayed_[this.row_]=baseRow};var captionStream={CaptionStream:CaptionStream,Cea608Stream:Cea608Stream},streamTypes={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},TYPE_SHARED="shared",handleRollover=function(value,reference){var direction=1;if(value>reference){direction=-1}while(Math.abs(reference-value)>4294967296){value+=direction*8589934592}return value},TimestampRolloverStream=function TimestampRolloverStream(type){var lastDTS,referenceDTS;TimestampRolloverStream.prototype.init.call(this);this.type_=type||TYPE_SHARED;this.push=function(data){if(this.type_!==TYPE_SHARED&&data.type!==this.type_){return}if(referenceDTS===void 0){referenceDTS=data.dts}data.dts=handleRollover(data.dts,referenceDTS);data.pts=handleRollover(data.pts,referenceDTS);lastDTS=data.dts;this.trigger("data",data)};this.flush=function(){referenceDTS=lastDTS;this.trigger("done")};this.endTimeline=function(){this.flush();this.trigger("endedtimeline")};this.discontinuity=function(){referenceDTS=void 0;lastDTS=void 0};this.reset=function(){this.discontinuity();this.trigger("reset")}};TimestampRolloverStream.prototype=new stream;var percentEncode=function(bytes,start,end){var i,result="";for(i=start;i<end;i++){result+="%"+("00"+bytes[i].toString(16)).slice(-2)}return result},parseUtf8=function(bytes,start,end){return decodeURIComponent(percentEncode(bytes,start,end))},parseIso88591=function(bytes,start,end){return unescape(percentEncode(bytes,start,end))},parseSyncSafeInteger=function(data){return data[0]<<21|data[1]<<14|data[2]<<7|data[3]},tagParsers={TXXX:function(tag){var i;if(3!==tag.data[0]){return}for(i=1;i<tag.data.length;i++){if(0===tag.data[i]){tag.description=parseUtf8(tag.data,1,i);tag.value=parseUtf8(tag.data,i+1,tag.data.length).replace(/\0*$/,"");break}}tag.data=tag.value},WXXX:function(tag){var i;if(3!==tag.data[0]){return}for(i=1;i<tag.data.length;i++){if(0===tag.data[i]){tag.description=parseUtf8(tag.data,1,i);tag.url=parseUtf8(tag.data,i+1,tag.data.length);break}}},PRIV:function(tag){var i;for(i=0;i<tag.data.length;i++){if(0===tag.data[i]){tag.owner=parseIso88591(tag.data,0,i);break}}tag.privateData=tag.data.subarray(i+1);tag.data=tag.privateData}},_MetadataStream;_MetadataStream=function(options){var settings={debug:!!(options&&options.debug),descriptor:options&&options.descriptor},tagSize=0,buffer=[],bufferSize=0,i;_MetadataStream.prototype.init.call(this);this.dispatchType=streamTypes.METADATA_STREAM_TYPE.toString(16);if(settings.descriptor){for(i=0;i<settings.descriptor.length;i++){this.dispatchType+=("00"+settings.descriptor[i].toString(16)).slice(-2)}}this.push=function(chunk){var tag,frameStart,frameSize,frame,i,frameHeader;if("timed-metadata"!==chunk.type){return}if(chunk.dataAlignmentIndicator){bufferSize=0;buffer.length=0}if(0===buffer.length&&(10>chunk.data.length||chunk.data[0]!==73||chunk.data[1]!==68||chunk.data[2]!==51)){if(settings.debug){console.log("Skipping unrecognized metadata packet")}return}buffer.push(chunk);bufferSize+=chunk.data.byteLength;if(1===buffer.length){tagSize=parseSyncSafeInteger(chunk.data.subarray(6,10));tagSize+=10}if(bufferSize<tagSize){return}tag={data:new Uint8Array(tagSize),frames:[],pts:buffer[0].pts,dts:buffer[0].dts};for(i=0;i<tagSize;){tag.data.set(buffer[0].data.subarray(0,tagSize-i),i);i+=buffer[0].data.byteLength;bufferSize-=buffer[0].data.byteLength;buffer.shift()}frameStart=10;if(64&tag.data[5]){frameStart+=4;frameStart+=parseSyncSafeInteger(tag.data.subarray(10,14));tagSize-=parseSyncSafeInteger(tag.data.subarray(16,20))}do{frameSize=parseSyncSafeInteger(tag.data.subarray(frameStart+4,frameStart+8));if(1>frameSize){return console.log("Malformed ID3 frame encountered. Skipping metadata parsing.")}frameHeader=String.fromCharCode(tag.data[frameStart],tag.data[frameStart+1],tag.data[frameStart+2],tag.data[frameStart+3]);frame={id:frameHeader,data:tag.data.subarray(frameStart+10,frameStart+frameSize+10)};frame.key=frame.id;if(tagParsers[frame.id]){tagParsers[frame.id](frame);if("com.apple.streaming.transportStreamTimestamp"===frame.owner){var d=frame.data,size=(1&d[3])<<30|d[4]<<22|d[5]<<14|d[6]<<6|d[7]>>>2;size*=4;size+=3&d[7];frame.timeStamp=size;if(tag.pts===void 0&&tag.dts===void 0){tag.pts=frame.timeStamp;tag.dts=frame.timeStamp}this.trigger("timestamp",frame)}}tag.frames.push(frame);frameStart+=10;frameStart+=frameSize}while(frameStart<tagSize);this.trigger("data",tag)}};_MetadataStream.prototype=new stream;var metadataStream=_MetadataStream,TimestampRolloverStream$1={TimestampRolloverStream:TimestampRolloverStream,handleRollover:handleRollover}.TimestampRolloverStream,_TransportPacketStream,_TransportParseStream,_ElementaryStream,MP2T_PACKET_LENGTH=188,SYNC_BYTE=71;_TransportPacketStream=function(){var buffer=new Uint8Array(MP2T_PACKET_LENGTH),bytesInBuffer=0;_TransportPacketStream.prototype.init.call(this);this.push=function(bytes){var startIndex=0,endIndex=MP2T_PACKET_LENGTH,everything;if(bytesInBuffer){everything=new Uint8Array(bytes.byteLength+bytesInBuffer);everything.set(buffer.subarray(0,bytesInBuffer));everything.set(bytes,bytesInBuffer);bytesInBuffer=0}else{everything=bytes}while(endIndex<everything.byteLength){if(everything[startIndex]===SYNC_BYTE&&everything[endIndex]===SYNC_BYTE){this.trigger("data",everything.subarray(startIndex,endIndex));startIndex+=MP2T_PACKET_LENGTH;endIndex+=MP2T_PACKET_LENGTH;continue}startIndex++;endIndex++}if(startIndex<everything.byteLength){buffer.set(everything.subarray(startIndex),0);bytesInBuffer=everything.byteLength-startIndex}};this.flush=function(){if(bytesInBuffer===MP2T_PACKET_LENGTH&&buffer[0]===SYNC_BYTE){this.trigger("data",buffer);bytesInBuffer=0}this.trigger("done")};this.endTimeline=function(){this.flush();this.trigger("endedtimeline")};this.reset=function(){bytesInBuffer=0;this.trigger("reset")}};_TransportPacketStream.prototype=new stream;_TransportParseStream=function(){var parsePsi,parsePat,parsePmt,self;_TransportParseStream.prototype.init.call(this);self=this;this.packetsWaitingForPmt=[];this.programMapTable=void 0;parsePsi=function(payload,psi){var offset=0;if(psi.payloadUnitStartIndicator){offset+=payload[offset]+1}if("pat"===psi.type){parsePat(payload.subarray(offset),psi)}else{parsePmt(payload.subarray(offset),psi)}};parsePat=function(payload,pat){pat.section_number=payload[7];pat.last_section_number=payload[8];self.pmtPid=(31&payload[10])<<8|payload[11];pat.pmtPid=self.pmtPid};parsePmt=function(payload,pmt){var sectionLength,tableEnd,programInfoLength,offset;if(!(1&payload[5])){return}self.programMapTable={video:null,audio:null,"timed-metadata":{}};sectionLength=(15&payload[1])<<8|payload[2];tableEnd=3+sectionLength-4;programInfoLength=(15&payload[10])<<8|payload[11];offset=12+programInfoLength;while(offset<tableEnd){var streamType=payload[offset],pid=(31&payload[offset+1])<<8|payload[offset+2];if(streamType===streamTypes.H264_STREAM_TYPE&&null===self.programMapTable.video){self.programMapTable.video=pid}else if(streamType===streamTypes.ADTS_STREAM_TYPE&&null===self.programMapTable.audio){self.programMapTable.audio=pid}else if(streamType===streamTypes.METADATA_STREAM_TYPE){self.programMapTable["timed-metadata"][pid]=streamType}offset+=((15&payload[offset+3])<<8|payload[offset+4])+5}pmt.programMapTable=self.programMapTable};this.push=function(packet){var result={},offset=4;result.payloadUnitStartIndicator=!!(64&packet[1]);result.pid=31&packet[1];result.pid<<=8;result.pid|=packet[2];if(1<(48&packet[3])>>>4){offset+=packet[offset]+1}if(0===result.pid){result.type="pat";parsePsi(packet.subarray(offset),result);this.trigger("data",result)}else if(result.pid===this.pmtPid){result.type="pmt";parsePsi(packet.subarray(offset),result);this.trigger("data",result);while(this.packetsWaitingForPmt.length){this.processPes_.apply(this,this.packetsWaitingForPmt.shift())}}else if(this.programMapTable===void 0){this.packetsWaitingForPmt.push([packet,offset,result])}else{this.processPes_(packet,offset,result)}};this.processPes_=function(packet,offset,result){if(result.pid===this.programMapTable.video){result.streamType=streamTypes.H264_STREAM_TYPE}else if(result.pid===this.programMapTable.audio){result.streamType=streamTypes.ADTS_STREAM_TYPE}else{result.streamType=this.programMapTable["timed-metadata"][result.pid]}result.type="pes";result.data=packet.subarray(offset);this.trigger("data",result)}};_TransportParseStream.prototype=new stream;_TransportParseStream.STREAM_TYPES={h264:27,adts:15};_ElementaryStream=function(){var self=this,video={data:[],size:0},audio={data:[],size:0},timedMetadata={data:[],size:0},programMapTable,parsePes=function(payload,pes){var ptsDtsFlags;pes.packetLength=6+(payload[4]<<8|payload[5]);pes.dataAlignmentIndicator=0!=(4&payload[6]);ptsDtsFlags=payload[7];if(192&ptsDtsFlags){pes.pts=(14&payload[9])<<27|(255&payload[10])<<20|(254&payload[11])<<12|(255&payload[12])<<5|(254&payload[13])>>>3;pes.pts*=4;pes.pts+=(6&payload[13])>>>1;pes.dts=pes.pts;if(64&ptsDtsFlags){pes.dts=(14&payload[14])<<27|(255&payload[15])<<20|(254&payload[16])<<12|(255&payload[17])<<5|(254&payload[18])>>>3;pes.dts*=4;pes.dts+=(6&payload[18])>>>1}}pes.data=payload.subarray(9+payload[8])},flushStream=function(stream$$1,type,forceFlush){var packetData=new Uint8Array(stream$$1.size),event={type:type},i=0,offset=0,packetFlushable=!1,fragment;if(!stream$$1.data.length||9>stream$$1.size){return}event.trackId=stream$$1.data[0].pid;for(i=0;i<stream$$1.data.length;i++){fragment=stream$$1.data[i];packetData.set(fragment.data,offset);offset+=fragment.data.byteLength}parsePes(packetData,event);packetFlushable="video"===type||event.packetLength<=stream$$1.size;if(forceFlush||packetFlushable){stream$$1.size=0;stream$$1.data.length=0}if(packetFlushable){self.trigger("data",event)}};_ElementaryStream.prototype.init.call(this);this.push=function(data){({pat:function(){},pes:function(){var stream$$1,streamType;switch(data.streamType){case streamTypes.H264_STREAM_TYPE:stream$$1=video;streamType="video";break;case streamTypes.ADTS_STREAM_TYPE:stream$$1=audio;streamType="audio";break;case streamTypes.METADATA_STREAM_TYPE:stream$$1=timedMetadata;streamType="timed-metadata";break;default:return;}if(data.payloadUnitStartIndicator){flushStream(stream$$1,streamType,!0)}stream$$1.data.push(data);stream$$1.size+=data.data.byteLength},pmt:function(){var event={type:"metadata",tracks:[]};programMapTable=data.programMapTable;if(null!==programMapTable.video){event.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+programMapTable.video,codec:"avc",type:"video"})}if(null!==programMapTable.audio){event.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+programMapTable.audio,codec:"adts",type:"audio"})}self.trigger("data",event)}})[data.type]()};this.reset=function(){video.size=0;video.data.length=0;audio.size=0;audio.data.length=0;this.trigger("reset")};this.flushStreams_=function(){flushStream(video,"video");flushStream(audio,"audio");flushStream(timedMetadata,"timed-metadata")};this.flush=function(){this.flushStreams_();this.trigger("done")}};_ElementaryStream.prototype=new stream;var m2ts={PAT_PID:0,MP2T_PACKET_LENGTH:MP2T_PACKET_LENGTH,TransportPacketStream:_TransportPacketStream,TransportParseStream:_TransportParseStream,ElementaryStream:_ElementaryStream,TimestampRolloverStream:TimestampRolloverStream$1,CaptionStream:captionStream.CaptionStream,Cea608Stream:captionStream.Cea608Stream,MetadataStream:metadataStream};for(var type in streamTypes){if(streamTypes.hasOwnProperty(type)){m2ts[type]=streamTypes[type]}}var m2ts_1=m2ts,ONE_SECOND_IN_TS$2=clock.ONE_SECOND_IN_TS,_AdtsStream,ADTS_SAMPLING_FREQUENCIES=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];_AdtsStream=function(handlePartialSegments){var buffer,frameNum=0;_AdtsStream.prototype.init.call(this);this.push=function(packet){var i=0,frameLength,protectionSkipBytes,frameEnd,oldBuffer,sampleCount,adtsFrameDuration;if(!handlePartialSegments){frameNum=0}if("audio"!==packet.type){return}if(buffer){oldBuffer=buffer;buffer=new Uint8Array(oldBuffer.byteLength+packet.data.byteLength);buffer.set(oldBuffer);buffer.set(packet.data,oldBuffer.byteLength)}else{buffer=packet.data}while(i+5<buffer.length){if(255!==buffer[i]||240!=(246&buffer[i+1])){i++;continue}protectionSkipBytes=2*(1&~buffer[i+1]);frameLength=(3&buffer[i+3])<<11|buffer[i+4]<<3|(224&buffer[i+5])>>5;sampleCount=1024*((3&buffer[i+6])+1);adtsFrameDuration=sampleCount*ONE_SECOND_IN_TS$2/ADTS_SAMPLING_FREQUENCIES[(60&buffer[i+2])>>>2];frameEnd=i+frameLength;if(buffer.byteLength<frameEnd){return}this.trigger("data",{pts:packet.pts+frameNum*adtsFrameDuration,dts:packet.dts+frameNum*adtsFrameDuration,sampleCount:sampleCount,audioobjecttype:(3&buffer[i+2]>>>6)+1,channelcount:(1&buffer[i+2])<<2|(192&buffer[i+3])>>>6,samplerate:ADTS_SAMPLING_FREQUENCIES[(60&buffer[i+2])>>>2],samplingfrequencyindex:(60&buffer[i+2])>>>2,samplesize:16,data:buffer.subarray(i+7+protectionSkipBytes,frameEnd)});frameNum++;if(buffer.byteLength===frameEnd){buffer=void 0;return}buffer=buffer.subarray(frameEnd)}};this.flush=function(){frameNum=0;this.trigger("done")};this.reset=function(){buffer=void 0;this.trigger("reset")};this.endTimeline=function(){buffer=void 0;this.trigger("endedtimeline")}};_AdtsStream.prototype=new stream;var adts=_AdtsStream,ExpGolomb;ExpGolomb=function(workingData){var workingBytesAvailable=workingData.byteLength,workingWord=0,workingBitsAvailable=0;this.length=function(){return 8*workingBytesAvailable};this.bitsAvailable=function(){return 8*workingBytesAvailable+workingBitsAvailable};this.loadWord=function(){var position=workingData.byteLength-workingBytesAvailable,workingBytes=new Uint8Array(4),availableBytes=Math.min(4,workingBytesAvailable);if(0===availableBytes){throw new Error("no bytes available")}workingBytes.set(workingData.subarray(position,position+availableBytes));workingWord=new DataView(workingBytes.buffer).getUint32(0);workingBitsAvailable=8*availableBytes;workingBytesAvailable-=availableBytes};this.skipBits=function(count){var skipBytes;if(workingBitsAvailable>count){workingWord<<=count;workingBitsAvailable-=count}else{count-=workingBitsAvailable;skipBytes=Math.floor(count/8);count-=8*skipBytes;workingBytesAvailable-=skipBytes;this.loadWord();workingWord<<=count;workingBitsAvailable-=count}};this.readBits=function(size){var bits=Math.min(workingBitsAvailable,size),valu=workingWord>>>32-bits;workingBitsAvailable-=bits;if(0<workingBitsAvailable){workingWord<<=bits}else if(0<workingBytesAvailable){this.loadWord()}bits=size-bits;if(0<bits){return valu<<bits|this.readBits(bits)}return valu};this.skipLeadingZeros=function(){var leadingZeroCount;for(leadingZeroCount=0;leadingZeroCount<workingBitsAvailable;++leadingZeroCount){if(0!=(workingWord&2147483648>>>leadingZeroCount)){workingWord<<=leadingZeroCount;workingBitsAvailable-=leadingZeroCount;return leadingZeroCount}}this.loadWord();return leadingZeroCount+this.skipLeadingZeros()};this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())};this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())};this.readUnsignedExpGolomb=function(){var clz=this.skipLeadingZeros();return this.readBits(clz+1)-1};this.readExpGolomb=function(){var valu=this.readUnsignedExpGolomb();if(1&valu){return 1+valu>>>1}return-1*(valu>>>1)};this.readBoolean=function(){return 1===this.readBits(1)};this.readUnsignedByte=function(){return this.readBits(8)};this.loadWord()};var expGolomb=ExpGolomb,_H264Stream,_NalByteStream,PROFILES_WITH_OPTIONAL_SPS_DATA;_NalByteStream=function(){var syncPoint=0,i,buffer;_NalByteStream.prototype.init.call(this);this.push=function(data){var swapBuffer;if(!buffer){buffer=data.data}else{swapBuffer=new Uint8Array(buffer.byteLength+data.data.byteLength);swapBuffer.set(buffer);swapBuffer.set(data.data,buffer.byteLength);buffer=swapBuffer}var len=buffer.byteLength;for(;syncPoint<len-3;syncPoint++){if(1===buffer[syncPoint+2]){i=syncPoint+5;break}}while(i<len){switch(buffer[i]){case 0:if(0!==buffer[i-1]){i+=2;break}else if(0!==buffer[i-2]){i++;break}if(syncPoint+3!==i-2){this.trigger("data",buffer.subarray(syncPoint+3,i-2))}do{i++}while(1!==buffer[i]&&i<len);syncPoint=i-2;i+=3;break;case 1:if(0!==buffer[i-1]||0!==buffer[i-2]){i+=3;break}this.trigger("data",buffer.subarray(syncPoint+3,i-2));syncPoint=i-2;i+=3;break;default:i+=3;break;}}buffer=buffer.subarray(syncPoint);i-=syncPoint;syncPoint=0};this.reset=function(){buffer=null;syncPoint=0;this.trigger("reset")};this.flush=function(){if(buffer&&3<buffer.byteLength){this.trigger("data",buffer.subarray(syncPoint+3))}buffer=null;syncPoint=0;this.trigger("done")};this.endTimeline=function(){this.flush();this.trigger("endedtimeline")}};_NalByteStream.prototype=new stream;PROFILES_WITH_OPTIONAL_SPS_DATA={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0};_H264Stream=function(){var nalByteStream=new _NalByteStream,self,trackId,currentPts,currentDts,discardEmulationPreventionBytes,readSequenceParameterSet,skipScalingList;_H264Stream.prototype.init.call(this);self=this;this.push=function(packet){if("video"!==packet.type){return}trackId=packet.trackId;currentPts=packet.pts;currentDts=packet.dts;nalByteStream.push(packet)};nalByteStream.on("data",function(data){var event={trackId:trackId,pts:currentPts,dts:currentDts,data:data};switch(31&data[0]){case 5:event.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:event.nalUnitType="sei_rbsp";event.escapedRBSP=discardEmulationPreventionBytes(data.subarray(1));break;case 7:event.nalUnitType="seq_parameter_set_rbsp";event.escapedRBSP=discardEmulationPreventionBytes(data.subarray(1));event.config=readSequenceParameterSet(event.escapedRBSP);break;case 8:event.nalUnitType="pic_parameter_set_rbsp";break;case 9:event.nalUnitType="access_unit_delimiter_rbsp";break;}self.trigger("data",event)});nalByteStream.on("done",function(){self.trigger("done")});nalByteStream.on("partialdone",function(){self.trigger("partialdone")});nalByteStream.on("reset",function(){self.trigger("reset")});nalByteStream.on("endedtimeline",function(){self.trigger("endedtimeline")});this.flush=function(){nalByteStream.flush()};this.partialFlush=function(){nalByteStream.partialFlush()};this.reset=function(){nalByteStream.reset()};this.endTimeline=function(){nalByteStream.endTimeline()};skipScalingList=function(count,expGolombDecoder){var lastScale=8,nextScale=8,j,deltaScale;for(j=0;j<count;j++){if(0!==nextScale){deltaScale=expGolombDecoder.readExpGolomb();nextScale=(lastScale+deltaScale+256)%256}lastScale=0===nextScale?lastScale:nextScale}};discardEmulationPreventionBytes=function(data){var length=data.byteLength,emulationPreventionBytesPositions=[],i=1,newLength,newData;while(i<length-2){if(0===data[i]&&0===data[i+1]&&3===data[i+2]){emulationPreventionBytesPositions.push(i+2);i+=2}else{i++}}if(0===emulationPreventionBytesPositions.length){return data}newLength=length-emulationPreventionBytesPositions.length;newData=new Uint8Array(newLength);var sourceIndex=0;for(i=0;i<newLength;sourceIndex++,i++){if(sourceIndex===emulationPreventionBytesPositions[0]){sourceIndex++;emulationPreventionBytesPositions.shift()}newData[i]=data[sourceIndex]}return newData};readSequenceParameterSet=function(data){var frameCropLeftOffset=0,frameCropRightOffset=0,frameCropTopOffset=0,frameCropBottomOffset=0,sarScale=1,expGolombDecoder,profileIdc,levelIdc,profileCompatibility,chromaFormatIdc,picOrderCntType,numRefFramesInPicOrderCntCycle,picWidthInMbsMinus1,picHeightInMapUnitsMinus1,frameMbsOnlyFlag,scalingListCount,sarRatio,aspectRatioIdc,i;expGolombDecoder=new expGolomb(data);profileIdc=expGolombDecoder.readUnsignedByte();profileCompatibility=expGolombDecoder.readUnsignedByte();levelIdc=expGolombDecoder.readUnsignedByte();expGolombDecoder.skipUnsignedExpGolomb();if(PROFILES_WITH_OPTIONAL_SPS_DATA[profileIdc]){chromaFormatIdc=expGolombDecoder.readUnsignedExpGolomb();if(3===chromaFormatIdc){expGolombDecoder.skipBits(1)}expGolombDecoder.skipUnsignedExpGolomb();expGolombDecoder.skipUnsignedExpGolomb();expGolombDecoder.skipBits(1);if(expGolombDecoder.readBoolean()){scalingListCount=3!==chromaFormatIdc?8:12;for(i=0;i<scalingListCount;i++){if(expGolombDecoder.readBoolean()){if(6>i){skipScalingList(16,expGolombDecoder)}else{skipScalingList(64,expGolombDecoder)}}}}}expGolombDecoder.skipUnsignedExpGolomb();picOrderCntType=expGolombDecoder.readUnsignedExpGolomb();if(0===picOrderCntType){expGolombDecoder.readUnsignedExpGolomb()}else if(1===picOrderCntType){expGolombDecoder.skipBits(1);expGolombDecoder.skipExpGolomb();expGolombDecoder.skipExpGolomb();numRefFramesInPicOrderCntCycle=expGolombDecoder.readUnsignedExpGolomb();for(i=0;i<numRefFramesInPicOrderCntCycle;i++){expGolombDecoder.skipExpGolomb()}}expGolombDecoder.skipUnsignedExpGolomb();expGolombDecoder.skipBits(1);picWidthInMbsMinus1=expGolombDecoder.readUnsignedExpGolomb();picHeightInMapUnitsMinus1=expGolombDecoder.readUnsignedExpGolomb();frameMbsOnlyFlag=expGolombDecoder.readBits(1);if(0===frameMbsOnlyFlag){expGolombDecoder.skipBits(1)}expGolombDecoder.skipBits(1);if(expGolombDecoder.readBoolean()){frameCropLeftOffset=expGolombDecoder.readUnsignedExpGolomb();frameCropRightOffset=expGolombDecoder.readUnsignedExpGolomb();frameCropTopOffset=expGolombDecoder.readUnsignedExpGolomb();frameCropBottomOffset=expGolombDecoder.readUnsignedExpGolomb()}if(expGolombDecoder.readBoolean()){if(expGolombDecoder.readBoolean()){aspectRatioIdc=expGolombDecoder.readUnsignedByte();switch(aspectRatioIdc){case 1:sarRatio=[1,1];break;case 2:sarRatio=[12,11];break;case 3:sarRatio=[10,11];break;case 4:sarRatio=[16,11];break;case 5:sarRatio=[40,33];break;case 6:sarRatio=[24,11];break;case 7:sarRatio=[20,11];break;case 8:sarRatio=[32,11];break;case 9:sarRatio=[80,33];break;case 10:sarRatio=[18,11];break;case 11:sarRatio=[15,11];break;case 12:sarRatio=[64,33];break;case 13:sarRatio=[160,99];break;case 14:sarRatio=[4,3];break;case 15:sarRatio=[3,2];break;case 16:sarRatio=[2,1];break;case 255:{sarRatio=[expGolombDecoder.readUnsignedByte()<<8|expGolombDecoder.readUnsignedByte(),expGolombDecoder.readUnsignedByte()<<8|expGolombDecoder.readUnsignedByte()];break}}if(sarRatio){sarScale=sarRatio[0]/sarRatio[1]}}}return{profileIdc:profileIdc,levelIdc:levelIdc,profileCompatibility:profileCompatibility,width:Math.ceil((16*(picWidthInMbsMinus1+1)-2*frameCropLeftOffset-2*frameCropRightOffset)*sarScale),height:16*((2-frameMbsOnlyFlag)*(picHeightInMapUnitsMinus1+1))-2*frameCropTopOffset-2*frameCropBottomOffset,sarRatio:sarRatio}}};_H264Stream.prototype=new stream;var h264={H264Stream:_H264Stream,NalByteStream:_NalByteStream},ADTS_SAMPLING_FREQUENCIES$1=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],parseSyncSafeInteger$1=function(data){return data[0]<<21|data[1]<<14|data[2]<<7|data[3]},percentEncode$1=function(bytes,start,end){var i,result="";for(i=start;i<end;i++){result+="%"+("00"+bytes[i].toString(16)).slice(-2)}return result},parseIso88591$1=function(bytes,start,end){return unescape(percentEncode$1(bytes,start,end))},utils={isLikelyAacData:function(data){if(data[0]===73&&data[1]===68&&data[2]===51){return!0}return!1},parseId3TagSize:function(header,byteIndex){var returnSize=header[byteIndex+6]<<21|header[byteIndex+7]<<14|header[byteIndex+8]<<7|header[byteIndex+9],flags=header[byteIndex+5];if((16&flags)>>4){return returnSize+20}return returnSize+10},parseAdtsSize:function(header,byteIndex){var lowThree=(224&header[byteIndex+5])>>5,middle=header[byteIndex+4]<<3,highTwo=header[byteIndex+3]&6144;return highTwo|middle|lowThree},parseType:function(header,byteIndex){if(header[byteIndex]===73&&header[byteIndex+1]===68&&header[byteIndex+2]===51){return"timed-metadata"}else if(header[byteIndex]&!0&&240==(240&header[byteIndex+1])){return"audio"}return null},parseSampleRate:function(packet){var i=0;while(i+5<packet.length){if(255!==packet[i]||240!=(246&packet[i+1])){i++;continue}return ADTS_SAMPLING_FREQUENCIES$1[(60&packet[i+2])>>>2]}return null},parseAacTimestamp:function(packet){var frameStart,frameSize,frame,frameHeader;frameStart=10;if(64&packet[5]){frameStart+=4;frameStart+=parseSyncSafeInteger$1(packet.subarray(10,14))}do{frameSize=parseSyncSafeInteger$1(packet.subarray(frameStart+4,frameStart+8));if(1>frameSize){return null}frameHeader=String.fromCharCode(packet[frameStart],packet[frameStart+1],packet[frameStart+2],packet[frameStart+3]);if("PRIV"===frameHeader){frame=packet.subarray(frameStart+10,frameStart+frameSize+10);for(var i=0;i<frame.byteLength;i++){if(0===frame[i]){var owner=parseIso88591$1(frame,0,i);if("com.apple.streaming.transportStreamTimestamp"===owner){var d=frame.subarray(i+1),size=(1&d[3])<<30|d[4]<<22|d[5]<<14|d[6]<<6|d[7]>>>2;size*=4;size+=3&d[7];return size}break}}}frameStart+=10;frameStart+=frameSize}while(frameStart<packet.byteLength);return null}},_AacStream;_AacStream=function(){var everything=new Uint8Array,timeStamp=0;_AacStream.prototype.init.call(this);this.setTimestamp=function(timestamp){timeStamp=timestamp};this.push=function(bytes){var frameSize=0,byteIndex=0,bytesLeft,chunk,packet,tempLength;if(everything.length){tempLength=everything.length;everything=new Uint8Array(bytes.byteLength+tempLength);everything.set(everything.subarray(0,tempLength));everything.set(bytes,tempLength)}else{everything=bytes}while(3<=everything.length-byteIndex){if(everything[byteIndex]===73&&everything[byteIndex+1]===68&&everything[byteIndex+2]===51){if(10>everything.length-byteIndex){break}frameSize=utils.parseId3TagSize(everything,byteIndex);if(byteIndex+frameSize>everything.length){break}chunk={type:"timed-metadata",data:everything.subarray(byteIndex,byteIndex+frameSize)};this.trigger("data",chunk);byteIndex+=frameSize;continue}else if(255==(255&everything[byteIndex])&&240==(240&everything[byteIndex+1])){if(7>everything.length-byteIndex){break}frameSize=utils.parseAdtsSize(everything,byteIndex);if(byteIndex+frameSize>everything.length){break}packet={type:"audio",data:everything.subarray(byteIndex,byteIndex+frameSize),pts:timeStamp,dts:timeStamp};this.trigger("data",packet);byteIndex+=frameSize;continue}byteIndex++}bytesLeft=everything.length-byteIndex;if(0<bytesLeft){everything=everything.subarray(byteIndex)}else{everything=new Uint8Array}};this.reset=function(){everything=new Uint8Array;this.trigger("reset")};this.endTimeline=function(){everything=new Uint8Array;this.trigger("endedtimeline")}};_AacStream.prototype=new stream;var aac=_AacStream,audioProperties=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],videoProperties=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],H264Stream=h264.H264Stream,isLikelyAacData$1=utils.isLikelyAacData,ONE_SECOND_IN_TS$3=clock.ONE_SECOND_IN_TS,_VideoSegmentStream,_AudioSegmentStream,_Transmuxer,_CoalesceStream,arrayEquals=function(a,b){var i;if(a.length!==b.length){return!1}for(i=0;i<a.length;i++){if(a[i]!==b[i]){return!1}}return!0},generateVideoSegmentTimingInfo=function(baseMediaDecodeTime,startDts,startPts,endDts,endPts,prependedContentDuration){return{start:{dts:baseMediaDecodeTime,pts:baseMediaDecodeTime+(startPts-startDts)},end:{dts:baseMediaDecodeTime+(endDts-startDts),pts:baseMediaDecodeTime+(endPts-startPts)},prependedContentDuration:prependedContentDuration,baseMediaDecodeTime:baseMediaDecodeTime}};_AudioSegmentStream=function(track,options){var adtsFrames=[],sequenceNumber=0,earliestAllowedDts=0,audioAppendStartTs=0,videoBaseMediaDecodeTime=1/0;options=options||{};_AudioSegmentStream.prototype.init.call(this);this.push=function(data){trackDecodeInfo.collectDtsInfo(track,data);if(track){audioProperties.forEach(function(prop){track[prop]=data[prop]})}adtsFrames.push(data)};this.setEarliestDts=function(earliestDts){earliestAllowedDts=earliestDts};this.setVideoBaseMediaDecodeTime=function(baseMediaDecodeTime){videoBaseMediaDecodeTime=baseMediaDecodeTime};this.setAudioAppendStart=function(timestamp){audioAppendStartTs=timestamp};this.flush=function(){var frames,moof,mdat,boxes,frameDuration;if(0===adtsFrames.length){this.trigger("done","AudioSegmentStream");return}frames=audioFrameUtils.trimAdtsFramesByEarliestDts(adtsFrames,track,earliestAllowedDts);track.baseMediaDecodeTime=trackDecodeInfo.calculateTrackBaseMediaDecodeTime(track,options.keepOriginalTimestamps);audioFrameUtils.prefixWithSilence(track,frames,audioAppendStartTs,videoBaseMediaDecodeTime);track.samples=audioFrameUtils.generateSampleTable(frames);mdat=mp4Generator.mdat(audioFrameUtils.concatenateFrameData(frames));adtsFrames=[];moof=mp4Generator.moof(sequenceNumber,[track]);boxes=new Uint8Array(moof.byteLength+mdat.byteLength);sequenceNumber++;boxes.set(moof);boxes.set(mdat,moof.byteLength);trackDecodeInfo.clearDtsInfo(track);frameDuration=Math.ceil(1024*ONE_SECOND_IN_TS$3/track.samplerate);if(frames.length){this.trigger("timingInfo",{start:frames[0].pts,end:frames[0].pts+frames.length*frameDuration})}this.trigger("data",{track:track,boxes:boxes});this.trigger("done","AudioSegmentStream")};this.reset=function(){trackDecodeInfo.clearDtsInfo(track);adtsFrames=[];this.trigger("reset")}};_AudioSegmentStream.prototype=new stream;_VideoSegmentStream=function(track,options){var sequenceNumber=0,nalUnits=[],gopsToAlignWith=[],config,pps;options=options||{};_VideoSegmentStream.prototype.init.call(this);delete track.minPTS;this.gopCache_=[];this.push=function(nalUnit){trackDecodeInfo.collectDtsInfo(track,nalUnit);if("seq_parameter_set_rbsp"===nalUnit.nalUnitType&&!config){config=nalUnit.config;track.sps=[nalUnit.data];videoProperties.forEach(function(prop){track[prop]=config[prop]},this)}if("pic_parameter_set_rbsp"===nalUnit.nalUnitType&&!pps){pps=nalUnit.data;track.pps=[nalUnit.data]}nalUnits.push(nalUnit)};this.flush=function(){var frames,gopForFusion,gops,moof,mdat,boxes,prependedContentDuration=0,firstGop,lastGop;while(nalUnits.length){if("access_unit_delimiter_rbsp"===nalUnits[0].nalUnitType){break}nalUnits.shift()}if(0===nalUnits.length){this.resetStream_();this.trigger("done","VideoSegmentStream");return}frames=frameUtils.groupNalsIntoFrames(nalUnits);gops=frameUtils.groupFramesIntoGops(frames);if(!gops[0][0].keyFrame){gopForFusion=this.getGopForFusion_(nalUnits[0],track);if(gopForFusion){prependedContentDuration=gopForFusion.duration;gops.unshift(gopForFusion);gops.byteLength+=gopForFusion.byteLength;gops.nalCount+=gopForFusion.nalCount;gops.pts=gopForFusion.pts;gops.dts=gopForFusion.dts;gops.duration+=gopForFusion.duration}else{gops=frameUtils.extendFirstKeyFrame(gops)}}if(gopsToAlignWith.length){var alignedGops;if(options.alignGopsAtEnd){alignedGops=this.alignGopsAtEnd_(gops)}else{alignedGops=this.alignGopsAtStart_(gops)}if(!alignedGops){this.gopCache_.unshift({gop:gops.pop(),pps:track.pps,sps:track.sps});this.gopCache_.length=Math.min(6,this.gopCache_.length);nalUnits=[];this.resetStream_();this.trigger("done","VideoSegmentStream");return}trackDecodeInfo.clearDtsInfo(track);gops=alignedGops}trackDecodeInfo.collectDtsInfo(track,gops);track.samples=frameUtils.generateSampleTable(gops);mdat=mp4Generator.mdat(frameUtils.concatenateNalData(gops));track.baseMediaDecodeTime=trackDecodeInfo.calculateTrackBaseMediaDecodeTime(track,options.keepOriginalTimestamps);this.trigger("processedGopsInfo",gops.map(function(gop){return{pts:gop.pts,dts:gop.dts,byteLength:gop.byteLength}}));firstGop=gops[0];lastGop=gops[gops.length-1];this.trigger("segmentTimingInfo",generateVideoSegmentTimingInfo(track.baseMediaDecodeTime,firstGop.dts,firstGop.pts,lastGop.dts+lastGop.duration,lastGop.pts+lastGop.duration,prependedContentDuration));this.trigger("timingInfo",{start:gops[0].pts,end:gops[gops.length-1].pts+gops[gops.length-1].duration});this.gopCache_.unshift({gop:gops.pop(),pps:track.pps,sps:track.sps});this.gopCache_.length=Math.min(6,this.gopCache_.length);nalUnits=[];this.trigger("baseMediaDecodeTime",track.baseMediaDecodeTime);this.trigger("timelineStartInfo",track.timelineStartInfo);moof=mp4Generator.moof(sequenceNumber,[track]);boxes=new Uint8Array(moof.byteLength+mdat.byteLength);sequenceNumber++;boxes.set(moof);boxes.set(mdat,moof.byteLength);this.trigger("data",{track:track,boxes:boxes});this.resetStream_();this.trigger("done","VideoSegmentStream")};this.reset=function(){this.resetStream_();nalUnits=[];this.gopCache_.length=0;gopsToAlignWith.length=0;this.trigger("reset")};this.resetStream_=function(){trackDecodeInfo.clearDtsInfo(track);config=void 0;pps=void 0};this.getGopForFusion_=function(nalUnit){var nearestDistance=1/0,dtsDistance,nearestGopObj,currentGop,currentGopObj,i;for(i=0;i<this.gopCache_.length;i++){currentGopObj=this.gopCache_[i];currentGop=currentGopObj.gop;if(!(track.pps&&arrayEquals(track.pps[0],currentGopObj.pps[0]))||!(track.sps&&arrayEquals(track.sps[0],currentGopObj.sps[0]))){continue}if(currentGop.dts<track.timelineStartInfo.dts){continue}dtsDistance=nalUnit.dts-currentGop.dts-currentGop.duration;if(dtsDistance>=-10000&&dtsDistance<=45000){if(!nearestGopObj||nearestDistance>dtsDistance){nearestGopObj=currentGopObj;nearestDistance=dtsDistance}}}if(nearestGopObj){return nearestGopObj.gop}return null};this.alignGopsAtStart_=function(gops){var alignIndex,gopIndex,align,gop,byteLength,nalCount,duration,alignedGops;byteLength=gops.byteLength;nalCount=gops.nalCount;duration=gops.duration;alignIndex=gopIndex=0;while(alignIndex<gopsToAlignWith.length&&gopIndex<gops.length){align=gopsToAlignWith[alignIndex];gop=gops[gopIndex];if(align.pts===gop.pts){break}if(gop.pts>align.pts){alignIndex++;continue}gopIndex++;byteLength-=gop.byteLength;nalCount-=gop.nalCount;duration-=gop.duration}if(0===gopIndex){return gops}if(gopIndex===gops.length){return null}alignedGops=gops.slice(gopIndex);alignedGops.byteLength=byteLength;alignedGops.duration=duration;alignedGops.nalCount=nalCount;alignedGops.pts=alignedGops[0].pts;alignedGops.dts=alignedGops[0].dts;return alignedGops};this.alignGopsAtEnd_=function(gops){var alignIndex,gopIndex,align,gop,alignEndIndex,matchFound;alignIndex=gopsToAlignWith.length-1;gopIndex=gops.length-1;alignEndIndex=null;matchFound=!1;while(0<=alignIndex&&0<=gopIndex){align=gopsToAlignWith[alignIndex];gop=gops[gopIndex];if(align.pts===gop.pts){matchFound=!0;break}if(align.pts>gop.pts){alignIndex--;continue}if(alignIndex===gopsToAlignWith.length-1){alignEndIndex=gopIndex}gopIndex--}if(!matchFound&&null===alignEndIndex){return null}var trimIndex;if(matchFound){trimIndex=gopIndex}else{trimIndex=alignEndIndex}if(0===trimIndex){return gops}var alignedGops=gops.slice(trimIndex),metadata=alignedGops.reduce(function(total,gop){total.byteLength+=gop.byteLength;total.duration+=gop.duration;total.nalCount+=gop.nalCount;return total},{byteLength:0,duration:0,nalCount:0});alignedGops.byteLength=metadata.byteLength;alignedGops.duration=metadata.duration;alignedGops.nalCount=metadata.nalCount;alignedGops.pts=alignedGops[0].pts;alignedGops.dts=alignedGops[0].dts;return alignedGops};this.alignGopsWith=function(newGopsToAlignWith){gopsToAlignWith=newGopsToAlignWith}};_VideoSegmentStream.prototype=new stream;_CoalesceStream=function(options,metadataStream){this.numberOfTracks=0;this.metadataStream=metadataStream;options=options||{};if("undefined"!=typeof options.remux){this.remuxTracks=!!options.remux}else{this.remuxTracks=!0}if("boolean"==typeof options.keepOriginalTimestamps){this.keepOriginalTimestamps=options.keepOriginalTimestamps}else{this.keepOriginalTimestamps=!1}this.pendingTracks=[];this.videoTrack=null;this.pendingBoxes=[];this.pendingCaptions=[];this.pendingMetadata=[];this.pendingBytes=0;this.emittedTracks=0;_CoalesceStream.prototype.init.call(this);this.push=function(output){if(output.text){return this.pendingCaptions.push(output)}if(output.frames){return this.pendingMetadata.push(output)}this.pendingTracks.push(output.track);this.pendingBytes+=output.boxes.byteLength;if("video"===output.track.type){this.videoTrack=output.track;this.pendingBoxes.push(output.boxes)}if("audio"===output.track.type){this.audioTrack=output.track;this.pendingBoxes.unshift(output.boxes)}}};_CoalesceStream.prototype=new stream;_CoalesceStream.prototype.flush=function(flushSource){var offset=0,event={captions:[],captionStreams:{},metadata:[],info:{}},caption,id3,initSegment,timelineStartPts=0,i;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==flushSource&&"AudioSegmentStream"!==flushSource){return}else if(this.remuxTracks){return}else if(0===this.pendingTracks.length){this.emittedTracks++;if(this.emittedTracks>=this.numberOfTracks){this.trigger("done");this.emittedTracks=0}return}}if(this.videoTrack){timelineStartPts=this.videoTrack.timelineStartInfo.pts;videoProperties.forEach(function(prop){event.info[prop]=this.videoTrack[prop]},this)}else if(this.audioTrack){timelineStartPts=this.audioTrack.timelineStartInfo.pts;audioProperties.forEach(function(prop){event.info[prop]=this.audioTrack[prop]},this)}if(this.videoTrack||this.audioTrack){if(1===this.pendingTracks.length){event.type=this.pendingTracks[0].type}else{event.type="combined"}this.emittedTracks+=this.pendingTracks.length;initSegment=mp4Generator.initSegment(this.pendingTracks);event.initSegment=new Uint8Array(initSegment.byteLength);event.initSegment.set(initSegment);event.data=new Uint8Array(this.pendingBytes);for(i=0;i<this.pendingBoxes.length;i++){event.data.set(this.pendingBoxes[i],offset);offset+=this.pendingBoxes[i].byteLength}for(i=0;i<this.pendingCaptions.length;i++){caption=this.pendingCaptions[i];caption.startTime=clock.metadataTsToSeconds(caption.startPts,timelineStartPts,this.keepOriginalTimestamps);caption.endTime=clock.metadataTsToSeconds(caption.endPts,timelineStartPts,this.keepOriginalTimestamps);event.captionStreams[caption.stream]=!0;event.captions.push(caption)}for(i=0;i<this.pendingMetadata.length;i++){id3=this.pendingMetadata[i];id3.cueTime=clock.metadataTsToSeconds(id3.pts,timelineStartPts,this.keepOriginalTimestamps);event.metadata.push(id3)}event.metadata.dispatchType=this.metadataStream.dispatchType;this.pendingTracks.length=0;this.videoTrack=null;this.pendingBoxes.length=0;this.pendingCaptions.length=0;this.pendingBytes=0;this.pendingMetadata.length=0;this.trigger("data",event);for(i=0;i<event.captions.length;i++){caption=event.captions[i];this.trigger("caption",caption)}for(i=0;i<event.metadata.length;i++){id3=event.metadata[i];this.trigger("id3Frame",id3)}}if(this.emittedTracks>=this.numberOfTracks){this.trigger("done");this.emittedTracks=0}};_CoalesceStream.prototype.setRemux=function(val){this.remuxTracks=val};_Transmuxer=function(options){var self=this,hasFlushed=!0,videoTrack,audioTrack;_Transmuxer.prototype.init.call(this);options=options||{};this.baseMediaDecodeTime=options.baseMediaDecodeTime||0;this.transmuxPipeline_={};this.setupAacPipeline=function(){var pipeline={};this.transmuxPipeline_=pipeline;pipeline.type="aac";pipeline.metadataStream=new m2ts_1.MetadataStream;pipeline.aacStream=new aac;pipeline.audioTimestampRolloverStream=new m2ts_1.TimestampRolloverStream("audio");pipeline.timedMetadataTimestampRolloverStream=new m2ts_1.TimestampRolloverStream("timed-metadata");pipeline.adtsStream=new adts;pipeline.coalesceStream=new _CoalesceStream(options,pipeline.metadataStream);pipeline.headOfPipeline=pipeline.aacStream;pipeline.aacStream.pipe(pipeline.audioTimestampRolloverStream).pipe(pipeline.adtsStream);pipeline.aacStream.pipe(pipeline.timedMetadataTimestampRolloverStream).pipe(pipeline.metadataStream).pipe(pipeline.coalesceStream);pipeline.metadataStream.on("timestamp",function(frame){pipeline.aacStream.setTimestamp(frame.timeStamp)});pipeline.aacStream.on("data",function(data){if("timed-metadata"===data.type&&!pipeline.audioSegmentStream){audioTrack=audioTrack||{timelineStartInfo:{baseMediaDecodeTime:self.baseMediaDecodeTime},codec:"adts",type:"audio"};pipeline.coalesceStream.numberOfTracks++;pipeline.audioSegmentStream=new _AudioSegmentStream(audioTrack,options);pipeline.audioSegmentStream.on("timingInfo",self.trigger.bind(self,"audioTimingInfo"));pipeline.adtsStream.pipe(pipeline.audioSegmentStream).pipe(pipeline.coalesceStream)}self.trigger("trackinfo",{hasAudio:!!audioTrack,hasVideo:!!videoTrack})});pipeline.coalesceStream.on("data",this.trigger.bind(this,"data"));pipeline.coalesceStream.on("done",this.trigger.bind(this,"done"))};this.setupTsPipeline=function(){var pipeline={};this.transmuxPipeline_=pipeline;pipeline.type="ts";pipeline.metadataStream=new m2ts_1.MetadataStream;pipeline.packetStream=new m2ts_1.TransportPacketStream;pipeline.parseStream=new m2ts_1.TransportParseStream;pipeline.elementaryStream=new m2ts_1.ElementaryStream;pipeline.timestampRolloverStream=new m2ts_1.TimestampRolloverStream;pipeline.adtsStream=new adts;pipeline.h264Stream=new H264Stream;pipeline.captionStream=new m2ts_1.CaptionStream;pipeline.coalesceStream=new _CoalesceStream(options,pipeline.metadataStream);pipeline.headOfPipeline=pipeline.packetStream;pipeline.packetStream.pipe(pipeline.parseStream).pipe(pipeline.elementaryStream).pipe(pipeline.timestampRolloverStream);pipeline.timestampRolloverStream.pipe(pipeline.h264Stream);pipeline.timestampRolloverStream.pipe(pipeline.adtsStream);pipeline.timestampRolloverStream.pipe(pipeline.metadataStream).pipe(pipeline.coalesceStream);pipeline.h264Stream.pipe(pipeline.captionStream).pipe(pipeline.coalesceStream);pipeline.elementaryStream.on("data",function(data){var i,baseMediaDecodeTime=!options.keepOriginalTimestamps?self.baseMediaDecodeTime:0;if("metadata"===data.type){i=data.tracks.length;while(i--){if(!videoTrack&&"video"===data.tracks[i].type){videoTrack=data.tracks[i];videoTrack.timelineStartInfo.baseMediaDecodeTime=baseMediaDecodeTime}else if(!audioTrack&&"audio"===data.tracks[i].type){audioTrack=data.tracks[i];audioTrack.timelineStartInfo.baseMediaDecodeTime=baseMediaDecodeTime}}if(videoTrack&&!pipeline.videoSegmentStream){pipeline.coalesceStream.numberOfTracks++;pipeline.videoSegmentStream=new _VideoSegmentStream(videoTrack,options);pipeline.videoSegmentStream.on("timelineStartInfo",function(timelineStartInfo){if(audioTrack&&!options.keepOriginalTimestamps){audioTrack.timelineStartInfo=timelineStartInfo;pipeline.audioSegmentStream.setEarliestDts(timelineStartInfo.dts-self.baseMediaDecodeTime)}});pipeline.videoSegmentStream.on("processedGopsInfo",self.trigger.bind(self,"gopInfo"));pipeline.videoSegmentStream.on("segmentTimingInfo",self.trigger.bind(self,"videoSegmentTimingInfo"));pipeline.videoSegmentStream.on("baseMediaDecodeTime",function(baseMediaDecodeTime){if(audioTrack){pipeline.audioSegmentStream.setVideoBaseMediaDecodeTime(baseMediaDecodeTime)}});pipeline.videoSegmentStream.on("timingInfo",self.trigger.bind(self,"videoTimingInfo"));pipeline.h264Stream.pipe(pipeline.videoSegmentStream).pipe(pipeline.coalesceStream)}if(audioTrack&&!pipeline.audioSegmentStream){pipeline.coalesceStream.numberOfTracks++;pipeline.audioSegmentStream=new _AudioSegmentStream(audioTrack,options);pipeline.audioSegmentStream.on("timingInfo",self.trigger.bind(self,"audioTimingInfo"));pipeline.adtsStream.pipe(pipeline.audioSegmentStream).pipe(pipeline.coalesceStream)}self.trigger("trackinfo",{hasAudio:!!audioTrack,hasVideo:!!videoTrack})}});pipeline.coalesceStream.on("data",this.trigger.bind(this,"data"));pipeline.coalesceStream.on("id3Frame",function(id3Frame){id3Frame.dispatchType=pipeline.metadataStream.dispatchType;self.trigger("id3Frame",id3Frame)});pipeline.coalesceStream.on("caption",this.trigger.bind(this,"caption"));pipeline.coalesceStream.on("done",this.trigger.bind(this,"done"))};this.setBaseMediaDecodeTime=function(baseMediaDecodeTime){var pipeline=this.transmuxPipeline_;this.baseMediaDecodeTime=baseMediaDecodeTime;if(audioTrack){audioTrack.timelineStartInfo.dts=void 0;audioTrack.timelineStartInfo.pts=void 0;trackDecodeInfo.clearDtsInfo(audioTrack);if(pipeline.audioTimestampRolloverStream){pipeline.audioTimestampRolloverStream.discontinuity()}}if(videoTrack){if(pipeline.videoSegmentStream){pipeline.videoSegmentStream.gopCache_=[]}videoTrack.timelineStartInfo.dts=void 0;videoTrack.timelineStartInfo.pts=void 0;trackDecodeInfo.clearDtsInfo(videoTrack);pipeline.captionStream.reset()}if(pipeline.timestampRolloverStream){pipeline.timestampRolloverStream.discontinuity()}};this.setAudioAppendStart=function(timestamp){if(audioTrack){this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(timestamp)}};this.setRemux=function(val){var pipeline=this.transmuxPipeline_;options.remux=val;if(pipeline&&pipeline.coalesceStream){pipeline.coalesceStream.setRemux(val)}};this.alignGopsWith=function(gopsToAlignWith){if(videoTrack&&this.transmuxPipeline_.videoSegmentStream){this.transmuxPipeline_.videoSegmentStream.alignGopsWith(gopsToAlignWith)}};this.push=function(data){if(hasFlushed){var isAac=isLikelyAacData$1(data);if(isAac&&"aac"!==this.transmuxPipeline_.type){this.setupAacPipeline()}else if(!isAac&&"ts"!==this.transmuxPipeline_.type){this.setupTsPipeline()}hasFlushed=!1}this.transmuxPipeline_.headOfPipeline.push(data)};this.flush=function(){hasFlushed=!0;this.transmuxPipeline_.headOfPipeline.flush()};this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()};this.reset=function(){if(this.transmuxPipeline_.headOfPipeline){this.transmuxPipeline_.headOfPipeline.reset()}};this.resetCaptions=function(){if(this.transmuxPipeline_.captionStream){this.transmuxPipeline_.captionStream.reset()}}};_Transmuxer.prototype=new stream;var transmuxer={Transmuxer:_Transmuxer,VideoSegmentStream:_VideoSegmentStream,AudioSegmentStream:_AudioSegmentStream,AUDIO_PROPERTIES:audioProperties,VIDEO_PROPERTIES:videoProperties,generateVideoSegmentTimingInfo:generateVideoSegmentTimingInfo},classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}},createClass=function(){function defineProperties(target,props){for(var i=0,descriptor;i<props.length;i++){descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value"in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}(),wireTransmuxerEvents=function(self,transmuxer$$1){transmuxer$$1.on("data",function(segment){var initArray=segment.initSegment;segment.initSegment={data:initArray.buffer,byteOffset:initArray.byteOffset,byteLength:initArray.byteLength};var typedArray=segment.data;segment.data=typedArray.buffer;self.postMessage({action:"data",segment:segment,byteOffset:typedArray.byteOffset,byteLength:typedArray.byteLength},[segment.data])});if(transmuxer$$1.captionStream){transmuxer$$1.captionStream.on("data",function(caption){self.postMessage({action:"caption",data:caption})})}transmuxer$$1.on("done",function(){self.postMessage({action:"done"})});transmuxer$$1.on("gopInfo",function(gopInfo){self.postMessage({action:"gopInfo",gopInfo:gopInfo})});transmuxer$$1.on("videoSegmentTimingInfo",function(videoSegmentTimingInfo){self.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:videoSegmentTimingInfo})})},MessageHandlers=function(){function MessageHandlers(self,options){classCallCheck(this,MessageHandlers);this.options=options||{};this.self=self;this.init()}createClass(MessageHandlers,[{key:"init",value:function(){if(this.transmuxer){this.transmuxer.dispose()}this.transmuxer=new transmuxer.Transmuxer(this.options);wireTransmuxerEvents(this.self,this.transmuxer)}},{key:"push",value:function(data){var segment=new Uint8Array(data.data,data.byteOffset,data.byteLength);this.transmuxer.push(segment)}},{key:"reset",value:function(){this.init()}},{key:"setTimestampOffset",value:function(data){var timestampOffset=data.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(9e4*timestampOffset))}},{key:"setAudioAppendStart",value:function(data){this.transmuxer.setAudioAppendStart(Math.ceil(9e4*data.appendStart))}},{key:"flush",value:function(){this.transmuxer.flush()}},{key:"resetCaptions",value:function(){this.transmuxer.resetCaptions()}},{key:"alignGopsWith",value:function(data){this.transmuxer.alignGopsWith(data.gopsToAlignWith.slice())}}]);return MessageHandlers}(),transmuxerWorker=new function(self){self.onmessage=function(event){if("init"===event.data.action&&event.data.options){this.messageHandlers=new MessageHandlers(self,event.data.options);return}if(!this.messageHandlers){this.messageHandlers=new MessageHandlers(self)}if(event.data&&event.data.action&&"init"!==event.data.action){if(this.messageHandlers[event.data.action]){this.messageHandlers[event.data.action](event.data)}}}}(self);return transmuxerWorker}()}),defaultCodecs={videoCodec:"avc1",videoObjectTypeIndicator:".4d400d",audioProfile:"2"},translateLegacyCodecs=function(codecs){return codecs.map(function(codec){return codec.replace(/avc1\.(\d+)\.(\d+)/i,function(orig,profile,avcLevel){var profileHex=("00"+(+profile).toString(16)).slice(-2),avcLevelHex=("00"+(+avcLevel).toString(16)).slice(-2);return"avc1."+profileHex+"00"+avcLevelHex})})},parseCodecs=function(){var codecs=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",result={codecCount:0},parsed=void 0;result.codecCount=codecs.split(",").length;result.codecCount=result.codecCount||2;parsed=/(^|\s|,)+(avc[13])([^ ,]*)/i.exec(codecs);if(parsed){result.videoCodec=parsed[2];result.videoObjectTypeIndicator=parsed[3]}result.audioProfile=/(^|\s|,)+mp4a.[0-9A-Fa-f]+\.([0-9A-Fa-f]+)/i.exec(codecs);result.audioProfile=result.audioProfile&&result.audioProfile[2];return result},mapLegacyAvcCodecs=function(codecString){return codecString.replace(/avc1\.(\d+)\.(\d+)/i,function(match){return translateLegacyCodecs([match])[0]})},makeMimeTypeString=function(type,container,codecs){return type+"/"+container+"; codecs=\""+codecs.filter(function(c){return!!c}).join(", ")+"\""},getContainerType=function(media){if(media.segments&&media.segments.length&&media.segments[0].map){return"mp4"}return"mp2t"},getCodecs=function(media){var mediaAttributes=media.attributes||{};if(mediaAttributes.CODECS){return parseCodecs(mediaAttributes.CODECS)}return defaultCodecs},audioProfileFromDefault=function(master,audioGroupId){if(!master.mediaGroups.AUDIO||!audioGroupId){return null}var audioGroup=master.mediaGroups.AUDIO[audioGroupId];if(!audioGroup){return null}for(var name in audioGroup){var audioType=audioGroup[name];if(audioType["default"]&&audioType.playlists){return parseCodecs(audioType.playlists[0].attributes.CODECS).audioProfile}}return null},mimeTypesForPlaylist=function(master,media){var containerType=getContainerType(media),codecInfo=getCodecs(media),mediaAttributes=media.attributes||{},isMuxed=!0,isMaat=!1;if(!media){return[]}if(master.mediaGroups.AUDIO&&mediaAttributes.AUDIO){var audioGroup=master.mediaGroups.AUDIO[mediaAttributes.AUDIO];if(audioGroup){isMaat=!0;isMuxed=!1;for(var groupId in audioGroup){if(!audioGroup[groupId].uri&&!audioGroup[groupId].playlists){isMuxed=!0;break}}}}if(isMaat&&!codecInfo.audioProfile){if(!isMuxed){codecInfo.audioProfile=audioProfileFromDefault(master,mediaAttributes.AUDIO)}if(!codecInfo.audioProfile){videojs$1.log.warn("Multiple audio tracks present but no audio codec string is specified. Attempting to use the default audio codec (mp4a.40.2)");codecInfo.audioProfile=defaultCodecs.audioProfile}}var codecStrings={};if(codecInfo.videoCodec){codecStrings.video=""+codecInfo.videoCodec+codecInfo.videoObjectTypeIndicator}if(codecInfo.audioProfile){codecStrings.audio="mp4a.40."+codecInfo.audioProfile}var justAudio=makeMimeTypeString("audio",containerType,[codecStrings.audio]),justVideo=makeMimeTypeString("video",containerType,[codecStrings.video]),bothVideoAudio=makeMimeTypeString("video",containerType,[codecStrings.video,codecStrings.audio]);if(isMaat){if(!isMuxed&&codecStrings.video){return[justVideo,justAudio]}if(!isMuxed&&!codecStrings.video){return[justAudio,justAudio]}return[bothVideoAudio,justAudio]}if(!codecStrings.video){return[justAudio]}return[bothVideoAudio]},parseContentType=function(type){var object={type:"",parameters:{}},parameters=type.trim().split(";");object.type=parameters.shift().trim();parameters.forEach(function(parameter){var pair=parameter.trim().split("=");if(1<pair.length){var name=pair[0].replace(/"/g,"").trim(),value=pair[1].replace(/"/g,"").trim();object.parameters[name]=value}});return object},isAudioCodec=function(codec){return /mp4a\.\d+.\d+/i.test(codec)},isVideoCodec=function(codec){return /avc1\.[\da-f]+/i.test(codec)},gopsSafeToAlignWith=function(buffer,currentTime,mapping){if("undefined"==typeof currentTime||null===currentTime||!buffer.length){return[]}var currentTimePts=Math.ceil(9e4*(currentTime-mapping+3)),i=void 0;for(i=0;i<buffer.length;i++){if(buffer[i].pts>currentTimePts){break}}return buffer.slice(i)},updateGopBuffer=function(buffer,gops,replace){if(!gops.length){return buffer}if(replace){return gops.slice()}var start=gops[0].pts,i=0;for(i;i<buffer.length;i++){if(buffer[i].pts>=start){break}}return buffer.slice(0,i).concat(gops)},removeGopBuffer=function(buffer,start,end,mapping){var startPts=Math.ceil(9e4*(start-mapping)),endPts=Math.ceil(9e4*(end-mapping)),updatedBuffer=buffer.slice(),i=buffer.length;while(i--){if(buffer[i].pts<=endPts){break}}if(-1===i){return updatedBuffer}var j=i+1;while(j--){if(buffer[j].pts<=startPts){break}}j=Math.max(j,0);updatedBuffer.splice(j,i-j+1);return updatedBuffer},buffered=function(videoBuffer,audioBuffer,audioDisabled){var start=null,end=null,arity=0,extents=[],ranges=[];if(!videoBuffer&&!audioBuffer){return videojs$1.createTimeRange()}if(!videoBuffer){return audioBuffer.buffered}if(!audioBuffer){return videoBuffer.buffered}if(audioDisabled){return videoBuffer.buffered}if(0===videoBuffer.buffered.length&&0===audioBuffer.buffered.length){return videojs$1.createTimeRange()}var videoBuffered=videoBuffer.buffered,audioBuffered=audioBuffer.buffered,count=videoBuffered.length;while(count--){extents.push({time:videoBuffered.start(count),type:"start"});extents.push({time:videoBuffered.end(count),type:"end"})}count=audioBuffered.length;while(count--){extents.push({time:audioBuffered.start(count),type:"start"});extents.push({time:audioBuffered.end(count),type:"end"})}extents.sort(function(a,b){return a.time-b.time});for(count=0;count<extents.length;count++){if("start"===extents[count].type){arity++;if(2===arity){start=extents[count].time}}else if("end"===extents[count].type){arity--;if(1===arity){end=extents[count].time}}if(null!==start&&null!==end){ranges.push([start,end]);start=null;end=null}}return videojs$1.createTimeRanges(ranges)},ONE_SECOND_IN_TS$2=9e4,makeWrappedSourceBuffer=function(mediaSource,mimeType){var sourceBuffer=mediaSource.addSourceBuffer(mimeType),wrapper=Object.create(null);wrapper.updating=!1;wrapper.realBuffer_=sourceBuffer;var _loop=function(key){if("function"==typeof sourceBuffer[key]){wrapper[key]=function(){return sourceBuffer[key].apply(sourceBuffer,arguments)}}else if("undefined"==typeof wrapper[key]){Object.defineProperty(wrapper,key,{get:function(){return sourceBuffer[key]},set:function(v){return sourceBuffer[key]=v}})}};for(var key in sourceBuffer){_loop(key)}return wrapper},VirtualSourceBuffer=function(_videojs$EventTarget){inherits$1(VirtualSourceBuffer,_videojs$EventTarget);function VirtualSourceBuffer(mediaSource,codecs){classCallCheck(this,VirtualSourceBuffer);var _this=possibleConstructorReturn(this,(VirtualSourceBuffer.__proto__||Object.getPrototypeOf(VirtualSourceBuffer)).call(this,videojs$1.EventTarget));_this.timestampOffset_=0;_this.pendingBuffers_=[];_this.bufferUpdating_=!1;_this.mediaSource_=mediaSource;_this.codecs_=codecs;_this.audioCodec_=null;_this.videoCodec_=null;_this.audioDisabled_=!1;_this.appendAudioInitSegment_=!0;_this.gopBuffer_=[];_this.timeMapping_=0;_this.safeAppend_=11<=videojs$1.browser.IE_VERSION;var options={remux:!1,alignGopsAtEnd:_this.safeAppend_};_this.codecs_.forEach(function(codec){if(isAudioCodec(codec)){_this.audioCodec_=codec}else if(isVideoCodec(codec)){_this.videoCodec_=codec}});_this.transmuxer_=new TransmuxWorker;_this.transmuxer_.postMessage({action:"init",options:options});_this.transmuxer_.onmessage=function(event){if("data"===event.data.action){return _this.data_(event)}if("done"===event.data.action){return _this.done_(event)}if("gopInfo"===event.data.action){return _this.appendGopInfo_(event)}if("videoSegmentTimingInfo"===event.data.action){return _this.videoSegmentTimingInfo_(event.data.videoSegmentTimingInfo)}};Object.defineProperty(_this,"timestampOffset",{get:function(){return this.timestampOffset_},set:function(val){if("number"==typeof val&&0<=val){this.timestampOffset_=val;this.appendAudioInitSegment_=!0;this.gopBuffer_.length=0;this.timeMapping_=0;this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:val})}}});Object.defineProperty(_this,"appendWindowStart",{get:function(){return(this.videoBuffer_||this.audioBuffer_).appendWindowStart},set:function(start){if(this.videoBuffer_){this.videoBuffer_.appendWindowStart=start}if(this.audioBuffer_){this.audioBuffer_.appendWindowStart=start}}});Object.defineProperty(_this,"updating",{get:function(){return!!(this.bufferUpdating_||!this.audioDisabled_&&this.audioBuffer_&&this.audioBuffer_.updating||this.videoBuffer_&&this.videoBuffer_.updating)}});Object.defineProperty(_this,"buffered",{get:function(){return buffered(this.videoBuffer_,this.audioBuffer_,this.audioDisabled_)}});return _this}createClass$1(VirtualSourceBuffer,[{key:"data_",value:function(event){var segment=event.data.segment;segment.data=new Uint8Array(segment.data,event.data.byteOffset,event.data.byteLength);segment.initSegment=new Uint8Array(segment.initSegment.data,segment.initSegment.byteOffset,segment.initSegment.byteLength);createTextTracksIfNecessary(this,this.mediaSource_,segment);this.pendingBuffers_.push(segment)}},{key:"done_",value:function(){if("closed"===this.mediaSource_.readyState){this.pendingBuffers_.length=0;return}this.processPendingSegments_()}},{key:"videoSegmentTimingInfo_",value:function(timingInfo){var timingInfoInSeconds={start:{decode:timingInfo.start.dts/ONE_SECOND_IN_TS$2,presentation:timingInfo.start.pts/ONE_SECOND_IN_TS$2},end:{decode:timingInfo.end.dts/ONE_SECOND_IN_TS$2,presentation:timingInfo.end.pts/ONE_SECOND_IN_TS$2},baseMediaDecodeTime:timingInfo.baseMediaDecodeTime/ONE_SECOND_IN_TS$2};if(timingInfo.prependedContentDuration){timingInfoInSeconds.prependedContentDuration=timingInfo.prependedContentDuration/ONE_SECOND_IN_TS$2}this.trigger({type:"videoSegmentTimingInfo",videoSegmentTimingInfo:timingInfoInSeconds})}},{key:"createRealSourceBuffers_",value:function(){var _this2=this,types=["audio","video"];types.forEach(function(type){if(!_this2[type+"Codec_"]){return}if(_this2[type+"Buffer_"]){return}var buffer=null;if(_this2.mediaSource_[type+"Buffer_"]){buffer=_this2.mediaSource_[type+"Buffer_"];buffer.updating=!1}else{var mimeType=type+"/mp4;codecs=\""+_this2[type+"Codec_"]+"\"";buffer=makeWrappedSourceBuffer(_this2.mediaSource_.nativeMediaSource_,mimeType);_this2.mediaSource_[type+"Buffer_"]=buffer}_this2[type+"Buffer_"]=buffer;["update","updatestart","updateend"].forEach(function(event){buffer.addEventListener(event,function(){if("audio"===type&&_this2.audioDisabled_){return}if("updateend"===event){_this2[type+"Buffer_"].updating=!1}var shouldTrigger=types.every(function(t){if("audio"===t&&_this2.audioDisabled_){return!0}if(type!==t&&_this2[t+"Buffer_"]&&_this2[t+"Buffer_"].updating){return!1}return!0});if(shouldTrigger){return _this2.trigger(event)}})})})}},{key:"appendBuffer",value:function(segment){this.bufferUpdating_=!0;if(this.audioBuffer_&&this.audioBuffer_.buffered.length){var audioBuffered=this.audioBuffer_.buffered;this.transmuxer_.postMessage({action:"setAudioAppendStart",appendStart:audioBuffered.end(audioBuffered.length-1)})}if(this.videoBuffer_){this.transmuxer_.postMessage({action:"alignGopsWith",gopsToAlignWith:gopsSafeToAlignWith(this.gopBuffer_,this.mediaSource_.player_?this.mediaSource_.player_.currentTime():null,this.timeMapping_)})}this.transmuxer_.postMessage({action:"push",data:segment.buffer,byteOffset:segment.byteOffset,byteLength:segment.byteLength},[segment.buffer]);this.transmuxer_.postMessage({action:"flush"})}},{key:"appendGopInfo_",value:function(event){this.gopBuffer_=updateGopBuffer(this.gopBuffer_,event.data.gopInfo,this.safeAppend_)}},{key:"remove",value:function(start,end){if(this.videoBuffer_){this.videoBuffer_.updating=!0;this.videoBuffer_.remove(start,end);this.gopBuffer_=removeGopBuffer(this.gopBuffer_,start,end,this.timeMapping_)}if(!this.audioDisabled_&&this.audioBuffer_){this.audioBuffer_.updating=!0;this.audioBuffer_.remove(start,end)}removeCuesFromTrack(start,end,this.metadataTrack_);if(this.inbandTextTracks_){for(var track in this.inbandTextTracks_){removeCuesFromTrack(start,end,this.inbandTextTracks_[track])}}}},{key:"processPendingSegments_",value:function(){var sortedSegments={video:{segments:[],bytes:0},audio:{segments:[],bytes:0},captions:[],metadata:[]};if(!this.pendingBuffers_.length){this.trigger("updateend");this.bufferUpdating_=!1;return}sortedSegments=this.pendingBuffers_.reduce(function(segmentObj,segment){var type=segment.type,data=segment.data,initSegment=segment.initSegment;segmentObj[type].segments.push(data);segmentObj[type].bytes+=data.byteLength;segmentObj[type].initSegment=initSegment;if(segment.captions){segmentObj.captions=segmentObj.captions.concat(segment.captions)}if(segment.info){segmentObj[type].info=segment.info}if(segment.metadata){segmentObj.metadata=segmentObj.metadata.concat(segment.metadata)}return segmentObj},sortedSegments);if(!this.videoBuffer_&&!this.audioBuffer_){if(0===sortedSegments.video.bytes){this.videoCodec_=null}if(0===sortedSegments.audio.bytes){this.audioCodec_=null}this.createRealSourceBuffers_()}if(sortedSegments.audio.info){this.mediaSource_.trigger({type:"audioinfo",info:sortedSegments.audio.info})}if(sortedSegments.video.info){this.mediaSource_.trigger({type:"videoinfo",info:sortedSegments.video.info})}if(this.appendAudioInitSegment_){if(!this.audioDisabled_&&this.audioBuffer_){sortedSegments.audio.segments.unshift(sortedSegments.audio.initSegment);sortedSegments.audio.bytes+=sortedSegments.audio.initSegment.byteLength}this.appendAudioInitSegment_=!1}var triggerUpdateend=!1;if(this.videoBuffer_&&sortedSegments.video.bytes){sortedSegments.video.segments.unshift(sortedSegments.video.initSegment);sortedSegments.video.bytes+=sortedSegments.video.initSegment.byteLength;this.concatAndAppendSegments_(sortedSegments.video,this.videoBuffer_)}else if(this.videoBuffer_&&(this.audioDisabled_||!this.audioBuffer_)){triggerUpdateend=!0}addTextTrackData(this,sortedSegments.captions,sortedSegments.metadata);if(!this.audioDisabled_&&this.audioBuffer_){this.concatAndAppendSegments_(sortedSegments.audio,this.audioBuffer_)}this.pendingBuffers_.length=0;if(triggerUpdateend){this.trigger("updateend")}this.bufferUpdating_=!1}},{key:"concatAndAppendSegments_",value:function(segmentObj,destinationBuffer){var offset=0,tempBuffer=void 0;if(segmentObj.bytes){tempBuffer=new Uint8Array(segmentObj.bytes);segmentObj.segments.forEach(function(segment){tempBuffer.set(segment,offset);offset+=segment.byteLength});try{destinationBuffer.updating=!0;destinationBuffer.appendBuffer(tempBuffer)}catch(error){if(this.mediaSource_.player_){this.mediaSource_.player_.error({code:-3,type:"APPEND_BUFFER_ERR",message:error.message,originalError:error})}}}}},{key:"abort",value:function(){if(this.videoBuffer_){this.videoBuffer_.abort()}if(!this.audioDisabled_&&this.audioBuffer_){this.audioBuffer_.abort()}if(this.transmuxer_){this.transmuxer_.postMessage({action:"reset"})}this.pendingBuffers_.length=0;this.bufferUpdating_=!1}},{key:"dispose",value:function(){if(this.transmuxer_){this.transmuxer_.terminate()}this.trigger("dispose");this.off()}}]);return VirtualSourceBuffer}(videojs$1.EventTarget),HtmlMediaSource=function(_videojs$EventTarget){inherits$1(HtmlMediaSource,_videojs$EventTarget);function HtmlMediaSource(){classCallCheck(this,HtmlMediaSource);var _this=possibleConstructorReturn(this,(HtmlMediaSource.__proto__||Object.getPrototypeOf(HtmlMediaSource)).call(this)),property=void 0;_this.nativeMediaSource_=new window$3.MediaSource;for(property in _this.nativeMediaSource_){if(!(property in HtmlMediaSource.prototype)&&"function"==typeof _this.nativeMediaSource_[property]){_this[property]=_this.nativeMediaSource_[property].bind(_this.nativeMediaSource_)}}_this.duration_=NaN;Object.defineProperty(_this,"duration",{get:function(){if(this.duration_===1/0){return this.duration_}return this.nativeMediaSource_.duration},set:function(duration){this.duration_=duration;if(duration!==1/0){this.nativeMediaSource_.duration=duration}}});Object.defineProperty(_this,"seekable",{get:function(){if(this.duration_===1/0){return videojs$1.createTimeRanges([[0,this.nativeMediaSource_.duration]])}return this.nativeMediaSource_.seekable}});Object.defineProperty(_this,"readyState",{get:function(){return this.nativeMediaSource_.readyState}});Object.defineProperty(_this,"activeSourceBuffers",{get:function(){return this.activeSourceBuffers_}});_this.sourceBuffers=[];_this.activeSourceBuffers_=[];_this.updateActiveSourceBuffers_=function(){_this.activeSourceBuffers_.length=0;if(1===_this.sourceBuffers.length){var sourceBuffer=_this.sourceBuffers[0];sourceBuffer.appendAudioInitSegment_=!0;sourceBuffer.audioDisabled_=!sourceBuffer.audioCodec_;_this.activeSourceBuffers_.push(sourceBuffer);return}for(var disableCombined=!1,disableAudioOnly=!0,i=0,track;i<_this.player_.audioTracks().length;i++){track=_this.player_.audioTracks()[i];if(track.enabled&&"main"!==track.kind){disableCombined=!0;disableAudioOnly=!1;break}}_this.sourceBuffers.forEach(function(sourceBuffer,index){sourceBuffer.appendAudioInitSegment_=!0;if(sourceBuffer.videoCodec_&&sourceBuffer.audioCodec_){sourceBuffer.audioDisabled_=disableCombined}else if(sourceBuffer.videoCodec_&&!sourceBuffer.audioCodec_){sourceBuffer.audioDisabled_=!0;disableAudioOnly=!1}else if(!sourceBuffer.videoCodec_&&sourceBuffer.audioCodec_){sourceBuffer.audioDisabled_=index?disableAudioOnly:!disableAudioOnly;if(sourceBuffer.audioDisabled_){return}}_this.activeSourceBuffers_.push(sourceBuffer)})};_this.onPlayerMediachange_=function(){_this.sourceBuffers.forEach(function(sourceBuffer){sourceBuffer.appendAudioInitSegment_=!0})};_this.onHlsReset_=function(){_this.sourceBuffers.forEach(function(sourceBuffer){if(sourceBuffer.transmuxer_){sourceBuffer.transmuxer_.postMessage({action:"resetCaptions"})}})};_this.onHlsSegmentTimeMapping_=function(event){_this.sourceBuffers.forEach(function(buffer){return buffer.timeMapping_=event.mapping})};["sourceopen","sourceclose","sourceended"].forEach(function(eventName){this.nativeMediaSource_.addEventListener(eventName,this.trigger.bind(this))},_this);_this.on("sourceopen",function(){var video=document.querySelector("[src=\""+_this.url_+"\"]");if(!video){return}_this.player_=videojs$1(video.parentNode);if(!_this.player_){return}_this.player_.tech_.on("hls-reset",_this.onHlsReset_);_this.player_.tech_.on("hls-segment-time-mapping",_this.onHlsSegmentTimeMapping_);if(_this.player_.audioTracks&&_this.player_.audioTracks()){_this.player_.audioTracks().on("change",_this.updateActiveSourceBuffers_);_this.player_.audioTracks().on("addtrack",_this.updateActiveSourceBuffers_);_this.player_.audioTracks().on("removetrack",_this.updateActiveSourceBuffers_)}_this.player_.on("mediachange",_this.onPlayerMediachange_)});_this.on("sourceended",function(){for(var duration=durationOfVideo(_this.duration),i=0;i<_this.sourceBuffers.length;i++){var sourcebuffer=_this.sourceBuffers[i],cues=sourcebuffer.metadataTrack_&&sourcebuffer.metadataTrack_.cues;if(cues&&cues.length){cues[cues.length-1].endTime=duration}}});_this.on("sourceclose",function(){this.sourceBuffers.forEach(function(sourceBuffer){if(sourceBuffer.transmuxer_){sourceBuffer.transmuxer_.terminate()}});this.sourceBuffers.length=0;if(!this.player_){return}if(this.player_.audioTracks&&this.player_.audioTracks()){this.player_.audioTracks().off("change",this.updateActiveSourceBuffers_);this.player_.audioTracks().off("addtrack",this.updateActiveSourceBuffers_);this.player_.audioTracks().off("removetrack",this.updateActiveSourceBuffers_)}if(this.player_.el_){this.player_.off("mediachange",this.onPlayerMediachange_)}if(this.player_.tech_&&this.player_.tech_.el_){this.player_.tech_.off("hls-reset",this.onHlsReset_);this.player_.tech_.off("hls-segment-time-mapping",this.onHlsSegmentTimeMapping_)}});return _this}createClass$1(HtmlMediaSource,[{key:"addSeekableRange_",value:function(start,end){var error;if(this.duration!==1/0){error=new Error("MediaSource.addSeekableRange() can only be invoked when the duration is Infinity");error.name="InvalidStateError";error.code=11;throw error}if(end>this.nativeMediaSource_.duration||isNaN(this.nativeMediaSource_.duration)){this.nativeMediaSource_.duration=end}}},{key:"addSourceBuffer",value:function(type){var buffer=void 0,parsedType=parseContentType(type);if(/^(video|audio)\/mp2t$/i.test(parsedType.type)){var codecs=[];if(parsedType.parameters&&parsedType.parameters.codecs){codecs=parsedType.parameters.codecs.split(",");codecs=translateLegacyCodecs(codecs);codecs=codecs.filter(function(codec){return isAudioCodec(codec)||isVideoCodec(codec)})}if(0===codecs.length){codecs=["avc1.4d400d","mp4a.40.2"]}buffer=new VirtualSourceBuffer(this,codecs);if(0!==this.sourceBuffers.length){this.sourceBuffers[0].createRealSourceBuffers_();buffer.createRealSourceBuffers_();this.sourceBuffers[0].audioDisabled_=!0}}else{buffer=this.nativeMediaSource_.addSourceBuffer(type)}this.sourceBuffers.push(buffer);return buffer}},{key:"dispose",value:function(){this.trigger("dispose");this.off();this.sourceBuffers.forEach(function(buffer){if(buffer.dispose){buffer.dispose()}});this.sourceBuffers.length=0}}]);return HtmlMediaSource}(videojs$1.EventTarget),urlCount=0;videojs$1.mediaSources={};var open=function(msObjectURL,swfId){var mediaSource=videojs$1.mediaSources[msObjectURL];if(mediaSource){mediaSource.trigger({type:"sourceopen",swfId:swfId})}else{throw new Error("Media Source not found (Video.js)")}},supportsNativeMediaSources=function(){return!!window$3.MediaSource&&!!window$3.MediaSource.isTypeSupported&&window$3.MediaSource.isTypeSupported("video/mp4;codecs=\"avc1.4d400d,mp4a.40.2\"")},MediaSource=function(){this.MediaSource={open:open,supportsNativeMediaSources:supportsNativeMediaSources};if(supportsNativeMediaSources()){return new HtmlMediaSource}throw new Error("Cannot use create a virtual MediaSource for this video")};MediaSource.open=open;MediaSource.supportsNativeMediaSources=supportsNativeMediaSources;var URL$1={createObjectURL:function(object){var url=void 0;if(object instanceof HtmlMediaSource){url=window$3.URL.createObjectURL(object.nativeMediaSource_);object.url_=url;return url}if(!(object instanceof HtmlMediaSource)){url=window$3.URL.createObjectURL(object);object.url_=url;return url}url="blob:vjs-media-source/"+urlCount;urlCount++;videojs$1.mediaSources[url]=object;return url}};videojs$1.MediaSource=MediaSource;videojs$1.URL=URL$1;var EventTarget$1$1=videojs$1.EventTarget,mergeOptions$2=videojs$1.mergeOptions,updateMaster$1=function(oldMaster,newMaster){for(var noChanges=void 0,update=mergeOptions$2(oldMaster,{duration:newMaster.duration,minimumUpdatePeriod:newMaster.minimumUpdatePeriod}),i=0,playlistUpdate;i<newMaster.playlists.length;i++){playlistUpdate=updateMaster(update,newMaster.playlists[i]);if(playlistUpdate){update=playlistUpdate}else{noChanges=!0}}forEachMediaGroup(newMaster,function(properties,type,group,label){if(properties.playlists&&properties.playlists.length){var id=properties.playlists[0].id,_playlistUpdate=updateMaster(update,properties.playlists[0]);if(_playlistUpdate){update=_playlistUpdate;update.mediaGroups[type][group][label].playlists[0]=update.playlists[id];noChanges=!1}}});if(noChanges){return null}return update},generateSidxKey=function(sidxInfo){var sidxByteRangeEnd=sidxInfo.byterange.offset+sidxInfo.byterange.length-1;return sidxInfo.uri+"-"+sidxInfo.byterange.offset+"-"+sidxByteRangeEnd},equivalentSidx=function(a,b){var neitherMap=!!(!a.map&&!b.map),equivalentMap=neitherMap||!!(a.map&&b.map&&a.map.byterange.offset===b.map.byterange.offset&&a.map.byterange.length===b.map.byterange.length);return equivalentMap&&a.uri===b.uri&&a.byterange.offset===b.byterange.offset&&a.byterange.length===b.byterange.length},compareSidxEntry=function(playlists,oldSidxMapping){var newSidxMapping={};for(var id in playlists){var playlist=playlists[id],currentSidxInfo=playlist.sidx;if(currentSidxInfo){var key=generateSidxKey(currentSidxInfo);if(!oldSidxMapping[key]){break}var savedSidxInfo=oldSidxMapping[key].sidxInfo;if(equivalentSidx(savedSidxInfo,currentSidxInfo)){newSidxMapping[key]=oldSidxMapping[key]}}}return newSidxMapping},filterChangedSidxMappings=function(masterXml,srcUrl,clientOffset,oldSidxMapping){var master=parse(masterXml,{manifestUri:srcUrl,clientOffset:clientOffset}),videoSidx=compareSidxEntry(master.playlists,oldSidxMapping),mediaGroupSidx=videoSidx;forEachMediaGroup(master,function(properties){if(properties.playlists&&properties.playlists.length){var playlists=properties.playlists;mediaGroupSidx=mergeOptions$2(mediaGroupSidx,compareSidxEntry(playlists,oldSidxMapping))}});return mediaGroupSidx},requestSidx_=function(sidxRange,playlist,xhr,options,finishProcessingFn){var sidxInfo={uri:resolveManifestRedirect(options.handleManifestRedirects,sidxRange.resolvedUri),byterange:sidxRange.byterange,playlist:playlist},sidxRequestOptions=videojs$1.mergeOptions(sidxInfo,{responseType:"arraybuffer",headers:segmentXhrHeaders(sidxInfo)});return xhr(sidxRequestOptions,finishProcessingFn)},DashPlaylistLoader=function(_EventTarget){inherits$1(DashPlaylistLoader,_EventTarget);function DashPlaylistLoader(srcUrlOrPlaylist,hls){var options=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{},masterPlaylistLoader=arguments[3];classCallCheck(this,DashPlaylistLoader);var _this=possibleConstructorReturn(this,(DashPlaylistLoader.__proto__||Object.getPrototypeOf(DashPlaylistLoader)).call(this)),_options$withCredenti=options.withCredentials,withCredentials=_options$withCredenti===void 0?!1:_options$withCredenti,_options$handleManife=options.handleManifestRedirects,handleManifestRedirects=_options$handleManife===void 0?!1:_options$handleManife;_this.hls_=hls;_this.withCredentials=withCredentials;_this.handleManifestRedirects=handleManifestRedirects;if(!srcUrlOrPlaylist){throw new Error("A non-empty playlist URL or playlist is required")}_this.on("minimumUpdatePeriod",function(){_this.refreshXml_()});_this.on("mediaupdatetimeout",function(){_this.refreshMedia_(_this.media().id)});_this.state="HAVE_NOTHING";_this.loadedPlaylists_={};if("string"==typeof srcUrlOrPlaylist){_this.srcUrl=srcUrlOrPlaylist;_this.sidxMapping_={};return possibleConstructorReturn(_this)}_this.setupChildLoader(masterPlaylistLoader,srcUrlOrPlaylist);return _this}createClass$1(DashPlaylistLoader,[{key:"setupChildLoader",value:function(masterPlaylistLoader,playlist){this.masterPlaylistLoader_=masterPlaylistLoader;this.childPlaylist_=playlist}},{key:"dispose",value:function(){this.trigger("dispose");this.stopRequest();this.loadedPlaylists_={};window$3.clearTimeout(this.minimumUpdatePeriodTimeout_);window$3.clearTimeout(this.mediaRequest_);window$3.clearTimeout(this.mediaUpdateTimeout);this.off()}},{key:"hasPendingRequest",value:function(){return this.request||this.mediaRequest_}},{key:"stopRequest",value:function(){if(this.request){var oldRequest=this.request;this.request=null;oldRequest.onreadystatechange=null;oldRequest.abort()}}},{key:"sidxRequestFinished_",value:function(playlist,master,startingState,doneFn){var _this2=this;return function(err,request){if(!_this2.request){return}_this2.request=null;if(err){_this2.error={status:request.status,message:"DASH playlist request error at URL: "+playlist.uri,response:request.response,code:2};if(startingState){_this2.state=startingState}_this2.trigger("error");return doneFn(master,null)}var bytes=new Uint8Array(request.response),sidx=mp4Inspector.parseSidx(bytes.subarray(8));return doneFn(master,sidx)}}},{key:"media",value:function(playlist){var _this3=this;if(!playlist){return this.media_}if("HAVE_NOTHING"===this.state){throw new Error("Cannot switch media playlist from "+this.state)}var startingState=this.state;if("string"==typeof playlist){if(!this.master.playlists[playlist]){throw new Error("Unknown playlist URI: "+playlist)}playlist=this.master.playlists[playlist]}var mediaChange=!this.media_||playlist.id!==this.media_.id;if(mediaChange&&this.loadedPlaylists_[playlist.id]&&this.loadedPlaylists_[playlist.id].endList){this.state="HAVE_METADATA";this.media_=playlist;if(mediaChange){this.trigger("mediachanging");this.trigger("mediachange")}return}if(!mediaChange){return}if(this.media_){this.trigger("mediachanging")}if(!playlist.sidx){this.mediaRequest_=window$3.setTimeout(this.haveMetadata.bind(this,{startingState:startingState,playlist:playlist}),0);return}var oldMaster=void 0,sidxMapping=void 0;if(this.masterPlaylistLoader_){oldMaster=this.masterPlaylistLoader_.master;sidxMapping=this.masterPlaylistLoader_.sidxMapping_}else{oldMaster=this.master;sidxMapping=this.sidxMapping_}var sidxKey=generateSidxKey(playlist.sidx);sidxMapping[sidxKey]={sidxInfo:playlist.sidx};this.request=requestSidx_(playlist.sidx,playlist,this.hls_.xhr,{handleManifestRedirects:this.handleManifestRedirects},this.sidxRequestFinished_(playlist,oldMaster,startingState,function(newMaster,sidx){if(!newMaster||!sidx){throw new Error("failed to request sidx")}sidxMapping[sidxKey].sidx=sidx;_this3.haveMetadata({startingState:startingState,playlist:newMaster.playlists[playlist.id]})}))}},{key:"haveMetadata",value:function(_ref){var startingState=_ref.startingState,playlist=_ref.playlist;this.state="HAVE_METADATA";this.loadedPlaylists_[playlist.id]=playlist;this.mediaRequest_=null;this.refreshMedia_(playlist.id);if("HAVE_MASTER"===startingState){this.trigger("loadedmetadata")}else{this.trigger("mediachange")}}},{key:"pause",value:function(){this.stopRequest();window$3.clearTimeout(this.mediaUpdateTimeout);window$3.clearTimeout(this.minimumUpdatePeriodTimeout_);if("HAVE_NOTHING"===this.state){this.started=!1}}},{key:"load",value:function(isFinalRendition){var _this4=this;window$3.clearTimeout(this.mediaUpdateTimeout);window$3.clearTimeout(this.minimumUpdatePeriodTimeout_);var media=this.media();if(isFinalRendition){var delay=media?1e3*(media.targetDuration/2):5000;this.mediaUpdateTimeout=window$3.setTimeout(function(){return _this4.load()},delay);return}if(!this.started){this.start();return}if(media&&!media.endList){this.trigger("mediaupdatetimeout")}else{this.trigger("loadedplaylist")}}},{key:"parseMasterXml",value:function(){var master=parse(this.masterXml_,{manifestUri:this.srcUrl,clientOffset:this.clientOffset_,sidxMapping:this.sidxMapping_});master.uri=this.srcUrl;for(var i=0,phonyUri;i<master.playlists.length;i++){phonyUri="placeholder-uri-"+i;master.playlists[i].uri=phonyUri}forEachMediaGroup(master,function(properties,mediaType,groupKey,labelKey){if(properties.playlists&&properties.playlists.length){var _phonyUri="placeholder-uri-"+mediaType+"-"+groupKey+"-"+labelKey,id=createPlaylistID(0,_phonyUri);properties.playlists[0].uri=_phonyUri;properties.playlists[0].id=id;master.playlists[id]=properties.playlists[0];master.playlists[_phonyUri]=properties.playlists[0]}});setupMediaPlaylists(master);resolveMediaGroupUris(master);return master}},{key:"start",value:function(){var _this5=this;this.started=!0;if(this.masterPlaylistLoader_){this.mediaRequest_=window$3.setTimeout(this.haveMaster_.bind(this),0);return}this.request=this.hls_.xhr({uri:this.srcUrl,withCredentials:this.withCredentials},function(error,req){if(!_this5.request){return}_this5.request=null;if(error){_this5.error={status:req.status,message:"DASH playlist request error at URL: "+_this5.srcUrl,responseText:req.responseText,code:2};if("HAVE_NOTHING"===_this5.state){_this5.started=!1}return _this5.trigger("error")}_this5.masterXml_=req.responseText;if(req.responseHeaders&&req.responseHeaders.date){_this5.masterLoaded_=Date.parse(req.responseHeaders.date)}else{_this5.masterLoaded_=Date.now()}_this5.srcUrl=resolveManifestRedirect(_this5.handleManifestRedirects,_this5.srcUrl,req);_this5.syncClientServerClock_(_this5.onClientServerClockSync_.bind(_this5))})}},{key:"syncClientServerClock_",value:function(done){var _this6=this,utcTiming=parseUTCTiming(this.masterXml_);if(null===utcTiming){this.clientOffset_=this.masterLoaded_-Date.now();return done()}if("DIRECT"===utcTiming.method){this.clientOffset_=utcTiming.value-Date.now();return done()}this.request=this.hls_.xhr({uri:resolveUrl$1(this.srcUrl,utcTiming.value),method:utcTiming.method,withCredentials:this.withCredentials},function(error,req){if(!_this6.request){return}if(error){_this6.clientOffset_=_this6.masterLoaded_-Date.now();return done()}var serverTime;if("HEAD"===utcTiming.method){if(!req.responseHeaders||!req.responseHeaders.date){serverTime=_this6.masterLoaded_}else{serverTime=Date.parse(req.responseHeaders.date)}}else{serverTime=Date.parse(req.responseText)}_this6.clientOffset_=serverTime-Date.now();done()})}},{key:"haveMaster_",value:function(){this.state="HAVE_MASTER";this.mediaRequest_=null;if(!this.masterPlaylistLoader_){this.master=this.parseMasterXml();this.trigger("loadedplaylist")}else if(!this.media_){this.media(this.childPlaylist_)}}},{key:"onClientServerClockSync_",value:function(){var _this7=this;this.haveMaster_();if(!this.hasPendingRequest()&&!this.media_){this.media(this.master.playlists[0])}if(this.master&&this.master.minimumUpdatePeriod){this.minimumUpdatePeriodTimeout_=window$3.setTimeout(function(){_this7.trigger("minimumUpdatePeriod")},this.master.minimumUpdatePeriod)}}},{key:"refreshXml_",value:function(){var _this8=this;this.request=this.hls_.xhr({uri:this.srcUrl,withCredentials:this.withCredentials},function(error,req){if(!_this8.request){return}_this8.request=null;if(error){_this8.error={status:req.status,message:"DASH playlist request error at URL: "+_this8.srcUrl,responseText:req.responseText,code:2};if("HAVE_NOTHING"===_this8.state){_this8.started=!1}return _this8.trigger("error")}_this8.masterXml_=req.responseText;_this8.sidxMapping_=filterChangedSidxMappings(_this8.masterXml_,_this8.srcUrl,_this8.clientOffset_,_this8.sidxMapping_);var master=_this8.parseMasterXml(),updatedMaster=updateMaster$1(_this8.master,master),currentSidxInfo=_this8.media().sidx;if(updatedMaster){if(currentSidxInfo){var sidxKey=generateSidxKey(currentSidxInfo);if(!_this8.sidxMapping_[sidxKey]){var playlist=_this8.media();_this8.request=requestSidx_(playlist.sidx,playlist,_this8.hls_.xhr,{handleManifestRedirects:_this8.handleManifestRedirects},_this8.sidxRequestFinished_(playlist,master,_this8.state,function(newMaster,sidx){if(!newMaster||!sidx){throw new Error("failed to request sidx on minimumUpdatePeriod")}_this8.sidxMapping_[sidxKey].sidx=sidx;_this8.minimumUpdatePeriodTimeout_=window$3.setTimeout(function(){_this8.trigger("minimumUpdatePeriod")},_this8.master.minimumUpdatePeriod);_this8.refreshMedia_(_this8.media().id)}))}}else{_this8.master=updatedMaster}}_this8.minimumUpdatePeriodTimeout_=window$3.setTimeout(function(){_this8.trigger("minimumUpdatePeriod")},_this8.master.minimumUpdatePeriod)})}},{key:"refreshMedia_",value:function(mediaID){var _this9=this;if(!mediaID){throw new Error("refreshMedia_ must take a media id")}var oldMaster=void 0,newMaster=void 0;if(this.masterPlaylistLoader_){oldMaster=this.masterPlaylistLoader_.master;newMaster=this.masterPlaylistLoader_.parseMasterXml()}else{oldMaster=this.master;newMaster=this.parseMasterXml()}var updatedMaster=updateMaster$1(oldMaster,newMaster);if(updatedMaster){if(this.masterPlaylistLoader_){this.masterPlaylistLoader_.master=updatedMaster}else{this.master=updatedMaster}this.media_=updatedMaster.playlists[mediaID]}else{this.media_=newMaster.playlists[mediaID];this.trigger("playlistunchanged")}if(!this.media().endList){this.mediaUpdateTimeout=window$3.setTimeout(function(){_this9.trigger("mediaupdatetimeout")},refreshDelay(this.media(),!!updatedMaster))}this.trigger("loadedplaylist")}}]);return DashPlaylistLoader}(EventTarget$1$1),logger=function(source){if(videojs$1.log.debug){return videojs$1.log.debug.bind(videojs$1,"VHS:",source+" >")}return function(){}};function noop$1(){}var SourceUpdater=function(){function SourceUpdater(mediaSource,mimeType,type,sourceBufferEmitter){classCallCheck(this,SourceUpdater);this.callbacks_=[];this.pendingCallback_=null;this.timestampOffset_=0;this.mediaSource=mediaSource;this.processedAppend_=!1;this.type_=type;this.mimeType_=mimeType;this.logger_=logger("SourceUpdater["+type+"]["+mimeType+"]");if("closed"===mediaSource.readyState){mediaSource.addEventListener("sourceopen",this.createSourceBuffer_.bind(this,mimeType,sourceBufferEmitter))}else{this.createSourceBuffer_(mimeType,sourceBufferEmitter)}}createClass$1(SourceUpdater,[{key:"createSourceBuffer_",value:function(mimeType,sourceBufferEmitter){var _this=this;this.sourceBuffer_=this.mediaSource.addSourceBuffer(mimeType);this.logger_("created SourceBuffer");if(sourceBufferEmitter){sourceBufferEmitter.trigger("sourcebufferadded");if(2>this.mediaSource.sourceBuffers.length){sourceBufferEmitter.on("sourcebufferadded",function(){_this.start_()});return}}this.start_()}},{key:"start_",value:function(){var _this2=this;this.started_=!0;this.onUpdateendCallback_=function(){var pendingCallback=_this2.pendingCallback_;_this2.pendingCallback_=null;_this2.sourceBuffer_.removing=!1;_this2.logger_("buffered ["+printableRange(_this2.buffered())+"]");if(pendingCallback){pendingCallback()}_this2.runCallback_()};this.sourceBuffer_.addEventListener("updateend",this.onUpdateendCallback_);this.runCallback_()}},{key:"abort",value:function(done){var _this3=this;if(this.processedAppend_){this.queueCallback_(function(){_this3.sourceBuffer_.abort()},done)}}},{key:"appendBuffer",value:function(config,done){var _this4=this;this.processedAppend_=!0;this.queueCallback_(function(){if(config.videoSegmentTimingInfoCallback){_this4.sourceBuffer_.addEventListener("videoSegmentTimingInfo",config.videoSegmentTimingInfoCallback)}_this4.sourceBuffer_.appendBuffer(config.bytes)},function(){if(config.videoSegmentTimingInfoCallback){_this4.sourceBuffer_.removeEventListener("videoSegmentTimingInfo",config.videoSegmentTimingInfoCallback)}done()})}},{key:"buffered",value:function(){if(!this.sourceBuffer_){return videojs$1.createTimeRanges()}return this.sourceBuffer_.buffered}},{key:"remove",value:function(start,end){var _this5=this,done=2<arguments.length&&arguments[2]!==void 0?arguments[2]:noop$1;if(this.processedAppend_){this.queueCallback_(function(){_this5.logger_("remove ["+start+" => "+end+"]");_this5.sourceBuffer_.removing=!0;_this5.sourceBuffer_.remove(start,end)},done)}}},{key:"updating",value:function(){return!this.sourceBuffer_||this.sourceBuffer_.updating||!!this.pendingCallback_&&this.pendingCallback_!==noop$1}},{key:"timestampOffset",value:function(offset){var _this6=this;if("undefined"!=typeof offset){this.queueCallback_(function(){_this6.sourceBuffer_.timestampOffset=offset;_this6.runCallback_()});this.timestampOffset_=offset}return this.timestampOffset_}},{key:"queueCallback_",value:function(callback,done){this.callbacks_.push([callback.bind(this),done]);this.runCallback_()}},{key:"runCallback_",value:function(){var callbacks;if(!this.updating()&&this.callbacks_.length&&this.started_){callbacks=this.callbacks_.shift();this.pendingCallback_=callbacks[1];callbacks[0]()}}},{key:"dispose",value:function(){var _this7=this,disposeFn=function disposeFn(){if(_this7.sourceBuffer_&&"open"===_this7.mediaSource.readyState){_this7.sourceBuffer_.abort()}_this7.sourceBuffer_.removeEventListener("updateend",disposeFn)};this.sourceBuffer_.removeEventListener("updateend",this.onUpdateendCallback_);if(this.sourceBuffer_.removing){this.sourceBuffer_.addEventListener("updateend",disposeFn)}else{disposeFn()}}}]);return SourceUpdater}(),Config={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,BUFFER_LOW_WATER_LINE_RATE:1},REQUEST_ERRORS={FAILURE:2,TIMEOUT:-101,ABORTED:-102},abortAll=function(activeXhrs){activeXhrs.forEach(function(xhr){xhr.abort()})},getRequestStats=function(request){return{bandwidth:request.bandwidth,bytesReceived:request.bytesReceived||0,roundTripTime:request.roundTripTime||0}},getProgressStats=function(progressEvent){var request=progressEvent.target,roundTripTime=Date.now()-request.requestTime,stats={bandwidth:1/0,bytesReceived:0,roundTripTime:roundTripTime||0};stats.bytesReceived=progressEvent.loaded;stats.bandwidth=Math.floor(1e3*(8*(stats.bytesReceived/stats.roundTripTime)));return stats},handleErrors=function(error,request){if(request.timedout){return{status:request.status,message:"HLS request timed-out at URL: "+request.uri,code:REQUEST_ERRORS.TIMEOUT,xhr:request}}if(request.aborted){return{status:request.status,message:"HLS request aborted at URL: "+request.uri,code:REQUEST_ERRORS.ABORTED,xhr:request}}if(error){return{status:request.status,message:"HLS request errored at URL: "+request.uri,code:REQUEST_ERRORS.FAILURE,xhr:request}}return null},handleKeyResponse=function(segment,finishProcessingFn){return function(error,request){var response=request.response,errorObj=handleErrors(error,request);if(errorObj){return finishProcessingFn(errorObj,segment)}if(16!==response.byteLength){return finishProcessingFn({status:request.status,message:"Invalid HLS key at URL: "+request.uri,code:REQUEST_ERRORS.FAILURE,xhr:request},segment)}var view=new DataView(response);segment.key.bytes=new Uint32Array([view.getUint32(0),view.getUint32(4),view.getUint32(8),view.getUint32(12)]);return finishProcessingFn(null,segment)}},handleInitSegmentResponse=function(segment,captionParser,finishProcessingFn){return function(error,request){var response=request.response,errorObj=handleErrors(error,request);if(errorObj){return finishProcessingFn(errorObj,segment)}if(0===response.byteLength){return finishProcessingFn({status:request.status,message:"Empty HLS segment content at URL: "+request.uri,code:REQUEST_ERRORS.FAILURE,xhr:request},segment)}segment.map.bytes=new Uint8Array(request.response);if(captionParser&&!captionParser.isInitialized()){captionParser.init()}segment.map.timescales=probe.timescale(segment.map.bytes);segment.map.videoTrackIds=probe.videoTrackIds(segment.map.bytes);return finishProcessingFn(null,segment)}},handleSegmentResponse=function(segment,captionParser,finishProcessingFn){return function(error,request){var response=request.response,errorObj=handleErrors(error,request),parsed=void 0;if(errorObj){return finishProcessingFn(errorObj,segment)}if(0===response.byteLength){return finishProcessingFn({status:request.status,message:"Empty HLS segment content at URL: "+request.uri,code:REQUEST_ERRORS.FAILURE,xhr:request},segment)}segment.stats=getRequestStats(request);if(segment.key){segment.encryptedBytes=new Uint8Array(request.response)}else{segment.bytes=new Uint8Array(request.response)}if(captionParser&&segment.map&&segment.map.bytes){if(!captionParser.isInitialized()){captionParser.init()}parsed=captionParser.parse(segment.bytes,segment.map.videoTrackIds,segment.map.timescales);if(parsed&&parsed.captions){segment.captionStreams=parsed.captionStreams;segment.fmp4Captions=parsed.captions}}return finishProcessingFn(null,segment)}},decryptSegment=function(decrypter,segment,doneFn){decrypter.addEventListener("message",function decryptionHandler(event){if(event.data.source===segment.requestId){decrypter.removeEventListener("message",decryptionHandler);var decrypted=event.data.decrypted;segment.bytes=new Uint8Array(decrypted.bytes,decrypted.byteOffset,decrypted.byteLength);return doneFn(null,segment)}});var keyBytes;if(segment.key.bytes.slice){keyBytes=segment.key.bytes.slice()}else{keyBytes=new Uint32Array(Array.prototype.slice.call(segment.key.bytes))}decrypter.postMessage(createTransferableMessage({source:segment.requestId,encrypted:segment.encryptedBytes,key:keyBytes,iv:segment.key.iv}),[segment.encryptedBytes.buffer,keyBytes.buffer])},waitForCompletion=function(activeXhrs,decrypter,doneFn){var count=0,didError=!1;return function(error,segment){if(didError){return}if(error){didError=!0;abortAll(activeXhrs);return doneFn(error,segment)}count+=1;if(count===activeXhrs.length){segment.endOfAllRequests=Date.now();if(segment.encryptedBytes){return decryptSegment(decrypter,segment,doneFn)}return doneFn(null,segment)}}},handleProgress=function(segment,progressFn){return function(event){segment.stats=videojs$1.mergeOptions(segment.stats,getProgressStats(event));if(!segment.stats.firstBytesReceivedAt&&segment.stats.bytesReceived){segment.stats.firstBytesReceivedAt=Date.now()}return progressFn(event,segment)}},mediaSegmentRequest=function(xhr,xhrOptions,decryptionWorker,captionParser,segment,progressFn,doneFn){var activeXhrs=[],finishProcessingFn=waitForCompletion(activeXhrs,decryptionWorker,doneFn);if(segment.key&&!segment.key.bytes){var keyRequestOptions=videojs$1.mergeOptions(xhrOptions,{uri:segment.key.resolvedUri,responseType:"arraybuffer"}),keyRequestCallback=handleKeyResponse(segment,finishProcessingFn),keyXhr=xhr(keyRequestOptions,keyRequestCallback);activeXhrs.push(keyXhr)}if(segment.map&&!segment.map.bytes){var initSegmentOptions=videojs$1.mergeOptions(xhrOptions,{uri:segment.map.resolvedUri,responseType:"arraybuffer",headers:segmentXhrHeaders(segment.map)}),initSegmentRequestCallback=handleInitSegmentResponse(segment,captionParser,finishProcessingFn),initSegmentXhr=xhr(initSegmentOptions,initSegmentRequestCallback);activeXhrs.push(initSegmentXhr)}var segmentRequestOptions=videojs$1.mergeOptions(xhrOptions,{uri:segment.resolvedUri,responseType:"arraybuffer",headers:segmentXhrHeaders(segment)}),segmentRequestCallback=handleSegmentResponse(segment,captionParser,finishProcessingFn),segmentXhr=xhr(segmentRequestOptions,segmentRequestCallback);segmentXhr.addEventListener("progress",handleProgress(segment,progressFn));activeXhrs.push(segmentXhr);return function(){return abortAll(activeXhrs)}},safeGetComputedStyle=function(el,property){var result;if(!el){return""}result=window$3.getComputedStyle(el);if(!result){return""}return result[property]},stableSort=function(array,sortFn){var newArray=array.slice();array.sort(function(left,right){var cmp=sortFn(left,right);if(0===cmp){return newArray.indexOf(left)-newArray.indexOf(right)}return cmp})},comparePlaylistBandwidth=function(left,right){var leftBandwidth=void 0,rightBandwidth=void 0;if(left.attributes.BANDWIDTH){leftBandwidth=left.attributes.BANDWIDTH}leftBandwidth=leftBandwidth||window$3.Number.MAX_VALUE;if(right.attributes.BANDWIDTH){rightBandwidth=right.attributes.BANDWIDTH}rightBandwidth=rightBandwidth||window$3.Number.MAX_VALUE;return leftBandwidth-rightBandwidth},comparePlaylistResolution=function(left,right){var leftWidth=void 0,rightWidth=void 0;if(left.attributes.RESOLUTION&&left.attributes.RESOLUTION.width){leftWidth=left.attributes.RESOLUTION.width}leftWidth=leftWidth||window$3.Number.MAX_VALUE;if(right.attributes.RESOLUTION&&right.attributes.RESOLUTION.width){rightWidth=right.attributes.RESOLUTION.width}rightWidth=rightWidth||window$3.Number.MAX_VALUE;if(leftWidth===rightWidth&&left.attributes.BANDWIDTH&&right.attributes.BANDWIDTH){return left.attributes.BANDWIDTH-right.attributes.BANDWIDTH}return leftWidth-rightWidth},simpleSelector=function(master,playerBandwidth,playerWidth,playerHeight,limitRenditionByPlayerDimensions){var sortedPlaylistReps=master.playlists.map(function(playlist){var width=void 0,height=void 0,bandwidth=void 0;width=playlist.attributes.RESOLUTION&&playlist.attributes.RESOLUTION.width;height=playlist.attributes.RESOLUTION&&playlist.attributes.RESOLUTION.height;bandwidth=playlist.attributes.BANDWIDTH;bandwidth=bandwidth||window$3.Number.MAX_VALUE;return{bandwidth:bandwidth,width:width,height:height,playlist:playlist}});stableSort(sortedPlaylistReps,function(left,right){return left.bandwidth-right.bandwidth});sortedPlaylistReps=sortedPlaylistReps.filter(function(rep){return!Playlist.isIncompatible(rep.playlist)});var enabledPlaylistReps=sortedPlaylistReps.filter(function(rep){return Playlist.isEnabled(rep.playlist)});if(!enabledPlaylistReps.length){enabledPlaylistReps=sortedPlaylistReps.filter(function(rep){return!Playlist.isDisabled(rep.playlist)})}var bandwidthPlaylistReps=enabledPlaylistReps.filter(function(rep){return rep.bandwidth*Config.BANDWIDTH_VARIANCE<playerBandwidth}),highestRemainingBandwidthRep=bandwidthPlaylistReps[bandwidthPlaylistReps.length-1],bandwidthBestRep=bandwidthPlaylistReps.filter(function(rep){return rep.bandwidth===highestRemainingBandwidthRep.bandwidth})[0];if(!1===limitRenditionByPlayerDimensions){var _chosenRep=bandwidthBestRep||enabledPlaylistReps[0]||sortedPlaylistReps[0];return _chosenRep?_chosenRep.playlist:null}var haveResolution=bandwidthPlaylistReps.filter(function(rep){return rep.width&&rep.height});stableSort(haveResolution,function(left,right){return left.width-right.width});var resolutionBestRepList=haveResolution.filter(function(rep){return rep.width===playerWidth&&rep.height===playerHeight});highestRemainingBandwidthRep=resolutionBestRepList[resolutionBestRepList.length-1];var resolutionBestRep=resolutionBestRepList.filter(function(rep){return rep.bandwidth===highestRemainingBandwidthRep.bandwidth})[0],resolutionPlusOneList=void 0,resolutionPlusOneSmallest=void 0,resolutionPlusOneRep=void 0;if(!resolutionBestRep){resolutionPlusOneList=haveResolution.filter(function(rep){return rep.width>playerWidth||rep.height>playerHeight});resolutionPlusOneSmallest=resolutionPlusOneList.filter(function(rep){return rep.width===resolutionPlusOneList[0].width&&rep.height===resolutionPlusOneList[0].height});highestRemainingBandwidthRep=resolutionPlusOneSmallest[resolutionPlusOneSmallest.length-1];resolutionPlusOneRep=resolutionPlusOneSmallest.filter(function(rep){return rep.bandwidth===highestRemainingBandwidthRep.bandwidth})[0]}var chosenRep=resolutionPlusOneRep||resolutionBestRep||bandwidthBestRep||enabledPlaylistReps[0]||sortedPlaylistReps[0];return chosenRep?chosenRep.playlist:null},lastBandwidthSelector=function(){var pixelRatio=this.useDevicePixelRatio?window$3.devicePixelRatio||1:1;return simpleSelector(this.playlists.master,this.systemBandwidth,parseInt(safeGetComputedStyle(this.tech_.el(),"width"),10)*pixelRatio,parseInt(safeGetComputedStyle(this.tech_.el(),"height"),10)*pixelRatio,this.limitRenditionByPlayerDimensions)},minRebufferMaxBandwidthSelector=function(settings){var master=settings.master,currentTime=settings.currentTime,bandwidth=settings.bandwidth,duration$$1=settings.duration,segmentDuration=settings.segmentDuration,timeUntilRebuffer=settings.timeUntilRebuffer,currentTimeline=settings.currentTimeline,syncController=settings.syncController,compatiblePlaylists=master.playlists.filter(function(playlist){return!Playlist.isIncompatible(playlist)}),enabledPlaylists=compatiblePlaylists.filter(Playlist.isEnabled);if(!enabledPlaylists.length){enabledPlaylists=compatiblePlaylists.filter(function(playlist){return!Playlist.isDisabled(playlist)})}var bandwidthPlaylists=enabledPlaylists.filter(Playlist.hasAttribute.bind(null,"BANDWIDTH")),rebufferingEstimates=bandwidthPlaylists.map(function(playlist){var syncPoint=syncController.getSyncPoint(playlist,duration$$1,currentTimeline,currentTime),numRequests=syncPoint?1:2,requestTimeEstimate=Playlist.estimateSegmentRequestTime(segmentDuration,bandwidth,playlist);return{playlist:playlist,rebufferingImpact:requestTimeEstimate*numRequests-timeUntilRebuffer}}),noRebufferingPlaylists=rebufferingEstimates.filter(function(estimate){return 0>=estimate.rebufferingImpact});stableSort(noRebufferingPlaylists,function(a,b){return comparePlaylistBandwidth(b.playlist,a.playlist)});if(noRebufferingPlaylists.length){return noRebufferingPlaylists[0]}stableSort(rebufferingEstimates,function(a,b){return a.rebufferingImpact-b.rebufferingImpact});return rebufferingEstimates[0]||null},createCaptionsTrackIfNotExists=function(inbandTextTracks,tech,captionStreams){for(var trackId in captionStreams){if(!inbandTextTracks[trackId]){tech.trigger({type:"usage",name:"hls-608"});var track=tech.textTracks().getTrackById(trackId);if(track){inbandTextTracks[trackId]=track}else{inbandTextTracks[trackId]=tech.addRemoteTextTrack({kind:"captions",id:trackId,label:trackId},!1).track}}}},addCaptionData=function(_ref){var inbandTextTracks=_ref.inbandTextTracks,captionArray=_ref.captionArray,timestampOffset=_ref.timestampOffset;if(!captionArray){return}var Cue=window.WebKitDataCue||window.VTTCue;captionArray.forEach(function(caption){var track=caption.stream,startTime=caption.startTime,endTime=caption.endTime;if(!inbandTextTracks[track]){return}startTime+=timestampOffset;endTime+=timestampOffset;inbandTextTracks[track].addCue(new Cue(startTime,endTime,caption.text))})},detectEndOfStream=function(playlist,mediaSource,segmentIndex){if(!playlist||!mediaSource){return!1}var segments=playlist.segments,appendedLastSegment=segmentIndex===segments.length;return playlist.endList&&"open"===mediaSource.readyState&&appendedLastSegment},finite=function(num){return"number"==typeof num&&isFinite(num)},illegalMediaSwitch=function(loaderType,startingMedia,newSegmentMedia){if("main"!==loaderType||!startingMedia||!newSegmentMedia){return null}if(!newSegmentMedia.containsAudio&&!newSegmentMedia.containsVideo){return"Neither audio nor video found in segment."}if(startingMedia.containsVideo&&!newSegmentMedia.containsVideo){return"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest."}if(!startingMedia.containsVideo&&newSegmentMedia.containsVideo){return"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest."}return null},safeBackBufferTrimTime=function(seekable$$1,currentTime,targetDuration){var trimTime=currentTime-30;if(seekable$$1.length){trimTime=Math.max(trimTime,seekable$$1.start(0))}return Math.min(currentTime-targetDuration,trimTime)},segmentInfoString=function(segmentInfo){var _segmentInfo$segment=segmentInfo.segment,start=_segmentInfo$segment.start,end=_segmentInfo$segment.end,_segmentInfo$playlist=segmentInfo.playlist,seq=_segmentInfo$playlist.mediaSequence,id=_segmentInfo$playlist.id,_segmentInfo$playlist2=_segmentInfo$playlist.segments,segments=_segmentInfo$playlist2===void 0?[]:_segmentInfo$playlist2,index=segmentInfo.mediaIndex,timeline=segmentInfo.timeline;return["appending ["+index+"] of ["+seq+", "+(seq+segments.length)+"] from playlist ["+id+"]","["+start+" => "+end+"] in timeline ["+timeline+"]"].join(" ")},SegmentLoader=function(_videojs$EventTarget){inherits$1(SegmentLoader,_videojs$EventTarget);function SegmentLoader(settings){classCallCheck(this,SegmentLoader);var _this=possibleConstructorReturn(this,(SegmentLoader.__proto__||Object.getPrototypeOf(SegmentLoader)).call(this));if(!settings){throw new TypeError("Initialization settings are required")}if("function"!=typeof settings.currentTime){throw new TypeError("No currentTime getter specified")}if(!settings.mediaSource){throw new TypeError("No MediaSource specified")}_this.bandwidth=settings.bandwidth;_this.throughput={rate:0,count:0};_this.roundTrip=NaN;_this.resetStats_();_this.mediaIndex=null;_this.hasPlayed_=settings.hasPlayed;_this.currentTime_=settings.currentTime;_this.seekable_=settings.seekable;_this.seeking_=settings.seeking;_this.duration_=settings.duration;_this.mediaSource_=settings.mediaSource;_this.hls_=settings.hls;_this.loaderType_=settings.loaderType;_this.startingMedia_=void 0;_this.segmentMetadataTrack_=settings.segmentMetadataTrack;_this.goalBufferLength_=settings.goalBufferLength;_this.sourceType_=settings.sourceType;_this.inbandTextTracks_=settings.inbandTextTracks;_this.state_="INIT";_this.checkBufferTimeout_=null;_this.error_=void 0;_this.currentTimeline_=-1;_this.pendingSegment_=null;_this.mimeType_=null;_this.sourceUpdater_=null;_this.xhrOptions_=null;_this.activeInitSegmentId_=null;_this.initSegments_={};_this.cacheEncryptionKeys_=settings.cacheEncryptionKeys;_this.keyCache_={};if("main"===_this.loaderType_){_this.captionParser_=new captionParser}else{_this.captionParser_=null}_this.decrypter_=settings.decrypter;_this.syncController_=settings.syncController;_this.syncPoint_={segmentIndex:0,time:0};_this.triggerSyncInfoUpdate_=function(){return _this.trigger("syncinfoupdate")};_this.syncController_.on("syncinfoupdate",_this.triggerSyncInfoUpdate_);_this.mediaSource_.addEventListener("sourceopen",function(){return _this.ended_=!1});_this.fetchAtBuffer_=!1;_this.logger_=logger("SegmentLoader["+_this.loaderType_+"]");Object.defineProperty(_this,"state",{get:function(){return this.state_},set:function(newState){if(newState!==this.state_){this.logger_(this.state_+" -> "+newState);this.state_=newState}}});return _this}createClass$1(SegmentLoader,[{key:"resetStats_",value:function(){this.mediaBytesTransferred=0;this.mediaRequests=0;this.mediaRequestsAborted=0;this.mediaRequestsTimedout=0;this.mediaRequestsErrored=0;this.mediaTransferDuration=0;this.mediaSecondsLoaded=0}},{key:"dispose",value:function(){this.trigger("dispose");this.state="DISPOSED";this.pause();this.abort_();if(this.sourceUpdater_){this.sourceUpdater_.dispose()}this.resetStats_();if(this.captionParser_){this.captionParser_.reset()}if(this.checkBufferTimeout_){window$3.clearTimeout(this.checkBufferTimeout_)}if(this.syncController_&&this.triggerSyncInfoUpdate_){this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_)}this.off()}},{key:"abort",value:function(){if("WAITING"!==this.state){if(this.pendingSegment_){this.pendingSegment_=null}return}this.abort_();this.state="READY";if(!this.paused()){this.monitorBuffer_()}}},{key:"abort_",value:function(){if(this.pendingSegment_){this.pendingSegment_.abortRequests()}this.pendingSegment_=null}},{key:"error",value:function(_error){if("undefined"!=typeof _error){this.error_=_error}this.pendingSegment_=null;return this.error_}},{key:"endOfStream",value:function(){this.ended_=!0;this.pause();this.trigger("ended")}},{key:"buffered_",value:function(){if(!this.sourceUpdater_){return videojs$1.createTimeRanges()}return this.sourceUpdater_.buffered()}},{key:"initSegment",value:function(map){var set$$1=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1;if(!map){return null}var id=initSegmentId(map),storedMap=this.initSegments_[id];if(set$$1&&!storedMap&&map.bytes){this.initSegments_[id]=storedMap={resolvedUri:map.resolvedUri,byterange:map.byterange,bytes:map.bytes,timescales:map.timescales,videoTrackIds:map.videoTrackIds}}return storedMap||map}},{key:"segmentKey",value:function(key){var set$$1=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1;if(!key){return null}var id=segmentKeyId(key),storedKey=this.keyCache_[id];if(this.cacheEncryptionKeys_&&set$$1&&!storedKey&&key.bytes){this.keyCache_[id]=storedKey={resolvedUri:key.resolvedUri,bytes:key.bytes}}var result={resolvedUri:(storedKey||key).resolvedUri};if(storedKey){result.bytes=storedKey.bytes}return result}},{key:"couldBeginLoading_",value:function(){return this.playlist_&&(this.sourceUpdater_||this.mimeType_&&"INIT"===this.state)&&!this.paused()}},{key:"load",value:function(){this.monitorBuffer_();if(!this.playlist_){return}this.syncController_.setDateTimeMapping(this.playlist_);if("INIT"===this.state&&this.couldBeginLoading_()){return this.init_()}if(!this.couldBeginLoading_()||"READY"!==this.state&&"INIT"!==this.state){return}this.state="READY"}},{key:"init_",value:function(){this.state="READY";this.sourceUpdater_=new SourceUpdater(this.mediaSource_,this.mimeType_,this.loaderType_,this.sourceBufferEmitter_);this.resetEverything();return this.monitorBuffer_()}},{key:"playlist",value:function(newPlaylist){var options=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(!newPlaylist){return}var oldPlaylist=this.playlist_,segmentInfo=this.pendingSegment_;this.playlist_=newPlaylist;this.xhrOptions_=options;if("INIT"===this.state){newPlaylist.syncInfo={mediaSequence:newPlaylist.mediaSequence,time:0}}var oldId=null;if(oldPlaylist){if(oldPlaylist.id){oldId=oldPlaylist.id}else if(oldPlaylist.uri){oldId=oldPlaylist.uri}}this.logger_("playlist update ["+oldId+" => "+(newPlaylist.id||newPlaylist.uri)+"]");this.trigger("syncinfoupdate");if("INIT"===this.state&&this.couldBeginLoading_()){return this.init_()}if(!oldPlaylist||oldPlaylist.uri!==newPlaylist.uri){if(null!==this.mediaIndex){this.resyncLoader()}return}var mediaSequenceDiff=newPlaylist.mediaSequence-oldPlaylist.mediaSequence;this.logger_("live window shift ["+mediaSequenceDiff+"]");if(null!==this.mediaIndex){this.mediaIndex-=mediaSequenceDiff}if(segmentInfo){segmentInfo.mediaIndex-=mediaSequenceDiff;if(0<=segmentInfo.mediaIndex){segmentInfo.segment=newPlaylist.segments[segmentInfo.mediaIndex]}}this.syncController_.saveExpiredSegmentInfo(oldPlaylist,newPlaylist)}},{key:"pause",value:function(){if(this.checkBufferTimeout_){window$3.clearTimeout(this.checkBufferTimeout_);this.checkBufferTimeout_=null}}},{key:"paused",value:function(){return null===this.checkBufferTimeout_}},{key:"mimeType",value:function(_mimeType,sourceBufferEmitter){if(this.mimeType_){return}this.mimeType_=_mimeType;this.sourceBufferEmitter_=sourceBufferEmitter;if("INIT"===this.state&&this.couldBeginLoading_()){this.init_()}}},{key:"resetEverything",value:function(done){this.ended_=!1;this.resetLoader();this.remove(0,1/0,done);if(this.captionParser_){this.captionParser_.clearAllCaptions()}this.trigger("reseteverything")}},{key:"resetLoader",value:function(){this.fetchAtBuffer_=!1;this.resyncLoader()}},{key:"resyncLoader",value:function(){this.mediaIndex=null;this.syncPoint_=null;this.abort()}},{key:"remove",value:function(start,end,done){if(end===1/0){end=this.duration_()}if(this.sourceUpdater_){this.sourceUpdater_.remove(start,end,done)}removeCuesFromTrack(start,end,this.segmentMetadataTrack_);if(this.inbandTextTracks_){for(var id in this.inbandTextTracks_){removeCuesFromTrack(start,end,this.inbandTextTracks_[id])}}}},{key:"monitorBuffer_",value:function(){if(this.checkBufferTimeout_){window$3.clearTimeout(this.checkBufferTimeout_)}this.checkBufferTimeout_=window$3.setTimeout(this.monitorBufferTick_.bind(this),1)}},{key:"monitorBufferTick_",value:function(){if("READY"===this.state){this.fillBuffer_()}if(this.checkBufferTimeout_){window$3.clearTimeout(this.checkBufferTimeout_)}this.checkBufferTimeout_=window$3.setTimeout(this.monitorBufferTick_.bind(this),500)}},{key:"fillBuffer_",value:function(){if(this.sourceUpdater_.updating()){return}if(!this.syncPoint_){this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_())}var segmentInfo=this.checkBuffer_(this.buffered_(),this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_);if(!segmentInfo){return}if(this.isEndOfStream_(segmentInfo.mediaIndex)){this.endOfStream();return}if(segmentInfo.mediaIndex===this.playlist_.segments.length-1&&"ended"===this.mediaSource_.readyState&&!this.seeking_()){return}if(segmentInfo.timeline!==this.currentTimeline_){this.syncController_.reset();segmentInfo.timestampOffset=segmentInfo.startOfSegment;if(this.captionParser_){this.captionParser_.clearAllCaptions()}}this.loadSegment_(segmentInfo)}},{key:"isEndOfStream_",value:function(mediaIndex){var playlist=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.playlist_;return detectEndOfStream(playlist,this.mediaSource_,mediaIndex)&&!this.sourceUpdater_.updating()}},{key:"checkBuffer_",value:function(buffered,playlist,mediaIndex,hasPlayed,currentTime,syncPoint){var lastBufferedEnd=0,startOfSegment=void 0;if(buffered.length){lastBufferedEnd=buffered.end(buffered.length-1)}var bufferedTime=Math.max(0,lastBufferedEnd-currentTime);if(!playlist.segments.length){return null}if(bufferedTime>=this.goalBufferLength_()){return null}if(!hasPlayed&&1<=bufferedTime){return null}if(null===syncPoint){mediaIndex=this.getSyncSegmentCandidate_(playlist);return this.generateSegmentInfo_(playlist,mediaIndex,null,!0)}if(null!==mediaIndex){playlist.segments[mediaIndex];startOfSegment=lastBufferedEnd;return this.generateSegmentInfo_(playlist,mediaIndex+1,startOfSegment,!1)}if(this.fetchAtBuffer_){var mediaSourceInfo=Playlist.getMediaInfoForTime(playlist,lastBufferedEnd,syncPoint.segmentIndex,syncPoint.time);mediaIndex=mediaSourceInfo.mediaIndex;startOfSegment=mediaSourceInfo.startTime}else{var _mediaSourceInfo=Playlist.getMediaInfoForTime(playlist,currentTime,syncPoint.segmentIndex,syncPoint.time);mediaIndex=_mediaSourceInfo.mediaIndex;startOfSegment=_mediaSourceInfo.startTime}return this.generateSegmentInfo_(playlist,mediaIndex,startOfSegment,!1)}},{key:"getSyncSegmentCandidate_",value:function(playlist){var _this2=this;if(-1===this.currentTimeline_){return 0}var segmentIndexArray=playlist.segments.map(function(s,i){return{timeline:s.timeline,segmentIndex:i}}).filter(function(s){return s.timeline===_this2.currentTimeline_});if(segmentIndexArray.length){return segmentIndexArray[Math.min(segmentIndexArray.length-1,1)].segmentIndex}return Math.max(playlist.segments.length-1,0)}},{key:"generateSegmentInfo_",value:function(playlist,mediaIndex,startOfSegment,isSyncRequest){if(0>mediaIndex||mediaIndex>=playlist.segments.length){return null}var segment=playlist.segments[mediaIndex];return{requestId:"segment-loader-"+Math.random(),uri:segment.resolvedUri,mediaIndex:mediaIndex,isSyncRequest:isSyncRequest,startOfSegment:startOfSegment,playlist:playlist,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:segment.timeline,duration:segment.duration,segment:segment}}},{key:"abortRequestEarly_",value:function(stats){if(this.hls_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH){return!1}if(1e3>Date.now()-(stats.firstBytesReceivedAt||Date.now())){return!1}var currentTime=this.currentTime_(),measuredBandwidth=stats.bandwidth,segmentDuration=this.pendingSegment_.duration,requestTimeRemaining=Playlist.estimateSegmentRequestTime(segmentDuration,measuredBandwidth,this.playlist_,stats.bytesReceived),timeUntilRebuffer$$1=timeUntilRebuffer(this.buffered_(),currentTime,this.hls_.tech_.playbackRate())-1;if(requestTimeRemaining<=timeUntilRebuffer$$1){return!1}var switchCandidate=minRebufferMaxBandwidthSelector({master:this.hls_.playlists.master,currentTime:currentTime,bandwidth:measuredBandwidth,duration:this.duration_(),segmentDuration:segmentDuration,timeUntilRebuffer:timeUntilRebuffer$$1,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(!switchCandidate){return}var timeSavedBySwitching=requestTimeRemaining-timeUntilRebuffer$$1-switchCandidate.rebufferingImpact,minimumTimeSaving=.5;if(timeUntilRebuffer$$1<=TIME_FUDGE_FACTOR){minimumTimeSaving=1}if(!switchCandidate.playlist||switchCandidate.playlist.uri===this.playlist_.uri||timeSavedBySwitching<minimumTimeSaving){return!1}this.bandwidth=switchCandidate.playlist.attributes.BANDWIDTH*Config.BANDWIDTH_VARIANCE+1;this.abort();this.trigger("earlyabort");return!0}},{key:"handleProgress_",value:function(event,simpleSegment){if(!this.pendingSegment_||simpleSegment.requestId!==this.pendingSegment_.requestId||this.abortRequestEarly_(simpleSegment.stats)){return}this.trigger("progress")}},{key:"loadSegment_",value:function(segmentInfo){this.state="WAITING";this.pendingSegment_=segmentInfo;this.trimBackBuffer_(segmentInfo);segmentInfo.abortRequests=mediaSegmentRequest(this.hls_.xhr,this.xhrOptions_,this.decrypter_,this.captionParser_,this.createSimplifiedSegmentObj_(segmentInfo),this.handleProgress_.bind(this),this.segmentRequestFinished_.bind(this))}},{key:"trimBackBuffer_",value:function(){var removeToTime=safeBackBufferTrimTime(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);if(0<removeToTime){this.remove(0,removeToTime)}}},{key:"createSimplifiedSegmentObj_",value:function(segmentInfo){var segment=segmentInfo.segment,simpleSegment={resolvedUri:segment.resolvedUri,byterange:segment.byterange,requestId:segmentInfo.requestId};if(segment.key){var iv=segment.key.iv||new Uint32Array([0,0,0,segmentInfo.mediaIndex+segmentInfo.playlist.mediaSequence]);simpleSegment.key=this.segmentKey(segment.key);simpleSegment.key.iv=iv}if(segment.map){simpleSegment.map=this.initSegment(segment.map)}return simpleSegment}},{key:"segmentRequestFinished_",value:function(error,simpleSegment){this.mediaRequests+=1;if(simpleSegment.stats){this.mediaBytesTransferred+=simpleSegment.stats.bytesReceived;this.mediaTransferDuration+=simpleSegment.stats.roundTripTime}if(!this.pendingSegment_){this.mediaRequestsAborted+=1;return}if(simpleSegment.requestId!==this.pendingSegment_.requestId){return}if(error){this.pendingSegment_=null;this.state="READY";if(error.code===REQUEST_ERRORS.ABORTED){this.mediaRequestsAborted+=1;return}this.pause();if(error.code===REQUEST_ERRORS.TIMEOUT){this.mediaRequestsTimedout+=1;this.bandwidth=1;this.roundTrip=NaN;this.trigger("bandwidthupdate");return}this.mediaRequestsErrored+=1;this.error(error);this.trigger("error");return}this.bandwidth=simpleSegment.stats.bandwidth;this.roundTrip=simpleSegment.stats.roundTripTime;if(simpleSegment.map){simpleSegment.map=this.initSegment(simpleSegment.map,!0)}if(simpleSegment.key){this.segmentKey(simpleSegment.key,!0)}this.processSegmentResponse_(simpleSegment)}},{key:"processSegmentResponse_",value:function(simpleSegment){var segmentInfo=this.pendingSegment_;segmentInfo.bytes=simpleSegment.bytes;if(simpleSegment.map){segmentInfo.segment.map.bytes=simpleSegment.map.bytes}segmentInfo.endOfAllRequests=simpleSegment.endOfAllRequests;if(simpleSegment.fmp4Captions){createCaptionsTrackIfNotExists(this.inbandTextTracks_,this.hls_.tech_,simpleSegment.captionStreams);addCaptionData({inbandTextTracks:this.inbandTextTracks_,captionArray:simpleSegment.fmp4Captions,timestampOffset:0});if(this.captionParser_){this.captionParser_.clearParsedCaptions()}}this.handleSegment_()}},{key:"handleSegment_",value:function(){var _this3=this;if(!this.pendingSegment_){this.state="READY";return}var segmentInfo=this.pendingSegment_,segment=segmentInfo.segment,timingInfo=this.syncController_.probeSegmentInfo(segmentInfo);if("undefined"==typeof this.startingMedia_&&timingInfo&&(timingInfo.containsAudio||timingInfo.containsVideo)){this.startingMedia_={containsAudio:timingInfo.containsAudio,containsVideo:timingInfo.containsVideo}}var illegalMediaSwitchError=illegalMediaSwitch(this.loaderType_,this.startingMedia_,timingInfo);if(illegalMediaSwitchError){this.error({message:illegalMediaSwitchError,blacklistDuration:1/0});this.trigger("error");return}if(segmentInfo.isSyncRequest){this.trigger("syncinfoupdate");this.pendingSegment_=null;this.state="READY";return}if(null!==segmentInfo.timestampOffset&&segmentInfo.timestampOffset!==this.sourceUpdater_.timestampOffset()){if(timingInfo&&timingInfo.segmentTimestampInfo){var ptsStartTime=timingInfo.segmentTimestampInfo[0].ptsTime,dtsStartTime=timingInfo.segmentTimestampInfo[0].dtsTime;segmentInfo.timestampOffset-=ptsStartTime-dtsStartTime}this.sourceUpdater_.timestampOffset(segmentInfo.timestampOffset);this.trigger("timestampoffset")}var timelineMapping=this.syncController_.mappingForTimeline(segmentInfo.timeline);if(null!==timelineMapping){this.trigger({type:"segmenttimemapping",mapping:timelineMapping})}this.state="APPENDING";if(segment.map){var initId=initSegmentId(segment.map);if(!this.activeInitSegmentId_||this.activeInitSegmentId_!==initId){var initSegment=this.initSegment(segment.map);this.sourceUpdater_.appendBuffer({bytes:initSegment.bytes},function(){_this3.activeInitSegmentId_=initId})}}segmentInfo.byteLength=segmentInfo.bytes.byteLength;if("number"==typeof segment.start&&"number"==typeof segment.end){this.mediaSecondsLoaded+=segment.end-segment.start}else{this.mediaSecondsLoaded+=segment.duration}this.logger_(segmentInfoString(segmentInfo));this.sourceUpdater_.appendBuffer({bytes:segmentInfo.bytes,videoSegmentTimingInfoCallback:this.handleVideoSegmentTimingInfo_.bind(this,segmentInfo.requestId)},this.handleUpdateEnd_.bind(this))}},{key:"handleVideoSegmentTimingInfo_",value:function(requestId,event){if(!this.pendingSegment_||requestId!==this.pendingSegment_.requestId){return}var segment=this.pendingSegment_.segment;if(!segment.videoTimingInfo){segment.videoTimingInfo={}}segment.videoTimingInfo.transmuxerPrependedSeconds=event.videoSegmentTimingInfo.prependedContentDuration||0;segment.videoTimingInfo.transmuxedPresentationStart=event.videoSegmentTimingInfo.start.presentation;segment.videoTimingInfo.transmuxedPresentationEnd=event.videoSegmentTimingInfo.end.presentation;segment.videoTimingInfo.baseMediaDecodeTime=event.videoSegmentTimingInfo.baseMediaDecodeTime}},{key:"handleUpdateEnd_",value:function(){if(!this.pendingSegment_){this.state="READY";if(!this.paused()){this.monitorBuffer_()}return}var segmentInfo=this.pendingSegment_,segment=segmentInfo.segment,isWalkingForward=null!==this.mediaIndex;this.pendingSegment_=null;this.recordThroughput_(segmentInfo);this.addSegmentMetadataCue_(segmentInfo);this.state="READY";this.mediaIndex=segmentInfo.mediaIndex;this.fetchAtBuffer_=!0;this.currentTimeline_=segmentInfo.timeline;this.trigger("syncinfoupdate");if(segment.end&&this.currentTime_()-segment.end>3*segmentInfo.playlist.targetDuration){this.resetEverything();return}if(isWalkingForward){this.trigger("bandwidthupdate")}this.trigger("progress");if(this.isEndOfStream_(segmentInfo.mediaIndex+1,segmentInfo.playlist)){this.endOfStream()}if(!this.paused()){this.monitorBuffer_()}}},{key:"recordThroughput_",value:function(segmentInfo){var rate=this.throughput.rate,segmentProcessingTime=Date.now()-segmentInfo.endOfAllRequests+1,segmentProcessingThroughput=Math.floor(1e3*(8*(segmentInfo.byteLength/segmentProcessingTime)));this.throughput.rate+=(segmentProcessingThroughput-rate)/++this.throughput.count}},{key:"addSegmentMetadataCue_",value:function(segmentInfo){if(!this.segmentMetadataTrack_){return}var segment=segmentInfo.segment,start=segment.start,end=segment.end;if(!finite(start)||!finite(end)){return}removeCuesFromTrack(start,end,this.segmentMetadataTrack_);var Cue=window$3.WebKitDataCue||window$3.VTTCue,value={custom:segment.custom,dateTimeObject:segment.dateTimeObject,dateTimeString:segment.dateTimeString,bandwidth:segmentInfo.playlist.attributes.BANDWIDTH,resolution:segmentInfo.playlist.attributes.RESOLUTION,codecs:segmentInfo.playlist.attributes.CODECS,byteLength:segmentInfo.byteLength,uri:segmentInfo.uri,timeline:segmentInfo.timeline,playlist:segmentInfo.playlist.id,start:start,end:end},data=JSON.stringify(value),cue=new Cue(start,end,data);cue.value=value;this.segmentMetadataTrack_.addCue(cue)}}]);return SegmentLoader}(videojs$1.EventTarget),uint8ToUtf8=function(uintArray){return decodeURIComponent(escape(String.fromCharCode.apply(null,uintArray)))},VTT_LINE_TERMINATORS=new Uint8Array(["\n","\n"].map(function(_char2){return _char2.charCodeAt(0)})),VTTSegmentLoader=function(_SegmentLoader){inherits$1(VTTSegmentLoader,_SegmentLoader);function VTTSegmentLoader(settings){var options=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};classCallCheck(this,VTTSegmentLoader);var _this=possibleConstructorReturn(this,(VTTSegmentLoader.__proto__||Object.getPrototypeOf(VTTSegmentLoader)).call(this,settings,options));_this.mediaSource_=null;_this.subtitlesTrack_=null;_this.featuresNativeTextTracks_=settings.featuresNativeTextTracks;return _this}createClass$1(VTTSegmentLoader,[{key:"buffered_",value:function(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues.length){return videojs$1.createTimeRanges()}var cues=this.subtitlesTrack_.cues,start=cues[0].startTime,end=cues[cues.length-1].startTime;return videojs$1.createTimeRanges([[start,end]])}},{key:"initSegment",value:function(map){var set$$1=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1;if(!map){return null}var id=initSegmentId(map),storedMap=this.initSegments_[id];if(set$$1&&!storedMap&&map.bytes){var combinedByteLength=VTT_LINE_TERMINATORS.byteLength+map.bytes.byteLength,combinedSegment=new Uint8Array(combinedByteLength);combinedSegment.set(map.bytes);combinedSegment.set(VTT_LINE_TERMINATORS,map.bytes.byteLength);this.initSegments_[id]=storedMap={resolvedUri:map.resolvedUri,byterange:map.byterange,bytes:combinedSegment}}return storedMap||map}},{key:"couldBeginLoading_",value:function(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}},{key:"init_",value:function(){this.state="READY";this.resetEverything();return this.monitorBuffer_()}},{key:"track",value:function(_track){if("undefined"==typeof _track){return this.subtitlesTrack_}this.subtitlesTrack_=_track;if("INIT"===this.state&&this.couldBeginLoading_()){this.init_()}return this.subtitlesTrack_}},{key:"remove",value:function(start,end){removeCuesFromTrack(start,end,this.subtitlesTrack_)}},{key:"fillBuffer_",value:function(){var _this2=this;if(!this.syncPoint_){this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_())}var segmentInfo=this.checkBuffer_(this.buffered_(),this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_);segmentInfo=this.skipEmptySegments_(segmentInfo);if(!segmentInfo){return}if(null===this.syncController_.timestampOffsetForTimeline(segmentInfo.timeline)){var checkTimestampOffset=function(){_this2.state="READY";if(!_this2.paused()){_this2.monitorBuffer_()}};this.syncController_.one("timestampoffset",checkTimestampOffset);this.state="WAITING_ON_TIMELINE";return}this.loadSegment_(segmentInfo)}},{key:"skipEmptySegments_",value:function(segmentInfo){while(segmentInfo&&segmentInfo.segment.empty){segmentInfo=this.generateSegmentInfo_(segmentInfo.playlist,segmentInfo.mediaIndex+1,segmentInfo.startOfSegment+segmentInfo.duration,segmentInfo.isSyncRequest)}return segmentInfo}},{key:"handleSegment_",value:function(){var _this3=this;if(!this.pendingSegment_||!this.subtitlesTrack_){this.state="READY";return}this.state="APPENDING";var segmentInfo=this.pendingSegment_,segment=segmentInfo.segment;if("function"!=typeof window$3.WebVTT&&this.subtitlesTrack_&&this.subtitlesTrack_.tech_){var loadHandler=void 0,errorHandler=function(){_this3.subtitlesTrack_.tech_.off("vttjsloaded",loadHandler);_this3.error({message:"Error loading vtt.js"});_this3.state="READY";_this3.pause();_this3.trigger("error")};loadHandler=function(){_this3.subtitlesTrack_.tech_.off("vttjserror",errorHandler);_this3.handleSegment_()};this.state="WAITING_ON_VTTJS";this.subtitlesTrack_.tech_.one("vttjsloaded",loadHandler);this.subtitlesTrack_.tech_.one("vttjserror",errorHandler);return}segment.requested=!0;try{this.parseVTTCues_(segmentInfo)}catch(e){this.error({message:e.message});this.state="READY";this.pause();return this.trigger("error")}this.updateTimeMapping_(segmentInfo,this.syncController_.timelines[segmentInfo.timeline],this.playlist_);if(segmentInfo.isSyncRequest){this.trigger("syncinfoupdate");this.pendingSegment_=null;this.state="READY";return}segmentInfo.byteLength=segmentInfo.bytes.byteLength;this.mediaSecondsLoaded+=segment.duration;if(segmentInfo.cues.length){this.remove(segmentInfo.cues[0].endTime,segmentInfo.cues[segmentInfo.cues.length-1].endTime)}segmentInfo.cues.forEach(function(cue){_this3.subtitlesTrack_.addCue(_this3.featuresNativeTextTracks_?new window$3.VTTCue(cue.startTime,cue.endTime,cue.text):cue)});this.handleUpdateEnd_()}},{key:"parseVTTCues_",value:function(segmentInfo){var decoder=void 0,decodeBytesToString=!1;if("function"==typeof window$3.TextDecoder){decoder=new window$3.TextDecoder("utf8")}else{decoder=window$3.WebVTT.StringDecoder();decodeBytesToString=!0}var parser=new window$3.WebVTT.Parser(window$3,window$3.vttjs,decoder);segmentInfo.cues=[];segmentInfo.timestampmap={MPEGTS:0,LOCAL:0};parser.oncue=segmentInfo.cues.push.bind(segmentInfo.cues);parser.ontimestampmap=function(map){return segmentInfo.timestampmap=map};parser.onparsingerror=function(error){videojs$1.log.warn("Error encountered when parsing cues: "+error.message)};if(segmentInfo.segment.map){var mapData=segmentInfo.segment.map.bytes;if(decodeBytesToString){mapData=uint8ToUtf8(mapData)}parser.parse(mapData)}var segmentData=segmentInfo.bytes;if(decodeBytesToString){segmentData=uint8ToUtf8(segmentData)}parser.parse(segmentData);parser.flush()}},{key:"updateTimeMapping_",value:function(segmentInfo,mappingObj,playlist){var segment=segmentInfo.segment;if(!mappingObj){return}if(!segmentInfo.cues.length){segment.empty=!0;return}var timestampmap=segmentInfo.timestampmap,diff=timestampmap.MPEGTS/9e4-timestampmap.LOCAL+mappingObj.mapping;segmentInfo.cues.forEach(function(cue){cue.startTime+=diff;cue.endTime+=diff});if(!playlist.syncInfo){var firstStart=segmentInfo.cues[0].startTime,lastStart=segmentInfo.cues[segmentInfo.cues.length-1].startTime;playlist.syncInfo={mediaSequence:playlist.mediaSequence+segmentInfo.mediaIndex,time:Math.min(firstStart,lastStart-segment.duration)}}}}]);return VTTSegmentLoader}(SegmentLoader),findAdCue=function(track,mediaTime){for(var cues=track.cues,i=0,cue;i<cues.length;i++){cue=cues[i];if(mediaTime>=cue.adStartTime&&mediaTime<=cue.adEndTime){return cue}}return null},updateAdCues=function(media,track){var offset=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;if(!media.segments){return}for(var mediaTime=offset,cue=void 0,i=0,segment;i<media.segments.length;i++){segment=media.segments[i];if(!cue){cue=findAdCue(track,mediaTime+segment.duration/2)}if(cue){if("cueIn"in segment){cue.endTime=mediaTime;cue.adEndTime=mediaTime;mediaTime+=segment.duration;cue=null;continue}if(mediaTime<cue.endTime){mediaTime+=segment.duration;continue}cue.endTime+=segment.duration}else{if("cueOut"in segment){cue=new window$3.VTTCue(mediaTime,mediaTime+segment.duration,segment.cueOut);cue.adStartTime=mediaTime;cue.adEndTime=mediaTime+parseFloat(segment.cueOut);track.addCue(cue)}if("cueOutCont"in segment){var adOffset=void 0,adTotal=void 0,_segment$cueOutCont$s=segment.cueOutCont.split("/").map(parseFloat),_segment$cueOutCont$s2=slicedToArray(_segment$cueOutCont$s,2);adOffset=_segment$cueOutCont$s2[0];adTotal=_segment$cueOutCont$s2[1];cue=new window$3.VTTCue(mediaTime,mediaTime+segment.duration,"");cue.adStartTime=mediaTime-adOffset;cue.adEndTime=cue.adStartTime+adTotal;track.addCue(cue)}}mediaTime+=segment.duration}},tsprobe={inspect:function(bytes,baseTimestamp){var isAacData=probe$2.aac.isLikelyAacData(bytes),result;if(isAacData){result=inspectAac_(bytes)}else{result=inspectTs_(bytes)}if(!result||!result.audio&&!result.video){return null}adjustTimestamp_(result,baseTimestamp);return result},parseAudioPes_:parseAudioPes_}.inspect,syncPointStrategies=[{name:"VOD",run:function(syncController,playlist,duration$$1){if(duration$$1!==1/0){return{time:0,segmentIndex:0}}return null}},{name:"ProgramDateTime",run:function(syncController,playlist,duration$$1,currentTimeline,currentTime){if(!syncController.datetimeToDisplayTime){return null}var segments=playlist.segments||[],syncPoint=null,lastDistance=null;currentTime=currentTime||0;for(var i=0,segment;i<segments.length;i++){segment=segments[i];if(segment.dateTimeObject){var segmentTime=segment.dateTimeObject.getTime()/1e3,segmentStart=segmentTime+syncController.datetimeToDisplayTime,distance=Math.abs(currentTime-segmentStart);if(null!==lastDistance&&(0===distance||lastDistance<distance)){break}lastDistance=distance;syncPoint={time:segmentStart,segmentIndex:i}}}return syncPoint}},{name:"Segment",run:function(syncController,playlist,duration$$1,currentTimeline,currentTime){var segments=playlist.segments||[],syncPoint=null,lastDistance=null;currentTime=currentTime||0;for(var i=0,segment;i<segments.length;i++){segment=segments[i];if(segment.timeline===currentTimeline&&"undefined"!=typeof segment.start){var distance=Math.abs(currentTime-segment.start);if(null!==lastDistance&&lastDistance<distance){break}if(!syncPoint||null===lastDistance||lastDistance>=distance){lastDistance=distance;syncPoint={time:segment.start,segmentIndex:i}}}}return syncPoint}},{name:"Discontinuity",run:function(syncController,playlist,duration$$1,currentTimeline,currentTime){var syncPoint=null;currentTime=currentTime||0;if(playlist.discontinuityStarts&&playlist.discontinuityStarts.length){for(var lastDistance=null,i=0;i<playlist.discontinuityStarts.length;i++){var segmentIndex=playlist.discontinuityStarts[i],discontinuity=playlist.discontinuitySequence+i+1,discontinuitySync=syncController.discontinuities[discontinuity];if(discontinuitySync){var distance=Math.abs(currentTime-discontinuitySync.time);if(null!==lastDistance&&lastDistance<distance){break}if(!syncPoint||null===lastDistance||lastDistance>=distance){lastDistance=distance;syncPoint={time:discontinuitySync.time,segmentIndex:segmentIndex}}}}}return syncPoint}},{name:"Playlist",run:function(syncController,playlist){if(playlist.syncInfo){var syncPoint={time:playlist.syncInfo.time,segmentIndex:playlist.syncInfo.mediaSequence-playlist.mediaSequence};return syncPoint}return null}}],SyncController=function(_videojs$EventTarget){inherits$1(SyncController,_videojs$EventTarget);function SyncController(){classCallCheck(this,SyncController);var _this=possibleConstructorReturn(this,(SyncController.__proto__||Object.getPrototypeOf(SyncController)).call(this));_this.inspectCache_=void 0;_this.timelines=[];_this.discontinuities=[];_this.datetimeToDisplayTime=null;_this.logger_=logger("SyncController");return _this}createClass$1(SyncController,[{key:"getSyncPoint",value:function(playlist,duration$$1,currentTimeline,currentTime){var syncPoints=this.runStrategies_(playlist,duration$$1,currentTimeline,currentTime);if(!syncPoints.length){return null}return this.selectSyncPoint_(syncPoints,{key:"time",value:currentTime})}},{key:"getExpiredTime",value:function(playlist,duration$$1){if(!playlist||!playlist.segments){return null}var syncPoints=this.runStrategies_(playlist,duration$$1,playlist.discontinuitySequence,0);if(!syncPoints.length){return null}var syncPoint=this.selectSyncPoint_(syncPoints,{key:"segmentIndex",value:0});if(0<syncPoint.segmentIndex){syncPoint.time*=-1}return Math.abs(syncPoint.time+sumDurations(playlist,syncPoint.segmentIndex,0))}},{key:"runStrategies_",value:function(playlist,duration$$1,currentTimeline,currentTime){for(var syncPoints=[],i=0;i<syncPointStrategies.length;i++){var strategy=syncPointStrategies[i],syncPoint=strategy.run(this,playlist,duration$$1,currentTimeline,currentTime);if(syncPoint){syncPoint.strategy=strategy.name;syncPoints.push({strategy:strategy.name,syncPoint:syncPoint})}}return syncPoints}},{key:"selectSyncPoint_",value:function(syncPoints,target){for(var bestSyncPoint=syncPoints[0].syncPoint,bestDistance=Math.abs(syncPoints[0].syncPoint[target.key]-target.value),bestStrategy=syncPoints[0].strategy,i=1,newDistance;i<syncPoints.length;i++){newDistance=Math.abs(syncPoints[i].syncPoint[target.key]-target.value);if(newDistance<bestDistance){bestDistance=newDistance;bestSyncPoint=syncPoints[i].syncPoint;bestStrategy=syncPoints[i].strategy}}this.logger_("syncPoint for ["+target.key+": "+target.value+"] chosen with strategy"+(" ["+bestStrategy+"]: [time:"+bestSyncPoint.time+",")+(" segmentIndex:"+bestSyncPoint.segmentIndex+"]"));return bestSyncPoint}},{key:"saveExpiredSegmentInfo",value:function(oldPlaylist,newPlaylist){for(var mediaSequenceDiff=newPlaylist.mediaSequence-oldPlaylist.mediaSequence,i=mediaSequenceDiff-1,lastRemovedSegment;0<=i;i--){lastRemovedSegment=oldPlaylist.segments[i];if(lastRemovedSegment&&"undefined"!=typeof lastRemovedSegment.start){newPlaylist.syncInfo={mediaSequence:oldPlaylist.mediaSequence+i,time:lastRemovedSegment.start};this.logger_("playlist refresh sync: [time:"+newPlaylist.syncInfo.time+","+(" mediaSequence: "+newPlaylist.syncInfo.mediaSequence+"]"));this.trigger("syncinfoupdate");break}}}},{key:"setDateTimeMapping",value:function(playlist){if(!this.datetimeToDisplayTime&&playlist.segments&&playlist.segments.length&&playlist.segments[0].dateTimeObject){var playlistTimestamp=playlist.segments[0].dateTimeObject.getTime()/1e3;this.datetimeToDisplayTime=-playlistTimestamp}}},{key:"reset",value:function(){this.inspectCache_=void 0}},{key:"probeSegmentInfo",value:function(segmentInfo){var segment=segmentInfo.segment,playlist=segmentInfo.playlist,timingInfo=void 0;if(segment.map){timingInfo=this.probeMp4Segment_(segmentInfo)}else{timingInfo=this.probeTsSegment_(segmentInfo)}if(timingInfo){if(this.calculateSegmentTimeMapping_(segmentInfo,timingInfo)){this.saveDiscontinuitySyncInfo_(segmentInfo);if(!playlist.syncInfo){playlist.syncInfo={mediaSequence:playlist.mediaSequence+segmentInfo.mediaIndex,time:segment.start}}}}return timingInfo}},{key:"probeMp4Segment_",value:function(segmentInfo){var segment=segmentInfo.segment,timescales=probe.timescale(segment.map.bytes),compositionStartTime=probe.compositionStartTime(timescales,segmentInfo.bytes);if(null!==segmentInfo.timestampOffset){segmentInfo.timestampOffset-=compositionStartTime}return{start:compositionStartTime,end:compositionStartTime+segment.duration}}},{key:"probeTsSegment_",value:function(segmentInfo){var timeInfo=tsprobe(segmentInfo.bytes,this.inspectCache_),segmentStartTime=void 0,segmentEndTime=void 0,segmentTimestampInfo=void 0;if(!timeInfo){return null}if(timeInfo.video&&2===timeInfo.video.length){this.inspectCache_=timeInfo.video[1].dts;segmentStartTime=timeInfo.video[0].dtsTime;segmentEndTime=timeInfo.video[1].dtsTime;segmentTimestampInfo=timeInfo.video}else if(timeInfo.audio&&2===timeInfo.audio.length){this.inspectCache_=timeInfo.audio[1].dts;segmentStartTime=timeInfo.audio[0].dtsTime;segmentEndTime=timeInfo.audio[1].dtsTime;segmentTimestampInfo=timeInfo.audio}var probedInfo={segmentTimestampInfo:segmentTimestampInfo,start:segmentStartTime,end:segmentEndTime,containsVideo:timeInfo.video&&2===timeInfo.video.length,containsAudio:timeInfo.audio&&2===timeInfo.audio.length};return probedInfo}},{key:"timestampOffsetForTimeline",value:function(timeline){if("undefined"==typeof this.timelines[timeline]){return null}return this.timelines[timeline].time}},{key:"mappingForTimeline",value:function(timeline){if("undefined"==typeof this.timelines[timeline]){return null}return this.timelines[timeline].mapping}},{key:"calculateSegmentTimeMapping_",value:function(segmentInfo,timingInfo){var segment=segmentInfo.segment,mappingObj=this.timelines[segmentInfo.timeline];if(null!==segmentInfo.timestampOffset){mappingObj={time:segmentInfo.startOfSegment,mapping:segmentInfo.startOfSegment-timingInfo.start};this.timelines[segmentInfo.timeline]=mappingObj;this.trigger("timestampoffset");this.logger_("time mapping for timeline "+segmentInfo.timeline+": "+("[time: "+mappingObj.time+"] [mapping: "+mappingObj.mapping+"]"));segment.start=segmentInfo.startOfSegment;segment.end=timingInfo.end+mappingObj.mapping}else if(mappingObj){segment.start=timingInfo.start+mappingObj.mapping;segment.end=timingInfo.end+mappingObj.mapping}else{return!1}return!0}},{key:"saveDiscontinuitySyncInfo_",value:function(segmentInfo){var playlist=segmentInfo.playlist,segment=segmentInfo.segment;if(segment.discontinuity){this.discontinuities[segment.timeline]={time:segment.start,accuracy:0}}else if(playlist.discontinuityStarts&&playlist.discontinuityStarts.length){for(var i=0;i<playlist.discontinuityStarts.length;i++){var segmentIndex=playlist.discontinuityStarts[i],discontinuity=playlist.discontinuitySequence+i+1,mediaIndexDiff=segmentIndex-segmentInfo.mediaIndex,accuracy=Math.abs(mediaIndexDiff);if(!this.discontinuities[discontinuity]||this.discontinuities[discontinuity].accuracy>accuracy){var time=void 0;if(0>mediaIndexDiff){time=segment.start-sumDurations(playlist,segmentInfo.mediaIndex,segmentIndex)}else{time=segment.end+sumDurations(playlist,segmentInfo.mediaIndex+1,segmentIndex)}this.discontinuities[discontinuity]={time:time,accuracy:accuracy}}}}}},{key:"dispose",value:function(){this.trigger("dispose");this.off()}}]);return SyncController}(videojs$1.EventTarget),Decrypter$1=new shimWorker("./decrypter-worker.worker.js",function(){var self=this,decrypterWorker=function(){function unpad(padded){return padded.subarray(0,padded.byteLength-padded[padded.byteLength-1])}var classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}},createClass=function(){function defineProperties(target,props){for(var i=0,descriptor;i<props.length;i++){descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value"in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}(),inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass){throw new TypeError("Super expression must either be null or a function, not "+_typeof2(superClass))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass},possibleConstructorReturn=function(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&("object"===_typeof2(call)||"function"==typeof call)?call:self},precompute=function(){var tables=[[[],[],[],[],[]],[[],[],[],[],[]]],encTable=tables[0],decTable=tables[1],sbox=encTable[4],sboxInv=decTable[4],i=void 0,x=void 0,xInv=void 0,d=[],th=[],x2=void 0,x4=void 0,x8=void 0,s=void 0,tEnc=void 0,tDec=void 0;for(i=0;256>i;i++){th[(d[i]=i<<1^283*(i>>7))^i]=i}for(x=xInv=0;!sbox[x];x^=x2||1,xInv=th[xInv]||1){s=xInv^xInv<<1^xInv<<2^xInv<<3^xInv<<4;s=99^(s>>8^255&s);sbox[x]=s;sboxInv[s]=x;x8=d[x4=d[x2=d[x]]];tDec=16843009*x8^65537*x4^257*x2^16843008*x;tEnc=257*d[s]^16843008*s;for(i=0;4>i;i++){encTable[i][x]=tEnc=tEnc<<24^tEnc>>>8;decTable[i][s]=tDec=tDec<<24^tDec>>>8}}for(i=0;5>i;i++){encTable[i]=encTable[i].slice(0);decTable[i]=decTable[i].slice(0)}return tables},aesTables=null,AES=function(){function AES(key){classCallCheck(this,AES);if(!aesTables){aesTables=precompute()}this._tables=[[aesTables[0][0].slice(),aesTables[0][1].slice(),aesTables[0][2].slice(),aesTables[0][3].slice(),aesTables[0][4].slice()],[aesTables[1][0].slice(),aesTables[1][1].slice(),aesTables[1][2].slice(),aesTables[1][3].slice(),aesTables[1][4].slice()]];var i=void 0,j=void 0,tmp=void 0,encKey=void 0,decKey=void 0,sbox=this._tables[0][4],decTable=this._tables[1],keyLen=key.length,rcon=1;if(4!==keyLen&&6!==keyLen&&8!==keyLen){throw new Error("Invalid aes key size")}encKey=key.slice(0);decKey=[];this._key=[encKey,decKey];for(i=keyLen;i<4*keyLen+28;i++){tmp=encKey[i-1];if(0==i%keyLen||8===keyLen&&4==i%keyLen){tmp=sbox[tmp>>>24]<<24^sbox[255&tmp>>16]<<16^sbox[255&tmp>>8]<<8^sbox[255&tmp];if(0==i%keyLen){tmp=tmp<<8^tmp>>>24^rcon<<24;rcon=rcon<<1^283*(rcon>>7)}}encKey[i]=encKey[i-keyLen]^tmp}for(j=0;i;j++,i--){tmp=encKey[3&j?i:i-4];if(4>=i||4>j){decKey[j]=tmp}else{decKey[j]=decTable[0][sbox[tmp>>>24]]^decTable[1][sbox[255&tmp>>16]]^decTable[2][sbox[255&tmp>>8]]^decTable[3][sbox[255&tmp]]}}}AES.prototype.decrypt=function(encrypted0,encrypted1,encrypted2,encrypted3,out,offset){var key=this._key[1],a=encrypted0^key[0],b=encrypted3^key[1],c=encrypted2^key[2],d=encrypted1^key[3],a2=void 0,b2=void 0,c2=void 0,nInnerRounds=key.length/4-2,i=void 0,kIndex=4,table=this._tables[1],table0=table[0],table1=table[1],table2=table[2],table3=table[3],sbox=table[4];for(i=0;i<nInnerRounds;i++){a2=table0[a>>>24]^table1[255&b>>16]^table2[255&c>>8]^table3[255&d]^key[kIndex];b2=table0[b>>>24]^table1[255&c>>16]^table2[255&d>>8]^table3[255&a]^key[kIndex+1];c2=table0[c>>>24]^table1[255&d>>16]^table2[255&a>>8]^table3[255&b]^key[kIndex+2];d=table0[d>>>24]^table1[255&a>>16]^table2[255&b>>8]^table3[255&c]^key[kIndex+3];kIndex+=4;a=a2;b=b2;c=c2}for(i=0;4>i;i++){out[(3&-i)+offset]=sbox[a>>>24]<<24^sbox[255&b>>16]<<16^sbox[255&c>>8]<<8^sbox[255&d]^key[kIndex++];a2=a;a=b;b=c;c=d;d=a2}};return AES}(),Stream=function(){function Stream(){classCallCheck(this,Stream);this.listeners={}}Stream.prototype.on=function(type,listener){if(!this.listeners[type]){this.listeners[type]=[]}this.listeners[type].push(listener)};Stream.prototype.off=function(type,listener){if(!this.listeners[type]){return!1}var index=this.listeners[type].indexOf(listener);this.listeners[type].splice(index,1);return-1<index};Stream.prototype.trigger=function(type){var callbacks=this.listeners[type];if(!callbacks){return}if(2===arguments.length){for(var length=callbacks.length,i=0;i<length;++i){callbacks[i].call(this,arguments[1])}}else{for(var args=Array.prototype.slice.call(arguments,1),_length=callbacks.length,_i=0;_i<_length;++_i){callbacks[_i].apply(this,args)}}};Stream.prototype.dispose=function(){this.listeners={}};Stream.prototype.pipe=function(destination){this.on("data",function(data){destination.push(data)})};return Stream}(),AsyncStream$$1=function(_Stream){inherits(AsyncStream$$1,_Stream);function AsyncStream$$1(){classCallCheck(this,AsyncStream$$1);var _this=possibleConstructorReturn(this,_Stream.call(this,Stream));_this.jobs=[];_this.delay=1;_this.timeout_=null;return _this}AsyncStream$$1.prototype.processJob_=function(){this.jobs.shift()();if(this.jobs.length){this.timeout_=setTimeout(this.processJob_.bind(this),this.delay)}else{this.timeout_=null}};AsyncStream$$1.prototype.push=function(job){this.jobs.push(job);if(!this.timeout_){this.timeout_=setTimeout(this.processJob_.bind(this),this.delay)}};return AsyncStream$$1}(Stream),ntoh=function(word){return word<<24|(65280&word)<<8|(16711680&word)>>8|word>>>24},decrypt$$1=function(encrypted,key,initVector){var encrypted32=new Int32Array(encrypted.buffer,encrypted.byteOffset,encrypted.byteLength>>2),decipher=new AES(Array.prototype.slice.call(key)),decrypted=new Uint8Array(encrypted.byteLength),decrypted32=new Int32Array(decrypted.buffer),init0=void 0,init1=void 0,init2=void 0,init3=void 0,encrypted0=void 0,encrypted1=void 0,encrypted2=void 0,encrypted3=void 0,wordIx=void 0;init0=initVector[0];init1=initVector[1];init2=initVector[2];init3=initVector[3];for(wordIx=0;wordIx<encrypted32.length;wordIx+=4){encrypted0=ntoh(encrypted32[wordIx]);encrypted1=ntoh(encrypted32[wordIx+1]);encrypted2=ntoh(encrypted32[wordIx+2]);encrypted3=ntoh(encrypted32[wordIx+3]);decipher.decrypt(encrypted0,encrypted1,encrypted2,encrypted3,decrypted32,wordIx);decrypted32[wordIx]=ntoh(decrypted32[wordIx]^init0);decrypted32[wordIx+1]=ntoh(decrypted32[wordIx+1]^init1);decrypted32[wordIx+2]=ntoh(decrypted32[wordIx+2]^init2);decrypted32[wordIx+3]=ntoh(decrypted32[wordIx+3]^init3);init0=encrypted0;init1=encrypted1;init2=encrypted2;init3=encrypted3}return decrypted},Decrypter$$1=function(){function Decrypter$$1(encrypted,key,initVector,done){classCallCheck(this,Decrypter$$1);var step=Decrypter$$1.STEP,encrypted32=new Int32Array(encrypted.buffer),decrypted=new Uint8Array(encrypted.byteLength),i=0;this.asyncStream_=new AsyncStream$$1;this.asyncStream_.push(this.decryptChunk_(encrypted32.subarray(i,i+step),key,initVector,decrypted));for(i=step;i<encrypted32.length;i+=step){initVector=new Uint32Array([ntoh(encrypted32[i-4]),ntoh(encrypted32[i-3]),ntoh(encrypted32[i-2]),ntoh(encrypted32[i-1])]);this.asyncStream_.push(this.decryptChunk_(encrypted32.subarray(i,i+step),key,initVector,decrypted))}this.asyncStream_.push(function(){done(null,unpad(decrypted))})}Decrypter$$1.prototype.decryptChunk_=function(encrypted,key,initVector,decrypted){return function(){var bytes=decrypt$$1(encrypted,key,initVector);decrypted.set(bytes,encrypted.byteOffset)}};createClass(Decrypter$$1,null,[{key:"STEP",get:function(){return 32e3}}]);return Decrypter$$1}(),createTransferableMessage=function(message){var transferable={};Object.keys(message).forEach(function(key){var value=message[key];if(ArrayBuffer.isView(value)){transferable[key]={bytes:value.buffer,byteOffset:value.byteOffset,byteLength:value.byteLength}}else{transferable[key]=value}});return transferable},decrypterWorker=new function(self){self.onmessage=function(event){var data=event.data,encrypted=new Uint8Array(data.encrypted.bytes,data.encrypted.byteOffset,data.encrypted.byteLength),key=new Uint32Array(data.key.bytes,data.key.byteOffset,data.key.byteLength/4),iv=new Uint32Array(data.iv.bytes,data.iv.byteOffset,data.iv.byteLength/4);new Decrypter$$1(encrypted,key,iv,function(err,bytes){self.postMessage(createTransferableMessage({source:data.source,decrypted:bytes}),[bytes.buffer])})}}(self);return decrypterWorker}()}),audioTrackKind_=function(properties){var kind=properties["default"]?"main":"alternative";if(properties.characteristics&&0<=properties.characteristics.indexOf("public.accessibility.describes-video")){kind="main-desc"}return kind},stopLoaders=function(segmentLoader,mediaType){segmentLoader.abort();segmentLoader.pause();if(mediaType&&mediaType.activePlaylistLoader){mediaType.activePlaylistLoader.pause();mediaType.activePlaylistLoader=null}},startLoaders=function(playlistLoader,mediaType){mediaType.activePlaylistLoader=playlistLoader;playlistLoader.load()},onGroupChanged=function(type,settings){return function(){var _settings$segmentLoad=settings.segmentLoaders,segmentLoader=_settings$segmentLoad[type],mainSegmentLoader=_settings$segmentLoad.main,mediaType=settings.mediaTypes[type],activeTrack=mediaType.activeTrack(),activeGroup=mediaType.activeGroup(activeTrack),previousActiveLoader=mediaType.activePlaylistLoader;stopLoaders(segmentLoader,mediaType);if(!activeGroup){return}if(!activeGroup.playlistLoader){if(previousActiveLoader){mainSegmentLoader.resetEverything()}return}segmentLoader.resyncLoader();startLoaders(activeGroup.playlistLoader,mediaType)}},onTrackChanged=function(type,settings){return function(){var _settings$segmentLoad2=settings.segmentLoaders,segmentLoader=_settings$segmentLoad2[type],mainSegmentLoader=_settings$segmentLoad2.main,mediaType=settings.mediaTypes[type],activeTrack=mediaType.activeTrack(),activeGroup=mediaType.activeGroup(activeTrack),previousActiveLoader=mediaType.activePlaylistLoader;stopLoaders(segmentLoader,mediaType);if(!activeGroup){return}if(!activeGroup.playlistLoader){mainSegmentLoader.resetEverything();return}if(previousActiveLoader===activeGroup.playlistLoader){startLoaders(activeGroup.playlistLoader,mediaType);return}if(segmentLoader.track){segmentLoader.track(activeTrack)}segmentLoader.resetEverything();startLoaders(activeGroup.playlistLoader,mediaType)}},onError={AUDIO:function(type,settings){return function(){var segmentLoader=settings.segmentLoaders[type],mediaType=settings.mediaTypes[type],blacklistCurrentPlaylist=settings.blacklistCurrentPlaylist;stopLoaders(segmentLoader,mediaType);var activeTrack=mediaType.activeTrack(),activeGroup=mediaType.activeGroup(),id=(activeGroup.filter(function(group){return group["default"]})[0]||activeGroup[0]).id,defaultTrack=mediaType.tracks[id];if(activeTrack===defaultTrack){blacklistCurrentPlaylist({message:"Problem encountered loading the default audio track."});return}videojs$1.log.warn("Problem encountered loading the alternate audio track.Switching back to default.");for(var trackId in mediaType.tracks){mediaType.tracks[trackId].enabled=mediaType.tracks[trackId]===defaultTrack}mediaType.onTrackChanged()}},SUBTITLES:function(type,settings){return function(){var segmentLoader=settings.segmentLoaders[type],mediaType=settings.mediaTypes[type];videojs$1.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track.");stopLoaders(segmentLoader,mediaType);var track=mediaType.activeTrack();if(track){track.mode="disabled"}mediaType.onTrackChanged()}}},setupListeners={AUDIO:function(type,playlistLoader,settings){if(!playlistLoader){return}var tech=settings.tech,requestOptions=settings.requestOptions,segmentLoader=settings.segmentLoaders[type];playlistLoader.on("loadedmetadata",function(){var media=playlistLoader.media();segmentLoader.playlist(media,requestOptions);if(!tech.paused()||media.endList&&"none"!==tech.preload()){segmentLoader.load()}});playlistLoader.on("loadedplaylist",function(){segmentLoader.playlist(playlistLoader.media(),requestOptions);if(!tech.paused()){segmentLoader.load()}});playlistLoader.on("error",onError[type](type,settings))},SUBTITLES:function(type,playlistLoader,settings){var tech=settings.tech,requestOptions=settings.requestOptions,segmentLoader=settings.segmentLoaders[type],mediaType=settings.mediaTypes[type];playlistLoader.on("loadedmetadata",function(){var media=playlistLoader.media();segmentLoader.playlist(media,requestOptions);segmentLoader.track(mediaType.activeTrack());if(!tech.paused()||media.endList&&"none"!==tech.preload()){segmentLoader.load()}});playlistLoader.on("loadedplaylist",function(){segmentLoader.playlist(playlistLoader.media(),requestOptions);if(!tech.paused()){segmentLoader.load()}});playlistLoader.on("error",onError[type](type,settings))}},initialize={AUDIO:function(type,settings){var hls=settings.hls,sourceType=settings.sourceType,segmentLoader=settings.segmentLoaders[type],requestOptions=settings.requestOptions,mediaGroups=settings.master.mediaGroups,_settings$mediaTypes$=settings.mediaTypes[type],groups=_settings$mediaTypes$.groups,tracks=_settings$mediaTypes$.tracks,masterPlaylistLoader=settings.masterPlaylistLoader;if(!mediaGroups[type]||0===Object.keys(mediaGroups[type]).length){mediaGroups[type]={main:{default:{default:!0}}}}for(var groupId in mediaGroups[type]){if(!groups[groupId]){groups[groupId]=[]}for(var variantLabel in mediaGroups[type][groupId]){var properties=mediaGroups[type][groupId][variantLabel],playlistLoader=void 0;if(properties.resolvedUri){playlistLoader=new PlaylistLoader(properties.resolvedUri,hls,requestOptions)}else if(properties.playlists&&"dash"===sourceType){playlistLoader=new DashPlaylistLoader(properties.playlists[0],hls,requestOptions,masterPlaylistLoader)}else{playlistLoader=null}properties=videojs$1.mergeOptions({id:variantLabel,playlistLoader:playlistLoader},properties);setupListeners[type](type,properties.playlistLoader,settings);groups[groupId].push(properties);if("undefined"==typeof tracks[variantLabel]){var track=new videojs$1.AudioTrack({id:variantLabel,kind:audioTrackKind_(properties),enabled:!1,language:properties.language,default:properties["default"],label:variantLabel});tracks[variantLabel]=track}}}segmentLoader.on("error",onError[type](type,settings))},SUBTITLES:function(type,settings){var tech=settings.tech,hls=settings.hls,sourceType=settings.sourceType,segmentLoader=settings.segmentLoaders[type],requestOptions=settings.requestOptions,mediaGroups=settings.master.mediaGroups,_settings$mediaTypes$2=settings.mediaTypes[type],groups=_settings$mediaTypes$2.groups,tracks=_settings$mediaTypes$2.tracks,masterPlaylistLoader=settings.masterPlaylistLoader;for(var groupId in mediaGroups[type]){if(!groups[groupId]){groups[groupId]=[]}for(var variantLabel in mediaGroups[type][groupId]){if(mediaGroups[type][groupId][variantLabel].forced){continue}var properties=mediaGroups[type][groupId][variantLabel],playlistLoader=void 0;if("hls"===sourceType){playlistLoader=new PlaylistLoader(properties.resolvedUri,hls,requestOptions)}else if("dash"===sourceType){playlistLoader=new DashPlaylistLoader(properties.playlists[0],hls,requestOptions,masterPlaylistLoader)}properties=videojs$1.mergeOptions({id:variantLabel,playlistLoader:playlistLoader},properties);setupListeners[type](type,properties.playlistLoader,settings);groups[groupId].push(properties);if("undefined"==typeof tracks[variantLabel]){var track=tech.addRemoteTextTrack({id:variantLabel,kind:"subtitles",default:properties["default"]&&properties.autoselect,language:properties.language,label:variantLabel},!1).track;tracks[variantLabel]=track}}}segmentLoader.on("error",onError[type](type,settings))},"CLOSED-CAPTIONS":function(type,settings){var tech=settings.tech,mediaGroups=settings.master.mediaGroups,_settings$mediaTypes$3=settings.mediaTypes[type],groups=_settings$mediaTypes$3.groups,tracks=_settings$mediaTypes$3.tracks;for(var groupId in mediaGroups[type]){if(!groups[groupId]){groups[groupId]=[]}for(var variantLabel in mediaGroups[type][groupId]){var properties=mediaGroups[type][groupId][variantLabel];if(!properties.instreamId.match(/CC\d/)){continue}groups[groupId].push(videojs$1.mergeOptions({id:variantLabel},properties));if("undefined"==typeof tracks[variantLabel]){var track=tech.addRemoteTextTrack({id:properties.instreamId,kind:"captions",default:properties["default"]&&properties.autoselect,language:properties.language,label:variantLabel},!1).track;tracks[variantLabel]=track}}}}},activeGroup=function(type,settings){return function(track){var masterPlaylistLoader=settings.masterPlaylistLoader,groups=settings.mediaTypes[type].groups,media=masterPlaylistLoader.media();if(!media){return null}var variants=null;if(media.attributes[type]){variants=groups[media.attributes[type]]}variants=variants||groups.main;if("undefined"==typeof track){return variants}if(null===track){return null}return variants.filter(function(props){return props.id===track.id})[0]||null}},activeTrack={AUDIO:function(type,settings){return function(){var tracks=settings.mediaTypes[type].tracks;for(var id in tracks){if(tracks[id].enabled){return tracks[id]}}return null}},SUBTITLES:function(type,settings){return function(){var tracks=settings.mediaTypes[type].tracks;for(var id in tracks){if("showing"===tracks[id].mode||"hidden"===tracks[id].mode){return tracks[id]}}return null}}},setupMediaGroups=function(settings){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(type){initialize[type](type,settings)});var mediaTypes=settings.mediaTypes,masterPlaylistLoader=settings.masterPlaylistLoader,tech=settings.tech,hls=settings.hls;["AUDIO","SUBTITLES"].forEach(function(type){mediaTypes[type].activeGroup=activeGroup(type,settings);mediaTypes[type].activeTrack=activeTrack[type](type,settings);mediaTypes[type].onGroupChanged=onGroupChanged(type,settings);mediaTypes[type].onTrackChanged=onTrackChanged(type,settings)});var audioGroup=mediaTypes.AUDIO.activeGroup(),groupId=(audioGroup.filter(function(group){return group["default"]})[0]||audioGroup[0]).id;mediaTypes.AUDIO.tracks[groupId].enabled=!0;mediaTypes.AUDIO.onTrackChanged();masterPlaylistLoader.on("mediachange",function(){["AUDIO","SUBTITLES"].forEach(function(type){return mediaTypes[type].onGroupChanged()})});var onAudioTrackChanged=function(){mediaTypes.AUDIO.onTrackChanged();tech.trigger({type:"usage",name:"hls-audio-change"})};tech.audioTracks().addEventListener("change",onAudioTrackChanged);tech.remoteTextTracks().addEventListener("change",mediaTypes.SUBTITLES.onTrackChanged);hls.on("dispose",function(){tech.audioTracks().removeEventListener("change",onAudioTrackChanged);tech.remoteTextTracks().removeEventListener("change",mediaTypes.SUBTITLES.onTrackChanged)});tech.clearTracks("audio");for(var id in mediaTypes.AUDIO.tracks){tech.audioTracks().addTrack(mediaTypes.AUDIO.tracks[id])}},createMediaTypes=function(){var mediaTypes={};["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(type){mediaTypes[type]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:noop$1,activeTrack:noop$1,onGroupChanged:noop$1,onTrackChanged:noop$1}});return mediaTypes},Hls=void 0,loaderStats=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred"],sumLoaderStat=function(stat){return this.audioSegmentLoader_[stat]+this.mainSegmentLoader_[stat]},shouldSwitchToMedia=function(_ref){var currentPlaylist=_ref.currentPlaylist,nextPlaylist=_ref.nextPlaylist,forwardBuffer=_ref.forwardBuffer,bufferLowWaterLine=_ref.bufferLowWaterLine,duration$$1=_ref.duration,log=_ref.log;if(!nextPlaylist){videojs$1.log.warn("We received no playlist to switch to. Please check your stream.");return!1}if(!currentPlaylist.endList){return!0}if(duration$$1<Config.MAX_BUFFER_LOW_WATER_LINE){return!0}if(nextPlaylist.attributes.BANDWIDTH<currentPlaylist.attributes.BANDWIDTH){return!0}if(forwardBuffer>=bufferLowWaterLine){return!0}return!1},MasterPlaylistController=function(_videojs$EventTarget){inherits$1(MasterPlaylistController,_videojs$EventTarget);function MasterPlaylistController(options){classCallCheck(this,MasterPlaylistController);var _this=possibleConstructorReturn(this,(MasterPlaylistController.__proto__||Object.getPrototypeOf(MasterPlaylistController)).call(this)),url=options.url,handleManifestRedirects=options.handleManifestRedirects,withCredentials=options.withCredentials,tech=options.tech,bandwidth=options.bandwidth,externHls=options.externHls,useCueTags=options.useCueTags,blacklistDuration=options.blacklistDuration,enableLowInitialPlaylist=options.enableLowInitialPlaylist,cacheEncryptionKeys=options.cacheEncryptionKeys,sourceType=options.sourceType;if(!url){throw new Error("A non-empty playlist URL is required")}Hls=externHls;_this.withCredentials=withCredentials;_this.tech_=tech;_this.hls_=tech.hls;_this.sourceType_=sourceType;_this.useCueTags_=useCueTags;_this.blacklistDuration=blacklistDuration;_this.enableLowInitialPlaylist=enableLowInitialPlaylist;if(_this.useCueTags_){_this.cueTagsTrack_=_this.tech_.addTextTrack("metadata","ad-cues");_this.cueTagsTrack_.inBandMetadataTrackDispatchType=""}_this.requestOptions_={withCredentials:withCredentials,handleManifestRedirects:handleManifestRedirects,timeout:null};_this.mediaTypes_=createMediaTypes();_this.mediaSource=new videojs$1.MediaSource;_this.mediaSource.addEventListener("sourceopen",_this.handleSourceOpen_.bind(_this));_this.seekable_=videojs$1.createTimeRanges();_this.hasPlayed_=!1;_this.syncController_=new SyncController(options);_this.segmentMetadataTrack_=tech.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track;_this.decrypter_=new Decrypter$1;_this.inbandTextTracks_={};var segmentLoaderSettings={hls:_this.hls_,mediaSource:_this.mediaSource,currentTime:_this.tech_.currentTime.bind(_this.tech_),seekable:function(){return _this.seekable()},seeking:function(){return _this.tech_.seeking()},duration:function(){return _this.mediaSource.duration},hasPlayed:function(){return _this.hasPlayed_},goalBufferLength:function(){return _this.goalBufferLength()},bandwidth:bandwidth,syncController:_this.syncController_,decrypter:_this.decrypter_,sourceType:_this.sourceType_,inbandTextTracks:_this.inbandTextTracks_,cacheEncryptionKeys:cacheEncryptionKeys};_this.masterPlaylistLoader_="dash"===_this.sourceType_?new DashPlaylistLoader(url,_this.hls_,_this.requestOptions_):new PlaylistLoader(url,_this.hls_,_this.requestOptions_);_this.setupMasterPlaylistLoaderListeners_();_this.mainSegmentLoader_=new SegmentLoader(videojs$1.mergeOptions(segmentLoaderSettings,{segmentMetadataTrack:_this.segmentMetadataTrack_,loaderType:"main"}),options);_this.audioSegmentLoader_=new SegmentLoader(videojs$1.mergeOptions(segmentLoaderSettings,{loaderType:"audio"}),options);_this.subtitleSegmentLoader_=new VTTSegmentLoader(videojs$1.mergeOptions(segmentLoaderSettings,{loaderType:"vtt",featuresNativeTextTracks:_this.tech_.featuresNativeTextTracks}),options);_this.setupSegmentLoaderListeners_();loaderStats.forEach(function(stat){_this[stat+"_"]=sumLoaderStat.bind(_this,stat)});_this.logger_=logger("MPC");_this.masterPlaylistLoader_.load();return _this}createClass$1(MasterPlaylistController,[{key:"setupMasterPlaylistLoaderListeners_",value:function(){var _this2=this;this.masterPlaylistLoader_.on("loadedmetadata",function(){var media=_this2.masterPlaylistLoader_.media(),requestTimeout=1e3*(1.5*media.targetDuration);if(isLowestEnabledRendition(_this2.masterPlaylistLoader_.master,_this2.masterPlaylistLoader_.media())){_this2.requestOptions_.timeout=0}else{_this2.requestOptions_.timeout=requestTimeout}if(media.endList&&"none"!==_this2.tech_.preload()){_this2.mainSegmentLoader_.playlist(media,_this2.requestOptions_);_this2.mainSegmentLoader_.load()}setupMediaGroups({sourceType:_this2.sourceType_,segmentLoaders:{AUDIO:_this2.audioSegmentLoader_,SUBTITLES:_this2.subtitleSegmentLoader_,main:_this2.mainSegmentLoader_},tech:_this2.tech_,requestOptions:_this2.requestOptions_,masterPlaylistLoader:_this2.masterPlaylistLoader_,hls:_this2.hls_,master:_this2.master(),mediaTypes:_this2.mediaTypes_,blacklistCurrentPlaylist:_this2.blacklistCurrentPlaylist.bind(_this2)});_this2.triggerPresenceUsage_(_this2.master(),media);try{_this2.setupSourceBuffers_()}catch(e){videojs$1.log.warn("Failed to create SourceBuffers",e);return _this2.mediaSource.endOfStream("decode")}_this2.setupFirstPlay();if(!_this2.mediaTypes_.AUDIO.activePlaylistLoader||_this2.mediaTypes_.AUDIO.activePlaylistLoader.media()){_this2.trigger("selectedinitialmedia")}else{_this2.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",function(){_this2.trigger("selectedinitialmedia")})}});this.masterPlaylistLoader_.on("loadedplaylist",function(){var updatedPlaylist=_this2.masterPlaylistLoader_.media();if(!updatedPlaylist){_this2.excludeUnsupportedVariants_();var selectedMedia;if(_this2.enableLowInitialPlaylist){selectedMedia=_this2.selectInitialPlaylist()}if(!selectedMedia){selectedMedia=_this2.selectPlaylist()}_this2.initialMedia_=selectedMedia;_this2.masterPlaylistLoader_.media(_this2.initialMedia_);return}if(_this2.useCueTags_){_this2.updateAdCues_(updatedPlaylist)}_this2.mainSegmentLoader_.playlist(updatedPlaylist,_this2.requestOptions_);_this2.updateDuration();if(!_this2.tech_.paused()){_this2.mainSegmentLoader_.load();if(_this2.audioSegmentLoader_){_this2.audioSegmentLoader_.load()}}if(!updatedPlaylist.endList){var addSeekableRange=function(){var seekable$$1=_this2.seekable();if(0!==seekable$$1.length){_this2.mediaSource.addSeekableRange_(seekable$$1.start(0),seekable$$1.end(0))}};if(_this2.duration()!==1/0){var onDurationchange=function onDurationchange(){if(_this2.duration()===1/0){addSeekableRange()}else{_this2.tech_.one("durationchange",onDurationchange)}};_this2.tech_.one("durationchange",onDurationchange)}else{addSeekableRange()}}});this.masterPlaylistLoader_.on("error",function(){_this2.blacklistCurrentPlaylist(_this2.masterPlaylistLoader_.error)});this.masterPlaylistLoader_.on("mediachanging",function(){_this2.mainSegmentLoader_.abort();_this2.mainSegmentLoader_.pause()});this.masterPlaylistLoader_.on("mediachange",function(){var media=_this2.masterPlaylistLoader_.media(),requestTimeout=1e3*(1.5*media.targetDuration);if(isLowestEnabledRendition(_this2.masterPlaylistLoader_.master,_this2.masterPlaylistLoader_.media())){_this2.requestOptions_.timeout=0}else{_this2.requestOptions_.timeout=requestTimeout}_this2.mainSegmentLoader_.playlist(media,_this2.requestOptions_);_this2.mainSegmentLoader_.load();_this2.tech_.trigger({type:"mediachange",bubbles:!0})});this.masterPlaylistLoader_.on("playlistunchanged",function(){var updatedPlaylist=_this2.masterPlaylistLoader_.media(),playlistOutdated=_this2.stuckAtPlaylistEnd_(updatedPlaylist);if(playlistOutdated){_this2.blacklistCurrentPlaylist({message:"Playlist no longer updating."});_this2.tech_.trigger("playliststuck")}});this.masterPlaylistLoader_.on("renditiondisabled",function(){_this2.tech_.trigger({type:"usage",name:"hls-rendition-disabled"})});this.masterPlaylistLoader_.on("renditionenabled",function(){_this2.tech_.trigger({type:"usage",name:"hls-rendition-enabled"})})}},{key:"triggerPresenceUsage_",value:function(master,media){var mediaGroups=master.mediaGroups||{},defaultDemuxed=!0,audioGroupKeys=Object.keys(mediaGroups.AUDIO);for(var mediaGroup in mediaGroups.AUDIO){for(var label in mediaGroups.AUDIO[mediaGroup]){var properties=mediaGroups.AUDIO[mediaGroup][label];if(!properties.uri){defaultDemuxed=!1}}}if(defaultDemuxed){this.tech_.trigger({type:"usage",name:"hls-demuxed"})}if(Object.keys(mediaGroups.SUBTITLES).length){this.tech_.trigger({type:"usage",name:"hls-webvtt"})}if(Hls.Playlist.isAes(media)){this.tech_.trigger({type:"usage",name:"hls-aes"})}if(Hls.Playlist.isFmp4(media)){this.tech_.trigger({type:"usage",name:"hls-fmp4"})}if(audioGroupKeys.length&&1<Object.keys(mediaGroups.AUDIO[audioGroupKeys[0]]).length){this.tech_.trigger({type:"usage",name:"hls-alternate-audio"})}if(this.useCueTags_){this.tech_.trigger({type:"usage",name:"hls-playlist-cue-tags"})}}},{key:"setupSegmentLoaderListeners_",value:function(){var _this3=this;this.mainSegmentLoader_.on("bandwidthupdate",function(){var nextPlaylist=_this3.selectPlaylist(),currentPlaylist=_this3.masterPlaylistLoader_.media(),buffered=_this3.tech_.buffered(),forwardBuffer=buffered.length?buffered.end(buffered.length-1)-_this3.tech_.currentTime():0,bufferLowWaterLine=_this3.bufferLowWaterLine();if(shouldSwitchToMedia({currentPlaylist:currentPlaylist,nextPlaylist:nextPlaylist,forwardBuffer:forwardBuffer,bufferLowWaterLine:bufferLowWaterLine,duration:_this3.duration(),log:_this3.logger_})){_this3.masterPlaylistLoader_.media(nextPlaylist)}_this3.tech_.trigger("bandwidthupdate")});this.mainSegmentLoader_.on("progress",function(){_this3.trigger("progress")});this.mainSegmentLoader_.on("error",function(){_this3.blacklistCurrentPlaylist(_this3.mainSegmentLoader_.error())});this.mainSegmentLoader_.on("syncinfoupdate",function(){_this3.onSyncInfoUpdate_()});this.mainSegmentLoader_.on("timestampoffset",function(){_this3.tech_.trigger({type:"usage",name:"hls-timestamp-offset"})});this.audioSegmentLoader_.on("syncinfoupdate",function(){_this3.onSyncInfoUpdate_()});this.mainSegmentLoader_.on("ended",function(){_this3.onEndOfStream()});this.mainSegmentLoader_.on("earlyabort",function(){_this3.blacklistCurrentPlaylist({message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},120)});this.mainSegmentLoader_.on("reseteverything",function(){_this3.tech_.trigger("hls-reset")});this.mainSegmentLoader_.on("segmenttimemapping",function(event){_this3.tech_.trigger({type:"hls-segment-time-mapping",mapping:event.mapping})});this.audioSegmentLoader_.on("ended",function(){_this3.onEndOfStream()})}},{key:"mediaSecondsLoaded_",value:function(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}},{key:"load",value:function(){this.mainSegmentLoader_.load();if(this.mediaTypes_.AUDIO.activePlaylistLoader){this.audioSegmentLoader_.load()}if(this.mediaTypes_.SUBTITLES.activePlaylistLoader){this.subtitleSegmentLoader_.load()}}},{key:"smoothQualityChange_",value:function(){var media=this.selectPlaylist();if(media!==this.masterPlaylistLoader_.media()){this.masterPlaylistLoader_.media(media);this.mainSegmentLoader_.resetLoader()}}},{key:"fastQualityChange_",value:function(){var _this4=this,media=this.selectPlaylist();if(media===this.masterPlaylistLoader_.media()){return}this.masterPlaylistLoader_.media(media);this.mainSegmentLoader_.resetEverything(function(){if(videojs$1.browser.IE_VERSION||videojs$1.browser.IS_EDGE){_this4.tech_.setCurrentTime(_this4.tech_.currentTime()+.04)}else{_this4.tech_.setCurrentTime(_this4.tech_.currentTime())}})}},{key:"play",value:function(){if(this.setupFirstPlay()){return}if(this.tech_.ended()){this.tech_.setCurrentTime(0)}if(this.hasPlayed_){this.load()}var seekable$$1=this.tech_.seekable();if(this.tech_.duration()===1/0){if(this.tech_.currentTime()<seekable$$1.start(0)){return this.tech_.setCurrentTime(seekable$$1.end(seekable$$1.length-1))}}}},{key:"setupFirstPlay",value:function(){var _this5=this,media=this.masterPlaylistLoader_.media();if(!media||this.tech_.paused()||this.hasPlayed_){return!1}if(!media.endList){var seekable$$1=this.seekable();if(!seekable$$1.length){return!1}if(videojs$1.browser.IE_VERSION&&0===this.tech_.readyState()){this.tech_.one("loadedmetadata",function(){_this5.trigger("firstplay");_this5.tech_.setCurrentTime(seekable$$1.end(0));_this5.hasPlayed_=!0});return!1}this.trigger("firstplay");this.tech_.setCurrentTime(seekable$$1.end(0))}this.hasPlayed_=!0;this.load();return!0}},{key:"handleSourceOpen_",value:function(){try{this.setupSourceBuffers_()}catch(e){videojs$1.log.warn("Failed to create Source Buffers",e);return this.mediaSource.endOfStream("decode")}if(this.tech_.autoplay()){var playPromise=this.tech_.play();if("undefined"!=typeof playPromise&&"function"==typeof playPromise.then){playPromise.then(null,function(){})}}this.trigger("sourceopen")}},{key:"onEndOfStream",value:function(){var isEndOfStream=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){if(!this.mainSegmentLoader_.startingMedia_||this.mainSegmentLoader_.startingMedia_.containsVideo){isEndOfStream=isEndOfStream&&this.audioSegmentLoader_.ended_}else{isEndOfStream=this.audioSegmentLoader_.ended_}}if(!isEndOfStream){return}this.logger_("calling mediaSource.endOfStream()");try{this.mediaSource.endOfStream()}catch(e){videojs$1.log.warn("Failed to call media source endOfStream",e)}}},{key:"stuckAtPlaylistEnd_",value:function(playlist){var seekable$$1=this.seekable();if(!seekable$$1.length){return!1}var expired=this.syncController_.getExpiredTime(playlist,this.mediaSource.duration);if(null===expired){return!1}var absolutePlaylistEnd=Hls.Playlist.playlistEnd(playlist,expired),currentTime=this.tech_.currentTime(),buffered=this.tech_.buffered();if(!buffered.length){return absolutePlaylistEnd-currentTime<=SAFE_TIME_DELTA}var bufferedEnd=buffered.end(buffered.length-1);return bufferedEnd-currentTime<=SAFE_TIME_DELTA&&absolutePlaylistEnd-bufferedEnd<=SAFE_TIME_DELTA}},{key:"blacklistCurrentPlaylist",value:function(){var error=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},blacklistDuration=arguments[1],currentPlaylist=void 0,nextPlaylist=void 0;currentPlaylist=error.playlist||this.masterPlaylistLoader_.media();blacklistDuration=blacklistDuration||error.blacklistDuration||this.blacklistDuration;if(!currentPlaylist){this.error=error;try{return this.mediaSource.endOfStream("network")}catch(e){return this.trigger("error")}}var isFinalRendition=1===this.masterPlaylistLoader_.master.playlists.filter(isEnabled).length,playlists=this.masterPlaylistLoader_.master.playlists;if(1===playlists.length){videojs$1.log.warn("Problem encountered with the current HLS playlist. Trying again since it is the only playlist.");this.tech_.trigger("retryplaylist");return this.masterPlaylistLoader_.load(isFinalRendition)}if(isFinalRendition){videojs$1.log.warn("Removing all playlists from the blacklist because the last rendition is about to be blacklisted.");playlists.forEach(function(playlist){if(playlist.excludeUntil!==1/0){delete playlist.excludeUntil}});this.tech_.trigger("retryplaylist")}currentPlaylist.excludeUntil=Date.now()+1e3*blacklistDuration;this.tech_.trigger("blacklistplaylist");this.tech_.trigger({type:"usage",name:"hls-rendition-blacklisted"});nextPlaylist=this.selectPlaylist();videojs$1.log.warn("Problem encountered with the current HLS playlist."+(error.message?" "+error.message:"")+" Switching to another playlist.");return this.masterPlaylistLoader_.media(nextPlaylist,isFinalRendition)}},{key:"pauseLoading",value:function(){this.mainSegmentLoader_.pause();if(this.mediaTypes_.AUDIO.activePlaylistLoader){this.audioSegmentLoader_.pause()}if(this.mediaTypes_.SUBTITLES.activePlaylistLoader){this.subtitleSegmentLoader_.pause()}}},{key:"setCurrentTime",value:function(currentTime){var buffered=findRange(this.tech_.buffered(),currentTime);if(!(this.masterPlaylistLoader_&&this.masterPlaylistLoader_.media())){return 0}if(!this.masterPlaylistLoader_.media().segments){return 0}if(buffered&&buffered.length){return currentTime}this.mainSegmentLoader_.resetEverything();this.mainSegmentLoader_.abort();if(this.mediaTypes_.AUDIO.activePlaylistLoader){this.audioSegmentLoader_.resetEverything();this.audioSegmentLoader_.abort()}if(this.mediaTypes_.SUBTITLES.activePlaylistLoader){this.subtitleSegmentLoader_.resetEverything();this.subtitleSegmentLoader_.abort()}this.load()}},{key:"duration",value:function(){if(!this.masterPlaylistLoader_){return 0}if(this.mediaSource){return this.mediaSource.duration}return Hls.Playlist.duration(this.masterPlaylistLoader_.media())}},{key:"seekable",value:function(){return this.seekable_}},{key:"onSyncInfoUpdate_",value:function(){var audioSeekable;if(!this.masterPlaylistLoader_){return}var media=this.masterPlaylistLoader_.media();if(!media){return}var expired=this.syncController_.getExpiredTime(media,this.mediaSource.duration);if(null===expired){return}var suggestedPresentationDelay=this.masterPlaylistLoader_.master.suggestedPresentationDelay,mainSeekable=Hls.Playlist.seekable(media,expired,suggestedPresentationDelay);if(0===mainSeekable.length){return}if(this.mediaTypes_.AUDIO.activePlaylistLoader){media=this.mediaTypes_.AUDIO.activePlaylistLoader.media();expired=this.syncController_.getExpiredTime(media,this.mediaSource.duration);if(null===expired){return}audioSeekable=Hls.Playlist.seekable(media,expired,suggestedPresentationDelay);if(0===audioSeekable.length){return}}var oldEnd=void 0,oldStart=void 0;if(this.seekable_&&this.seekable_.length){oldEnd=this.seekable_.end(0);oldStart=this.seekable_.start(0)}if(!audioSeekable){this.seekable_=mainSeekable}else if(audioSeekable.start(0)>mainSeekable.end(0)||mainSeekable.start(0)>audioSeekable.end(0)){this.seekable_=mainSeekable}else{this.seekable_=videojs$1.createTimeRanges([[audioSeekable.start(0)>mainSeekable.start(0)?audioSeekable.start(0):mainSeekable.start(0),audioSeekable.end(0)<mainSeekable.end(0)?audioSeekable.end(0):mainSeekable.end(0)]])}if(this.seekable_&&this.seekable_.length){if(this.seekable_.end(0)===oldEnd&&this.seekable_.start(0)===oldStart){return}}this.logger_("seekable updated ["+printableRange(this.seekable_)+"]");this.tech_.trigger("seekablechanged")}},{key:"updateDuration",value:function(){var _this6=this,oldDuration=this.mediaSource.duration,newDuration=Hls.Playlist.duration(this.masterPlaylistLoader_.media()),buffered=this.tech_.buffered(),setDuration=function setDuration(){_this6.logger_("Setting duration from "+_this6.mediaSource.duration+" => "+newDuration);try{_this6.mediaSource.duration=newDuration}catch(e){videojs$1.log.warn("Failed to set media source duration",e)}_this6.tech_.trigger("durationchange");_this6.mediaSource.removeEventListener("sourceopen",setDuration)};if(0<buffered.length){newDuration=Math.max(newDuration,buffered.end(buffered.length-1))}if(oldDuration!==newDuration){if("open"!==this.mediaSource.readyState){this.mediaSource.addEventListener("sourceopen",setDuration)}else{setDuration()}}}},{key:"dispose",value:function(){var _this7=this;this.trigger("dispose");if(this.decrypter_){this.decrypter_.terminate()}this.masterPlaylistLoader_.dispose();this.mainSegmentLoader_.dispose();["AUDIO","SUBTITLES"].forEach(function(type){var groups=_this7.mediaTypes_[type].groups;for(var id in groups){groups[id].forEach(function(group){if(group.playlistLoader){group.playlistLoader.dispose()}})}});this.audioSegmentLoader_.dispose();this.subtitleSegmentLoader_.dispose();this.off();if(this.mediaSource.dispose){this.mediaSource.dispose()}}},{key:"master",value:function(){return this.masterPlaylistLoader_.master}},{key:"media",value:function(){return this.masterPlaylistLoader_.media()||this.initialMedia_}},{key:"setupSourceBuffers_",value:function(){var media=this.masterPlaylistLoader_.media(),mimeTypes=void 0;if(!media||"open"!==this.mediaSource.readyState){return}mimeTypes=mimeTypesForPlaylist(this.masterPlaylistLoader_.master,media);if(1>mimeTypes.length){this.error="No compatible SourceBuffer configuration for the variant stream:"+media.resolvedUri;return this.mediaSource.endOfStream("decode")}this.configureLoaderMimeTypes_(mimeTypes);this.excludeIncompatibleVariants_(media)}},{key:"configureLoaderMimeTypes_",value:function(mimeTypes){var sourceBufferEmitter=1<mimeTypes.length&&-1===mimeTypes[0].indexOf(",")&&mimeTypes[0]!==mimeTypes[1]?new videojs$1.EventTarget:null;this.mainSegmentLoader_.mimeType(mimeTypes[0],sourceBufferEmitter);if(mimeTypes[1]){this.audioSegmentLoader_.mimeType(mimeTypes[1],sourceBufferEmitter)}}},{key:"excludeUnsupportedVariants_",value:function(){this.master().playlists.forEach(function(variant){if(variant.attributes.CODECS&&window$3.MediaSource&&window$3.MediaSource.isTypeSupported&&!window$3.MediaSource.isTypeSupported("video/mp4; codecs=\""+mapLegacyAvcCodecs(variant.attributes.CODECS)+"\"")){variant.excludeUntil=1/0}})}},{key:"excludeIncompatibleVariants_",value:function(media){var codecCount=2,videoCodec=null,codecs=void 0;if(media.attributes.CODECS){codecs=parseCodecs(media.attributes.CODECS);videoCodec=codecs.videoCodec;codecCount=codecs.codecCount}this.master().playlists.forEach(function(variant){var variantCodecs={codecCount:2,videoCodec:null};if(variant.attributes.CODECS){variantCodecs=parseCodecs(variant.attributes.CODECS)}if(variantCodecs.codecCount!==codecCount){variant.excludeUntil=1/0}if(variantCodecs.videoCodec!==videoCodec){variant.excludeUntil=1/0}})}},{key:"updateAdCues_",value:function(media){var offset=0,seekable$$1=this.seekable();if(seekable$$1.length){offset=seekable$$1.start(0)}updateAdCues(media,this.cueTagsTrack_,offset)}},{key:"goalBufferLength",value:function(){var currentTime=this.tech_.currentTime(),initial=Config.GOAL_BUFFER_LENGTH,rate=Config.GOAL_BUFFER_LENGTH_RATE,max=Math.max(initial,Config.MAX_GOAL_BUFFER_LENGTH);return Math.min(initial+currentTime*rate,max)}},{key:"bufferLowWaterLine",value:function(){var currentTime=this.tech_.currentTime(),initial=Config.BUFFER_LOW_WATER_LINE,rate=Config.BUFFER_LOW_WATER_LINE_RATE,max=Math.max(initial,Config.MAX_BUFFER_LOW_WATER_LINE);return Math.min(initial+currentTime*rate,max)}}]);return MasterPlaylistController}(videojs$1.EventTarget),enableFunction=function(loader,playlistID,changePlaylistFn){return function(enable){var playlist=loader.master.playlists[playlistID],incompatible=isIncompatible(playlist),currentlyEnabled=isEnabled(playlist);if("undefined"==typeof enable){return currentlyEnabled}if(enable){delete playlist.disabled}else{playlist.disabled=!0}if(enable!==currentlyEnabled&&!incompatible){changePlaylistFn();if(enable){loader.trigger("renditionenabled")}else{loader.trigger("renditiondisabled")}}return enable}},Representation=function Representation(hlsHandler,playlist,id){classCallCheck(this,Representation);var mpc=hlsHandler.masterPlaylistController_,smoothQualityChange=hlsHandler.options_.smoothQualityChange,changeType=smoothQualityChange?"smooth":"fast",qualityChangeFunction=mpc[changeType+"QualityChange_"].bind(mpc);if(playlist.attributes.RESOLUTION){var resolution=playlist.attributes.RESOLUTION;this.width=resolution.width;this.height=resolution.height}this.bandwidth=playlist.attributes.BANDWIDTH;this.id=id;this.enabled=enableFunction(hlsHandler.playlists,playlist.id,qualityChangeFunction)},renditionSelectionMixin=function(hlsHandler){var playlists=hlsHandler.playlists;hlsHandler.representations=function(){if(!playlists||!playlists.master||!playlists.master.playlists){return[]}return playlists.master.playlists.filter(function(media){return!isIncompatible(media)}).map(function(e){return new Representation(hlsHandler,e,e.id)})}},timerCancelEvents=["seeking","seeked","pause","playing","error"],PlaybackWatcher=function(){function PlaybackWatcher(options){var _this=this;classCallCheck(this,PlaybackWatcher);this.tech_=options.tech;this.seekable=options.seekable;this.allowSeeksWithinUnsafeLiveWindow=options.allowSeeksWithinUnsafeLiveWindow;this.media=options.media;this.consecutiveUpdates=0;this.lastRecordedTime=null;this.timer_=null;this.checkCurrentTimeTimeout_=null;this.logger_=logger("PlaybackWatcher");this.logger_("initialize");var canPlayHandler=function(){return _this.monitorCurrentTime_()},waitingHandler=function(){return _this.techWaiting_()},cancelTimerHandler=function(){return _this.cancelTimer_()},fixesBadSeeksHandler=function(){return _this.fixesBadSeeks_()};this.tech_.on("seekablechanged",fixesBadSeeksHandler);this.tech_.on("waiting",waitingHandler);this.tech_.on(timerCancelEvents,cancelTimerHandler);this.tech_.on("canplay",canPlayHandler);this.dispose=function(){_this.logger_("dispose");_this.tech_.off("seekablechanged",fixesBadSeeksHandler);_this.tech_.off("waiting",waitingHandler);_this.tech_.off(timerCancelEvents,cancelTimerHandler);_this.tech_.off("canplay",canPlayHandler);if(_this.checkCurrentTimeTimeout_){window$3.clearTimeout(_this.checkCurrentTimeTimeout_)}_this.cancelTimer_()}}createClass$1(PlaybackWatcher,[{key:"monitorCurrentTime_",value:function(){this.checkCurrentTime_();if(this.checkCurrentTimeTimeout_){window$3.clearTimeout(this.checkCurrentTimeTimeout_)}this.checkCurrentTimeTimeout_=window$3.setTimeout(this.monitorCurrentTime_.bind(this),250)}},{key:"checkCurrentTime_",value:function(){if(this.tech_.seeking()&&this.fixesBadSeeks_()){this.consecutiveUpdates=0;this.lastRecordedTime=this.tech_.currentTime();return}if(this.tech_.paused()||this.tech_.seeking()){return}var currentTime=this.tech_.currentTime(),buffered=this.tech_.buffered();if(this.lastRecordedTime===currentTime&&(!buffered.length||currentTime+SAFE_TIME_DELTA>=buffered.end(buffered.length-1))){return this.techWaiting_()}if(5<=this.consecutiveUpdates&&currentTime===this.lastRecordedTime){this.consecutiveUpdates++;this.waiting_()}else if(currentTime===this.lastRecordedTime){this.consecutiveUpdates++}else{this.consecutiveUpdates=0;this.lastRecordedTime=currentTime}}},{key:"cancelTimer_",value:function(){this.consecutiveUpdates=0;if(this.timer_){this.logger_("cancelTimer_");clearTimeout(this.timer_)}this.timer_=null}},{key:"fixesBadSeeks_",value:function(){var seeking=this.tech_.seeking();if(!seeking){return!1}var seekable=this.seekable(),currentTime=this.tech_.currentTime(),isAfterSeekableRange=this.afterSeekableWindow_(seekable,currentTime,this.media(),this.allowSeeksWithinUnsafeLiveWindow),seekTo=void 0;if(isAfterSeekableRange){var seekableEnd=seekable.end(seekable.length-1);seekTo=seekableEnd}if(this.beforeSeekableWindow_(seekable,currentTime)){var seekableStart=seekable.start(0);seekTo=seekableStart+SAFE_TIME_DELTA}if("undefined"!=typeof seekTo){this.logger_("Trying to seek outside of seekable at time "+currentTime+" with "+("seekable range "+printableRange(seekable)+". Seeking to ")+(seekTo+"."));this.tech_.setCurrentTime(seekTo);return!0}return!1}},{key:"waiting_",value:function(){if(this.techWaiting_()){return}var currentTime=this.tech_.currentTime(),buffered=this.tech_.buffered(),currentRange=findRange(buffered,currentTime);if(currentRange.length&&currentTime+3<=currentRange.end(0)){this.cancelTimer_();this.tech_.setCurrentTime(currentTime);this.logger_("Stopped at "+currentTime+" while inside a buffered region "+("["+currentRange.start(0)+" -> "+currentRange.end(0)+"]. Attempting to resume playback by seeking to the current time."));this.tech_.trigger({type:"usage",name:"hls-unknown-waiting"})}}},{key:"techWaiting_",value:function(){var seekable=this.seekable(),currentTime=this.tech_.currentTime();if(this.tech_.seeking()&&this.fixesBadSeeks_()){return!0}if(this.tech_.seeking()||null!==this.timer_){return!0}if(this.beforeSeekableWindow_(seekable,currentTime)){var livePoint=seekable.end(seekable.length-1);this.logger_("Fell out of live window at time "+currentTime+". Seeking to "+("live point (seekable end) "+livePoint));this.cancelTimer_();this.tech_.setCurrentTime(livePoint);this.tech_.trigger({type:"usage",name:"hls-live-resync"});return!0}var buffered=this.tech_.buffered(),nextRange=findNextRange(buffered,currentTime);if(this.videoUnderflow_(nextRange,buffered,currentTime)){this.cancelTimer_();this.tech_.setCurrentTime(currentTime);this.tech_.trigger({type:"usage",name:"hls-video-underflow"});return!0}if(0<nextRange.length){var difference=nextRange.start(0)-currentTime;this.logger_("Stopped at "+currentTime+", setting timer for "+difference+", seeking "+("to "+nextRange.start(0)));this.timer_=setTimeout(this.skipTheGap_.bind(this),1e3*difference,currentTime);return!0}return!1}},{key:"afterSeekableWindow_",value:function(seekable,currentTime,playlist){var allowSeeksWithinUnsafeLiveWindow=3<arguments.length&&arguments[3]!==void 0?arguments[3]:!1;if(!seekable.length){return!1}var allowedEnd=seekable.end(seekable.length-1)+SAFE_TIME_DELTA,isLive=!playlist.endList;if(isLive&&allowSeeksWithinUnsafeLiveWindow){allowedEnd=seekable.end(seekable.length-1)+3*playlist.targetDuration}if(currentTime>allowedEnd){return!0}return!1}},{key:"beforeSeekableWindow_",value:function(seekable,currentTime){if(seekable.length&&0<seekable.start(0)&&currentTime<seekable.start(0)-SAFE_TIME_DELTA){return!0}return!1}},{key:"videoUnderflow_",value:function(nextRange,buffered,currentTime){if(0===nextRange.length){var gap=this.gapFromVideoUnderflow_(buffered,currentTime);if(gap){this.logger_("Encountered a gap in video from "+gap.start+" to "+gap.end+". "+("Seeking to current time "+currentTime));return!0}}return!1}},{key:"skipTheGap_",value:function(scheduledCurrentTime){var buffered=this.tech_.buffered(),currentTime=this.tech_.currentTime(),nextRange=findNextRange(buffered,currentTime);this.cancelTimer_();if(0===nextRange.length||currentTime!==scheduledCurrentTime){return}this.logger_("skipTheGap_:","currentTime:",currentTime,"scheduled currentTime:",scheduledCurrentTime,"nextRange start:",nextRange.start(0));this.tech_.setCurrentTime(nextRange.start(0)+TIME_FUDGE_FACTOR);this.tech_.trigger({type:"usage",name:"hls-gap-skip"})}},{key:"gapFromVideoUnderflow_",value:function(buffered,currentTime){for(var gaps=findGaps(buffered),i=0;i<gaps.length;i++){var start=gaps.start(i),end=gaps.end(i);if(4>currentTime-start&&2<currentTime-start){return{start:start,end:end}}}return null}}]);return PlaybackWatcher}(),defaultOptions={errorInterval:30,getSource:function(next){var tech=this.tech({IWillNotUseThisInPlugins:!0}),sourceObj=tech.currentSource_;return next(sourceObj)}},initPlugin=function initPlugin(player,options){var lastCalled=0,seekTo=0,localOptions=videojs$1.mergeOptions(defaultOptions,options);player.ready(function(){player.trigger({type:"usage",name:"hls-error-reload-initialized"})});var loadedMetadataHandler=function(){if(seekTo){player.currentTime(seekTo)}},setSource=function(sourceObj){if(null===sourceObj||sourceObj===void 0){return}seekTo=player.duration()!==1/0&&player.currentTime()||0;player.one("loadedmetadata",loadedMetadataHandler);player.src(sourceObj);player.trigger({type:"usage",name:"hls-error-reload"});player.play()},errorHandler=function(){if(Date.now()-lastCalled<1e3*localOptions.errorInterval){player.trigger({type:"usage",name:"hls-error-reload-canceled"});return}if(!localOptions.getSource||"function"!=typeof localOptions.getSource){videojs$1.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!");return}lastCalled=Date.now();return localOptions.getSource.call(player,setSource)},cleanupEvents=function cleanupEvents(){player.off("loadedmetadata",loadedMetadataHandler);player.off("error",errorHandler);player.off("dispose",cleanupEvents)};player.on("error",errorHandler);player.on("dispose",cleanupEvents);player.reloadSourceOnError=function(newOptions){cleanupEvents();initPlugin(player,newOptions)}},reloadSourceOnError=function(options){initPlugin(this,options)},Hls$1={PlaylistLoader:PlaylistLoader,Playlist:Playlist,Decrypter:Decrypter,AsyncStream:AsyncStream,decrypt:decrypt,utils:utils$1,STANDARD_PLAYLIST_SELECTOR:lastBandwidthSelector,INITIAL_PLAYLIST_SELECTOR:function(){var playlists=this.playlists.master.playlists.filter(Playlist.isEnabled);stableSort(playlists,function(a,b){return comparePlaylistBandwidth(a,b)});var playlistsWithVideo=playlists.filter(function(playlist){return parseCodecs(playlist.attributes.CODECS).videoCodec});return playlistsWithVideo[0]||null},comparePlaylistBandwidth:comparePlaylistBandwidth,comparePlaylistResolution:comparePlaylistResolution,xhr:xhrFactory()};["GOAL_BUFFER_LENGTH","MAX_GOAL_BUFFER_LENGTH","GOAL_BUFFER_LENGTH_RATE","BUFFER_LOW_WATER_LINE","MAX_BUFFER_LOW_WATER_LINE","BUFFER_LOW_WATER_LINE_RATE","BANDWIDTH_VARIANCE"].forEach(function(prop){Object.defineProperty(Hls$1,prop,{get:function(){videojs$1.log.warn("using Hls."+prop+" is UNSAFE be sure you know what you are doing");return Config[prop]},set:function(value){videojs$1.log.warn("using Hls."+prop+" is UNSAFE be sure you know what you are doing");if("number"!=typeof value||0>value){videojs$1.log.warn("value of Hls."+prop+" must be greater than or equal to 0");return}Config[prop]=value}})});var simpleTypeFromSourceType=function(type){if(/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i.test(type)){return"hls"}if(/^application\/dash\+xml/i.test(type)){return"dash"}return null},handleHlsMediaChange=function(qualityLevels,playlistLoader){for(var newPlaylist=playlistLoader.media(),selectedIndex=-1,i=0;i<qualityLevels.length;i++){if(qualityLevels[i].id===newPlaylist.id){selectedIndex=i;break}}qualityLevels.selectedIndex_=selectedIndex;qualityLevels.trigger({selectedIndex:selectedIndex,type:"change"})},handleHlsLoadedMetadata=function(qualityLevels,hls){hls.representations().forEach(function(rep){qualityLevels.addQualityLevel(rep)});handleHlsMediaChange(qualityLevels,hls.playlists)};Hls$1.canPlaySource=function(){return videojs$1.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var emeKeySystems=function(keySystemOptions,mainSegmentLoader,audioSegmentLoader){if(!keySystemOptions){return keySystemOptions}var videoMimeType=void 0,audioMimeType=void 0;if(audioSegmentLoader.mimeType_){videoMimeType=mainSegmentLoader.mimeType_;audioMimeType=audioSegmentLoader.mimeType_}else{var parsedMimeType=parseContentType(mainSegmentLoader.mimeType_),codecs=parsedMimeType.parameters.codecs.split(","),audioCodec=void 0,videoCodec=void 0;codecs.forEach(function(codec){codec=codec.trim();if(isAudioCodec(codec)){audioCodec=codec}else if(isVideoCodec(codec)){videoCodec=codec}});videoMimeType=parsedMimeType.type+"; codecs=\""+videoCodec+"\"";audioMimeType=parsedMimeType.type.replace("video","audio")+"; codecs=\""+audioCodec+"\""}var keySystemContentTypes={},videoPlaylist=mainSegmentLoader.playlist_;for(var keySystem in keySystemOptions){keySystemContentTypes[keySystem]={audioContentType:audioMimeType,videoContentType:videoMimeType};if(videoPlaylist.contentProtection&&videoPlaylist.contentProtection[keySystem]&&videoPlaylist.contentProtection[keySystem].pssh){keySystemContentTypes[keySystem].pssh=videoPlaylist.contentProtection[keySystem].pssh}if("string"==typeof keySystemOptions[keySystem]){keySystemContentTypes[keySystem].url=keySystemOptions[keySystem]}}return videojs$1.mergeOptions(keySystemOptions,keySystemContentTypes)},setupEmeOptions=function(hlsHandler){var mainSegmentLoader=hlsHandler.masterPlaylistController_.mainSegmentLoader_,audioSegmentLoader=hlsHandler.masterPlaylistController_.audioSegmentLoader_,player=videojs$1.players[hlsHandler.tech_.options_.playerId];if(player.eme){var sourceOptions=emeKeySystems(hlsHandler.source_.keySystems,mainSegmentLoader,audioSegmentLoader);if(sourceOptions){player.currentSource().keySystems=sourceOptions;if(!(11===videojs$1.browser.IE_VERSION)&&player.eme.initializeMediaKeys){player.eme.initializeMediaKeys()}}}},getVhsLocalStorage=function(){if(!window.localStorage){return null}var storedObject=window.localStorage.getItem("videojs-vhs");if(!storedObject){return null}try{return JSON.parse(storedObject)}catch(e){return null}},updateVhsLocalStorage=function(options){if(!window.localStorage){return!1}var objectToStore=getVhsLocalStorage();objectToStore=objectToStore?videojs$1.mergeOptions(objectToStore,options):options;try{window.localStorage.setItem("videojs-vhs",JSON.stringify(objectToStore))}catch(e){return!1}return objectToStore};Hls$1.supportsNativeHls=function(){var video=document.createElement("video");if(!videojs$1.getTech("Html5").isSupported()){return!1}return["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(canItPlay){return /maybe|probably/i.test(video.canPlayType(canItPlay))})}();Hls$1.supportsNativeDash=function(){if(!videojs$1.getTech("Html5").isSupported()){return!1}return /maybe|probably/i.test(document.createElement("video").canPlayType("application/dash+xml"))}();Hls$1.supportsTypeNatively=function(type){if("hls"===type){return Hls$1.supportsNativeHls}if("dash"===type){return Hls$1.supportsNativeDash}return!1};Hls$1.isSupported=function(){return videojs$1.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var Component$1=videojs$1.getComponent("Component"),HlsHandler=function(_Component){inherits$1(HlsHandler,_Component);function HlsHandler(source,tech,options){classCallCheck(this,HlsHandler);var _this=possibleConstructorReturn(this,(HlsHandler.__proto__||Object.getPrototypeOf(HlsHandler)).call(this,tech,options.hls));if(tech.options_&&tech.options_.playerId){var _player=videojs$1(tech.options_.playerId);if(!_player.hasOwnProperty("hls")){Object.defineProperty(_player,"hls",{get:function(){videojs$1.log.warn("player.hls is deprecated. Use player.tech().hls instead.");tech.trigger({type:"usage",name:"hls-player-access"});return _this},configurable:!0})}_player.vhs=_this;_player.dash=_this;_this.player_=_player}_this.tech_=tech;_this.source_=source;_this.stats={};_this.ignoreNextSeekingEvent_=!1;_this.setOptions_();if(_this.options_.overrideNative&&tech.overrideNativeAudioTracks&&tech.overrideNativeVideoTracks){tech.overrideNativeAudioTracks(!0);tech.overrideNativeVideoTracks(!0)}else if(_this.options_.overrideNative&&(tech.featuresNativeVideoTracks||tech.featuresNativeAudioTracks)){throw new Error("Overriding native HLS requires emulated tracks. See https://git.io/vMpjB")}_this.on(document,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],function(){var fullscreenElement=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(fullscreenElement&&fullscreenElement.contains(_this.tech_.el())){_this.masterPlaylistController_.smoothQualityChange_()}});_this.on(_this.tech_,"seeking",function(){if(this.ignoreNextSeekingEvent_){this.ignoreNextSeekingEvent_=!1;return}this.setCurrentTime(this.tech_.currentTime())});_this.on(_this.tech_,"error",function(){if(this.masterPlaylistController_){this.masterPlaylistController_.pauseLoading()}});_this.on(_this.tech_,"play",_this.play);return _this}createClass$1(HlsHandler,[{key:"setOptions_",value:function(){var _this2=this;this.options_.withCredentials=this.options_.withCredentials||!1;this.options_.handleManifestRedirects=this.options_.handleManifestRedirects||!1;this.options_.limitRenditionByPlayerDimensions=!1===this.options_.limitRenditionByPlayerDimensions?!1:!0;this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1;this.options_.smoothQualityChange=this.options_.smoothQualityChange||!1;this.options_.useBandwidthFromLocalStorage="undefined"!=typeof this.source_.useBandwidthFromLocalStorage?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1;this.options_.customTagParsers=this.options_.customTagParsers||[];this.options_.customTagMappers=this.options_.customTagMappers||[];this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1;if("number"!=typeof this.options_.blacklistDuration){this.options_.blacklistDuration=300}if("number"!=typeof this.options_.bandwidth){if(this.options_.useBandwidthFromLocalStorage){var storedObject=getVhsLocalStorage();if(storedObject&&storedObject.bandwidth){this.options_.bandwidth=storedObject.bandwidth;this.tech_.trigger({type:"usage",name:"hls-bandwidth-from-local-storage"})}if(storedObject&&storedObject.throughput){this.options_.throughput=storedObject.throughput;this.tech_.trigger({type:"usage",name:"hls-throughput-from-local-storage"})}}}if("number"!=typeof this.options_.bandwidth){this.options_.bandwidth=Config.INITIAL_BANDWIDTH}this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===Config.INITIAL_BANDWIDTH;["withCredentials","useDevicePixelRatio","limitRenditionByPlayerDimensions","bandwidth","smoothQualityChange","customTagParsers","customTagMappers","handleManifestRedirects","cacheEncryptionKeys"].forEach(function(option){if("undefined"!=typeof _this2.source_[option]){_this2.options_[option]=_this2.source_[option]}});this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions;this.useDevicePixelRatio=this.options_.useDevicePixelRatio}},{key:"src",value:function(_src,type){var _this3=this;if(!_src){return}this.setOptions_();this.options_.url=this.source_.src;this.options_.tech=this.tech_;this.options_.externHls=Hls$1;this.options_.sourceType=simpleTypeFromSourceType(type);this.options_.seekTo=function(time){_this3.tech_.setCurrentTime(time)};this.masterPlaylistController_=new MasterPlaylistController(this.options_);this.playbackWatcher_=new PlaybackWatcher(videojs$1.mergeOptions(this.options_,{seekable:function(){return _this3.seekable()},media:function(){return _this3.masterPlaylistController_.media()}}));this.masterPlaylistController_.on("error",function(){var player=videojs$1.players[_this3.tech_.options_.playerId];player.error(_this3.masterPlaylistController_.error)});this.masterPlaylistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):Hls$1.STANDARD_PLAYLIST_SELECTOR.bind(this);this.masterPlaylistController_.selectInitialPlaylist=Hls$1.INITIAL_PLAYLIST_SELECTOR.bind(this);this.playlists=this.masterPlaylistController_.masterPlaylistLoader_;this.mediaSource=this.masterPlaylistController_.mediaSource;Object.defineProperties(this,{selectPlaylist:{get:function(){return this.masterPlaylistController_.selectPlaylist},set:function(selectPlaylist){this.masterPlaylistController_.selectPlaylist=selectPlaylist.bind(this)}},throughput:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.throughput.rate},set:function(throughput){this.masterPlaylistController_.mainSegmentLoader_.throughput.rate=throughput;this.masterPlaylistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.bandwidth},set:function(bandwidth){this.masterPlaylistController_.mainSegmentLoader_.bandwidth=bandwidth;this.masterPlaylistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get:function(){var invBandwidth=1/(this.bandwidth||1),invThroughput=void 0;if(0<this.throughput){invThroughput=1/this.throughput}else{invThroughput=0}var systemBitrate=Math.floor(1/(invBandwidth+invThroughput));return systemBitrate},set:function(){videojs$1.log.error("The \"systemBandwidth\" property is read-only")}}});if(this.options_.bandwidth){this.bandwidth=this.options_.bandwidth}if(this.options_.throughput){this.throughput=this.options_.throughput}Object.defineProperties(this.stats,{bandwidth:{get:function(){return _this3.bandwidth||0},enumerable:!0},mediaRequests:{get:function(){return _this3.masterPlaylistController_.mediaRequests_()||0},enumerable:!0},mediaRequestsAborted:{get:function(){return _this3.masterPlaylistController_.mediaRequestsAborted_()||0},enumerable:!0},mediaRequestsTimedout:{get:function(){return _this3.masterPlaylistController_.mediaRequestsTimedout_()||0},enumerable:!0},mediaRequestsErrored:{get:function(){return _this3.masterPlaylistController_.mediaRequestsErrored_()||0},enumerable:!0},mediaTransferDuration:{get:function(){return _this3.masterPlaylistController_.mediaTransferDuration_()||0},enumerable:!0},mediaBytesTransferred:{get:function(){return _this3.masterPlaylistController_.mediaBytesTransferred_()||0},enumerable:!0},mediaSecondsLoaded:{get:function(){return _this3.masterPlaylistController_.mediaSecondsLoaded_()||0},enumerable:!0},buffered:{get:function(){return timeRangesToArray(_this3.tech_.buffered())},enumerable:!0},currentTime:{get:function(){return _this3.tech_.currentTime()},enumerable:!0},currentSource:{get:function(){return _this3.tech_.currentSource_},enumerable:!0},currentTech:{get:function(){return _this3.tech_.name_},enumerable:!0},duration:{get:function(){return _this3.tech_.duration()},enumerable:!0},master:{get:function(){return _this3.playlists.master},enumerable:!0},playerDimensions:{get:function(){return _this3.tech_.currentDimensions()},enumerable:!0},seekable:{get:function(){return timeRangesToArray(_this3.tech_.seekable())},enumerable:!0},timestamp:{get:function(){return Date.now()},enumerable:!0},videoPlaybackQuality:{get:function(){return _this3.tech_.getVideoPlaybackQuality()},enumerable:!0}});this.tech_.one("canplay",this.masterPlaylistController_.setupFirstPlay.bind(this.masterPlaylistController_));this.tech_.on("bandwidthupdate",function(){if(_this3.options_.useBandwidthFromLocalStorage){updateVhsLocalStorage({bandwidth:_this3.bandwidth,throughput:Math.round(_this3.throughput)})}});this.masterPlaylistController_.on("selectedinitialmedia",function(){renditionSelectionMixin(_this3);setupEmeOptions(_this3)});this.on(this.masterPlaylistController_,"progress",function(){this.tech_.trigger("progress")});this.on(this.masterPlaylistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0});this.setupQualityLevels_();if(!this.tech_.el()){return}this.tech_.src(videojs$1.URL.createObjectURL(this.masterPlaylistController_.mediaSource))}},{key:"setupQualityLevels_",value:function(){var _this4=this,player=videojs$1.players[this.tech_.options_.playerId];if(!player||!player.qualityLevels||this.qualityLevels_){return}this.qualityLevels_=player.qualityLevels();this.masterPlaylistController_.on("selectedinitialmedia",function(){handleHlsLoadedMetadata(_this4.qualityLevels_,_this4)});this.playlists.on("mediachange",function(){handleHlsMediaChange(_this4.qualityLevels_,_this4.playlists)})}},{key:"play",value:function(){this.masterPlaylistController_.play()}},{key:"setCurrentTime",value:function(currentTime){this.masterPlaylistController_.setCurrentTime(currentTime)}},{key:"duration",value:function(){return this.masterPlaylistController_.duration()}},{key:"seekable",value:function(){return this.masterPlaylistController_.seekable()}},{key:"dispose",value:function(){if(this.playbackWatcher_){this.playbackWatcher_.dispose()}if(this.masterPlaylistController_){this.masterPlaylistController_.dispose()}if(this.qualityLevels_){this.qualityLevels_.dispose()}if(this.player_){delete this.player_.vhs;delete this.player_.dash;delete this.player_.hls}if(this.tech_&&this.tech_.hls){delete this.tech_.hls}get$1(HlsHandler.prototype.__proto__||Object.getPrototypeOf(HlsHandler.prototype),"dispose",this).call(this)}},{key:"convertToProgramTime",value:function(time,callback){return getProgramTime({playlist:this.masterPlaylistController_.media(),time:time,callback:callback})}},{key:"seekToProgramTime",value:function(programTime,callback){var pauseAfterSeek=2<arguments.length&&arguments[2]!==void 0?arguments[2]:!0,retryCount=3<arguments.length&&arguments[3]!==void 0?arguments[3]:2;return seekToProgramTime({programTime:programTime,playlist:this.masterPlaylistController_.media(),retryCount:retryCount,pauseAfterSeek:pauseAfterSeek,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:callback})}}]);return HlsHandler}(Component$1),HlsSourceHandler={name:"videojs-http-streaming",VERSION:"1.13.4",canHandleSource:function(srcObj){var options=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},localOptions=videojs$1.mergeOptions(videojs$1.options,options);return HlsSourceHandler.canPlayType(srcObj.type,localOptions)},handleSource:function(source,tech){var options=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{},localOptions=videojs$1.mergeOptions(videojs$1.options,options);tech.hls=new HlsHandler(source,tech,localOptions);tech.hls.xhr=xhrFactory();tech.hls.src(source.src,source.type);return tech.hls},canPlayType:function(type){var options=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},_videojs$mergeOptions=videojs$1.mergeOptions(videojs$1.options,options),overrideNative=_videojs$mergeOptions.hls.overrideNative,supportedType=simpleTypeFromSourceType(type),canUseMsePlayback=supportedType&&(!Hls$1.supportsTypeNatively(supportedType)||overrideNative);return canUseMsePlayback?"maybe":""}};if("undefined"==typeof videojs$1.MediaSource||"undefined"==typeof videojs$1.URL){videojs$1.MediaSource=MediaSource;videojs$1.URL=URL$1}if(MediaSource.supportsNativeMediaSources()){videojs$1.getTech("Html5").registerSourceHandler(HlsSourceHandler,0)}videojs$1.HlsHandler=HlsHandler;videojs$1.HlsSourceHandler=HlsSourceHandler;videojs$1.Hls=Hls$1;if(!videojs$1.use){videojs$1.registerComponent("Hls",Hls$1)}videojs$1.options.hls=videojs$1.options.hls||{};if(videojs$1.registerPlugin){videojs$1.registerPlugin("reloadSourceOnError",reloadSourceOnError)}else{videojs$1.plugin("reloadSourceOnError",reloadSourceOnError)}return videojs$1});
//# sourceMappingURL=video-lazy.min.js.map
