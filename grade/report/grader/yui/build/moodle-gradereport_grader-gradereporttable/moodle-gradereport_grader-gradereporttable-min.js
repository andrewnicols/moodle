YUI.add("moodle-gradereport_grader-gradereporttable",function(c,e){var m,t,i,s,o,n,r,a,d,C,v,h,g,l;function p(){p.superclass.constructor.apply(this,arguments)}function u(){}m=".avg .header",t="#user-grades .avg .cell",i="td.grade",s=".gradeparent table",o=".gradeparent",n="#user-grades .heading .cell",r="#user-grades tr.heading",a="#studentheader",d="#user-grades .user.cell",C={OVERRIDDEN:"overridden",TOOLTIPACTIVE:"tooltipactive"},c.extend(p,c.Base,{_eventHandles:[],graderTable:null,initializer:function(){this.graderRegion=c.one(o),this.graderTable=c.one(s),this.setupFloatingHeaders()},getGradeUserName:function(e){e=e.ancestor("tr").one("th.user .username");return e?e.get("text"):""},getGradeItemName:function(e){e=c.one("th.item[data-itemid='"+e.getData("itemid")+"']");return e?e.get("text"):""},getGradeFeedback:function(e){return e.getData("feedback")}}),c.namespace("M.gradereport_grader").ReportTable=p,c.namespace("M.gradereport_grader").init=function(e){return new c.M.gradereport_grader.ReportTable(e)},v="height",h="width",g="offsetWidth",l="offsetHeight",C.FLOATING="floating",u.ATTRS={},u.prototype={pageHeaderHeight:0,container:null,headerCell:null,headerRow:null,firstUserCell:null,firstNonUserCell:null,firstNonUserCellLeft:0,firstNonUserCellWidth:0,tableFooterRow:null,footerRow:null,gradeItemHeadingContainer:null,userColumnHeader:null,userColumn:null,firstUserCellBottom:0,firstUserCellLeft:0,firstUserCellWidth:0,dockWidth:0,lastUserCellTop:0,floatingHeaderRow:null,_eventHandles:[],lastBodyMargin:0,setupFloatingHeaders:function(){return this.firstUserCell=c.one(d),this.container=c.one(o),this.firstNonUserCell=c.one(i),this.firstUserCell?M.cfg.behatsiterunning?void 0:(this._setupFloatingUserColumn(),this._setupFloatingUserHeader(),this._setupFloatingAssignmentHeaders(),this._setupFloatingAssignmentFooter(),this.floatingHeaderRow={},this._setupFloatingLeftHeaders(".controls .controls"),this._setupFloatingLeftHeaders(".range .range"),this._setupFloatingLeftHeaders(m),this._setupFloatingAssignmentFooterTitle(),this._calculateCellPositions(),this._handleScrollEvent(),this._setupEventHandlers(),c.Global.on("moodle-gradereport_grader:resized",this._handleResizeEvent,this),this):this},_calculateCellPositions:function(){var e,t;this.headerRowTop=this.headerRow.getY(),this.tableFooterRow&&(this.footerRowPosition=this.tableFooterRow.getY()),this.dockWidth=0,(e=c.one(".has_dock #dock"))&&(this.dockWidth=e.get(g)),e=c.all(d),this.firstUserCellLeft=this.firstUserCell.getX(),this.firstUserCellWidth=this.firstUserCell.get(g),this.firstNonUserCellLeft=this.firstNonUserCell.getX(),this.firstNonUserCellWidth=this.firstNonUserCell.get(g),1<e.size()?(t=e.item(1),this.firstUserCellBottom=t.getY()+parseInt(t.getComputedStyle(v),10),this.lastUserCellTop=e.item(e.size()-2).getY()):(t=e.item(0),this.lastUserCellTop=t.getY(),this.tableFooterRow?this.firstUserCellBottom=this.footerRowPosition+parseInt(this.tableFooterRow.getComputedStyle(v),10):this.firstUserCellBottom=t.getY()+t.get("offsetHeight")),e=c.one("header"),this.pageHeaderHeight=0,e&&("fixed"===e.getComputedStyle("position")?this.pageHeaderHeight=e.get(l):(t=c.one(".navbar"))&&"fixed"===t.getComputedStyle("position")&&(this.pageHeaderHeight=t.get(l)))},_getRelativeXY:function(e){return this._getRelativeXYFromXY(e.getX(),e.getY())},_getRelativeXYFromXY:function(e,t){var i=this.container.getXY();return[e-i[0],t-i[1]]},_getRelativeXFromX:function(e){return this._getRelativeXYFromXY(e,0)[0]},_getRelativeYFromY:function(e){return this._getRelativeXYFromXY(0,e)[1]},_getScrollBarHeight:function(){return!(c.UA.ie&&10<=c.UA.ie)&&c.config.doc.body.scrollWidth>c.config.doc.body.clientWidth?c.DOM.getScrollbarWidth():0},_setupEventHandlers:function(){this._eventHandles.push(c.one(c.config.win).on("scroll",this._handleScrollEvent,this),c.one(c.config.win).on("resize",this._handleResizeEvent,this),c.one(c.config.win).on("orientationchange",this._handleResizeEvent,this),c.Global.on("dock:shown",this._handleResizeEvent,this),c.Global.on("dock:hidden",this._handleResizeEvent,this))},_setupFloatingUserColumn:function(){var e=c.all(d),s=c.Node.create('<div aria-hidden="true" role="presentation" class="floater sideonly"></div>'),t=this._getRelativeXY(this.firstUserCell);e.each(function(e){var t,i=e.getComputedStyle(v);0!==c.UA.ie&&(i=e.get("offsetHeight")-(parseInt(e.getComputedStyle("marginTop"),10)+parseInt(e.getComputedStyle("marginBottom"),10))-(parseInt(e.getComputedStyle("paddingTop"),10)+parseInt(e.getComputedStyle("paddingBottom"),10))-(parseInt(e.getComputedStyle("borderTopWidth"),10)+parseInt(e.getComputedStyle("borderBottomWidth"),10))),(t=c.Node.create("<div></div>")).set("innerHTML",e.get("innerHTML")).setAttribute("class",e.getAttribute("class")).setAttribute("data-uid",e.ancestor("tr").getData("uid")).setStyles({height:i,width:e.getComputedStyle(h)}),s.appendChild(t)},this),s.setStyles({left:t[0]+"px",position:"absolute",top:t[1]+"px"}),this.graderRegion.append(s),this.userColumn=s},_setupFloatingUserHeader:function(){this.headerRow=c.one(r),this.headerCell=c.one(a);var e=c.Node.create('<div aria-hidden="true" role="presentation" class="floater sideonly heading"></div>'),t=c.Node.create("<div></div>"),i=this._getRelativeXY(this.headerCell)[0],s=this._getRelativeXY(this.headerRow),o=s[0];t.set("innerHTML",this.headerCell.getHTML()).setAttribute("class",this.headerCell.getAttribute("class")).setStyles({width:this.firstUserCell.getComputedStyle(h),left:i-o+"px"}),e.setStyles({left:s[0]+"px",position:"absolute",top:s[1]+"px"}),e.append(t),this.graderRegion.append(e),this.userColumnHeader=e},_setupFloatingAssignmentHeaders:function(){var e,s,t,o,r,a;this.headerRow=c.one("#user-grades tr.heading"),e=c.all("#user-grades tr.heading .cell"),s=c.Node.create('<div aria-hidden="true" role="presentation" class="floater heading"></div>'),t=this._getRelativeXY(this.headerRow),a=t[r=o=0],e.each(function(e){var t=this._getRelativeXY(e)[0],i=c.Node.create("<div></div>");
i.append(e.getHTML()).setAttribute("class",e.getAttribute("class")).setData("itemid",e.getData("itemid")).setStyles({height:e.getComputedStyle(v),left:t-a+"px",position:"absolute",width:e.getComputedStyle(h)}),o+=parseInt(e.get(g),10),r=e.get(l),s.appendChild(i)},this),s.setStyles({height:r+"px",left:t[0]+"px",position:"absolute",top:t[1]+"px",width:o+"px"}),this.userColumnHeader.insert(s,"before"),this.gradeItemHeadingContainer=s},_setupFloatingAssignmentFooter:function(){var e,s,o,t,r,a;this.tableFooterRow=c.one("#user-grades .avg"),this.tableFooterRow&&(e=this.tableFooterRow.all(".cell"),s=c.Node.create('<div aria-hidden="true" role="presentation" class="floater avg"></div>'),o=0,t=this._getRelativeXY(this.tableFooterRow),r=t[0],a=0,e.each(function(e){var t=c.Node.create("<div></div>"),i=this._getRelativeXY(e)[0];t.set("innerHTML",e.getHTML()).setAttribute("class",e.getAttribute("class")).setStyles({height:e.getComputedStyle(v),left:i-r+"px",position:"absolute",width:e.getComputedStyle(h)}),s.append(t),a=e.get(l),o+=parseInt(e.get(g),10)},this),s.setStyles({position:"absolute",left:t[0]+"px",bottom:"1px",height:a+"px",width:o+"px"}),this.graderRegion.append(s),this.footerRow=s)},_setupFloatingAssignmentFooterTitle:function(){var e=this.floatingHeaderRow[m];e&&e.setStyles({bottom:"1px"})},_setupFloatingLeftHeaders:function(e){var t,i,s,o,r,a=c.one(e);a&&(t=c.Node.create('<div aria-hidden="true" role="presentation" class="floater sideonly"></div>'),i=c.Node.create("<div></div>"),s=this._getRelativeXY(a),o=this.firstUserCell.getComputedStyle(h),r=a.get(l),i.set("innerHTML",a.getHTML()).setAttribute("class",a.getAttribute("class")).setStyles({width:o}),t.setStyles({position:"absolute",top:s[1]+"px",left:s[0]+"px",height:r+"px"}).addClass(a.get("parentNode").get("className")),t.append(i),this.graderRegion.append(t),this.floatingHeaderRow[e]=t)},_handleScrollEvent:function(){var e={},t={},i={},s={},o=0,r=0,a=0,l=!1,n=!1,d=!1,h=!1,g={},p={},u=!1,f=0;(f=window.right_to_left()?parseInt(c.one(c.config.doc.body).getComputedStyle("marginRight"),10):parseInt(c.one(c.config.doc.body).getComputedStyle("marginLeft"),10))!=this.lastBodyMargin&&this._calculateCellPositions(),e.left=this._getRelativeXFromX(this.headerRow.getX()),o=c.config.win.pageYOffset+this.pageHeaderHeight>this.headerRowTop?(l=!0,c.config.win.pageYOffset+this.pageHeaderHeight<this.lastUserCellTop?this._getRelativeYFromY(c.config.win.pageYOffset+this.pageHeaderHeight):this._getRelativeYFromY(this.lastUserCellTop)):(l=!1,this._getRelativeYFromY(this.headerRowTop)),e.top=o+"px",t.top=o+"px",h=window.right_to_left()?(a=(r=c.config.win.innerWidth+c.config.win.pageXOffset-this.dockWidth)-this.firstUserCellWidth-f,n=r<this.firstUserCellLeft+this.firstUserCellWidth+f,r-this.firstNonUserCellWidth<this.firstNonUserCellLeft+this.firstUserCellWidth):(n=(r=(a=c.config.win.pageXOffset+f)+this.dockWidth+f)>this.firstUserCellLeft+f,r>this.firstNonUserCellLeft-this.firstUserCellWidth),o=n?this._getRelativeXFromX(a):this._getRelativeXFromX(this.firstUserCellLeft),i.left=o+"px",t.left=o+"px",c.Object.each(this.floatingHeaderRow,function(e,t){g[t]={left:i.left}},this),this.footerRow&&(s.left=this._getRelativeXFromX(this.headerRow.getX()),f=c.config.win.innerHeight,r=c.config.win.pageYOffset,a=f-this._getScrollBarHeight()+r,o=parseInt(this.footerRow.getComputedStyle(v),10)+this.footerRowPosition,p=g[m],u=this.floatingHeaderRow[m],d=a<o&&a>this.firstUserCellBottom?(s.bottom=Math.ceil(o-a)+"px",!0):!(s.bottom="1px"),p&&(p.bottom=s.bottom,p.top=null),g[m]=p),this.gradeItemHeadingContainer&&(this.gradeItemHeadingContainer.setStyles(e),l?this.gradeItemHeadingContainer.addClass(C.FLOATING):this.gradeItemHeadingContainer.removeClass(C.FLOATING)),this.userColumnHeader&&(this.userColumnHeader.setStyles(t),n?this.userColumnHeader.addClass(C.FLOATING):this.userColumnHeader.removeClass(C.FLOATING)),this.userColumn&&(this.userColumn.setStyles(i),n?this.userColumn.addClass(C.FLOATING):this.userColumn.removeClass(C.FLOATING)),this.footerRow&&(this.footerRow.setStyles(s),d?this.footerRow.addClass(C.FLOATING):this.footerRow.removeClass(C.FLOATING)),c.Object.each(g,function(e,t){this.floatingHeaderRow[t]&&this.floatingHeaderRow[t].setStyles(e)},this),c.Object.each(this.floatingHeaderRow,function(e,t){this.floatingHeaderRow[t]&&(h?this.floatingHeaderRow[t].addClass(C.FLOATING):this.floatingHeaderRow[t].removeClass(C.FLOATING))},this),u&&(h?u.addClass(C.FLOATING):u.removeClass(C.FLOATING))},_handleResizeEvent:function(){var s,o,i,e,r,a,l;this._calculateCellPositions(),this._handleScrollEvent(),s=this.firstUserCell.getComputedStyle(h),o=c.all(d),this.userColumnHeader.one(".cell").setStyle("width",s),this.userColumn.all(".cell").each(function(e,t){var i=o.item(t).getComputedStyle(v);0!==c.UA.ie&&(i=((t=o.item(t)).getDOMNode?t.getDOMNode().getBoundingClientRect().height:t.get("offsetHeight"))-(parseInt(t.getComputedStyle("marginTop"),10)+parseInt(t.getComputedStyle("marginBottom"),10))-(parseInt(t.getComputedStyle("paddingTop"),10)+parseInt(t.getComputedStyle("paddingBottom"),10))-(parseInt(t.getComputedStyle("borderTopWidth"),10)+parseInt(t.getComputedStyle("borderBottomWidth"),10))),e.setStyles({width:s,height:i})},this),i=this.gradeItemHeadingContainer.all(".cell"),e=c.all(n),r=this.headerRow.getX(),a=0,e.each(function(e,t){t=i.item(t);a+=e.get(g),e={width:e.getComputedStyle(h),left:e.getX()-r+"px"},t.setStyles(e)}),this.footerRow&&0!==(l=this.footerRow.all(".cell")).size()&&c.all(t).each(function(e,t){t=l.item(t),e={width:e.getComputedStyle(h),left:e.getX()-r+"px"};t.setStyles(e)}),c.Object.each(this.floatingHeaderRow,function(e){e.one("div").setStyle("width",s)},this),this.gradeItemHeadingContainer.setStyle("width",a)}},c.Base.mix(c.M.gradereport_grader.ReportTable,[u])},"@VERSION@",{requires:["base","node","event","handlebars","overlay","event-hover"]});